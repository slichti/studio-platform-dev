
> api@0.0.0 test:integration
> vitest --config vitest.config.integration.ts test/integration/quizzes.integration.test.ts --run


 RUN  v3.2.4 /Users/slichti/GitHub/studio-platform-dev/packages/api

Using vars defined in .dev.vars
[vpw:debug] Adding `enable_nodejs_tty_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_fs_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_http_modules` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_perf_hooks_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:info] Starting isolated runtimes for vitest.config.integration.ts...
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rrule.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/dateutil.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/helpers.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/weekday.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterresult.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/callbackiterresult.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/totext.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/i18n.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/parsetext.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/types.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/parseoptions.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/datetime.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/parsestring.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/optionstostring.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/datewithzone.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/cache.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iter/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/yearinfo.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/masks.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/monthinfo.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/easter.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iter/poslist.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rruleset.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterset.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rrulestr.js" points to missing source files
stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
<-- POST /quizzes

stderr | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
{"timestamp":"2026-02-19T13:56:39.530Z","level":"error","message":"Unhandled error: c.get(...) is not a function","traceId":"039c661d-810f-4334-ab09-723c052f9488","environment":"test","error":{}}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
--> POST /quizzes [31m500[0m 6ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
{"timestamp":"2026-02-19T13:56:39.535Z","level":"info","message":"Request completed: POST /quizzes","traceId":"039c661d-810f-4334-ab09-723c052f9488","environment":"test","status":500,"durationMs":7}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
<-- POST /quizzes/q_test_1/submit

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
--> POST /quizzes/q_test_1/submit [33m401[0m 1ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
{"timestamp":"2026-02-19T13:56:39.553Z","level":"info","message":"Request completed: POST /quizzes/q_test_1/submit","traceId":"a74369d7-f39a-45cc-89bd-a8e92e75804c","environment":"test","status":401,"durationMs":1}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
<-- GET /classes/c_course_1/recording

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
[TenantMiddleware DEBUG] Path: /classes/c_course_1/recording, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
[DEBUG] TenantMiddleware: User student_1 found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
--> GET /classes/c_course_1/recording [32m200[0m 15ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
{"timestamp":"2026-02-19T13:56:39.584Z","level":"info","message":"Request completed: GET /classes/c_course_1/recording","traceId":"154b2c0d-7557-4fe2-8b96-510266b8362e","environment":"test","userId":"student_1","tenantId":"quiz_tenant","status":200,"durationMs":16}

 â¯ test/integration/quizzes.integration.test.ts (3 tests | 2 failed) 126ms
   Ã— Course Quiz System (Integration) > should create and retrieve a quiz with questions 29ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— Course Quiz System (Integration) > should calculate score and pass/fail for a submission 8ms
     â†’ expected 401 to be 200 // Object.is equality
   âœ“ Course Quiz System (Integration) > should return quizzes within a Course collection 31ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 2 â¯â¯â¯â¯â¯â¯â¯

 FAIL  test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 â¯ test/integration/quizzes.integration.test.ts:58:28
     56| 
     57|         const data = await res.json() as any;
     58|         expect(res.status).toBe(200);
       |                            ^
     59|         expect(data.id).toBeDefined();
     60| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯

 FAIL  test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 â¯ test/integration/quizzes.integration.test.ts:130:28
    128| 
    129|         const result = await res.json() as any;
    130|         expect(res.status).toBe(200);
       |                            ^
    131|         expect(result.score).toBe(50);
    132|         expect(result.passed).toBe(true);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯


 Test Files  1 failed (1)
      Tests  2 failed | 1 passed (3)
   Start at  08:56:28
   Duration  11.21s (transform 1.20s, setup 74ms, collect 4.54s, tests 126ms, environment 1ms, prepare 559ms)

[vpw:debug] Shutting down runtimes...
npm error Lifecycle script `test:integration` failed with error:
npm error code 1
npm error path /Users/slichti/GitHub/studio-platform-dev/packages/api
npm error workspace api@0.0.0
npm error location /Users/slichti/GitHub/studio-platform-dev/packages/api
npm error command failed
npm error command sh -c vitest --config vitest.config.integration.ts test/integration/quizzes.integration.test.ts --run
