
> api@0.0.0 test:integration
> vitest --config vitest.config.integration.ts test/integration/quizzes.integration.test.ts --run


 RUN  v3.2.4 /Users/slichti/GitHub/studio-platform-dev/packages/api

Using vars defined in .dev.vars
[vpw:debug] Adding `enable_nodejs_tty_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_fs_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_http_modules` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:debug] Adding `enable_nodejs_perf_hooks_module` compatibility flag during tests as this feature is needed to support the Vitest runner.
[vpw:info] Starting isolated runtimes for vitest.config.integration.ts...
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rrule.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/dateutil.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/helpers.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/weekday.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterresult.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/callbackiterresult.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/totext.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/i18n.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/nlp/parsetext.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/types.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/parseoptions.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/datetime.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/parsestring.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/optionstostring.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/datewithzone.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/cache.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iter/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/index.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/yearinfo.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/masks.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/monthinfo.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterinfo/easter.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iter/poslist.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rruleset.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/iterset.js" points to missing source files
Sourcemap for "/Users/slichti/GitHub/studio-platform-dev/node_modules/rrule/dist/esm/rrulestr.js" points to missing source files
stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
<-- POST /quizzes

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[AUTH] POST http://localhost/quizzes - Auth: None
[AUTH] POST http://localhost/quizzes - Auth: None
[TenantMiddleware DEBUG] Path: /quizzes, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[DEBUG] TenantMiddleware: User admin_user found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[TenantMiddleware DEBUG] Path: /quizzes, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[DEBUG] TenantMiddleware: User admin_user found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
--> POST /quizzes [32m200[0m 26ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
{"timestamp":"2026-02-19T14:00:07.860Z","level":"info","message":"Request completed: POST /quizzes","traceId":"25321fb9-7262-4ef1-9e3b-6169b574520c","environment":"test","userId":"admin_user","tenantId":"quiz_tenant","status":200,"durationMs":28}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
<-- GET /quizzes/q_a223f964-a653-4f04-bbfa-51431c7745dc

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[AUTH] GET http://localhost/quizzes/q_a223f964-a653-4f04-bbfa-51431c7745dc - Auth: None
[TenantMiddleware DEBUG] Path: /quizzes/q_a223f964-a653-4f04-bbfa-51431c7745dc, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
[DEBUG] TenantMiddleware: User student_1 found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
--> GET /quizzes/q_a223f964-a653-4f04-bbfa-51431c7745dc [32m200[0m 7ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should create and retrieve a quiz with questions
{"timestamp":"2026-02-19T14:00:07.869Z","level":"info","message":"Request completed: GET /quizzes/q_a223f964-a653-4f04-bbfa-51431c7745dc","traceId":"b9eff753-1fb9-4987-841d-65fac0d738d7","environment":"test","userId":"student_1","tenantId":"quiz_tenant","status":200,"durationMs":7}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
<-- POST /quizzes/q_test_1/submit

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
[AUTH] POST http://localhost/quizzes/q_test_1/submit - Auth: None
[TenantMiddleware DEBUG] Path: /quizzes/q_test_1/submit, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
[DEBUG] TenantMiddleware: User student_1 found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
--> POST /quizzes/q_test_1/submit [32m200[0m 9ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should calculate score and pass/fail for a submission
{"timestamp":"2026-02-19T14:00:07.893Z","level":"info","message":"Request completed: POST /quizzes/q_test_1/submit","traceId":"09905d03-ccdd-473a-9c66-bb6829b5581f","environment":"test","userId":"student_1","tenantId":"quiz_tenant","status":200,"durationMs":9}

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
<-- GET /classes/c_course_1/recording

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
[TenantMiddleware DEBUG] Path: /classes/c_course_1/recording, Host: localhost, Header ID: quiz_tenant, Header Slug: undefined

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
[DEBUG] TenantMiddleware: User student_1 found: YES
[DEBUG] User Role: user, isPlatformAdmin: false
[DEBUG] isPlatformAdmin resolved to: false

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
--> GET /classes/c_course_1/recording [32m200[0m 10ms

stdout | test/integration/quizzes.integration.test.ts > Course Quiz System (Integration) > should return quizzes within a Course collection
{"timestamp":"2026-02-19T14:00:07.920Z","level":"info","message":"Request completed: GET /classes/c_course_1/recording","traceId":"28b4a542-eb9f-4bd0-af9e-ed7aff73bd9b","environment":"test","userId":"student_1","tenantId":"quiz_tenant","status":200,"durationMs":11}

 âœ“ test/integration/quizzes.integration.test.ts (3 tests) 202ms

 Test Files  1 passed (1)
      Tests  3 passed (3)
   Start at  09:00:03
   Duration  4.91s (transform 855ms, setup 27ms, collect 3.22s, tests 202ms, environment 0ms, prepare 245ms)

[vpw:debug] Shutting down runtimes...
