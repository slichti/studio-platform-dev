import { jsx, jsxs, Fragment } from "react/jsx-runtime";
import { ServerRouter } from "react-router-dom";
import { isbot } from "isbot";
import { renderToReadableStream } from "react-dom/server";
import { UNSAFE_withComponentProps, useLoaderData, Meta, Links, Outlet, ScrollRestoration, Scripts, UNSAFE_withErrorBoundaryProps, useRouteError, Link, useParams, useSearchParams, useNavigate, useNavigation, NavLink, redirect, useSubmit, useRevalidator, Form, useOutletContext, useActionData, useLocation, useFetcher, useRouteLoaderData, isRouteErrorResponse } from "react-router";
import * as React from "react";
import { useState, useEffect, createContext, useContext, useRef, useCallback, Fragment as Fragment$1, useMemo } from "react";
import { ClerkProvider, useUser, SignedIn, UserButton, SignedOut, RedirectToSignIn, useClerk, useAuth, SignIn, SignUp } from "@clerk/react-router";
import { rootAuthLoader, getAuth } from "@clerk/react-router/server";
import { Toaster, toast } from "sonner";
import { Render, Puck } from "@measured/puck";
import DOMPurify from "isomorphic-dompurify";
import { X, MessageCircle, Send, Edit2, Sun, Moon, HelpCircle, Check, Minus, MessageSquare, Loader2, Search, User, Dumbbell, ShoppingCart, ChevronDown, ChevronRight, Users, LogOut, LayoutDashboard, Calendar, Clock, CheckCircle2, Trophy, RefreshCw, FileSignature, Image as Image$1, CreditCard, Package, Ticket, ListTodo, Mail, Award, DollarSign, Tag, Code, Smartphone, QrCode, Terminal, Database, Settings, BarChart3, CircleHelp, AlertTriangle, ArrowLeft, Plus, GripVertical, Trash2, Eye, Save, Gift, Link as Link$1, MoreHorizontal, History, Ban, ChevronUp, CheckCircle, XCircle, AlertCircle, Upload, Film, Folder, Info, Globe, FileText, EyeOff, ChevronLeft, Flame, Medal, Target, Star, Home, Repeat, Video, Download, Trash, Bold, Italic, Type, List, Unlink, Zap, Sparkles, Pencil, Bell, Pause, Play, Copy, Share2, Shield, MapPin, Building, Phone, Edit, ShoppingBag, ShieldCheck, ExternalLink, CornerDownRight, Camera, Circle, UserPlus, StickyNote, ArchiveRestore, Archive, Baby, Calculator, FolderOpen, TrendingUp, ArrowRight, Activity, Filter, Box, Wifi, Building2, Layout as Layout$1, Layers, Server, CalendarClock, Cake, MessagesSquare, CheckSquare, Square, Monitor, MonitorPlay, Menu as Menu$1, Book, GraduationCap, Palette } from "lucide-react";
import { Menu, Transition, Dialog as Dialog$1, TransitionChild, DialogPanel, DialogTitle as DialogTitle$1, Switch as Switch$1 } from "@headlessui/react";
/* empty css                            */
import { format, startOfWeek as startOfWeek$1, addDays, isSameDay } from "date-fns";
import Cropper from "react-easy-crop";
import { useEditor, EditorContent } from "@tiptap/react";
import StarterKit from "@tiptap/starter-kit";
import Link$2 from "@tiptap/extension-link";
import Image$2 from "@tiptap/extension-image";
import Placeholder from "@tiptap/extension-placeholder";
import { loadStripe } from "@stripe/stripe-js";
import { EmbeddedCheckoutProvider, EmbeddedCheckout } from "@stripe/react-stripe-js";
import { dateFnsLocalizer, Calendar as Calendar$1, Views } from "react-big-calendar";
import { format as format$1 } from "date-fns/format";
import { parse } from "date-fns/parse";
import { startOfWeek } from "date-fns/startOfWeek";
import { getDay } from "date-fns/getDay";
import { enUS } from "date-fns/locale/en-US";
import QRCode from "react-qr-code";
import { LiveKitRoom, VideoConference } from "@livekit/components-react";
/* empty css                               */
import { ResponsiveContainer, LineChart, XAxis, YAxis, CartesianGrid, Tooltip, Legend, Line, AreaChart, Area, ReferenceLine, BarChart, Bar, PieChart, Pie, Cell } from "recharts";
import { loadStripeTerminal } from "@stripe/terminal-js";
async function handleRequest(request, responseStatusCode, responseHeaders, routerContext, loadContext) {
  try {
    let body = await renderToReadableStream(
      /* @__PURE__ */ jsx(ServerRouter, { context: routerContext, url: request.url }),
      {
        signal: request.signal,
        onError(error) {
          console.error("SSR Error:", error);
          responseStatusCode = 500;
        }
      }
    );
    if (isbot(request.headers.get("user-agent") || "")) {
      await body.allReady;
    }
    responseHeaders.set("Content-Type", "text/html");
    responseHeaders.set("Cache-Control", "no-cache, no-store, must-revalidate");
    const csp = [
      "default-src 'self'",
      "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.stripe.com https://*.cloudflare.com https://static.cloudflareinsights.com https://challenges.cloudflare.com https://*.clerk.accounts.dev https://*.clerk.com",
      "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://rsms.me",
      "font-src 'self' https://fonts.gstatic.com https://rsms.me",
      "img-src 'self' data: https: blob:",
      // Allow external images (R2, User Content)
      "connect-src 'self' https: wss:",
      // Allow API & WebSocket connections
      "frame-src 'self' https://*.stripe.com https://*.youtube.com https://*.vimeo.com https://challenges.cloudflare.com https://*.clerk.accounts.dev https://*.clerk.com",
      // Embeds + Turnstile + Clerk
      "worker-src 'self' blob:",
      // Allow Clerk Web Workers
      "base-uri 'self'",
      "form-action 'self'"
    ].join("; ");
    responseHeaders.set("Content-Security-Policy", csp);
    return new Response(body, {
      headers: responseHeaders,
      status: responseStatusCode
    });
  } catch (e) {
    if (e instanceof Response) {
      return e;
    }
    console.error("CRITICAL WORKER CRASH:", e);
    return new Response(`
            <h1>ðŸ”¥ Critical Worker Crash ðŸ”¥</h1>
            <p>${e.message}</p>
            <pre>${e.stack}</pre>
            <hr>
            <p>Environment: ${JSON.stringify(Object.keys(loadContext.context?.env || {}))}</p>
        `, {
      status: 200,
      // Return 200 to show the error page
      headers: { "Content-Type": "text/html" }
    });
  }
}
const entryServer = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: handleRequest
}, Symbol.toStringTag, { value: "Module" }));
const initialState = {
  theme: "system",
  setTheme: () => null
};
const ThemeProviderContext = createContext(initialState);
function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme"
}) {
  const [theme, setTheme] = useState(defaultTheme);
  useEffect(() => {
    const savedTheme = localStorage.getItem(storageKey);
    if (savedTheme) {
      setTheme(savedTheme);
    }
  }, [storageKey]);
  useEffect(() => {
    const root2 = window.document.documentElement;
    root2.classList.remove("light", "dark");
    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      root2.classList.add(systemTheme);
      return;
    }
    root2.classList.add(theme);
  }, [theme]);
  const value = {
    theme,
    setTheme: (theme2) => {
      localStorage.setItem(storageKey, theme2);
      setTheme(theme2);
    }
  };
  return /* @__PURE__ */ jsx(ThemeProviderContext.Provider, { value, children });
}
const useTheme = () => {
  const context = useContext(ThemeProviderContext);
  if (context === void 0)
    throw new Error("useTheme must be used within a ThemeProvider");
  return context;
};
const styles = "/assets/index-DLKt-ilr.css";
const links = () => [{
  rel: "stylesheet",
  href: "https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
}, {
  rel: "stylesheet",
  href: styles
}, {
  rel: "manifest",
  href: "/manifest.json"
}, {
  rel: "icon",
  href: "/favicon.ico",
  type: "image/x-icon"
}];
const meta$5 = () => [{
  title: "Studio Platform"
}, {
  name: "viewport",
  content: "width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
}, {
  name: "theme-color",
  content: "#18181B"
}, {
  name: "mobile-web-app-capable",
  content: "yes"
}, {
  name: "apple-mobile-web-app-status-bar-style",
  content: "black-translucent"
}];
async function loader$1m(args) {
  try {
    return await rootAuthLoader(args, ({
      request
    }) => {
      return {
        message: "Auth Loaded"
      };
    });
  } catch (e) {
    if (e instanceof Response) {
      throw e;
    }
    console.error("DEBUG: rootAuthLoader CRASHED", e);
    throw new Response(`Root Auth Crash: ${e.message}`, {
      status: 500
    });
  }
}
const root = UNSAFE_withComponentProps(function App() {
  const loaderData = useLoaderData();
  useEffect(() => {
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (const registration of registrations) {
          registration.unregister();
          console.log("SW unregistered");
        }
      });
    }
  }, []);
  return /* @__PURE__ */ jsx(ClerkProvider, {
    loaderData,
    signUpFallbackRedirectUrl: "/",
    signInFallbackRedirectUrl: "/dashboard",
    children: /* @__PURE__ */ jsx(ThemeProvider, {
      defaultTheme: "light",
      storageKey: "studio-theme",
      children: /* @__PURE__ */ jsxs("html", {
        lang: "en",
        suppressHydrationWarning: true,
        children: [/* @__PURE__ */ jsxs("head", {
          children: [/* @__PURE__ */ jsx("meta", {
            charSet: "utf-8"
          }), /* @__PURE__ */ jsx(Meta, {}), /* @__PURE__ */ jsx(Links, {}), loaderData?.env?.VITE_GA_ID && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx("script", {
              async: true,
              src: `https://www.googletagmanager.com/gtag/js?id=${loaderData.env.VITE_GA_ID}`
            }), /* @__PURE__ */ jsx("script", {
              dangerouslySetInnerHTML: {
                __html: `
                                    window.dataLayer = window.dataLayer || [];
                                    function gtag(){dataLayer.push(arguments);}
                                    gtag('js', new Date());
                                    gtag('config', '${loaderData.env.VITE_GA_ID}');
                                `
              }
            })]
          }), /* @__PURE__ */ jsx("script", {
            dangerouslySetInnerHTML: {
              __html: `
                            if ('serviceWorker' in navigator && !sessionStorage.getItem('sw_killed_v3')) {
                                navigator.serviceWorker.getRegistrations().then(registrations => {
                                    if (registrations.length > 0) {
                                        for (let r of registrations) r.unregister();
                                        sessionStorage.setItem('sw_killed_v3', 'true');
                                        window.location.reload();
                                    }
                                });
                            }
                        `
            }
          })]
        }), /* @__PURE__ */ jsxs("body", {
          className: "min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-50 font-sans antialiased selection:bg-blue-100 dark:selection:bg-blue-900",
          suppressHydrationWarning: true,
          children: [/* @__PURE__ */ jsx(Outlet, {}), /* @__PURE__ */ jsx(Toaster, {
            position: "top-right",
            richColors: true
          }), /* @__PURE__ */ jsx(ScrollRestoration, {}), /* @__PURE__ */ jsx(Scripts, {})]
        })]
      })
    })
  });
});
const ErrorBoundary$1 = UNSAFE_withErrorBoundaryProps(function ErrorBoundary() {
  const error = useRouteError();
  console.error(error);
  return /* @__PURE__ */ jsxs("html", {
    lang: "en",
    children: [/* @__PURE__ */ jsxs("head", {
      children: [/* @__PURE__ */ jsx("title", {
        children: "Oh no!"
      }), /* @__PURE__ */ jsx(Meta, {}), /* @__PURE__ */ jsx(Links, {})]
    }), /* @__PURE__ */ jsxs("body", {
      style: {
        padding: "20px",
        fontFamily: "system-ui"
      },
      children: [/* @__PURE__ */ jsx("h1", {
        children: "App Error"
      }), /* @__PURE__ */ jsx("pre", {
        children: error instanceof Error ? error.message : JSON.stringify(error)
      }), /* @__PURE__ */ jsx(Scripts, {})]
    })]
  });
});
const route0 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  ErrorBoundary: ErrorBoundary$1,
  default: root,
  links,
  loader: loader$1m,
  meta: meta$5
}, Symbol.toStringTag, { value: "Module" }));
const Hero = ({ title, subtitle, ctaText, ctaLink, backgroundImage }) => /* @__PURE__ */ jsx(
  "section",
  {
    className: "relative py-20 px-8 text-center bg-gradient-to-br from-blue-600 to-purple-700 text-white",
    style: backgroundImage ? { backgroundImage: `url(${backgroundImage})`, backgroundSize: "cover" } : {},
    children: /* @__PURE__ */ jsxs("div", { className: "max-w-4xl mx-auto", children: [
      /* @__PURE__ */ jsx("h1", { className: "text-4xl md:text-6xl font-bold mb-4", children: title || "Welcome to Our Studio" }),
      /* @__PURE__ */ jsx("p", { className: "text-xl md:text-2xl opacity-90 mb-8", children: subtitle || "Your journey starts here" }),
      ctaText && /* @__PURE__ */ jsx("a", { href: ctaLink || "#", className: "inline-block bg-white text-blue-600 px-8 py-3 rounded-full font-semibold hover:bg-blue-50 transition", children: ctaText })
    ] })
  }
);
const TextBlock = ({ content, alignment }) => /* @__PURE__ */ jsx("section", { className: "py-12 px-8", children: /* @__PURE__ */ jsx("div", { className: `max-w-3xl mx-auto prose prose-lg ${alignment === "center" ? "text-center" : ""}`, children: /* @__PURE__ */ jsx("div", { dangerouslySetInnerHTML: { __html: DOMPurify.sanitize(content || "<p>Add your content here...</p>") } }) }) });
const FeatureGrid = ({ features }) => /* @__PURE__ */ jsx("section", { className: "py-16 px-8 bg-zinc-50", children: /* @__PURE__ */ jsx("div", { className: "max-w-6xl mx-auto grid md:grid-cols-3 gap-8", children: (features || [{ icon: "â­", title: "Feature 1", description: "Description here" }]).map((f, i) => /* @__PURE__ */ jsxs("div", { className: "bg-white p-6 rounded-xl shadow-sm text-center", children: [
  /* @__PURE__ */ jsx("div", { className: "text-4xl mb-4", children: f.icon }),
  /* @__PURE__ */ jsx("h3", { className: "text-xl font-semibold mb-2", children: f.title }),
  /* @__PURE__ */ jsx("p", { className: "text-zinc-600", children: f.description })
] }, i)) }) });
const ClassSchedule = ({ title, showDays, tenantSlug }) => /* @__PURE__ */ jsx("section", { className: "py-16 px-8", children: /* @__PURE__ */ jsxs("div", { className: "max-w-6xl mx-auto", children: [
  /* @__PURE__ */ jsx("h2", { className: "text-3xl font-bold text-center mb-8", children: title || "Our Schedule" }),
  /* @__PURE__ */ jsxs("div", { className: "bg-zinc-100 rounded-xl p-8 text-center", children: [
    /* @__PURE__ */ jsx("p", { className: "text-zinc-600", children: "Schedule will be dynamically loaded from your studio data." }),
    /* @__PURE__ */ jsxs("p", { className: "text-sm text-zinc-400 mt-2", children: [
      "Showing next ",
      showDays || 7,
      " days"
    ] })
  ] })
] }) });
const InstructorGrid = ({ title }) => /* @__PURE__ */ jsx("section", { className: "py-16 px-8 bg-zinc-50", children: /* @__PURE__ */ jsxs("div", { className: "max-w-6xl mx-auto", children: [
  /* @__PURE__ */ jsx("h2", { className: "text-3xl font-bold text-center mb-8", children: title || "Meet Our Instructors" }),
  /* @__PURE__ */ jsx("div", { className: "grid md:grid-cols-4 gap-6", children: [1, 2, 3, 4].map((i) => /* @__PURE__ */ jsxs("div", { className: "bg-white rounded-xl overflow-hidden shadow-sm", children: [
    /* @__PURE__ */ jsx("div", { className: "aspect-square bg-zinc-200" }),
    /* @__PURE__ */ jsxs("div", { className: "p-4 text-center", children: [
      /* @__PURE__ */ jsx("h4", { className: "font-semibold", children: "Instructor Name" }),
      /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-600", children: "Specialty" })
    ] })
  ] }, i)) }),
  /* @__PURE__ */ jsx("p", { className: "text-center text-sm text-zinc-400 mt-4", children: "Instructor data loaded from your studio." })
] }) });
const Testimonials = ({ testimonials }) => /* @__PURE__ */ jsx("section", { className: "py-16 px-8", children: /* @__PURE__ */ jsxs("div", { className: "max-w-4xl mx-auto", children: [
  /* @__PURE__ */ jsx("h2", { className: "text-3xl font-bold text-center mb-12", children: "What Our Students Say" }),
  /* @__PURE__ */ jsx("div", { className: "space-y-8", children: (testimonials || [{ quote: "Amazing experience!", author: "Happy Student" }]).map((t, i) => /* @__PURE__ */ jsxs("blockquote", { className: "bg-zinc-50 p-8 rounded-xl", children: [
    /* @__PURE__ */ jsxs("p", { className: "text-xl italic text-zinc-700 mb-4", children: [
      '"',
      t.quote,
      '"'
    ] }),
    /* @__PURE__ */ jsxs("footer", { className: "text-zinc-600 font-medium", children: [
      "â€” ",
      t.author
    ] })
  ] }, i)) })
] }) });
const ContactForm = ({ title, email }) => /* @__PURE__ */ jsx("section", { className: "py-16 px-8 bg-zinc-900 text-white", children: /* @__PURE__ */ jsxs("div", { className: "max-w-2xl mx-auto text-center", children: [
  /* @__PURE__ */ jsx("h2", { className: "text-3xl font-bold mb-4", children: title || "Get in Touch" }),
  /* @__PURE__ */ jsx("p", { className: "text-zinc-400 mb-8", children: "We'd love to hear from you!" }),
  /* @__PURE__ */ jsxs("form", { className: "space-y-4", children: [
    /* @__PURE__ */ jsx(
      "input",
      {
        type: "text",
        placeholder: "Your Name",
        className: "w-full px-4 py-3 rounded-lg bg-zinc-800 border border-zinc-700 text-white"
      }
    ),
    /* @__PURE__ */ jsx(
      "input",
      {
        type: "email",
        placeholder: "Your Email",
        className: "w-full px-4 py-3 rounded-lg bg-zinc-800 border border-zinc-700 text-white"
      }
    ),
    /* @__PURE__ */ jsx(
      "textarea",
      {
        placeholder: "Your Message",
        rows: 4,
        className: "w-full px-4 py-3 rounded-lg bg-zinc-800 border border-zinc-700 text-white"
      }
    ),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "submit",
        className: "w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition",
        children: "Send Message"
      }
    )
  ] })
] }) });
const MapSection = ({ title, address }) => {
  const encodedAddress = encodeURIComponent(address || "New York, NY");
  return /* @__PURE__ */ jsx("section", { className: "py-16 px-8", children: /* @__PURE__ */ jsxs("div", { className: "max-w-6xl mx-auto", children: [
    /* @__PURE__ */ jsx("h2", { className: "text-3xl font-bold text-center mb-8", children: title || "Find Us" }),
    /* @__PURE__ */ jsx("div", { className: "aspect-video bg-zinc-200 rounded-xl overflow-hidden shadow-sm", children: /* @__PURE__ */ jsx(
      "iframe",
      {
        width: "100%",
        height: "100%",
        frameBorder: "0",
        scrolling: "no",
        marginHeight: 0,
        marginWidth: 0,
        src: `https://maps.google.com/maps?q=${encodedAddress}&t=&z=13&ie=UTF8&iwloc=&output=embed`,
        title: "Location Map",
        className: "w-full h-full"
      }
    ) }),
    address && /* @__PURE__ */ jsx("p", { className: "text-center mt-4 text-zinc-600", children: address })
  ] }) });
};
const puckConfig = {
  root: {
    fields: {
      title: { type: "text", label: "Page Title" },
      // Useful to edit title inline too
      chatEnabled: {
        type: "radio",
        label: "Chat Widget",
        options: [
          { label: "Enabled", value: true },
          { label: "Disabled", value: false }
        ]
      }
    },
    defaultProps: {
      title: "New Page",
      chatEnabled: true
    }
  },
  components: {
    Hero: {
      label: "Hero Section",
      fields: {
        title: { type: "text" },
        subtitle: { type: "text" },
        ctaText: { type: "text", label: "Button Text" },
        ctaLink: { type: "text", label: "Button Link" },
        backgroundImage: { type: "text", label: "Background Image URL" }
      },
      defaultProps: {
        title: "Welcome to Our Studio",
        subtitle: "Your wellness journey starts here",
        ctaText: "Book a Class",
        ctaLink: "/schedule"
      },
      render: Hero
    },
    TextBlock: {
      label: "Text Block",
      fields: {
        content: { type: "textarea" },
        alignment: { type: "select", options: [{ label: "Left", value: "left" }, { label: "Center", value: "center" }] }
      },
      defaultProps: {
        content: "<p>Add your content here...</p>",
        alignment: "left"
      },
      render: TextBlock
    },
    FeatureGrid: {
      label: "Feature Grid",
      fields: {
        features: {
          type: "array",
          arrayFields: {
            icon: { type: "text" },
            title: { type: "text" },
            description: { type: "textarea" }
          }
        }
      },
      defaultProps: {
        features: [
          { icon: "ðŸ§˜", title: "Expert Instructors", description: "Learn from certified professionals" },
          { icon: "ðŸ“…", title: "Flexible Schedule", description: "Classes available 7 days a week" },
          { icon: "ðŸ†", title: "Results Driven", description: "Achieve your wellness goals" }
        ]
      },
      render: FeatureGrid
    },
    ClassSchedule: {
      label: "Class Schedule",
      fields: {
        title: { type: "text" },
        showDays: { type: "number", label: "Days to Show" }
      },
      defaultProps: {
        title: "Upcoming Classes",
        showDays: 7
      },
      render: ClassSchedule
    },
    InstructorGrid: {
      label: "Instructor Grid",
      fields: {
        title: { type: "text" }
      },
      defaultProps: {
        title: "Meet Our Team"
      },
      render: InstructorGrid
    },
    Testimonials: {
      label: "Testimonials",
      fields: {
        testimonials: {
          type: "array",
          arrayFields: {
            quote: { type: "textarea" },
            author: { type: "text" }
          }
        }
      },
      defaultProps: {
        testimonials: [
          { quote: "This studio changed my life!", author: "Happy Student" }
        ]
      },
      render: Testimonials
    },
    ContactForm: {
      label: "Contact Form",
      fields: {
        title: { type: "text" },
        email: { type: "text", label: "Recipient Email" }
      },
      defaultProps: {
        title: "Get in Touch"
      },
      render: ContactForm
    },
    MapSection: {
      label: "Map/Location",
      fields: {
        title: { type: "text" },
        address: { type: "text" }
      },
      defaultProps: {
        title: "Visit Us",
        address: "123 Studio Street, City, State"
      },
      render: MapSection
    }
  }
};
const API_URL$1 = /* @__PURE__ */ (() => {
  return "https://studio-platform-api.slichti.workers.dev";
})();
async function apiRequest(path, token, options = {}, baseUrl) {
  const url = baseUrl || API_URL$1;
  const safeHeaders = {};
  if (options.headers) {
    if (options.headers instanceof Headers || Array.isArray(options.headers)) {
      options.headers.forEach((v, k) => safeHeaders[k] = v);
    } else {
      Object.entries(options.headers).forEach(([k, v]) => {
        if (v !== void 0 && v !== null) {
          safeHeaders[k] = String(v);
        }
      });
    }
  }
  const headers = new Headers(safeHeaders);
  if (token) {
    headers.set("Authorization", `Bearer ${token}`);
  }
  if (typeof window !== "undefined") {
    const impersonationToken = localStorage.getItem("impersonation_token");
    if (impersonationToken) {
      headers.set("Authorization", `Bearer ${impersonationToken}`);
    }
  }
  if (!headers.has("Content-Type") && !(options.body instanceof FormData)) {
    headers.set("Content-Type", "application/json");
  }
  if (!headers.has("x-request-id")) {
    headers.set("x-request-id", crypto.randomUUID());
  }
  const res = await fetch(`${url}${path}`, {
    ...options,
    headers
  });
  if (!res.ok) {
    let errorData;
    try {
      errorData = await res.clone().json();
      const error = new Error(errorData.error || res.statusText);
      error.data = errorData;
      error.status = res.status;
      throw error;
    } catch (e) {
      if (e.data) throw e;
      const errorText = await res.text();
      throw new Error(errorText || res.statusText);
    }
  }
  return res.json();
}
function ChatWidget({ roomId, tenantId, userId, userName, apiUrl = "", enabled = true, chatConfig }) {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [inputValue, setInputValue] = useState("");
  const [connected, setConnected] = useState(false);
  const [users, setUsers] = useState([]);
  const wsRef = useRef(null);
  const messagesEndRef = useRef(null);
  const isOpenRef = useRef(isOpen);
  useEffect(() => {
    isOpenRef.current = isOpen;
  }, [isOpen]);
  const [guestId] = useState(() => `guest_${Math.random().toString(36).substr(2, 9)}`);
  const effectiveUserId = userId || guestId;
  const effectiveUserName = userName || "Guest";
  const scrollToBottom = useCallback(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, []);
  useEffect(() => {
    scrollToBottom();
  }, [messages, scrollToBottom]);
  useEffect(() => {
    if (connected) return;
    const baseUrl = apiUrl || (typeof window !== "undefined" ? window.location.origin : "");
    const wsProtocol = baseUrl.startsWith("https") ? "wss://" : "ws://";
    const wsHost = baseUrl.replace(/^http(s)?:\/\//, "");
    const wsUrl = `${wsProtocol}${wsHost}/api/chat/rooms/${roomId}/websocket?roomId=${roomId}&tenantId=${tenantId}&userId=${effectiveUserId}&userName=${encodeURIComponent(effectiveUserName)}`;
    const ws = new WebSocket(wsUrl);
    wsRef.current = ws;
    ws.onopen = () => {
      setConnected(true);
      console.log("[Chat] Connected");
    };
    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        switch (data.type) {
          case "history":
            setMessages(data.messages || []);
            break;
          case "message":
            setMessages((prev) => [...prev, data]);
            if (!isOpenRef.current && data.userId !== effectiveUserId) {
              setUnreadCount((prev) => prev + 1);
            }
            break;
          case "user_list":
            setUsers(data.users || []);
            break;
          case "user_joined":
            setUsers((prev) => [...prev, { userId: data.userId, userName: data.userName }]);
            break;
          case "user_left":
            setUsers((prev) => prev.filter((u) => u.userId !== data.userId));
            break;
        }
      } catch (e) {
        console.error("[Chat] Parse error:", e);
      }
    };
    ws.onclose = () => {
      setConnected(false);
      console.log("[Chat] Disconnected");
    };
    ws.onerror = (e) => {
      console.error("[Chat] Error:", e);
    };
    return () => {
      ws.close();
      wsRef.current = null;
    };
  }, [roomId, tenantId, userId, userName, apiUrl]);
  const sendMessage = () => {
    if (!inputValue.trim() || !wsRef.current || wsRef.current.readyState !== WebSocket.OPEN) return;
    wsRef.current.send(JSON.stringify({
      type: "message",
      content: inputValue.trim()
    }));
    setInputValue("");
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };
  const [unreadCount, setUnreadCount] = useState(0);
  const defaultInstantAnswers = [
    "I have a question",
    "Contact support",
    "Billing inquiry"
  ];
  const sendInstantAnswer = (answer, routeToRole) => {
    if (!wsRef.current || wsRef.current.readyState !== WebSocket.OPEN) return;
    wsRef.current.send(JSON.stringify({
      type: "message",
      content: answer,
      metadata: routeToRole ? { routedRole: routeToRole } : void 0
    }));
  };
  if (!enabled) return null;
  return /* @__PURE__ */ jsxs(Fragment, { children: [
    /* @__PURE__ */ jsxs(
      "button",
      {
        onClick: () => {
          setIsOpen(!isOpen);
          if (!isOpen) setUnreadCount(0);
        },
        className: "fixed bottom-6 right-6 w-14 h-14 bg-[#2563EB] text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",
        children: [
          isOpen ? /* @__PURE__ */ jsx(X, { size: 24 }) : /* @__PURE__ */ jsx(MessageCircle, { size: 24 }),
          unreadCount > 0 && !isOpen && /* @__PURE__ */ jsx("span", { className: "absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white", children: unreadCount })
        ]
      }
    ),
    isOpen && /* @__PURE__ */ jsxs("div", { className: "fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans", children: [
      /* @__PURE__ */ jsxs("div", { className: "bg-[#2563EB] text-white px-6 py-6 pb-12 relative overflow-hidden", children: [
        /* @__PURE__ */ jsxs("div", { className: "relative z-10", children: [
          /* @__PURE__ */ jsx("h2", { className: "text-xl font-bold mb-2", children: "Chat with us" }),
          /* @__PURE__ */ jsx("p", { className: "text-white/90 text-sm leading-relaxed", children: "ðŸ‘‹ Hi, message us with any questions. We're happy to help!" })
        ] }),
        /* @__PURE__ */ jsx("div", { className: "absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full" }),
        /* @__PURE__ */ jsx("div", { className: "absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full" })
      ] }),
      /* @__PURE__ */ jsx("div", { className: "flex-1 overflow-y-auto bg-white flex flex-col", children: /* @__PURE__ */ jsxs("div", { className: "mt-auto p-4 space-y-4", children: [
        messages.map((msg) => /* @__PURE__ */ jsx(
          "div",
          {
            className: `flex ${msg.userId === userId ? "justify-end" : "justify-start"}`,
            children: /* @__PURE__ */ jsx(
              "div",
              {
                className: `max-w-[85%] p-3 rounded-2xl text-sm ${msg.userId === userId ? "bg-[#2563EB] text-white rounded-br-sm" : "bg-gray-100 text-zinc-900 rounded-bl-sm"}`,
                children: /* @__PURE__ */ jsx("p", { children: msg.content })
              }
            )
          },
          msg.id
        )),
        messages.length === 0 && /* @__PURE__ */ jsxs("div", { className: "space-y-2 mt-4", children: [
          /* @__PURE__ */ jsx("p", { className: "text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide", children: "How can we help?" }),
          (chatConfig && chatConfig.length > 0 ? chatConfig : defaultInstantAnswers.map((a) => ({ id: a, label: a, type: "action" }))).map((option) => /* @__PURE__ */ jsx(
            "button",
            {
              onClick: () => sendInstantAnswer(option.label, option.routeToRole),
              disabled: !connected,
              className: "w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",
              children: option.label
            },
            option.id || option.label
          ))
        ] }),
        /* @__PURE__ */ jsx("div", { ref: messagesEndRef })
      ] }) }),
      /* @__PURE__ */ jsxs("div", { className: "p-4 border-t border-zinc-100 bg-white", children: [
        /* @__PURE__ */ jsxs("div", { className: "relative flex items-center", children: [
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "text",
              value: inputValue,
              onChange: (e) => setInputValue(e.target.value),
              onKeyPress: handleKeyPress,
              placeholder: "Write message",
              className: "w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",
              disabled: !connected
            }
          ),
          /* @__PURE__ */ jsx(
            "button",
            {
              onClick: sendMessage,
              disabled: !connected || !inputValue.trim(),
              className: "absolute right-2 p-2 text-zinc-400 hover:text-[#2563EB] transition-colors disabled:opacity-50",
              children: /* @__PURE__ */ jsx(Send, { size: 20 })
            }
          )
        ] }),
        !connected && /* @__PURE__ */ jsx("div", { className: "text-center mt-2", children: /* @__PURE__ */ jsx("span", { className: "text-[10px] text-zinc-400", children: "Connecting to support..." }) })
      ] })
    ] })
  ] });
}
const meta$4 = ({
  data
}) => {
  if (!data?.page) {
    return [{
      title: "Page Not Found"
    }];
  }
  return [{
    title: data.page.seoTitle || data.page.title
  }, {
    name: "description",
    content: data.page.seoDescription || ""
  }];
};
const loader$1l = async ({
  params
}) => {
  const {
    slug,
    pageSlug
  } = params;
  try {
    const page = await apiRequest(`/website/public/pages/${pageSlug}`, null, {
      headers: {
        "X-Tenant-Slug": slug || ""
      }
    });
    return {
      page,
      tenantSlug: slug
    };
  } catch (e) {
    console.error("Failed to load page:", e);
    throw new Response("Page Not Found", {
      status: 404
    });
  }
};
const site_$slug_$pageSlug = UNSAFE_withComponentProps(function WebsitePage() {
  const {
    page,
    tenantSlug
  } = useLoaderData();
  const {
    user
  } = useUser();
  user?.publicMetadata?.isPlatformAdmin || true;
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-white relative",
    children: [/* @__PURE__ */ jsx(Render, {
      config: puckConfig,
      data: page.content
    }), /* @__PURE__ */ jsx(ChatWidget, {
      roomId: user ? `support-${user.id}` : "support-guest",
      tenantId: tenantSlug || "",
      userId: user?.id,
      userName: user?.fullName || "Guest",
      enabled: page.tenantSettings?.chatEnabled !== false && page.content?.root?.props?.chatEnabled !== false,
      chatConfig: page.tenantSettings?.chatConfig
    }), /* @__PURE__ */ jsx(SignedIn, {
      children: /* @__PURE__ */ jsx("div", {
        className: "fixed bottom-6 left-6 z-50",
        children: /* @__PURE__ */ jsxs(Link, {
          to: `/studio/${tenantSlug}/website/editor/${page.id}`,
          className: "flex items-center gap-2 bg-zinc-900 text-white px-4 py-2.5 rounded-full shadow-lg hover:bg-zinc-800 transition-transform hover:scale-105",
          children: [/* @__PURE__ */ jsx(Edit2, {
            size: 16
          }), /* @__PURE__ */ jsx("span", {
            className: "font-medium text-sm",
            children: "Edit Page"
          })]
        })
      })
    })]
  });
});
const route1 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: site_$slug_$pageSlug,
  loader: loader$1l,
  meta: meta$4
}, Symbol.toStringTag, { value: "Module" }));
function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  return /* @__PURE__ */ jsx(
    "button",
    {
      onClick: () => setTheme(theme === "light" ? "dark" : "light"),
      className: "p-2 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors text-zinc-600 dark:text-zinc-400",
      "aria-label": "Toggle theme",
      children: /* @__PURE__ */ jsxs("div", { className: "relative w-5 h-5", children: [
        /* @__PURE__ */ jsx(Sun, { className: "h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 absolute top-0 left-0" }),
        /* @__PURE__ */ jsx(Moon, { className: "h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 absolute top-0 left-0" })
      ] })
    }
  );
}
const meta$3 = () => {
  return [{
    title: "Compare Plans - Studio Platform"
  }, {
    name: "description",
    content: "Detailed comparison of Studio Platform features and limits."
  }];
};
const FEATURES = [{
  category: "Operations",
  items: [{
    name: "Staff Members",
    launch: "5",
    growth: "15",
    scale: "Unlimited"
  }, {
    name: "Locations",
    launch: "1",
    growth: "3",
    scale: "Unlimited"
  }, {
    name: "Student Profiles",
    launch: "Unlimited",
    growth: "Unlimited",
    scale: "Unlimited"
  }, {
    name: "Waiver Management",
    launch: true,
    growth: true,
    scale: true
  }, {
    name: "Payroll Reporting",
    launch: "Basic",
    growth: "Advanced",
    scale: "Custom"
  }, {
    name: "No-Show Automation",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "Waitlist Automation",
    launch: false,
    growth: true,
    scale: true
  }]
}, {
  category: "Commerce",
  items: [{
    name: "Platform Fee",
    launch: "5%",
    growth: "1.5%",
    scale: "0%"
  }, {
    name: "Credit Card Processing",
    launch: "2.9% + 30Â¢",
    growth: "2.9% + 30Â¢",
    scale: "2.9% + 30Â¢"
  }, {
    name: "Class Packs & Drop-ins",
    launch: true,
    growth: true,
    scale: true
  }, {
    name: "Recurring Memberships",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "Discount Codes",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "Gift Cards",
    launch: false,
    growth: true,
    scale: true
  }]
}, {
  category: "Digital Studio",
  items: [{
    name: "Zoom Integration",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "Video Storage",
    launch: "5 GB",
    growth: "50 GB",
    scale: "1 TB"
  }, {
    name: "On-Demand Library",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "4K Streaming",
    launch: false,
    growth: false,
    scale: true
  }]
}, {
  category: "Marketing & Branding",
  items: [{
    name: "Email Notifications",
    launch: "Transactional",
    growth: "Campaigns",
    scale: "White-label"
  }, {
    name: "SMS Notifications",
    launch: false,
    growth: true,
    scale: true
  }, {
    name: "Custom Domain",
    launch: false,
    growth: false,
    scale: true
  }, {
    name: "White Label Branding",
    launch: false,
    growth: false,
    scale: true
  }, {
    name: "API Access",
    launch: false,
    growth: false,
    scale: true
  }]
}];
const pricing_compare = UNSAFE_withComponentProps(function ComparePlans() {
  const {
    user
  } = useUser();
  return /* @__PURE__ */ jsxs("div", {
    className: "font-sans min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-50 transition-colors duration-300",
    children: [/* @__PURE__ */ jsxs("nav", {
      className: "flex justify-between items-center px-8 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950/80 backdrop-blur-sm sticky top-0 z-50",
      children: [/* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-3",
        children: /* @__PURE__ */ jsx(Link, {
          to: "/",
          className: "text-xl font-bold tracking-tight hover:opacity-80 transition-opacity",
          children: "ðŸ§˜ Studio Platform"
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-6",
        children: [/* @__PURE__ */ jsx(ThemeToggle, {}), /* @__PURE__ */ jsx(Link, {
          to: "/pricing",
          className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
          children: "Pricing"
        }), /* @__PURE__ */ jsx(Link, {
          to: "/admin",
          className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
          children: "Admin"
        }), /* @__PURE__ */ jsxs(SignedIn, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/dashboard",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Dashboard"
          }), /* @__PURE__ */ jsx(UserButton, {
            afterSignOutUrl: "/"
          })]
        }), /* @__PURE__ */ jsxs(SignedOut, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/sign-in",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Sign In"
          }), /* @__PURE__ */ jsx(Link, {
            to: "/sign-up",
            className: "px-4 py-2 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-md text-sm font-medium hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",
            children: "Get Started"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("main", {
      className: "py-24 px-6 max-w-7xl mx-auto",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "text-center mb-16",
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-4xl font-extrabold mb-4",
          children: "Compare Plans"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xl text-zinc-600 dark:text-zinc-400 mb-8",
          children: "Detailed feature breakdown for every stage of your business."
        }), /* @__PURE__ */ jsx(Link, {
          to: "/pricing",
          className: "text-blue-600 hover:underline",
          children: "â† Back to Pricing"
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "overflow-x-auto",
        children: /* @__PURE__ */ jsxs("table", {
          className: "w-full text-left border-collapse",
          children: [/* @__PURE__ */ jsx("thead", {
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "p-4 border-b-2 border-zinc-200 dark:border-zinc-800 w-1/4",
                children: "Feature"
              }), /* @__PURE__ */ jsxs("th", {
                className: "p-4 border-b-2 border-zinc-200 dark:border-zinc-800 w-1/4 text-center",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-bold text-xl mb-1",
                  children: "Launch"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-sm text-zinc-500",
                  children: "Free"
                })]
              }), /* @__PURE__ */ jsxs("th", {
                className: "p-4 border-b-2 border-blue-500 w-1/4 text-center bg-blue-50/50 dark:bg-blue-900/10",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-bold text-xl mb-1 text-blue-700 dark:text-blue-400",
                  children: "Growth"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-sm text-zinc-500",
                  children: "$49/mo"
                })]
              }), /* @__PURE__ */ jsxs("th", {
                className: "p-4 border-b-2 border-zinc-200 dark:border-zinc-800 w-1/4 text-center",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-bold text-xl mb-1",
                  children: "Scale"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-sm text-zinc-500",
                  children: "$129/mo"
                })]
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            children: FEATURES.map((category) => /* @__PURE__ */ jsxs(ç‰‡, {
              children: [/* @__PURE__ */ jsx("tr", {
                className: "bg-zinc-50 dark:bg-zinc-900/50",
                children: /* @__PURE__ */ jsx("td", {
                  colSpan: 4,
                  className: "p-3 font-semibold text-sm uppercase tracking-wider text-zinc-500 pl-4",
                  children: category.category
                })
              }), category.items.map((item, idx) => /* @__PURE__ */ jsxs("tr", {
                className: "border-b border-zinc-100 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",
                children: [/* @__PURE__ */ jsxs("td", {
                  className: "p-4 font-medium text-zinc-700 dark:text-zinc-300 flex items-center gap-2",
                  children: [item.name, item.name === "Platform Fee" && /* @__PURE__ */ jsxs("div", {
                    className: "group relative",
                    children: [/* @__PURE__ */ jsx(HelpCircle, {
                      className: "w-4 h-4 text-zinc-400 cursor-help"
                    }), /* @__PURE__ */ jsx("div", {
                      className: "hidden group-hover:block absolute z-10 w-64 p-2 bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs text-white bg-zinc-900 rounded shadow-lg pointer-events-none",
                      children: "A percentage of transaction volume taken by Studio Platform. Does not include Stripe processing fees."
                    })]
                  })]
                }), /* @__PURE__ */ jsx("td", {
                  className: "p-4 text-center text-zinc-600 dark:text-zinc-400",
                  children: renderValue(item.launch)
                }), /* @__PURE__ */ jsx("td", {
                  className: "p-4 text-center font-medium text-zinc-900 dark:text-zinc-100 bg-blue-50/30 dark:bg-blue-900/5",
                  children: renderValue(item.growth)
                }), /* @__PURE__ */ jsx("td", {
                  className: "p-4 text-center text-zinc-600 dark:text-zinc-400",
                  children: renderValue(item.scale)
                })]
              }, item.name))]
            }, category.category))
          }), /* @__PURE__ */ jsx("tfoot", {
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("td", {
                className: "p-4"
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4 text-center",
                children: /* @__PURE__ */ jsx(Link, {
                  to: "/sign-up",
                  className: "block w-full py-2 px-4 bg-zinc-100 hover:bg-zinc-200 dark:bg-zinc-800 dark:hover:bg-zinc-700 text-zinc-900 dark:text-white rounded-lg font-medium transition-colors",
                  children: "Get Started"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4 text-center bg-blue-50/30 dark:bg-blue-900/5",
                children: /* @__PURE__ */ jsx(Link, {
                  to: "/sign-up",
                  className: "block w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-sm",
                  children: "Start Free Trial"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4 text-center",
                children: /* @__PURE__ */ jsx(Link, {
                  to: "/sign-up",
                  className: "block w-full py-2 px-4 bg-zinc-900 hover:bg-zinc-800 dark:bg-zinc-50 dark:hover:bg-zinc-200 text-white dark:text-zinc-900 rounded-lg font-medium transition-colors",
                  children: "Start Free Trial"
                })
              })]
            })
          })]
        })
      })]
    }), /* @__PURE__ */ jsx("footer", {
      className: "py-12 px-6 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "max-w-7xl mx-auto text-center text-zinc-500 dark:text-zinc-400 text-sm",
        children: ["Â© ", (/* @__PURE__ */ new Date()).getFullYear(), " Studio Platform. All rights reserved."]
      })
    })]
  });
});
function renderValue(val) {
  if (val === true) return /* @__PURE__ */ jsx(Check, {
    className: "w-5 h-5 mx-auto text-green-500"
  });
  if (val === false) return /* @__PURE__ */ jsx(Minus, {
    className: "w-5 h-5 mx-auto text-zinc-300"
  });
  return /* @__PURE__ */ jsx("span", {
    children: val
  });
}
const ç‰‡ = ({
  children
}) => /* @__PURE__ */ jsx(Fragment, {
  children
});
const route2 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: pricing_compare,
  meta: meta$3
}, Symbol.toStringTag, { value: "Module" }));
const meta$2 = () => {
  return [{
    title: "Pricing - Studio Platform"
  }, {
    name: "description",
    content: "Simple, transparent pricing for studios of all sizes."
  }];
};
const TIERS$1 = [{
  name: "Launch",
  prices: {
    monthly: "Free",
    annual: "Free"
  },
  period: null,
  description: "Perfect for new instructors and hobbyists.",
  trial: null,
  features: ["Unlimited Students", "5 Instructors", "1 Location", "5GB Storage", "Basic Financials & Reporting", "Waiver Management", "Transactional Email Notifications", "Class Packs & Drop-ins"],
  cta: "Get Started",
  ctaLink: "/create-studio?tier=basic",
  highlight: false
}, {
  name: "Growth",
  prices: {
    monthly: "$49",
    annual: "$39"
  },
  period: "/month",
  description: "For established studios growing their community.",
  billingNote: {
    monthly: null,
    annual: "Billed $468 yearly"
  },
  trial: "14-Day Free Trial",
  features: ["Everything in Launch", "15 Instructors", "3 Locations", "50GB Storage", "Zoom Integration (Auto-Meeting)", "Video on Demand (VOD)", "Automations (No-Show Fees)", "SMS Notifications & Marketing", "Recurring Memberships"],
  cta: "Start Free Trial",
  ctaLink: "/create-studio?tier=growth",
  highlight: true
}, {
  name: "Scale",
  prices: {
    monthly: "$129",
    annual: "$99"
  },
  period: "/month",
  description: "For multi-location studios and franchises.",
  billingNote: {
    monthly: null,
    annual: "Billed $1188 yearly"
  },
  trial: "14-Day Free Trial",
  features: ["Everything in Growth", "Unlimited Instructors", "Unlimited Locations", "1TB Video Storage", "White Label Branding Options", "API Access", "Priority Support", "0% Platform Fees"],
  cta: "Start Free Trial",
  ctaLink: "/create-studio?tier=scale",
  highlight: false
}];
const pricing__index = UNSAFE_withComponentProps(function Pricing() {
  const {
    user
  } = useUser();
  const [billingInterval, setBillingInterval] = useState("monthly");
  return /* @__PURE__ */ jsxs("div", {
    className: "font-sans min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-50 transition-colors duration-300 flex flex-col",
    children: [/* @__PURE__ */ jsxs("nav", {
      className: "flex justify-between items-center px-8 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950/80 backdrop-blur-sm sticky top-0 z-50",
      children: [/* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-3",
        children: /* @__PURE__ */ jsx(Link, {
          to: "/",
          className: "text-xl font-bold tracking-tight hover:opacity-80 transition-opacity",
          children: "ðŸ§˜ Studio Platform"
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-6",
        children: [/* @__PURE__ */ jsx(ThemeToggle, {}), /* @__PURE__ */ jsx(Link, {
          to: "/pricing",
          className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
          children: "Pricing"
        }), /* @__PURE__ */ jsx(Link, {
          to: "/admin",
          className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
          children: "Admin"
        }), /* @__PURE__ */ jsxs(SignedIn, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/dashboard",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Dashboard"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3 pl-2 border-l border-zinc-200 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm text-zinc-700 dark:text-zinc-300",
              children: user?.firstName ? `Hi, ${user.firstName}` : ""
            }), /* @__PURE__ */ jsx(UserButton, {
              afterSignOutUrl: "/"
            })]
          })]
        }), /* @__PURE__ */ jsxs(SignedOut, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/sign-in",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Sign In"
          }), /* @__PURE__ */ jsx(Link, {
            to: "/sign-up",
            className: "px-4 py-2 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-md text-sm font-medium hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",
            children: "Get Started"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("main", {
      className: "flex-grow py-24 px-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "max-w-7xl mx-auto text-center mb-10",
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-4xl md:text-5xl font-extrabold mb-6 tracking-tight",
          children: "Simple, transparent pricing"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xl text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto",
          children: "Start for free and scale as you grow. No hidden fees or surprises."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex justify-center items-center gap-4 mb-16",
        children: [/* @__PURE__ */ jsx("span", {
          className: `text-sm font-medium ${billingInterval === "monthly" ? "text-zinc-900 dark:text-white" : "text-zinc-500 dark:text-zinc-400"}`,
          children: "Monthly"
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setBillingInterval((prev) => prev === "monthly" ? "annual" : "monthly"),
          className: "relative inline-flex h-8 w-14 items-center rounded-full bg-zinc-200 dark:bg-zinc-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
          children: [/* @__PURE__ */ jsx("span", {
            className: "sr-only",
            children: "Toggle billing interval"
          }), /* @__PURE__ */ jsx("span", {
            className: `${billingInterval === "annual" ? "translate-x-7" : "translate-x-1"} inline-block h-6 w-6 transform rounded-full bg-white transition shadow-sm`
          })]
        }), /* @__PURE__ */ jsxs("span", {
          className: `text-sm font-medium ${billingInterval === "annual" ? "text-zinc-900 dark:text-white" : "text-zinc-500 dark:text-zinc-400"}`,
          children: ["Annually ", /* @__PURE__ */ jsx("span", {
            className: "text-green-600 dark:text-green-400 text-xs ml-1 font-bold",
            children: "(Save ~20%)"
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",
        children: TIERS$1.map((tier) => /* @__PURE__ */ jsxs("div", {
          className: `rounded-2xl p-8 border flex flex-col ${tier.highlight ? "border-blue-500 ring-2 ring-blue-500 shadow-xl bg-white dark:bg-zinc-900 transform md:-translate-y-4" : "border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950"}`,
          children: [/* @__PURE__ */ jsxs("div", {
            className: "mb-6",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-lg font-semibold text-zinc-900 dark:text-white mb-2",
              children: tier.name
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-baseline gap-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-4xl font-bold text-zinc-900 dark:text-white",
                children: tier.prices[billingInterval]
              }), tier.period && /* @__PURE__ */ jsx("span", {
                className: "text-zinc-500 dark:text-zinc-400",
                children: tier.period
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400 mt-2",
              children: tier.description
            }), billingInterval === "annual" && tier.billingNote?.annual && /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-400 dark:text-zinc-500 mt-1",
              children: tier.billingNote.annual
            }), tier.trial && /* @__PURE__ */ jsx("div", {
              className: "mt-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",
              children: tier.trial
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "flex-grow space-y-4 mb-8",
            children: tier.features.map((feature) => /* @__PURE__ */ jsxs("div", {
              className: "flex items-start gap-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "mt-1 bg-green-100 dark:bg-green-900/30 p-1 rounded-full",
                children: /* @__PURE__ */ jsx(Check, {
                  className: "w-3 h-3 text-green-600 dark:text-green-400"
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-sm text-zinc-700 dark:text-zinc-300",
                children: feature
              })]
            }, feature))
          }), /* @__PURE__ */ jsx(Link, {
            to: `${tier.ctaLink}&interval=${billingInterval}`,
            className: `w-full py-3 px-4 rounded-lg font-medium text-center transition-colors ${tier.highlight ? "bg-blue-600 hover:bg-blue-700 text-white shadow-lg" : "bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 hover:bg-zinc-800 dark:hover:bg-zinc-200"}`,
            children: tier.cta
          })]
        }, tier.name))
      }), /* @__PURE__ */ jsx("div", {
        className: "text-center",
        children: /* @__PURE__ */ jsxs(Link, {
          to: "/pricing/compare",
          className: "inline-flex items-center gap-2 text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 font-medium transition-colors",
          children: ["Compare all features and limits ", /* @__PURE__ */ jsx("span", {
            className: "text-xl",
            children: "â†’"
          })]
        })
      }), /* @__PURE__ */ jsx("div", {
        className: "max-w-3xl mx-auto mt-20 text-center text-sm text-zinc-500 dark:text-zinc-400",
        children: /* @__PURE__ */ jsxs("div", {
          className: "max-w-3xl mx-auto mt-20 text-sm text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900/50 p-6 rounded-xl border border-zinc-100 dark:border-zinc-800",
          children: [/* @__PURE__ */ jsx("h4", {
            className: "font-semibold text-zinc-900 dark:text-zinc-200 mb-2",
            children: "Understanding Platform Fees"
          }), /* @__PURE__ */ jsxs("p", {
            className: "mb-2",
            children: [/* @__PURE__ */ jsx("strong", {
              children: "Credit Card Processing (2.9% + 30Â¢):"
            }), " This fee goes directly to Stripe to process payments securely. It applies to all transactions on all plans."]
          }), /* @__PURE__ */ jsxs("p", {
            children: [/* @__PURE__ */ jsx("strong", {
              children: "Platform Fee (0% - 5%):"
            }), " This is a small percentage of transactions that goes to Studio Platform to support development and hosting. It allows us to offer the ", /* @__PURE__ */ jsx("strong", {
              children: "Launch"
            }), " plan with no monthly subscription cost. As you grow, you can upgrade to reduce or eliminate this fee entirely."]
          })]
        })
      })]
    }), /* @__PURE__ */ jsx("footer", {
      className: "py-12 px-6 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "max-w-7xl mx-auto text-center text-zinc-500 dark:text-zinc-400 text-sm",
        children: ["Â© ", (/* @__PURE__ */ new Date()).getFullYear(), " Studio Platform. All rights reserved."]
      })
    })]
  });
});
const route3 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: pricing__index,
  meta: meta$2
}, Symbol.toStringTag, { value: "Module" }));
function ChatWindow({ roomId, token, currentUser, wsUrl, onClose }) {
  const [socket, setSocket] = useState(null);
  const [messages, setMessages] = useState([]);
  const [inputText, setInputText] = useState("");
  const [status, setStatus] = useState("connecting");
  const scrollRef = useRef(null);
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages]);
  useEffect(() => {
    const urlObj = new URL(wsUrl);
    urlObj.protocol = urlObj.protocol === "https:" ? "wss:" : "ws:";
    urlObj.pathname = `/chat/rooms/${roomId}/websocket`;
    urlObj.searchParams.set("token", token);
    console.log("Connecting to WS:", urlObj.toString());
    const ws = new WebSocket(urlObj.toString());
    ws.onopen = () => {
      setStatus("connected");
    };
    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data.type === "history") {
          setMessages(data.messages);
        } else if (data.type === "message") {
          setMessages((prev) => [...prev, data]);
        } else if (data.type === "user_joined") {
          setMessages((prev) => [...prev, {
            id: "sys-" + Date.now(),
            userId: "system",
            userName: "System",
            content: `${data.userName} joined the room.`,
            timestamp: data.timestamp,
            type: "system"
          }]);
        }
      } catch (e) {
        console.error("WS Parse Error", e);
      }
    };
    ws.onclose = () => {
      setStatus("disconnected");
    };
    setSocket(ws);
    return () => {
      ws.close();
    };
  }, [roomId, wsUrl, token]);
  const handleSend = (e) => {
    e?.preventDefault();
    if (!inputText.trim() || !socket) return;
    const msg = {
      type: "message",
      content: inputText
    };
    socket.send(JSON.stringify(msg));
    setInputText("");
  };
  return /* @__PURE__ */ jsxs("div", { className: "flex flex-col h-[500px] w-full max-w-md bg-white border border-zinc-200 rounded-xl shadow-xl overflow-hidden", children: [
    /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 border-b border-zinc-200 p-3 flex justify-between items-center", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsx("div", { className: `w-2 h-2 rounded-full ${status === "connected" ? "bg-green-500" : "bg-red-500"}` }),
        /* @__PURE__ */ jsx("span", { className: "font-medium text-sm text-zinc-700", children: "Chat Room" })
      ] }),
      onClose && /* @__PURE__ */ jsx("button", { onClick: onClose, className: "text-zinc-400 hover:text-zinc-600", children: "Ã—" })
    ] }),
    /* @__PURE__ */ jsxs("div", { ref: scrollRef, className: "flex-1 overflow-y-auto p-4 space-y-4 bg-white", children: [
      messages.length === 0 && /* @__PURE__ */ jsx("div", { className: "text-center text-zinc-400 text-sm mt-10", children: "No messages yet." }),
      messages.map((msg) => {
        const isMe = msg.userId === currentUser.id;
        const isSystem = msg.type === "system";
        if (isSystem) {
          return /* @__PURE__ */ jsx("div", { className: "flex justify-center", children: /* @__PURE__ */ jsx("span", { className: "text-xs bg-zinc-100 text-zinc-500 px-2 py-1 rounded-full", children: msg.content }) }, msg.id);
        }
        return /* @__PURE__ */ jsx("div", { className: `flex ${isMe ? "justify-end" : "justify-start"}`, children: /* @__PURE__ */ jsxs("div", { className: `max-w-[80%] rounded-lg p-3 text-sm ${isMe ? "bg-blue-600 text-white rounded-br-none" : "bg-zinc-100 text-zinc-800 rounded-bl-none"}`, children: [
          !isMe && /* @__PURE__ */ jsx("div", { className: "text-[10px] opacity-50 font-bold mb-1", children: msg.userName }),
          /* @__PURE__ */ jsx("div", { children: msg.content }),
          /* @__PURE__ */ jsx("div", { className: `text-[10px] mt-1 text-right ${isMe ? "text-blue-100" : "text-zinc-400"}`, children: new Date(msg.timestamp).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }) })
        ] }) }, msg.id);
      })
    ] }),
    /* @__PURE__ */ jsxs("form", { onSubmit: handleSend, className: "p-3 border-t border-zinc-200 bg-zinc-50 flex gap-2", children: [
      /* @__PURE__ */ jsx(
        "input",
        {
          className: "flex-1 border border-zinc-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",
          placeholder: "Type a message...",
          value: inputText,
          onChange: (e) => setInputText(e.target.value),
          disabled: status !== "connected"
        }
      ),
      /* @__PURE__ */ jsx(
        "button",
        {
          type: "submit",
          disabled: status !== "connected" || !inputText.trim(),
          className: "bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",
          children: /* @__PURE__ */ jsx(Send, { size: 18 })
        }
      )
    ] })
  ] });
}
function GuestChatWidget({ tenantSlug, apiUrl, brandColor = "#3B82F6" }) {
  const [isOpen, setIsOpen] = useState(false);
  const [step, setStep] = useState("form");
  const [loading, setLoading] = useState(false);
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");
  const [roomId, setRoomId] = useState(null);
  const [guestToken, setGuestToken] = useState(null);
  const [userId, setUserId] = useState(null);
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!email || !message) return;
    setLoading(true);
    try {
      const response = await fetch(`${apiUrl}/public/chat/start`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tenantSlug, name, email, message })
      });
      const data = await response.json();
      if (data.success && data.roomId && data.guestToken && data.user) {
        setRoomId(data.roomId);
        setGuestToken(data.guestToken);
        setUserId(data.user.id);
        setStep("chat");
      } else {
        alert(data.error || "Failed to start chat");
      }
    } catch (e2) {
      console.error(e2);
      alert("Connection error");
    } finally {
      setLoading(false);
    }
  };
  if (!isOpen) {
    return /* @__PURE__ */ jsx(
      "button",
      {
        onClick: () => setIsOpen(true),
        style: { backgroundColor: brandColor },
        className: "fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white hover:opacity-90 transition-opacity z-50",
        children: /* @__PURE__ */ jsx(MessageSquare, { size: 24 })
      }
    );
  }
  return /* @__PURE__ */ jsxs("div", { className: "fixed bottom-6 right-6 w-96 bg-white rounded-2xl shadow-2xl overflow-hidden z-50 border border-zinc-200", children: [
    /* @__PURE__ */ jsxs("div", { style: { backgroundColor: brandColor }, className: "p-4 flex items-center justify-between text-white", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsx(MessageSquare, { size: 20 }),
        /* @__PURE__ */ jsx("span", { className: "font-semibold", children: "Support Chat" })
      ] }),
      /* @__PURE__ */ jsx("button", { onClick: () => setIsOpen(false), className: "hover:bg-white/20 p-1 rounded", children: /* @__PURE__ */ jsx(X, { size: 20 }) })
    ] }),
    step === "form" ? /* @__PURE__ */ jsxs("form", { onSubmit: handleSubmit, className: "p-4 space-y-4", children: [
      /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-600", children: "Hi! How can we help you today?" }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-500 mb-1", children: "Your Name" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "text",
            value: name,
            onChange: (e) => setName(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm",
            placeholder: "John Doe"
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-500 mb-1", children: "Email *" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "email",
            required: true,
            value: email,
            onChange: (e) => setEmail(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm",
            placeholder: "you@example.com"
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-500 mb-1", children: "Message *" }),
        /* @__PURE__ */ jsx(
          "textarea",
          {
            required: true,
            value: message,
            onChange: (e) => setMessage(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm h-24 resize-none",
            placeholder: "How can we help?"
          }
        )
      ] }),
      /* @__PURE__ */ jsxs(
        "button",
        {
          type: "submit",
          disabled: loading,
          style: { backgroundColor: brandColor },
          className: "w-full py-2.5 rounded-lg text-white font-medium flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50",
          children: [
            loading ? /* @__PURE__ */ jsx(Loader2, { size: 16, className: "animate-spin" }) : /* @__PURE__ */ jsx(Send, { size: 16 }),
            loading ? "Starting..." : "Start Chat"
          ]
        }
      )
    ] }) : /* @__PURE__ */ jsx("div", { className: "h-[400px]", children: roomId && guestToken && userId && /* @__PURE__ */ jsx(
      ChatWindow,
      {
        roomId,
        token: guestToken,
        currentUser: { id: userId, name: name || "Guest" },
        wsUrl: apiUrl
      }
    ) })
  ] });
}
const $slug_support = UNSAFE_withComponentProps(function PublicSupportPage() {
  const {
    slug
  } = useParams();
  const apiUrl = "https://studio-platform-api.slichti.workers.dev";
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-gradient-to-br from-zinc-50 to-zinc-100 dark:from-zinc-900 dark:to-zinc-950 flex items-center justify-center p-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "text-center max-w-lg",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100 mb-4",
        children: "Need Help?"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-600 dark:text-zinc-400 mb-8",
        children: "Click the chat button in the bottom right corner to start a conversation with our support team."
      }), /* @__PURE__ */ jsxs("div", {
        className: "inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-zinc-800 rounded-full shadow-sm border border-zinc-200 dark:border-zinc-700 text-sm text-zinc-600 dark:text-zinc-400",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-2 h-2 bg-green-500 rounded-full animate-pulse"
        }), "Support is online"]
      })]
    }), slug && /* @__PURE__ */ jsx(GuestChatWidget, {
      tenantSlug: slug,
      apiUrl,
      brandColor: "#3B82F6"
    })]
  });
});
const route4 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: $slug_support
}, Symbol.toStringTag, { value: "Module" }));
const acceptInvite = UNSAFE_withComponentProps(function AcceptInvite() {
  const {
    isLoaded,
    isSignedIn,
    user
  } = useUser();
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const token = searchParams.get("token");
  const [status, setStatus] = useState("validating");
  const [error, setError] = useState(null);
  useEffect(() => {
    if (!isLoaded) return;
    if (!token) {
      setStatus("error");
      setError("Invalid invitation link (no token).");
      return;
    }
    if (!isSignedIn) {
      return;
    }
    acceptInvitation();
  }, [isLoaded, isSignedIn, token]);
  const acceptInvitation = async () => {
    setStatus("accepting");
    try {
      const authToken = await window.Clerk?.session?.getToken();
      const res = await apiRequest("/members/accept-invite", authToken, {
        method: "POST",
        body: JSON.stringify({
          token
        })
      });
      if (res.success) {
        setStatus("success");
        setTimeout(() => {
          navigate("/");
        }, 2e3);
      } else {
        setStatus("error");
        setError(res.error || "Failed to accept invitation.");
      }
    } catch (e) {
      setStatus("error");
      setError(e.message || "An unexpected error occurred.");
    }
  };
  if (!isLoaded) return /* @__PURE__ */ jsx("div", {
    className: "p-10 text-center",
    children: "Loading..."
  });
  if (!token) {
    return /* @__PURE__ */ jsx("div", {
      className: "min-h-screen bg-zinc-50 flex flex-col justify-center items-center p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-8 rounded shadow text-center max-w-md",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-red-600 font-bold mb-2",
          children: "Invalid Link"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-600",
          children: "This invitation link appears to be missing a token."
        })]
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-zinc-50 flex flex-col justify-center items-center p-4",
    children: [/* @__PURE__ */ jsx(SignedOut, {
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-8 rounded shadow text-center max-w-md w-full",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-bold mb-4",
          children: "You've been invited!"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-600 mb-6",
          children: "Please sign in or create an account to accept this invitation."
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-center",
          children: /* @__PURE__ */ jsx(RedirectToSignIn, {
            afterSignInUrl: `/accept-invite?token=${token}`
          })
        })]
      })
    }), /* @__PURE__ */ jsx(SignedIn, {
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-8 rounded shadow text-center max-w-md w-full",
        children: [status === "accepting" && /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "animate-spin rounded-full h-12 w-12 border-b-2 border-zinc-900 mx-auto mb-4"
          }), /* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold",
            children: "Accepting Invitation..."
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-500",
            children: "Linking your account to the studio."
          })]
        }), status === "success" && /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",
            children: /* @__PURE__ */ jsx("svg", {
              className: "h-6 w-6 text-green-600",
              fill: "none",
              stroke: "currentColor",
              viewBox: "0 0 24 24",
              children: /* @__PURE__ */ jsx("path", {
                strokeLinecap: "round",
                strokeLinejoin: "round",
                strokeWidth: "2",
                d: "M5 13l4 4L19 7"
              })
            })
          }), /* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold text-green-600",
            children: "Welcome!"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-600 mt-2",
            children: "Invitation accepted successfully."
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-400 mt-4",
            children: "Redirecting you..."
          })]
        }), status === "error" && /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",
            children: /* @__PURE__ */ jsx("svg", {
              className: "h-6 w-6 text-red-600",
              fill: "none",
              stroke: "currentColor",
              viewBox: "0 0 24 24",
              children: /* @__PURE__ */ jsx("path", {
                strokeLinecap: "round",
                strokeLinejoin: "round",
                strokeWidth: "2",
                d: "M6 18L18 6M6 6l12 12"
              })
            })
          }), /* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold text-red-600",
            children: "Error"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-600 mt-2",
            children: error
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => navigate("/"),
            className: "mt-6 px-4 py-2 bg-zinc-900 text-white rounded hover:bg-zinc-800",
            children: "Go Home"
          })]
        })]
      })
    })]
  });
});
const route5 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: acceptInvite
}, Symbol.toStringTag, { value: "Module" }));
const createStudio = UNSAFE_withComponentProps(function CreateStudio() {
  const {
    user,
    isLoaded
  } = useUser();
  const navigate = useNavigate();
  useNavigation();
  const [searchParams] = useSearchParams();
  const [interval, setInterval] = useState("monthly");
  const [name, setName] = useState("");
  const [slug, setSlug] = useState("");
  const [tier, setTier] = useState("basic");
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(false);
  useEffect(() => {
    const tierParam = searchParams.get("tier");
    if (tierParam && ["basic", "growth", "scale"].includes(tierParam)) {
      setTier(tierParam);
    }
    const intervalParam = searchParams.get("interval");
    if (intervalParam && ["monthly", "annual"].includes(intervalParam)) {
      setInterval(intervalParam);
    }
  }, [searchParams]);
  useEffect(() => {
    if (!name) return;
    const generated = name.toLowerCase().replace(/[^a-z0-9]/g, "-").replace(/-+/g, "-");
    setSlug(generated);
  }, [name]);
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      const res = await apiRequest("/onboarding/studio", token, {
        method: "POST",
        body: JSON.stringify({
          name,
          slug,
          tier,
          interval
        })
      });
      if (res.tenant) {
        navigate(`/studio/${res.tenant.slug}/dashboard`);
      } else if (res.error) {
        setError(res.error);
      }
    } catch (err) {
      setError(err.message || "Failed to create studio.");
    } finally {
      setLoading(false);
    }
  };
  if (!isLoaded) return /* @__PURE__ */ jsx("div", {
    className: "p-10 text-center",
    children: "Loading..."
  });
  const isVerified = user?.primaryEmailAddress?.verification?.status === "verified";
  const billingText = interval === "annual" ? "Billed annually" : "Billed monthly";
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-zinc-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",
    children: [/* @__PURE__ */ jsx(SignedOut, {
      children: /* @__PURE__ */ jsx(RedirectToSignIn, {})
    }), /* @__PURE__ */ jsxs(SignedIn, {
      children: [/* @__PURE__ */ jsxs("div", {
        className: "sm:mx-auto sm:w-full sm:max-w-md",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "mt-6 text-center text-3xl font-extrabold text-zinc-900",
          children: "Create your Studio"
        }), /* @__PURE__ */ jsx("p", {
          className: "mt-2 text-center text-sm text-zinc-600",
          children: "Start managing your classes and students today."
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "mt-8 sm:mx-auto sm:w-full sm:max-w-md",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",
          children: [!isVerified && /* @__PURE__ */ jsx("div", {
            className: "bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",
            children: /* @__PURE__ */ jsxs("div", {
              className: "flex",
              children: [/* @__PURE__ */ jsx("div", {
                className: "flex-shrink-0",
                children: /* @__PURE__ */ jsx("svg", {
                  className: "h-5 w-5 text-yellow-400",
                  viewBox: "0 0 20 20",
                  fill: "currentColor",
                  children: /* @__PURE__ */ jsx("path", {
                    fillRule: "evenodd",
                    d: "M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",
                    clipRule: "evenodd"
                  })
                })
              }), /* @__PURE__ */ jsx("div", {
                className: "ml-3",
                children: /* @__PURE__ */ jsx("p", {
                  className: "text-sm text-yellow-700",
                  children: "Please verify your email address to create a studio. Check your inbox."
                })
              })]
            })
          }), error && /* @__PURE__ */ jsx("div", {
            className: "bg-red-50 text-red-600 p-3 rounded mb-4 text-sm",
            children: error
          }), /* @__PURE__ */ jsxs("form", {
            className: "space-y-6",
            onSubmit: handleSubmit,
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                htmlFor: "name",
                className: "block text-sm font-medium text-zinc-700",
                children: "Studio Name"
              }), /* @__PURE__ */ jsx("div", {
                className: "mt-1",
                children: /* @__PURE__ */ jsx("input", {
                  id: "name",
                  name: "name",
                  type: "text",
                  required: true,
                  className: "appearance-none block w-full px-3 py-2 border border-zinc-300 rounded-md shadow-sm placeholder-zinc-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                  value: name,
                  onChange: (e) => setName(e.target.value),
                  placeholder: "e.g. Zen Yoga"
                })
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                htmlFor: "slug",
                className: "block text-sm font-medium text-zinc-700",
                children: "Studio URL (Slug)"
              }), /* @__PURE__ */ jsxs("div", {
                className: "mt-1 flex rounded-md shadow-sm",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "inline-flex items-center px-3 rounded-l-md border border-r-0 border-zinc-300 bg-zinc-50 text-zinc-500 sm:text-sm",
                  children: "studio.platform.com/"
                }), /* @__PURE__ */ jsx("input", {
                  id: "slug",
                  name: "slug",
                  type: "text",
                  required: true,
                  className: "flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border border-zinc-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
                  value: slug,
                  onChange: (e) => setSlug(e.target.value)
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex justify-between items-center mb-3",
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-sm font-medium text-zinc-700",
                  children: "Select Plan"
                }), /* @__PURE__ */ jsxs("button", {
                  type: "button",
                  onClick: () => setInterval((prev) => prev === "monthly" ? "annual" : "monthly"),
                  className: "text-xs text-blue-600 hover:text-blue-500 font-medium",
                  children: ["Switch to ", interval === "monthly" ? "Annual" : "Monthly"]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-1 gap-4",
                children: [/* @__PURE__ */ jsxs("div", {
                  onClick: () => setTier("basic"),
                  className: `cursor-pointer border rounded-lg p-4 flex items-center justify-between transition-all ${tier === "basic" ? "border-blue-500 ring-1 ring-blue-500 bg-blue-50" : "border-zinc-200 hover:border-blue-300"}`,
                  children: [/* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsx("div", {
                      className: "font-medium text-zinc-900",
                      children: "Launch (Free)"
                    }), /* @__PURE__ */ jsx("div", {
                      className: "text-sm text-zinc-500",
                      children: "Up to 5 Instructors, 1 location."
                    })]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "h-4 w-4 rounded-full border border-zinc-300 flex items-center justify-center",
                    children: tier === "basic" && /* @__PURE__ */ jsx("div", {
                      className: "h-2 w-2 bg-blue-600 rounded-full"
                    })
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  onClick: () => setTier("growth"),
                  className: `cursor-pointer border rounded-lg p-4 flex items-center justify-between transition-all ${tier === "growth" ? "border-blue-500 ring-1 ring-blue-500 bg-blue-50" : "border-zinc-200 hover:border-blue-300"}`,
                  children: [/* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "font-medium text-zinc-900",
                      children: ["Growth (", interval === "annual" ? "$39/mo" : "$49/mo", ")"]
                    }), /* @__PURE__ */ jsxs("div", {
                      className: "text-sm text-zinc-500",
                      children: ["14-day free trial. ", billingText, "."]
                    }), interval === "annual" && /* @__PURE__ */ jsx("div", {
                      className: "text-xs text-emerald-600 font-medium mt-1",
                      children: "Total $468/year. Save $120."
                    })]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "h-4 w-4 rounded-full border border-zinc-300 flex items-center justify-center",
                    children: tier === "growth" && /* @__PURE__ */ jsx("div", {
                      className: "h-2 w-2 bg-blue-600 rounded-full"
                    })
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  onClick: () => setTier("scale"),
                  className: `cursor-pointer border rounded-lg p-4 flex items-center justify-between transition-all ${tier === "scale" ? "border-blue-500 ring-1 ring-blue-500 bg-blue-50" : "border-zinc-200 hover:border-blue-300"}`,
                  children: [/* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "font-medium text-zinc-900",
                      children: ["Scale (", interval === "annual" ? "$99/mo" : "$129/mo", ")"]
                    }), /* @__PURE__ */ jsxs("div", {
                      className: "text-sm text-zinc-500",
                      children: ["14-day free trial. ", billingText, "."]
                    }), interval === "annual" && /* @__PURE__ */ jsx("div", {
                      className: "text-xs text-emerald-600 font-medium mt-1",
                      children: "Total $1,188/year. Save $360."
                    })]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "h-4 w-4 rounded-full border border-zinc-300 flex items-center justify-center",
                    children: tier === "scale" && /* @__PURE__ */ jsx("div", {
                      className: "h-2 w-2 bg-blue-600 rounded-full"
                    })
                  })]
                })]
              })]
            }), /* @__PURE__ */ jsx("div", {
              children: /* @__PURE__ */ jsx("button", {
                type: "submit",
                disabled: loading || !isVerified,
                className: "w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-zinc-900 hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-zinc-500 disabled:opacity-70 disabled:cursor-not-allowed",
                children: loading ? "Creating..." : "Create Studio"
              })
            })]
          })]
        })
      })]
    })]
  });
});
const route6 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: createStudio
}, Symbol.toStringTag, { value: "Module" }));
function PoweredBy({ tier, branding, className = "" }) {
  let show = true;
  if (tier === "scale" && branding?.hidePoweredBy) {
    show = false;
  }
  if (!show) return null;
  return /* @__PURE__ */ jsx("div", { className: `py-4 text-center ${className}`, children: /* @__PURE__ */ jsxs(
    Link,
    {
      to: "https://studioplatform.com",
      target: "_blank",
      rel: "noopener noreferrer",
      className: "inline-flex items-center gap-1.5 text-xs text-zinc-400 hover:text-zinc-600 dark:text-zinc-600 dark:hover:text-zinc-400 transition-colors",
      children: [
        /* @__PURE__ */ jsx("span", { className: "font-semibold", children: "Powered by" }),
        /* @__PURE__ */ jsx("span", { className: "font-bold tracking-tight text-zinc-500 dark:text-zinc-500", children: "StudioPlatform" })
      ]
    }
  ) });
}
function CommandBar({ token }) {
  const [isOpen, setIsOpen] = useState(false);
  const [query, setQuery] = useState("");
  const [results, setResults] = useState({ students: [], classes: [], orders: [] });
  const [loading, setLoading] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(0);
  const { slug } = useParams();
  const navigate = useNavigate();
  const inputRef = useRef(null);
  const flatResults = [
    ...results.students.map((s) => ({ ...s, type: "student" })),
    ...results.classes.map((c) => ({ ...c, type: "class" })),
    ...results.orders.map((o) => ({ ...o, type: "order" }))
  ];
  useEffect(() => {
    const down = (e) => {
      if (e.key === "k" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        setIsOpen((open) => !open);
      }
      if (e.key === "Escape") {
        setIsOpen(false);
      }
      if (isOpen) {
        if (e.key === "ArrowDown") {
          e.preventDefault();
          setSelectedIndex((prev) => (prev + 1) % Math.max(1, flatResults.length));
        }
        if (e.key === "ArrowUp") {
          e.preventDefault();
          setSelectedIndex((prev) => (prev - 1 + flatResults.length) % Math.max(1, flatResults.length));
        }
        if (e.key === "Enter" && flatResults[selectedIndex]) {
          e.preventDefault();
          handleSelect(flatResults[selectedIndex].type, flatResults[selectedIndex]);
        }
      }
    };
    document.addEventListener("keydown", down);
    return () => document.removeEventListener("keydown", down);
  }, [isOpen, flatResults, selectedIndex]);
  useEffect(() => {
    const handleOpen = () => setIsOpen(true);
    window.addEventListener("open-command-bar", handleOpen);
    return () => window.removeEventListener("open-command-bar", handleOpen);
  }, []);
  useEffect(() => {
    if (isOpen) {
      setTimeout(() => inputRef.current?.focus(), 10);
      setQuery("");
      setResults({ students: [], classes: [], orders: [] });
    }
  }, [isOpen]);
  useEffect(() => {
    if (!query || query.length < 2) {
      setResults({ students: [], classes: [], orders: [] });
      return;
    }
    const timer = setTimeout(async () => {
      setLoading(true);
      try {
        const res = await apiRequest(`/tenant/search?q=${query}`, token, {
          headers: { "X-Tenant-Slug": slug }
        });
        setResults(res);
        setSelectedIndex(0);
      } catch (e) {
        console.error("Search failed", e);
      } finally {
        setLoading(false);
      }
    }, 300);
    return () => clearTimeout(timer);
  }, [query, slug, token]);
  const handleSelect = (type, item) => {
    setIsOpen(false);
    if (type === "student") navigate(`/studio/${slug}/students/${item.id}`);
    if (type === "class") navigate(`/studio/${slug}/classes/${item.id}`);
    if (type === "order") navigate(`/studio/${slug}/pos`);
  };
  if (!isOpen) return null;
  const resultsToRender = [
    ...results.students.map((s) => ({ ...s, type: "student" })),
    ...results.classes.map((c) => ({ ...c, type: "class" })),
    ...results.orders.map((o) => ({ ...o, type: "order" }))
  ];
  return /* @__PURE__ */ jsx("div", { className: "fixed inset-0 z-50 flex items-start justify-center pt-[15vh] px-4 backdrop-blur-sm bg-zinc-900/50 animate-in fade-in duration-200", children: /* @__PURE__ */ jsxs("div", { className: "w-full max-w-2xl bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[60vh] animate-in zoom-in-95 duration-200", children: [
    /* @__PURE__ */ jsxs("div", { className: "flex items-center px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50", children: [
      /* @__PURE__ */ jsx(Search, { className: "h-5 w-5 text-zinc-400 mr-3" }),
      /* @__PURE__ */ jsx(
        "input",
        {
          ref: inputRef,
          type: "text",
          placeholder: "Search students, classes, or orders...",
          value: query,
          onChange: (e) => setQuery(e.target.value),
          className: "flex-1 bg-transparent border-none outline-none text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-500 text-base"
        }
      ),
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2", children: [
        loading && /* @__PURE__ */ jsx(Loader2, { className: "h-4 w-4 text-zinc-400 animate-spin" }),
        /* @__PURE__ */ jsx("button", { onClick: () => setIsOpen(false), className: "p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded", children: /* @__PURE__ */ jsx(X, { className: "h-4 w-4 text-zinc-400" }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "flex-1 overflow-y-auto p-2", children: [
      query.length < 2 && /* @__PURE__ */ jsxs("div", { className: "p-8 text-center text-zinc-500", children: [
        /* @__PURE__ */ jsx(ActivityIcon, {}),
        /* @__PURE__ */ jsx("p", { className: "text-sm mt-2", children: "Type at least 2 characters to search..." })
      ] }),
      query.length >= 2 && resultsToRender.length === 0 && !loading && /* @__PURE__ */ jsx("div", { className: "p-8 text-center text-zinc-500", children: /* @__PURE__ */ jsxs("p", { className: "text-sm", children: [
        'No results found for "',
        query,
        '"'
      ] }) }),
      /* @__PURE__ */ jsx("div", { className: "space-y-1", children: resultsToRender.map((item, idx) => /* @__PURE__ */ jsxs(
        "button",
        {
          onClick: () => handleSelect(item.type, item),
          onMouseEnter: () => setSelectedIndex(idx),
          className: `w-full flex items-center gap-4 px-3 py-2.5 rounded-xl transition-all text-left ${selectedIndex === idx ? "bg-blue-600 text-white shadow-lg shadow-blue-500/20" : "hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,
          children: [
            /* @__PURE__ */ jsxs("div", { className: `p-2 rounded-lg ${selectedIndex === idx ? "bg-white/20" : "bg-zinc-100 dark:bg-zinc-800"}`, children: [
              item.type === "student" && /* @__PURE__ */ jsx(User, { size: 18 }),
              item.type === "class" && /* @__PURE__ */ jsx(Dumbbell, { size: 18 }),
              item.type === "order" && /* @__PURE__ */ jsx(ShoppingCart, { size: 18 })
            ] }),
            /* @__PURE__ */ jsxs("div", { className: "flex-1 min-w-0", children: [
              /* @__PURE__ */ jsxs("div", { className: "font-bold text-sm truncate", children: [
                item.type === "student" ? `${item.name?.firstName || "Student"} ${item.name?.lastName || ""}` : item.title || item.name,
                item.type === "order" && `Order #${item.id.substring(0, 8)}`
              ] }),
              /* @__PURE__ */ jsxs("div", { className: `text-[10px] uppercase font-bold tracking-tight opacity-70`, children: [
                item.type,
                " â€¢ ",
                item.email || item.category || `$${(item.totalAmount / 100).toFixed(2)}`
              ] })
            ] }),
            /* @__PURE__ */ jsx("div", { className: "text-[10px] opacity-40 font-mono", children: selectedIndex === idx ? "Enter" : "" })
          ]
        },
        item.id
      )) })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "px-4 py-2 bg-zinc-50 dark:bg-zinc-900 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between text-[10px] text-zinc-400 font-medium", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-4", children: [
        /* @__PURE__ */ jsxs("span", { className: "flex items-center gap-1.5", children: [
          /* @__PURE__ */ jsx(Kbd, { children: "CMD" }),
          " + ",
          /* @__PURE__ */ jsx(Kbd, { children: "K" }),
          " Toggle"
        ] }),
        /* @__PURE__ */ jsxs("span", { className: "flex items-center gap-1.5", children: [
          /* @__PURE__ */ jsx(Kbd, { children: "â†‘â†“" }),
          " Navigate"
        ] }),
        /* @__PURE__ */ jsxs("span", { className: "flex items-center gap-1.5", children: [
          /* @__PURE__ */ jsx(Kbd, { children: "Enter" }),
          " Select"
        ] })
      ] }),
      /* @__PURE__ */ jsx("span", { children: "Zenflow Search Engine" })
    ] })
  ] }) });
}
function Kbd({ children }) {
  return /* @__PURE__ */ jsx("kbd", { className: "px-1.5 py-0.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded text-[9px] font-sans antialiased text-zinc-500", children });
}
function ActivityIcon() {
  return /* @__PURE__ */ jsxs("div", { className: "relative w-10 h-10 mx-auto opacity-20", children: [
    /* @__PURE__ */ jsx(Search, { className: "absolute inset-0 w-full h-full text-zinc-400" }),
    /* @__PURE__ */ jsx("div", { className: "absolute inset-x-0 bottom-0 h-0.5 bg-zinc-400 animate-pulse" })
  ] });
}
function SidebarGroup({ title, children, defaultOpen = true }) {
  const [isOpen, setIsOpen] = useState(defaultOpen);
  return /* @__PURE__ */ jsxs("div", { className: "mb-2", children: [
    /* @__PURE__ */ jsxs(
      "button",
      {
        onClick: () => setIsOpen(!isOpen),
        className: "w-full flex items-center justify-between px-3 py-1.5 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider hover:text-zinc-800 dark:hover:text-zinc-200 transition-colors",
        children: [
          title,
          isOpen ? /* @__PURE__ */ jsx(ChevronDown, { size: 14 }) : /* @__PURE__ */ jsx(ChevronRight, { size: 14 })
        ]
      }
    ),
    isOpen && /* @__PURE__ */ jsx("div", { className: "mt-1 space-y-0.5", children })
  ] });
}
function ImpersonationBanner({ tenantName, userName, currentRole }) {
  const roles = ["owner", "instructor", "student"];
  const { signOut } = useClerk();
  const handleRoleChange = (role) => {
    document.cookie = `__impersonate_role=${role}; path=/; SameSite=Lax`;
    window.location.reload();
  };
  const handleExit = async () => {
    localStorage.removeItem("impersonation_token");
    document.cookie = "__impersonate_token=; path=/; max-age=0; SameSite=Lax";
    document.cookie = "__impersonate_role=; path=/; max-age=0; SameSite=Lax";
    window.location.reload();
  };
  const getRoleColor = (r) => {
    switch (r) {
      case "owner":
        return "bg-purple-600";
      case "instructor":
        return "bg-blue-600";
      case "student":
        return "bg-emerald-600";
      default:
        return "bg-zinc-700";
    }
  };
  const bannerColor = getRoleColor(currentRole);
  return /* @__PURE__ */ jsxs("div", { className: `${bannerColor} text-white px-4 py-2 flex items-center justify-between shadow-md relative z-50`, children: [
    /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-4", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2 bg-black/20 px-3 py-1 rounded-full text-sm font-medium", children: [
        /* @__PURE__ */ jsx(Users, { size: 16 }),
        /* @__PURE__ */ jsx("span", { children: "Impersonating" })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "text-sm", children: [
        "Viewing ",
        /* @__PURE__ */ jsx("strong", { children: tenantName }),
        " as ",
        /* @__PURE__ */ jsx("strong", { children: userName })
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3", children: [
      /* @__PURE__ */ jsxs(Menu, { as: "div", className: "relative", children: [
        /* @__PURE__ */ jsxs(Menu.Button, { className: "flex items-center gap-2 px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm transition-colors", children: [
          /* @__PURE__ */ jsxs("span", { children: [
            "View as: ",
            /* @__PURE__ */ jsx("strong", { children: currentRole.charAt(0).toUpperCase() + currentRole.slice(1) })
          ] }),
          /* @__PURE__ */ jsx(ChevronDown, { size: 14 })
        ] }),
        /* @__PURE__ */ jsx(Menu.Items, { className: "absolute right-0 mt-1 w-40 bg-white dark:bg-zinc-800 rounded-md shadow-lg py-1 border border-zinc-200 dark:border-zinc-700 focus:outline-none text-zinc-800 dark:text-zinc-200", children: roles.map((role) => /* @__PURE__ */ jsx(Menu.Item, { children: ({ active }) => /* @__PURE__ */ jsxs(
          "button",
          {
            onClick: () => handleRoleChange(role),
            className: `${active ? "bg-zinc-100 dark:bg-zinc-700" : ""} group flex w-full items-center justify-between px-3 py-2 text-sm`,
            children: [
              /* @__PURE__ */ jsx("span", { className: "capitalize", children: role }),
              currentRole === role && /* @__PURE__ */ jsx(Check, { size: 14, className: "text-green-500" })
            ]
          }
        ) }, role)) })
      ] }),
      /* @__PURE__ */ jsx("div", { className: "h-4 w-px bg-white/30 mx-2" }),
      /* @__PURE__ */ jsxs(
        "button",
        {
          onClick: handleExit,
          className: "flex items-center gap-2 px-3 py-1 bg-white/10 hover:bg-red-500/80 rounded text-sm transition-colors",
          children: [
            /* @__PURE__ */ jsx(LogOut, { size: 14 }),
            /* @__PURE__ */ jsx("span", { children: "Exit" })
          ]
        }
      )
    ] })
  ] });
}
const loader$1k = async (args) => {
  const {
    params,
    request
  } = args;
  const {
    userId,
    getToken
  } = await getAuth(args);
  if (!userId) {
    return redirect(`/sign-in?redirect_url=${request.url}`);
  }
  const {
    slug
  } = params;
  if (!slug) return redirect("/");
  let token = await getToken();
  const cookieHeader = request.headers.get("Cookie");
  let isImpersonating = false;
  if (cookieHeader) {
    const match = cookieHeader.match(/(?:^|; )__impersonate_token=([^;]*)/);
    if (match && match[1]) {
      token = match[1];
      isImpersonating = true;
    }
  }
  try {
    const [tenantInfo, me] = await Promise.all([apiRequest(`/tenant/info`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/tenant/me`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    if (tenantInfo.error) {
      console.error("Studio layout loader: Tenant fetch error", tenantInfo.error);
      const msg = typeof tenantInfo.error === "string" ? tenantInfo.error : JSON.stringify(tenantInfo.error);
      throw new Response(`Studio Not Found: ${msg}`, {
        status: 404
      });
    }
    if (tenantInfo.status === "suspended") {
      throw new Response("This studio has been suspended by the platform administrator.", {
        status: 403
      });
    }
    return {
      slug: params.slug,
      tenant: tenantInfo,
      me,
      token,
      isPaused: tenantInfo.status === "paused",
      isImpersonating,
      features: tenantInfo.features || []
    };
  } catch (e) {
    if (e instanceof Response) throw e;
    console.error("Studio layout loader failed:", e);
    const details = e.data || e.message;
    throw new Response(`Studio Not Found/Access Denied: ${JSON.stringify(details)}`, {
      status: 404
    });
  }
};
const studio_$slug = UNSAFE_withComponentProps(function StudioLayout() {
  const {
    slug
  } = useParams();
  const {
    tenant,
    me,
    features,
    activeMemberships,
    isPaused,
    token,
    isImpersonating
  } = useLoaderData();
  const {
    user: clerkUser
  } = useUser();
  const featureSet = new Set(features);
  const dbName = `${me.firstName || ""} ${me.lastName || ""}`.trim();
  const displayName = dbName && dbName !== "User" ? dbName : clerkUser?.fullName || dbName || "Member";
  const [isStudentView, setIsStudentView] = useState(() => {
    if (typeof window !== "undefined") return localStorage.getItem("studio_student_view") === "true";
    return false;
  });
  const toggleStudentView = () => {
    const newState = !isStudentView;
    setIsStudentView(newState);
    localStorage.setItem("studio_student_view", String(newState));
  };
  const [searchParams, setSearchParams] = useSearchParams();
  useEffect(() => {
    const coupon = searchParams.get("coupon");
    if (coupon) {
      sessionStorage.setItem("pending_coupon", coupon.toUpperCase());
      const newParams = new URLSearchParams(searchParams);
      newParams.delete("coupon");
      setSearchParams(newParams, {
        replace: true
      });
    }
  }, [searchParams, setSearchParams]);
  const effectiveRoles = isStudentView ? ["student"] : me?.roles || [];
  return /* @__PURE__ */ jsxs("div", {
    className: "flex h-screen bg-zinc-50 dark:bg-zinc-950 font-sans text-zinc-900 dark:text-zinc-100 transition-colors duration-300",
    children: [/* @__PURE__ */ jsxs("aside", {
      className: "w-64 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col fixed inset-y-0 z-20 transition-colors duration-300",
      children: [/* @__PURE__ */ jsx("div", {
        className: "p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between",
        children: /* @__PURE__ */ jsxs(Link, {
          to: `/studio/${slug}`,
          prefetch: "intent",
          className: "flex items-center gap-2 group",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold group-hover:scale-105 transition-transform",
            style: {
              backgroundColor: tenant.branding?.primaryColor || "#2563eb"
            },
            children: tenant.name.substring(0, 1)
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex flex-col",
            children: [/* @__PURE__ */ jsx("span", {
              className: "font-bold text-sm leading-tight text-zinc-900 dark:text-zinc-100",
              children: tenant.name
            }), /* @__PURE__ */ jsxs("span", {
              className: "text-[10px] text-zinc-500 dark:text-zinc-400 font-mono",
              children: ["/studio/", slug]
            })]
          })]
        })
      }), /* @__PURE__ */ jsxs("nav", {
        className: "flex-1 overflow-auto p-4 space-y-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "space-y-1",
          children: /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}`,
            end: true,
            icon: /* @__PURE__ */ jsx(LayoutDashboard, {
              size: 18
            }),
            children: "Dashboard"
          })
        }), /* @__PURE__ */ jsxs(SidebarGroup, {
          title: "Operations",
          children: [/* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/schedule`,
            icon: /* @__PURE__ */ jsx(Calendar, {
              size: 18
            }),
            children: "Schedule"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/classes`,
            icon: /* @__PURE__ */ jsx(Dumbbell, {
              size: 18
            }),
            children: "Classes"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/appointments`,
            icon: /* @__PURE__ */ jsx(Clock, {
              size: 18
            }),
            children: "Appointments"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/checkin`,
            icon: /* @__PURE__ */ jsx(CheckCircle2, {
              size: 18
            }),
            children: isStudentView ? "Attendance History" : "Check-in"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/challenges`,
            icon: /* @__PURE__ */ jsx(Trophy, {
              size: 18
            }),
            children: "Challenges"
          }), !isStudentView && /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/substitutions`,
            icon: /* @__PURE__ */ jsx(RefreshCw, {
              size: 18
            }),
            children: "Substitutions"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/waivers`,
            icon: /* @__PURE__ */ jsx(FileSignature, {
              size: 18
            }),
            children: "Waivers"
          }), featureSet.has("vod") && /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/videos`,
            icon: /* @__PURE__ */ jsx(Image$1, {
              size: 18
            }),
            children: "Media Library"
          })]
        }), /* @__PURE__ */ jsxs(SidebarGroup, {
          title: "Commerce",
          children: [featureSet.has("pos") && !isStudentView && /* @__PURE__ */ jsx(Fragment, {
            children: /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/pos`,
              icon: /* @__PURE__ */ jsx(ShoppingCart, {
                size: 18
              }),
              children: "POS & Retail"
            })
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/memberships`,
            icon: /* @__PURE__ */ jsx(CreditCard, {
              size: 18
            }),
            children: "Memberships"
          }), /* @__PURE__ */ jsx(NavItem, {
            to: `/studio/${slug}/commerce/packs`,
            icon: /* @__PURE__ */ jsx(Package, {
              size: 18
            }),
            children: "Class Packs"
          }), featureSet.has("pos") && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/commerce/coupons`,
              icon: /* @__PURE__ */ jsx(Ticket, {
                size: 18
              }),
              children: isStudentView ? "My Coupons" : "Coupons"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/commerce/gift-cards`,
              icon: /* @__PURE__ */ jsx(Ticket, {
                size: 18
              }),
              children: "Gift Cards"
            })]
          })]
        }), !isStudentView && /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs(SidebarGroup, {
            title: "CRM",
            children: [/* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/leads`,
              icon: /* @__PURE__ */ jsx(User, {
                size: 18
              }),
              children: "Leads"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/tasks`,
              icon: /* @__PURE__ */ jsx(ListTodo, {
                size: 18
              }),
              children: "Tasks"
            }), featureSet.has("marketing") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/marketing`,
              icon: /* @__PURE__ */ jsx(Mail, {
                size: 18
              }),
              children: "Email Automations"
            }), featureSet.has("loyalty") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/loyalty`,
              icon: /* @__PURE__ */ jsx(Award, {
                size: 18
              }),
              children: "Loyalty"
            })]
          }), /* @__PURE__ */ jsxs(SidebarGroup, {
            title: "Management",
            children: [/* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/students`,
              icon: /* @__PURE__ */ jsx(Users, {
                size: 18
              }),
              children: "People"
            }), (["scale"].includes(tenant.tier) || featureSet.has("payroll")) && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/financials/payroll`,
              icon: /* @__PURE__ */ jsx(CreditCard, {
                size: 18
              }),
              children: "Payroll Admin"
            }), effectiveRoles.some((r) => ["instructor", "admin", "owner"].includes(r)) && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/financials/my-payouts`,
              icon: /* @__PURE__ */ jsx(DollarSign, {
                size: 18
              }),
              children: "My Payouts"
            }), featureSet.has("financials") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/finances`,
              end: true,
              icon: /* @__PURE__ */ jsx(DollarSign, {
                size: 18
              }),
              children: "Finances"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/discounts`,
              icon: /* @__PURE__ */ jsx(Tag, {
                size: 18
              }),
              children: "Discounts"
            }), featureSet.has("website_builder") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings/embeds`,
              icon: /* @__PURE__ */ jsx(Code, {
                size: 18
              }),
              children: "Website Widgets"
            }), featureSet.has("mobile_app") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings/mobile`,
              icon: /* @__PURE__ */ jsx(Smartphone, {
                size: 18
              }),
              children: "Mobile App"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings/qr`,
              icon: /* @__PURE__ */ jsx(QrCode, {
                size: 18
              }),
              children: "QR Codes"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings/integrations`,
              icon: /* @__PURE__ */ jsx(Terminal, {
                size: 18
              }),
              children: "Integrations"
            }), featureSet.has("chat") && /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings/chat`,
              icon: /* @__PURE__ */ jsx(MessageSquare, {
                size: 18
              }),
              children: "Chat Settings"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/data`,
              icon: /* @__PURE__ */ jsx(Database, {
                size: 18
              }),
              children: "Data"
            }), /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/settings`,
              end: true,
              icon: /* @__PURE__ */ jsx(Settings, {
                size: 18
              }),
              children: "Settings"
            })]
          }), /* @__PURE__ */ jsx(SidebarGroup, {
            title: "Analytics",
            children: /* @__PURE__ */ jsx(NavItem, {
              to: `/studio/${slug}/reports`,
              icon: /* @__PURE__ */ jsx(BarChart3, {
                size: 18
              }),
              children: "Reports"
            })
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 flex flex-col gap-3",
        children: [!isStudentView && (me?.roles?.includes("owner") || me?.roles?.includes("admin") || me?.user?.isPlatformAdmin || isImpersonating) && /* @__PURE__ */ jsxs("button", {
          onClick: toggleStudentView,
          className: "flex items-center gap-2 text-zinc-500 hover:text-blue-600 dark:text-zinc-400 dark:hover:text-blue-400 text-xs font-medium transition mb-1",
          children: [/* @__PURE__ */ jsx(Users, {
            size: 14
          }), /* @__PURE__ */ jsx("span", {
            children: "View as Student"
          })]
        }), (me?.user?.isPlatformAdmin || isImpersonating) && !isStudentView && /* @__PURE__ */ jsxs("a", {
          href: "/admin",
          className: "flex items-center gap-2 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100 text-xs font-medium transition mb-1",
          children: [/* @__PURE__ */ jsx(Users, {
            size: 14
          }), /* @__PURE__ */ jsx("span", {
            children: "Return to Admin"
          })]
        }), /* @__PURE__ */ jsxs(Link, {
          to: "/help",
          className: "flex items-center gap-2 text-zinc-500 hover:text-blue-600 dark:text-zinc-400 dark:hover:text-blue-400 text-xs font-medium transition mb-1",
          children: [/* @__PURE__ */ jsx(CircleHelp, {
            size: 14
          }), /* @__PURE__ */ jsx("span", {
            children: "Help & Support"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-4 mt-auto",
          children: /* @__PURE__ */ jsx(PoweredBy, {
            tier: tenant.tier,
            branding: tenant.branding
          })
        })]
      })]
    }), /* @__PURE__ */ jsxs("main", {
      className: "flex-1 ml-64 flex flex-col min-w-0 relative",
      children: [isImpersonating && /* @__PURE__ */ jsx(ImpersonationBanner, {
        tenantName: tenant.name,
        userName: `${me.firstName} ${me.lastName}`,
        currentRole: me.roles && me.roles.length > 0 ? me.roles[0] : "student"
      }), isStudentView && /* @__PURE__ */ jsxs("div", {
        className: "bg-blue-600 text-white px-6 py-2 text-sm font-medium flex items-center justify-between shadow-md z-30",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Users, {
            size: 16
          }), /* @__PURE__ */ jsx("span", {
            children: "You are viewing as a Student."
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: toggleStudentView,
          className: "bg-white text-blue-600 px-3 py-1 rounded text-xs font-bold hover:bg-zinc-100 transition",
          children: "Exit View"
        })]
      }), isPaused && /* @__PURE__ */ jsxs("div", {
        className: "bg-amber-100 border-b border-amber-200 text-amber-800 px-6 py-3 text-sm font-medium flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(AlertTriangle, {
          size: 16
        }), /* @__PURE__ */ jsx("span", {
          children: "This studio is currently paused. Some features may be restricted."
        })]
      }), /* @__PURE__ */ jsxs("header", {
        className: "h-16 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 flex items-center justify-between px-6 sticky top-0 z-10",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 text-sm text-zinc-500",
          children: [/* @__PURE__ */ jsx("span", {
            className: "hover:text-zinc-900 dark:hover:text-zinc-300 cursor-pointer",
            children: "Studio"
          }), /* @__PURE__ */ jsx("span", {
            children: "/"
          }), /* @__PURE__ */ jsx("span", {
            className: "font-medium text-zinc-900 dark:text-zinc-100",
            children: tenant.name
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => window.dispatchEvent(new CustomEvent("open-command-bar")),
            className: "flex items-center gap-2 px-3 py-1.5 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-500 dark:text-zinc-400 hover:border-blue-500 transition-all shadow-sm group",
            children: [/* @__PURE__ */ jsx(Search, {
              size: 14,
              className: "group-hover:text-blue-500"
            }), /* @__PURE__ */ jsx("span", {
              children: "Search..."
            }), /* @__PURE__ */ jsx("kbd", {
              className: "ml-2 px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-700 rounded font-sans opacity-50",
              children: "âŒ˜K"
            })]
          }), /* @__PURE__ */ jsx(Link, {
            to: "/help",
            title: "Help Center",
            className: "p-2 text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800",
            children: /* @__PURE__ */ jsx(CircleHelp, {
              size: 20
            })
          }), /* @__PURE__ */ jsx(ThemeToggle, {}), /* @__PURE__ */ jsx("div", {
            className: "h-4 w-px bg-zinc-200 dark:bg-zinc-800 mx-2"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-end hidden sm:flex",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100 leading-none",
                children: displayName
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 font-medium capitalize mt-0.5",
                children: (() => {
                  const isPlatformAdmin = me?.user?.isPlatformAdmin;
                  let baseRole = "Member";
                  if (isPlatformAdmin) baseRole = "Admin";
                  else if (me?.roles?.includes("owner")) baseRole = "Owner";
                  else if (me?.roles?.includes("admin")) baseRole = "Manager";
                  else if (me?.roles?.includes("instructor")) baseRole = "Instructor";
                  let activeRole = (effectiveRoles[0] || "member").replace(/_/g, " ");
                  const cap = (s) => s.charAt(0).toUpperCase() + s.slice(1);
                  baseRole = cap(baseRole);
                  activeRole = cap(activeRole);
                  if (baseRole === activeRole) return activeRole;
                  if (baseRole === "Admin") return `${baseRole} / ${activeRole}`;
                  if (activeRole === "Student" && baseRole !== "Member") return `${baseRole} / ${activeRole}`;
                  return activeRole;
                })()
              })]
            }), /* @__PURE__ */ jsx(UserButton, {})]
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex-1 overflow-auto",
        children: /* @__PURE__ */ jsx(Outlet, {
          context: {
            tenant,
            me,
            features: featureSet,
            roles: effectiveRoles,
            isStudentView
          }
        })
      }), !isStudentView && /* @__PURE__ */ jsx(CommandBar, {
        token: token || ""
      }), tenant.googleCredentials?.measurementId && /* @__PURE__ */ jsxs(Fragment, {
        children: [/* @__PURE__ */ jsx("script", {
          async: true,
          src: `https://www.googletagmanager.com/gtag/js?id=${tenant.googleCredentials.measurementId}`
        }), /* @__PURE__ */ jsx("script", {
          dangerouslySetInnerHTML: {
            __html: `
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', '${tenant.googleCredentials.measurementId}');
                        `
          }
        })]
      })]
    }), /* @__PURE__ */ jsx(ChatWidget, {
      roomId: `support-${me.id}`,
      tenantId: isStudentView ? slug || "" : "platform",
      userId: me.id,
      userName: `${me.firstName} ${me.lastName}`,
      enabled: !isStudentView && tenant.settings?.chatEnabled !== false && featureSet.has("chat"),
      chatConfig: isStudentView ? tenant.settings?.chatConfig : void 0,
      apiUrl: typeof window !== "undefined" ? window.ENV?.API_URL : ""
    })]
  });
});
function NavItem({
  to,
  children,
  icon,
  end
}) {
  return /* @__PURE__ */ jsxs(NavLink, {
    to,
    end,
    prefetch: "intent",
    className: ({
      isActive
    }) => `block px-3 py-2 rounded-lg text-sm transition-colors mb-0.5 flex items-center gap-3 ${isActive ? "bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 font-medium" : "text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:text-zinc-900 dark:hover:text-zinc-100"}`,
    children: [icon, children]
  });
}
const route7 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug,
  loader: loader$1k
}, Symbol.toStringTag, { value: "Module" }));
const DialogContext = createContext(null);
function Dialog({ children, open: controlledOpen, onOpenChange: setControlledOpen }) {
  const [uncontrolledOpen, setUncontrolledOpen] = useState(false);
  const isControlled = controlledOpen !== void 0;
  const isOpen = isControlled ? controlledOpen : uncontrolledOpen;
  const setIsOpen = isControlled ? setControlledOpen : setUncontrolledOpen;
  return /* @__PURE__ */ jsx(DialogContext.Provider, { value: { isOpen, setIsOpen }, children });
}
function DialogTrigger({ asChild, children, onClick }) {
  const { setIsOpen } = useContext(DialogContext);
  return /* @__PURE__ */ jsx("div", { onClick: () => setIsOpen(true), className: "inline-block cursor-pointer", children });
}
function DialogContent({ children, className }) {
  const { isOpen, setIsOpen } = useContext(DialogContext);
  return /* @__PURE__ */ jsx(Transition, { appear: true, show: isOpen, as: Fragment$1, children: /* @__PURE__ */ jsxs(Dialog$1, { as: "div", className: "relative z-50", onClose: () => setIsOpen(false), children: [
    /* @__PURE__ */ jsx(
      TransitionChild,
      {
        as: Fragment$1,
        enter: "ease-out duration-300",
        enterFrom: "opacity-0",
        enterTo: "opacity-100",
        leave: "ease-in duration-200",
        leaveFrom: "opacity-100",
        leaveTo: "opacity-0",
        children: /* @__PURE__ */ jsx("div", { className: "fixed inset-0 bg-black/80" })
      }
    ),
    /* @__PURE__ */ jsx("div", { className: "fixed inset-0 overflow-y-auto", children: /* @__PURE__ */ jsx("div", { className: "flex min-h-full items-center justify-center p-4 text-center", children: /* @__PURE__ */ jsx(
      TransitionChild,
      {
        as: Fragment$1,
        enter: "ease-out duration-300",
        enterFrom: "opacity-0 scale-95",
        enterTo: "opacity-100 scale-100",
        leave: "ease-in duration-200",
        leaveFrom: "opacity-100 scale-100",
        leaveTo: "opacity-0 scale-95",
        children: /* @__PURE__ */ jsxs(DialogPanel, { className: `w-full max-w-lg transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all dark:bg-zinc-950 dark:border dark:border-zinc-800 ${className}`, children: [
          children,
          /* @__PURE__ */ jsx(
            "button",
            {
              className: "absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none",
              onClick: () => setIsOpen(false),
              children: /* @__PURE__ */ jsx(X, { className: "h-4 w-4 text-zinc-500" })
            }
          )
        ] })
      }
    ) }) })
  ] }) });
}
function DialogHeader({ children, className }) {
  return /* @__PURE__ */ jsx("div", { className: `flex flex-col space-y-1.5 text-center sm:text-left ${className}`, children });
}
function DialogTitle({ children, className }) {
  return /* @__PURE__ */ jsx(DialogTitle$1, { as: "h3", className: `text-lg font-semibold leading-none tracking-tight ${className}`, children });
}
function DialogDescription({ children, className }) {
  return /* @__PURE__ */ jsx("p", { className: `text-sm text-zinc-500 dark:text-zinc-400 ${className}`, children });
}
function DialogFooter({ className = "", ...props }) {
  return /* @__PURE__ */ jsx(
    "div",
    {
      className: `flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 ${className}`,
      ...props
    }
  );
}
const Button = React.forwardRef(
  ({ className = "", variant = "default", size = "default", ...props }, ref) => {
    let classes = "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300";
    const variants = {
      default: "bg-zinc-900 text-zinc-50 hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",
      destructive: "bg-red-500 text-zinc-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",
      outline: "border border-zinc-200 bg-white hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",
      secondary: "bg-zinc-100 text-zinc-900 hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",
      ghost: "hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",
      link: "text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"
    };
    const sizes = {
      default: "h-10 px-4 py-2",
      sm: "h-9 rounded-md px-3",
      lg: "h-11 rounded-md px-8",
      icon: "h-10 w-10"
    };
    classes += ` ${variants[variant] || variants.default}`;
    classes += ` ${sizes[size] || sizes.default}`;
    if (className) classes += ` ${className}`;
    return /* @__PURE__ */ jsx(
      "button",
      {
        className: classes,
        ref,
        ...props
      }
    );
  }
);
Button.displayName = "Button";
function ConfirmDialog({
  open,
  onOpenChange,
  onConfirm,
  title = "Are you sure?",
  description = "This action cannot be undone.",
  confirmText = "Confirm",
  cancelText = "Cancel",
  variant = "default"
}) {
  return /* @__PURE__ */ jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxs(DialogContent, { children: [
    /* @__PURE__ */ jsxs(DialogHeader, { children: [
      /* @__PURE__ */ jsx(DialogTitle, { children: title }),
      /* @__PURE__ */ jsx(DialogDescription, { children: description })
    ] }),
    /* @__PURE__ */ jsxs(DialogFooter, { children: [
      /* @__PURE__ */ jsx(Button, { variant: "outline", onClick: () => onOpenChange(false), children: cancelText }),
      /* @__PURE__ */ jsx(
        Button,
        {
          variant: variant === "destructive" ? "destructive" : "default",
          onClick: () => {
            onConfirm();
            onOpenChange(false);
          },
          children: confirmText
        }
      )
    ] })
  ] }) });
}
function formatBytes(bytes, decimals = 2) {
  if (!+bytes) return "0 Bytes";
  const k = 1024;
  const dm = decimals < 0 ? 0 : decimals;
  const sizes = ["Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
}
function formatDuration(seconds) {
  if (!seconds) return "0:00";
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = Math.floor(seconds % 60);
  return `${minutes}:${remainingSeconds.toString().padStart(2, "0")}`;
}
const loader$1j = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug,
    id
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const [collection, videosData] = await Promise.all([apiRequest(`/video-management/collections/${id}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/video-management`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    return {
      collection,
      allVideos: videosData.videos || []
    };
  } catch (e) {
    console.error("Collection Loader Error", e);
    throw new Response("Collection not found", {
      status: 404
    });
  }
};
const action$m = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug,
    id
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "update_details") {
    const title = formData.get("title");
    const description = formData.get("description");
    const urlSlug = formData.get("slug");
    await apiRequest(`/video-management/collections/${id}`, token, {
      method: "PATCH",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        title,
        description,
        slug: urlSlug
      })
    });
  }
  if (intent === "add_item") {
    const videoId = formData.get("videoId");
    await apiRequest(`/video-management/collections/${id}/items`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        action: "add",
        videoId
      })
    });
  }
  if (intent === "remove_item") {
    const itemId = formData.get("itemId");
    await apiRequest(`/video-management/collections/${id}/items`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        action: "remove",
        itemId
      })
    });
  }
  if (intent === "delete_collection") {
    await apiRequest(`/video-management/collections/${id}`, token, {
      method: "DELETE",
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return redirect(`/studio/${slug}/videos?tab=collections`);
  }
  return {
    success: true
  };
};
const studio_$slug_videos_collections_$id = UNSAFE_withComponentProps(function CollectionDetails() {
  const {
    collection,
    allVideos
  } = useLoaderData();
  const submit = useSubmit();
  useRevalidator();
  const [isAddOpen, setIsAddOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");
  const [editing, setEditing] = useState(false);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const existingVideoIds = new Set(collection.items.map((i) => i.videoId));
  const availableVideos = allVideos.filter((v) => !existingVideoIds.has(v.id) && v.title.toLowerCase().includes(searchQuery.toLowerCase()));
  const handleDelete = () => {
    setShowDeleteConfirm(true);
  };
  const handleConfirmDelete = () => {
    submit({
      intent: "delete_collection"
    }, {
      method: "post"
    });
  };
  const handleAddItem = (videoId) => {
    submit({
      intent: "add_item",
      videoId
    }, {
      method: "post",
      preventScrollReset: true
    });
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-white",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "border-b border-zinc-200 px-6 py-4 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsx(Link, {
          to: "../?tab=collections",
          className: "p-2 hover:bg-zinc-100 rounded-full text-zinc-500 transition",
          children: /* @__PURE__ */ jsx(ArrowLeft, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-xl font-bold text-zinc-900",
            children: collection.title
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-sm text-zinc-500 font-mono",
            children: ["/", collection.slug]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setEditing(true),
          className: "px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-lg hover:bg-zinc-50",
          children: "Edit Details"
        }), /* @__PURE__ */ jsx("button", {
          onClick: handleDelete,
          className: "px-4 py-2 text-sm font-medium text-red-600 bg-red-50 border border-transparent rounded-lg hover:bg-red-100",
          children: "Delete"
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setIsAddOpen(true),
          className: "px-4 py-2 text-sm font-medium text-white bg-zinc-900 rounded-lg hover:bg-zinc-800 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 16
          }), " Add Video"]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-y-auto p-6 max-w-5xl mx-auto w-full space-y-8",
      children: /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-lg font-semibold mb-4 flex items-center gap-2",
          children: ["Videos ", /* @__PURE__ */ jsxs("span", {
            className: "text-zinc-400 font-normal text-sm",
            children: ["(", collection.items.length, ")"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white border border-zinc-200 rounded-lg divide-y divide-zinc-100",
          children: [collection.items.map((item, index) => /* @__PURE__ */ jsxs("div", {
            className: "p-4 flex items-center gap-4 group hover:bg-zinc-50 transition",
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-zinc-400 cursor-move hover:text-zinc-600",
              children: /* @__PURE__ */ jsx(GripVertical, {
                size: 20
              })
            }), /* @__PURE__ */ jsx("div", {
              className: "w-16 h-10 bg-zinc-100 rounded overflow-hidden border border-zinc-200 shrink-0",
              children: item.video?.posterUrl ? /* @__PURE__ */ jsx("img", {
                src: item.video.posterUrl,
                className: "w-full h-full object-cover"
              }) : /* @__PURE__ */ jsx("div", {
                className: "w-full h-full flex items-center justify-center text-zinc-300 bg-zinc-50",
                children: /* @__PURE__ */ jsx("span", {
                  className: "text-[10px]",
                  children: "No Img"
                })
              })
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1 min-w-0",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900 truncate",
                children: item.video?.title || "Unknown Video"
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-xs text-zinc-500 flex gap-3",
                children: [/* @__PURE__ */ jsx("span", {
                  children: formatDuration(item.video?.duration || 0)
                }), /* @__PURE__ */ jsx("span", {
                  className: "capitalize",
                  children: item.video?.status
                })]
              })]
            }), /* @__PURE__ */ jsxs(Form, {
              method: "post",
              className: "opacity-0 group-hover:opacity-100 transition-opacity",
              children: [/* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "intent",
                value: "remove_item"
              }), /* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "itemId",
                value: item.id
              }), /* @__PURE__ */ jsx("button", {
                className: "p-2 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 16
                })
              })]
            })]
          }, item.id)), collection.items.length === 0 && /* @__PURE__ */ jsx("div", {
            className: "p-12 text-center text-zinc-500",
            children: "This collection is empty."
          })]
        })]
      })
    }), isAddOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl shadow-xl max-w-2xl w-full h-[600px] flex flex-col animate-in fade-in zoom-in duration-200",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 border-b border-zinc-200 flex justify-between items-center",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-bold text-lg",
            children: "Add Video to Collection"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsAddOpen(false),
            children: /* @__PURE__ */ jsx(X, {
              size: 20,
              className: "text-zinc-400 hover:text-zinc-600"
            })
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "p-4 border-b border-zinc-200 bg-zinc-50",
          children: /* @__PURE__ */ jsxs("div", {
            className: "relative",
            children: [/* @__PURE__ */ jsx(Search, {
              className: "absolute left-3 top-2.5 h-4 w-4 text-zinc-400"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              placeholder: "Search library...",
              className: "w-full pl-9 pr-4 py-2 border border-zinc-200 rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-black/5",
              value: searchQuery,
              onChange: (e) => setSearchQuery(e.target.value)
            })]
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex-1 overflow-y-auto p-2",
          children: [availableVideos.map((video) => /* @__PURE__ */ jsxs("div", {
            className: "p-3 hover:bg-zinc-50 rounded-lg flex items-center justify-between group transition",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-12 h-8 bg-zinc-100 rounded flex-shrink-0 border border-zinc-200",
                children: video.posterUrl && /* @__PURE__ */ jsx("img", {
                  src: video.posterUrl,
                  className: "w-full h-full object-cover rounded"
                })
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-sm text-zinc-900",
                  children: video.title
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 font-mono",
                  children: formatDuration(video.duration)
                })]
              })]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => handleAddItem(video.id),
              className: "px-3 py-1.5 text-xs font-semibold bg-zinc-900 text-white rounded hover:bg-zinc-800 transition",
              children: "Add"
            })]
          }, video.id)), availableVideos.length === 0 && /* @__PURE__ */ jsx("div", {
            className: "p-8 text-center text-sm text-zinc-500",
            children: searchQuery ? "No videos found matching search." : "No video available to add."
          })]
        })]
      })
    }), editing && /* @__PURE__ */ jsxs("div", {
      className: "fixed inset-0 z-50 flex justify-end",
      children: [/* @__PURE__ */ jsx("div", {
        className: "absolute inset-0 bg-black/20 backdrop-blur-sm",
        onClick: () => setEditing(false)
      }), /* @__PURE__ */ jsxs("div", {
        className: "relative w-full max-w-md bg-white shadow-2xl h-full p-6 animate-in slide-in-from-right duration-200",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-xl font-bold mb-6",
          children: "Edit Collection"
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: () => setEditing(false),
          className: "space-y-4",
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "update_details"
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Title"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              name: "title",
              defaultValue: collection.title,
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5",
              required: true
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Slug (URL)"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              name: "slug",
              defaultValue: collection.slug,
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 font-mono text-sm",
              required: true
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Description"
            }), /* @__PURE__ */ jsx("textarea", {
              name: "description",
              defaultValue: collection.description,
              rows: 4,
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 resize-none"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-4 flex justify-end gap-3",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setEditing(false),
              className: "px-4 py-2 text-sm font-medium text-zinc-500 hover:text-zinc-700",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800",
              children: "Save Changes"
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: showDeleteConfirm,
      onOpenChange: setShowDeleteConfirm,
      onConfirm: handleConfirmDelete,
      title: "Delete Collection",
      description: "Are you sure you want to delete this collection? This action cannot be undone.",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
});
const route8 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$m,
  default: studio_$slug_videos_collections_$id,
  loader: loader$1j
}, Symbol.toStringTag, { value: "Module" }));
const loader$1i = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  const pageId = args.params.pageId;
  try {
    const pages = await apiRequest("/website/pages", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    const page = pages.find((p) => p.id === pageId);
    if (!page) {
      throw new Error("Page not found");
    }
    return {
      page,
      error: null,
      slug
    };
  } catch (e) {
    return {
      page: null,
      error: e.message,
      slug
    };
  }
};
const studio_$slug_website_editor_$pageId = UNSAFE_withComponentProps(function WebsiteEditor() {
  const {
    page: initialPage,
    error,
    slug
  } = useLoaderData();
  const {
    getToken
  } = useAuth();
  const navigate = useNavigate();
  const params = useParams();
  const [saving, setSaving] = useState(false);
  const [lastSaved, setLastSaved] = useState(null);
  const [data, setData] = useState(initialPage?.content || {
    root: {
      props: {}
    },
    content: []
  });
  const handleSave = async (puckData) => {
    setSaving(true);
    try {
      const token = await getToken();
      await apiRequest(`/website/pages/${params.pageId}`, token, {
        method: "PUT",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          content: puckData
        })
      });
      setLastSaved(/* @__PURE__ */ new Date());
      toast.success("Page saved");
    } catch (e) {
      toast.error("Failed to save: " + e.message);
    } finally {
      setSaving(false);
    }
  };
  if (error) {
    return /* @__PURE__ */ jsxs("div", {
      className: "p-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",
        children: ["Error: ", error]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => navigate(`/studio/${slug}/website/pages`),
        className: "mt-4 text-blue-600 hover:underline flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(ArrowLeft, {
          size: 16
        }), " Back to Pages"]
      })]
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "h-screen flex flex-col",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "bg-white border-b border-zinc-200 px-4 py-3 flex items-center justify-between z-50",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => navigate(`/studio/${slug}/website/pages`),
          className: "flex items-center gap-2 text-zinc-600 hover:text-zinc-900",
          children: [/* @__PURE__ */ jsx(ArrowLeft, {
            size: 18
          }), /* @__PURE__ */ jsx("span", {
            className: "text-sm",
            children: "Back"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "h-6 w-px bg-zinc-200"
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "font-medium text-zinc-900",
            children: initialPage?.title
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-xs text-zinc-500",
            children: ["/", initialPage?.slug]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [lastSaved && /* @__PURE__ */ jsxs("span", {
          className: "text-xs text-zinc-400",
          children: ["Saved ", lastSaved.toLocaleTimeString()]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => window.open(`/site/${slug}/${initialPage?.slug}`, "_blank"),
          className: "flex items-center gap-2 px-3 py-1.5 text-sm text-zinc-600 hover:bg-zinc-100 rounded-lg",
          children: [/* @__PURE__ */ jsx(Eye, {
            size: 16
          }), "Preview"]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => handleSave(data),
          disabled: saving,
          className: "flex items-center gap-2 px-4 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50",
          children: [/* @__PURE__ */ jsx(Save, {
            size: 16
          }), saving ? "Saving..." : "Save"]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-hidden",
      children: /* @__PURE__ */ jsx(Puck, {
        config: puckConfig,
        data,
        onPublish: handleSave,
        onChange: setData
      })
    })]
  });
});
const route9 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_website_editor_$pageId,
  loader: loader$1i
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_financials_myPayouts = UNSAFE_withComponentProps(function MyPayouts() {
  const {
    me
  } = useOutletContext();
  const [token, setToken] = useState(null);
  const [history, setHistory] = useState([]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    window.Clerk?.session?.getToken().then((t) => {
      setToken(t);
    });
  }, []);
  useEffect(() => {
    if (!token) return;
    const fetchHistory = async () => {
      try {
        const res = await apiRequest("/payroll/history?mine=true", token);
        setHistory(res.history);
      } catch (e) {
        console.error(e);
      } finally {
        setLoading(false);
      }
    };
    fetchHistory();
  }, [token]);
  if (!token || loading) return /* @__PURE__ */ jsx("div", {
    className: "p-8",
    children: /* @__PURE__ */ jsx(Loader2, {
      className: "animate-spin"
    })
  });
  const totalPaid = history.filter((h) => h.status === "paid").reduce((acc, curr) => acc + curr.amount, 0);
  const pending = history.filter((h) => h.status === "processing").reduce((acc, curr) => acc + curr.amount, 0);
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-4xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "My Payouts"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 text-sm",
        children: "Track your earnings and payout status."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-3 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-lg",
          children: /* @__PURE__ */ jsx(DollarSign, {
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm text-zinc-500",
            children: "Total Paid (YTD)"
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
            children: ["$", (totalPaid / 100).toFixed(2)]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-3 bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 rounded-lg",
          children: /* @__PURE__ */ jsx(Calendar, {
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm text-zinc-500",
            children: "Pending Processing"
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
            children: ["$", (pending / 100).toFixed(2)]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",
      children: /* @__PURE__ */ jsxs("table", {
        className: "w-full text-sm text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "p-4",
              children: "Period"
            }), /* @__PURE__ */ jsx("th", {
              className: "p-4",
              children: "Amount"
            }), /* @__PURE__ */ jsx("th", {
              className: "p-4",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "p-4",
              children: "Date Paid"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-200 dark:divide-zinc-800",
          children: [history.map((row) => /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsxs("td", {
              className: "p-4",
              children: [new Date(row.periodStart).toLocaleDateString(), " - ", new Date(row.periodEnd).toLocaleDateString()]
            }), /* @__PURE__ */ jsxs("td", {
              className: "p-4 font-mono font-medium",
              children: ["$", (row.amount / 100).toFixed(2)]
            }), /* @__PURE__ */ jsx("td", {
              className: "p-4",
              children: /* @__PURE__ */ jsx("span", {
                className: `px-2 py-1 rounded-full text-xs font-medium ${row.status === "paid" ? "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400" : "bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,
                children: row.status.toUpperCase()
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "p-4 text-zinc-500",
              children: row.status === "paid" && row.paidAt ? new Date(row.paidAt).toLocaleDateString() : "-"
            })]
          }, row.id)), history.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 4,
              className: "p-8 text-center text-zinc-500",
              children: "No payouts found."
            })
          })]
        })]
      })
    })]
  });
});
const route10 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_financials_myPayouts
}, Symbol.toStringTag, { value: "Module" }));
const loader$1h = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    videoId,
    slug
  } = args.params;
  const data = await apiRequest(`/video-management/`, token, {
    headers: {
      "X-Tenant-Slug": slug
    }
  });
  const video = data?.videos.find((v) => v.id === videoId);
  if (!video) throw new Response("Video Not Found", {
    status: 404
  });
  const branding = await apiRequest(`/video-management/branding`, token, {
    headers: {
      "X-Tenant-Slug": slug
    }
  });
  return {
    video,
    branding
  };
};
const action$l = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    videoId,
    slug
  } = args.params;
  const formData = await args.request.formData();
  const trimStart = formData.get("trimStart");
  const trimEnd = formData.get("trimEnd");
  await apiRequest(`/video-management/${videoId}`, token, {
    method: "PATCH",
    headers: {
      "X-Tenant-Slug": slug
    },
    body: JSON.stringify({
      trimStart: Number(trimStart),
      trimEnd: Number(trimEnd)
    })
  });
  return {
    success: true
  };
};
const studio_$slug_videos_edit_$videoId = UNSAFE_withComponentProps(function EditVideo() {
  const {
    video,
    branding
  } = useLoaderData();
  const navigate = useNavigate();
  const [start, setStart] = useState(video.trimStart || 0);
  const [end, setEnd] = useState(video.trimEnd || video.duration);
  const videoRef = useRef(null);
  useEffect(() => {
    if (videoRef.current) {
      const checkTime = () => {
        if (videoRef.current && videoRef.current.currentTime > end) {
          videoRef.current.pause();
          videoRef.current.currentTime = end;
        }
      };
      videoRef.current.addEventListener("timeupdate", checkTime);
      return () => videoRef.current?.removeEventListener("timeupdate", checkTime);
    }
  }, [end]);
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6 max-w-4xl mx-auto",
    children: [/* @__PURE__ */ jsx("button", {
      onClick: () => navigate(".."),
      className: "mb-4 text-sm text-zinc-500 hover:underline",
      children: "â† Back to Library"
    }), /* @__PURE__ */ jsxs("h1", {
      className: "text-2xl font-bold mb-2",
      children: ["Edit: ", video.title]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "md:col-span-2",
        children: [/* @__PURE__ */ jsx("div", {
          className: "bg-black aspect-video rounded-lg overflow-hidden relative",
          children: /* @__PURE__ */ jsx("div", {
            className: "w-full h-full flex items-center justify-center text-white",
            children: video.cloudflareStreamId ? /* @__PURE__ */ jsx("iframe", {
              src: `https://customer-<your-code>.cloudflarestream.com/${video.cloudflareStreamId}/iframe`,
              className: "w-full h-full",
              allow: "accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",
              allowFullScreen: true
            }) : /* @__PURE__ */ jsx("p", {
              children: "Video Processing or Unavailable"
            })
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "mt-6 bg-white p-4 rounded border",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-bold mb-4",
            children: "Trimming"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-4 items-center",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex-1",
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-bold text-zinc-500 uppercase",
                children: "Start Time (s)"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                value: start,
                onChange: (e) => setStart(Number(e.target.value)),
                className: "w-full border p-2 rounded"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1",
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-bold text-zinc-500 uppercase",
                children: "End Time (s)"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                value: end,
                onChange: (e) => setEnd(Number(e.target.value)),
                className: "w-full border p-2 rounded"
              })]
            })]
          }), /* @__PURE__ */ jsxs(Form, {
            method: "post",
            className: "mt-4 flex justify-end",
            children: [/* @__PURE__ */ jsx("input", {
              type: "hidden",
              name: "trimStart",
              value: start
            }), /* @__PURE__ */ jsx("input", {
              type: "hidden",
              name: "trimEnd",
              value: end
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "bg-blue-600 text-white px-4 py-2 rounded font-medium hover:bg-blue-700",
              children: "Save Changes"
            })]
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white p-4 rounded border",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-bold mb-4",
            children: "Branding"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 mb-4",
            children: "Intros and Outros are applied automatically by the player."
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Intro"
              }), /* @__PURE__ */ jsxs("select", {
                className: "w-full border p-2 rounded text-sm",
                children: [/* @__PURE__ */ jsx("option", {
                  value: "",
                  children: "None"
                }), branding.filter((b) => b.type === "intro").map((b) => /* @__PURE__ */ jsx("option", {
                  value: b.id,
                  selected: b.active,
                  children: b.title
                }, b.id))]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Outro"
              }), /* @__PURE__ */ jsxs("select", {
                className: "w-full border p-2 rounded text-sm",
                children: [/* @__PURE__ */ jsx("option", {
                  value: "",
                  children: "None"
                }), branding.filter((b) => b.type === "outro").map((b) => /* @__PURE__ */ jsx("option", {
                  value: b.id,
                  selected: b.active,
                  children: b.title
                }, b.id))]
              })]
            }), /* @__PURE__ */ jsx("button", {
              className: "w-full mt-2 bg-zinc-100 text-zinc-700 px-3 py-2 rounded text-sm font-medium hover:bg-zinc-200",
              children: "Update Branding"
            })]
          })]
        })
      })]
    })]
  });
});
const route11 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$l,
  default: studio_$slug_videos_edit_$videoId,
  loader: loader$1h
}, Symbol.toStringTag, { value: "Module" }));
function Modal({ isOpen, onClose, title, children, maxWidth = "max-w-md" }) {
  useEffect(() => {
    const handleEscape = (e) => {
      if (e.key === "Escape") onClose();
    };
    if (isOpen) {
      document.addEventListener("keydown", handleEscape);
      document.body.style.overflow = "hidden";
    }
    return () => {
      document.removeEventListener("keydown", handleEscape);
      document.body.style.overflow = "unset";
    };
  }, [isOpen, onClose]);
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxs("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4", children: [
    /* @__PURE__ */ jsx(
      "div",
      {
        className: "absolute inset-0 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",
        onClick: onClose
      }
    ),
    /* @__PURE__ */ jsxs(
      "div",
      {
        className: `relative rounded-xl shadow-2xl w-full ${maxWidth} overflow-hidden animate-in zoom-in-95 duration-200 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800`,
        role: "dialog",
        "aria-modal": "true",
        children: [
          title && /* @__PURE__ */ jsxs("div", { className: "px-6 py-4 flex items-center justify-between bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800", children: [
            /* @__PURE__ */ jsx("h3", { className: "font-semibold text-lg text-zinc-900 dark:text-zinc-100", children: title }),
            /* @__PURE__ */ jsx(
              "button",
              {
                onClick: onClose,
                className: "p-1 rounded-md transition-colors hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-500 dark:text-zinc-400",
                children: /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
                  /* @__PURE__ */ jsx("line", { x1: "18", y1: "6", x2: "6", y2: "18" }),
                  /* @__PURE__ */ jsx("line", { x1: "6", y1: "6", x2: "18", y2: "18" })
                ] })
              }
            )
          ] }),
          /* @__PURE__ */ jsx("div", { className: "p-6 text-zinc-900 dark:text-zinc-100", children })
        ]
      }
    )
  ] });
}
function SuccessDialog({ isOpen, onClose, title = "Success", message }) {
  return /* @__PURE__ */ jsx(Modal, { isOpen, onClose, title, children: /* @__PURE__ */ jsxs("div", { className: "flex flex-col gap-4", children: [
    /* @__PURE__ */ jsxs("div", { className: "flex items-start gap-4", children: [
      /* @__PURE__ */ jsx("div", { className: "w-10 h-10 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 text-green-600", children: /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
        /* @__PURE__ */ jsx("path", { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }),
        /* @__PURE__ */ jsx("polyline", { points: "22 4 12 14.01 9 11.01" })
      ] }) }),
      /* @__PURE__ */ jsx("div", { className: "text-zinc-600 text-sm leading-relaxed pt-1", children: message })
    ] }),
    /* @__PURE__ */ jsx("div", { className: "flex justify-end pt-2", children: /* @__PURE__ */ jsx(
      "button",
      {
        onClick: onClose,
        className: "px-4 py-2 bg-zinc-100 hover:bg-zinc-200 text-zinc-900 rounded-lg font-medium text-sm transition-colors",
        children: "Dismiss"
      }
    ) })
  ] }) });
}
function ErrorDialog({ isOpen, onClose, title = "Error", message }) {
  return /* @__PURE__ */ jsx(Modal, { isOpen, onClose, title, children: /* @__PURE__ */ jsxs("div", { className: "flex flex-col gap-4", children: [
    /* @__PURE__ */ jsxs("div", { className: "flex items-start gap-4", children: [
      /* @__PURE__ */ jsx("div", { className: "w-10 h-10 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0 text-red-600", children: /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
        /* @__PURE__ */ jsx("circle", { cx: "12", cy: "12", r: "10" }),
        /* @__PURE__ */ jsx("line", { x1: "12", y1: "8", x2: "12", y2: "12" }),
        /* @__PURE__ */ jsx("line", { x1: "12", y1: "16", x2: "12.01", y2: "16" })
      ] }) }),
      /* @__PURE__ */ jsx("div", { className: "text-zinc-600 text-sm leading-relaxed pt-1", children: message })
    ] }),
    /* @__PURE__ */ jsx("div", { className: "flex justify-end pt-2", children: /* @__PURE__ */ jsx(
      "button",
      {
        onClick: onClose,
        className: "px-4 py-2 bg-zinc-100 hover:bg-zinc-200 text-zinc-900 rounded-lg font-medium text-sm transition-colors",
        children: "Dismiss"
      }
    ) })
  ] }) });
}
function ConfirmationDialog({
  isOpen,
  onClose,
  onConfirm,
  title,
  message,
  confirmText = "Confirm",
  cancelText = "Cancel",
  isDestructive = false
}) {
  return /* @__PURE__ */ jsx(Modal, { isOpen, onClose, title, children: /* @__PURE__ */ jsxs("div", { className: "flex flex-col gap-6", children: [
    /* @__PURE__ */ jsx("p", { className: "text-zinc-600 text-sm leading-relaxed", children: message }),
    /* @__PURE__ */ jsxs("div", { className: "flex justify-end gap-3", children: [
      /* @__PURE__ */ jsx(
        "button",
        {
          onClick: onClose,
          className: "px-4 py-2 border border-zinc-200 text-zinc-700 hover:bg-zinc-50 rounded-lg font-medium text-sm transition-colors",
          children: cancelText
        }
      ),
      /* @__PURE__ */ jsx(
        "button",
        {
          onClick: onConfirm,
          className: `px-4 py-2 rounded-lg font-medium text-sm transition-colors text-white ${isDestructive ? "bg-red-600 hover:bg-red-700" : "bg-blue-600 hover:bg-blue-700"}`,
          children: confirmText
        }
      )
    ] })
  ] }) });
}
const loader$1g = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = args.params;
  try {
    const giftCardsRes = await apiRequest("/gift-cards", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      giftCards: giftCardsRes.giftCards || [],
      token
    };
  } catch (e) {
    return {
      giftCards: [],
      token
    };
  }
};
const studio_$slug_commerce_giftCards = UNSAFE_withComponentProps(function GiftCardsPage() {
  const {
    giftCards: initialCards,
    token
  } = useLoaderData();
  const {
    slug
  } = useParams();
  const {
    roles
  } = useOutletContext() || {};
  const isAdmin = roles?.includes("owner") || roles?.includes("instructor");
  const [giftCards, setGiftCards] = useState(initialCards);
  const [searchQuery, setSearchQuery] = useState("");
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState("list");
  const [showIssueModal, setShowIssueModal] = useState(false);
  const [showLinkModal, setShowLinkModal] = useState(false);
  const [expandedCardId, setExpandedCardId] = useState(null);
  const [transactions, setTransactions] = useState([]);
  const [loadingHistory, setLoadingHistory] = useState(false);
  const [activeMenuId, setActiveMenuId] = useState(null);
  const [issueData, setIssueData] = useState({
    amount: "",
    recipientEmail: "",
    notes: ""
  });
  const [issueSuccess, setIssueSuccess] = useState(null);
  const [confirmResendId, setConfirmResendId] = useState(null);
  const [linkCode, setLinkCode] = useState("");
  const [linkSuccess, setLinkSuccess] = useState(false);
  const [buyData, setBuyData] = useState({
    amount: "50",
    customAmount: "",
    isForSelf: true,
    recipientEmail: "",
    recipientName: "",
    senderName: "",
    message: ""
  });
  const refreshCards = async () => {
    const refresh = await apiRequest("/gift-cards", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    setGiftCards(refresh.giftCards || []);
  };
  const handleIssue = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const res = await apiRequest("/gift-cards/issue", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          amount: parseFloat(issueData.amount) * 100,
          recipientEmail: issueData.recipientEmail,
          notes: issueData.notes
        })
      });
      if (res.error) throw new Error(res.error);
      setIssueSuccess(`Card Issued: ${res.code}`);
      setIssueData({
        amount: "",
        recipientEmail: "",
        notes: ""
      });
      await refreshCards();
    } catch (e2) {
      toast.error(e2.message);
    } finally {
      setLoading(false);
    }
  };
  const handleResend = (cardId) => {
    setConfirmResendId(cardId);
  };
  const confirmResendAction = async () => {
    if (!confirmResendId) return;
    setLoading(true);
    try {
      const res = await apiRequest(`/gift-cards/${confirmResendId}/resend`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      if (res.error) throw new Error(res.error);
      toast.success("Email resent successfully!");
    } catch (e) {
      toast.error(e.message);
    } finally {
      setLoading(false);
      setConfirmResendId(null);
    }
  };
  const handleLinkCard = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const res = await apiRequest("/gift-cards/claim", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          code: linkCode
        })
      });
      if (res.error) throw new Error(res.error);
      setLinkCode("");
      setLinkSuccess(true);
      await refreshCards();
      setTimeout(() => {
        setShowLinkModal(false);
        setLinkSuccess(false);
      }, 1500);
    } catch (e2) {
      toast.error(e2.message);
    } finally {
      setLoading(false);
    }
  };
  const toggleHistory = async (cardId) => {
    if (expandedCardId === cardId) {
      setExpandedCardId(null);
      return;
    }
    setExpandedCardId(cardId);
    setLoadingHistory(true);
    setTransactions([]);
    try {
      const res = await apiRequest(`/gift-cards/${cardId}/transactions`, token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      if (res.transactions) setTransactions(res.transactions);
    } catch (e) {
      console.error(e);
    } finally {
      setLoadingHistory(false);
    }
  };
  const filteredCards = giftCards.filter((c) => c.code.toLowerCase().includes(searchQuery.toLowerCase()) || c.recipientEmail?.toLowerCase().includes(searchQuery.toLowerCase()));
  const getCheckoutUrl = () => {
    const amount = buyData.amount === "custom" ? buyData.customAmount : buyData.amount;
    const amountCents = parseFloat(amount) * 100;
    const params = new URLSearchParams();
    params.set("giftCardAmount", amountCents.toString());
    if (!buyData.isForSelf) {
      if (buyData.recipientEmail) params.set("recipientEmail", buyData.recipientEmail);
      if (buyData.recipientName) params.set("recipientName", buyData.recipientName);
      if (buyData.senderName) params.set("senderName", buyData.senderName);
      if (buyData.message) params.set("message", buyData.message);
    }
    return `/studio/${slug}/checkout?${params.toString()}`;
  };
  const [searchParams, setSearchParams] = useSearchParams();
  const claimCode = searchParams.get("claimCode");
  useEffect(() => {
    if (claimCode) {
      setLinkCode(claimCode.toUpperCase());
      setShowLinkModal(true);
      setSearchParams((params) => {
        params.delete("claimCode");
        return params;
      });
    }
  }, [claimCode]);
  useEffect(() => {
    const handleClick = () => setActiveMenuId(null);
    window.addEventListener("click", handleClick);
    return () => window.removeEventListener("click", handleClick);
  }, []);
  const totalIssued = giftCards.reduce((acc, c) => acc + c.initialValue, 0);
  const totalLiability = giftCards.reduce((acc, c) => acc + (c.status === "active" ? c.currentBalance : 0), 0);
  const redemptionRate = totalIssued > 0 ? (totalIssued - totalLiability) / totalIssued * 100 : 0;
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-7xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",
          children: [/* @__PURE__ */ jsx(Gift, {
            className: "text-blue-600"
          }), " Gift Cards"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 mt-1",
          children: isAdmin ? "Issue and manage gift cards. Sell them at checkout via POS." : "View your balance or purchase a gift card."
        })]
      }), !isAdmin && /* @__PURE__ */ jsxs("div", {
        className: "flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-xl",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setActiveTab("list"),
          className: `px-4 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === "list" ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm" : "text-zinc-500 hover:text-zinc-900 dark:text-zinc-400"}`,
          children: "My Cards"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setActiveTab("buy"),
          className: `px-4 py-2 text-sm font-bold rounded-lg transition-all ${activeTab === "buy" ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm" : "text-zinc-500 hover:text-zinc-900 dark:text-zinc-400"}`,
          children: "Buy Gift Card"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2",
        children: [activeTab === "list" && !isAdmin && /* @__PURE__ */ jsxs("button", {
          onClick: () => setShowLinkModal(true),
          className: "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 px-6 py-3 rounded-2xl font-bold flex items-center gap-2 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-all",
          children: [/* @__PURE__ */ jsx(Link$1, {
            size: 18
          }), " Link Card"]
        }), isAdmin && activeTab === "list" && /* @__PURE__ */ jsxs("button", {
          onClick: () => setShowIssueModal(true),
          className: "bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white px-6 py-3 rounded-2xl font-bold flex items-center gap-2 shadow-lg hover:translate-y-[-2px] transition-all",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 20
          }), " Issue New Card"]
        })]
      })]
    }), isAdmin || activeTab === "list" ? /* @__PURE__ */ jsxs("div", {
      className: "space-y-8",
      children: [isAdmin ? /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-4 gap-4 animate-in fade-in slide-in-from-top-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",
            children: "Total Liability"
          }), /* @__PURE__ */ jsxs("h2", {
            className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
            children: ["$", (totalLiability / 100).toLocaleString()]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",
            children: "Total Issued"
          }), /* @__PURE__ */ jsxs("h2", {
            className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
            children: ["$", (totalIssued / 100).toLocaleString()]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",
            children: "Redemption Rate"
          }), /* @__PURE__ */ jsxs("h2", {
            className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
            children: [redemptionRate.toFixed(1), "%"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",
            children: "Active Cards"
          }), /* @__PURE__ */ jsx("h2", {
            className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
            children: giftCards.filter((c) => c.status === "active").length
          })]
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-1 md:grid-cols-4 gap-4",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",
            children: "My Balance"
          }), /* @__PURE__ */ jsxs("h2", {
            className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
            children: ["$", (totalLiability / 100).toLocaleString()]
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [isAdmin && /* @__PURE__ */ jsxs("div", {
          className: "relative",
          children: [/* @__PURE__ */ jsx(Search, {
            className: "absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            placeholder: "Find by code or email...",
            value: searchQuery,
            onChange: (e) => setSearchQuery(e.target.value),
            className: "w-full pl-12 pr-4 py-3 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm overflow-visible",
          children: filteredCards.length === 0 ? /* @__PURE__ */ jsxs("div", {
            className: "p-12 text-center text-zinc-500",
            children: [/* @__PURE__ */ jsx(Ticket, {
              className: "h-12 w-12 mx-auto mb-4 opacity-20"
            }), /* @__PURE__ */ jsx("p", {
              children: "No gift cards found."
            })]
          }) : /* @__PURE__ */ jsxs("table", {
            className: "w-full text-left",
            children: [/* @__PURE__ */ jsx("thead", {
              className: "bg-zinc-50 dark:bg-zinc-800/50",
              children: /* @__PURE__ */ jsxs("tr", {
                children: [/* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",
                  children: "Code"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",
                  children: "Balance"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",
                  children: "Status"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",
                  children: "Issued"
                }), isAdmin && /* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",
                  children: "Recipient"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-6 py-4"
                })]
              })
            }), /* @__PURE__ */ jsx("tbody", {
              className: "divide-y divide-zinc-50 dark:divide-zinc-800",
              children: filteredCards.map((card) => /* @__PURE__ */ jsxs(Fragment, {
                children: [/* @__PURE__ */ jsxs("tr", {
                  className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",
                  children: [/* @__PURE__ */ jsx("td", {
                    className: "px-6 py-4 font-mono font-bold text-zinc-900 dark:text-zinc-100",
                    children: card.code
                  }), /* @__PURE__ */ jsxs("td", {
                    className: "px-6 py-4",
                    children: [/* @__PURE__ */ jsxs("span", {
                      className: "font-bold text-zinc-900 dark:text-zinc-100",
                      children: ["$", (card.currentBalance / 100).toFixed(2)]
                    }), /* @__PURE__ */ jsxs("span", {
                      className: "text-zinc-400 text-xs ml-1",
                      children: ["/ $", (card.initialValue / 100).toFixed(2)]
                    })]
                  }), /* @__PURE__ */ jsx("td", {
                    className: "px-6 py-4",
                    children: /* @__PURE__ */ jsx("span", {
                      className: `text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-tighter ${card.status === "active" ? "bg-emerald-100 text-emerald-700" : card.status === "exhausted" ? "bg-zinc-200 text-zinc-600" : "bg-red-100 text-red-700"}`,
                      children: card.status
                    })
                  }), /* @__PURE__ */ jsx("td", {
                    className: "px-6 py-4 text-xs text-zinc-500",
                    children: new Date(card.createdAt).toLocaleDateString()
                  }), isAdmin && /* @__PURE__ */ jsx("td", {
                    className: "px-6 py-4 text-xs text-zinc-500",
                    children: card.recipientEmail || "-"
                  }), /* @__PURE__ */ jsx("td", {
                    className: "px-6 py-4 text-right relative",
                    children: isAdmin ? /* @__PURE__ */ jsxs("div", {
                      className: "relative",
                      children: [/* @__PURE__ */ jsx("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          setActiveMenuId(activeMenuId === card.id ? null : card.id);
                        },
                        className: "text-zinc-400 hover:text-blue-600 transition-colors p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800",
                        children: /* @__PURE__ */ jsx(MoreHorizontal, {
                          size: 16
                        })
                      }), activeMenuId === card.id && /* @__PURE__ */ jsxs("div", {
                        className: "absolute right-0 top-full mt-1 w-48 bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-100 dark:border-zinc-800 z-50 overflow-hidden py-1",
                        children: [/* @__PURE__ */ jsxs("button", {
                          onClick: () => {
                            setActiveMenuId(null);
                            toggleHistory(card.id);
                          },
                          className: "w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 flex items-center gap-2",
                          children: [/* @__PURE__ */ jsx(History, {
                            size: 14
                          }), " View History"]
                        }), /* @__PURE__ */ jsxs("button", {
                          onClick: () => {
                            setActiveMenuId(null);
                            handleResend(card.id);
                          },
                          disabled: loading,
                          className: "w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 flex items-center gap-2",
                          children: [/* @__PURE__ */ jsx(Mail, {
                            size: 14
                          }), " ", loading ? "Sending..." : "Resend Email"]
                        }), /* @__PURE__ */ jsxs("button", {
                          onClick: () => {
                            setActiveMenuId(null);
                            toast.info("Void feature coming soon");
                          },
                          className: "w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 text-red-600 flex items-center gap-2 border-t border-zinc-100 dark:border-zinc-800",
                          children: [/* @__PURE__ */ jsx(Ban, {
                            size: 14
                          }), " Void Card"]
                        })]
                      })]
                    }) : /* @__PURE__ */ jsx("button", {
                      onClick: () => toggleHistory(card.id),
                      className: "text-zinc-400 hover:text-blue-600 transition-colors p-2",
                      children: expandedCardId === card.id ? /* @__PURE__ */ jsx(ChevronUp, {
                        size: 16
                      }) : /* @__PURE__ */ jsx(History, {
                        size: 16
                      })
                    })
                  })]
                }, card.id), expandedCardId === card.id && /* @__PURE__ */ jsx("tr", {
                  className: "bg-zinc-50/50 dark:bg-zinc-800/20",
                  children: /* @__PURE__ */ jsx("td", {
                    colSpan: isAdmin ? 6 : 5,
                    className: "px-6 py-4",
                    children: /* @__PURE__ */ jsxs("div", {
                      className: "bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl p-4 animate-in slide-in-from-top-2",
                      children: [/* @__PURE__ */ jsx("h4", {
                        className: "text-xs font-bold text-zinc-400 uppercase tracking-widest mb-3",
                        children: "Transaction History"
                      }), loadingHistory ? /* @__PURE__ */ jsx("div", {
                        className: "flex justify-center py-4",
                        children: /* @__PURE__ */ jsx(Loader2, {
                          className: "animate-spin text-zinc-300"
                        })
                      }) : transactions.length === 0 ? /* @__PURE__ */ jsx("p", {
                        className: "text-sm text-zinc-500",
                        children: "No transactions found."
                      }) : /* @__PURE__ */ jsx("div", {
                        className: "space-y-2",
                        children: transactions.map((tx) => /* @__PURE__ */ jsxs("div", {
                          className: "flex justify-between items-center text-sm p-2 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg",
                          children: [/* @__PURE__ */ jsxs("div", {
                            className: "flex items-center gap-3",
                            children: [/* @__PURE__ */ jsx("div", {
                              className: `w-8 h-8 rounded-full flex items-center justify-center ${tx.amount > 0 ? "bg-emerald-100 text-emerald-600" : "bg-red-100 text-red-600"}`,
                              children: tx.amount > 0 ? /* @__PURE__ */ jsx(Plus, {
                                size: 14
                              }) : /* @__PURE__ */ jsx("div", {
                                className: "w-2 h-[2px] bg-current"
                              })
                            }), /* @__PURE__ */ jsxs("div", {
                              children: [/* @__PURE__ */ jsx("p", {
                                className: "font-medium text-zinc-900 dark:text-zinc-100 capitalize",
                                children: tx.type
                              }), /* @__PURE__ */ jsx("p", {
                                className: "text-xs text-zinc-400",
                                children: new Date(tx.createdAt).toLocaleString()
                              })]
                            })]
                          }), /* @__PURE__ */ jsxs("span", {
                            className: `font-mono font-bold ${tx.amount > 0 ? "text-emerald-600" : "text-zinc-900 dark:text-zinc-100"}`,
                            children: [tx.amount > 0 ? "+" : "", "$", (tx.amount / 100).toFixed(2)]
                          })]
                        }, tx.id))
                      })]
                    })
                  })
                })]
              }))
            })]
          })
        })]
      })]
    }) : (
      /* BUY TAB CONTENT (Only for non-admin users) */
      /* @__PURE__ */ jsx("div", {
        className: "max-w-3xl mx-auto",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-xl overflow-hidden",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "p-8 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-800/30",
            children: [/* @__PURE__ */ jsx("h2", {
              className: "text-2xl font-black text-zinc-900 dark:text-zinc-100 mb-2",
              children: "Purchase Gift Card"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-500",
              children: "Give the gift of yoga and wellness. Sent instantly via email."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-8 space-y-8",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "space-y-4",
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                children: "Select Amount"
              }), /* @__PURE__ */ jsx("div", {
                className: "grid grid-cols-2 md:grid-cols-4 gap-4",
                children: ["25", "50", "100", "custom"].map((amt) => /* @__PURE__ */ jsx("button", {
                  onClick: () => setBuyData({
                    ...buyData,
                    amount: amt
                  }),
                  className: `py-4 px-4 rounded-2xl font-bold border-2 transition-all ${buyData.amount === amt ? "border-blue-600 bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" : "border-zinc-200 dark:border-zinc-800 text-zinc-600 dark:text-zinc-400 hover:border-zinc-300"}`,
                  children: amt === "custom" ? "Custom" : `$${amt}`
                }, amt))
              }), buyData.amount === "custom" && /* @__PURE__ */ jsx("div", {
                className: "animate-in fade-in slide-in-from-top-2",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "relative",
                  children: [/* @__PURE__ */ jsx("span", {
                    className: "absolute left-4 top-1/2 -translate-y-1/2 font-bold text-zinc-400",
                    children: "$"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "number",
                    placeholder: "Enter amount (e.g. 150)",
                    value: buyData.customAmount,
                    onChange: (e) => setBuyData({
                      ...buyData,
                      customAmount: e.target.value
                    }),
                    className: "w-full pl-8 pr-4 py-4 bg-zinc-50 dark:bg-zinc-800 border-none rounded-2xl font-bold text-lg outline-none focus:ring-2 focus:ring-blue-500"
                  })]
                })
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "space-y-4",
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                children: "Who is this for?"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-2xl",
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => setBuyData({
                    ...buyData,
                    isForSelf: true
                  }),
                  className: `flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all ${buyData.isForSelf ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm" : "text-zinc-500"}`,
                  children: "For Me"
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => setBuyData({
                    ...buyData,
                    isForSelf: false
                  }),
                  className: `flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all ${!buyData.isForSelf ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm" : "text-zinc-500"}`,
                  children: "For Someone Else"
                })]
              })]
            }), !buyData.isForSelf && /* @__PURE__ */ jsxs("div", {
              className: "space-y-4 animate-in fade-in slide-in-from-top-4",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-1 md:grid-cols-2 gap-4",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "space-y-1",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                    children: "Recipient Name"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "text",
                    placeholder: "Jane Doe",
                    value: buyData.recipientName,
                    onChange: (e) => setBuyData({
                      ...buyData,
                      recipientName: e.target.value
                    }),
                    className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "space-y-1",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                    children: "Recipient Email"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "email",
                    placeholder: "jane@example.com",
                    value: buyData.recipientEmail,
                    onChange: (e) => setBuyData({
                      ...buyData,
                      recipientEmail: e.target.value
                    }),
                    className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "space-y-1",
                children: [/* @__PURE__ */ jsx("label", {
                  className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                  children: "Your Name (From)"
                }), /* @__PURE__ */ jsx("input", {
                  type: "text",
                  placeholder: "Your Name",
                  value: buyData.senderName,
                  onChange: (e) => setBuyData({
                    ...buyData,
                    senderName: e.target.value
                  }),
                  className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "space-y-1",
                children: [/* @__PURE__ */ jsx("label", {
                  className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
                  children: "Message (Optional)"
                }), /* @__PURE__ */ jsx("textarea", {
                  placeholder: "Enjoy!",
                  rows: 3,
                  value: buyData.message,
                  onChange: (e) => setBuyData({
                    ...buyData,
                    message: e.target.value
                  }),
                  className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "pt-4",
              children: [/* @__PURE__ */ jsx("a", {
                href: getCheckoutUrl(),
                className: `block w-full py-4 rounded-2xl font-black text-center transition-all ${!buyData.isForSelf && !buyData.recipientEmail || buyData.amount === "custom" && !buyData.customAmount ? "bg-zinc-100 text-zinc-400 cursor-not-allowed" : "bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 hover:scale-[1.02] shadow-xl"}`,
                children: "Proceed to Checkout"
              }), /* @__PURE__ */ jsxs("p", {
                className: "text-center text-xs text-zinc-400 mt-4 flex items-center justify-center gap-1",
                children: [/* @__PURE__ */ jsx(CreditCard, {
                  size: 12
                }), " Secure payment via Stripe"]
              })]
            })]
          })]
        })
      })
    ), showLinkModal && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-3xl p-8 max-w-md w-full shadow-2xl scale-100 animate-in zoom-in-95",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-black text-zinc-900 dark:text-zinc-100 mb-2",
          children: "Link Gift Card"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mb-6",
          children: "Enter the code from your gift card email to add it to your wallet."
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleLinkCard,
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "space-y-1",
            children: [/* @__PURE__ */ jsx("label", {
              className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
              children: "Gift Card Code"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              placeholder: "GIFT-XXXX-XXXX",
              className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl font-mono text-sm outline-none focus:ring-2 focus:ring-blue-500 uppercase",
              value: linkCode,
              onChange: (e) => setLinkCode(e.target.value.toUpperCase()),
              required: true
            })]
          }), linkSuccess && /* @__PURE__ */ jsxs("div", {
            className: "p-3 bg-emerald-100 text-emerald-800 rounded-xl text-sm font-bold flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(CheckCircle, {
              size: 16
            }), " Card Linked Successfully!"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-2 pt-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setShowLinkModal(false),
              className: "flex-1 py-3 font-bold text-zinc-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-xl transition-colors",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: loading,
              className: "flex-1 py-3 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 font-bold rounded-xl hover:scale-[1.02] transition-transform shadow-lg disabled:opacity-50 disabled:hover:scale-100",
              children: loading ? /* @__PURE__ */ jsx(Loader2, {
                className: "animate-spin w-5 h-5 mx-auto"
              }) : "Link Card"
            })]
          })]
        })]
      })
    }), showIssueModal && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-3xl p-8 max-w-md w-full shadow-2xl scale-100 animate-in zoom-in-95",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-black text-zinc-900 dark:text-zinc-100 mb-2",
          children: "Issue Gift Card"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mb-6",
          children: "Create a new gift card manually."
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleIssue,
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "space-y-1",
            children: [/* @__PURE__ */ jsx("label", {
              className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
              children: "Amount ($)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              placeholder: "50.00",
              className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl font-bold text-lg outline-none focus:ring-2 focus:ring-blue-500",
              value: issueData.amount,
              onChange: (e) => setIssueData({
                ...issueData,
                amount: e.target.value
              }),
              required: true
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-1",
            children: [/* @__PURE__ */ jsx("label", {
              className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
              children: "Recipient Email"
            }), /* @__PURE__ */ jsx("input", {
              type: "email",
              placeholder: "customer@example.com",
              className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500",
              value: issueData.recipientEmail,
              onChange: (e) => setIssueData({
                ...issueData,
                recipientEmail: e.target.value
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-1",
            children: [/* @__PURE__ */ jsx("label", {
              className: "text-xs font-bold text-zinc-400 uppercase tracking-widest",
              children: "Notes (Internal)"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              placeholder: "Reason for issuance...",
              className: "w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500",
              value: issueData.notes,
              onChange: (e) => setIssueData({
                ...issueData,
                notes: e.target.value
              })
            })]
          }), issueSuccess && /* @__PURE__ */ jsxs("div", {
            className: "p-3 bg-emerald-100 text-emerald-800 rounded-xl text-sm font-bold flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(CheckCircle, {
              size: 16
            }), " ", issueSuccess]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-2 pt-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setShowIssueModal(false),
              className: "flex-1 py-3 font-bold text-zinc-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-xl transition-colors",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: loading,
              className: "flex-1 py-3 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 font-bold rounded-xl hover:scale-[1.02] transition-transform shadow-lg disabled:opacity-50 disabled:hover:scale-100",
              children: loading ? /* @__PURE__ */ jsx(Loader2, {
                className: "animate-spin w-5 h-5 mx-auto"
              }) : "Issue Card"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmResendId,
      onClose: () => setConfirmResendId(null),
      onConfirm: confirmResendAction,
      title: "Resend Gift Card",
      message: "Are you sure you want to resend the gift card email to the recipient?",
      confirmText: "Resend Email"
    })]
  });
});
const route12 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_commerce_giftCards,
  loader: loader$1g
}, Symbol.toStringTag, { value: "Module" }));
function Tabs({ defaultValue, className, children, ...props }) {
  return /* @__PURE__ */ jsx(TabsProvider, { defaultValue, className, children });
}
const TabsContext = createContext(null);
function TabsProvider({ defaultValue, children, className }) {
  const [activeTab, setActiveTab] = useState(defaultValue);
  return /* @__PURE__ */ jsx(TabsContext.Provider, { value: { activeTab, setActiveTab }, children: /* @__PURE__ */ jsx("div", { className, children }) });
}
function TabsList({ className, children }) {
  return /* @__PURE__ */ jsx("div", { className: `inline-flex h-9 items-center justify-center rounded-lg bg-zinc-100 p-1 text-zinc-500 dark:bg-zinc-800 dark:text-zinc-400 ${className}`, children });
}
function TabsTrigger({ value, children, className }) {
  const { activeTab, setActiveTab } = useContext(TabsContext);
  const isActive = activeTab === value;
  return /* @__PURE__ */ jsx(
    "button",
    {
      onClick: () => setActiveTab(value),
      className: `inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 
            ${isActive ? "bg-white text-zinc-950 shadow-sm dark:bg-zinc-950 dark:text-zinc-50" : "hover:bg-zinc-200 dark:hover:bg-zinc-700"} 
            ${className}`,
      children
    }
  );
}
function TabsContent({ value, children, className }) {
  const { activeTab } = useContext(TabsContext);
  if (activeTab !== value) return null;
  return /* @__PURE__ */ jsx("div", { className: `mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 ${className}`, children });
}
const studio_$slug_financials_payroll = UNSAFE_withComponentProps(function PayrollDashboard() {
  const {
    tenant
  } = useOutletContext();
  const [token, setToken] = useState(null);
  useEffect(() => {
    window.Clerk?.session?.getToken().then(setToken);
  }, []);
  if (!token) return /* @__PURE__ */ jsx("div", {
    className: "p-8",
    children: /* @__PURE__ */ jsx(Loader2, {
      className: "animate-spin"
    })
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Instructor Payroll"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 text-sm",
        children: "Automate calculation and tracking of payouts."
      })]
    }), /* @__PURE__ */ jsxs(Tabs, {
      defaultValue: "run",
      className: "space-y-6",
      children: [/* @__PURE__ */ jsxs(TabsList, {
        children: [/* @__PURE__ */ jsx(TabsTrigger, {
          value: "run",
          children: "Run Payroll"
        }), /* @__PURE__ */ jsx(TabsTrigger, {
          value: "history",
          children: "History"
        }), /* @__PURE__ */ jsx(TabsTrigger, {
          value: "config",
          children: "Configuration"
        })]
      }), /* @__PURE__ */ jsx(TabsContent, {
        value: "run",
        children: /* @__PURE__ */ jsx(RunPayroll, {
          token
        })
      }), /* @__PURE__ */ jsx(TabsContent, {
        value: "history",
        children: /* @__PURE__ */ jsx(PayrollHistory, {
          token
        })
      }), /* @__PURE__ */ jsx(TabsContent, {
        value: "config",
        children: /* @__PURE__ */ jsx(PayrollConfig, {
          token
        })
      })]
    })]
  });
});
function RunPayroll({
  token
}) {
  const [startDate, setStartDate] = useState(format(new Date((/* @__PURE__ */ new Date()).setDate(1)), "yyyy-MM-dd"));
  const [endDate, setEndDate] = useState(format(/* @__PURE__ */ new Date(), "yyyy-MM-dd"));
  const [preview, setPreview] = useState(null);
  const [loading, setLoading] = useState(false);
  const [showConfirm, setShowConfirm] = useState(false);
  const handlePreview = async () => {
    setLoading(true);
    try {
      const res = await apiRequest("/payroll/generate", token, {
        method: "POST",
        body: JSON.stringify({
          startDate,
          endDate,
          commit: false
        })
      });
      setPreview(res.preview);
    } catch (e) {
      console.error(e);
      toast.error("Failed to generate preview");
    } finally {
      setLoading(false);
    }
  };
  const handleCommit = async () => {
    setShowConfirm(true);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",
    children: [/* @__PURE__ */ jsx("h3", {
      className: "text-lg font-semibold mb-4",
      children: "Generate Cycle"
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex gap-4 items-end mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-xs font-medium text-zinc-500 mb-1",
          children: "Start Date"
        }), /* @__PURE__ */ jsx("input", {
          type: "date",
          value: startDate,
          onChange: (e) => setStartDate(e.target.value),
          className: "bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-xs font-medium text-zinc-500 mb-1",
          children: "End Date"
        }), /* @__PURE__ */ jsx("input", {
          type: "date",
          value: endDate,
          onChange: (e) => setEndDate(e.target.value),
          className: "bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: handlePreview,
        disabled: loading,
        className: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",
        children: loading ? "Processing..." : "Preview Calculation"
      })]
    }), preview && /* @__PURE__ */ jsxs("div", {
      className: "space-y-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-zinc-50 dark:bg-zinc-800/50 p-4 rounded-lg flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("span", {
          className: "font-medium text-zinc-700 dark:text-zinc-300",
          children: "Total Calculation"
        }), /* @__PURE__ */ jsxs("span", {
          className: "text-xl font-bold text-green-600",
          children: ["$", (preview.reduce((acc, curr) => acc + curr.amount, 0) / 100).toFixed(2)]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "space-y-2",
        children: preview.map((p) => /* @__PURE__ */ jsxs("div", {
          className: "border border-zinc-200 dark:border-zinc-800 rounded p-4 flex justify-between items-start",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "font-semibold text-zinc-900 dark:text-zinc-100",
              children: ["Instructor ID: ", p.instructorId.substring(0, 8), "..."]
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-xs text-zinc-500",
              children: [p.itemCount, " items calculated"]
            }), /* @__PURE__ */ jsx("ul", {
              className: "mt-2 text-xs text-zinc-500 space-y-1",
              children: p.items.map((item, i) => /* @__PURE__ */ jsxs("li", {
                children: ["â€¢ ", item.title, " (", new Date(item.date).toLocaleDateString(), "): ", item.details, " = ", /* @__PURE__ */ jsxs("strong", {
                  children: ["$", (item.amount / 100).toFixed(2)]
                })]
              }, i))
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-lg font-bold",
            children: ["$", (p.amount / 100).toFixed(2)]
          })]
        }, p.instructorId))
      }), preview.length === 0 && /* @__PURE__ */ jsx("div", {
        className: "text-zinc-500 text-sm",
        children: "No payouts calculated for this period. check configurations or activity."
      }), preview.length > 0 && /* @__PURE__ */ jsx("div", {
        className: "flex justify-end mt-6",
        children: /* @__PURE__ */ jsx("button", {
          onClick: handleCommit,
          disabled: loading,
          className: "bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow font-medium",
          children: "Generate & Save"
        })
      })]
    })]
  });
}
function PayrollHistory({
  token
}) {
  const [history, setHistory] = useState([]);
  const [itemToPay, setItemToPay] = useState(null);
  const [processPaymentId, setProcessPaymentId] = useState(null);
  const [processing, setProcessing] = useState(false);
  const fetchHistory = async () => {
    const res = await apiRequest("/payroll/history", token);
    setHistory(res.history);
  };
  useEffect(() => {
    fetchHistory();
  }, []);
  const markPaid = (id) => {
    setItemToPay(id);
  };
  const confirmMarkPaid = async () => {
    if (!itemToPay) return;
    await apiRequest(`/payroll/${itemToPay}/approve`, token, {
      method: "POST"
    });
    fetchHistory();
    setItemToPay(null);
  };
  const handlePayNow = (id) => {
    setProcessPaymentId(id);
  };
  const confirmPayNow = async () => {
    if (!processPaymentId) return;
    setProcessing(true);
    try {
      const res = await apiRequest(`/payroll/${processPaymentId}/pay`, token, {
        method: "POST"
      });
      if (res.error) {
        toast.error("Payment Failed: " + res.error);
      } else {
        toast.success("Payment Successful! Transfer ID: " + res.transferId);
        fetchHistory();
      }
    } catch (e) {
      toast.error("Payment Error: " + e.message);
    } finally {
      setProcessing(false);
      setProcessPaymentId(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",
    children: [/* @__PURE__ */ jsxs("table", {
      className: "w-full text-sm text-left",
      children: [/* @__PURE__ */ jsx("thead", {
        className: "bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",
        children: /* @__PURE__ */ jsxs("tr", {
          children: [/* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Period"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Instructor"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Amount"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Status"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Actions"
          })]
        })
      }), /* @__PURE__ */ jsxs("tbody", {
        className: "divide-y divide-zinc-200 dark:divide-zinc-800",
        children: [history.map((row) => /* @__PURE__ */ jsxs("tr", {
          children: [/* @__PURE__ */ jsxs("td", {
            className: "p-4",
            children: [new Date(row.periodStart).toLocaleDateString(), " - ", new Date(row.periodEnd).toLocaleDateString()]
          }), /* @__PURE__ */ jsxs("td", {
            className: "p-4 font-medium",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [row.instructorFirstName, " ", row.instructorLastName]
            }), row.stripeAccountId && /* @__PURE__ */ jsx("div", {
              className: "text-[10px] text-green-600 font-mono",
              children: "Connected"
            })]
          }), /* @__PURE__ */ jsxs("td", {
            className: "p-4 font-mono font-medium",
            children: ["$", (row.amount / 100).toFixed(2)]
          }), /* @__PURE__ */ jsx("td", {
            className: "p-4",
            children: /* @__PURE__ */ jsx("span", {
              className: `px-2 py-1 rounded-full text-xs font-medium ${row.status === "paid" ? "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400" : "bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,
              children: row.status.toUpperCase()
            })
          }), /* @__PURE__ */ jsxs("td", {
            className: "p-4 flex gap-2",
            children: [row.status !== "paid" && /* @__PURE__ */ jsxs(Fragment, {
              children: [/* @__PURE__ */ jsx("button", {
                onClick: () => markPaid(row.id),
                className: "text-zinc-600 hover:text-zinc-900 text-xs font-medium border border-zinc-200 rounded px-2 py-1",
                children: "Mark Paid (Manual)"
              }), row.stripeAccountId && /* @__PURE__ */ jsxs("button", {
                onClick: () => handlePayNow(row.id),
                className: "text-white bg-green-600 hover:bg-green-700 text-xs font-medium rounded px-2 py-1 shadow-sm flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(DollarSign, {
                  size: 12
                }), " Pay Now"]
              })]
            }), row.status === "paid" && row.paidAt && /* @__PURE__ */ jsxs("span", {
              className: "text-xs text-zinc-400",
              children: ["Paid ", new Date(row.paidAt).toLocaleDateString()]
            })]
          })]
        }, row.id)), history.length === 0 && /* @__PURE__ */ jsx("tr", {
          children: /* @__PURE__ */ jsx("td", {
            colSpan: 5,
            className: "p-8 text-center text-zinc-500",
            children: "No history found."
          })
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!itemToPay,
      onOpenChange: (open) => !open && setItemToPay(null),
      onConfirm: confirmMarkPaid,
      title: "Mark as Paid",
      description: "Are you sure you want to manually mark this record as paid?",
      confirmText: "Mark Paid"
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!processPaymentId,
      onOpenChange: (open) => !open && setProcessPaymentId(null),
      onConfirm: confirmPayNow,
      title: "Process Stripe Transfer",
      description: "This will instantly transfer funds from your platform balance to the instructor's connected Stripe account. This cannot be undone.",
      confirmText: processing ? "Processing..." : "Pay Now"
    })]
  });
}
function PayrollConfig({
  token
}) {
  const [instructors, setInstructors] = useState([]);
  const [editingId, setEditingId] = useState(null);
  const [formModel, setFormModel] = useState("flat");
  const [formRate, setFormRate] = useState("0");
  const fetchConfig = async () => {
    const res = await apiRequest("/payroll/config", token);
    setInstructors(res.instructors);
  };
  useEffect(() => {
    fetchConfig();
  }, []);
  const handleSave = async () => {
    if (!editingId) return;
    let rate = parseFloat(formRate);
    if (formModel === "flat" || formModel === "hourly") {
      rate = Math.round(rate * 100);
    } else {
      rate = Math.round(rate * 100);
    }
    await apiRequest("/payroll/config", token, {
      method: "POST",
      body: JSON.stringify({
        memberId: editingId,
        payModel: formModel,
        rate
      })
    });
    setEditingId(null);
    fetchConfig();
  };
  const startEdit = (inst) => {
    setEditingId(inst.memberId);
    if (inst.config?.payModel) {
      setFormModel(inst.config.payModel);
      setFormRate((inst.config.rate / 100).toString());
    } else {
      setFormModel("flat");
      setFormRate("0");
    }
  };
  return /* @__PURE__ */ jsx("div", {
    className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",
    children: /* @__PURE__ */ jsxs("table", {
      className: "w-full text-sm text-left",
      children: [/* @__PURE__ */ jsx("thead", {
        className: "bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",
        children: /* @__PURE__ */ jsxs("tr", {
          children: [/* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Name"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Current Model"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Rate"
          }), /* @__PURE__ */ jsx("th", {
            className: "p-4",
            children: "Action"
          })]
        })
      }), /* @__PURE__ */ jsx("tbody", {
        className: "divide-y divide-zinc-200 dark:divide-zinc-800",
        children: instructors.map((inst) => /* @__PURE__ */ jsxs("tr", {
          children: [/* @__PURE__ */ jsxs("td", {
            className: "p-4 font-medium",
            children: [inst.firstName, " ", inst.lastName]
          }), /* @__PURE__ */ jsx("td", {
            className: "p-4 text-zinc-600 dark:text-zinc-400 capitalize",
            children: inst.config ? inst.config.payModel : "Not Set"
          }), /* @__PURE__ */ jsx("td", {
            className: "p-4 font-mono",
            children: inst.config ? inst.config.payModel === "percentage" ? `${inst.config.rate / 100}%` : `$${(inst.config.rate / 100).toFixed(2)}` : "-"
          }), /* @__PURE__ */ jsx("td", {
            className: "p-4",
            children: /* @__PURE__ */ jsxs(Dialog, {
              children: [/* @__PURE__ */ jsx(DialogTrigger, {
                asChild: true,
                children: /* @__PURE__ */ jsx("button", {
                  onClick: () => startEdit(inst),
                  className: "text-blue-600 hover:text-blue-500 font-medium",
                  children: "Configure"
                })
              }), /* @__PURE__ */ jsxs(DialogContent, {
                children: [/* @__PURE__ */ jsxs(DialogHeader, {
                  children: [/* @__PURE__ */ jsx(DialogTitle, {
                    children: "Configure Payroll"
                  }), /* @__PURE__ */ jsxs(DialogDescription, {
                    children: ["Set default pay rate for ", inst.firstName, "."]
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "space-y-4 py-4",
                  children: [/* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsx("label", {
                      className: "block text-sm font-medium mb-1",
                      children: "Pay Model"
                    }), /* @__PURE__ */ jsxs("select", {
                      className: "w-full rounded border border-zinc-300 p-2",
                      value: formModel,
                      onChange: (e) => setFormModel(e.target.value),
                      children: [/* @__PURE__ */ jsx("option", {
                        value: "flat",
                        children: "Flat Rate (Per Class)"
                      }), /* @__PURE__ */ jsx("option", {
                        value: "hourly",
                        children: "Hourly Rate"
                      }), /* @__PURE__ */ jsx("option", {
                        value: "percentage",
                        children: "Revenue Share (%)"
                      })]
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsx("label", {
                      className: "block text-sm font-medium mb-1",
                      children: formModel === "percentage" ? "Percentage (%)" : "Rate ($)"
                    }), /* @__PURE__ */ jsx("input", {
                      type: "number",
                      step: "0.01",
                      className: "w-full rounded border border-zinc-300 p-2",
                      value: formRate,
                      onChange: (e) => setFormRate(e.target.value)
                    })]
                  }), /* @__PURE__ */ jsx("button", {
                    onClick: handleSave,
                    className: "w-full bg-blue-600 text-white rounded py-2 font-medium",
                    children: "Save Configuration"
                  })]
                })]
              })]
            })
          })]
        }, inst.memberId))
      })]
    })
  });
}
const route13 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_financials_payroll
}, Symbol.toStringTag, { value: "Module" }));
const loader$1f = async ({
  params
}) => {
  return redirect(`/studio/${params.slug}/finances`);
};
const route14 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  loader: loader$1f
}, Symbol.toStringTag, { value: "Module" }));
const loader$1e = async (args) => {
  const {
    params,
    request
  } = args;
  const {
    getToken,
    userId
  } = await getAuth(args);
  if (!userId) return {
    error: "Unauthorized",
    coupons: [],
    isStudent: false
  };
  const token = await getToken();
  const url = new URL(request.url);
  url.searchParams.get("view") === "student";
  try {
    const res = await apiRequest("/commerce/coupons", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      coupons: res.coupons || [],
      error: null,
      isStudent: false
    };
  } catch (e) {
    if (e.message?.includes("403") || e.message?.includes("Access Denied")) {
      return {
        coupons: [],
        error: null,
        isStudent: true
      };
    }
    return {
      coupons: [],
      error: "Failed to load coupons",
      isStudent: false
    };
  }
};
const studio_$slug_commerce_coupons = UNSAFE_withComponentProps(function CouponsPage() {
  const {
    coupons: initialCoupons,
    error,
    isStudent: apiIsStudent
  } = useLoaderData();
  const {
    tenant,
    isStudentView
  } = useOutletContext() || {};
  const effectiveStudentView = isStudentView || apiIsStudent;
  if (effectiveStudentView) {
    return /* @__PURE__ */ jsx(StudentCouponsView, {
      tenant
    });
  }
  return /* @__PURE__ */ jsx(AdminCouponsView, {
    initialCoupons,
    tenant
  });
});
function StudentCouponsView({
  tenant
}) {
  const [savedCoupons, setSavedCoupons] = useState([]);
  const [couponCode, setCouponCode] = useState("");
  const [loading, setLoading] = useState(false);
  const [validationResult, setValidationResult] = useState(null);
  const {
    getToken
  } = useAuth();
  useEffect(() => {
    const saved = localStorage.getItem(`coupons_${tenant?.slug}`);
    if (saved) {
      try {
        setSavedCoupons(JSON.parse(saved));
      } catch {
      }
    }
    const pending = sessionStorage.getItem("pending_coupon");
    if (pending) {
      setCouponCode(pending);
      handleValidate(pending);
      sessionStorage.removeItem("pending_coupon");
    }
  }, [tenant?.slug]);
  const handleValidate = async (code) => {
    const codeToValidate = code || couponCode;
    if (!codeToValidate.trim()) return;
    setLoading(true);
    setValidationResult(null);
    try {
      const token = await getToken();
      const res = await apiRequest(`/commerce/coupons/validate`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          code: codeToValidate.toUpperCase()
        })
      });
      if (res.valid) {
        setValidationResult({
          valid: true,
          coupon: res.coupon
        });
      } else {
        setValidationResult({
          valid: false,
          error: res.error || "Invalid coupon code"
        });
      }
    } catch (e) {
      setValidationResult({
        valid: false,
        error: e.message || "Failed to validate coupon"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleSaveCoupon = () => {
    if (!validationResult?.valid || !validationResult?.coupon) return;
    const coupon = validationResult.coupon;
    const existing = savedCoupons.find((c) => c.code === coupon.code);
    if (existing) {
      toast.info("This coupon is already saved");
      return;
    }
    const updated = [...savedCoupons, coupon];
    setSavedCoupons(updated);
    localStorage.setItem(`coupons_${tenant?.slug}`, JSON.stringify(updated));
    setCouponCode("");
    setValidationResult(null);
    toast.success("Coupon saved! It will be applied at checkout.");
  };
  const handleRemoveCoupon = (code) => {
    const updated = savedCoupons.filter((c) => c.code !== code);
    setSavedCoupons(updated);
    localStorage.setItem(`coupons_${tenant?.slug}`, JSON.stringify(updated));
    toast.success("Coupon removed");
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-4xl mx-auto",
    children: [/* @__PURE__ */ jsx("div", {
      className: "mb-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-12 h-12 bg-pink-100 dark:bg-pink-900/30 rounded-xl flex items-center justify-center",
          children: /* @__PURE__ */ jsx(Tag, {
            className: "text-pink-600 dark:text-pink-400",
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "My Coupons"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-500 dark:text-zinc-400 text-sm",
            children: "Enter and save discount codes for checkout."
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-6 mb-6 shadow-sm",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4",
        children: "Enter Coupon Code"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-3",
        children: [/* @__PURE__ */ jsx("input", {
          type: "text",
          className: "flex-1 border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-4 py-3 text-sm font-mono uppercase placeholder:normal-case placeholder:font-sans",
          placeholder: "Enter your coupon code",
          value: couponCode,
          onChange: (e) => {
            setCouponCode(e.target.value.toUpperCase());
            setValidationResult(null);
          },
          onKeyDown: (e) => e.key === "Enter" && handleValidate()
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => handleValidate(),
          disabled: loading || !couponCode.trim(),
          className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-6 py-3 rounded-lg text-sm font-bold hover:bg-zinc-800 disabled:opacity-50 transition-colors",
          children: loading ? "Checking..." : "Apply"
        })]
      }), validationResult && /* @__PURE__ */ jsx("div", {
        className: `mt-4 p-4 rounded-lg flex items-center gap-3 ${validationResult.valid ? "bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800" : "bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,
        children: validationResult.valid ? /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsx(CheckCircle, {
            className: "text-green-600 dark:text-green-400",
            size: 20
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex-1",
            children: [/* @__PURE__ */ jsx("span", {
              className: "font-bold text-green-700 dark:text-green-300",
              children: "Valid coupon!"
            }), /* @__PURE__ */ jsx("span", {
              className: "ml-2 text-green-600 dark:text-green-400",
              children: validationResult.coupon.type === "percent" ? `${validationResult.coupon.value}% off` : `$${(validationResult.coupon.value / 100).toFixed(2)} off`
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleSaveCoupon,
            className: "bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-green-700",
            children: "Save for Checkout"
          })]
        }) : /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsx(XCircle, {
            className: "text-red-600 dark:text-red-400",
            size: 20
          }), /* @__PURE__ */ jsx("span", {
            className: "text-red-700 dark:text-red-300",
            children: validationResult.error
          })]
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "px-6 py-4 border-b border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-bold text-zinc-900 dark:text-zinc-100",
          children: "Saved Coupons"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "These will be automatically applied at checkout."
        })]
      }), savedCoupons.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center text-zinc-400",
        children: [/* @__PURE__ */ jsx(Ticket, {
          className: "mx-auto h-12 w-12 mb-4 opacity-20"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-zinc-900 dark:text-zinc-100 font-bold mb-1",
          children: "No Saved Coupons"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm",
          children: "Enter a coupon code above to save it for checkout."
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "divide-y divide-zinc-100 dark:divide-zinc-800",
        children: savedCoupons.map((coupon) => /* @__PURE__ */ jsxs("div", {
          className: "px-6 py-4 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("span", {
              className: "font-mono font-bold text-zinc-800 dark:text-zinc-200 bg-zinc-100 dark:bg-zinc-800 px-3 py-1 rounded",
              children: coupon.code
            }), coupon.type === "percent" ? /* @__PURE__ */ jsxs("span", {
              className: "bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded text-xs font-bold",
              children: [coupon.value, "% OFF"]
            }) : /* @__PURE__ */ jsxs("span", {
              className: "bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 px-2 py-0.5 rounded text-xs font-bold",
              children: ["$", (coupon.value / 100).toFixed(2), " OFF"]
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => handleRemoveCoupon(coupon.code),
            className: "text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors",
            title: "Remove",
            children: /* @__PURE__ */ jsx(Trash2, {
              size: 16
            })
          })]
        }, coupon.code))
      })]
    })]
  });
}
function AdminCouponsView({
  initialCoupons,
  tenant
}) {
  const [coupons, setCoupons] = useState(initialCoupons || []);
  const [loading, setLoading] = useState(false);
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [form, setForm] = useState({
    code: "",
    type: "percent",
    value: "",
    usageLimit: ""
  });
  const [confirmDeactivateId, setConfirmDeactivateId] = useState(null);
  const {
    getToken
  } = useAuth();
  const fetchCoupons = async () => {
    const token = await getToken();
    const res = await apiRequest("/commerce/coupons", token, {
      headers: {
        "X-Tenant-Slug": tenant.slug
      }
    });
    setCoupons(res.coupons || []);
  };
  const handleCreate = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest("/commerce/coupons", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify(form)
      });
      if (res.error) throw new Error(res.error);
      setIsCreateOpen(false);
      setForm({
        code: "",
        type: "percent",
        value: "",
        usageLimit: ""
      });
      await fetchCoupons();
    } catch (e2) {
      toast.error(e2.message);
    } finally {
      setLoading(false);
    }
  };
  const handleDeactivate = (id) => {
    setConfirmDeactivateId(id);
  };
  const confirmDeactivateAction = async () => {
    if (!confirmDeactivateId) return;
    setLoading(true);
    try {
      const token = await getToken();
      await apiRequest(`/commerce/coupons/${confirmDeactivateId}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      await fetchCoupons();
      toast.success("Coupon deactivated");
    } catch (e) {
      toast.error(e.message);
    } finally {
      setLoading(false);
      setConfirmDeactivateId(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8 flex justify-between items-center",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-12 h-12 bg-pink-100 dark:bg-pink-900/30 rounded-xl flex items-center justify-center",
          children: /* @__PURE__ */ jsx(Tag, {
            className: "text-pink-600 dark:text-pink-400",
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "Coupons"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-500 dark:text-zinc-400 text-sm",
            children: "Manage discounts and promotional codes."
          })]
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreateOpen(true),
        className: "bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 transition-colors shadow-lg shadow-zinc-500/10 flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 16
        }), " New Coupon"]
      })]
    }), isCreateOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl max-w-md w-full p-6 shadow-2xl border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-4",
          children: "Create Coupon"
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleCreate,
          children: [/* @__PURE__ */ jsxs("div", {
            className: "mb-4",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
              children: "Coupon Code"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm font-mono uppercase",
              placeholder: "e.g. SUMMER25",
              value: form.code,
              onChange: (e) => setForm({
                ...form,
                code: e.target.value.toUpperCase()
              }),
              required: true
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4 mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "Type"
              }), /* @__PURE__ */ jsxs("select", {
                className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",
                value: form.type,
                onChange: (e) => setForm({
                  ...form,
                  type: e.target.value
                }),
                children: [/* @__PURE__ */ jsx("option", {
                  value: "percent",
                  children: "Percentage (%)"
                }), /* @__PURE__ */ jsx("option", {
                  value: "amount",
                  children: "Fixed Amount ($)"
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "Value"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",
                placeholder: form.type === "percent" ? "e.g. 10" : "e.g. 1000 (cents)",
                value: form.value,
                onChange: (e) => setForm({
                  ...form,
                  value: e.target.value
                }),
                required: true,
                min: "1"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-[10px] text-zinc-400 mt-1",
                children: form.type === "amount" ? "In cents (e.g. 1000 = $10.00)" : "Percentage value (1-100)"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "mb-6",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
              children: "Usage Limit (Optional)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",
              placeholder: "Unlimited",
              value: form.usageLimit,
              onChange: (e) => setForm({
                ...form,
                usageLimit: e.target.value
              }),
              min: "1"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsCreateOpen(false),
              className: "px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: loading,
              className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 disabled:opacity-50",
              children: loading ? "Creating..." : "Create Coupon"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm",
      children: coupons.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center text-zinc-400",
        children: [/* @__PURE__ */ jsx(Tag, {
          className: "mx-auto h-12 w-12 mb-4 opacity-20"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-zinc-900 dark:text-zinc-100 font-bold mb-1",
          children: "No Coupons Yet"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm",
          children: "Create your first discount code to get started."
        })]
      }) : /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left text-sm",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-4 font-bold text-zinc-900 dark:text-zinc-100",
              children: "Code"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-4 font-bold text-zinc-900 dark:text-zinc-100",
              children: "Discount"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-4 font-bold text-zinc-900 dark:text-zinc-100",
              children: "Usage Limit"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-4 font-bold text-zinc-900 dark:text-zinc-100",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-4 font-bold text-zinc-900 dark:text-zinc-100 text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: coupons.map((coupon) => /* @__PURE__ */ jsxs("tr", {
            className: "group hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 font-mono font-bold text-zinc-800 dark:text-zinc-200",
              children: coupon.code
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-zinc-600 dark:text-zinc-300",
              children: coupon.type === "percent" ? /* @__PURE__ */ jsxs("span", {
                className: "bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs font-bold",
                children: [coupon.value, "% OFF"]
              }) : /* @__PURE__ */ jsxs("span", {
                className: "bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs font-bold",
                children: ["$", (coupon.value / 100).toFixed(2), " OFF"]
              })
            }), /* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4 text-zinc-500",
              children: [coupon.usageCount || 0, " / ", coupon.usageLimit ? coupon.usageLimit : "âˆž"]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: coupon.active ? /* @__PURE__ */ jsxs("span", {
                className: "inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "w-1.5 h-1.5 rounded-full bg-green-500"
                }), " Active"]
              }) : /* @__PURE__ */ jsx("span", {
                className: "inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-bold bg-zinc-100 text-zinc-500",
                children: "Inactive"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right",
              children: coupon.active && /* @__PURE__ */ jsxs(Fragment, {
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => {
                    const link = `${window.location.origin}/studio/${tenant.slug}?coupon=${coupon.code}`;
                    navigator.clipboard.writeText(link);
                    toast.success("Coupon link copied to clipboard!");
                  },
                  className: "text-blue-500 hover:text-blue-700 hover:bg-blue-50 p-2 rounded-lg transition-colors mr-1",
                  title: "Copy Coupon Link",
                  children: /* @__PURE__ */ jsx(Link$1, {
                    size: 16
                  })
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => handleDeactivate(coupon.id),
                  disabled: loading,
                  className: "text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors",
                  title: "Deactivate Coupon",
                  children: /* @__PURE__ */ jsx(Trash2, {
                    size: 16
                  })
                })]
              })
            })]
          }, coupon.id))
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmDeactivateId,
      onClose: () => setConfirmDeactivateId(null),
      onConfirm: confirmDeactivateAction,
      title: "Deactivate Coupon",
      message: "Are you sure you want to deactivate this coupon? This action cannot be undone.",
      confirmText: "Deactivate",
      isDestructive: true
    })]
  });
}
const route15 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_commerce_coupons,
  loader: loader$1e
}, Symbol.toStringTag, { value: "Module" }));
const loader$1d = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const res = await apiRequest(`/commerce/packs`, token, {
    headers: {
      "X-Tenant-Slug": params.slug
    }
  });
  if (res.error) throw new Error(res.error);
  return {
    params,
    packs: res.packs
  };
};
const action$k = async (args) => {
  const {
    params,
    request
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "create_pack") {
    const name = formData.get("name");
    const credits = parseInt(formData.get("credits"));
    const price = parseFloat(formData.get("price")) * 100;
    const expirationDays = formData.get("expirationDays") ? parseInt(formData.get("expirationDays")) : null;
    const imageUrl = formData.get("imageUrl");
    const vodEnabled = formData.get("vodEnabled") === "on";
    const res = await apiRequest(`/commerce/packs`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": params.slug
      },
      body: JSON.stringify({
        name,
        credits,
        price,
        expirationDays,
        imageUrl,
        vodEnabled
      })
    });
    if (res.error) return {
      error: res.error
    };
    return {
      success: true
    };
  }
  return null;
};
const studio_$slug_commerce_packs = UNSAFE_withComponentProps(function ClassPacksPage() {
  const {
    packs,
    params
  } = useLoaderData();
  const {
    me,
    roles
  } = useOutletContext() || {};
  const navigation = useNavigation();
  const [isCreating, setIsCreating] = useState(false);
  const isSubmitting = navigation.state === "submitting";
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-5xl mx-auto py-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Class Packs"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Manage punch cards and credit bundles."
        })]
      }), (roles?.includes("owner") || roles?.includes("instructor")) && /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreating(!isCreating),
        className: "flex items-center gap-2 px-4 py-2 bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 rounded-md text-sm font-medium hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",
        children: [/* @__PURE__ */ jsx(Plus, {
          className: "h-4 w-4"
        }), "Create Pack"]
      })]
    }), isCreating && /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 mb-8 shadow-sm",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-lg font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
        children: "New Class Pack"
      }), /* @__PURE__ */ jsxs(Form, {
        method: "post",
        onSubmit: () => setIsCreating(false),
        children: [/* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "intent",
          value: "create_pack"
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Pack Name"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              name: "name",
              required: true,
              placeholder: "e.g. 10 Class Pass",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Credits"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              name: "credits",
              required: true,
              min: "1",
              placeholder: "Number of classes",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Price ($)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              name: "price",
              required: true,
              min: "0",
              step: "0.01",
              placeholder: "0.00",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Expiration (Days)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              name: "expirationDays",
              placeholder: "Optional (e.g. 90)",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
              children: "Leave blank for no expiration."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "md:col-span-2",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Cover Image"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-2",
              children: [/* @__PURE__ */ jsx("input", {
                type: "text",
                name: "imageUrl",
                placeholder: "Paste image URL here...",
                className: "flex-1 px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
              }), /* @__PURE__ */ jsxs("button", {
                type: "button",
                onClick: () => window.open("https://www.canva.com/create/social-media-graphics/", "_blank"),
                className: "px-3 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-md text-sm font-medium hover:from-purple-600 hover:to-indigo-700 flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "font-bold font-serif italic text-lg leading-none transform -translate-y-[1px]",
                  children: "C"
                }), "Design in Canva"]
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
              children: "Design your cover in Canva, then copy and paste the image link here."
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 mb-6",
          children: [/* @__PURE__ */ jsx("input", {
            type: "checkbox",
            name: "vodEnabled",
            id: "vodEnabled",
            className: "rounded border-zinc-300 dark:border-zinc-700 text-blue-600 focus:ring-blue-500"
          }), /* @__PURE__ */ jsx("label", {
            htmlFor: "vodEnabled",
            className: "text-sm font-medium text-zinc-700 dark:text-zinc-300",
            children: "Include VOD Access"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 ml-2",
            children: "(Allows entry to On-Demand Library)"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setIsCreating(false),
            className: "px-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm font-medium hover:bg-zinc-50 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300 transition-colors",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: isSubmitting,
            className: "px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 disabled:opacity-50",
            children: isSubmitting ? "Creating..." : "Create Pack"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",
      children: [packs.map((pack) => /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",
            children: /* @__PURE__ */ jsx(Package, {
              className: "h-6 w-6 text-blue-600 dark:text-blue-400"
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-400",
            children: "Active"
          })]
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",
          children: pack.name
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-3 mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center text-zinc-600 dark:text-zinc-400 text-sm",
            children: [/* @__PURE__ */ jsx(Package, {
              className: "h-4 w-4 mr-2"
            }), /* @__PURE__ */ jsxs("span", {
              children: [pack.credits, " Class Credits"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center text-zinc-600 dark:text-zinc-400 text-sm",
            children: [/* @__PURE__ */ jsx(DollarSign, {
              className: "h-4 w-4 mr-2"
            }), /* @__PURE__ */ jsxs("span", {
              children: ["$", (pack.price / 100).toFixed(2)]
            })]
          }), pack.expirationDays && /* @__PURE__ */ jsxs("div", {
            className: "flex items-center text-zinc-600 dark:text-zinc-400 text-sm",
            children: [/* @__PURE__ */ jsx(Calendar, {
              className: "h-4 w-4 mr-2"
            }), /* @__PURE__ */ jsxs("span", {
              children: ["Expires in ", pack.expirationDays, " days"]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-800",
          children: !me ? /* @__PURE__ */ jsx(Link, {
            to: `/sign-in?redirect_url=${encodeURIComponent(typeof window !== "undefined" ? window.location.pathname : "")}`,
            className: "block w-full text-center px-4 py-2 border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-md text-sm font-medium hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors",
            children: "Sign in to Buy"
          }) : !roles?.includes("student") ? /* @__PURE__ */ jsx("button", {
            disabled: true,
            className: "block w-full text-center px-4 py-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 dark:text-zinc-500 rounded-md text-sm font-medium cursor-not-allowed",
            children: "Students Only"
          }) : /* @__PURE__ */ jsx("a", {
            href: `/studio/${params.slug}/checkout?packId=${pack.id}`,
            className: "block w-full text-center px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors",
            children: "Buy Now"
          })
        })]
      }, pack.id)), packs.length === 0 && !isCreating && /* @__PURE__ */ jsxs("div", {
        className: "col-span-full text-center py-12 bg-zinc-50 dark:bg-zinc-900 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-lg text-zinc-500 dark:text-zinc-400",
        children: [/* @__PURE__ */ jsx(Package, {
          className: "h-10 w-10 mx-auto mb-3 text-zinc-400 dark:text-zinc-500"
        }), /* @__PURE__ */ jsx("p", {
          children: "No class packs created yet."
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setIsCreating(true),
          className: "text-blue-600 hover:text-blue-800 font-medium mt-2",
          children: "Create one now"
        })]
      })]
    })]
  });
});
const route16 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$k,
  default: studio_$slug_commerce_packs,
  loader: loader$1d
}, Symbol.toStringTag, { value: "Module" }));
const loader$1c = async (args) => {
  const {
    params
  } = args;
  const {
    getToken,
    userId
  } = await getAuth(args);
  if (!userId) return {
    substitutions: [],
    error: "Unauthorized"
  };
  const token = await getToken();
  try {
    const res = await apiRequest("/sub-dispatch/items", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      substitutions: res.requests || [],
      error: null
    };
  } catch (e) {
    return {
      substitutions: [],
      error: "Failed to load sub requests"
    };
  }
};
const studio_$slug_substitutions = UNSAFE_withComponentProps(function SubstitutionsPage() {
  const {
    substitutions: initialSubs,
    error
  } = useLoaderData();
  const {
    tenant,
    me
  } = useOutletContext() || {};
  const {
    getToken
  } = useAuth();
  const [subs, setSubs] = useState(initialSubs || []);
  const [loading, setLoading] = useState(false);
  const [errorState, setErrorState] = useState({
    isOpen: false,
    message: ""
  });
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [myClasses, setMyClasses] = useState([]);
  const [form, setForm] = useState({
    classId: "",
    notes: ""
  });
  const openCreate = async () => {
    setIsCreateOpen(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/classes?startDate=${(/* @__PURE__ */ new Date()).toISOString()}&instructorId=${me?.member?.id}`, token, {
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      setMyClasses(Array.isArray(res) ? res : []);
    } catch (e) {
      console.error(e);
    }
  };
  const handleCreate = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/sub-dispatch/classes/${form.classId}/request`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          message: form.notes
        })
      });
      if (res.error) throw new Error(res.error);
      setIsCreateOpen(false);
      setForm({
        classId: "",
        notes: ""
      });
      const refreshed = await apiRequest("/sub-dispatch/items", token, {
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      setSubs(refreshed.requests || []);
    } catch (e2) {
      setErrorState({
        isOpen: true,
        message: e2.message
      });
    } finally {
      setLoading(false);
    }
  };
  me?.roles?.includes("owner");
  const handleAction = async (id, action2) => {
    if (loading) return;
    setLoading(true);
    try {
      if (action2 !== "accept") return;
      const token = await getToken();
      const res = await apiRequest(`/sub-dispatch/items/${id}/accept`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      if (res.error) throw new Error(res.error);
      const refreshed = await apiRequest("/sub-dispatch/items", token, {
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      setSubs(refreshed.requests || []);
    } catch (e) {
      setErrorState({
        isOpen: true,
        message: e.message
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8 flex justify-between items-center",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",
          children: /* @__PURE__ */ jsx(RefreshCw, {
            className: "text-blue-600 dark:text-blue-400",
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "Substitutions"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-500 dark:text-zinc-400 text-sm",
            children: "Manage shift coverage and instructor changes."
          })]
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: openCreate,
        className: "bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 transition-colors shadow-lg shadow-zinc-500/10",
        children: "Request Cover"
      })]
    }), error && /* @__PURE__ */ jsx("div", {
      className: "mb-6 p-4 bg-red-50 text-red-700 rounded-lg text-sm border border-red-200",
      children: error
    }), isCreateOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl max-w-md w-full p-6 shadow-2xl border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-4",
          children: "Request Coverage"
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleCreate,
          children: [/* @__PURE__ */ jsxs("div", {
            className: "mb-4",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
              children: "Select Class"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",
              value: form.classId,
              onChange: (e) => setForm({
                ...form,
                classId: e.target.value
              }),
              required: true,
              children: [/* @__PURE__ */ jsx("option", {
                value: "",
                children: "-- Choose a Class --"
              }), myClasses.map((c) => /* @__PURE__ */ jsxs("option", {
                value: c.id,
                children: [new Date(c.startTime).toLocaleDateString(), " ", new Date(c.startTime).toLocaleTimeString([], {
                  hour: "2-digit",
                  minute: "2-digit"
                }), " - ", c.title]
              }, c.id))]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "mb-6",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
              children: "Notes (Optional)"
            }), /* @__PURE__ */ jsx("textarea", {
              className: "w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",
              rows: 3,
              placeholder: "Reason for sub request...",
              value: form.notes,
              onChange: (e) => setForm({
                ...form,
                notes: e.target.value
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsCreateOpen(false),
              className: "px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: loading || !form.classId,
              className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 disabled:opacity-50",
              children: loading ? "Submitting..." : "Submit Request"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 gap-8",
      children: [/* @__PURE__ */ jsx(Section, {
        title: "Needs Coverage",
        icon: /* @__PURE__ */ jsx(AlertCircle, {
          className: "text-amber-500",
          size: 18
        }),
        children: /* @__PURE__ */ jsx(SubList, {
          items: subs.filter((s) => s.status === "open"),
          onAction: handleAction,
          canClaim: true,
          currentMemberId: me?.member?.id,
          loading
        })
      }), /* @__PURE__ */ jsx(Section, {
        title: "Filled / Past",
        icon: /* @__PURE__ */ jsx(CheckCircle, {
          className: "text-green-500",
          size: 18
        }),
        children: /* @__PURE__ */ jsx(SubList, {
          items: subs.filter((s) => s.status === "filled"),
          onAction: handleAction,
          readOnly: true,
          loading
        })
      })]
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorState.isOpen,
      onClose: () => setErrorState({
        ...errorState,
        isOpen: false
      }),
      message: errorState.message
    })]
  });
});
function Section({
  title,
  icon,
  children
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 dark:bg-zinc-800/50 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [icon, /* @__PURE__ */ jsx("h3", {
          className: "font-bold text-zinc-800 dark:text-zinc-200",
          children: title
        })]
      }), /* @__PURE__ */ jsx("span", {
        className: "bg-zinc-200 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-widest",
        children: Array.isArray(children.props.items) ? children.props.items.length : 0
      })]
    }), /* @__PURE__ */ jsx("div", {
      children
    })]
  });
}
function SubList({
  items,
  onAction,
  canClaim,
  readOnly,
  currentMemberId,
  loading
}) {
  if (items.length === 0) {
    return /* @__PURE__ */ jsxs("div", {
      className: "p-12 text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "text-zinc-300 dark:text-zinc-700 mb-2 flex justify-center",
        children: /* @__PURE__ */ jsx(Clock, {
          size: 32
        })
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-400 text-sm italic",
        children: "No requests in this category."
      })]
    });
  }
  return /* @__PURE__ */ jsx("div", {
    className: "divide-y divide-zinc-100 dark:divide-zinc-800",
    children: items.map((sub) => /* @__PURE__ */ jsxs("div", {
      className: "p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/20 transition-colors flex flex-col md:flex-row md:items-center justify-between gap-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex-1",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 mb-1",
          children: [/* @__PURE__ */ jsx("div", {
            className: "font-bold text-lg text-zinc-900 dark:text-zinc-100",
            children: sub.classTitle
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5 rounded border border-zinc-200 dark:border-zinc-700 font-mono",
            children: sub.classId?.substring(0, 8)
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 flex items-center gap-1",
          children: [/* @__PURE__ */ jsx(Clock, {
            size: 14
          }), new Date(sub.startTime).toLocaleString([], {
            dateStyle: "full",
            timeStyle: "short"
          })]
        }), sub.message && /* @__PURE__ */ jsxs("div", {
          className: "mt-2 text-sm text-zinc-600 dark:text-zinc-300 italic",
          children: ['"', sub.message, '"']
        }), /* @__PURE__ */ jsx("div", {
          className: "mt-4 flex flex-wrap items-center gap-6 text-[10px] font-bold uppercase tracking-widest",
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex flex-col",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-400 mb-1",
              children: "Original Instructor"
            }), /* @__PURE__ */ jsx("span", {
              className: "text-zinc-800 dark:text-zinc-200",
              children: sub.originalInstructorName || "Unknown"
            })]
          })
        })]
      }), !readOnly && /* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-2",
        children: canClaim && sub.status === "open" && /* @__PURE__ */ jsx("button", {
          onClick: () => onAction(sub.id, "accept"),
          disabled: loading,
          className: "bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 disabled:opacity-50 transition-all hover:-translate-y-0.5",
          children: "Accept Shift"
        })
      }), sub.status === "filled" && /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2 text-green-600 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-xl border border-green-100 dark:border-green-900/30",
        children: [/* @__PURE__ */ jsx(CheckCircle, {
          size: 20
        }), /* @__PURE__ */ jsx("span", {
          className: "text-sm font-bold",
          children: "Filled"
        })]
      })]
    }, sub.id))
  });
}
const route17 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_substitutions,
  loader: loader$1c
}, Symbol.toStringTag, { value: "Module" }));
const loader$1b = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const [videoData, imageData, collectionsData] = await Promise.all([apiRequest(`/video-management/`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/uploads/images`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/video-management/collections`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    return {
      videos: videoData?.videos || [],
      storageUsage: videoData?.storageUsage || 0,
      images: imageData || [],
      collections: collectionsData || []
    };
  } catch (e) {
    console.error("Loader Failed", e);
    return {
      videos: [],
      storageUsage: 0,
      images: [],
      collections: []
    };
  }
};
const studio_$slug_videos__index = UNSAFE_withComponentProps(function StudioMediaLibrary() {
  const {
    videos,
    storageUsage,
    images,
    collections
  } = useLoaderData();
  const revalidator = useRevalidator();
  const [searchParams, setSearchParams] = useSearchParams();
  const {
    isStudentView
  } = useOutletContext();
  const rawTab = searchParams.get("tab") || "videos";
  const currentTab = isStudentView && rawTab === "images" ? "videos" : rawTab;
  const [viewMode, setViewMode] = useState("grid");
  const [selectedItem, setSelectedItem] = useState(null);
  const [isUploadOpen, setIsUploadOpen] = useState(false);
  const [uploadType, setUploadType] = useState("video");
  const [uploading, setUploading] = useState(false);
  const [error, setError] = useState(null);
  const handleVideoUpload = async (file) => {
    setUploading(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      const response = await apiRequest("/video-management/upload-url", token, {
        method: "POST",
        body: JSON.stringify({
          type: "vod"
        }),
        headers: {
          "X-Tenant-Slug": window.tenantSlug || ""
        }
        // Ideally use params or context
      });
      const {
        uploadUrl,
        uid
      } = response;
      const formData = new FormData();
      formData.append("file", file);
      const cfUpload = await fetch(uploadUrl, {
        method: "POST",
        body: formData
      });
      if (!cfUpload.ok) throw new Error("Upload to video server failed");
      await apiRequest("/video-management/", token, {
        method: "POST",
        body: JSON.stringify({
          title: file.name,
          cloudflareStreamId: uid
        })
      });
      revalidator.revalidate();
    } catch (e) {
      console.error(e);
      setError("Upload failed: " + e.message);
    } finally {
      setUploading(false);
    }
  };
  const handleImageUpload = async (file) => {
    setUploading(true);
    setError(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      const formData = new FormData();
      formData.append("file", file);
      const response = await fetch("/api/r2-image", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`
        },
        body: formData
      });
      if (!response.ok) throw new Error("Image upload failed");
      revalidator.revalidate();
    } catch (e) {
      setError("Upload failed: " + e.message);
    } finally {
      setUploading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex h-[calc(100vh-64px)] overflow-hidden",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex-1 flex flex-col min-w-0 bg-zinc-50/50 dark:bg-zinc-950",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-6 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
              children: "Media Library"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: isStudentView ? "Browse class recordings and video content." : "Manage your class recordings and photo assets."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [!isStudentView && /* @__PURE__ */ jsxs("div", {
              className: "bg-zinc-100 dark:bg-zinc-800 px-4 py-2 rounded-lg text-sm",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-600 dark:text-zinc-400",
                children: "Storage Used: "
              }), /* @__PURE__ */ jsx("span", {
                className: "font-bold text-zinc-900 dark:text-zinc-200",
                children: formatBytes(storageUsage)
              })]
            }), !isStudentView && (currentTab === "videos" ? /* @__PURE__ */ jsxs("label", {
              className: `bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${uploading ? "opacity-70 cursor-not-allowed" : ""}`,
              children: [/* @__PURE__ */ jsx(Upload, {
                size: 18
              }), uploading ? "Uploading..." : "Upload Video", /* @__PURE__ */ jsx("input", {
                type: "file",
                accept: "video/*",
                className: "hidden",
                onChange: (e) => e.target.files?.[0] && handleVideoUpload(e.target.files[0]),
                disabled: uploading
              })]
            }) : /* @__PURE__ */ jsxs("label", {
              className: `bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${uploading ? "opacity-70 cursor-not-allowed" : ""}`,
              children: [/* @__PURE__ */ jsx(Image$1, {
                size: 18
              }), uploading ? "Uploading..." : "Upload Image", /* @__PURE__ */ jsx("input", {
                type: "file",
                accept: "image/*",
                className: "hidden",
                onChange: (e) => e.target.files?.[0] && handleImageUpload(e.target.files[0]),
                disabled: uploading
              })]
            }))]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex space-x-6 border-b border-zinc-100 dark:border-zinc-800 -mb-px",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setSearchParams({
              tab: "videos"
            }),
            className: `pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${currentTab === "videos" ? "border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100" : "border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,
            children: [/* @__PURE__ */ jsx(Film, {
              size: 16
            }), " Videos (", videos.length, ")"]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: () => setSearchParams({
              tab: "collections"
            }),
            className: `pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${currentTab === "collections" ? "border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100" : "border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,
            children: [/* @__PURE__ */ jsx(Folder, {
              size: 16
            }), " Collections (", collections.length, ")"]
          }), !isStudentView && /* @__PURE__ */ jsxs("button", {
            onClick: () => setSearchParams({
              tab: "images"
            }),
            className: `pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${currentTab === "images" ? "border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100" : "border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,
            children: [/* @__PURE__ */ jsx(Image$1, {
              size: 16
            }), " Photos (", images.length, ")"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex-1 overflow-y-auto p-6",
        children: [error && /* @__PURE__ */ jsxs("div", {
          className: "bg-red-50 text-red-600 p-3 rounded mb-4 text-sm flex justify-between items-center",
          children: [error, /* @__PURE__ */ jsx("button", {
            onClick: () => setError(null),
            children: /* @__PURE__ */ jsx(X, {
              size: 14
            })
          })]
        }), currentTab === "videos" ? /* @__PURE__ */ jsx(VideoList, {
          videos,
          onSelect: setSelectedItem,
          selectedId: selectedItem?.id
        }) : currentTab === "collections" ? /* @__PURE__ */ jsx(CollectionList, {
          collections
        }) : /* @__PURE__ */ jsx(ImageList, {
          images,
          onSelect: setSelectedItem,
          selectedId: selectedItem?.id
        })]
      })]
    }), selectedItem && /* @__PURE__ */ jsx(DetailsSidebar, {
      item: selectedItem,
      type: currentTab === "videos" ? "video" : "image",
      onClose: () => setSelectedItem(null),
      onUpdate: () => {
        revalidator.revalidate();
      }
    })]
  });
});
function VideoList({
  videos,
  onSelect,
  selectedId
}) {
  if (videos.length === 0) return /* @__PURE__ */ jsx("div", {
    className: "text-gray-400 text-center py-20",
    children: "No videos found."
  });
  return /* @__PURE__ */ jsx("div", {
    className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",
    children: /* @__PURE__ */ jsxs("table", {
      className: "w-full text-sm text-left",
      children: [/* @__PURE__ */ jsx("thead", {
        className: "bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800 font-medium text-zinc-500 dark:text-zinc-400",
        children: /* @__PURE__ */ jsxs("tr", {
          children: [/* @__PURE__ */ jsx("th", {
            className: "px-4 py-3",
            children: "Title"
          }), /* @__PURE__ */ jsx("th", {
            className: "px-4 py-3",
            children: "Duration"
          }), /* @__PURE__ */ jsx("th", {
            className: "px-4 py-3",
            children: "Tags"
          }), /* @__PURE__ */ jsx("th", {
            className: "px-4 py-3 w-10"
          })]
        })
      }), /* @__PURE__ */ jsx("tbody", {
        className: "divide-y divide-zinc-100 dark:divide-zinc-800",
        children: videos.map((vid) => /* @__PURE__ */ jsxs("tr", {
          onClick: () => onSelect(vid),
          className: `cursor-pointer hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition ${selectedId === vid.id ? "bg-blue-50/50 dark:bg-blue-900/10" : ""}`,
          children: [/* @__PURE__ */ jsx("td", {
            className: "px-4 py-3 font-medium text-zinc-900 dark:text-zinc-100",
            children: vid.title
          }), /* @__PURE__ */ jsx("td", {
            className: "px-4 py-3 text-zinc-500 dark:text-zinc-400",
            children: vid.duration ? Math.floor(vid.duration / 60) + "m" : "--"
          }), /* @__PURE__ */ jsx("td", {
            className: "px-4 py-3",
            children: /* @__PURE__ */ jsxs("div", {
              className: "flex flex-wrap gap-1",
              children: [vid.tags?.slice(0, 3).map((t) => /* @__PURE__ */ jsx("span", {
                className: "px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded text-xs",
                children: t
              }, t)), vid.tags?.length > 3 && /* @__PURE__ */ jsxs("span", {
                className: "text-xs text-zinc-400",
                children: ["+", vid.tags.length - 3]
              })]
            })
          }), /* @__PURE__ */ jsx("td", {
            className: "px-4 py-3 text-right",
            children: /* @__PURE__ */ jsx("button", {
              className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",
              children: /* @__PURE__ */ jsx(Info, {
                size: 16
              })
            })
          })]
        }, vid.id))
      })]
    })
  });
}
function CollectionList({
  collections,
  onCreate
}) {
  if (collections.length === 0 && !onCreate) return /* @__PURE__ */ jsx("div", {
    className: "text-gray-400 text-center py-20",
    children: "No collections found."
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",
    children: [collections.map((col) => /* @__PURE__ */ jsx(Link, {
      to: `collections/${col.id}`,
      className: "block group",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-black dark:hover:border-zinc-400 transition shadow-sm h-full flex flex-col",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-start justify-between mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-zinc-100 dark:bg-zinc-800 rounded-lg group-hover:bg-zinc-900 dark:group-hover:bg-zinc-100 group-hover:text-white dark:group-hover:text-black transition",
            children: /* @__PURE__ */ jsx(Folder, {
              size: 24
            })
          }), /* @__PURE__ */ jsxs("span", {
            className: "text-xs text-zinc-400 font-mono",
            children: ["#", col.slug]
          })]
        }), /* @__PURE__ */ jsx("h3", {
          className: "font-bold text-lg mb-1 text-zinc-900 dark:text-zinc-100",
          children: col.title
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 line-clamp-2 mb-4 flex-1",
          children: col.description || "No description"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-400 font-medium",
          children: "Click to manage items â†’"
        })]
      })
    }, col.id)), /* @__PURE__ */ jsxs("div", {
      className: "border-2 border-dashed border-zinc-200 rounded-lg p-6 flex flex-col items-center justify-center text-zinc-400 hover:bg-zinc-50 hover:border-zinc-300 transition cursor-pointer min-h-[200px]",
      onClick: onCreate,
      children: [/* @__PURE__ */ jsx(Plus, {
        size: 32
      }), /* @__PURE__ */ jsx("span", {
        className: "mt-2 text-sm font-medium",
        children: "Create Collection"
      })]
    })]
  });
}
function ImageList({
  images,
  onSelect,
  selectedId
}) {
  if (images.length === 0) return /* @__PURE__ */ jsx("div", {
    className: "text-gray-400 text-center py-20",
    children: "No images found."
  });
  return /* @__PURE__ */ jsx("div", {
    className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",
    children: images.map((img) => /* @__PURE__ */ jsxs("div", {
      onClick: () => onSelect(img),
      className: `bg-white dark:bg-zinc-900 rounded border aspect-square relative group cursor-pointer overflow-hidden ${selectedId === img.id ? "ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-zinc-900" : "hover:border-zinc-300 dark:hover:border-zinc-600 border-zinc-200 dark:border-zinc-800"}`,
      children: [/* @__PURE__ */ jsx("img", {
        src: img.fileUrl,
        alt: img.title,
        className: "w-full h-full object-cover"
      }), /* @__PURE__ */ jsxs("div", {
        className: "absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-white text-sm font-medium truncate",
          children: img.title || img.originalName
        }), /* @__PURE__ */ jsx("p", {
          className: "text-white/80 text-xs",
          children: formatBytes(img.sizeBytes)
        })]
      })]
    }, img.id))
  });
}
function DetailsSidebar({
  item,
  type,
  onClose,
  onUpdate
}) {
  const [title, setTitle] = useState(item.title || item.originalName || "");
  const [description, setDescription] = useState(item.description || "");
  const [tags, setTags] = useState(item.tags || []);
  const [tagInput, setTagInput] = useState("");
  const [saving, setSaving] = useState(false);
  const [accessLevel, setAccessLevel] = useState(item.accessLevel || "members");
  const [posterUrl, setPosterUrl] = useState(item.posterUrl || "");
  const [uploadingPoster, setUploadingPoster] = useState(false);
  useEffect(() => {
    setTitle(item.title || item.originalName || "");
    setDescription(item.description || "");
    setTags(item.tags || []);
    if (type === "video") {
      setAccessLevel(item.accessLevel || "members");
      setPosterUrl(item.posterUrl || "");
    }
    setTagInput("");
  }, [item, type]);
  const handleAddTag = (e) => {
    if (e.key === "Enter" && tagInput.trim()) {
      e.preventDefault();
      if (!tags.includes(tagInput.trim())) {
        setTags([...tags, tagInput.trim()]);
      }
      setTagInput("");
    }
  };
  const removeTag = (tag) => {
    setTags(tags.filter((t) => t !== tag));
  };
  const handlePosterUpload = async (file) => {
    setUploadingPoster(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      const formData = new FormData();
      formData.append("file", file);
      const response = await fetch("/api/r2-image", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`
        },
        body: formData
      });
      if (!response.ok) throw new Error("Upload failed");
      const data = await response.json();
      setPosterUrl(data.url);
    } catch (e) {
      console.error(e);
      toast.error("Poster upload failed");
    } finally {
      setUploadingPoster(false);
    }
  };
  const handleSave = async () => {
    setSaving(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      const endpoint = type === "video" ? `/video-management/${item.id}` : `/uploads/images/${item.id}`;
      const payload = {
        title,
        description,
        tags
      };
      if (type === "video") {
        payload.accessLevel = accessLevel;
        payload.posterUrl = posterUrl;
      }
      await apiRequest(endpoint, token, {
        method: "PATCH",
        body: JSON.stringify(payload)
      });
      onUpdate();
      toast.success("Changes saved.");
    } catch (e) {
      console.error(e);
      toast.error("Failed to save changes.");
    } finally {
      setSaving(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "w-80 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 shadow-xl flex flex-col overflow-hidden animate-in slide-in-from-right-10 duration-200",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "p-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-800/50",
      children: [/* @__PURE__ */ jsxs("span", {
        className: "font-semibold text-sm uppercase text-zinc-500 dark:text-zinc-400 tracking-wide",
        children: [type, " Details"]
      }), /* @__PURE__ */ jsx("button", {
        onClick: onClose,
        className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",
        children: /* @__PURE__ */ jsx(X, {
          size: 18
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 overflow-y-auto p-4 space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "aspect-video bg-zinc-100 rounded-lg overflow-hidden border border-zinc-200 flex items-center justify-center relative group",
        children: [type === "image" ? /* @__PURE__ */ jsx("img", {
          src: item.fileUrl,
          className: "w-full h-full object-contain"
        }) : posterUrl ? /* @__PURE__ */ jsx("img", {
          src: posterUrl,
          className: "w-full h-full object-cover"
        }) : /* @__PURE__ */ jsxs("div", {
          className: "flex flex-col items-center gap-2 text-zinc-400",
          children: [/* @__PURE__ */ jsx(Film, {
            size: 24
          }), /* @__PURE__ */ jsx("span", {
            className: "text-xs",
            children: "No preview available"
          })]
        }), type === "video" && /* @__PURE__ */ jsxs("label", {
          className: "absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition",
          children: [/* @__PURE__ */ jsx("input", {
            type: "file",
            accept: "image/*",
            className: "hidden",
            onChange: (e) => e.target.files?.[0] && handlePosterUpload(e.target.files[0]),
            disabled: uploadingPoster
          }), /* @__PURE__ */ jsxs("span", {
            className: "text-white text-xs font-medium flex items-center gap-2",
            children: [uploadingPoster ? /* @__PURE__ */ jsx(RefreshCw, {
              className: "animate-spin",
              size: 16
            }) : /* @__PURE__ */ jsx(Image$1, {
              size: 16
            }), "Change Poster"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-2 gap-2 text-xs text-zinc-500",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 p-2 rounded",
          children: [/* @__PURE__ */ jsx("span", {
            className: "block font-medium text-zinc-700",
            children: "Size"
          }), formatBytes(item.sizeBytes)]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 p-2 rounded",
          children: [/* @__PURE__ */ jsx("span", {
            className: "block font-medium text-zinc-700",
            children: "Created"
          }), new Date(item.createdAt).toLocaleDateString()]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Title"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            value: title,
            onChange: (e) => setTitle(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Description"
          }), /* @__PURE__ */ jsx("textarea", {
            value: description,
            onChange: (e) => setDescription(e.target.value),
            rows: 3,
            className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none resize-none"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Tags / Labels"
          }), /* @__PURE__ */ jsxs("div", {
            className: "min-h-[40px] p-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-800 flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-black dark:focus-within:ring-white focus-within:border-transparent",
            children: [tags.map((tag) => /* @__PURE__ */ jsxs("span", {
              className: "inline-flex items-center gap-1 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 px-2 py-1 rounded text-xs font-medium",
              children: [tag, /* @__PURE__ */ jsx("button", {
                onClick: () => removeTag(tag),
                className: "hover:text-red-500",
                children: /* @__PURE__ */ jsx(X, {
                  size: 10
                })
              })]
            }, tag)), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: tagInput,
              onChange: (e) => setTagInput(e.target.value),
              onKeyDown: handleAddTag,
              placeholder: tags.length === 0 ? "Type and enter..." : "",
              className: "flex-1 min-w-[60px] text-sm outline-none bg-transparent dark:text-white"
            })]
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-400 mt-1",
            children: "Press Enter to add tag"
          })]
        }), type === "video" && /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Access Level"
          }), /* @__PURE__ */ jsxs("select", {
            value: accessLevel,
            onChange: (e) => setAccessLevel(e.target.value),
            className: "w-full px-2 py-2 border border-zinc-200 rounded-lg text-sm outline-none",
            children: [/* @__PURE__ */ jsx("option", {
              value: "public",
              children: "Public (Everyone)"
            }), /* @__PURE__ */ jsx("option", {
              value: "members",
              children: "Members Only (Logged In)"
            }), /* @__PURE__ */ jsx("option", {
              value: "private",
              children: "Private (Admin Only)"
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50",
      children: /* @__PURE__ */ jsx("button", {
        onClick: handleSave,
        disabled: saving,
        className: "w-full bg-black dark:bg-zinc-100 text-white dark:text-zinc-900 py-2 rounded-lg font-medium text-sm hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 flex items-center justify-center gap-2",
        children: saving ? "Saving..." : /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsx(Save, {
            size: 16
          }), " Save Usage"]
        })
      })
    })]
  });
}
const route18 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_videos__index,
  loader: loader$1b
}, Symbol.toStringTag, { value: "Module" }));
const loader$1a = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  try {
    const pages = await apiRequest("/website/pages", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      pages,
      error: null,
      slug
    };
  } catch (e) {
    return {
      pages: [],
      error: e.message,
      slug
    };
  }
};
const studio_$slug_website_pages = UNSAFE_withComponentProps(function WebsitePagesManager() {
  const {
    pages: initialPages,
    error,
    slug
  } = useLoaderData();
  const [pages, setPages] = useState(initialPages || []);
  const {
    getToken
  } = useAuth();
  useNavigate();
  const [creating, setCreating] = useState(false);
  const [newPage, setNewPage] = useState({
    title: "",
    slug: ""
  });
  const [confirmDeleteId, setConfirmDeleteId] = useState(null);
  const handleCreate = async () => {
    if (!newPage.title || !newPage.slug) return;
    try {
      const token = await getToken();
      const created = await apiRequest("/website/pages", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(newPage)
      });
      setPages([...pages, created]);
      setCreating(false);
      setNewPage({
        title: "",
        slug: ""
      });
      toast.success("Page created");
    } catch (e) {
      toast.error("Failed to create page: " + e.message);
    }
  };
  const handleDelete = (id) => {
    setConfirmDeleteId(id);
  };
  const confirmDeleteAction = async () => {
    if (!confirmDeleteId) return;
    try {
      const token = await getToken();
      await apiRequest(`/website/pages/${confirmDeleteId}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setPages(pages.filter((p) => p.id !== confirmDeleteId));
      toast.success("Page deleted");
    } catch (e) {
      toast.error("Failed to delete: " + e.message);
    } finally {
      setConfirmDeleteId(null);
    }
  };
  const handleTogglePublish = async (page) => {
    try {
      const token = await getToken();
      await apiRequest(`/website/pages/${page.id}/publish`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          isPublished: !page.isPublished
        })
      });
      setPages(pages.map((p) => p.id === page.id ? {
        ...p,
        isPublished: !p.isPublished
      } : p));
      toast.success(page.isPublished ? "Page unpublished" : "Page published");
    } catch (e) {
      toast.error("Failed to update: " + e.message);
    }
  };
  if (error) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",
        children: ["Error: ", error]
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold text-zinc-900 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Globe, {
            className: "text-blue-600"
          }), "Website Builder"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mt-1",
          children: "Create and manage your studio website pages"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setCreating(true),
        className: "flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 18
        }), "New Page"]
      })]
    }), creating && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl p-6 w-full max-w-md shadow-xl",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-semibold mb-4",
          children: "Create New Page"
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Page Title"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: newPage.title,
              onChange: (e) => setNewPage({
                ...newPage,
                title: e.target.value
              }),
              className: "w-full border border-zinc-300 rounded-lg px-3 py-2",
              placeholder: "e.g., About Us"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "URL Slug"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: newPage.slug,
              onChange: (e) => setNewPage({
                ...newPage,
                slug: e.target.value.toLowerCase().replace(/\s+/g, "-")
              }),
              className: "w-full border border-zinc-300 rounded-lg px-3 py-2",
              placeholder: "e.g., about"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-xs text-zinc-400 mt-1",
              children: ["yoursite.com/", newPage.slug || "slug"]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 mt-6",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setCreating(false),
            className: "px-4 py-2 text-zinc-600 hover:bg-zinc-100 rounded-lg",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleCreate,
            className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",
            children: "Create Page"
          })]
        })]
      })
    }), pages.length === 0 ? /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 border-2 border-dashed border-zinc-200 rounded-xl p-12 text-center",
      children: [/* @__PURE__ */ jsx(FileText, {
        size: 48,
        className: "mx-auto text-zinc-300 mb-4"
      }), /* @__PURE__ */ jsx("h3", {
        className: "text-lg font-medium text-zinc-700 mb-2",
        children: "No pages yet"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 mb-4",
        children: "Create your first page to start building your website"
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setCreating(true),
        className: "inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 18
        }), "Create First Page"]
      })]
    }) : /* @__PURE__ */ jsx("div", {
      className: "bg-white rounded-xl border border-zinc-200 divide-y",
      children: pages.map((page) => /* @__PURE__ */ jsxs("div", {
        className: "p-4 flex items-center justify-between hover:bg-zinc-50",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: `p-2 rounded-lg ${page.isPublished ? "bg-green-100 text-green-600" : "bg-zinc-100 text-zinc-400"}`,
            children: /* @__PURE__ */ jsx(FileText, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-medium text-zinc-900",
              children: page.title
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-sm text-zinc-500",
              children: ["/", page.slug]
            })]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${page.isPublished ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-600"}`,
            children: page.isPublished ? "Published" : "Draft"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => handleTogglePublish(page),
            className: "p-2 hover:bg-zinc-100 rounded-lg text-zinc-600",
            title: page.isPublished ? "Unpublish" : "Publish",
            children: page.isPublished ? /* @__PURE__ */ jsx(EyeOff, {
              size: 18
            }) : /* @__PURE__ */ jsx(Eye, {
              size: 18
            })
          }), /* @__PURE__ */ jsx(Link, {
            to: `/studio/${slug}/website/editor/${page.id}`,
            className: "p-2 hover:bg-blue-50 rounded-lg text-blue-600",
            children: /* @__PURE__ */ jsx(Edit2, {
              size: 18
            })
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => handleDelete(page.id),
            className: "p-2 hover:bg-red-50 rounded-lg text-red-600",
            children: /* @__PURE__ */ jsx(Trash2, {
              size: 18
            })
          })]
        })]
      }, page.id))
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmDeleteId,
      onClose: () => setConfirmDeleteId(null),
      onConfirm: confirmDeleteAction,
      title: "Delete Page",
      message: "Are you sure you want to delete this page? This cannot be undone.",
      confirmText: "Delete",
      isDestructive: true
    })]
  });
});
const route19 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_website_pages,
  loader: loader$1a
}, Symbol.toStringTag, { value: "Module" }));
const loader$19 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const slug = args.params.slug;
  const token = userId ? await getToken() : void 0;
  let services = [];
  try {
    if (token) {
      const res = await apiRequest("/appointments/services", token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      services = res.services || [];
    }
  } catch (e) {
    console.error("Failed to load services", e);
  }
  return {
    services,
    slug,
    userId,
    token
  };
};
const studio_$slug_appointments = UNSAFE_withComponentProps(function AppointmentsPage() {
  const {
    services,
    slug,
    userId,
    token
  } = useLoaderData();
  const [step, setStep] = useState("service");
  const [selectedService, setSelectedService] = useState(null);
  const [selectedSlot, setSelectedSlot] = useState(null);
  const [slots, setSlots] = useState([]);
  const [loadingSlots, setLoadingSlots] = useState(false);
  const [selectedDate, setSelectedDate] = useState((/* @__PURE__ */ new Date()).toISOString().split("T")[0]);
  useNavigate();
  async function loadSlots(service, date) {
    setLoadingSlots(true);
    try {
      const res = await apiRequest(`/appointments/availability?serviceId=${service.id}&date=${date}`, token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setSlots(res.slots || []);
    } catch (e) {
      console.error(e);
    } finally {
      setLoadingSlots(false);
    }
  }
  async function handleBook() {
    if (!selectedSlot || !selectedService) return;
    if (!userId) {
      toast.error("Please login to book");
      return;
    }
    try {
      const res = await apiRequest("/appointments/book", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          serviceId: selectedService.id,
          instructorId: selectedSlot.instructorId,
          startTime: selectedSlot.startTime
        })
      });
      if (res.error) {
        toast.error(res.error);
      } else {
        toast.success("Booking Confirmed!");
        setStep("service");
        setSelectedService(null);
        setSelectedSlot(null);
      }
    } catch (e) {
      toast.error("Booking failed: " + e.message);
    }
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-3xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-4 mb-8",
      children: [step !== "service" && /* @__PURE__ */ jsx("button", {
        onClick: () => setStep("service"),
        className: "p-2 hover:bg-zinc-100 rounded-full",
        children: /* @__PURE__ */ jsx(ArrowLeft, {
          className: "h-5 w-5"
        })
      }), /* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold",
        children: "Book a Session"
      })]
    }), step === "service" && /* @__PURE__ */ jsxs("div", {
      className: "grid gap-4",
      children: [services.length === 0 && /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500",
        children: "No services available."
      }), services.map((s) => /* @__PURE__ */ jsx("div", {
        onClick: () => {
          setSelectedService(s);
          setStep("slot");
          loadSlots(s, selectedDate);
        },
        className: "bg-white p-6 rounded-lg border border-zinc-200 hover:border-blue-500 cursor-pointer shadow-sm transition-all",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-lg",
              children: s.title
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-500 text-sm mt-1",
              children: s.description
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-4 mt-3 text-sm text-zinc-600",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(Clock, {
                  className: "h-4 w-4"
                }), s.durationMinutes, " min"]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-1 font-medium",
                children: ["$", s.price < 1 ? "Free" : s.price]
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "bg-zinc-100 p-2 rounded-full",
            children: /* @__PURE__ */ jsx(ArrowLeft, {
              className: "h-5 w-5 rotate-180 text-zinc-400"
            })
          })]
        })
      }, s.id))]
    }), step === "slot" && selectedService && /* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-zinc-50 p-4 rounded-lg mb-6 flex justify-between items-center",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-medium",
            children: selectedService.title
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-sm text-zinc-500",
            children: [selectedService.durationMinutes, " mins â€¢ $", selectedService.price]
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setStep("service"),
          className: "text-sm text-blue-600 hover:underline",
          children: "Change"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "mb-6",
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-sm font-medium mb-2",
          children: "Select Date"
        }), /* @__PURE__ */ jsx("input", {
          type: "date",
          value: selectedDate,
          min: (/* @__PURE__ */ new Date()).toISOString().split("T")[0],
          onChange: (e) => {
            setSelectedDate(e.target.value);
            loadSlots(selectedService, e.target.value);
          },
          className: "border border-zinc-300 rounded px-3 py-2 w-full md:w-auto"
        })]
      }), loadingSlots ? /* @__PURE__ */ jsx("div", {
        className: "text-center py-8 text-zinc-500",
        children: "Finding available times..."
      }) : /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-3 md:grid-cols-4 gap-3",
        children: slots.length === 0 ? /* @__PURE__ */ jsx("div", {
          className: "col-span-full text-center py-8 text-zinc-500 bg-zinc-50 rounded-lg border border-dashed border-zinc-200",
          children: "No availability on this date."
        }) : slots.map((slot, i) => /* @__PURE__ */ jsx("button", {
          onClick: () => {
            setSelectedSlot(slot);
            setStep("confirm");
          },
          className: "py-2 px-4 rounded border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 font-medium text-sm transition-colors",
          children: new Date(slot.startTime).toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit"
          })
        }, i))
      })]
    }), step === "confirm" && selectedSlot && selectedService && /* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-xl font-bold mb-6",
        children: "Confirm Booking"
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white border border-zinc-200 rounded-lg p-6 mb-6 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex gap-4 mb-4 pb-4 border-b border-zinc-100",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-blue-100 p-3 rounded-lg h-fit",
            children: /* @__PURE__ */ jsx(Calendar, {
              className: "h-6 w-6 text-blue-600"
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-lg",
              children: selectedService.title
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-zinc-500",
              children: ["with ", selectedSlot.instructorName]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid gap-3 text-sm",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500",
              children: "Date"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-medium",
              children: new Date(selectedSlot.startTime).toLocaleDateString(void 0, {
                weekday: "long",
                month: "long",
                day: "numeric"
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500",
              children: "Time"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-medium",
              children: [new Date(selectedSlot.startTime).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit"
              }), " - ", new Date(selectedSlot.endTime).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500",
              children: "Price"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-medium",
              children: ["$", selectedService.price]
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-3",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setStep("slot"),
          className: "flex-1 py-3 border border-zinc-300 rounded-lg font-medium hover:bg-zinc-50",
          children: "Back"
        }), /* @__PURE__ */ jsx("button", {
          onClick: handleBook,
          className: "flex-1 py-3 bg-zinc-900 text-white rounded-lg font-medium hover:bg-zinc-800",
          children: "Confirm Booking"
        })]
      })]
    })]
  });
});
const route20 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_appointments,
  loader: loader$19
}, Symbol.toStringTag, { value: "Module" }));
const loader$18 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const url = new URL(args.request.url);
  const weekStart = url.searchParams.get("week") || (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
  const token = await getToken();
  try {
    const [appointmentsData, servicesData, instructorsData] = await Promise.all([apiRequest(`/appointments?weekStart=${weekStart}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/appointment-services", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/members?role=instructor", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    return {
      appointments: appointmentsData || [],
      services: servicesData || [],
      instructors: instructorsData || [],
      weekStart
    };
  } catch (e) {
    console.error("Appointments Loader Error", e);
    return {
      appointments: [],
      services: [],
      instructors: [],
      weekStart
    };
  }
};
const action$j = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "create") {
    await apiRequest("/appointments", token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        serviceId: formData.get("serviceId"),
        instructorId: formData.get("instructorId"),
        memberId: formData.get("memberId"),
        startTime: formData.get("startTime"),
        notes: formData.get("notes")
      })
    });
  }
  if (intent === "update-status") {
    const id = formData.get("id");
    await apiRequest(`/appointments/${id}`, token, {
      method: "PATCH",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        status: formData.get("status")
      })
    });
  }
  if (intent === "cancel") {
    const id = formData.get("id");
    await apiRequest(`/appointments/${id}`, token, {
      method: "PATCH",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        status: "cancelled"
      })
    });
  }
  return {
    success: true
  };
};
const studio_$slug_appointments_calendar = UNSAFE_withComponentProps(function AppointmentsCalendar() {
  const {
    appointments,
    services,
    instructors,
    weekStart
  } = useLoaderData();
  const [searchParams, setSearchParams] = useSearchParams();
  const submit = useSubmit();
  const [selectedSlot, setSelectedSlot] = useState(null);
  const [selectedAppointment, setSelectedAppointment] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const weekDates = useMemo(() => {
    const start = new Date(weekStart);
    const dayOfWeek = start.getDay();
    const monday = new Date(start);
    monday.setDate(start.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
    return Array.from({
      length: 7
    }, (_, i) => {
      const date = new Date(monday);
      date.setDate(monday.getDate() + i);
      return date.toISOString().split("T")[0];
    });
  }, [weekStart]);
  const navigateWeek = (direction) => {
    const current = new Date(weekDates[0]);
    current.setDate(current.getDate() + direction * 7);
    setSearchParams({
      week: current.toISOString().split("T")[0]
    });
  };
  const hours = Array.from({
    length: 12
  }, (_, i) => i + 7);
  const getAppointmentsForSlot = (date, hour) => {
    return appointments.filter((apt) => {
      const aptDate = new Date(apt.startTime);
      return aptDate.toISOString().split("T")[0] === date && aptDate.getHours() === hour;
    });
  };
  const statusColors = {
    pending: "bg-yellow-100 border-yellow-300 text-yellow-800",
    confirmed: "bg-blue-100 border-blue-300 text-blue-800",
    completed: "bg-green-100 border-green-300 text-green-800",
    cancelled: "bg-zinc-100 border-zinc-300 text-zinc-500"
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-zinc-900 rounded-lg text-white",
            children: /* @__PURE__ */ jsx(Calendar, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-xl font-bold text-zinc-900",
              children: "Appointments"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500",
              children: "Private sessions calendar"
            })]
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setIsCreating(true),
          className: "px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 16
          }), " New Appointment"]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between mt-4",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => navigateWeek(-1),
          className: "p-2 hover:bg-zinc-100 rounded-lg",
          children: /* @__PURE__ */ jsx(ChevronLeft, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("span", {
          className: "font-medium text-zinc-900",
          children: [new Date(weekDates[0]).toLocaleDateString(void 0, {
            month: "short",
            day: "numeric"
          }), " - ", new Date(weekDates[6]).toLocaleDateString(void 0, {
            month: "short",
            day: "numeric",
            year: "numeric"
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => navigateWeek(1),
          className: "p-2 hover:bg-zinc-100 rounded-lg",
          children: /* @__PURE__ */ jsx(ChevronRight, {
            size: 20
          })
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-auto",
      children: /* @__PURE__ */ jsxs("div", {
        className: "min-w-[800px]",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-8 border-b border-zinc-200 bg-white sticky top-0 z-10",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 text-xs font-medium text-zinc-500",
            children: "Time"
          }), weekDates.map((date) => {
            const d = new Date(date);
            const isToday = date === (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
            return /* @__PURE__ */ jsxs("div", {
              className: `p-3 text-center border-l border-zinc-200 ${isToday ? "bg-zinc-900 text-white" : ""}`,
              children: [/* @__PURE__ */ jsx("div", {
                className: "text-xs font-medium",
                children: d.toLocaleDateString(void 0, {
                  weekday: "short"
                })
              }), /* @__PURE__ */ jsx("div", {
                className: `text-lg font-bold ${isToday ? "" : "text-zinc-900"}`,
                children: d.getDate()
              })]
            }, date);
          })]
        }), hours.map((hour) => /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-8 border-b border-zinc-100",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "p-2 text-xs text-zinc-500 text-right pr-4",
            children: [hour % 12 || 12, ":00 ", hour < 12 ? "AM" : "PM"]
          }), weekDates.map((date) => {
            const slotAppointments = getAppointmentsForSlot(date, hour);
            return /* @__PURE__ */ jsx("div", {
              className: "border-l border-zinc-100 min-h-[60px] p-1 hover:bg-zinc-50 cursor-pointer transition",
              onClick: () => setSelectedSlot({
                date,
                hour
              }),
              children: slotAppointments.map((apt) => /* @__PURE__ */ jsxs("div", {
                onClick: (e) => {
                  e.stopPropagation();
                  setSelectedAppointment(apt);
                },
                className: `p-1.5 rounded text-xs mb-1 border cursor-pointer ${statusColors[apt.status] || statusColors.pending}`,
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium truncate",
                  children: apt.service?.title || "Session"
                }), /* @__PURE__ */ jsx("div", {
                  className: "truncate opacity-75",
                  children: apt.member?.user?.profile?.firstName || "Client"
                })]
              }, apt.id))
            }, `${date}-${hour}`);
          })]
        }, hour))]
      })
    }), (isCreating || selectedSlot) && /* @__PURE__ */ jsx(CreateAppointmentModal, {
      services,
      instructors,
      defaultSlot: selectedSlot,
      onClose: () => {
        setIsCreating(false);
        setSelectedSlot(null);
      },
      onSave: (data) => {
        const formData = new FormData();
        formData.append("intent", "create");
        Object.entries(data).forEach(([k, v]) => formData.append(k, String(v)));
        submit(formData, {
          method: "post"
        });
        setIsCreating(false);
        setSelectedSlot(null);
      }
    }), selectedAppointment && /* @__PURE__ */ jsx(AppointmentDetailModal, {
      appointment: selectedAppointment,
      onClose: () => setSelectedAppointment(null),
      onUpdateStatus: (id, status) => {
        submit({
          intent: "update-status",
          id,
          status
        }, {
          method: "post"
        });
        setSelectedAppointment(null);
      }
    })]
  });
});
function CreateAppointmentModal({
  services,
  instructors,
  defaultSlot,
  onClose,
  onSave
}) {
  const [serviceId, setServiceId] = useState("");
  const [instructorId, setInstructorId] = useState("");
  const [memberId, setMemberId] = useState("");
  const [date, setDate] = useState(defaultSlot?.date || (/* @__PURE__ */ new Date()).toISOString().split("T")[0]);
  const [time, setTime] = useState(defaultSlot ? `${String(defaultSlot.hour).padStart(2, "0")}:00` : "09:00");
  const [notes, setNotes] = useState("");
  const handleSubmit = (e) => {
    e.preventDefault();
    const startTime = (/* @__PURE__ */ new Date(`${date}T${time}`)).toISOString();
    onSave({
      serviceId,
      instructorId,
      memberId,
      startTime,
      notes
    });
  };
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-md w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: "New Appointment"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSubmit,
        className: "p-6 space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Service *"
          }), /* @__PURE__ */ jsxs("select", {
            required: true,
            value: serviceId,
            onChange: (e) => setServiceId(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
            children: [/* @__PURE__ */ jsx("option", {
              value: "",
              children: "Select service..."
            }), services.map((s) => /* @__PURE__ */ jsxs("option", {
              value: s.id,
              children: [s.title, " (", s.durationMinutes, " min)"]
            }, s.id))]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Instructor *"
          }), /* @__PURE__ */ jsxs("select", {
            required: true,
            value: instructorId,
            onChange: (e) => setInstructorId(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
            children: [/* @__PURE__ */ jsx("option", {
              value: "",
              children: "Select instructor..."
            }), instructors.map((i) => /* @__PURE__ */ jsxs("option", {
              value: i.id,
              children: [i.user?.profile?.firstName, " ", i.user?.profile?.lastName]
            }, i.id))]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Date"
            }), /* @__PURE__ */ jsx("input", {
              type: "date",
              value: date,
              onChange: (e) => setDate(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Time"
            }), /* @__PURE__ */ jsx("input", {
              type: "time",
              value: time,
              onChange: (e) => setTime(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Notes"
          }), /* @__PURE__ */ jsx("textarea", {
            value: notes,
            onChange: (e) => setNotes(e.target.value),
            rows: 2,
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg resize-none"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: onClose,
            className: "px-4 py-2 text-sm font-medium text-zinc-500",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800",
            children: "Create"
          })]
        })]
      })]
    })
  });
}
function AppointmentDetailModal({
  appointment,
  onClose,
  onUpdateStatus
}) {
  const formatTime = (iso) => new Date(iso).toLocaleString(void 0, {
    dateStyle: "medium",
    timeStyle: "short"
  });
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-md w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: appointment.service?.title || "Appointment"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-6 space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3 text-sm",
          children: [/* @__PURE__ */ jsx(Clock, {
            size: 16,
            className: "text-zinc-400"
          }), formatTime(appointment.startTime)]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3 text-sm",
          children: [/* @__PURE__ */ jsx(User, {
            size: 16,
            className: "text-zinc-400"
          }), appointment.member?.user?.profile?.firstName, " ", appointment.member?.user?.profile?.lastName]
        }), appointment.notes && /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-600 bg-zinc-50 p-3 rounded-lg",
          children: appointment.notes
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 border-t space-y-2",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-xs font-medium text-zinc-500 uppercase",
            children: "Update Status"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-2",
            children: [/* @__PURE__ */ jsx("button", {
              onClick: () => onUpdateStatus(appointment.id, "confirmed"),
              className: "flex-1 py-2 text-xs font-medium bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",
              children: "Confirm"
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => onUpdateStatus(appointment.id, "completed"),
              className: "flex-1 py-2 text-xs font-medium bg-green-100 text-green-700 rounded-lg hover:bg-green-200",
              children: "Complete"
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => onUpdateStatus(appointment.id, "cancelled"),
              className: "flex-1 py-2 text-xs font-medium bg-red-100 text-red-700 rounded-lg hover:bg-red-200",
              children: "Cancel"
            })]
          })]
        })]
      })]
    })
  });
}
const route21 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$j,
  default: studio_$slug_appointments_calendar,
  loader: loader$18
}, Symbol.toStringTag, { value: "Module" }));
const createImage = (url) => new Promise((resolve, reject) => {
  const image = new Image();
  image.addEventListener("load", () => resolve(image));
  image.addEventListener("error", (error) => reject(error));
  image.setAttribute("crossOrigin", "anonymous");
  image.src = url;
});
function getRadianAngle(degreeValue) {
  return degreeValue * Math.PI / 180;
}
function rotateSize(width, height, rotation) {
  const rotRad = getRadianAngle(rotation);
  return {
    width: Math.abs(Math.cos(rotRad) * width) + Math.abs(Math.sin(rotRad) * height),
    height: Math.abs(Math.sin(rotRad) * width) + Math.abs(Math.cos(rotRad) * height)
  };
}
async function getCroppedImg(imageSrc, pixelCrop, rotation = 0, flip = { horizontal: false, vertical: false }) {
  const image = await createImage(imageSrc);
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  if (!ctx) {
    throw new Error("No 2d context");
  }
  const rotRad = getRadianAngle(rotation);
  const { width: bBoxWidth, height: bBoxHeight } = rotateSize(
    image.width,
    image.height,
    rotation
  );
  canvas.width = bBoxWidth;
  canvas.height = bBoxHeight;
  ctx.translate(bBoxWidth / 2, bBoxHeight / 2);
  ctx.rotate(rotRad);
  ctx.scale(flip.horizontal ? -1 : 1, flip.vertical ? -1 : 1);
  ctx.translate(-image.width / 2, -image.height / 2);
  ctx.drawImage(image, 0, 0);
  const data = ctx.getImageData(
    pixelCrop.x,
    pixelCrop.y,
    pixelCrop.width,
    pixelCrop.height
  );
  canvas.width = pixelCrop.width;
  canvas.height = pixelCrop.height;
  ctx.putImageData(data, 0, 0);
  return new Promise((resolve, reject) => {
    canvas.toBlob((blob) => {
      if (!blob) {
        console.error("Canvas is empty");
        return;
      }
      resolve(blob);
    }, "image/jpeg");
  });
}
function CardCreator({ initialImage, initialTitle, initialSubtitle, onChange }) {
  const [imageSrc, setImageSrc] = useState(initialImage || null);
  const [title, setTitle] = useState(initialTitle || "");
  const [subtitle, setSubtitle] = useState(initialSubtitle || "");
  const [crop, setCrop] = useState({ x: 0, y: 0 });
  const [zoom, setZoom] = useState(1);
  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null);
  const [mode, setMode] = useState(initialImage ? "preview" : "upload");
  const onCropComplete = useCallback((croppedArea, croppedAreaPixels2) => {
    setCroppedAreaPixels(croppedAreaPixels2);
  }, []);
  const handleFileChange = async (e) => {
    if (e.target.files && e.target.files.length > 0) {
      const file = e.target.files[0];
      const imageDataUrl = await readFile(file);
      setImageSrc(imageDataUrl);
      setMode("crop");
    }
  };
  const handleCropSave = async () => {
    try {
      if (!imageSrc || !croppedAreaPixels) return;
      const croppedImageBlob = await getCroppedImg(imageSrc, croppedAreaPixels);
      const previewUrl = URL.createObjectURL(croppedImageBlob);
      onChange({
        image: croppedImageBlob,
        title,
        subtitle,
        previewUrl
      });
      setMode("preview");
    } catch (e) {
      console.error(e);
    }
  };
  const readFile = (file) => {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.addEventListener("load", () => resolve(reader.result));
      reader.readAsDataURL(file);
    });
  };
  return /* @__PURE__ */ jsxs("div", { className: "card-creator space-y-4", children: [
    mode === "upload" && /* @__PURE__ */ jsxs("div", { className: "border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg p-8 text-center bg-zinc-50 dark:bg-zinc-800/50 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800", children: [
      /* @__PURE__ */ jsx("p", { className: "text-zinc-500 dark:text-zinc-400 mb-4 font-medium", children: "Upload a background image for your membership card." }),
      /* @__PURE__ */ jsx(
        "input",
        {
          type: "file",
          accept: "image/*",
          onChange: handleFileChange,
          className: "hidden",
          id: "card-image-upload"
        }
      ),
      /* @__PURE__ */ jsx(
        "label",
        {
          htmlFor: "card-image-upload",
          className: "cursor-pointer inline-block bg-indigo-600 text-white px-4 py-2 rounded-md font-medium hover:bg-indigo-700 transition-colors shadow-sm",
          children: "Choose Image"
        }
      )
    ] }),
    mode === "crop" && imageSrc && /* @__PURE__ */ jsxs("div", { className: "relative h-64 w-full bg-zinc-900 rounded-lg overflow-hidden", children: [
      /* @__PURE__ */ jsx(
        Cropper,
        {
          image: imageSrc,
          crop,
          zoom,
          aspect: 3 / 2,
          onCropChange: setCrop,
          onCropComplete,
          onZoomChange: setZoom
        }
      ),
      /* @__PURE__ */ jsxs("div", { className: "absolute bottom-4 right-4 z-10 space-x-2", children: [
        /* @__PURE__ */ jsx(
          "button",
          {
            type: "button",
            onClick: () => setMode("upload"),
            className: "bg-zinc-800/80 backdrop-blur text-white px-3 py-1 rounded text-sm hover:bg-zinc-700 font-medium transition-colors",
            children: "Change Image"
          }
        ),
        /* @__PURE__ */ jsx(
          "button",
          {
            type: "button",
            onClick: handleCropSave,
            className: "bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700 font-medium transition-colors shadow-lg",
            children: "Apply Crop"
          }
        )
      ] })
    ] }),
    mode === "preview" && /* @__PURE__ */ jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxs("div", { className: "relative w-full aspect-[3/2] rounded-lg overflow-hidden shadow-md group", children: [
        imageSrc && /* @__PURE__ */ jsx(
          "img",
          {
            src: imageSrc,
            className: "w-full h-full object-cover",
            alt: "Card Background"
          }
        ),
        /* @__PURE__ */ jsx("div", { className: "absolute inset-0 bg-black/30 flex flex-col items-center justify-center text-center p-4", children: /* @__PURE__ */ jsxs("div", { className: "bg-white/80 dark:bg-black/60 backdrop-blur-sm p-4 rounded-lg max-w-[80%]", children: [
          /* @__PURE__ */ jsx("h3", { className: "text-xl font-bold text-zinc-900 dark:text-white uppercase tracking-wider", children: title || "Membership Title" }),
          subtitle && /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-700 dark:text-zinc-300 mt-1", children: subtitle })
        ] }) }),
        /* @__PURE__ */ jsx("div", { className: "absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center", children: /* @__PURE__ */ jsx(
          "button",
          {
            type: "button",
            onClick: () => setMode("crop"),
            className: "bg-white text-zinc-900 px-4 py-2 rounded-full font-medium hover:bg-zinc-100 shadow-lg transform transition-transform hover:scale-105",
            children: "Edit Image"
          }
        ) })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-1 gap-4", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400", children: "Overlay Title" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              value: title,
              onChange: (e) => {
                setTitle(e.target.value);
                onChange({ image: null, title: e.target.value, subtitle, previewUrl: "" });
              },
              className: "w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-indigo-500 focus:border-indigo-500 text-zinc-900 dark:text-zinc-100",
              placeholder: "3 MONTH MEMBERSHIP"
            }
          )
        ] }),
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400", children: "Overlay Subtitle (Optional)" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              value: subtitle,
              onChange: (e) => {
                setSubtitle(e.target.value);
                onChange({ image: null, title, subtitle: e.target.value, previewUrl: "" });
              },
              className: "w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-indigo-500 focus:border-indigo-500 text-zinc-900 dark:text-zinc-100",
              placeholder: "Unlimited Yoga"
            }
          )
        ] })
      ] })
    ] })
  ] });
}
const loader$17 = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const [plans, subscriptions] = await Promise.all([apiRequest("/memberships/plans", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest("/memberships/subscriptions", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    })]);
    return {
      plans: plans || [],
      subscriptions: subscriptions || []
    };
  } catch (e) {
    console.error("Failed to load membership data", e);
    return {
      plans: [],
      subscriptions: [],
      error: e.message
    };
  }
};
const action$i = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "delete_plan") {
    const planId2 = formData.get("planId");
    try {
      await apiRequest(`/memberships/plans/${planId2}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": params.slug
        }
      });
      return {
        success: true,
        intent: "delete_plan"
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  const planId = formData.get("planId");
  const name = formData.get("name");
  const price = Number(formData.get("price") || 0) * 100;
  const interval = formData.get("interval");
  const description = formData.get("description");
  const imageUrl = formData.get("imageUrl");
  const overlayTitle = formData.get("overlayTitle");
  const overlaySubtitle = formData.get("overlaySubtitle");
  const vodEnabled = formData.get("vodEnabled") === "on";
  try {
    const url = planId ? `/memberships/plans/${planId}` : "/memberships/plans";
    const method = planId ? "PATCH" : "POST";
    const result = await apiRequest(url, token, {
      method,
      headers: {
        "X-Tenant-Slug": params.slug
      },
      body: JSON.stringify({
        name,
        price,
        interval,
        description,
        imageUrl,
        overlayTitle,
        overlaySubtitle,
        vodEnabled
      })
    });
    return {
      success: true,
      intent: planId ? "update_plan" : "create_plan"
    };
  } catch (e) {
    console.error("Failed to save membership plan:", e);
    return {
      error: e.message
    };
  }
};
const studio_$slug_memberships = UNSAFE_withComponentProps(function StudioMemberships() {
  const {
    plans,
    subscriptions,
    error
  } = useLoaderData();
  const actionData = useActionData();
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";
  const {
    isStudentView
  } = useOutletContext();
  const [modalState, setModalState] = useState({
    type: "closed"
  });
  const submit = useSubmit();
  const {
    getToken
  } = useAuth();
  const [cardData, setCardData] = useState({
    image: null,
    title: "",
    subtitle: "",
    previewUrl: ""
  });
  const [uploading, setUploading] = useState(false);
  const [planToDelete, setPlanToDelete] = useState(null);
  useEffect(() => {
    if (actionData?.success && !isSubmitting) {
      setModalState({
        type: "closed"
      });
      setCardData({
        image: null,
        title: "",
        subtitle: "",
        previewUrl: ""
      });
    }
  }, [actionData, isSubmitting]);
  useEffect(() => {
    if (modalState.type === "create") {
      setCardData({
        image: null,
        title: "",
        subtitle: "",
        previewUrl: ""
      });
    } else if (modalState.type === "edit") {
      setCardData({
        image: null,
        title: modalState.plan.overlayTitle || "",
        subtitle: modalState.plan.overlaySubtitle || "",
        previewUrl: ""
      });
    }
  }, [modalState.type, modalState.type === "edit" ? modalState.plan : null]);
  const handleCreateWrapper = async (e) => {
    e.preventDefault();
    setUploading(true);
    const form = e.currentTarget;
    const formData = new FormData(form);
    try {
      if (cardData.image) {
        const token = await getToken();
        const slug = window.location.pathname.split("/")[2];
        const uploadFormData = new FormData();
        const file = new File([cardData.image], "card.jpg", {
          type: "image/jpeg"
        });
        uploadFormData.append("file", file);
        const apiUrl = "https://studio-platform-api.slichti.workers.dev";
        const res = await fetch(`${apiUrl}/uploads/r2-image`, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${token}`,
            "X-Tenant-Slug": slug
          },
          body: uploadFormData
        });
        if (!res.ok) throw new Error("Image upload failed");
        const data = await res.json();
        formData.append("imageUrl", data.url);
      } else if (modalState.type === "edit" && modalState.plan.imageUrl) {
        formData.append("imageUrl", modalState.plan.imageUrl);
      }
      formData.append("overlayTitle", cardData.title);
      formData.append("overlaySubtitle", cardData.subtitle);
      if (modalState.type === "edit") {
        formData.append("planId", modalState.plan.id);
      }
      submit(formData, {
        method: "post"
      });
    } catch (err) {
      console.error(err);
      alert("Failed to save plan: " + err);
    } finally {
      setUploading(false);
    }
  };
  const isOpen = modalState.type !== "closed";
  const planToEdit = modalState.type === "edit" ? modalState.plan : null;
  return /* @__PURE__ */ jsxs("div", {
    className: "text-zinc-900 dark:text-zinc-100",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-2xl font-bold",
        children: "Memberships"
      }), !isStudentView && /* @__PURE__ */ jsx("button", {
        onClick: () => setModalState({
          type: "create"
        }),
        className: "px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors text-sm font-medium",
        children: "+ New Plan"
      })]
    }), error && /* @__PURE__ */ jsxs("div", {
      className: "bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded mb-4 text-sm",
      children: ["Failed to load plans: ", error]
    }), /* @__PURE__ */ jsx("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",
      children: plans.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "col-span-full text-center p-12 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-medium mb-1 text-zinc-900 dark:text-zinc-100",
          children: "No Membership Plans"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm mb-4 text-zinc-500 dark:text-zinc-400",
          children: 'Create tiers like "Unlimited" or "10-Pack" for your students.'
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setModalState({
            type: "create"
          }),
          className: "text-blue-600 hover:underline",
          children: "Create first plan"
        })]
      }) : plans.map((plan) => /* @__PURE__ */ jsxs("div", {
        className: "rounded-lg shadow-sm transition-colors overflow-hidden group bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "relative h-48 w-full bg-zinc-200 dark:bg-zinc-800 overflow-hidden",
          children: [plan.imageUrl ? /* @__PURE__ */ jsx("img", {
            src: plan.imageUrl,
            alt: plan.name,
            className: "w-full h-full object-cover transition-transform group-hover:scale-105"
          }) : /* @__PURE__ */ jsx("div", {
            className: "w-full h-full flex items-center justify-center text-zinc-400",
            children: "No Image"
          }), (plan.overlayTitle || plan.overlaySubtitle) && /* @__PURE__ */ jsx("div", {
            className: "absolute inset-0 bg-black/20 flex flex-col items-center justify-center text-center p-4",
            children: /* @__PURE__ */ jsxs("div", {
              className: "bg-white/90 dark:bg-black/70 backdrop-blur-sm px-4 py-2 rounded-lg max-w-[90%]",
              children: [plan.overlayTitle && /* @__PURE__ */ jsx("h3", {
                className: "font-bold text-lg text-zinc-900 dark:text-white uppercase tracking-wider",
                children: plan.overlayTitle
              }), plan.overlaySubtitle && /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-700 dark:text-zinc-300 mt-0.5",
                children: plan.overlaySubtitle
              })]
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "p-6",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-bold text-lg mb-2 text-zinc-900 dark:text-zinc-100",
            children: plan.name
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-2xl font-bold mb-4 text-zinc-900 dark:text-zinc-100",
            children: ["$", (plan.price / 100).toFixed(2), /* @__PURE__ */ jsxs("span", {
              className: "text-sm font-normal text-zinc-500 dark:text-zinc-400",
              children: ["/", plan.interval]
            })]
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm mb-6 min-h-[40px] text-zinc-500 dark:text-zinc-400",
            children: plan.description || "No description provided."
          }), isStudentView ? /* @__PURE__ */ jsx("button", {
            onClick: () => {
              window.location.href = `checkout?planId=${plan.id}`;
            },
            className: "w-full py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-bold text-sm transition-colors shadow-sm",
            children: "Subscribe Now"
          }) : /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx("button", {
              onClick: () => setModalState({
                type: "edit",
                plan
              }),
              className: "w-full py-2 rounded hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium text-sm border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100 transition-colors",
              children: "Edit Plan"
            }), /* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setPlanToDelete(plan.id),
              className: "w-full mt-2 text-red-600 hover:text-red-800 dark:hover:text-red-400 text-xs font-medium",
              children: "Delete Plan"
            })]
          })]
        })]
      }, plan.id))
    }), /* @__PURE__ */ jsx("h3", {
      className: "text-lg font-bold mb-4 text-zinc-900 dark:text-zinc-100",
      children: "Active Subscriptions"
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",
      children: subscriptions && subscriptions.length > 0 ? /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Student"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Plan"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Renewal"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: subscriptions.map((sub) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/20",
            children: [/* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900 dark:text-zinc-100",
                children: sub.user.profile?.fullName || sub.user.email
              }), /* @__PURE__ */ jsx("div", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: sub.user.email
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-sm text-zinc-600 dark:text-zinc-300",
              children: sub.planName
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("span", {
                className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${sub.status === "active" ? "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400" : "bg-zinc-100 text-zinc-800 dark:bg-zinc-800 dark:text-zinc-300"}`,
                children: sub.status
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-sm text-zinc-500 dark:text-zinc-400",
              children: sub.currentPeriodEnd ? new Date(sub.currentPeriodEnd).toLocaleDateString() : "N/A"
            })]
          }, sub.id))
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500 dark:text-zinc-400",
        children: "No active subscriptions yet."
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen,
      onClose: () => setModalState({
        type: "closed"
      }),
      title: modalState.type === "edit" ? "Edit Membership Plan" : "Create Membership Plan",
      maxWidth: "max-w-4xl",
      children: /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 lg:grid-cols-2 gap-8",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h4", {
            className: "font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
            children: "Card Appearance"
          }), /* @__PURE__ */ jsx(CardCreator, {
            initialImage: planToEdit?.imageUrl,
            initialTitle: planToEdit?.overlayTitle,
            initialSubtitle: planToEdit?.overlaySubtitle,
            onChange: setCardData
          }, planToEdit ? planToEdit.id : "new")]
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: handleCreateWrapper,
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
              children: "Plan Details"
            }), /* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
              children: "Plan Name (Internal)"
            }), /* @__PURE__ */ jsx("input", {
              name: "name",
              required: true,
              defaultValue: planToEdit?.name || "",
              placeholder: "e.g. Gold Unlimited",
              className: "w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
                children: "Price ($)"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                name: "price",
                step: "0.01",
                required: true,
                defaultValue: planToEdit ? (planToEdit.price / 100).toFixed(2) : "",
                className: "w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
                children: "Interval"
              }), /* @__PURE__ */ jsxs("select", {
                name: "interval",
                defaultValue: planToEdit?.interval || "month",
                className: "w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100",
                children: [/* @__PURE__ */ jsx("option", {
                  value: "month",
                  children: "Monthly"
                }), /* @__PURE__ */ jsx("option", {
                  value: "week",
                  children: "Weekly"
                }), /* @__PURE__ */ jsx("option", {
                  value: "year",
                  children: "Yearly"
                }), /* @__PURE__ */ jsx("option", {
                  value: "one_time",
                  children: "One Time"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
              children: "Description"
            }), /* @__PURE__ */ jsx("textarea", {
              name: "description",
              rows: 3,
              defaultValue: planToEdit?.description || "",
              className: "w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "checkbox",
              name: "vodEnabled",
              id: "vodEnabled",
              defaultChecked: planToEdit?.vodEnabled || false,
              className: "rounded border-zinc-300 dark:border-zinc-700 text-blue-600 focus:ring-blue-500"
            }), /* @__PURE__ */ jsx("label", {
              htmlFor: "vodEnabled",
              className: "text-sm font-medium text-zinc-700 dark:text-zinc-300",
              children: "Include VOD Access"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 ml-2",
              children: "(Allows entry to On-Demand Library)"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-4 flex gap-3",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setModalState({
                type: "closed"
              }),
              className: "flex-1 px-4 py-2 border border-zinc-200 dark:border-zinc-700 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium text-zinc-900 dark:text-zinc-100 transition-colors",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: isSubmitting || uploading,
              className: "flex-1 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md hover:opacity-90 font-medium disabled:opacity-50 transition-colors",
              children: uploading ? "Uploading..." : isSubmitting ? "Saving..." : modalState.type === "edit" ? "Save Changes" : "Create Plan"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!planToDelete,
      onOpenChange: (open) => !open && setPlanToDelete(null),
      onConfirm: () => {
        if (planToDelete) {
          submit({
            intent: "delete_plan",
            planId: planToDelete
          }, {
            method: "post"
          });
          setPlanToDelete(null);
        }
      },
      title: "Delete Membership Plan",
      description: "Are you sure you want to delete this plan? This cannot be undone and may affect existing subscriptions.",
      confirmText: "Delete Plan",
      variant: "destructive"
    })]
  });
});
const route22 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$i,
  default: studio_$slug_memberships,
  loader: loader$17
}, Symbol.toStringTag, { value: "Module" }));
const loader$16 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const [challengesData, myProgressData, leaderboardData] = await Promise.all([apiRequest("/challenges", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/challenges/my-progress", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).catch(() => []), apiRequest("/challenges/leaderboard", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).catch(() => [])]);
    return {
      challenges: challengesData || [],
      myProgress: myProgressData || [],
      leaderboard: leaderboardData || []
    };
  } catch (e) {
    console.error("Challenges Loader Error", e);
    return {
      challenges: [],
      myProgress: [],
      leaderboard: []
    };
  }
};
const action$h = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "join") {
    await apiRequest(`/challenges/${formData.get("challengeId")}/join`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      }
    });
  }
  return {
    success: true
  };
};
const studio_$slug_challenges = UNSAFE_withComponentProps(function ChallengesPrograms() {
  const {
    challenges,
    myProgress,
    leaderboard
  } = useLoaderData();
  useSubmit();
  const [isCreating, setIsCreating] = useState(false);
  const [tab, setTab] = useState("active");
  const activeChallenges = challenges.filter((c) => c.status === "active");
  const pastChallenges = challenges.filter((c) => c.status !== "active");
  const getProgress = (challengeId) => {
    return myProgress.find((p) => p.challengeId === challengeId);
  };
  const formatDate2 = (iso) => new Date(iso).toLocaleDateString(void 0, {
    month: "short",
    day: "numeric"
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-6 text-white",
      children: [/* @__PURE__ */ jsx("div", {
        className: "flex items-center justify-between",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-white/20 rounded-lg",
            children: /* @__PURE__ */ jsx(Trophy, {
              size: 24
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-2xl font-bold",
              children: "Challenges"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-white/80",
              children: "Complete challenges and earn rewards"
            })]
          })]
        })
      }), /* @__PURE__ */ jsx("div", {
        className: "flex gap-4 mt-6",
        children: ["active", "leaderboard", "past"].map((t) => /* @__PURE__ */ jsxs("button", {
          onClick: () => setTab(t),
          className: `px-4 py-2 rounded-lg font-medium transition ${tab === t ? "bg-white text-amber-600" : "bg-white/20 text-white hover:bg-white/30"}`,
          children: [t === "active" && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx(Flame, {
              size: 16,
              className: "inline mr-1"
            }), " Active"]
          }), t === "leaderboard" && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx(Medal, {
              size: 16,
              className: "inline mr-1"
            }), " Leaderboard"]
          }), t === "past" && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsx(Clock, {
              size: 16,
              className: "inline mr-1"
            }), " Past"]
          })]
        }, t))
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 overflow-y-auto p-6",
      children: [tab === "active" && /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: activeChallenges.length === 0 ? /* @__PURE__ */ jsxs("div", {
          className: "text-center py-12 text-zinc-500",
          children: [/* @__PURE__ */ jsx(Target, {
            size: 48,
            className: "mx-auto mb-4 opacity-50"
          }), /* @__PURE__ */ jsx("p", {
            children: "No active challenges"
          })]
        }) : activeChallenges.map((challenge) => {
          const progress = getProgress(challenge.id);
          const progressPercent = progress ? Math.min(100, progress.currentValue / challenge.goal * 100) : 0;
          return /* @__PURE__ */ jsx("div", {
            className: "bg-white rounded-xl border border-zinc-200 p-5 hover:shadow-md transition",
            children: /* @__PURE__ */ jsxs("div", {
              className: "flex items-start gap-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "p-3 bg-amber-100 rounded-xl",
                children: /* @__PURE__ */ jsx(Trophy, {
                  size: 24,
                  className: "text-amber-600"
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-1",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex items-center justify-between",
                  children: [/* @__PURE__ */ jsx("h3", {
                    className: "font-bold text-zinc-900",
                    children: challenge.title
                  }), /* @__PURE__ */ jsxs("span", {
                    className: "px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-medium flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Star, {
                      size: 12
                    }), " ", challenge.rewardPoints, " pts"]
                  })]
                }), /* @__PURE__ */ jsx("p", {
                  className: "text-sm text-zinc-500 mt-1",
                  children: challenge.description
                }), /* @__PURE__ */ jsxs("div", {
                  className: "mt-3 flex items-center gap-4 text-xs text-zinc-500",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Calendar, {
                      size: 12
                    }), " ", formatDate2(challenge.startDate), " - ", formatDate2(challenge.endDate)]
                  }), /* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Target, {
                      size: 12
                    }), " Goal: ", challenge.goal]
                  })]
                }), progress ? /* @__PURE__ */ jsxs("div", {
                  className: "mt-4",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex justify-between text-xs mb-1",
                    children: [/* @__PURE__ */ jsxs("span", {
                      className: "font-medium text-zinc-700",
                      children: [progress.currentValue, " / ", challenge.goal]
                    }), /* @__PURE__ */ jsxs("span", {
                      className: "text-amber-600",
                      children: [Math.round(progressPercent), "%"]
                    })]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
                    children: /* @__PURE__ */ jsx("div", {
                      className: `h-full transition-all ${progress.completed ? "bg-green-500" : "bg-amber-500"}`,
                      style: {
                        width: `${progressPercent}%`
                      }
                    })
                  }), progress.completed && /* @__PURE__ */ jsxs("p", {
                    className: "text-xs text-green-600 mt-2 flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Check, {
                      size: 12
                    }), " Completed!"]
                  })]
                }) : /* @__PURE__ */ jsxs(Form, {
                  method: "post",
                  className: "mt-4",
                  children: [/* @__PURE__ */ jsx("input", {
                    type: "hidden",
                    name: "intent",
                    value: "join"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "hidden",
                    name: "challengeId",
                    value: challenge.id
                  }), /* @__PURE__ */ jsx("button", {
                    type: "submit",
                    className: "px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-medium hover:bg-amber-600",
                    children: "Join Challenge"
                  })]
                })]
              })]
            })
          }, challenge.id);
        })
      }), tab === "leaderboard" && /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-4 border-b border-zinc-100",
          children: /* @__PURE__ */ jsxs("h2", {
            className: "font-bold text-zinc-900 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Medal, {
              size: 18
            }), " Top Challengers"]
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "divide-y divide-zinc-100",
          children: leaderboard.length === 0 ? /* @__PURE__ */ jsx("p", {
            className: "p-8 text-center text-zinc-500",
            children: "No leaderboard data"
          }) : leaderboard.slice(0, 10).map((entry2, i) => /* @__PURE__ */ jsxs("div", {
            className: "p-4 flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: `w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${i === 0 ? "bg-amber-400 text-white" : i === 1 ? "bg-zinc-300 text-zinc-700" : i === 2 ? "bg-amber-600 text-white" : "bg-zinc-100 text-zinc-500"}`,
              children: i + 1
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900",
                children: entry2.user?.profile?.firstName || entry2.user?.email
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-xs text-zinc-500",
                children: [entry2.completedCount, " challenges completed"]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-lg font-bold text-amber-600",
              children: [entry2.totalPoints, " pts"]
            })]
          }, i))
        })]
      }), tab === "past" && /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: pastChallenges.length === 0 ? /* @__PURE__ */ jsx("p", {
          className: "text-center py-12 text-zinc-500",
          children: "No past challenges"
        }) : pastChallenges.map((challenge) => /* @__PURE__ */ jsx("div", {
          className: "bg-white rounded-xl border border-zinc-200 p-4 opacity-75",
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsx(Trophy, {
              size: 20,
              className: "text-zinc-400"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h3", {
                className: "font-medium text-zinc-700",
                children: challenge.title
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500",
                children: formatDate2(challenge.endDate)
              })]
            })]
          })
        }, challenge.id))
      })]
    })]
  });
});
const route23 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$h,
  default: studio_$slug_challenges,
  loader: loader$16
}, Symbol.toStringTag, { value: "Module" }));
const loader$15 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const [statsData, upcomingData] = await Promise.all([apiRequest("/instructor/stats", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/instructor/upcoming", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    return {
      stats: statsData || {},
      upcoming: upcomingData || [],
      slug
    };
  } catch (e) {
    console.error("Instructor Loader Error", e);
    return {
      stats: {},
      upcoming: [],
      slug
    };
  }
};
const studio_$slug_instructor = UNSAFE_withComponentProps(function InstructorPortal() {
  const {
    stats,
    upcoming,
    slug
  } = useLoaderData();
  const location = useLocation();
  const isIndex = location.pathname.endsWith("/instructor") || location.pathname.endsWith("/instructor/");
  const navItems = [{
    href: `/studio/${slug}/instructor`,
    label: "Dashboard",
    icon: Home
  }, {
    href: `/studio/${slug}/instructor/schedule`,
    label: "My Schedule",
    icon: Calendar
  }, {
    href: `/studio/${slug}/instructor/availability`,
    label: "Availability",
    icon: Clock
  }, {
    href: `/studio/${slug}/instructor/subs`,
    label: "Sub Requests",
    icon: Repeat
  }, {
    href: `/studio/${slug}/instructor/payroll`,
    label: "Earnings",
    icon: DollarSign
  }];
  const formatDate2 = (iso) => new Date(iso).toLocaleDateString(void 0, {
    weekday: "short",
    month: "short",
    day: "numeric"
  });
  const formatTime = (iso) => new Date(iso).toLocaleTimeString([], {
    hour: "numeric",
    minute: "2-digit"
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "flex h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsxs("nav", {
      className: "w-64 bg-white border-r border-zinc-200 p-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3 mb-6 px-2",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-2 bg-purple-600 rounded-lg text-white",
          children: /* @__PURE__ */ jsx(Users, {
            size: 20
          })
        }), /* @__PURE__ */ jsx("span", {
          className: "font-bold text-zinc-900",
          children: "Instructor Portal"
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "space-y-1",
        children: navItems.map((item) => {
          const isActive = location.pathname === item.href;
          return /* @__PURE__ */ jsxs(Link, {
            to: item.href,
            className: `flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition ${isActive ? "bg-purple-50 text-purple-700" : "text-zinc-600 hover:bg-zinc-50"}`,
            children: [/* @__PURE__ */ jsx(item.icon, {
              size: 18
            }), item.label]
          }, item.href);
        })
      })]
    }), /* @__PURE__ */ jsx("main", {
      className: "flex-1 overflow-y-auto",
      children: isIndex ? (
        /* Dashboard */
        /* @__PURE__ */ jsxs("div", {
          className: "p-6",
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-2xl font-bold text-zinc-900 mb-6",
            children: "Welcome back!"
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-4 gap-4 mb-8",
            children: [/* @__PURE__ */ jsx(StatCard$1, {
              icon: Calendar,
              label: "Classes This Week",
              value: stats.classesThisWeek || 0
            }), /* @__PURE__ */ jsx(StatCard$1, {
              icon: Users,
              label: "Total Students",
              value: stats.totalStudents || 0
            }), /* @__PURE__ */ jsx(StatCard$1, {
              icon: DollarSign,
              label: "Earnings (MTD)",
              value: `$${((stats.earningsMtd || 0) / 100).toFixed(2)}`
            }), /* @__PURE__ */ jsx(StatCard$1, {
              icon: Repeat,
              label: "Open Sub Requests",
              value: stats.openSubRequests || 0
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-white rounded-xl border border-zinc-200",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-4 border-b border-zinc-100",
              children: /* @__PURE__ */ jsxs("h2", {
                className: "font-bold text-zinc-900 flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(Clock, {
                  size: 18
                }), " Upcoming Classes"]
              })
            }), upcoming.length === 0 ? /* @__PURE__ */ jsx("p", {
              className: "p-6 text-center text-zinc-500",
              children: "No upcoming classes"
            }) : /* @__PURE__ */ jsx("div", {
              className: "divide-y divide-zinc-100",
              children: upcoming.slice(0, 5).map((cls) => /* @__PURE__ */ jsxs("div", {
                className: "p-4 flex items-center justify-between",
                children: [/* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "font-medium text-zinc-900",
                    children: cls.title
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "text-sm text-zinc-500",
                    children: [formatDate2(cls.startTime), " at ", formatTime(cls.startTime)]
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-2 text-sm text-zinc-500",
                  children: [/* @__PURE__ */ jsx(Users, {
                    size: 14
                  }), " ", cls.confirmedCount || 0, " booked"]
                })]
              }, cls.id))
            })]
          })]
        })
      ) : /* @__PURE__ */ jsx(Outlet, {})
    })]
  });
});
function StatCard$1({
  icon: Icon,
  label,
  value
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white rounded-xl border border-zinc-200 p-4",
    children: [/* @__PURE__ */ jsx("div", {
      className: "flex items-center gap-2 mb-2",
      children: /* @__PURE__ */ jsx("div", {
        className: "p-1.5 bg-purple-100 rounded-lg text-purple-600",
        children: /* @__PURE__ */ jsx(Icon, {
          size: 16
        })
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "text-2xl font-bold text-zinc-900",
      children: value
    }), /* @__PURE__ */ jsx("div", {
      className: "text-xs text-zinc-500",
      children: label
    })]
  });
}
const route24 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_instructor,
  loader: loader$15
}, Symbol.toStringTag, { value: "Module" }));
const loader$14 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const url = new URL(args.request.url);
  const weekStart = url.searchParams.get("week") || (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
  const token = await getToken();
  try {
    const scheduleData = await apiRequest(`/instructor/schedule?weekStart=${weekStart}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      classes: scheduleData || [],
      weekStart
    };
  } catch (e) {
    console.error("Schedule Loader Error", e);
    return {
      classes: [],
      weekStart
    };
  }
};
const studio_$slug_instructor_schedule = UNSAFE_withComponentProps(function InstructorSchedule() {
  const {
    classes,
    weekStart
  } = useLoaderData();
  const weekDates = useMemo(() => {
    const start = new Date(weekStart);
    const dayOfWeek = start.getDay();
    const monday = new Date(start);
    monday.setDate(start.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
    return Array.from({
      length: 7
    }, (_, i) => {
      const date = new Date(monday);
      date.setDate(monday.getDate() + i);
      return {
        date: date.toISOString().split("T")[0],
        day: date
      };
    });
  }, [weekStart]);
  const getClassesForDay = (dateStr) => {
    return classes.filter((cls) => {
      const clsDate = new Date(cls.startTime).toISOString().split("T")[0];
      return clsDate === dateStr;
    }).sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());
  };
  const formatTime = (iso) => new Date(iso).toLocaleTimeString([], {
    hour: "numeric",
    minute: "2-digit"
  });
  const navigateWeek = (direction) => {
    const current = new Date(weekDates[0].date);
    current.setDate(current.getDate() + direction * 7);
    window.location.search = `?week=${current.toISOString().split("T")[0]}`;
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-6",
      children: [/* @__PURE__ */ jsxs("h1", {
        className: "text-xl font-bold text-zinc-900 flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(Calendar, {
          size: 20
        }), " My Schedule"]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => navigateWeek(-1),
          className: "p-2 hover:bg-zinc-100 rounded-lg",
          children: /* @__PURE__ */ jsx(ChevronLeft, {
            size: 18
          })
        }), /* @__PURE__ */ jsxs("span", {
          className: "text-sm font-medium",
          children: [weekDates[0].day.toLocaleDateString(void 0, {
            month: "short",
            day: "numeric"
          }), " - ", weekDates[6].day.toLocaleDateString(void 0, {
            month: "short",
            day: "numeric",
            year: "numeric"
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => navigateWeek(1),
          className: "p-2 hover:bg-zinc-100 rounded-lg",
          children: /* @__PURE__ */ jsx(ChevronRight, {
            size: 18
          })
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "grid grid-cols-7 gap-4",
      children: weekDates.map(({
        date,
        day
      }) => {
        const dayClasses = getClassesForDay(date);
        const isToday = date === (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
        return /* @__PURE__ */ jsxs("div", {
          className: `bg-white rounded-xl border ${isToday ? "border-purple-300 ring-2 ring-purple-100" : "border-zinc-200"} overflow-hidden`,
          children: [/* @__PURE__ */ jsxs("div", {
            className: `p-3 text-center ${isToday ? "bg-purple-50" : "bg-zinc-50"} border-b border-zinc-100`,
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-xs font-medium text-zinc-500",
              children: day.toLocaleDateString(void 0, {
                weekday: "short"
              })
            }), /* @__PURE__ */ jsx("div", {
              className: `text-lg font-bold ${isToday ? "text-purple-700" : "text-zinc-900"}`,
              children: day.getDate()
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "p-2 space-y-2 min-h-[200px]",
            children: dayClasses.length === 0 ? /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-400 text-center py-4",
              children: "No classes"
            }) : dayClasses.map((cls) => /* @__PURE__ */ jsxs("div", {
              className: "p-2 bg-purple-50 rounded-lg text-xs",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-purple-800 truncate",
                children: cls.title
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-purple-600 flex items-center gap-1 mt-1",
                children: [/* @__PURE__ */ jsx(Clock, {
                  size: 10
                }), " ", formatTime(cls.startTime)]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2 mt-1 text-zinc-500",
                children: [/* @__PURE__ */ jsxs("span", {
                  className: "flex items-center gap-1",
                  children: [/* @__PURE__ */ jsx(Users, {
                    size: 10
                  }), " ", cls.confirmedCount || 0]
                }), cls.videoProvider === "livekit" && /* @__PURE__ */ jsx(Video, {
                  size: 10
                })]
              })]
            }, cls.id))
          })]
        }, date);
      })
    })]
  });
});
const route25 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_instructor_schedule,
  loader: loader$14
}, Symbol.toStringTag, { value: "Module" }));
const loader$13 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const url = new URL(args.request.url);
  const month = url.searchParams.get("month") || (/* @__PURE__ */ new Date()).toISOString().slice(0, 7);
  const token = await getToken();
  try {
    const payrollData = await apiRequest(`/instructor/payroll?month=${month}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      payroll: payrollData || {},
      month
    };
  } catch (e) {
    console.error("Payroll Loader Error", e);
    return {
      payroll: {},
      month
    };
  }
};
const studio_$slug_instructor_payroll = UNSAFE_withComponentProps(function InstructorPayroll() {
  const {
    payroll,
    month
  } = useLoaderData();
  const [searchParams, setSearchParams] = useSearchParams();
  const formatCurrency = (cents) => `$${((cents || 0) / 100).toFixed(2)}`;
  const changeMonth = (offset) => {
    const current = /* @__PURE__ */ new Date(month + "-01");
    current.setMonth(current.getMonth() + offset);
    setSearchParams({
      month: current.toISOString().slice(0, 7)
    });
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-6",
      children: [/* @__PURE__ */ jsxs("h1", {
        className: "text-xl font-bold text-zinc-900 flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(DollarSign, {
          size: 20
        }), " Earnings"]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => changeMonth(-1),
          className: "px-3 py-1 text-sm hover:bg-zinc-100 rounded",
          children: "â† Prev"
        }), /* @__PURE__ */ jsx("span", {
          className: "text-sm font-medium",
          children: (/* @__PURE__ */ new Date(month + "-01")).toLocaleDateString(void 0, {
            month: "long",
            year: "numeric"
          })
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => changeMonth(1),
          className: "px-3 py-1 text-sm hover:bg-zinc-100 rounded",
          children: "Next â†’"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-3 gap-4 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-5 text-white",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm opacity-80 mb-1",
          children: "Total Earnings"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold",
          children: formatCurrency(payroll.total || 0)
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 p-5",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mb-1",
          children: "Classes Taught"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-2xl font-bold text-zinc-900",
          children: payroll.classCount || 0
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 p-5",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mb-1",
          children: "Avg per Class"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-2xl font-bold text-zinc-900",
          children: formatCurrency(payroll.classCount ? Math.round((payroll.total || 0) / payroll.classCount) : 0)
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl border border-zinc-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-100 flex items-center justify-between",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "font-bold text-zinc-900",
          children: "Breakdown"
        }), /* @__PURE__ */ jsxs("button", {
          className: "text-sm text-zinc-500 hover:text-zinc-700 flex items-center gap-1",
          children: [/* @__PURE__ */ jsx(Download, {
            size: 14
          }), " Export"]
        })]
      }), !payroll.items || payroll.items.length === 0 ? /* @__PURE__ */ jsx("p", {
        className: "p-6 text-center text-zinc-500",
        children: "No earnings this month"
      }) : /* @__PURE__ */ jsxs("table", {
        className: "w-full text-sm",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "text-left p-3 font-medium text-zinc-500",
              children: "Date"
            }), /* @__PURE__ */ jsx("th", {
              className: "text-left p-3 font-medium text-zinc-500",
              children: "Class"
            }), /* @__PURE__ */ jsx("th", {
              className: "text-right p-3 font-medium text-zinc-500",
              children: "Rate"
            }), /* @__PURE__ */ jsx("th", {
              className: "text-right p-3 font-medium text-zinc-500",
              children: "Amount"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100",
          children: payroll.items.map((item, i) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50",
            children: [/* @__PURE__ */ jsx("td", {
              className: "p-3",
              children: new Date(item.date).toLocaleDateString()
            }), /* @__PURE__ */ jsx("td", {
              className: "p-3",
              children: item.classTitle
            }), /* @__PURE__ */ jsx("td", {
              className: "p-3 text-right text-zinc-500",
              children: item.rate
            }), /* @__PURE__ */ jsx("td", {
              className: "p-3 text-right font-medium",
              children: formatCurrency(item.amount)
            })]
          }, i))
        })]
      })]
    })]
  });
});
const route26 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_instructor_payroll,
  loader: loader$13
}, Symbol.toStringTag, { value: "Module" }));
const loader$12 = async ({
  params
}) => {
  return redirect(`/studio/${params.slug}`);
};
const studio_$slug_dashboard = UNSAFE_withComponentProps(function RedirectToStudioDashboard() {
  return null;
});
const route27 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_dashboard,
  loader: loader$12
}, Symbol.toStringTag, { value: "Module" }));
const loader$11 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  let coupons = [];
  try {
    const res = await apiRequest("/commerce/coupons", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    coupons = res.coupons || [];
  } catch (e) {
    console.error("Failed to load coupons", e);
  }
  return {
    coupons,
    token,
    slug
  };
};
const studio_$slug_discounts = UNSAFE_withComponentProps(function DiscountsPage() {
  const {
    coupons: initialCoupons,
    token,
    slug
  } = useLoaderData();
  const [coupons, setCoupons] = useState(initialCoupons);
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [form, setForm] = useState({
    code: "",
    type: "percent",
    value: "10"
  });
  const [loading, setLoading] = useState(false);
  const [couponToDelete, setCouponToDelete] = useState(null);
  async function handleCreate(e) {
    e.preventDefault();
    setLoading(true);
    const numericVal = parseInt(form.value);
    const finalValue = form.type === "amount" ? numericVal * 100 : numericVal;
    try {
      const res = await apiRequest("/commerce/coupons", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          ...form,
          value: finalValue
        })
        // Send adjusted value
      });
      if (res.error) {
        alert(res.error);
      } else {
        const refreshed = await apiRequest("/commerce/coupons", token, {
          headers: {
            "X-Tenant-Slug": slug
          }
        });
        setCoupons(refreshed.coupons || []);
        setIsCreateOpen(false);
        setForm({
          code: "",
          type: "percent",
          value: "10"
        });
      }
    } catch (e2) {
      console.error(e2);
    } finally {
      setLoading(false);
    }
  }
  async function handleDelete(id) {
    setCouponToDelete(id);
  }
  async function handleConfirmDelete() {
    if (!couponToDelete) return;
    try {
      await apiRequest(`/commerce/coupons/${couponToDelete}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setCoupons((prev) => prev.filter((c) => c.id !== couponToDelete));
      setCouponToDelete(null);
    } catch (e) {
      console.error(e);
    }
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900",
          children: "Discounts"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500",
          children: "Manage promo codes and coupons."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreateOpen(!isCreateOpen),
        className: "bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 hover:bg-zinc-800",
        children: [/* @__PURE__ */ jsx(Plus, {
          className: "h-4 w-4"
        }), " Create Code"]
      })]
    }), isCreateOpen && /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 border border-zinc-200 rounded-lg p-6 mb-8",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "font-semibold text-zinc-900 mb-4",
        children: "New Coupon"
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleCreate,
        className: "flex flex-col md:flex-row gap-4 items-end",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex-1",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-500 uppercase mb-1",
            children: "Code"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            className: "w-full border border-zinc-300 rounded px-3 py-2 uppercase font-mono",
            placeholder: "SUMMER20",
            value: form.code,
            onChange: (e) => setForm({
              ...form,
              code: e.target.value.toUpperCase()
            }),
            required: true
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "w-32",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-500 uppercase mb-1",
            children: "Type"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full border border-zinc-300 rounded px-3 py-2",
            value: form.type,
            onChange: (e) => setForm({
              ...form,
              type: e.target.value
            }),
            children: [/* @__PURE__ */ jsx("option", {
              value: "percent",
              children: "% Percent"
            }), /* @__PURE__ */ jsx("option", {
              value: "amount",
              children: "$ Amount"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "w-32",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-500 uppercase mb-1",
            children: "Value"
          }), /* @__PURE__ */ jsx("input", {
            type: "number",
            className: "w-full border border-zinc-300 rounded px-3 py-2",
            placeholder: "10",
            value: form.value,
            onChange: (e) => setForm({
              ...form,
              value: e.target.value
            }),
            required: true
          })]
        }), /* @__PURE__ */ jsx("button", {
          type: "submit",
          disabled: loading,
          className: "bg-blue-600 text-white px-6 py-2 rounded font-medium hover:bg-blue-700 disabled:opacity-50",
          children: loading ? "Saving..." : "Save Coupon"
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",
      children: /* @__PURE__ */ jsxs("table", {
        className: "min-w-full divide-y divide-zinc-200",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
              children: "Code"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
              children: "Discount"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-right text-xs font-medium text-zinc-500 uppercase",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-200",
          children: [coupons.map((c) => /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 whitespace-nowrap",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(Tag, {
                  className: "h-4 w-4 text-zinc-400"
                }), /* @__PURE__ */ jsx("span", {
                  className: "font-mono font-medium text-zinc-900",
                  children: c.code
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 whitespace-nowrap text-zinc-600",
              children: c.type === "percent" ? `${c.value}% Off` : `$${(c.value / 100).toFixed(2)} Off`
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 whitespace-nowrap",
              children: /* @__PURE__ */ jsx("span", {
                className: `px-2 py-1 text-xs rounded-full ${c.active ? "bg-green-100 text-green-700" : "bg-gray-100 text-gray-500"}`,
                children: c.active ? "Active" : "Inactive"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 whitespace-nowrap text-right text-sm",
              children: c.active && /* @__PURE__ */ jsx("button", {
                onClick: () => handleDelete(c.id),
                className: "text-red-600 hover:text-red-800",
                children: /* @__PURE__ */ jsx(Trash, {
                  className: "h-4 w-4"
                })
              })
            })]
          }, c.id)), coupons.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 4,
              className: "px-6 py-8 text-center text-zinc-500 italic",
              children: "No coupons created yet."
            })
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!couponToDelete,
      onOpenChange: (open) => !open && setCouponToDelete(null),
      onConfirm: handleConfirmDelete,
      title: "Deactivate Coupon",
      description: "Are you sure? This will deactivate the code and prevent future uses.",
      confirmText: "Deactivate",
      variant: "destructive"
    })]
  });
});
const route28 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_discounts,
  loader: loader$11
}, Symbol.toStringTag, { value: "Module" }));
const MenuBar = ({ editor }) => {
  if (!editor) {
    return null;
  }
  const addImage = () => {
    const url = window.prompt("Enter image URL");
    if (url) {
      editor.chain().focus().setImage({ src: url }).run();
    }
  };
  const setLink = () => {
    const previousUrl = editor.getAttributes("link").href;
    const url = window.prompt("URL", previousUrl);
    if (url === null) {
      return;
    }
    if (url === "") {
      editor.chain().focus().extendMarkRange("link").unsetLink().run();
      return;
    }
    editor.chain().focus().extendMarkRange("link").setLink({ href: url }).run();
  };
  return /* @__PURE__ */ jsxs("div", { className: "flex flex-wrap gap-1 p-2 border-b bg-zinc-50 rounded-t-lg", children: [
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().toggleBold().run(),
        disabled: !editor.can().chain().focus().toggleBold().run(),
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("bold") ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Bold",
        children: /* @__PURE__ */ jsx(Bold, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().toggleItalic().run(),
        disabled: !editor.can().chain().focus().toggleItalic().run(),
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("italic") ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Italic",
        children: /* @__PURE__ */ jsx(Italic, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx("div", { className: "w-px h-6 bg-zinc-300 mx-1 self-center" }),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().toggleHeading({ level: 2 }).run(),
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("heading", { level: 2 }) ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Heading 2",
        children: /* @__PURE__ */ jsx(Type, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().toggleBulletList().run(),
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("bulletList") ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Bullet List",
        children: /* @__PURE__ */ jsx(List, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().toggleCodeBlock().run(),
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("codeBlock") ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Code Block",
        children: /* @__PURE__ */ jsx(Code, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx("div", { className: "w-px h-6 bg-zinc-300 mx-1 self-center" }),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: setLink,
        className: `p-1.5 rounded hover:bg-zinc-200 ${editor.isActive("link") ? "bg-zinc-200 text-black" : "text-zinc-500"}`,
        title: "Add Link",
        children: /* @__PURE__ */ jsx(Link$1, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => editor.chain().focus().unsetLink().run(),
        disabled: !editor.isActive("link"),
        className: "p-1.5 rounded hover:bg-zinc-200 text-zinc-500 disabled:opacity-30",
        title: "Remove Link",
        children: /* @__PURE__ */ jsx(Unlink, { className: "w-4 h-4" })
      }
    ),
    /* @__PURE__ */ jsx("div", { className: "w-px h-6 bg-zinc-300 mx-1 self-center" }),
    /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: addImage,
        className: "p-1.5 rounded hover:bg-zinc-200 text-zinc-500",
        title: "Add Image URL",
        children: /* @__PURE__ */ jsx(Image$1, { className: "w-4 h-4" })
      }
    )
  ] });
};
function RichTextEditor({ value, onChange, placeholder, className }) {
  const editor = useEditor({
    extensions: [
      StarterKit,
      Link$2.configure({
        openOnClick: false,
        HTMLAttributes: {
          class: "text-blue-600 underline"
        }
      }),
      Image$2.configure({
        HTMLAttributes: {
          class: "rounded-lg max-w-full my-4 border border-zinc-200"
        }
      }),
      Placeholder.configure({
        placeholder: placeholder || "Write something..."
      })
    ],
    content: value,
    editorProps: {
      attributes: {
        class: "prose prose-sm max-w-none focus:outline-none min-h-[150px] p-4"
      }
    },
    onUpdate: ({ editor: editor2 }) => {
      onChange(editor2.getHTML());
    }
  });
  useEffect(() => {
    if (editor && value !== editor.getHTML()) {
      if (editor.getText() === "" && value) {
        editor.commands.setContent(value);
      }
    }
  }, [value, editor]);
  return /* @__PURE__ */ jsxs("div", { className: `border border-zinc-300 rounded-lg bg-white overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 ${className}`, children: [
    /* @__PURE__ */ jsx(MenuBar, { editor }),
    /* @__PURE__ */ jsx(EditorContent, { editor })
  ] });
}
const loader$10 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  let campaigns = [];
  let automations = [];
  try {
    const [campRes, autoRes] = await Promise.all([apiRequest("/marketing", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/marketing/automations", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    campaigns = campRes.campaigns || [];
    automations = autoRes.automations || [];
  } catch (e) {
    console.error("Failed to load marketing data", e);
  }
  return {
    campaigns,
    automations,
    slug
  };
};
const studio_$slug_marketing = UNSAFE_withComponentProps(function MarketingPage() {
  const {
    campaigns: initialCampaigns,
    automations: initialAutomations,
    slug
  } = useLoaderData();
  const {
    getToken
  } = useAuth();
  const [tab, setTab] = useState("broadcast");
  const [notification, setNotification] = useState(null);
  const [campaigns, setCampaigns] = useState(initialCampaigns);
  const [subject, setSubject] = useState("");
  const [content, setContent] = useState("");
  const [sending, setSending] = useState(false);
  const [filters, setFilters] = useState({
    ageMin: 0,
    ageMax: 100,
    preset: "all"
  });
  const [automations, setAutomations] = useState(initialAutomations || []);
  const [editingAuto, setEditingAuto] = useState(null);
  const [editForm, setEditForm] = useState({
    subject: "",
    content: "",
    isEnabled: false,
    timingType: "immediate",
    timingValue: 0,
    triggerEvent: "",
    triggerCondition: "{}",
    // Display as string
    channels: ["email"],
    couponConfig: {
      enabled: false,
      type: "percent",
      value: 20,
      validityDays: 7
    }
  });
  const [testModal, setTestModal] = useState({
    isOpen: false,
    automationId: null,
    email: ""
  });
  const [isSendingTest, setIsSendingTest] = useState(false);
  const showNotification = (message, type = "success") => {
    setNotification({
      message,
      type
    });
    setTimeout(() => setNotification(null), 3e3);
  };
  const [testEmail, setTestEmail] = useState("");
  const {
    tenant
  } = useOutletContext();
  const [replyTo, setReplyTo] = useState(tenant?.branding?.emailReplyTo || "");
  const [footerText, setFooterText] = useState(tenant?.branding?.emailFooterText || "");
  const [savingSettings, setSavingSettings] = useState(false);
  async function handleSendBroadcast(e) {
    e.preventDefault();
    setSending(true);
    try {
      const token = await getToken();
      const res = await apiRequest("/marketing", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          subject,
          content,
          filters: filters.preset === "all" ? {} : {
            ageMin: filters.ageMin,
            ageMax: filters.ageMax
          }
        })
      });
      if (res.error) {
        showNotification(res.error, "error");
      } else {
        showNotification(`Campaign Sent to ${res.count} recipients!`);
        setSubject("");
        setContent("");
        const refreshed = await apiRequest("/marketing", token, {
          headers: {
            "X-Tenant-Slug": slug
          }
        });
        setCampaigns(refreshed.campaigns || []);
      }
    } catch (e2) {
      showNotification("Failed to send: " + e2.message, "error");
    } finally {
      setSending(false);
    }
  }
  async function handleCreateAutomation() {
    try {
      const token = await getToken();
      const res = await apiRequest("/marketing/automations", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          triggerEvent: "new_student",
          subject: "New Automation"
        })
      });
      if (res.error) throw new Error(res.error);
      setAutomations([...automations, res]);
      setEditingAuto(res);
      setEditForm({
        subject: res.subject,
        content: res.content,
        isEnabled: res.isEnabled,
        timingType: res.timingType || "immediate",
        timingValue: res.timingValue || 0,
        triggerEvent: res.triggerEvent,
        triggerCondition: JSON.stringify(res.triggerCondition || {}, null, 2),
        channels: res.channels || ["email"],
        couponConfig: res.couponConfig ? {
          ...res.couponConfig,
          enabled: true
        } : {
          enabled: false,
          type: "percent",
          value: 20,
          validityDays: 7
        }
      });
    } catch (e) {
      showNotification("Failed to create: " + e.message, "error");
    }
  }
  async function handleUpdateAutomation(e) {
    e.preventDefault();
    if (!editingAuto) return;
    try {
      let parsedCondition = null;
      try {
        parsedCondition = editForm.triggerCondition ? JSON.parse(editForm.triggerCondition) : null;
      } catch (err) {
        showNotification("Invalid JSON in Condition field", "error");
        return;
      }
      const token = await getToken();
      const payload = {
        ...editForm,
        triggerCondition: parsedCondition
      };
      const res = await apiRequest(`/marketing/automations/${editingAuto.id}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(payload)
      });
      setAutomations(automations.map((a) => a.id === editingAuto.id ? res : a));
      setEditingAuto(null);
      showNotification("Automation updated successfully");
    } catch (e2) {
      showNotification("Failed to update: " + e2.message, "error");
    }
  }
  const [deleteModal, setDeleteModal] = useState({
    isOpen: false,
    automationId: null
  });
  function handleDeleteAutomation(id) {
    setDeleteModal({
      isOpen: true,
      automationId: id
    });
  }
  async function confirmDeleteAutomation() {
    if (!deleteModal.automationId) return;
    const id = deleteModal.automationId;
    try {
      const token = await getToken();
      await apiRequest(`/marketing/automations/${id}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setAutomations(automations.filter((a) => a.id !== id));
      showNotification("Automation deleted.");
    } catch (e) {
      showNotification("Failed to delete: " + e.message, "error");
    } finally {
      setDeleteModal({
        isOpen: false,
        automationId: null
      });
    }
  }
  function openTestModal(id) {
    setTestModal({
      isOpen: true,
      automationId: id,
      email: testModal.email
    });
  }
  async function handleSendTestSubmit(e) {
    e.preventDefault();
    if (!testModal.automationId || !testModal.email) return;
    setIsSendingTest(true);
    try {
      const token = await getToken();
      await apiRequest(`/marketing/automations/${testModal.automationId}/test`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          email: testModal.email
        })
      });
      showNotification("Test email sent!");
      setTestModal({
        ...testModal,
        isOpen: false
      });
    } catch (e2) {
      showNotification("Failed to test: " + e2.message, "error");
    } finally {
      setIsSendingTest(false);
    }
  }
  const triggerLabels = {
    "new_student": "New Student Welcome",
    "birthday": "Birthday Greeting",
    "absent": "Win-back (Absent)",
    "class_attended": "Class Follow-up",
    "order_completed": "Order Follow-up",
    "trial_ending": "Trial Ending",
    "subscription_renewing": "Subscription Renewing"
  };
  const getTimingLabel = (auto) => {
    if (auto.timingType === "immediate") return "Immediate";
    if (auto.timingType === "delay") return `Delay: ${auto.timingValue} hours`;
    if (auto.timingType === "before") return `${auto.timingValue} hours Before`;
    if (auto.timingType === "after") return `${auto.timingValue} hours After`;
    if (auto.delayHours > 0) return `Delay: ${auto.delayHours} hours`;
    return "Immediate";
  };
  async function toggleAutomation(auto) {
    try {
      const newState = !auto.isEnabled;
      setAutomations(automations.map((a) => a.id === auto.id ? {
        ...a,
        isEnabled: newState
      } : a));
      const token = await getToken();
      await apiRequest(`/marketing/automations/${auto.id}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          isEnabled: newState
        })
      });
    } catch (e) {
      showNotification("Failed to toggle: " + e.message, "error");
      setAutomations(automations.map((a) => a.id === auto.id ? {
        ...a,
        isEnabled: !auto.isEnabled
      } : a));
    }
  }
  async function handleSaveEmailSettings(e) {
    e.preventDefault();
    setSavingSettings(true);
    try {
      const token = await getToken();
      await apiRequest(`/tenant/settings`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          branding: {
            emailReplyTo: replyTo,
            emailFooterText: footerText
          }
        })
      });
      showNotification("Email settings saved successfully!");
    } catch (e2) {
      showNotification("Failed to save: " + e2.message, "error");
    } finally {
      setSavingSettings(false);
    }
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-6xl mx-auto py-8 px-4 relative",
    children: [notification && /* @__PURE__ */ jsxs("div", {
      className: `fixed top-4 right-4 z-[100] px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-in slide-in-from-right fade-in duration-300 ${notification.type === "error" ? "bg-red-50 border-red-200 text-red-800" : "bg-emerald-50 border-emerald-200 text-emerald-800"}`,
      children: [notification.type === "error" ? /* @__PURE__ */ jsx(AlertTriangle, {
        className: "h-5 w-5"
      }) : /* @__PURE__ */ jsx(CheckCircle, {
        className: "h-5 w-5"
      }), /* @__PURE__ */ jsx("span", {
        className: "font-medium text-sm",
        children: notification.message
      }), /* @__PURE__ */ jsx("button", {
        onClick: () => setNotification(null),
        className: "ml-2 hover:opacity-70",
        children: /* @__PURE__ */ jsx(X, {
          className: "h-4 w-4"
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Email Automations"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Engage your students with broadcasts, automations, and email settings."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex gap-4 mb-6 border-b border-zinc-200",
      children: [/* @__PURE__ */ jsxs("button", {
        onClick: () => setTab("broadcast"),
        className: `pb-3 px-1 font-medium text-sm transition-colors relative ${tab === "broadcast" ? "text-blue-600" : "text-zinc-500 hover:text-zinc-700"}`,
        children: ["Broadcasts", tab === "broadcast" && /* @__PURE__ */ jsx("div", {
          className: "absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setTab("automation"),
        className: `pb-3 px-1 font-medium text-sm transition-colors relative ${tab === "automation" ? "text-blue-600" : "text-zinc-500 hover:text-zinc-700"}`,
        children: ["Automations", tab === "automation" && /* @__PURE__ */ jsx("div", {
          className: "absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setTab("settings"),
        className: `pb-3 px-1 font-medium text-sm transition-colors relative ${tab === "settings" ? "text-blue-600" : "text-zinc-500 hover:text-zinc-700"}`,
        children: ["Settings", tab === "settings" && /* @__PURE__ */ jsx("div", {
          className: "absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"
        })]
      })]
    }), tab === "broadcast" && /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "lg:col-span-2 space-y-6",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 p-6 shadow-sm",
          children: [/* @__PURE__ */ jsxs("h2", {
            className: "font-semibold text-lg mb-4 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Mail, {
              className: "h-5 w-5 text-blue-600"
            }), "New Broadcast"]
          }), /* @__PURE__ */ jsxs("form", {
            onSubmit: handleSendBroadcast,
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 mb-1",
                children: "Subject Line"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                value: subject,
                onChange: (e) => setSubject(e.target.value),
                className: "w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",
                placeholder: "e.g. November Newsletter",
                required: true
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 mb-1",
                children: "Message Content"
              }), /* @__PURE__ */ jsx(RichTextEditor, {
                value: content,
                onChange: setContent,
                placeholder: "Write your beautiful email content...",
                className: "min-h-[300px]"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex justify-between items-start mt-1",
                children: [/* @__PURE__ */ jsx("p", {
                  className: "text-xs text-zinc-400",
                  children: "Rich text enabled. Use the toolbar to format."
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 text-right",
                  children: ["Variables: ", /* @__PURE__ */ jsx("span", {
                    className: "font-mono bg-zinc-100 px-1 rounded",
                    children: "{{firstName}}"
                  }), " ", /* @__PURE__ */ jsx("span", {
                    className: "font-mono bg-zinc-100 px-1 rounded",
                    children: "{{studioName}}"
                  })]
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "bg-zinc-50 border border-zinc-200 p-4 rounded-lg",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-semibold text-zinc-800 mb-3",
                children: "Target Audience"
              }), /* @__PURE__ */ jsx("div", {
                className: "flex flex-wrap gap-2 mb-4",
                children: [{
                  label: "All Students",
                  value: "all",
                  min: 0,
                  max: 100
                }, {
                  label: "Youth (<18)",
                  value: "youth",
                  min: 0,
                  max: 17
                }, {
                  label: "Adults (18-64)",
                  value: "adults",
                  min: 18,
                  max: 64
                }, {
                  label: "Seniors (65+)",
                  value: "seniors",
                  min: 65,
                  max: 100
                }, {
                  label: "Custom",
                  value: "custom",
                  min: filters.ageMin,
                  max: filters.ageMax
                }].map((p) => /* @__PURE__ */ jsx("button", {
                  type: "button",
                  onClick: () => setFilters({
                    ...filters,
                    preset: p.value,
                    ageMin: p.min,
                    ageMax: p.max
                  }),
                  className: `px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${filters.preset === p.value ? "bg-blue-600 text-white" : "bg-white border border-zinc-300 text-zinc-600 hover:bg-zinc-50"}`,
                  children: p.label
                }, p.value))
              }), filters.preset === "custom" && /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-4 animate-in fade-in slide-in-from-top-1",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex-1",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-[10px] uppercase font-bold text-zinc-500 mb-1",
                    children: "Min Age"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "number",
                    value: filters.ageMin,
                    onChange: (e) => setFilters({
                      ...filters,
                      ageMin: Number(e.target.value)
                    }),
                    className: "w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "flex-1",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-[10px] uppercase font-bold text-zinc-500 mb-1",
                    children: "Max Age"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "number",
                    value: filters.ageMax,
                    onChange: (e) => setFilters({
                      ...filters,
                      ageMax: Number(e.target.value)
                    }),
                    className: "w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"
                  })]
                })]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "flex justify-end",
              children: /* @__PURE__ */ jsx("button", {
                type: "submit",
                disabled: sending,
                className: "bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",
                children: sending ? "Sending..." : /* @__PURE__ */ jsxs(Fragment, {
                  children: [/* @__PURE__ */ jsx(Send, {
                    className: "h-4 w-4"
                  }), "Send Broadcast"]
                })
              })
            })]
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-zinc-50 rounded-lg border border-zinc-200 p-6 h-fit",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-700 mb-4",
          children: "Recent Campaigns"
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [campaigns.length === 0 && /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 italic",
            children: "No campaigns yet."
          }), campaigns.map((c) => /* @__PURE__ */ jsxs("div", {
            className: "bg-white border border-zinc-200 rounded p-3 shadow-sm",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-sm text-zinc-900 line-clamp-1",
                children: c.subject
              }), /* @__PURE__ */ jsx("span", {
                className: `text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${c.status === "sent" ? "bg-green-100 text-green-700" : "bg-gray-100 text-gray-600"}`,
                children: c.status
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 mb-2",
              children: new Date(c.sentAt).toLocaleDateString()
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-3 text-xs text-zinc-600",
              children: [/* @__PURE__ */ jsxs("span", {
                className: "flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(Send, {
                  className: "h-3 w-3"
                }), c.stats?.sent || 0, " Sent"]
              }), c.filters && /* @__PURE__ */ jsxs("span", {
                className: "flex items-center gap-1 bg-zinc-100 px-1.5 rounded",
                children: [c.filters.ageMin, "-", c.filters.ageMax, " yrs"]
              })]
            })]
          }, c.id))]
        })]
      })]
    }), tab === "automation" && /* @__PURE__ */ jsx("div", {
      className: "space-y-6",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-6 rounded-lg border border-zinc-200",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("h2", {
              className: "font-semibold text-lg flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(Zap, {
                className: "h-5 w-5 text-amber-500"
              }), "Active Automations"]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500",
              children: "These emails are sent automatically based on student activity."
            })]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: handleCreateAutomation,
            className: "flex items-center gap-2 bg-zinc-900 text-white px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-zinc-800",
            children: [/* @__PURE__ */ jsx(Plus, {
              className: "h-4 w-4"
            }), "New Automation"]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex flex-col gap-2",
          children: automations.map((auto) => /* @__PURE__ */ jsxs("div", {
            className: "group border border-zinc-200 rounded-lg px-4 py-3 flex items-center justify-between hover:border-blue-300 transition-colors bg-white",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-4 flex-1 min-w-0",
              children: [/* @__PURE__ */ jsx("div", {
                className: `p-1.5 rounded-full shrink-0 ${auto.isEnabled ? "bg-blue-100 text-blue-600" : "bg-zinc-100 text-zinc-400"}`,
                children: /* @__PURE__ */ jsx(Sparkles, {
                  className: "h-4 w-4"
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-4 flex-1 min-w-0",
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "font-medium text-zinc-900 whitespace-nowrap shrink-0",
                  children: triggerLabels[auto.triggerEvent] || auto.triggerEvent || auto.triggerType
                }), /* @__PURE__ */ jsxs("span", {
                  className: "flex items-center gap-1 bg-zinc-50 px-2 py-0.5 rounded text-xs text-zinc-500 whitespace-nowrap shrink-0 border border-zinc-100",
                  children: [/* @__PURE__ */ jsx(Clock, {
                    className: "w-3 h-3"
                  }), getTimingLabel(auto)]
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-500 truncate min-w-0",
                  children: auto.subject
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-4 shrink-0 ml-4",
              children: [/* @__PURE__ */ jsx("button", {
                onClick: () => toggleAutomation(auto),
                className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${auto.isEnabled ? "bg-blue-600" : "bg-zinc-200"}`,
                children: /* @__PURE__ */ jsx("span", {
                  className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${auto.isEnabled ? "translate-x-6" : "translate-x-1"}`
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => openTestModal(auto.id),
                className: "text-xs text-zinc-500 hover:text-zinc-800 p-2 hover:bg-zinc-100 rounded",
                title: "Send Test",
                children: /* @__PURE__ */ jsx(Send, {
                  className: "h-4 w-4"
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => {
                  setEditingAuto(auto);
                  setEditForm({
                    subject: auto.subject,
                    content: auto.content,
                    isEnabled: auto.isEnabled,
                    timingType: auto.timingType || (auto.delayHours > 0 ? "delay" : "immediate"),
                    timingValue: auto.timingValue || auto.delayHours || 0,
                    triggerEvent: auto.triggerEvent || auto.triggerType,
                    triggerCondition: JSON.stringify(auto.triggerCondition || {}, null, 2),
                    channels: auto.channels || ["email"],
                    couponConfig: auto.couponConfig ? {
                      ...auto.couponConfig,
                      enabled: true
                    } : {
                      enabled: false,
                      type: "percent",
                      value: 20,
                      validityDays: 7
                    }
                  });
                },
                className: "text-xs text-zinc-500 hover:text-blue-600 p-2 hover:bg-blue-50 rounded",
                title: "Edit",
                children: /* @__PURE__ */ jsx(Pencil, {
                  className: "h-4 w-4"
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleDeleteAutomation(auto.id),
                className: "text-xs text-zinc-500 hover:text-red-600 p-2 hover:bg-red-50 rounded",
                title: "Delete",
                children: /* @__PURE__ */ jsx(Trash2, {
                  className: "h-4 w-4"
                })
              })]
            })]
          }, auto.id))
        })]
      })
    }), tab === "settings" && /* @__PURE__ */ jsx("div", {
      className: "max-w-2xl",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3 mb-6",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg",
            children: /* @__PURE__ */ jsx(Settings, {
              className: "h-5 w-5 text-blue-600 dark:text-blue-400"
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h2", {
              className: "font-semibold text-lg text-zinc-900 dark:text-zinc-100",
              children: "Email Settings"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400",
              children: "Configure how your emails appear to students."
            })]
          })]
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleSaveEmailSettings,
          className: "space-y-5",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",
              children: "Reply-To Address"
            }), /* @__PURE__ */ jsx("input", {
              type: "email",
              value: replyTo,
              onChange: (e) => setReplyTo(e.target.value),
              className: "w-full bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",
              placeholder: "hello@yourstudio.com"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
              children: "This is the email address students will reply to."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",
              children: "Email Footer Text"
            }), /* @__PURE__ */ jsx("textarea", {
              value: footerText,
              onChange: (e) => setFooterText(e.target.value),
              className: "w-full min-h-[80px] bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-y",
              placeholder: "e.g. 123 Yoga St, City, ST 12345"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
              children: "Address or legal text to include at the bottom of every email."
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "pt-2",
            children: /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: savingSettings,
              className: `bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-5 py-2.5 rounded-md font-medium text-sm hover:opacity-90 transition-opacity ${savingSettings ? "opacity-70 cursor-not-allowed" : ""}`,
              children: savingSettings ? "Saving..." : "Save Settings"
            })
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: testModal.isOpen,
      onClose: () => setTestModal({
        ...testModal,
        isOpen: false
      }),
      title: "Send Test Email",
      children: /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSendTestSubmit,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "To Email Address"
          }), /* @__PURE__ */ jsx("input", {
            type: "email",
            value: testModal.email,
            onChange: (e) => setTestModal({
              ...testModal,
              email: e.target.value
            }),
            className: "w-full border border-zinc-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",
            placeholder: "you@example.com",
            autoFocus: true,
            required: true
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 mt-1",
            children: "This will send a real email to the address above."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setTestModal({
              ...testModal,
              isOpen: false
            }),
            className: "px-4 py-2 text-sm text-zinc-600 hover:text-zinc-900",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: isSendingTest,
            className: "bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",
            children: isSendingTest ? "Sending..." : "Send Test"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: !!editingAuto,
      onClose: () => setEditingAuto(null),
      title: `Edit Automation`,
      maxWidth: "max-w-2xl",
      children: editingAuto && /* @__PURE__ */ jsxs("form", {
        onSubmit: handleUpdateAutomation,
        className: "flex flex-col h-full",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex-1 overflow-y-auto max-h-[70vh] pr-2 space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between bg-zinc-50 p-3 rounded-lg border border-zinc-200",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium text-zinc-900",
              children: "Automation Status"
            }), /* @__PURE__ */ jsxs("label", {
              className: "relative inline-flex items-center cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                checked: editForm.isEnabled,
                onChange: (e) => setEditForm({
                  ...editForm,
                  isEnabled: e.target.checked
                }),
                className: "sr-only peer"
              }), /* @__PURE__ */ jsx("div", {
                className: "w-11 h-6 bg-zinc-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
              }), /* @__PURE__ */ jsx("span", {
                className: "ml-3 text-sm font-medium text-zinc-700",
                children: editForm.isEnabled ? "Enabled" : "Disabled"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium text-zinc-500 mb-1",
                children: "Trigger Event"
              }), /* @__PURE__ */ jsx("select", {
                value: editForm.triggerEvent,
                onChange: (e) => setEditForm({
                  ...editForm,
                  triggerEvent: e.target.value
                }),
                className: "w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white",
                children: Object.entries(triggerLabels).map(([key, label]) => /* @__PURE__ */ jsx("option", {
                  value: key,
                  children: label
                }, key))
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "space-y-2",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex-1",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-xs font-medium text-zinc-500 mb-1",
                    children: "Timing Rule"
                  }), /* @__PURE__ */ jsxs("select", {
                    value: editForm.timingType,
                    onChange: (e) => setEditForm({
                      ...editForm,
                      timingType: e.target.value
                    }),
                    className: "w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white",
                    children: [/* @__PURE__ */ jsx("option", {
                      value: "immediate",
                      children: "Immediately"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "delay",
                      children: "Delay (Wait)"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "before",
                      children: "Before Event"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "after",
                      children: "After Event"
                    })]
                  })]
                }), editForm.timingType !== "immediate" && /* @__PURE__ */ jsxs("div", {
                  className: "w-20",
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-xs font-medium text-zinc-500 mb-1",
                    children: "Hours"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "number",
                    min: "0",
                    value: editForm.timingValue,
                    onChange: (e) => setEditForm({
                      ...editForm,
                      timingValue: parseInt(e.target.value) || 0
                    }),
                    className: "w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white"
                  })]
                })]
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-medium text-zinc-500 mb-1",
              children: "Trigger Conditions (JSON)"
            }), /* @__PURE__ */ jsx("textarea", {
              value: editForm.triggerCondition,
              onChange: (e) => setEditForm({
                ...editForm,
                triggerCondition: e.target.value
              }),
              className: "w-full border border-zinc-300 rounded px-2 py-1 text-xs font-mono h-12 bg-zinc-50",
              placeholder: '{ "planId": "..." }'
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex flex-col gap-1",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-medium text-zinc-500",
              children: "Channels"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4 items-center",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 text-sm bg-white border border-zinc-200 rounded px-3 py-1.5",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  checked: editForm.channels.includes("email"),
                  onChange: (e) => {
                    const current = editForm.channels;
                    const next = e.target.checked ? [...current, "email"] : current.filter((c) => c !== "email");
                    setEditForm({
                      ...editForm,
                      channels: next
                    });
                  },
                  className: "rounded text-blue-600 focus:ring-blue-500"
                }), "Email"]
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-400",
                children: "SMS Coming Soon"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-zinc-50 p-3 rounded-lg border border-zinc-200",
            children: [/* @__PURE__ */ jsxs("label", {
              className: "flex items-center gap-2 mb-2 cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                checked: editForm.couponConfig.enabled,
                onChange: (e) => setEditForm({
                  ...editForm,
                  couponConfig: {
                    ...editForm.couponConfig,
                    enabled: e.target.checked
                  }
                }),
                className: "w-4 h-4 text-green-600 rounded focus:ring-green-500"
              }), /* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900",
                children: "Include Discount Coupon"
              })]
            }), editForm.couponConfig.enabled && /* @__PURE__ */ jsxs("div", {
              className: "grid grid-cols-3 gap-2 animate-in fade-in slide-in-from-top-1",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-[10px] font-medium text-zinc-500 mb-1",
                  children: "Type"
                }), /* @__PURE__ */ jsxs("select", {
                  value: editForm.couponConfig.type,
                  onChange: (e) => setEditForm({
                    ...editForm,
                    couponConfig: {
                      ...editForm.couponConfig,
                      type: e.target.value
                    }
                  }),
                  className: "w-full border border-zinc-300 rounded px-2 py-1 text-xs",
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "percent",
                    children: "Percent (%)"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "amount",
                    children: "Amount ($)"
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-[10px] font-medium text-zinc-500 mb-1",
                  children: "Value"
                }), /* @__PURE__ */ jsx("input", {
                  type: "number",
                  value: editForm.couponConfig.value,
                  onChange: (e) => setEditForm({
                    ...editForm,
                    couponConfig: {
                      ...editForm.couponConfig,
                      value: parseInt(e.target.value) || 0
                    }
                  }),
                  className: "w-full border border-zinc-300 rounded px-2 py-1 text-xs"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-[10px] font-medium text-zinc-500 mb-1",
                  children: "Validity (Days)"
                }), /* @__PURE__ */ jsx("input", {
                  type: "number",
                  value: editForm.couponConfig.validityDays,
                  onChange: (e) => setEditForm({
                    ...editForm,
                    couponConfig: {
                      ...editForm.couponConfig,
                      validityDays: parseInt(e.target.value) || 7
                    }
                  }),
                  className: "w-full border border-zinc-300 rounded px-2 py-1 text-xs"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-medium text-zinc-500 mb-1",
              children: "Subject Line"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: editForm.subject,
              onChange: (e) => setEditForm({
                ...editForm,
                subject: e.target.value
              }),
              className: "w-full border border-zinc-300 rounded px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-500"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-medium text-zinc-500 mb-1",
              children: "Content"
            }), /* @__PURE__ */ jsx(RichTextEditor, {
              value: editForm.content,
              onChange: (html) => setEditForm({
                ...editForm,
                content: html
              }),
              placeholder: "Write your automation content...",
              className: "min-h-[200px]"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-2 mt-1 text-[10px] text-zinc-500 flex-wrap",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Variables:"
              }), /* @__PURE__ */ jsx("code", {
                className: "bg-zinc-100 px-1 rounded",
                children: "{{firstName}}"
              }), /* @__PURE__ */ jsx("code", {
                className: "bg-zinc-100 px-1 rounded",
                children: "{{lastName}}"
              }), /* @__PURE__ */ jsx("code", {
                className: "bg-zinc-100 px-1 rounded",
                children: "{{email}}"
              }), /* @__PURE__ */ jsx("code", {
                className: "bg-zinc-100 px-1 rounded",
                children: "{{title}}"
              }), /* @__PURE__ */ jsx("code", {
                className: "bg-zinc-100 px-1 rounded",
                children: "{{address}}"
              }), editForm.couponConfig.enabled && /* @__PURE__ */ jsx("code", {
                className: "bg-yellow-100 text-yellow-800 px-1 rounded",
                children: "{{coupon_code}}"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 pt-4 mt-2 border-t border-zinc-100",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setEditingAuto(null),
            className: "px-4 py-2 text-sm text-zinc-600 hover:text-zinc-900 border border-zinc-200 rounded-lg hover:bg-zinc-50",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 shadow-sm",
            children: "Save Changes"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: deleteModal.isOpen,
      onClose: () => setDeleteModal({
        isOpen: false,
        automationId: null
      }),
      title: "Delete Automation",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-zinc-600",
          children: "Are you sure you want to delete this automation? This action cannot be undone."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setDeleteModal({
              isOpen: false,
              automationId: null
            }),
            className: "px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900",
            children: "Cancel"
          }), /* @__PURE__ */ jsxs("button", {
            onClick: confirmDeleteAutomation,
            className: "px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-sm flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Trash2, {
              className: "w-4 h-4"
            }), "Delete Forever"]
          })]
        })]
      })
    })]
  });
});
const route29 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_marketing,
  loader: loader$10
}, Symbol.toStringTag, { value: "Module" }));
const loader$$ = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  const tenantSlug = slug || "";
  try {
    const [automationsData, statsData] = await Promise.all([apiRequest("/marketing/automations", token, {
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    }), apiRequest("/marketing/automations/stats", token, {
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    }).catch(() => null)]);
    return {
      automations: automationsData?.automations || [],
      stats: statsData
    };
  } catch (e) {
    console.error("Automations Loader Error", e);
    return {
      automations: [],
      stats: null
    };
  }
};
const action$g = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  const tenantSlug = slug || "";
  if (intent === "create" || intent === "update") {
    const data = {};
    for (const [key, val] of formData.entries()) {
      if (key === "intent") continue;
      try {
        data[key] = JSON.parse(val);
      } catch (e) {
        data[key] = val;
      }
    }
    if (intent === "update") {
      const id = data.id;
      await apiRequest(`/marketing/automations/${id}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": tenantSlug
        },
        body: JSON.stringify(data)
      });
    } else {
      await apiRequest("/marketing/automations", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenantSlug
        },
        body: JSON.stringify(data)
      });
    }
    return {
      success: true
    };
  }
  if (intent === "toggle") {
    const id = formData.get("id");
    await apiRequest(`/marketing/automations/${id}/toggle`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    });
    return {
      success: true
    };
  }
  if (intent === "delete") {
    const id = formData.get("id");
    await apiRequest(`/marketing/automations/${id}`, token, {
      method: "DELETE",
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    });
    return {
      success: true
    };
  }
  return {
    success: true
  };
};
const TRIGGERS = [
  {
    id: "new_member",
    label: "New Member Signs Up",
    icon: Users
  },
  {
    id: "class_booked",
    label: "Class Booked",
    icon: Calendar
  },
  {
    id: "class_missed",
    label: "Class No-Show",
    icon: Target
  },
  {
    id: "inactive_days",
    label: "Inactive for X Days",
    icon: Clock
  },
  {
    id: "birthday",
    label: "Member Birthday",
    icon: Bell
  },
  {
    id: "membership_expiring",
    label: "Membership Expiring",
    icon: Clock
  },
  // New Events
  {
    id: "product_purchase",
    label: "Product Purchased",
    icon: Zap
  },
  {
    id: "subscription_canceled",
    label: "Subscription Canceled (Period End)",
    icon: X
  },
  {
    id: "subscription_terminated",
    label: "Subscription Terminated",
    icon: Trash2
  },
  {
    id: "student_updated",
    label: "Student Profile Updated",
    icon: Users
  }
];
const studio_$slug_marketing_automations = UNSAFE_withComponentProps(function AutomatedCampaigns() {
  const {
    automations,
    stats
  } = useLoaderData();
  const submit = useSubmit();
  const [isCreating, setIsCreating] = useState(false);
  const [automationToDelete, setAutomationToDelete] = useState(null);
  const [editingAutomation, setEditingAutomation] = useState(null);
  const handleToggle = (id) => {
    submit({
      intent: "toggle",
      id
    }, {
      method: "post"
    });
  };
  const handleDelete = (id) => {
    setAutomationToDelete(id);
  };
  const handleConfirmDelete = () => {
    if (automationToDelete) {
      submit({
        intent: "delete",
        id: automationToDelete
      }, {
        method: "post"
      });
      setAutomationToDelete(null);
    }
  };
  const openCreate = () => {
    setEditingAutomation(null);
    setIsCreating(true);
  };
  const openEdit = (auto) => {
    setEditingAutomation(auto);
    setIsCreating(true);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsx("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg text-white",
            children: /* @__PURE__ */ jsx(Zap, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-xl font-bold text-zinc-900",
              children: "Automations"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500",
              children: "Set up automated email & SMS campaigns"
            })]
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: openCreate,
          className: "px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 16
          }), " Create Automation"]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 overflow-y-auto p-6",
      children: [stats && /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-4 gap-4 mb-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 p-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-zinc-900",
            children: stats.totalAutomations || 0
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Total Automations"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 p-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-green-600",
            children: stats.activeCount || 0
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Active"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 p-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-blue-600",
            children: stats.emailsSent || 0
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Emails Sent (30d)"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 p-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-purple-600",
            children: stats.smsSent || 0
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "SMS Sent (30d)"
          })]
        })]
      }), automations.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "text-center py-20 bg-white rounded-xl border border-zinc-200",
        children: [/* @__PURE__ */ jsx(Zap, {
          size: 48,
          className: "mx-auto mb-4 text-zinc-300"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mb-4",
          children: "No automations yet"
        }), /* @__PURE__ */ jsx("button", {
          onClick: openCreate,
          className: "text-sm text-zinc-900 underline",
          children: "Create your first"
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: automations.map((auto) => {
          const trigger = TRIGGERS.find((t) => t.id === auto.triggerEvent || t.id === auto.trigger);
          const TriggerIcon = trigger?.icon || Zap;
          return /* @__PURE__ */ jsx("div", {
            className: `bg-white rounded-xl border ${auto.isActive ? "border-green-200" : "border-zinc-200"} p-5`,
            children: /* @__PURE__ */ jsxs("div", {
              className: "flex items-start justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-start gap-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: `p-3 rounded-xl ${auto.isActive ? "bg-green-100" : "bg-zinc-100"}`,
                  children: /* @__PURE__ */ jsx(TriggerIcon, {
                    size: 24,
                    className: auto.isActive ? "text-green-600" : "text-zinc-400"
                  })
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex items-center gap-2",
                    children: [/* @__PURE__ */ jsx("h3", {
                      className: "font-bold text-zinc-900",
                      children: auto.name || auto.subject
                    }), /* @__PURE__ */ jsx("span", {
                      className: `px-2 py-0.5 rounded-full text-xs font-medium ${auto.isActive ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
                      children: auto.isActive ? "Active" : "Paused"
                    })]
                  }), /* @__PURE__ */ jsxs("p", {
                    className: "text-sm text-zinc-500 mt-1",
                    children: ["Trigger: ", trigger?.label || auto.triggerEvent]
                  }), auto.timingType !== "immediate" && /* @__PURE__ */ jsxs("p", {
                    className: "text-xs text-zinc-400 mt-1",
                    children: ["Timing: ", auto.timingType === "delay" ? `Delay ${auto.timingValue}h` : `Before ${auto.timingValue}h`]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "flex items-center gap-4 mt-2 text-xs text-zinc-400",
                    children: /* @__PURE__ */ jsxs("span", {
                      children: ["Runs: ", auto.runCount || 0]
                    })
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => openEdit(auto),
                  className: "p-2 hover:bg-zinc-100 rounded-lg text-zinc-500",
                  title: "Edit",
                  children: /* @__PURE__ */ jsx(Pencil, {
                    size: 16
                  })
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => handleToggle(auto.id),
                  className: `p-2 rounded-lg ${auto.isActive ? "hover:bg-yellow-50 text-yellow-600" : "hover:bg-green-50 text-green-600"}`,
                  title: auto.isActive ? "Pause" : "Activate",
                  children: auto.isActive ? /* @__PURE__ */ jsx(Pause, {
                    size: 16
                  }) : /* @__PURE__ */ jsx(Play, {
                    size: 16
                  })
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => handleDelete(auto.id),
                  className: "p-2 hover:bg-red-50 rounded-lg text-red-500",
                  children: /* @__PURE__ */ jsx(Trash2, {
                    size: 16
                  })
                })]
              })]
            })
          }, auto.id);
        })
      })]
    }), isCreating && /* @__PURE__ */ jsx(CreateAutomationModal, {
      initialData: editingAutomation,
      onClose: () => setIsCreating(false),
      onSave: (data) => {
        const formData = new FormData();
        formData.append("intent", editingAutomation ? "update" : "create");
        if (editingAutomation) formData.append("id", editingAutomation.id);
        for (const key of Object.keys(data)) {
          if (typeof data[key] === "object") {
            formData.append(key, JSON.stringify(data[key]));
          } else {
            formData.append(key, data[key]);
          }
        }
        submit(formData, {
          method: "post"
        });
        setIsCreating(false);
      }
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!automationToDelete,
      onOpenChange: (open) => !open && setAutomationToDelete(null),
      onConfirm: handleConfirmDelete,
      title: "Delete Automation",
      description: "Are you sure you want to delete this automation? This action cannot be undone.",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
});
const TIMING_TYPES = [{
  id: "immediate",
  label: "Immediately"
}, {
  id: "delay",
  label: "Delay (Hours)"
}, {
  id: "before",
  label: "Before Event (Hours)"
}];
function CreateAutomationModal({
  onClose,
  onSave,
  initialData
}) {
  const [step, setStep] = useState(1);
  const [name, setName] = useState("");
  const [trigger, setTrigger] = useState("new_student");
  const [timingType, setTimingType] = useState("immediate");
  const [timingValue, setTimingValue] = useState("0");
  const [audienceType, setAudienceType] = useState("all");
  const [ageMin, setAgeMin] = useState("");
  const [ageMax, setAgeMax] = useState("");
  const [addCoupon, setAddCoupon] = useState(false);
  const [couponType, setCouponType] = useState("percent");
  const [couponValue, setCouponValue] = useState("10");
  const [couponValidity, setCouponValidity] = useState("7");
  const [contentType, setContentType] = useState("simple");
  const [subject, setSubject] = useState("");
  const [content, setContent] = useState("");
  const [templateId, setTemplateId] = useState("");
  const [aiGenerating, setAiGenerating] = useState(false);
  const handleAiGenerate = async () => {
    setAiGenerating(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      const slug = window.location.pathname.split("/")[2];
      const response = await fetch(`${"https://studio-platform-api.slichti.workers.dev"}/marketing/automations/ai/generate`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          trigger
        })
      });
      const data = await response.json();
      if (data.success && data.subject && data.content) {
        setSubject(data.subject);
        setContent(data.content);
        setContentType("simple");
      } else {
        toast.error(data.error || "AI generation failed");
      }
    } catch (e) {
      console.error(e);
      toast.error("AI generation failed");
    } finally {
      setAiGenerating(false);
    }
  };
  useEffect(() => {
    if (initialData) {
      setName(initialData.name || initialData.subject || "");
      setTrigger(initialData.triggerEvent || "new_student");
      setTimingType(initialData.timingType || "immediate");
      setTimingValue(String(initialData.timingValue || 0));
      if (initialData.audienceFilter) {
        setAudienceType("filter");
        setAgeMin(initialData.audienceFilter.ageMin ? String(initialData.audienceFilter.ageMin) : "");
        setAgeMax(initialData.audienceFilter.ageMax ? String(initialData.audienceFilter.ageMax) : "");
      }
      if (initialData.couponConfig) {
        setAddCoupon(true);
        setCouponType(initialData.couponConfig.type || "percent");
        setCouponValue(String(initialData.couponConfig.value || 10));
        setCouponValidity(String(initialData.couponConfig.validityDays || 7));
      }
      if (initialData.templateId) {
        setContentType("template");
        setTemplateId(initialData.templateId);
        setSubject(initialData.subject || "");
      } else {
        setContentType("simple");
        setSubject(initialData.subject || "");
        setContent(initialData.content || "");
      }
    }
  }, [initialData]);
  const handleSubmit = () => {
    const payload = {
      name,
      trigger,
      triggerConfig: {},
      // Default
      actions: [],
      // Legacy/Unused
      isActive: true,
      timingType,
      timingValue: parseInt(timingValue) || 0
    };
    if (audienceType === "filter") {
      payload.audienceFilter = {};
      if (ageMin) payload.audienceFilter.ageMin = parseInt(ageMin);
      if (ageMax) payload.audienceFilter.ageMax = parseInt(ageMax);
    }
    if (addCoupon) {
      payload.couponConfig = {
        type: couponType,
        value: parseInt(couponValue),
        validityDays: parseInt(couponValidity)
      };
    }
    if (contentType === "template") {
      payload.templateId = templateId;
      payload.subject = subject || "Notification";
      payload.content = "Template: " + templateId;
    } else {
      payload.subject = subject;
      payload.content = content;
    }
    onSave(payload);
  };
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: initialData ? "Edit Automation" : "Create Automation"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "flex gap-2 mb-6",
          children: [1, 2, 3, 4].map((s) => /* @__PURE__ */ jsx("div", {
            className: `h-1 flex-1 rounded-full ${s <= step ? "bg-purple-600" : "bg-zinc-100"}`
          }, s))
        }), step === 1 && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Automation Name"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: name,
              onChange: (e) => setName(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
              placeholder: "e.g., Welcome Series"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-2",
              children: "Trigger"
            }), /* @__PURE__ */ jsx("div", {
              className: "grid grid-cols-2 gap-2 h-48 overflow-y-auto pr-1",
              children: TRIGGERS.map((t) => /* @__PURE__ */ jsxs("button", {
                onClick: () => setTrigger(t.id),
                className: `p-3 rounded-lg border text-left flex items-center gap-2 ${trigger === t.id ? "border-purple-500 bg-purple-50" : "border-zinc-200 hover:bg-zinc-50"}`,
                children: [/* @__PURE__ */ jsx(t.icon, {
                  size: 16,
                  className: trigger === t.id ? "text-purple-600" : "text-zinc-400"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm",
                  children: t.label
                })]
              }, t.id))
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-2",
              children: "Timing"
            }), /* @__PURE__ */ jsx("div", {
              className: "flex bg-zinc-100 p-1 rounded-lg mb-2",
              children: TIMING_TYPES.map((t) => /* @__PURE__ */ jsx("button", {
                onClick: () => setTimingType(t.id),
                className: `flex-1 py-1.5 text-xs font-medium rounded-md ${timingType === t.id ? "bg-white shadow text-zinc-900" : "text-zinc-500 hover:text-zinc-700"}`,
                children: t.label
              }, t.id))
            }), timingType !== "immediate" && /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx("input", {
                type: "number",
                value: timingValue,
                onChange: (e) => setTimingValue(e.target.value),
                className: "w-24 px-3 py-2 border border-zinc-200 rounded-lg"
              }), /* @__PURE__ */ jsx("span", {
                className: "text-sm text-zinc-500",
                children: "hours"
              })]
            })]
          })]
        }), step === 2 && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-medium text-zinc-900",
            children: "Audience Targeting"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-4",
            children: [/* @__PURE__ */ jsxs("label", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx("input", {
                type: "radio",
                name: "aud",
                checked: audienceType === "all",
                onChange: () => setAudienceType("all")
              }), /* @__PURE__ */ jsx("span", {
                children: "All Members"
              })]
            }), /* @__PURE__ */ jsxs("label", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx("input", {
                type: "radio",
                name: "aud",
                checked: audienceType === "filter",
                onChange: () => setAudienceType("filter")
              }), /* @__PURE__ */ jsx("span", {
                children: "Filtered"
              })]
            })]
          }), audienceType === "filter" && /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4 p-4 bg-zinc-50 rounded-lg",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium text-zinc-500 mb-1",
                children: "Min Age"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                value: ageMin,
                onChange: (e) => setAgeMin(e.target.value),
                className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
                placeholder: "18"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium text-zinc-500 mb-1",
                children: "Max Age"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                value: ageMax,
                onChange: (e) => setAgeMax(e.target.value),
                className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
                placeholder: "65"
              })]
            })]
          })]
        }), step === 3 && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-medium text-zinc-900",
            children: "Sweeteners"
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-4 border border-zinc-200 rounded-lg",
            children: [/* @__PURE__ */ jsxs("label", {
              className: "flex items-center justify-between cursor-pointer",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("div", {
                  className: `w-5 h-5 rounded border flex items-center justify-center ${addCoupon ? "bg-purple-600 border-purple-600" : "border-zinc-300"}`,
                  children: addCoupon && /* @__PURE__ */ jsx(CheckIcon, {
                    size: 12,
                    className: "text-white"
                  })
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("span", {
                    className: "font-medium text-sm",
                    children: "Generate Unique Coupon"
                  }), /* @__PURE__ */ jsx("p", {
                    className: "text-xs text-zinc-500",
                    children: "Include a single-use code in the email."
                  })]
                })]
              }), /* @__PURE__ */ jsx("input", {
                type: "checkbox",
                checked: addCoupon,
                onChange: (e) => setAddCoupon(e.target.checked),
                className: "hidden"
              })]
            }), addCoupon && /* @__PURE__ */ jsxs("div", {
              className: "mt-4 pt-4 border-t border-zinc-100 grid grid-cols-2 gap-4",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "col-span-2 flex bg-zinc-100 p-1 rounded-lg",
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => setCouponType("percent"),
                  className: `flex-1 py-1 text-xs font-medium rounded-md ${couponType === "percent" ? "bg-white shadow" : "text-zinc-500"}`,
                  children: "Percentage Off"
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => setCouponType("amount"),
                  className: `flex-1 py-1 text-xs font-medium rounded-md ${couponType === "amount" ? "bg-white shadow" : "text-zinc-500"}`,
                  children: "Flat Amount"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-xs font-medium text-zinc-500 mb-1",
                  children: "Value"
                }), /* @__PURE__ */ jsxs("div", {
                  className: "relative",
                  children: [/* @__PURE__ */ jsx("input", {
                    type: "number",
                    value: couponValue,
                    onChange: (e) => setCouponValue(e.target.value),
                    className: "w-full pl-8 pr-3 py-2 border border-zinc-200 rounded-lg"
                  }), /* @__PURE__ */ jsx("span", {
                    className: "absolute left-3 top-2 text-zinc-400 text-sm",
                    children: couponType === "percent" ? "%" : "$"
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-xs font-medium text-zinc-500 mb-1",
                  children: "Expires In (Days)"
                }), /* @__PURE__ */ jsx("input", {
                  type: "number",
                  value: couponValidity,
                  onChange: (e) => setCouponValidity(e.target.value),
                  className: "w-full px-3 py-2 border border-zinc-200 rounded-lg"
                })]
              })]
            })]
          })]
        }), step === 4 && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-medium text-zinc-900",
              children: "Email Content"
            }), /* @__PURE__ */ jsxs("button", {
              onClick: handleAiGenerate,
              disabled: aiGenerating,
              className: "flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg text-xs font-medium hover:opacity-90 disabled:opacity-50 shadow-sm",
              children: [aiGenerating ? /* @__PURE__ */ jsx(Loader2, {
                size: 14,
                className: "animate-spin"
              }) : /* @__PURE__ */ jsx(Sparkles, {
                size: 14
              }), aiGenerating ? "Generating..." : "Generate with AI"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Subject Line"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: subject,
              onChange: (e) => setSubject(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
              placeholder: "Welcome!"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-4 border-b border-zinc-100 pb-2",
            children: [/* @__PURE__ */ jsx("button", {
              onClick: () => setContentType("simple"),
              className: `pb-2 text-sm font-medium ${contentType === "simple" ? "text-purple-600 border-b-2 border-purple-600" : "text-zinc-500"}`,
              children: "Simple Text"
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => setContentType("template"),
              className: `pb-2 text-sm font-medium ${contentType === "template" ? "text-purple-600 border-b-2 border-purple-600" : "text-zinc-500"}`,
              children: "Resend Template"
            })]
          }), contentType === "simple" ? /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Message Body"
            }), /* @__PURE__ */ jsx("textarea", {
              value: content,
              onChange: (e) => setContent(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg h-32",
              placeholder: "Start typing... Use {{firstName}} for variables."
            })]
          }) : /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Template ID"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: templateId,
              onChange: (e) => setTemplateId(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
              placeholder: "re_123456789"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-xs text-zinc-500 mt-1",
              children: ["Variables sent: generic data + ", /* @__PURE__ */ jsx("code", {
                children: "title"
              }), ", ", /* @__PURE__ */ jsx("code", {
                children: "address"
              }), ", ", /* @__PURE__ */ jsx("code", {
                children: "firstName"
              }), ", ", /* @__PURE__ */ jsx("code", {
                children: "couponCode"
              }), "."]
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-200 flex justify-between",
        children: [step > 1 && /* @__PURE__ */ jsx("button", {
          onClick: () => setStep(step - 1),
          className: "px-4 py-2 text-sm text-zinc-500",
          children: "Back"
        }), step < 4 ? /* @__PURE__ */ jsx("button", {
          onClick: () => setStep(step + 1),
          disabled: !name && step === 1,
          className: "ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",
          children: "Next"
        }) : /* @__PURE__ */ jsx("button", {
          onClick: handleSubmit,
          disabled: contentType === "simple" ? !content : !templateId,
          className: "ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",
          children: initialData ? "Save Changes" : "Create Automation"
        })]
      })]
    })
  });
}
function CheckIcon({
  size,
  className
}) {
  return /* @__PURE__ */ jsx("svg", {
    width: size || 24,
    height: size || 24,
    viewBox: "0 0 24 24",
    fill: "none",
    stroke: "currentColor",
    strokeWidth: "3",
    strokeLinecap: "round",
    strokeLinejoin: "round",
    className,
    children: /* @__PURE__ */ jsx("polyline", {
      points: "20 6 9 17 4 12"
    })
  });
}
const route30 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$g,
  default: studio_$slug_marketing_automations,
  loader: loader$$
}, Symbol.toStringTag, { value: "Module" }));
const loader$_ = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const [myCode, referralsData, statsData] = await Promise.all([apiRequest("/referrals/my-code", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/referrals", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest("/referrals/stats", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).catch(() => null)]);
    return {
      myCode: myCode?.code || "",
      referrals: referralsData || [],
      stats: statsData,
      slug
    };
  } catch (e) {
    console.error("Referrals Loader Error", e);
    return {
      myCode: "",
      referrals: [],
      stats: null,
      slug
    };
  }
};
const action$f = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "reward") {
    const id = formData.get("id");
    await apiRequest(`/referrals/${id}/reward`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        rewardType: formData.get("rewardType"),
        rewardValue: parseInt(formData.get("rewardValue") || "0")
      })
    });
  }
  return {
    success: true
  };
};
const studio_$slug_marketing_referrals = UNSAFE_withComponentProps(function ReferralProgram() {
  const {
    myCode,
    referrals,
    stats,
    slug
  } = useLoaderData();
  useSubmit();
  const [copied, setCopied] = useState(false);
  const referralLink = `${typeof window !== "undefined" ? window.location.origin : ""}/studio/${slug}/join?ref=${myCode}`;
  const copyToClipboard = async () => {
    await navigator.clipboard.writeText(referralLink);
    setCopied(true);
    setTimeout(() => setCopied(false), 2e3);
  };
  const shareLink = async () => {
    if (navigator.share) {
      await navigator.share({
        title: "Join me at the studio!",
        text: "Use my referral code to get started",
        url: referralLink
      });
    } else {
      copyToClipboard();
    }
  };
  const formatDate2 = (ts) => new Date(ts * 1e3).toLocaleDateString();
  const statusColors = {
    pending: "bg-yellow-100 text-yellow-700",
    completed: "bg-blue-100 text-blue-700",
    rewarded: "bg-green-100 text-green-700",
    expired: "bg-zinc-100 text-zinc-500"
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsx("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-2 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg text-white",
          children: /* @__PURE__ */ jsx(Gift, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-xl font-bold text-zinc-900",
            children: "Referral Program"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500",
            children: "Invite friends and earn rewards"
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 overflow-y-auto p-6 space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl p-6 text-white",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 mb-4",
          children: [/* @__PURE__ */ jsx(Sparkles, {
            size: 20
          }), /* @__PURE__ */ jsx("span", {
            className: "font-medium",
            children: "Your Referral Code"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white/20 backdrop-blur-sm rounded-lg p-4 flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsx("span", {
            className: "text-2xl font-mono font-bold tracking-wider",
            children: myCode
          }), /* @__PURE__ */ jsx("button", {
            onClick: copyToClipboard,
            className: "p-2 bg-white/20 rounded-lg hover:bg-white/30 transition",
            children: copied ? /* @__PURE__ */ jsx(Check, {
              size: 20
            }) : /* @__PURE__ */ jsx(Copy, {
              size: 20
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-3",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: copyToClipboard,
            className: "flex-1 py-2.5 bg-white text-purple-600 rounded-lg font-medium hover:bg-purple-50 flex items-center justify-center gap-2",
            children: [/* @__PURE__ */ jsx(Copy, {
              size: 16
            }), " Copy Link"]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: shareLink,
            className: "flex-1 py-2.5 bg-white/20 rounded-lg font-medium hover:bg-white/30 flex items-center justify-center gap-2",
            children: [/* @__PURE__ */ jsx(Share2, {
              size: 16
            }), " Share"]
          })]
        })]
      }), stats && /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-4 gap-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg p-4 border border-zinc-200",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-zinc-900",
            children: stats.total
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Total Referrals"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg p-4 border border-zinc-200",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-yellow-600",
            children: stats.pending
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Pending"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg p-4 border border-zinc-200",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-blue-600",
            children: stats.completed
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Completed"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg p-4 border border-zinc-200",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-green-600",
            children: stats.rewarded
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500",
            children: "Rewarded"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-4 border-b border-zinc-100",
          children: /* @__PURE__ */ jsxs("h2", {
            className: "font-bold text-zinc-900 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Users, {
              size: 18
            }), " Your Referrals"]
          })
        }), referrals.length === 0 ? /* @__PURE__ */ jsxs("div", {
          className: "p-8 text-center text-zinc-500",
          children: [/* @__PURE__ */ jsx(Gift, {
            size: 32,
            className: "mx-auto mb-2 opacity-50"
          }), /* @__PURE__ */ jsx("p", {
            children: "No referrals yet. Share your code to get started!"
          })]
        }) : /* @__PURE__ */ jsx("div", {
          className: "divide-y divide-zinc-100",
          children: referrals.map((ref) => /* @__PURE__ */ jsxs("div", {
            className: "p-4 flex items-center justify-between",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-10 h-10 bg-zinc-100 rounded-full flex items-center justify-center",
                children: /* @__PURE__ */ jsx(Users, {
                  size: 18,
                  className: "text-zinc-500"
                })
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-zinc-900",
                  children: ref.referrer?.user?.profile?.firstName || ref.referrer?.user?.email || "Member"
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 flex items-center gap-2",
                  children: [/* @__PURE__ */ jsx(Clock, {
                    size: 12
                  }), " ", formatDate2(ref.createdAt)]
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-3",
              children: [/* @__PURE__ */ jsx("span", {
                className: `px-2 py-1 rounded text-xs font-medium ${statusColors[ref.status]}`,
                children: ref.status
              }), ref.status === "completed" && stats && /* @__PURE__ */ jsxs(Form, {
                method: "post",
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "intent",
                  value: "reward"
                }), /* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "id",
                  value: ref.id
                }), /* @__PURE__ */ jsxs("select", {
                  name: "rewardType",
                  className: "text-xs border rounded px-2 py-1",
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "credit",
                    children: "Credit"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "discount",
                    children: "Discount"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "free_class",
                    children: "Free Class"
                  })]
                }), /* @__PURE__ */ jsx("input", {
                  type: "number",
                  name: "rewardValue",
                  defaultValue: "500",
                  className: "w-16 text-xs border rounded px-2 py-1"
                }), /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  className: "p-1 bg-green-100 text-green-700 rounded hover:bg-green-200",
                  children: /* @__PURE__ */ jsx(Award, {
                    size: 14
                  })
                })]
              })]
            })]
          }, ref.id))
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 p-6",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "font-bold text-zinc-900 mb-4",
          children: "How It Works"
        }), /* @__PURE__ */ jsx("div", {
          className: "space-y-4",
          children: [{
            icon: Share2,
            title: "Share Your Code",
            desc: "Send your unique referral code to friends"
          }, {
            icon: Users,
            title: "Friend Signs Up",
            desc: "They join using your referral link"
          }, {
            icon: Award,
            title: "Both Get Rewarded",
            desc: "You and your friend receive special perks"
          }].map((step, i) => /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600",
              children: /* @__PURE__ */ jsx(step.icon, {
                size: 18
              })
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900",
                children: step.title
              }), /* @__PURE__ */ jsx("div", {
                className: "text-sm text-zinc-500",
                children: step.desc
              })]
            }), i < 2 && /* @__PURE__ */ jsx(ChevronRight, {
              size: 16,
              className: "text-zinc-300"
            })]
          }, i))
        })]
      })]
    })]
  });
});
const route31 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$f,
  default: studio_$slug_marketing_referrals,
  loader: loader$_
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_branding = UNSAFE_withComponentProps(function StudioBranding() {
  const {
    tenant
  } = useOutletContext();
  const revalidator = useRevalidator();
  const [primaryColor, setPrimaryColor] = useState(tenant.branding?.primaryColor || "#4f46e5");
  const [hidePoweredBy, setHidePoweredBy] = useState(tenant.branding?.hidePoweredBy || false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const isScaleTier = tenant.tier?.toLowerCase() === "scale";
  const handleSave = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    setSuccess(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/tenant/settings`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          branding: {
            primaryColor,
            hidePoweredBy
          }
        })
      });
      setSuccess("Branding saved successfully.");
      revalidator.revalidate();
    } catch (e2) {
      setError(e2.message || "Failed to save branding.");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-10",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",
        children: "Customize Branding"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Manage your studio's look and feel."
      }), /* @__PURE__ */ jsxs("p", {
        className: "text-xs text-zinc-400 mt-1",
        children: ["Current tier: ", /* @__PURE__ */ jsx("strong", {
          className: "font-mono",
          children: tenant.tier || "unknown"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
      children: [error && /* @__PURE__ */ jsx("div", {
        className: "bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded mb-4 text-sm",
        children: error
      }), success && /* @__PURE__ */ jsx("div", {
        className: "bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 p-3 rounded mb-4 text-sm",
        children: success
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSave,
        className: "flex flex-col gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",
            children: "Primary Brand Color"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-3",
            children: [/* @__PURE__ */ jsx("input", {
              type: "color",
              value: /^#[0-9A-F]{6}$/i.test(primaryColor) ? primaryColor : "#000000",
              onChange: (e) => setPrimaryColor(e.target.value),
              className: "w-10 h-10 p-0 border-none rounded cursor-pointer bg-transparent"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: primaryColor,
              onChange: (e) => setPrimaryColor(e.target.value),
              className: "flex-1 bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-blue-500 outline-none"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "border-t border-zinc-200 dark:border-zinc-800 pt-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-base font-semibold text-zinc-900 dark:text-zinc-100 mb-4",
            children: "Platform Branding"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-start gap-3",
            children: [/* @__PURE__ */ jsx("div", {
              className: "flex items-center h-5",
              children: /* @__PURE__ */ jsx("input", {
                id: "hidePoweredBy",
                type: "checkbox",
                checked: hidePoweredBy,
                onChange: (e) => setHidePoweredBy(e.target.checked),
                disabled: !isScaleTier,
                className: "h-4 w-4 rounded border-zinc-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
              })
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-sm",
              children: [/* @__PURE__ */ jsx("label", {
                htmlFor: "hidePoweredBy",
                className: `font-medium ${!isScaleTier ? "text-zinc-400 dark:text-zinc-500" : "text-zinc-900 dark:text-zinc-100"}`,
                children: 'Hide "Powered by StudioPlatform" badge'
              }), /* @__PURE__ */ jsxs("p", {
                className: "text-zinc-500 dark:text-zinc-400",
                children: ["Remove the branding badge from your site footer.", !isScaleTier && /* @__PURE__ */ jsx("span", {
                  className: "text-pink-600 dark:text-pink-400 ml-1 font-medium",
                  children: "Requires Scale tier."
                })]
              })]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-2",
          children: /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: `bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-5 py-2.5 rounded-md font-medium text-sm hover:opacity-90 transition-opacity ${loading ? "opacity-70 cursor-not-allowed" : ""}`,
            children: loading ? "Saving..." : "Save Changes"
          })
        })]
      })]
    })]
  });
});
const route32 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_branding
}, Symbol.toStringTag, { value: "Module" }));
function GiftCardInput({ token, slug, onApply, onRemove }) {
  const [code, setCode] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [appliedCard, setAppliedCard] = useState(null);
  const handleValidate = async () => {
    if (!code) return;
    setLoading(true);
    setError(null);
    try {
      const res = await apiRequest(`/gift-cards/validate/${code}`, token, {
        headers: { "X-Tenant-Slug": slug }
      });
      if (res.error) {
        setError(res.error);
      } else {
        setAppliedCard(res);
        onApply(res);
      }
    } catch (e) {
      setError("Invalid or expired gift card code.");
    } finally {
      setLoading(false);
    }
  };
  const handleRemove = () => {
    setAppliedCard(null);
    setCode("");
    onRemove();
  };
  if (appliedCard) {
    return /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800 rounded-xl animate-in zoom-in-95", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3 text-emerald-700 dark:text-emerald-400", children: [
        /* @__PURE__ */ jsx(CheckCircle2, { size: 18 }),
        /* @__PURE__ */ jsxs("div", { className: "flex flex-col", children: [
          /* @__PURE__ */ jsx("span", { className: "text-sm font-bold", children: appliedCard.code }),
          /* @__PURE__ */ jsxs("span", { className: "text-[10px] uppercase font-bold tracking-tighter opacity-70", children: [
            "Applied: $",
            (appliedCard.balance / 100).toFixed(2),
            " Credit"
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsx("button", { onClick: handleRemove, className: "p-1 hover:bg-emerald-100 dark:hover:bg-emerald-800 rounded text-emerald-600", children: /* @__PURE__ */ jsx(XCircle, { size: 18 }) })
    ] });
  }
  return /* @__PURE__ */ jsxs("div", { className: "space-y-2", children: [
    /* @__PURE__ */ jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsx(Ticket, { className: "absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400" }),
      /* @__PURE__ */ jsx(
        "input",
        {
          type: "text",
          placeholder: "Wanna use a Gift Card?",
          value: code,
          onChange: (e) => setCode(e.target.value.toUpperCase()),
          className: "w-full pl-10 pr-24 py-3 bg-zinc-100 dark:bg-zinc-800 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none uppercase font-mono tracking-wider"
        }
      ),
      /* @__PURE__ */ jsx(
        "button",
        {
          onClick: handleValidate,
          disabled: loading || !code,
          className: "absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white text-xs font-bold rounded-xl disabled:opacity-50",
          children: loading ? /* @__PURE__ */ jsx(Loader2, { size: 14, className: "animate-spin" }) : "APPLY"
        }
      )
    ] }),
    error && /* @__PURE__ */ jsxs("p", { className: "text-[10px] text-red-500 font-bold uppercase tracking-tight ml-4 flex items-center gap-1", children: [
      /* @__PURE__ */ jsx(XCircle, { size: 10 }),
      " ",
      error
    ] })
  ] });
}
const stripePromise = loadStripe(void 0);
const loader$Z = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const url = new URL(args.request.url);
  const packId = url.searchParams.get("packId");
  const planId = url.searchParams.get("planId");
  const giftCardAmount = url.searchParams.get("giftCardAmount");
  const recipientEmail = url.searchParams.get("recipientEmail");
  const recipientName = url.searchParams.get("recipientName");
  const senderName = url.searchParams.get("senderName");
  const message = url.searchParams.get("message");
  return {
    token,
    packId,
    planId,
    giftCardAmount,
    recipientEmail,
    recipientName,
    senderName,
    message,
    slug: args.params.slug
  };
};
const studio_$slug_checkout = UNSAFE_withComponentProps(function CheckoutPage() {
  const {
    token,
    packId,
    planId,
    giftCardAmount,
    recipientEmail,
    recipientName,
    senderName,
    message,
    slug
  } = useLoaderData();
  const [clientSecret, setClientSecret] = useState(null);
  const [error, setError] = useState(null);
  const navigate = useNavigate();
  const [couponCode, setCouponCode] = useState("");
  const [appliedCoupon, setAppliedCoupon] = useState(null);
  const [loadingSession, setLoadingSession] = useState(false);
  const [step, setStep] = useState("summary");
  const [packDetails, setPackDetails] = useState(null);
  useEffect(() => {
    if (!packId && !giftCardAmount && !planId || !token) return;
    const pending = sessionStorage.getItem("pending_coupon");
    if (pending) {
      setCouponCode(pending);
      createSession(pending);
    } else {
      createSession();
    }
  }, [packId, giftCardAmount, planId, token, slug]);
  const createSession = (code, giftCode) => {
    setLoadingSession(true);
    const payload = {
      packId,
      planId,
      couponCode: code,
      giftCardAmount,
      recipientEmail,
      recipientName,
      senderName,
      message
    };
    if (giftCode) payload.giftCardCode = giftCode;
    apiRequest(`/commerce/checkout/session`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify(payload)
    }).then((res) => {
      if (res.error) {
        setError(res.error);
      } else if (res.complete && res.returnUrl) {
        window.location.href = res.returnUrl;
      } else {
        setClientSecret(res.clientSecret);
        setError(null);
      }
    }).catch((err) => {
      setError(err.message || "Failed to initialize checkout.");
    }).finally(() => setLoadingSession(false));
  };
  const applyCoupon = async () => {
    if (!couponCode) return;
    createSession(couponCode);
  };
  if (error) {
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-md mx-auto py-12 text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "bg-red-50 text-red-800 p-4 rounded-lg mb-4",
        children: error
      }), /* @__PURE__ */ jsx("button", {
        onClick: () => navigate(-1),
        className: "text-blue-600 hover:underline",
        children: "Go Back"
      })]
    });
  }
  if (!clientSecret) {
    return /* @__PURE__ */ jsx("div", {
      className: "flex justify-center items-center min-h-[400px]",
      children: /* @__PURE__ */ jsx("div", {
        className: "animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-3xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsxs("button", {
      onClick: () => navigate(-1),
      className: "flex items-center text-sm text-zinc-500 hover:text-zinc-900 mb-6",
      children: [/* @__PURE__ */ jsx(ArrowLeft, {
        className: "h-4 w-4 mr-1"
      }), "Back"]
    }), /* @__PURE__ */ jsx("div", {
      className: "mb-6 space-y-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm space-y-4",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-xs font-bold text-zinc-400 uppercase tracking-widest pl-1",
          children: "Apply Promotion"
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsx("input", {
            type: "text",
            placeholder: "Promo Code",
            className: "flex-1 border-none bg-zinc-100 rounded-xl px-4 py-3 text-sm uppercase font-mono outline-none focus:ring-2 focus:ring-blue-500",
            value: couponCode,
            onChange: (e) => setCouponCode(e.target.value.toUpperCase())
          }), /* @__PURE__ */ jsx("button", {
            onClick: applyCoupon,
            disabled: loadingSession || !couponCode,
            className: "bg-zinc-900 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-zinc-800 disabled:opacity-50 transition-all",
            children: "Apply"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-2 border-t border-zinc-50",
          children: /* @__PURE__ */ jsx(GiftCardInput, {
            token,
            slug,
            onApply: (card) => createSession(couponCode, card.code),
            onRemove: () => createSession(couponCode)
          })
        })]
      })
    }), /* @__PURE__ */ jsx("div", {
      id: "checkout",
      className: "bg-white p-6 rounded-lg shadow-sm border border-zinc-200",
      children: /* @__PURE__ */ jsx(EmbeddedCheckoutProvider, {
        stripe: stripePromise,
        options: {
          clientSecret
        },
        children: /* @__PURE__ */ jsx(EmbeddedCheckout, {})
      })
    })]
  });
});
const route33 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_checkout,
  loader: loader$Z
}, Symbol.toStringTag, { value: "Module" }));
const loader$Y = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const url = new URL(args.request.url);
  const sessionId = url.searchParams.get("session_id");
  let needsWaiver = false;
  try {
    const waiverRes = await apiRequest(`/waivers/status`, token, {
      headers: {
        "X-Tenant-Slug": args.params.slug
      }
    });
    needsWaiver = waiverRes.needsSignature;
  } catch (e) {
    console.error("Failed to check waiver status", e);
  }
  return {
    sessionId,
    slug: args.params.slug,
    needsWaiver
  };
};
const studio_$slug_checkout_return = UNSAFE_withComponentProps(function CheckoutReturn() {
  const {
    sessionId,
    slug,
    needsWaiver
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-md mx-auto py-16 px-4 text-center",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "bg-green-50 text-green-800 p-8 rounded-2xl mb-8 border border-green-100",
      children: [/* @__PURE__ */ jsx("div", {
        className: "w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl",
        children: "âœ“"
      }), /* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold mb-2",
        children: "Payment Successful!"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-green-700 mb-4",
        children: "Thank you for your purchase. Your credits have been added to your account."
      }), sessionId && /* @__PURE__ */ jsxs("p", {
        className: "text-xs text-green-600/60 font-mono break-all",
        children: ["Reference: ", sessionId]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex flex-col gap-3",
      children: [needsWaiver && /* @__PURE__ */ jsxs(Link, {
        to: `/studio/${slug}/waivers`,
        className: "w-full py-4 bg-amber-500 text-white rounded-lg font-bold hover:bg-amber-600 transition-all shadow-lg animate-bounce flex items-center justify-center gap-2",
        children: [/* @__PURE__ */ jsx("span", {
          children: "âœï¸"
        }), " Sign Your Waiver"]
      }), /* @__PURE__ */ jsx(Link, {
        to: `/studio/${slug}`,
        className: "w-full py-3 bg-zinc-900 text-white rounded-lg font-medium hover:bg-zinc-800 transition-colors",
        children: "Return to Studio"
      }), /* @__PURE__ */ jsx(Link, {
        to: `/studio/${slug}/profile`,
        className: "w-full py-3 bg-white text-zinc-900 border border-zinc-200 rounded-lg font-medium hover:bg-zinc-50 transition-colors",
        children: "View My Profile & Credits"
      })]
    })]
  });
});
const route34 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_checkout_return,
  loader: loader$Y
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_finances = UNSAFE_withComponentProps(function StudioFinances() {
  const {
    tenant,
    member,
    roles
  } = useOutletContext();
  const isOwner = roles.includes("owner");
  if (!isOwner) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-8 text-center text-zinc-500 dark:text-zinc-400",
      children: "You do not have permission to view this page."
    });
  }
  const handleConnectStripe = () => {
    const url = "https://studio-platform-api.slichti.workers.dev";
    window.location.href = `${url}/studios/stripe/connect?tenantId=${tenant.id}`;
  };
  const {
    getToken
  } = useAuth();
  const [stats, setStats] = useState(null);
  const [transactions, setTransactions] = useState([]);
  const [balance, setBalance] = useState(null);
  const [errorDialog, setErrorDialog] = useState({
    isOpen: false,
    message: ""
  });
  const [successDialog, setSuccessDialog] = useState({
    isOpen: false,
    message: ""
  });
  const [retryConfirmId, setRetryConfirmId] = useState(null);
  useEffect(() => {
    if (!tenant.stripeAccountId || !isOwner) return;
    const fetchData = async () => {
      const token = await getToken();
      const url = "https://studio-platform-api.slichti.workers.dev";
      apiRequest(`${url}/commerce/stats`, token).then((res) => {
        if (res) setStats(res);
      });
      apiRequest(`${url}/commerce/transactions`, token).then((res) => {
        if (res && res.transactions) setTransactions(res.transactions);
      });
      apiRequest(`${url}/commerce/balance`, token).then((res) => {
        if (res && !res.error) setBalance(res);
      });
    };
    fetchData();
  }, [tenant.id, isOwner, getToken]);
  const [activeTab, setActiveTab] = useState("overview");
  const [failedPayments, setFailedPayments] = useState([]);
  const [retryLoading, setRetryLoading] = useState(null);
  useEffect(() => {
    if (activeTab === "failed" && isOwner) {
      const fetchFailed = async () => {
        const token = await getToken();
        const url = "https://studio-platform-api.slichti.workers.dev";
        const res = await apiRequest(`${url}/failed-payments`, token);
        if (res?.payments) setFailedPayments(res.payments);
      };
      fetchFailed();
    }
  }, [activeTab, isOwner, getToken]);
  const handleRetryPayment = (subId) => {
    setRetryConfirmId(subId);
  };
  const confirmRetryPayment = async () => {
    if (!retryConfirmId) return;
    setRetryLoading(retryConfirmId);
    try {
      const token = await getToken();
      const url = "https://studio-platform-api.slichti.workers.dev";
      const res = await apiRequest(`${url}/failed-payments/${retryConfirmId}/retry`, token, {
        method: "POST"
      });
      if (res.success) {
        setSuccessDialog({
          isOpen: true,
          message: `Payment successful! (Status: ${res.status})`
        });
        setFailedPayments((prev) => prev.filter((p) => p.id !== retryConfirmId));
      } else {
        setErrorDialog({
          isOpen: true,
          message: res.error || "Retry failed"
        });
      }
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: "Error processing retry"
      });
    } finally {
      setRetryLoading(null);
      setRetryConfirmId(null);
    }
  };
  const [selectedTransaction, setSelectedTransaction] = useState(null);
  const [isRefundModalOpen, setIsRefundModalOpen] = useState(false);
  const [refundAmount, setRefundAmount] = useState("");
  const [refundReason, setRefundReason] = useState("");
  const [isRefunding, setIsRefunding] = useState(false);
  const handleOpenRefund = (t) => {
    setSelectedTransaction(t);
    setRefundAmount((t.amount / 100).toFixed(2));
    setIsRefundModalOpen(true);
  };
  const handleRefund = async () => {
    if (!selectedTransaction) return;
    setIsRefunding(true);
    try {
      const token = await getToken();
      let type = "pos";
      if (selectedTransaction.description?.includes("Pack")) type = "pack";
      if (selectedTransaction.description?.includes("Membership")) type = "membership";
      const res = await apiRequest(`${"https://studio-platform-api.slichti.workers.dev"}/refunds`, token, {
        method: "POST",
        body: JSON.stringify({
          amount: Math.round(parseFloat(refundAmount) * 100),
          reason: refundReason,
          referenceId: selectedTransaction.id,
          type: selectedTransaction.type || type
        })
      });
      if (res && !res.error) {
        setSuccessDialog({
          isOpen: true,
          message: "Refund processed successfully"
        });
        setIsRefundModalOpen(false);
      } else {
        setErrorDialog({
          isOpen: true,
          message: res?.error || "Refund failed"
        });
      }
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Refund failed"
      });
    } finally {
      setIsRefunding(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl text-zinc-900 dark:text-zinc-100",
    children: [/* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      message: errorDialog.message
    }), /* @__PURE__ */ jsx(SuccessDialog, {
      isOpen: successDialog.isOpen,
      onClose: () => setSuccessDialog({
        ...successDialog,
        isOpen: false
      }),
      message: successDialog.message
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!retryConfirmId,
      onClose: () => setRetryConfirmId(null),
      onConfirm: confirmRetryPayment,
      title: "Retry Payment",
      message: "Attempt to charge the customer's payment method now?",
      confirmText: "Charge Now"
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      message: errorDialog.message
    }), /* @__PURE__ */ jsx(SuccessDialog, {
      isOpen: successDialog.isOpen,
      onClose: () => setSuccessDialog({
        ...successDialog,
        isOpen: false
      }),
      message: successDialog.message
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!retryConfirmId,
      onClose: () => setRetryConfirmId(null),
      onConfirm: confirmRetryPayment,
      title: "Retry Payment",
      message: "Attempt to charge the customer's payment method now?",
      confirmText: "Charge Now"
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      message: errorDialog.message
    }), /* @__PURE__ */ jsx(SuccessDialog, {
      isOpen: successDialog.isOpen,
      onClose: () => setSuccessDialog({
        ...successDialog,
        isOpen: false
      }),
      message: successDialog.message
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!retryConfirmId,
      onClose: () => setRetryConfirmId(null),
      onConfirm: confirmRetryPayment,
      title: "Retry Payment",
      message: "Attempt to charge the customer's payment method now?",
      confirmText: "Charge Now"
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-6",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold",
        children: "Finances"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setActiveTab("overview"),
          className: `px-4 py-1.5 text-sm font-medium rounded-md transition ${activeTab === "overview" ? "bg-white dark:bg-black shadow-sm text-zinc-900 dark:text-zinc-100" : "text-zinc-500 hover:text-zinc-700"}`,
          children: "Overview"
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setActiveTab("failed"),
          className: `px-4 py-1.5 text-sm font-medium rounded-md transition flex items-center gap-2 ${activeTab === "failed" ? "bg-white dark:bg-black shadow-sm text-zinc-900 dark:text-zinc-100" : "text-zinc-500 hover:text-zinc-700"}`,
          children: ["Failed Payments", failedPayments.length > 0 && /* @__PURE__ */ jsx("span", {
            className: "w-5 h-5 flex items-center justify-center bg-red-100 text-red-600 text-xs rounded-full",
            children: failedPayments.length
          })]
        })]
      })]
    }), isRefundModalOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-200 dark:border-zinc-800 w-full max-w-md p-6 animate-in fade-in zoom-in duration-200",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold mb-4",
          children: "Process Refund"
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-500 mb-6",
          children: ["Refund for ", selectedTransaction?.description, " on ", new Date(selectedTransaction?.date).toLocaleDateString()]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1",
              children: "Amount ($)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              value: refundAmount,
              onChange: (e) => setRefundAmount(e.target.value),
              className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1",
              children: "Reason"
            }), /* @__PURE__ */ jsx("textarea", {
              value: refundReason,
              onChange: (e) => setRefundReason(e.target.value),
              placeholder: "Customer requested...",
              className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-3 mt-6 justify-end",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setIsRefundModalOpen(false),
            className: "px-4 py-2 text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleRefund,
            disabled: isRefunding,
            className: "px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",
            children: isRefunding ? "Processing..." : "Confirm Refund"
          })]
        })]
      })
    }), activeTab === "failed" ? /* @__PURE__ */ jsx("div", {
      className: "space-y-6",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold",
            children: "Failed Subscription Payments"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500",
            children: "Subscriptions currently suspended due to payment failure."
          })]
        }), failedPayments.length === 0 ? /* @__PURE__ */ jsx("div", {
          className: "p-12 text-center text-zinc-500",
          children: /* @__PURE__ */ jsx("p", {
            children: "No failed payments found. All subscriptions are healthy."
          })
        }) : /* @__PURE__ */ jsxs("table", {
          className: "min-w-full text-sm",
          children: [/* @__PURE__ */ jsx("thead", {
            children: /* @__PURE__ */ jsxs("tr", {
              className: "border-b border-zinc-200 dark:border-zinc-800",
              children: [/* @__PURE__ */ jsx("th", {
                className: "text-left px-4 py-3 font-medium text-zinc-500",
                children: "Customer"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-left px-4 py-3 font-medium text-zinc-500",
                children: "Plan"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-left px-4 py-3 font-medium text-zinc-500",
                children: "Status"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-left px-4 py-3 font-medium text-zinc-500",
                children: "Date"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-right px-4 py-3 font-medium text-zinc-500",
                children: "Action"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            children: failedPayments.map((sub) => /* @__PURE__ */ jsxs("tr", {
              className: "border-b last:border-0 border-zinc-200 dark:border-zinc-800",
              children: [/* @__PURE__ */ jsxs("td", {
                className: "px-4 py-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-zinc-900 dark:text-zinc-100",
                  children: sub.member?.user?.name || "Unknown"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500",
                  children: sub.member?.user?.email
                })]
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-600",
                children: sub.planId
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3",
                children: /* @__PURE__ */ jsx("span", {
                  className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${sub.dunningState === "failed" ? "bg-red-100 text-red-800" : "bg-amber-100 text-amber-800"}`,
                  children: sub.dunningState?.toUpperCase()
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-500",
                children: sub.lastDunningAt ? new Date(sub.lastDunningAt).toLocaleDateString() : "-"
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-right",
                children: /* @__PURE__ */ jsx("button", {
                  onClick: () => handleRetryPayment(sub.id),
                  disabled: retryLoading === sub.id,
                  className: "text-xs bg-zinc-900 text-white px-3 py-1.5 rounded hover:bg-zinc-800 disabled:opacity-50",
                  children: retryLoading === sub.id ? "Retrying..." : "Retry Payment"
                })
              })]
            }, sub.id))
          })]
        })]
      })
    }) : !tenant.stripeAccountId ? /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-8 rounded-lg shadow-sm text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "mb-4 text-4xl",
        children: "ðŸ’³"
      }), /* @__PURE__ */ jsx("h2", {
        className: "text-xl font-bold mb-2",
        children: "Setup Payouts"
      }), /* @__PURE__ */ jsx("p", {
        className: "mb-6 max-w-md mx-auto text-zinc-500 dark:text-zinc-400",
        children: "Connect with Stripe to start accepting payments for class packs and memberships. Funds will be deposited directly to your bank account."
      }), /* @__PURE__ */ jsxs("button", {
        onClick: handleConnectStripe,
        className: "bg-[#635BFF] text-white px-6 py-2.5 rounded-md font-medium hover:bg-[#534be0] transition-colors inline-flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("span", {
          children: "Connect with Stripe"
        }), /* @__PURE__ */ jsx("svg", {
          className: "w-4 h-4",
          fill: "currentColor",
          viewBox: "0 0 24 24",
          children: /* @__PURE__ */ jsx("path", {
            d: "M10 6v-2h14v16h-14v-2h-2v4h18v-20h-18v4h2zm-8 4h10v-3l6 5-6 5v-3h-10v-4z"
          })
        })]
      }), /* @__PURE__ */ jsx("p", {
        className: "mt-4 text-xs text-zinc-400 dark:text-zinc-500",
        children: "You will be redirected to Stripe to verify your business information."
      })]
    }) : /* @__PURE__ */ jsxs("div", {
      className: "space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800 flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-8 h-8 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center text-green-600 dark:text-green-300",
            children: "âœ“"
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-green-800 dark:text-green-300",
              children: "Stripe Connected"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-green-600 dark:text-green-400",
              children: "Your account is ready to process payments."
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-sm font-mono text-zinc-500 dark:text-zinc-400",
          children: tenant.stripeAccountId
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-3 gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
            children: "Total Revenue"
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-3xl font-bold",
            children: ["$", stats ? (stats.totalRevenue / 100).toFixed(2) : "0.00"]
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs mt-2 text-zinc-500 dark:text-zinc-400",
            children: "Est. All Time"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
            children: "Monthly Recurring"
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-3xl font-bold",
            children: ["$", stats ? (stats.mrr / 100).toFixed(2) : "0.00"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs mt-2 text-zinc-500 dark:text-zinc-400",
            children: ["Active Subs: ", stats?.activeSubscriptions || 0]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",
            children: "Stripe Balance"
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-3xl font-bold",
            children: ["$", balance ? (balance.available / 100).toFixed(2) : "0.00"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs mt-2 text-zinc-500 dark:text-zinc-400",
            children: ["Pending: $", balance ? (balance.pending / 100).toFixed(2) : "0.00"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
          children: "Transaction History"
        }), transactions.length === 0 ? /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "No recent transactions."
        }) : /* @__PURE__ */ jsxs("table", {
          className: "min-w-full text-sm",
          children: [/* @__PURE__ */ jsx("thead", {
            children: /* @__PURE__ */ jsxs("tr", {
              className: "border-b border-zinc-200 dark:border-zinc-700",
              children: [/* @__PURE__ */ jsx("th", {
                className: "text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",
                children: "Date"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",
                children: "Description"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",
                children: "Customer"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-right py-2 font-medium text-zinc-700 dark:text-zinc-300",
                children: "Amount"
              }), /* @__PURE__ */ jsx("th", {
                className: "text-right py-2 font-medium text-zinc-700 dark:text-zinc-300",
                children: "Actions"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            children: transactions.map((t) => /* @__PURE__ */ jsxs("tr", {
              className: "border-b last:border-0 border-zinc-200 dark:border-zinc-700",
              children: [/* @__PURE__ */ jsx("td", {
                className: "py-2 text-zinc-600 dark:text-zinc-400",
                children: new Date(t.date).toLocaleDateString()
              }), /* @__PURE__ */ jsx("td", {
                className: "py-2 text-zinc-600 dark:text-zinc-400",
                children: t.description
              }), /* @__PURE__ */ jsx("td", {
                className: "py-2 text-zinc-600 dark:text-zinc-400",
                children: t.customer
              }), /* @__PURE__ */ jsxs("td", {
                className: "py-2 text-right text-zinc-900 dark:text-zinc-100",
                children: ["$", (t.amount / 100).toFixed(2)]
              }), /* @__PURE__ */ jsx("td", {
                className: "py-2 text-right",
                children: /* @__PURE__ */ jsx("button", {
                  onClick: () => handleOpenRefund(t),
                  className: "text-xs text-red-600 hover:text-red-700 hover:underline",
                  children: "Refund"
                })
              })]
            }, t.id))
          })]
        })]
      })]
    })]
  });
});
const route35 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_finances
}, Symbol.toStringTag, { value: "Module" }));
function CreateClassModal({ isOpen, onClose, onSuccess, locations = [], instructors = [], plans = [] }) {
  const { getToken } = useAuth();
  const { slug } = useParams();
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [formData, setFormData] = useState({
    name: "",
    description: "",
    instructorId: "",
    locationId: "",
    startTime: "",
    durationMinutes: 60,
    capacity: 20,
    price: 0,
    isRecurring: false,
    recurrencePattern: "weekly",
    // daily, weekly
    recurrenceEndDate: "",
    createZoom: false,
    minEnrollment: 1,
    autoCancelThreshold: 2,
    autoCancelEnabled: false,
    type: "class",
    memberPrice: "",
    allowCredits: true,
    includedPlanIds: [],
    recurringDays: []
  });
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError("");
    try {
      const token = await getToken();
      let recurrenceRule = void 0;
      if (formData.isRecurring) {
        recurrenceRule = formData.recurrencePattern === "weekly" ? "FREQ=WEEKLY" : "FREQ=DAILY";
        if (formData.recurrencePattern === "weekly" && formData.recurringDays.length > 0) {
          recurrenceRule += `;BYDAY=${formData.recurringDays.join(",")}`;
        }
      }
      const res = await apiRequest("/classes", token, {
        method: "POST",
        headers: { "X-Tenant-Slug": slug },
        body: JSON.stringify({
          title: formData.name,
          description: formData.description,
          instructorId: formData.instructorId,
          locationId: formData.locationId || void 0,
          startTime: new Date(formData.startTime).toISOString(),
          durationMinutes: Number(formData.durationMinutes),
          capacity: Number(formData.capacity),
          price: Number(formData.price),
          createZoomMeeting: formData.createZoom,
          isRecurring: formData.isRecurring,
          recurrenceRule,
          recurrenceEnd: formData.recurrenceEndDate ? new Date(formData.recurrenceEndDate).toISOString() : void 0,
          minStudents: Number(formData.minEnrollment),
          autoCancelThreshold: Number(formData.autoCancelThreshold),
          autoCancelEnabled: formData.autoCancelEnabled,
          type: formData.type,
          memberPrice: formData.memberPrice ? Number(formData.memberPrice) : null,
          allowCredits: formData.allowCredits,
          includedPlanIds: formData.includedPlanIds
        })
      });
      if (res.error) {
        setError(res.error);
      } else {
        onSuccess(res.class || res);
        onClose();
        setFormData({
          name: "",
          description: "",
          instructorId: "",
          locationId: "",
          startTime: "",
          durationMinutes: 60,
          capacity: 20,
          price: 0,
          isRecurring: false,
          recurrencePattern: "weekly",
          recurrenceEndDate: "",
          createZoom: false,
          minEnrollment: 1,
          autoCancelThreshold: 2,
          autoCancelEnabled: false,
          type: "class",
          memberPrice: "",
          allowCredits: true,
          includedPlanIds: [],
          recurringDays: []
        });
      }
    } catch (e2) {
      setError(e2.message || "Failed to create class");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsx(Modal, { isOpen, onClose, title: "Schedule Class", children: /* @__PURE__ */ jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
    error && /* @__PURE__ */ jsx("div", { className: "p-3 bg-red-50 text-red-600 rounded text-sm", children: error }),
    /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Class Name" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "text",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: formData.name,
            onChange: (e) => setFormData({ ...formData, name: e.target.value }),
            placeholder: "e.g. Morning Vinyasa"
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Instructor" }),
        /* @__PURE__ */ jsxs(
          "select",
          {
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",
            value: formData.instructorId,
            onChange: (e) => setFormData({ ...formData, instructorId: e.target.value }),
            children: [
              /* @__PURE__ */ jsx("option", { value: "", children: "Select Instructor" }),
              instructors.map((inst) => /* @__PURE__ */ jsxs("option", { value: inst.id, children: [
                inst.user?.profile?.firstName,
                " ",
                inst.user?.profile?.lastName
              ] }, inst.id))
            ]
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { children: [
      /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Class Type" }),
      /* @__PURE__ */ jsxs(
        "select",
        {
          className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",
          value: formData.type,
          onChange: (e) => setFormData({ ...formData, type: e.target.value }),
          children: [
            /* @__PURE__ */ jsx("option", { value: "class", children: "Regular Class" }),
            /* @__PURE__ */ jsx("option", { value: "workshop", children: "Workshop" }),
            /* @__PURE__ */ jsx("option", { value: "event", children: "Event" }),
            /* @__PURE__ */ jsx("option", { value: "appointment", children: "Appointment (Private)" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxs("div", { children: [
      /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Location" }),
      /* @__PURE__ */ jsxs(
        "select",
        {
          className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",
          value: formData.locationId,
          onChange: (e) => setFormData({ ...formData, locationId: e.target.value }),
          children: [
            /* @__PURE__ */ jsx("option", { value: "", children: "Select Location (Optional)" }),
            locations.map((loc) => /* @__PURE__ */ jsx("option", { value: loc.id, children: loc.name }, loc.id))
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxs("div", { children: [
      /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 text-sm text-zinc-700 cursor-pointer", children: [
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "checkbox",
            checked: formData.createZoom,
            onChange: (e) => setFormData({ ...formData, createZoom: e.target.checked }),
            className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
          }
        ),
        /* @__PURE__ */ jsx("span", { children: "Enable Zoom (Virtual Access)" })
      ] }),
      formData.createZoom && /* @__PURE__ */ jsx("p", { className: "text-xs text-zinc-500 ml-6 mt-1", children: "A Zoom meeting will be created automatically." })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Start Time" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "datetime-local",
            required: true,
            step: "600",
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: formData.startTime,
            onChange: (e) => setFormData({ ...formData, startTime: e.target.value })
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Duration (min)" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "number",
            required: true,
            min: "15",
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: formData.durationMinutes,
            onChange: (e) => setFormData({ ...formData, durationMinutes: Number(e.target.value) })
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Capacity" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "number",
            required: true,
            min: "1",
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: formData.capacity,
            onChange: (e) => setFormData({ ...formData, capacity: Number(e.target.value) })
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Price ($)" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "number",
            required: true,
            min: "0",
            step: "0.01",
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: formData.price,
            onChange: (e) => setFormData({ ...formData, price: Number(e.target.value) })
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 border border-zinc-200 p-4 rounded-lg space-y-4", children: [
      /* @__PURE__ */ jsx("h3", { className: "text-sm font-semibold text-zinc-900 border-b border-zinc-200 pb-2", children: "Access & Pricing Rules" }),
      /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-700 mb-1", children: "Member Price ($)" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "number",
              min: "0",
              step: "0.01",
              className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",
              value: formData.memberPrice,
              onChange: (e) => setFormData({ ...formData, memberPrice: e.target.value }),
              placeholder: "Optional"
            }
          )
        ] }),
        /* @__PURE__ */ jsx("div", { className: "flex items-center", children: /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 text-sm text-zinc-700 cursor-pointer", children: [
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "checkbox",
              checked: formData.allowCredits,
              onChange: (e) => setFormData({ ...formData, allowCredits: e.target.checked }),
              className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
            }
          ),
          /* @__PURE__ */ jsx("span", { children: "Accept Class Packs/Credits?" })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-700 mb-1", children: "Included Free in Plans:" }),
        /* @__PURE__ */ jsxs("div", { className: "max-h-24 overflow-y-auto border border-zinc-300 rounded bg-white p-2 space-y-1", children: [
          plans.map((plan) => /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 text-xs hover:bg-zinc-50 p-1 rounded cursor-pointer", children: [
            /* @__PURE__ */ jsx(
              "input",
              {
                type: "checkbox",
                checked: formData.includedPlanIds.includes(plan.id),
                onChange: (e) => {
                  const newIds = e.target.checked ? [...formData.includedPlanIds, plan.id] : formData.includedPlanIds.filter((id) => id !== plan.id);
                  setFormData({ ...formData, includedPlanIds: newIds });
                },
                className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
              }
            ),
            /* @__PURE__ */ jsx("span", { children: plan.name })
          ] }, plan.id)),
          plans.length === 0 && /* @__PURE__ */ jsx("span", { className: "text-zinc-400 italic", children: "No plans found." })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 border border-zinc-200 p-4 rounded-lg space-y-4", children: [
      /* @__PURE__ */ jsx("h3", { className: "text-sm font-semibold text-zinc-900 border-b border-zinc-200 pb-2", children: "Enrollment Policies" }),
      /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-700 mb-1", children: "Min. Enrollment to Run" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "number",
              min: "1",
              className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",
              value: formData.minEnrollment,
              onChange: (e) => setFormData({ ...formData, minEnrollment: Number(e.target.value) })
            }
          )
        ] }),
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-700 mb-1", children: "Auto-Cancel Cutoff (hrs)" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "number",
              min: "1",
              className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",
              value: formData.autoCancelThreshold,
              onChange: (e) => setFormData({ ...formData, autoCancelThreshold: Number(e.target.value) }),
              placeholder: "Hours before start"
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 text-sm text-zinc-700 cursor-pointer", children: [
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "checkbox",
            checked: formData.autoCancelEnabled,
            onChange: (e) => setFormData({ ...formData, autoCancelEnabled: e.target.checked }),
            className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
          }
        ),
        /* @__PURE__ */ jsx("span", { children: "Enable automatic cancellation if minimum is not met" })
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "border-t border-zinc-200 pt-4 mt-2", children: [
      /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 text-sm text-zinc-700 cursor-pointer", children: [
        /* @__PURE__ */ jsx(
          "input",
          {
            type: "checkbox",
            checked: formData.isRecurring,
            onChange: (e) => setFormData({ ...formData, isRecurring: e.target.checked }),
            className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
          }
        ),
        /* @__PURE__ */ jsx("span", { children: "Repeat this class" })
      ] }),
      formData.isRecurring && /* @__PURE__ */ jsxs("div", { className: "mt-3 p-3 bg-zinc-50 rounded border border-zinc-200 space-y-3", children: [
        /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxs("div", { children: [
            /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-1", children: "Frequency" }),
            /* @__PURE__ */ jsxs(
              "select",
              {
                className: "w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",
                value: formData.recurrencePattern,
                onChange: (e) => setFormData({ ...formData, recurrencePattern: e.target.value }),
                children: [
                  /* @__PURE__ */ jsx("option", { value: "weekly", children: "Weekly" }),
                  /* @__PURE__ */ jsx("option", { value: "daily", children: "Daily" })
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxs("div", { children: [
            /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-1", children: "End Date" }),
            /* @__PURE__ */ jsx(
              "input",
              {
                type: "date",
                required: formData.isRecurring,
                className: "w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",
                value: formData.recurrenceEndDate,
                onChange: (e) => setFormData({ ...formData, recurrenceEndDate: e.target.value }),
                min: formData.startTime ? new Date(formData.startTime).toISOString().split("T")[0] : void 0
              }
            )
          ] })
        ] }),
        formData.recurrencePattern === "weekly" && /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-2", children: "Repeat On" }),
          /* @__PURE__ */ jsx("div", { className: "flex flex-wrap gap-2", children: [
            { label: "Mon", value: "MO" },
            { label: "Tue", value: "TU" },
            { label: "Wed", value: "WE" },
            { label: "Thu", value: "TH" },
            { label: "Fri", value: "FR" },
            { label: "Sat", value: "SA" },
            { label: "Sun", value: "SU" }
          ].map((day) => /* @__PURE__ */ jsxs("label", { className: `
                                                flex items-center justify-center w-8 h-8 rounded-full text-xs font-medium cursor-pointer transition-colors border
                                                ${formData.recurringDays.includes(day.value) ? "bg-blue-600 text-white border-blue-600" : "bg-white text-zinc-600 border-zinc-200 hover:border-blue-300"}
                                            `, children: [
            /* @__PURE__ */ jsx(
              "input",
              {
                type: "checkbox",
                className: "hidden",
                checked: formData.recurringDays.includes(day.value),
                onChange: (e) => {
                  const newDays = e.target.checked ? [...formData.recurringDays, day.value] : formData.recurringDays.filter((d) => d !== day.value);
                  setFormData({ ...formData, recurringDays: newDays });
                }
              }
            ),
            day.label[0]
          ] }, day.value)) })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "flex justify-end gap-3 pt-2", children: [
      /* @__PURE__ */ jsx(
        "button",
        {
          type: "button",
          onClick: onClose,
          className: "px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-md hover:bg-zinc-50",
          children: "Cancel"
        }
      ),
      /* @__PURE__ */ jsx(
        "button",
        {
          type: "submit",
          disabled: loading,
          className: "px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",
          children: loading ? "Scheduling..." : "Schedule Class"
        }
      )
    ] })
  ] }) });
}
function ClassDetailModal({
  isOpen,
  onClose,
  classEvent,
  onRecordingAdded,
  onRecordingDeleted,
  canAttachRecording = false,
  currentUserMemberId,
  userRoles = [],
  tenantSlug,
  onSubRequested,
  onBookRequested
}) {
  const [recordingUrl, setRecordingUrl] = useState("");
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState(null);
  const [confirmState, setConfirmState] = useState(null);
  const { getToken } = useAuth();
  useEffect(() => {
    setRecordingUrl("");
    setError(null);
    setIsSubmitting(false);
  }, [classEvent?.id]);
  if (!classEvent) return null;
  const hasRecording = !!classEvent.resource?.cloudflareStreamId;
  const streamStatus = classEvent.resource?.recordingStatus;
  const handleAddRecording = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    setError(null);
    try {
      const token = await getToken();
      const res = await apiRequest(`/classes/${classEvent.id}/recording`, token, {
        method: "POST",
        body: JSON.stringify({ url: recordingUrl })
      });
      if (res.error) throw new Error(res.error);
      onRecordingAdded(classEvent.id, res.videoId);
      onClose();
    } catch (err) {
      setError(err.message || "Failed to add recording");
    } finally {
      setIsSubmitting(false);
    }
  };
  const handleDeleteRecording = async () => {
    setConfirmState({ type: "delete_recording" });
  };
  const executeDeleteRecording = async () => {
    setIsSubmitting(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/classes/${classEvent.id}/recording`, token, {
        method: "DELETE"
      });
      if (res.error) throw new Error(res.error);
      onRecordingDeleted(classEvent.id);
      onClose();
    } catch (err) {
      alert(err.message || "Failed to delete recording");
    } finally {
      setIsSubmitting(false);
    }
  };
  const handleRequestSub = async () => {
    setConfirmState({ type: "request_sub" });
  };
  const executeRequestSub = async () => {
    setIsSubmitting(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/substitutions/request`, token, {
        method: "POST",
        headers: { "X-Tenant-Slug": tenantSlug },
        body: JSON.stringify({ classId: classEvent.id })
      });
      if (res.error) throw new Error(res.error);
      alert("Substitute check requested! Staff will be notified.");
      onSubRequested?.(classEvent.id);
      onClose();
    } catch (err) {
      alert(err.message);
    } finally {
      setIsSubmitting(false);
    }
  };
  const handleClaimSub = async (subId) => {
    setConfirmState({ type: "claim_sub", subId });
  };
  const executeClaimSub = async () => {
    const subId = confirmState?.subId;
    if (!subId) return;
    setIsSubmitting(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/substitutions/${subId}/claim`, token, {
        method: "POST",
        headers: { "X-Tenant-Slug": tenantSlug }
      });
      if (res.error) throw new Error(res.error);
      alert("Shift claimed! Pending approval.");
      onClose();
    } catch (err) {
      alert(err.message);
    } finally {
      setIsSubmitting(false);
    }
  };
  return /* @__PURE__ */ jsxs(Fragment, { children: [
    /* @__PURE__ */ jsx(Transition, { appear: true, show: isOpen, as: Fragment$1, children: /* @__PURE__ */ jsxs(Dialog$1, { as: "div", className: "relative z-50", onClose, children: [
      /* @__PURE__ */ jsx(
        Transition.Child,
        {
          as: Fragment$1,
          enter: "ease-out duration-300",
          enterFrom: "opacity-0",
          enterTo: "opacity-100",
          leave: "ease-in duration-200",
          leaveFrom: "opacity-100",
          leaveTo: "opacity-0",
          children: /* @__PURE__ */ jsx("div", { className: "fixed inset-0 bg-black/25 backdrop-blur-sm" })
        }
      ),
      /* @__PURE__ */ jsx("div", { className: "fixed inset-0 overflow-y-auto", children: /* @__PURE__ */ jsx("div", { className: "flex min-h-full items-center justify-center p-4 text-center", children: /* @__PURE__ */ jsx(
        Transition.Child,
        {
          as: Fragment$1,
          enter: "ease-out duration-300",
          enterFrom: "opacity-0 scale-95",
          enterTo: "opacity-100 scale-100",
          leave: "ease-in duration-200",
          leaveFrom: "opacity-100 scale-100",
          leaveTo: "opacity-0 scale-95",
          children: /* @__PURE__ */ jsxs(Dialog$1.Panel, { className: "w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all", children: [
            /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-start mb-4", children: [
              /* @__PURE__ */ jsxs("div", { children: [
                /* @__PURE__ */ jsx(Dialog$1.Title, { as: "h3", className: "text-lg font-medium leading-6 text-gray-900", children: classEvent.title }),
                /* @__PURE__ */ jsx("p", { className: "text-sm text-gray-500 mt-1", children: new Date(classEvent.start).toLocaleString([], { dateStyle: "medium", timeStyle: "short" }) })
              ] }),
              /* @__PURE__ */ jsx("button", { onClick: onClose, className: "text-gray-400 hover:text-gray-500", children: /* @__PURE__ */ jsx(X, { size: 20 }) })
            ] }),
            /* @__PURE__ */ jsxs("div", { className: "space-y-6", children: [
              /* @__PURE__ */ jsxs("div", { className: "bg-gray-50 p-3 rounded-md text-sm text-gray-700 space-y-2", children: [
                /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
                  /* @__PURE__ */ jsxs("p", { children: [
                    /* @__PURE__ */ jsx("strong", { children: "Instructor:" }),
                    " ",
                    classEvent.resource?.instructor?.user?.profile?.firstName || "Unknown"
                  ] }),
                  /* @__PURE__ */ jsxs("p", { children: [
                    /* @__PURE__ */ jsx("strong", { children: "Duration:" }),
                    " ",
                    classEvent.resource?.durationMinutes,
                    " min"
                  ] })
                ] }),
                classEvent.resource?.location && /* @__PURE__ */ jsxs("p", { children: [
                  /* @__PURE__ */ jsx("strong", { children: "Location:" }),
                  " ",
                  classEvent.resource.location.name
                ] }),
                /* @__PURE__ */ jsxs("div", { className: "mt-2 pt-2 border-t border-gray-200", children: [
                  /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-center mb-2", children: [
                    /* @__PURE__ */ jsx("span", { className: "font-semibold text-gray-900", children: "Bookings" }),
                    /* @__PURE__ */ jsx(
                      "a",
                      {
                        href: `/studio/${window.location.pathname.split("/")[2]}/classes/${classEvent.id}/roster`,
                        className: "text-blue-600 hover:text-blue-800 text-xs font-medium",
                        children: "View Roster â†’"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4 text-xs", children: [
                    /* @__PURE__ */ jsxs("div", { className: "bg-white p-2 rounded border border-gray-200", children: [
                      /* @__PURE__ */ jsx("span", { className: "block text-gray-500", children: "Confirmed" }),
                      /* @__PURE__ */ jsxs("span", { className: "block text-lg font-bold text-gray-900", children: [
                        classEvent.resource?.confirmedCount || 0,
                        /* @__PURE__ */ jsxs("span", { className: "text-gray-400 font-normal text-xs ml-1", children: [
                          "/ ",
                          classEvent.resource?.capacity || "âˆž"
                        ] })
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxs("div", { className: "bg-white p-2 rounded border border-gray-200", children: [
                      /* @__PURE__ */ jsx("span", { className: "block text-gray-500", children: "Waitlist" }),
                      /* @__PURE__ */ jsx("span", { className: `block text-lg font-bold ${classEvent.resource?.waitlistCount > 0 ? "text-amber-600" : "text-gray-900"}`, children: classEvent.resource?.waitlistCount || 0 })
                    ] })
                  ] })
                ] })
              ] }),
              (classEvent.resource?.zoomEnabled || classEvent.resource?.zoomMeetingUrl) && /* @__PURE__ */ jsxs("div", { className: "bg-blue-50 p-3 rounded-md text-sm border border-blue-100", children: [
                /* @__PURE__ */ jsxs("h4", { className: "font-semibold text-blue-900 mb-2 flex items-center gap-2", children: [
                  /* @__PURE__ */ jsx(Video, { size: 16 }),
                  "Virtual Class Access"
                ] }),
                classEvent.resource?.zoomMeetingUrl ? /* @__PURE__ */ jsxs("div", { className: "space-y-2", children: [
                  /* @__PURE__ */ jsx(
                    "a",
                    {
                      href: classEvent.resource.zoomMeetingUrl,
                      target: "_blank",
                      rel: "noopener noreferrer",
                      className: "block w-full text-center bg-blue-600 text-white py-2 rounded-md font-medium hover:bg-blue-700 transition",
                      children: "Launch Zoom Meeting"
                    }
                  ),
                  classEvent.resource?.zoomMeetingId && /* @__PURE__ */ jsxs("div", { className: "text-xs text-blue-800 space-y-1 mt-2 pt-2 border-t border-blue-200", children: [
                    /* @__PURE__ */ jsxs("div", { className: "flex justify-between", children: [
                      /* @__PURE__ */ jsx("span", { className: "font-medium", children: "Meeting ID:" }),
                      /* @__PURE__ */ jsx("span", { className: "font-mono select-all", children: classEvent.resource.zoomMeetingId })
                    ] }),
                    classEvent.resource?.zoomPassword && /* @__PURE__ */ jsxs("div", { className: "flex justify-between", children: [
                      /* @__PURE__ */ jsx("span", { className: "font-medium", children: "Passcode:" }),
                      /* @__PURE__ */ jsx("span", { className: "font-mono select-all", children: classEvent.resource.zoomPassword })
                    ] })
                  ] })
                ] }) : /* @__PURE__ */ jsx("div", { className: "text-blue-700 text-xs italic", children: "Zoom link is being generated or not available." })
              ] }),
              onBookRequested && !userRoles.includes("instructor") && /* @__PURE__ */ jsx("div", { className: "border-t pt-4", children: /* @__PURE__ */ jsx(
                "button",
                {
                  onClick: onBookRequested,
                  className: "w-full bg-zinc-900 text-white py-3 rounded-md font-medium text-sm hover:bg-zinc-800 shadow-sm",
                  children: "Book This Class"
                }
              ) }),
              /* @__PURE__ */ jsxs("div", { className: "border-t pt-4", children: [
                /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-center mb-3", children: [
                  /* @__PURE__ */ jsx("h4", { className: "text-sm font-semibold text-gray-900", children: "Shift Coverage" }),
                  classEvent.resource?.substitutions?.length > 0 && /* @__PURE__ */ jsxs("span", { className: `text-[10px] font-bold uppercase px-2 py-0.5 rounded-full ${classEvent.resource.substitutions[0].status === "approved" ? "bg-green-100 text-green-700" : classEvent.resource.substitutions[0].status === "claimed" ? "bg-blue-100 text-blue-700" : "bg-amber-100 text-amber-700"}`, children: [
                    "Sub: ",
                    classEvent.resource.substitutions[0].status
                  ] })
                ] }),
                classEvent.resource?.substitutions?.length > 0 ? /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 p-4 rounded-lg text-sm border border-zinc-200", children: [
                  /* @__PURE__ */ jsx("p", { className: "text-zinc-600", children: classEvent.resource.substitutions[0].status === "pending" ? "Seeking coverage..." : classEvent.resource.substitutions[0].status === "claimed" ? "Claimed - Awaiting approval" : "Substitution approved" }),
                  classEvent.resource.substitutions[0].status === "pending" && currentUserMemberId !== classEvent.resource?.instructorId && /* @__PURE__ */ jsx(
                    "button",
                    {
                      onClick: () => handleClaimSub(classEvent.resource.substitutions[0].id),
                      className: "mt-3 w-full bg-blue-600 text-white py-2 rounded-md font-medium text-xs hover:bg-blue-700",
                      children: "Claim this shift"
                    }
                  )
                ] }) : /* @__PURE__ */ jsx(Fragment, { children: currentUserMemberId === classEvent.resource?.instructorId && /* @__PURE__ */ jsx(
                  "button",
                  {
                    onClick: handleRequestSub,
                    disabled: isSubmitting,
                    className: "w-full border border-zinc-300 py-2 rounded-md text-xs font-medium text-zinc-600 hover:bg-zinc-50 disabled:opacity-50",
                    children: "Request Substitute"
                  }
                ) })
              ] }),
              canAttachRecording && /* @__PURE__ */ jsxs("div", { className: "border-t pt-4", children: [
                /* @__PURE__ */ jsxs("h4", { className: "text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2", children: [
                  /* @__PURE__ */ jsx(Video, { size: 16 }),
                  "Class Recording"
                ] }),
                hasRecording ? /* @__PURE__ */ jsxs("div", { className: "space-y-3", children: [
                  /* @__PURE__ */ jsxs("div", { className: "bg-green-50 text-green-800 p-3 rounded-md text-sm flex items-center gap-2", children: [
                    /* @__PURE__ */ jsx("div", { className: "w-2 h-2 rounded-full bg-green-500 animate-pulse" }),
                    /* @__PURE__ */ jsxs("span", { children: [
                      "Recording attached (",
                      streamStatus || "processed",
                      ")"
                    ] }),
                    /* @__PURE__ */ jsx(
                      "button",
                      {
                        onClick: handleDeleteRecording,
                        type: "button",
                        disabled: isSubmitting,
                        className: "ml-auto text-green-700 hover:text-red-600 p-1",
                        title: "Delete Recording",
                        children: /* @__PURE__ */ jsx(Trash2, { size: 16 })
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsx("div", { className: "aspect-video bg-black rounded-lg overflow-hidden relative", children: /* @__PURE__ */ jsx(
                    "iframe",
                    {
                      src: `https://iframe.videodelivery.net/${classEvent.resource.cloudflareStreamId}`,
                      className: "border-none absolute top-0 left-0 w-full h-full",
                      allow: "accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",
                      allowFullScreen: true,
                      title: "Class Recording"
                    }
                  ) })
                ] }) : /* @__PURE__ */ jsxs("form", { onSubmit: handleAddRecording, children: [
                  /* @__PURE__ */ jsxs("div", { className: "mb-3", children: [
                    /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-gray-700 mb-1", children: "Add External Video URL (e.g. Zoom Cloud Link)" }),
                    /* @__PURE__ */ jsx(
                      "input",
                      {
                        type: "url",
                        required: true,
                        placeholder: "https://zoom.us/rec/...",
                        className: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",
                        value: recordingUrl,
                        onChange: (e) => setRecordingUrl(e.target.value)
                      }
                    )
                  ] }),
                  error && /* @__PURE__ */ jsx("p", { className: "text-xs text-red-600 mb-2", children: error }),
                  /* @__PURE__ */ jsx(
                    "button",
                    {
                      type: "submit",
                      disabled: isSubmitting,
                      className: "inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:opacity-50",
                      children: isSubmitting ? /* @__PURE__ */ jsxs("span", { className: "flex items-center gap-2", children: [
                        /* @__PURE__ */ jsx(Loader2, { size: 16, className: "animate-spin" }),
                        " Uploading..."
                      ] }) : "Attach Recording"
                    }
                  )
                ] })
              ] })
            ] })
          ] })
        }
      ) }) })
    ] }) }),
    /* @__PURE__ */ jsx(
      ConfirmDialog,
      {
        open: !!confirmState,
        onOpenChange: (open) => !open && setConfirmState(null),
        onConfirm: () => {
          if (confirmState?.type === "delete_recording") executeDeleteRecording();
          else if (confirmState?.type === "request_sub") executeRequestSub();
          else if (confirmState?.type === "claim_sub") executeClaimSub();
        },
        title: confirmState?.type === "delete_recording" ? "Delete Recording" : confirmState?.type === "request_sub" ? "Request Substitute" : "Claim Shift",
        description: confirmState?.type === "delete_recording" ? "Are you sure you want to delete this recording? This cannot be undone." : confirmState?.type === "request_sub" ? "Are you sure you want to request a substitute? Instructors will be notified." : "Are you sure you want to claim this shift?",
        confirmText: confirmState?.type === "delete_recording" ? "Delete" : "Confirm",
        variant: confirmState?.type === "delete_recording" ? "destructive" : "default"
      }
    )
  ] });
}
function BookingModal({ isOpen, onClose, classEvent, family, member }) {
  const fetcher = useFetcher();
  const [attendanceType, setAttendanceType] = useState("in_person");
  if (!classEvent) return null;
  const isFull = !classEvent.zoomEnabled && (classEvent.confirmedCount || 0) >= (classEvent.capacity || Infinity);
  return /* @__PURE__ */ jsx(Transition, { appear: true, show: isOpen, as: Fragment$1, children: /* @__PURE__ */ jsxs(Dialog$1, { as: "div", className: "relative z-50", onClose, children: [
    /* @__PURE__ */ jsx(
      Transition.Child,
      {
        as: Fragment$1,
        enter: "ease-out duration-300",
        enterFrom: "opacity-0",
        enterTo: "opacity-100",
        leave: "ease-in duration-200",
        leaveFrom: "opacity-100",
        leaveTo: "opacity-0",
        children: /* @__PURE__ */ jsx("div", { className: "fixed inset-0 bg-black/50 backdrop-blur-sm" })
      }
    ),
    /* @__PURE__ */ jsx("div", { className: "fixed inset-0 overflow-y-auto", children: /* @__PURE__ */ jsx("div", { className: "flex min-h-full items-center justify-center p-4 text-center", children: /* @__PURE__ */ jsx(
      Transition.Child,
      {
        as: Fragment$1,
        enter: "ease-out duration-300",
        enterFrom: "opacity-0 scale-95",
        enterTo: "opacity-100 scale-100",
        leave: "ease-in duration-200",
        leaveFrom: "opacity-100 scale-100",
        leaveTo: "opacity-0 scale-95",
        children: /* @__PURE__ */ jsxs(Dialog$1.Panel, { className: "w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-zinc-900 p-6 text-left align-middle shadow-xl transition-all border border-zinc-200 dark:border-zinc-800", children: [
          /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-start mb-4", children: [
            /* @__PURE__ */ jsxs(Dialog$1.Title, { as: "h3", className: "text-lg font-bold leading-6 text-zinc-900 dark:text-zinc-100", children: [
              "Book ",
              classEvent.title
            ] }),
            /* @__PURE__ */ jsx("button", { onClick: onClose, className: "text-zinc-400 hover:text-zinc-500", children: /* @__PURE__ */ jsx(X, { size: 20 }) })
          ] }),
          /* @__PURE__ */ jsxs("div", { className: "space-y-4", children: [
            classEvent.zoomEnabled && /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-lg text-sm border border-zinc-200 dark:border-zinc-700", children: [
              /* @__PURE__ */ jsx("p", { className: "font-semibold text-zinc-900 dark:text-zinc-100 mb-2", children: "Attendance Preference" }),
              /* @__PURE__ */ jsxs("div", { className: "flex gap-4", children: [
                /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 cursor-pointer", children: [
                  /* @__PURE__ */ jsx(
                    "input",
                    {
                      type: "radio",
                      name: "attendanceType",
                      checked: attendanceType === "in_person",
                      onChange: () => setAttendanceType("in_person"),
                      className: "text-blue-600 focus:ring-blue-500"
                    }
                  ),
                  /* @__PURE__ */ jsx("span", { className: "text-zinc-700 dark:text-zinc-300", children: "In-Person" })
                ] }),
                /* @__PURE__ */ jsxs("label", { className: "flex items-center gap-2 cursor-pointer", children: [
                  /* @__PURE__ */ jsx(
                    "input",
                    {
                      type: "radio",
                      name: "attendanceType",
                      checked: attendanceType === "zoom",
                      onChange: () => setAttendanceType("zoom"),
                      className: "text-blue-600 focus:ring-blue-500"
                    }
                  ),
                  /* @__PURE__ */ jsx("span", { className: "text-zinc-700 dark:text-zinc-300", children: "Virtual (Zoom)" })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-lg text-sm border border-zinc-200 dark:border-zinc-700", children: [
              /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-center mb-1", children: [
                /* @__PURE__ */ jsx("span", { className: "font-semibold text-zinc-900 dark:text-zinc-100", children: "Price" }),
                /* @__PURE__ */ jsx("span", { className: "font-bold text-zinc-900 dark:text-zinc-100", children: (() => {
                  if (member?.memberships?.some(
                    (m) => m.status === "active" && classEvent.includedPlanIds?.includes(m.planId)
                  )) {
                    return /* @__PURE__ */ jsx("span", { className: "text-green-600", children: "Free (Included)" });
                  }
                  if (classEvent.allowCredits && member?.purchasedPacks?.some((p) => p.remainingCredits > 0)) {
                    return /* @__PURE__ */ jsx("span", { className: "text-blue-600", children: "1 Credit" });
                  }
                  if (member && classEvent.memberPrice !== void 0 && classEvent.memberPrice !== null) {
                    return /* @__PURE__ */ jsxs("span", { children: [
                      "$",
                      classEvent.memberPrice.toFixed(2),
                      " ",
                      /* @__PURE__ */ jsxs("span", { className: "text-xs font-normal text-zinc-500 line-through", children: [
                        "$",
                        classEvent.price
                      ] })
                    ] });
                  }
                  return classEvent.price ? `$${classEvent.price.toFixed(2)}` : "Free";
                })() })
              ] }),
              /* @__PURE__ */ jsxs("div", { className: "text-xs text-zinc-500", children: [
                classEvent.type === "workshop" ? "Workshop" : "Class",
                " â€¢ ",
                classEvent.durationMinutes,
                " min"
              ] })
            ] }),
            /* @__PURE__ */ jsx("div", { className: "text-sm", children: isFull && attendanceType === "in_person" ? /* @__PURE__ */ jsx("div", { className: "text-amber-600 mb-2 font-medium", children: "Class is full. You will be added to the waitlist." }) : /* @__PURE__ */ jsx("p", { className: "text-zinc-500 dark:text-zinc-400 mb-2", children: "Who is this booking for?" }) }),
            /* @__PURE__ */ jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxs(fetcher.Form, { method: "post", action: `/studio/${window.location.pathname.split("/")[2]}/classes?index`, onSubmit: () => onClose(), children: [
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "classId", value: classEvent.id }),
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "attendanceType", value: attendanceType }),
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "intent", value: isFull && attendanceType === "in_person" ? "waitlist" : "book" }),
                /* @__PURE__ */ jsxs(
                  "button",
                  {
                    type: "submit",
                    disabled: fetcher.state !== "idle",
                    className: "w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",
                    children: [
                      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsx("div", { className: "bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400", children: /* @__PURE__ */ jsx(User, { size: 16 }) }),
                        /* @__PURE__ */ jsx("span", { className: "font-medium text-zinc-900 dark:text-zinc-100", children: "Myself" })
                      ] }),
                      /* @__PURE__ */ jsx("span", { className: "text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100", children: "â†’" })
                    ]
                  }
                )
              ] }),
              family.map((f) => /* @__PURE__ */ jsxs(fetcher.Form, { method: "post", action: `/studio/${window.location.pathname.split("/")[2]}/classes?index`, onSubmit: () => onClose(), children: [
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "classId", value: classEvent.id }),
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "memberId", value: f.memberId || "" }),
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "attendanceType", value: attendanceType }),
                /* @__PURE__ */ jsx("input", { type: "hidden", name: "intent", value: isFull && attendanceType === "in_person" ? "waitlist" : "book" }),
                /* @__PURE__ */ jsxs(
                  "button",
                  {
                    type: "submit",
                    disabled: fetcher.state !== "idle",
                    className: "w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",
                    children: [
                      /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsx("div", { className: "bg-purple-100 dark:bg-purple-900/30 p-2 rounded-full text-purple-600 dark:text-purple-400", children: /* @__PURE__ */ jsx(Users, { size: 16 }) }),
                        /* @__PURE__ */ jsxs("span", { className: "font-medium text-zinc-900 dark:text-zinc-100", children: [
                          f.firstName,
                          " ",
                          f.lastName
                        ] })
                      ] }),
                      /* @__PURE__ */ jsx("span", { className: "text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100", children: "â†’" })
                    ]
                  }
                )
              ] }, f.userId))
            ] })
          ] })
        ] })
      }
    ) }) })
  ] }) });
}
const locales = {
  "en-US": enUS
};
const localizer = dateFnsLocalizer({
  format: format$1,
  parse,
  startOfWeek,
  getDay,
  locales
});
const loader$X = async (args) => {
  const {
    params
  } = args;
  const {
    getToken,
    userId
  } = await getAuth(args);
  if (!userId) {
    return {
      classes: [],
      locations: [],
      instructors: [],
      error: "Unauthorized"
    };
  }
  const token = await getToken();
  try {
    const [classes, locationsRes, instructorsRes, familyRes] = await Promise.all([apiRequest("/classes", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest("/locations", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      locations: []
    })), apiRequest("/members?role=instructor", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      members: []
    })), apiRequest("/users/me/family", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      family: []
    }))]);
    return {
      classes: classes || [],
      locations: locationsRes.locations || [],
      instructors: instructorsRes.members || [],
      family: familyRes.family || [],
      error: null
    };
  } catch (e) {
    console.error("Failed to fetch schedule data", e);
    return {
      classes: [],
      locations: [],
      instructors: [],
      error: "Failed to load schedule"
    };
  }
};
const studio_$slug_schedule = UNSAFE_withComponentProps(function StudioSchedule() {
  const {
    classes: initialClasses,
    locations,
    instructors,
    family,
    error
  } = useLoaderData();
  const {
    tenant,
    me,
    features,
    roles,
    isStudentView
  } = useOutletContext() || {};
  const canSchedule = !isStudentView && (roles?.includes("owner") || roles?.includes("instructor"));
  const [classes, setClasses] = useState(initialClasses || []);
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [isDetailOpen, setIsDetailOpen] = useState(false);
  const [isBookingOpen, setIsBookingOpen] = useState(false);
  const [selectedClass, setSelectedClass] = useState(null);
  const events = classes.map((c) => ({
    id: c.id,
    title: c.title,
    start: new Date(c.startTime),
    end: new Date(new Date(c.startTime).getTime() + c.durationMinutes * 6e4),
    resource: c
  }));
  const handleCreateSuccess = (newClass) => {
    setClasses([...classes, newClass]);
  };
  const handleSelectSlot = useCallback(({
    start
  }) => {
    setIsCreateOpen(true);
  }, []);
  const handleSelectEvent = useCallback((event) => {
    setSelectedClass(event.resource);
    setIsDetailOpen(true);
  }, []);
  const handleRecordingAdded = (classId, videoId) => {
    setClasses(classes.map((c) => {
      if (c.id === classId) {
        return {
          ...c,
          cloudflareStreamId: videoId,
          recordingStatus: "processing"
        };
      }
      return c;
    }));
  };
  const handleRecordingDeleted = (classId) => {
    setClasses(classes.map((c) => {
      if (c.id === classId) {
        return {
          ...c,
          cloudflareStreamId: null,
          recordingStatus: null
        };
      }
      return c;
    }));
  };
  const handleSubRequested = (classId) => {
    setClasses(classes.map((c) => {
      if (c.id === classId) {
        return {
          ...c,
          substitutions: [{
            status: "pending",
            id: "temp-" + Date.now()
          }]
          // optimistic update
        };
      }
      return c;
    }));
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6 h-screen flex flex-col",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Schedule"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 text-sm mt-1",
          children: isStudentView ? "View upcoming classes and book sessions." : "Manage your class calendar and bookings."
        })]
      }), canSchedule && /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreateOpen(true),
        className: "flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors font-medium text-sm",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 16
        }), "Schedule Class"]
      })]
    }), error && /* @__PURE__ */ jsx("div", {
      className: "bg-red-50 text-red-700 p-4 rounded mb-4 text-sm",
      children: error
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 bg-white dark:bg-zinc-900 rounded-lg shadow border border-zinc-200 dark:border-zinc-800 p-4",
      children: /* @__PURE__ */ jsx(Calendar$1, {
        localizer,
        events,
        startAccessor: "start",
        endAccessor: "end",
        style: {
          height: "100%"
        },
        views: [Views.MONTH, Views.WEEK, Views.DAY, Views.AGENDA],
        defaultView: Views.WEEK,
        selectable: true,
        onSelectSlot: handleSelectSlot,
        onSelectEvent: handleSelectEvent,
        eventPropGetter: (event) => ({
          style: {
            backgroundColor: "var(--calendar-event-bg, #eff6ff)",
            // Use var or specific color
            border: "1px solid var(--calendar-event-border, #bfdbfe)",
            color: "var(--calendar-event-text, #1e40af)",
            fontSize: "0.85rem",
            borderRadius: "4px"
          },
          className: "dark:bg-blue-900/30 dark:border-blue-800 dark:text-blue-200"
        })
      })
    }), /* @__PURE__ */ jsx(CreateClassModal, {
      isOpen: isCreateOpen,
      onClose: () => setIsCreateOpen(false),
      onSuccess: handleCreateSuccess,
      tenantId: tenant?.id,
      locations,
      instructors
    }), /* @__PURE__ */ jsx(ClassDetailModal, {
      isOpen: isDetailOpen,
      onClose: () => setIsDetailOpen(false),
      classEvent: selectedClass,
      onRecordingAdded: handleRecordingAdded,
      onRecordingDeleted: handleRecordingDeleted,
      canAttachRecording: features?.has("vod"),
      currentUserMemberId: me?.member?.id,
      userRoles: me?.roles,
      tenantSlug: tenant?.slug,
      onSubRequested: handleSubRequested,
      onBookRequested: () => {
        setIsDetailOpen(false);
        setIsBookingOpen(true);
      }
    }), /* @__PURE__ */ jsx(BookingModal, {
      isOpen: isBookingOpen,
      onClose: () => setIsBookingOpen(false),
      classEvent: selectedClass,
      family: family || []
    })]
  });
});
const route36 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_schedule,
  loader: loader$X
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_settings = UNSAFE_withComponentProps(function SettingsLayout() {
  const context = useOutletContext();
  return /* @__PURE__ */ jsx(Outlet, {
    context
  });
});
const route37 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings
}, Symbol.toStringTag, { value: "Module" }));
function Card$1({ children, className = "" }) {
  return /* @__PURE__ */ jsx("div", { className: `bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden ${className}`, children });
}
function CardHeader({ children, className = "" }) {
  return /* @__PURE__ */ jsx("div", { className: `px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 ${className}`, children });
}
function CardTitle({ children, className = "" }) {
  return /* @__PURE__ */ jsx("h3", { className: `font-semibold text-zinc-900 dark:text-zinc-100 ${className}`, children });
}
function CardDescription({ children, className = "" }) {
  return /* @__PURE__ */ jsx("p", { className: `text-sm text-zinc-500 dark:text-zinc-400 ${className}`, children });
}
function CardContent({ children, className = "" }) {
  return /* @__PURE__ */ jsx("div", { className: `p-6 ${className}`, children });
}
const studio_$slug_settings_integrations = UNSAFE_withComponentProps(function IntegrationsPage() {
  const {
    slug
  } = useParams();
  const {
    tenant
  } = useOutletContext() || {};
  const [endpoints, setEndpoints] = useState([]);
  const [loadingDev, setLoadingDev] = useState(true);
  const [createUrl, setCreateUrl] = useState("");
  const [createEvents, setCreateEvents] = useState("booking.created, order.completed");
  const [isCreating, setIsCreating] = useState(false);
  const [credentials, setCredentials] = useState(null);
  const [saving, setSaving] = useState(false);
  const [twilioForm, setTwilioForm] = useState({
    accountSid: "",
    authToken: "",
    fromNumber: ""
  });
  const [resendForm, setResendForm] = useState({
    apiKey: ""
  });
  const [showOrderReader, setShowOrderReader] = useState(false);
  const [deleteWebhookId, setDeleteWebhookId] = useState(null);
  const [disconnectGoogle, setDisconnectGoogle] = useState(false);
  const [chatToggle, setChatToggle] = useState(null);
  const [pendingPaymentProvider, setPendingPaymentProvider] = useState(null);
  useEffect(() => {
    loadDevData();
  }, [slug]);
  const loadDevData = async () => {
    setLoadingDev(true);
    try {
      const token = window.Clerk?.session?.getToken ? await window.Clerk.session.getToken() : localStorage.getItem("token");
      const [webhooksData, credsData] = await Promise.all([apiRequest("/integrations/webhooks", token, {
        headers: {
          "X-Tenant-Slug": slug || ""
        }
      }), apiRequest("/integrations/credentials", token, {
        headers: {
          "X-Tenant-Slug": slug || ""
        }
      })]);
      setEndpoints(webhooksData.endpoints || []);
      setCredentials(credsData);
      setTwilioForm({
        accountSid: credsData.twilio?.accountSid || "",
        authToken: "",
        // Never return auth token
        fromNumber: credsData.twilio?.fromNumber || ""
      });
      setResendForm({
        apiKey: credsData.resend?.apiKey || ""
      });
    } catch (e) {
      console.error("Failed to load data", e);
    } finally {
      setLoadingDev(false);
    }
  };
  const updateIntegration = async (body) => {
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/studios/${tenant.id}/integrations`, token, {
        method: "PUT",
        headers: {
          "X-Tenant-Slug": slug || ""
        },
        body: JSON.stringify(body)
      });
      toast.success("Settings saved successfully.");
      window.location.reload();
    } catch (e) {
      toast.error(e.message || "Failed to save");
    }
  };
  const handleCreateWebhook = async () => {
    if (!createUrl) return;
    setIsCreating(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest("/integrations/webhooks", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug || ""
        },
        body: JSON.stringify({
          url: createUrl,
          events: createEvents.split(",").map((s) => s.trim()),
          description: "Manual created"
        })
      });
      setCreateUrl("");
      loadDevData();
    } catch (e) {
      console.error(e);
      toast.error("Failed to create webhook: " + e.message);
    } finally {
      setIsCreating(false);
    }
  };
  const handleDeleteWebhook = (id) => {
    setDeleteWebhookId(id);
  };
  const confirmDeleteWebhook = async () => {
    if (!deleteWebhookId) return;
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/integrations/webhooks/${deleteWebhookId}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug || ""
        }
      });
      setEndpoints(endpoints.filter((e) => e.id !== deleteWebhookId));
      toast.success("Webhook deleted");
    } catch (e) {
      console.error(e);
      toast.error("Failed to delete webhook: " + e.message);
    } finally {
      setDeleteWebhookId(null);
    }
  };
  if (!tenant) return /* @__PURE__ */ jsx("div", {
    className: "p-8",
    children: /* @__PURE__ */ jsx(Loader2, {
      className: "animate-spin"
    })
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-5xl pb-10",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Integrations"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Manage connections, payment providers, and developer tools."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "col-span-1 lg:col-span-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(CreditCard, {
              className: "h-5 w-5"
            }), " Payment Processing"]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${tenant.paymentProvider === "connect" && tenant.stripeAccountId ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
            children: tenant.paymentProvider === "connect" && tenant.stripeAccountId ? "Connected" : tenant.paymentProvider === "custom" ? "Custom Keys" : "Not Configured"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "mt-4 bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800 rounded p-4",
          children: [/* @__PURE__ */ jsxs("h4", {
            className: "flex items-center gap-2 text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",
            children: [/* @__PURE__ */ jsx(Shield, {
              className: "h-4 w-4"
            }), " Financial Privacy & Security"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs text-blue-800 dark:text-blue-200 space-y-2",
            children: [/* @__PURE__ */ jsxs("p", {
              children: [/* @__PURE__ */ jsx("strong", {
                children: "Your Money, Your Account:"
              }), " You retain full legal ownership of your Stripe account and funds. We cannot access your bank account or withdraw funds without your permission."]
            }), /* @__PURE__ */ jsxs("p", {
              children: [/* @__PURE__ */ jsx("strong", {
                children: "Limited Visibility:"
              }), " We only track transactions processed through this platform (e.g., class bookings). We do not access unrelated financial data from your Stripe account."]
            }), /* @__PURE__ */ jsxs("p", {
              children: [/* @__PURE__ */ jsx("strong", {
                children: "Bank-Grade Security:"
              }), " Sensitive financial data is stored securely by Stripe. We do not store credit card numbers or bank account details."]
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Mail, {
              className: "h-4 w-4"
            }), " Transactional Email (Resend)"]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${tenant.resendCredentials?.apiKey ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
            children: tenant.resendCredentials?.apiKey ? "Configured" : "Using Platform Default"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500 mb-3",
          children: "Provide your own Resend API Key to send transactional emails from your domain."
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: (e) => {
            e.preventDefault();
            updateIntegration({
              resendApiKey: new FormData(e.currentTarget).get("resendApiKey")
            });
          },
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsx("input", {
            name: "resendApiKey",
            type: "password",
            placeholder: "re_123...",
            className: "flex-1 text-sm border-zinc-300 rounded px-3 py-2"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",
            children: "Save Key"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Send, {
              className: "h-4 w-4"
            }), " Marketing Automation (Flodesk)"]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${credentials?.flodesk?.configured ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
            children: credentials?.flodesk?.configured ? "Configured" : "Not Configured"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500 mb-3",
          children: "Sync members and activity to Flodesk for email marketing."
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: async (e) => {
            e.preventDefault();
            try {
              const apiKey = new FormData(e.currentTarget).get("flodeskApiKey");
              const token = await window.Clerk?.session?.getToken();
              await apiRequest("/integrations/credentials", token, {
                method: "PATCH",
                headers: {
                  "X-Tenant-Slug": slug || ""
                },
                body: JSON.stringify({
                  flodesk: {
                    apiKey
                  }
                })
              });
              toast.success("Flodesk settings saved.");
              loadDevData();
            } catch (e2) {
              console.error(e2);
              toast.error("Failed to save Flodesk settings: " + e2.message);
            }
          },
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsx("input", {
            name: "flodeskApiKey",
            type: "password",
            placeholder: "Flodesk API Key",
            className: "flex-1 text-sm border-zinc-300 rounded px-3 py-2"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",
            children: "Save Key"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(MessageSquare, {
              className: "h-4 w-4"
            }), " SMS Service (Twilio)"]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${tenant.twilioCredentials?.accountSid ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
            children: tenant.twilioCredentials?.accountSid ? "Configured" : "Using Platform Default"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500 mb-3",
          children: "Connect your Twilio account for custom SMS notifications."
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: (e) => {
            e.preventDefault();
            const fd = new FormData(e.currentTarget);
            updateIntegration({
              twilioAccountSid: fd.get("twilioAccountSid"),
              twilioAuthToken: fd.get("twilioAuthToken"),
              twilioFromNumber: fd.get("twilioFromNumber")
            });
          },
          className: "space-y-3",
          children: [/* @__PURE__ */ jsx("input", {
            name: "twilioAccountSid",
            placeholder: "Account SID",
            className: "w-full text-sm border-zinc-300 rounded px-3 py-2"
          }), /* @__PURE__ */ jsx("input", {
            name: "twilioFromNumber",
            placeholder: "From Number (+1...)",
            className: "w-full text-sm border-zinc-300 rounded px-3 py-2"
          }), /* @__PURE__ */ jsx("input", {
            name: "twilioAuthToken",
            type: "password",
            placeholder: "Auth Token",
            className: "w-full text-sm border-zinc-300 rounded px-3 py-2"
          }), /* @__PURE__ */ jsx("div", {
            className: "flex justify-end",
            children: /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",
              children: "Save Twilio"
            })
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between mb-4",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(MessageSquare, {
              className: "h-4 w-4"
            }), " Customer Support Chat"]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${tenant.settings?.chatEnabled !== false ? "bg-green-100 text-green-700" : "bg-zinc-100 text-zinc-500"}`,
            children: tenant.settings?.chatEnabled !== false ? "Enabled" : "Disabled"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500 mb-3",
          children: "Allow students to chat with you directly from your website and portal."
        }), /* @__PURE__ */ jsx("div", {
          className: "flex items-center gap-4",
          children: /* @__PURE__ */ jsx("button", {
            onClick: () => {
              const isEnabled = tenant.settings?.chatEnabled !== false;
              setChatToggle(!isEnabled);
            },
            className: `px-3 py-2 text-xs font-medium rounded border ${tenant.settings?.chatEnabled !== false ? "bg-zinc-50 border-zinc-300 text-zinc-700" : "bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,
            children: tenant.settings?.chatEnabled !== false ? "Disable Chat" : "Enable Chat"
          })
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2 mb-2",
        children: [/* @__PURE__ */ jsx(Terminal, {
          className: "text-zinc-900 dark:text-zinc-100"
        }), /* @__PURE__ */ jsx("h2", {
          className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Developer Tools"
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsx(CardTitle, {
            className: "flex items-center gap-2",
            children: "Outgoing Webhooks"
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "Receive real-time JSON payloads when events happen in your studio."
          })]
        }), /* @__PURE__ */ jsxs(CardContent, {
          className: "space-y-6",
          children: [loadingDev ? /* @__PURE__ */ jsx("div", {
            className: "flex items-center justify-center p-8",
            children: /* @__PURE__ */ jsx(Loader2, {
              className: "h-6 w-6 animate-spin text-muted-foreground"
            })
          }) : /* @__PURE__ */ jsxs("div", {
            className: "border rounded-md divide-y",
            children: [endpoints.length === 0 && /* @__PURE__ */ jsx("div", {
              className: "p-8 text-center text-muted-foreground text-sm",
              children: "No webhooks configured."
            }), endpoints.map((ep) => /* @__PURE__ */ jsxs("div", {
              className: "p-4 flex items-center justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "grid gap-1",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-mono text-sm font-medium",
                  children: ep.url
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-muted-foreground",
                  children: Array.isArray(ep.events) ? ep.events.join(", ") : ep.events
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-4",
                children: [/* @__PURE__ */ jsxs("code", {
                  className: "text-[10px] bg-muted px-2 py-1 rounded text-muted-foreground hidden sm:inline-block",
                  children: [ep.secret.slice(0, 8), "..."]
                }), /* @__PURE__ */ jsx("button", {
                  className: "p-2 hover:bg-red-50 text-red-600 rounded",
                  onClick: () => handleDeleteWebhook(ep.id),
                  children: /* @__PURE__ */ jsx(Trash2, {
                    className: "h-4 w-4"
                  })
                })]
              })]
            }, ep.id))]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-4 border rounded-md bg-muted/20 bg-zinc-50 dark:bg-zinc-900 space-y-4",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-medium text-sm",
              children: "Add New Endpoint"
            }), /* @__PURE__ */ jsxs("div", {
              className: "grid gap-4 md:grid-cols-2",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "space-y-2",
                children: [/* @__PURE__ */ jsx("label", {
                  className: "text-sm font-medium",
                  children: "Endpoint URL"
                }), /* @__PURE__ */ jsx("input", {
                  className: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                  placeholder: "https://hooks.zapier.com/...",
                  value: createUrl,
                  onChange: (e) => setCreateUrl(e.target.value)
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "space-y-2",
                children: [/* @__PURE__ */ jsx("label", {
                  className: "text-sm font-medium",
                  children: "Events (comma separated)"
                }), /* @__PURE__ */ jsx("input", {
                  className: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                  value: createEvents,
                  onChange: (e) => setCreateEvents(e.target.value)
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-[10px] text-muted-foreground",
                  children: "Available: booking.created, order.completed, student.created"
                })]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "flex justify-end",
              children: /* @__PURE__ */ jsxs("button", {
                className: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary bg-zinc-900 text-white hover:bg-zinc-800 h-10 px-4 py-2",
                onClick: handleCreateWebhook,
                disabled: !createUrl || isCreating,
                children: [isCreating && /* @__PURE__ */ jsx(Loader2, {
                  className: "mr-2 h-4 w-4 animate-spin"
                }), "Add Webhook"]
              })
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsxs(CardTitle, {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsxs("svg", {
              role: "img",
              viewBox: "0 0 24 24",
              className: "h-5 w-5 fill-current",
              children: [/* @__PURE__ */ jsx("path", {
                d: "M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z",
                fill: "#fff"
              }), /* @__PURE__ */ jsx("path", {
                d: "M12.48 4.75c-1.39 0-2.68.74-3.35 1.83l-2.03 3.32h5.38V4.75zm-6.26 2.06c-.53 1.1-.82 2.34-.82 3.65 0 1.25.26 2.43.74 3.5l2.03-3.32L6.22 6.81zm-.74 7.15c.67 1.09 1.96 1.83 3.35 1.83h2.69v-4.38H6.15l-.67 2.55zm5.71 1.83c1.39 0 2.68-.74 3.35-1.83l2.03-3.32H11.2v4.38v.77zm6.26-2.06c.53-1.1.82-2.34.82-3.65 0-1.25-.26-2.43-.74-3.5l-2.03 3.32 2.7 3.83zm.74-7.15c-.67-1.09-1.96-1.83-3.35-1.83h-2.69v4.38h5.38l.66-2.55z",
                fill: "#4285F4"
              })]
            }), "Google Calendar"]
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "Sync your classes and appointments to your primary Google Calendar."
          })]
        }), /* @__PURE__ */ jsx(CardContent, {
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between",
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-sm",
              children: tenant.googleCalendarCredentials ? /* @__PURE__ */ jsxs("div", {
                className: "flex items-center text-green-600 gap-2",
                children: [/* @__PURE__ */ jsx(CheckCircle, {
                  className: "h-4 w-4"
                }), /* @__PURE__ */ jsx("span", {
                  children: "Connected"
                })]
              }) : /* @__PURE__ */ jsx("div", {
                className: "text-muted-foreground",
                children: "Not connected"
              })
            }), /* @__PURE__ */ jsx("div", {
              children: tenant.googleCalendarCredentials ? /* @__PURE__ */ jsx("button", {
                className: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",
                onClick: () => setDisconnectGoogle(true),
                children: "Disconnect"
              }) : /* @__PURE__ */ jsx("a", {
                href: `${"https://studio-platform-api.slichti.workers.dev"}/studios/google/connect?tenantId=${tenant.id}`,
                className: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2",
                children: "Connect Google Calendar"
              })
            })]
          })
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsx(CardTitle, {
            children: "Studio API Credentials"
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "Use these credentials to authenticate API requests."
          })]
        }), /* @__PURE__ */ jsx(CardContent, {
          children: /* @__PURE__ */ jsx("div", {
            className: "space-y-4",
            children: /* @__PURE__ */ jsxs("div", {
              className: "grid gap-2",
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-sm font-medium",
                children: "Studio ID (Tenant ID)"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2",
                children: [/* @__PURE__ */ jsx("input", {
                  readOnly: true,
                  value: tenant.id || "Loading...",
                  className: "font-mono bg-muted flex h-10 w-full rounded-md border border-input px-3"
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => navigator.clipboard.writeText(tenant.id),
                  className: "border rounded px-3 text-sm hover:bg-gray-100 dark:hover:bg-zinc-800",
                  children: "Copy"
                })]
              })]
            })
          })
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!deleteWebhookId,
      onClose: () => setDeleteWebhookId(null),
      onConfirm: confirmDeleteWebhook,
      title: "Delete Webhook",
      message: "Are you sure you want to delete this webhook?",
      isDestructive: true,
      confirmText: "Delete"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: disconnectGoogle,
      onClose: () => setDisconnectGoogle(false),
      onConfirm: async () => {
        try {
          const token = window.Clerk?.session?.getToken ? await window.Clerk.session.getToken() : localStorage.getItem("token");
          await apiRequest(`/studios/${tenant.id}/integrations/google`, token, {
            method: "DELETE"
          });
          toast.success("Disconnected");
          window.location.reload();
        } catch (e) {
          console.error(e);
          toast.error("Failed to disconnect");
        } finally {
          setDisconnectGoogle(false);
        }
      },
      title: "Disconnect Google Calendar",
      message: "Are you sure you want to disconnect Google Calendar? Classes will no longer sync.",
      isDestructive: true,
      confirmText: "Disconnect"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: chatToggle !== null,
      onClose: () => setChatToggle(null),
      onConfirm: () => {
        if (chatToggle !== null) {
          updateIntegration({
            chatEnabled: chatToggle
          });
          setChatToggle(null);
        }
      },
      title: chatToggle ? "Enable Chat Widget" : "Disable Chat Widget",
      message: chatToggle ? "Enable chat widget for your studio? This will verify connectivity to your configured support channels." : "Disable chat widget for your studio?",
      confirmText: chatToggle ? "Enable" : "Disable"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!pendingPaymentProvider,
      onClose: () => setPendingPaymentProvider(null),
      onConfirm: () => {
        if (pendingPaymentProvider) {
          updateIntegration({
            paymentProvider: pendingPaymentProvider
          });
          setPendingPaymentProvider(null);
        }
      },
      title: "Switch Payment Provider",
      message: `Switch to ${pendingPaymentProvider === "connect" ? "Platform Managed" : "Self Managed"} payments?`,
      confirmText: "Switch"
    })]
  });
});
const route38 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_integrations
}, Symbol.toStringTag, { value: "Module" }));
const loader$W = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  try {
    const locationsData = await apiRequest("/locations", token, {
      headers: {
        "X-Tenant-Slug": slug || ""
      }
    });
    return {
      locations: locationsData || []
    };
  } catch (e) {
    console.error("Locations Loader Error", e);
    return {
      locations: []
    };
  }
};
const action$e = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "create" || intent === "update") {
    const uploadFile = formData.get("file");
    if (uploadFile && uploadFile instanceof File) {
      const uploadForm = new FormData();
      uploadForm.append("file", uploadFile);
    }
    const id = formData.get("id");
    const payload = {
      name: formData.get("name"),
      address: formData.get("address"),
      timezone: formData.get("timezone"),
      isPrimary: formData.get("isPrimary") === "true",
      isActive: formData.get("isActive") !== "false",
      settings: {
        phone: formData.get("phone"),
        hours: formData.get("hours")
      }
    };
    await apiRequest(id ? `/locations/${id}` : "/locations", token, {
      method: id ? "PATCH" : "POST",
      headers: {
        "X-Tenant-Slug": slug || ""
      },
      body: JSON.stringify(payload)
    });
  }
  if (intent === "delete") {
    const id = formData.get("id");
    await apiRequest(`/locations/${id}`, token, {
      method: "DELETE",
      headers: {
        "X-Tenant-Slug": slug || ""
      }
    });
  }
  if (intent === "set-primary") {
    const id = formData.get("id");
    await apiRequest(`/locations/${id}/set-primary`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": slug || ""
      }
    });
  }
  return {
    success: true
  };
};
const studio_$slug_settings_locations = UNSAFE_withComponentProps(function LocationsSettings() {
  const {
    locations
  } = useLoaderData();
  const submit = useSubmit();
  const [isEditing, setIsEditing] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [confirmDeleteId, setConfirmDeleteId] = useState(null);
  const handleDeleteClick = (id) => {
    setConfirmDeleteId(id);
  };
  const confirmDelete = () => {
    if (confirmDeleteId) {
      submit({
        intent: "delete",
        id: confirmDeleteId
      }, {
        method: "post"
      });
      setConfirmDeleteId(null);
      toast.success("Location deleted");
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsx("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-zinc-900 rounded-lg text-white",
            children: /* @__PURE__ */ jsx(MapPin, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-xl font-bold text-zinc-900",
              children: "Locations"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-sm text-zinc-500",
              children: [locations.length, " location", locations.length !== 1 ? "s" : ""]
            })]
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setIsCreating(true),
          className: "px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 16
          }), " Add Location"]
        })]
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-y-auto p-6",
      children: locations.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "text-center py-20 text-zinc-500",
        children: [/* @__PURE__ */ jsx(Building, {
          size: 48,
          className: "mx-auto mb-4 opacity-50"
        }), /* @__PURE__ */ jsx("p", {
          children: "No locations configured"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setIsCreating(true),
          className: "mt-4 text-sm text-zinc-900 underline",
          children: "Add your first location"
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: locations.map((location) => /* @__PURE__ */ jsx("div", {
          className: `bg-white rounded-xl border ${location.isPrimary ? "border-amber-300 ring-2 ring-amber-100" : "border-zinc-200"} p-5`,
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-start justify-between",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-start gap-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: `p-3 rounded-xl ${location.isPrimary ? "bg-amber-100" : "bg-zinc-100"}`,
                children: /* @__PURE__ */ jsx(MapPin, {
                  size: 24,
                  className: location.isPrimary ? "text-amber-600" : "text-zinc-500"
                })
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-2",
                  children: [/* @__PURE__ */ jsx("h3", {
                    className: "font-bold text-zinc-900",
                    children: location.name
                  }), location.isPrimary && /* @__PURE__ */ jsxs("span", {
                    className: "px-2 py-0.5 bg-amber-100 text-amber-700 rounded-full text-xs font-medium flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Star, {
                      size: 10
                    }), " Primary"]
                  }), !location.isActive && /* @__PURE__ */ jsx("span", {
                    className: "px-2 py-0.5 bg-zinc-100 text-zinc-500 rounded-full text-xs font-medium",
                    children: "Inactive"
                  })]
                }), location.address && /* @__PURE__ */ jsx("p", {
                  className: "text-sm text-zinc-500 mt-1",
                  children: location.address
                }), /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-4 mt-2 text-xs text-zinc-400",
                  children: [location.timezone && /* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Clock, {
                      size: 12
                    }), " ", location.timezone]
                  }), location.settings?.phone && /* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Phone, {
                      size: 12
                    }), " ", location.settings.phone]
                  })]
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2",
              children: [!location.isPrimary && /* @__PURE__ */ jsxs(Form, {
                method: "post",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "intent",
                  value: "set-primary"
                }), /* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "id",
                  value: location.id
                }), /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  className: "p-2 hover:bg-amber-50 rounded-lg text-amber-600",
                  title: "Set as primary",
                  children: /* @__PURE__ */ jsx(Star, {
                    size: 16
                  })
                })]
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => setIsEditing(location),
                className: "p-2 hover:bg-zinc-100 rounded-lg",
                children: /* @__PURE__ */ jsx(Edit, {
                  size: 16
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleDeleteClick(location.id),
                className: "p-2 hover:bg-red-50 rounded-lg text-red-500",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 16
                })
              })]
            })]
          })
        }, location.id))
      })
    }), (isEditing || isCreating) && /* @__PURE__ */ jsx(LocationModal, {
      location: isEditing,
      onClose: () => {
        setIsEditing(null);
        setIsCreating(false);
      },
      onSave: (data) => {
        const formData = new FormData();
        formData.append("intent", isEditing ? "update" : "create");
        if (isEditing) formData.append("id", isEditing.id);
        Object.entries(data).forEach(([key, value]) => {
          formData.append(key, String(value));
        });
        submit(formData, {
          method: "post"
        });
        setIsEditing(null);
        setIsCreating(false);
      }
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmDeleteId,
      onClose: () => setConfirmDeleteId(null),
      onConfirm: confirmDelete,
      title: "Delete Location",
      message: "Are you sure you want to delete this location? This action cannot be undone.",
      confirmText: "Delete",
      isDestructive: true
    })]
  });
});
function LocationModal({
  location,
  onClose,
  onSave
}) {
  const [name, setName] = useState(location?.name || "");
  const [address, setAddress] = useState(location?.address || "");
  const [timezone, setTimezone] = useState(location?.timezone || "UTC");
  const [phone, setPhone] = useState(location?.settings?.phone || "");
  const [hours, setHours] = useState(location?.settings?.hours || "");
  const [isPrimary, setIsPrimary] = useState(location?.isPrimary || false);
  const [isActive, setIsActive] = useState(location?.isActive !== false);
  const handleSubmit = (e) => {
    e.preventDefault();
    onSave({
      name,
      address,
      timezone,
      phone,
      hours,
      isPrimary,
      isActive
    });
  };
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-md w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: location ? "Edit Location" : "New Location"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSubmit,
        className: "p-6 space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Name *"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            required: true,
            value: name,
            onChange: (e) => setName(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
            placeholder: "Main Studio"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Address"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            value: address,
            onChange: (e) => setAddress(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
            placeholder: "123 Main St, City, State"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Timezone"
            }), /* @__PURE__ */ jsxs("select", {
              value: timezone,
              onChange: (e) => setTimezone(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg",
              children: [/* @__PURE__ */ jsx("option", {
                value: "UTC",
                children: "UTC"
              }), /* @__PURE__ */ jsx("option", {
                value: "America/New_York",
                children: "Eastern"
              }), /* @__PURE__ */ jsx("option", {
                value: "America/Chicago",
                children: "Central"
              }), /* @__PURE__ */ jsx("option", {
                value: "America/Denver",
                children: "Mountain"
              }), /* @__PURE__ */ jsx("option", {
                value: "America/Los_Angeles",
                children: "Pacific"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Phone"
            }), /* @__PURE__ */ jsx("input", {
              type: "tel",
              value: phone,
              onChange: (e) => setPhone(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4",
          children: [/* @__PURE__ */ jsxs("label", {
            className: "flex items-center gap-2 text-sm",
            children: [/* @__PURE__ */ jsx("input", {
              type: "checkbox",
              checked: isPrimary,
              onChange: (e) => setIsPrimary(e.target.checked),
              className: "w-4 h-4"
            }), "Primary location"]
          }), /* @__PURE__ */ jsxs("label", {
            className: "flex items-center gap-2 text-sm",
            children: [/* @__PURE__ */ jsx("input", {
              type: "checkbox",
              checked: isActive,
              onChange: (e) => setIsActive(e.target.checked),
              className: "w-4 h-4"
            }), "Active"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: onClose,
            className: "px-4 py-2 text-sm font-medium text-zinc-500",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800",
            children: "Save"
          })]
        })]
      })]
    })
  });
}
const route39 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$e,
  default: studio_$slug_settings_locations,
  loader: loader$W
}, Symbol.toStringTag, { value: "Module" }));
const loader$V = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const assets = await apiRequest("/video-management/branding", token);
    return {
      assets
    };
  } catch {
    return {
      assets: []
    };
  }
};
const studio_$slug_settings_branding = UNSAFE_withComponentProps(function StudioBranding2() {
  const {
    tenant
  } = useOutletContext();
  const {
    assets: initialAssets
  } = useLoaderData();
  const revalidator = useRevalidator();
  const [assets, setAssets] = useState(initialAssets);
  const [brandingConfirmId, setBrandingConfirmId] = useState(null);
  const [primaryColor, setPrimaryColor] = useState(tenant.branding?.primaryColor || "#4f46e5");
  const [logoUrl, setLogoUrl] = useState(tenant.branding?.logoUrl || "");
  const [replyTo, setReplyTo] = useState(tenant.branding?.emailReplyTo || "");
  const [footerText, setFooterText] = useState(tenant.branding?.emailFooterText || "");
  const [hidePoweredBy, setHidePoweredBy] = useState(tenant.branding?.hidePoweredBy || false);
  const [loading, setLoading] = useState(false);
  const [uploading, setUploading] = useState(null);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const handleSaveGeneral = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    setSuccess(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/tenant/settings`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          branding: {
            primaryColor,
            logoUrl,
            emailReplyTo: replyTo,
            emailFooterText: footerText,
            hidePoweredBy
          }
        })
      });
      setSuccess("Branding saved successfully.");
      revalidator.revalidate();
    } catch (e2) {
      setError(e2.message || "Failed to save branding.");
    } finally {
      setLoading(false);
    }
  };
  const handleLogoUpload = async (file) => {
    setUploading("logo");
    setError(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      const formData = new FormData();
      formData.append("file", file);
      formData.append("title", `Logo - ${file.name}`);
      const res = await apiRequest("/uploads/r2-image", token, {
        method: "POST",
        body: formData
      });
      setLogoUrl(res.url);
      setSuccess("Logo uploaded. Don't forget to save settings.");
    } catch (e) {
      console.error(e);
      setError("Logo upload failed: " + e.message);
    } finally {
      setUploading(null);
    }
  };
  const handleUpload = async (file, type) => {
    setUploading(type);
    setError(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      const {
        uploadUrl,
        uid
      } = await apiRequest("/video-management/branding/upload-url", token, {
        method: "POST",
        body: JSON.stringify({
          type
        })
      });
      const formData = new FormData();
      formData.append("file", file);
      const cfUpload = await fetch(uploadUrl, {
        method: "POST",
        body: formData
      });
      if (!cfUpload.ok) throw new Error("Upload to video server failed");
      await apiRequest("/video-management/branding", token, {
        method: "POST",
        body: JSON.stringify({
          type,
          title: file.name,
          cloudflareStreamId: uid
        })
      });
      const updated = await apiRequest("/video-management/branding", token);
      setAssets(updated);
      setSuccess(`Uploaded ${type} video successfully.`);
    } catch (e) {
      console.error(e);
      setError("Upload failed: " + e.message);
    } finally {
      setUploading(null);
    }
  };
  const handleActivate = async (id) => {
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/video-management/branding/${id}/activate`, token, {
        method: "PATCH"
      });
      setAssets(assets.map((a) => {
        if (a.id === id) return {
          ...a,
          active: true
        };
        const target = assets.find((x) => x.id === id);
        if (target && a.type === target.type && a.id !== id) return {
          ...a,
          active: false
        };
        return a;
      }));
    } catch (e) {
      setError("Failed to activate asset");
    }
  };
  const handleDelete = (id) => {
    setBrandingConfirmId(id);
  };
  const confirmDelete = async () => {
    if (!brandingConfirmId) return;
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/video-management/branding/${brandingConfirmId}`, token, {
        method: "DELETE"
      });
      setAssets(assets.filter((a) => a.id !== brandingConfirmId));
      setBrandingConfirmId(null);
      toast.success("Asset deleted successfully");
    } catch (e) {
      setError("Failed to delete asset");
    }
  };
  const intros = assets.filter((a) => a.type === "intro");
  const outros = assets.filter((a) => a.type === "outro");
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-10 space-y-8",
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",
        children: "Customize Branding"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Manage your studio's look, feel, and video assets."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
      children: [error && /* @__PURE__ */ jsx("div", {
        className: "bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded mb-4 text-sm",
        children: error
      }), success && /* @__PURE__ */ jsx("div", {
        className: "bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 p-3 rounded mb-4 text-sm",
        children: success
      }), /* @__PURE__ */ jsx("h2", {
        className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-6",
        children: "General Appearance"
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSaveGeneral,
        className: "flex flex-col gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-6",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",
              children: "Studio Logo"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-start gap-4",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "h-24 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 flex items-center justify-center overflow-hidden relative group",
                children: [logoUrl ? /* @__PURE__ */ jsx("img", {
                  src: logoUrl,
                  alt: "Studio Logo",
                  className: "object-cover w-full h-full"
                }) : /* @__PURE__ */ jsx(Image$1, {
                  className: "text-zinc-300",
                  size: 32
                }), /* @__PURE__ */ jsxs("label", {
                  className: "absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity text-white text-xs font-medium",
                  children: ["Change", /* @__PURE__ */ jsx("input", {
                    type: "file",
                    className: "hidden",
                    accept: "image/*",
                    onChange: (e) => e.target.files?.[0] && handleLogoUpload(e.target.files[0]),
                    disabled: uploading === "logo"
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-1 text-sm text-zinc-500",
                children: [/* @__PURE__ */ jsx("p", {
                  children: "Upload a square image for best results. Used in emails and header."
                }), uploading === "logo" && /* @__PURE__ */ jsx("p", {
                  className: "text-blue-600 animate-pulse mt-1",
                  children: "Uploading..."
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",
              children: "Primary Brand Color"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-3",
              children: [/* @__PURE__ */ jsx("input", {
                type: "color",
                value: primaryColor,
                onChange: (e) => setPrimaryColor(e.target.value),
                className: "w-10 h-10 p-0 border-none rounded cursor-pointer bg-transparent"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                value: primaryColor,
                onChange: (e) => setPrimaryColor(e.target.value),
                className: "flex-1 bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-blue-500 outline-none",
                placeholder: "#000000"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "border-t border-zinc-200 dark:border-zinc-800 pt-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-base font-semibold text-zinc-900 dark:text-zinc-100 mb-4",
            children: "Platform Branding"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-start gap-3",
            children: [/* @__PURE__ */ jsx("input", {
              id: "hidePoweredBy",
              type: "checkbox",
              checked: hidePoweredBy,
              onChange: (e) => setHidePoweredBy(e.target.checked),
              disabled: tenant.tier?.toLowerCase() !== "scale",
              className: "h-4 w-4 mt-0.5 rounded border-zinc-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-sm",
              children: [/* @__PURE__ */ jsx("label", {
                htmlFor: "hidePoweredBy",
                className: `font-medium ${tenant.tier?.toLowerCase() !== "scale" ? "text-zinc-400 dark:text-zinc-500" : "text-zinc-900 dark:text-zinc-100"}`,
                children: 'Hide "Powered by StudioPlatform" badge'
              }), /* @__PURE__ */ jsxs("p", {
                className: "text-zinc-500 dark:text-zinc-400 text-xs mt-0.5",
                children: ["Remove the branding badge from your site footer.", tenant.tier?.toLowerCase() !== "scale" && /* @__PURE__ */ jsx("span", {
                  className: "text-pink-600 dark:text-pink-400 ml-1 font-medium",
                  children: "Requires Scale tier."
                })]
              })]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-2",
          children: /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: `bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-5 py-2.5 rounded-md font-medium text-sm hover:opacity-90 transition-opacity ${loading ? "opacity-70 cursor-not-allowed" : ""}`,
            children: loading ? "Saving..." : "Save General Settings"
          })
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Video Branding"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Intros and Outros to automatically stitch to your VOD uploads."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 lg:grid-cols-2 gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mb-4",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-zinc-900",
              children: "Intro Videos"
            }), /* @__PURE__ */ jsxs("label", {
              className: "cursor-pointer bg-zinc-100 hover:bg-zinc-200 text-zinc-800 px-3 py-1.5 rounded-md text-xs font-medium transition flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(Upload, {
                size: 14
              }), uploading === "intro" ? "Uploading..." : "Upload Intro", /* @__PURE__ */ jsx("input", {
                type: "file",
                accept: "video/*",
                className: "hidden",
                onChange: (e) => e.target.files?.[0] && handleUpload(e.target.files[0], "intro"),
                disabled: !!uploading
              })]
            })]
          }), /* @__PURE__ */ jsx(AssetList, {
            assets: intros,
            onActivate: handleActivate,
            onDelete: handleDelete,
            emptyMessage: "No intros uploaded. Upload a short video to play before your classes."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mb-4",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-zinc-900",
              children: "Outro Videos"
            }), /* @__PURE__ */ jsxs("label", {
              className: "cursor-pointer bg-zinc-100 hover:bg-zinc-200 text-zinc-800 px-3 py-1.5 rounded-md text-xs font-medium transition flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(Upload, {
                size: 14
              }), uploading === "outro" ? "Uploading..." : "Upload Outro", /* @__PURE__ */ jsx("input", {
                type: "file",
                accept: "video/*",
                className: "hidden",
                onChange: (e) => e.target.files?.[0] && handleUpload(e.target.files[0], "outro"),
                disabled: !!uploading
              })]
            })]
          }), /* @__PURE__ */ jsx(AssetList, {
            assets: outros,
            onActivate: handleActivate,
            onDelete: handleDelete,
            emptyMessage: "No outros uploaded. Upload a short video to play after your classes."
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!brandingConfirmId,
      onClose: () => setBrandingConfirmId(null),
      onConfirm: confirmDelete,
      title: "Delete Branding Asset",
      message: "Are you sure you want to delete this branding asset? This action cannot be undone.",
      confirmText: "Delete",
      isDestructive: true
    })]
  });
});
function AssetList({
  assets,
  onActivate,
  onDelete,
  emptyMessage
}) {
  if (assets.length === 0) {
    return /* @__PURE__ */ jsx("div", {
      className: "text-zinc-400 text-sm py-8 text-center bg-zinc-50 rounded-lg border border-dashed border-zinc-200 px-10",
      children: emptyMessage
    });
  }
  return /* @__PURE__ */ jsx("div", {
    className: "space-y-3",
    children: assets.map((asset) => /* @__PURE__ */ jsxs("div", {
      className: `flex items-center justify-between p-3 rounded-lg border ${asset.active ? "border-indigo-200 bg-indigo-50/50" : "border-zinc-200 hover:bg-zinc-50"} transition`,
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "h-8 w-8 bg-zinc-200 rounded flex items-center justify-center text-zinc-400",
          children: /* @__PURE__ */ jsx(Video, {
            size: 14
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium text-zinc-900",
            children: asset.title
          }), asset.active && /* @__PURE__ */ jsxs("div", {
            className: "text-xs text-indigo-600 font-medium flex items-center gap-1",
            children: [/* @__PURE__ */ jsx(CheckCircle, {
              size: 10
            }), " Active"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [!asset.active && /* @__PURE__ */ jsx("button", {
          onClick: () => onActivate(asset.id),
          className: "text-xs text-zinc-500 hover:text-indigo-600 px-2 py-1 rounded hover:bg-indigo-50 transition",
          children: "Set Active"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => onDelete(asset.id),
          className: "p-1.5 text-zinc-400 hover:text-red-600 rounded transition",
          children: /* @__PURE__ */ jsx(Trash2, {
            size: 14
          })
        })]
      })]
    }, asset.id))
  });
}
const route40 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_branding,
  loader: loader$V
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_settings_hardware = UNSAFE_withComponentProps(function StudioHardwareSettings() {
  const {
    tenant
  } = useOutletContext();
  const {
    getToken
  } = useAuth();
  const [skus, setSkus] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [selectedSku, setSelectedSku] = useState(null);
  const [isOrderModalOpen, setIsOrderModalOpen] = useState(false);
  const [shipping, setShipping] = useState({
    name: tenant.name,
    line1: tenant.address || "",
    city: "",
    state: "",
    postal_code: "",
    country: "US",
    phone: ""
  });
  const [isOrdering, setIsOrdering] = useState(false);
  useEffect(() => {
    const fetchSkus = async () => {
      const token = await getToken();
      const url = "https://studio-platform-api.slichti.workers.dev";
      try {
        const res = await apiRequest(`${url}/platform/hardware/skus`, token);
        if (res && res.data) {
          setSkus(res.data);
        }
      } catch (e) {
        console.error("Failed to fetch SKUs", e);
      } finally {
        setIsLoading(false);
      }
    };
    fetchSkus();
  }, [getToken]);
  const handleOrder = async () => {
    if (!selectedSku) return;
    setIsOrdering(true);
    const token = await getToken();
    const payload = {
      skuId: selectedSku.id,
      quantity: 1,
      shipping: {
        name: shipping.name,
        address: {
          line1: shipping.line1,
          city: shipping.city,
          state: shipping.state,
          postal_code: shipping.postal_code,
          country: shipping.country
        },
        phone: shipping.phone
      }
    };
    const res = await apiRequest(`${"https://studio-platform-api.slichti.workers.dev"}/platform/hardware/orders`, token, {
      method: "POST",
      body: JSON.stringify(payload)
    });
    setIsOrdering(false);
    if (res && !res.error) {
      toast.success("Order Placed Successfully! You will receive confirmation shortly.");
      setIsOrderModalOpen(false);
    } else {
      toast.error(`Order Failed: ${res?.error || "Unknown error"}`);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl text-zinc-900 dark:text-zinc-100",
    children: [/* @__PURE__ */ jsx("h1", {
      className: "text-2xl font-bold mb-6",
      children: "Hardware & Terminals"
    }), /* @__PURE__ */ jsx("p", {
      className: "text-zinc-500 mb-8 max-w-2xl",
      children: "Purchase Stripe Terminal readers to accept in-person payments fully integrated with your studio."
    }), isOrderModalOpen && selectedSku && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 overflow-y-auto",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-200 dark:border-zinc-800 w-full max-w-lg p-6 my-8",
        children: [/* @__PURE__ */ jsxs("h3", {
          className: "text-lg font-bold mb-4",
          children: ["Order ", selectedSku.product?.name || "Reader"]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "p-4 bg-zinc-50 dark:bg-zinc-800 rounded-lg flex items-center gap-4",
            children: [selectedSku.image && /* @__PURE__ */ jsx("img", {
              src: selectedSku.image,
              alt: "",
              className: "w-12 h-12 object-contain"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium",
                children: selectedSku.product?.name
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-sm text-zinc-500",
                children: ["$", (selectedSku.price.unit_amount / 100).toFixed(2)]
              })]
            })]
          }), /* @__PURE__ */ jsx("h4", {
            className: "font-medium border-b dark:border-zinc-700 pb-2",
            children: "Shipping Address"
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "col-span-2",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "Recipient Name"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.name,
                onChange: (e) => setShipping({
                  ...shipping,
                  name: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "col-span-2",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "Address Line 1"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.line1,
                onChange: (e) => setShipping({
                  ...shipping,
                  line1: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "City"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.city,
                onChange: (e) => setShipping({
                  ...shipping,
                  city: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "State"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.state,
                onChange: (e) => setShipping({
                  ...shipping,
                  state: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "Zip Code"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.postal_code,
                onChange: (e) => setShipping({
                  ...shipping,
                  postal_code: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "Country"
              }), /* @__PURE__ */ jsxs("select", {
                value: shipping.country,
                onChange: (e) => setShipping({
                  ...shipping,
                  country: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm",
                children: [/* @__PURE__ */ jsx("option", {
                  value: "US",
                  children: "United States"
                }), /* @__PURE__ */ jsx("option", {
                  value: "CA",
                  children: "Canada"
                }), /* @__PURE__ */ jsx("option", {
                  value: "GB",
                  children: "United Kingdom"
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "col-span-2",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium mb-1",
                children: "Phone"
              }), /* @__PURE__ */ jsx("input", {
                value: shipping.phone,
                onChange: (e) => setShipping({
                  ...shipping,
                  phone: e.target.value
                }),
                className: "w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2 text-sm"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-3 mt-6 justify-end",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setIsOrderModalOpen(false),
            className: "px-4 py-2 text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleOrder,
            disabled: isOrdering,
            className: "px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",
            children: isOrdering ? "Placing Order..." : "Confirm Purchase"
          })]
        })]
      })
    }), isLoading ? /* @__PURE__ */ jsx("div", {
      children: "Loading hardware..."
    }) : skus.length === 0 ? /* @__PURE__ */ jsx("div", {
      className: "p-8 bg-zinc-50 dark:bg-zinc-900 rounded-lg text-center text-zinc-500",
      children: "No hardware available for purchase at this time."
    }) : /* @__PURE__ */ jsx("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-6",
      children: skus.map((sku) => /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm flex flex-col",
        children: [/* @__PURE__ */ jsx("div", {
          className: "aspect-video bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center p-4",
          children: sku.image ? /* @__PURE__ */ jsx("img", {
            src: sku.image,
            alt: sku.product?.name,
            className: "h-full object-contain"
          }) : /* @__PURE__ */ jsx("div", {
            className: "text-4xl",
            children: "ðŸ“ "
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "p-6 flex-1 flex flex-col",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "text-lg font-bold mb-1",
            children: sku.product?.name || "Terminal Reader"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 mb-4 flex-1",
            children: sku.product?.description || "Accept payments securely with this Stripe Terminal reader."
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mt-auto pt-4 border-t border-zinc-100 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "text-xl font-bold",
              children: ["$", (sku.price.unit_amount / 100).toFixed(2)]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => {
                setSelectedSku(sku);
                setIsOrderModalOpen(true);
              },
              className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md text-sm font-medium hover:opacity-90",
              children: "Buy Now"
            })]
          })]
        })]
      }, sku.id))
    })]
  });
});
const route41 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_hardware
}, Symbol.toStringTag, { value: "Module" }));
const loader$U = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  try {
    const [tenant, usageRes] = await Promise.all([apiRequest(`/tenant/info`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/tenant/usage`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    if (!tenant.roles?.includes("owner") && !tenant.roles?.includes("admin")) {
      if (usageRes.error) {
        throw new Response("Unauthorized", {
          status: 403
        });
      }
    }
    return {
      tenant,
      usage: usageRes,
      slug,
      token
    };
  } catch (e) {
    throw new Response("Unauthorized", {
      status: 401
    });
  }
};
const TIERS = {
  basic: {
    name: "Basic",
    students: 50,
    storage: 1,
    price: "Free"
  },
  growth: {
    name: "Growth",
    students: 500,
    storage: 50,
    price: "$49/mo"
  },
  scale: {
    name: "Scale",
    students: "Unlimited",
    storage: 1e3,
    price: "$199/mo"
  }
};
const studio_$slug_settings_billing = UNSAFE_withComponentProps(function StudioBilling() {
  const {
    tenant,
    usage,
    slug,
    token
  } = useLoaderData();
  const tier = TIERS[tenant.features?.includes("white_label") ? "scale" : tenant.tier || "basic"] || TIERS.basic;
  const handleManageSubscription = async () => {
    try {
      const res = await apiRequest("/tenant/portal", token, {
        method: "POST",
        body: JSON.stringify({
          returnUrl: window.location.href
        }),
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      if (res.url) {
        window.location.href = res.url;
      } else {
        toast.error("Could not load billing portal. Please contact support.");
      }
    } catch (e) {
      console.error(e);
      toast.error("Failed to redirect to billing portal.");
    }
  };
  const limitPercentage = (current, max) => {
    if (max === "Unlimited") return 0;
    return Math.min(100, current / max * 100);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsx("h1", {
      className: "text-2xl font-bold mb-6",
      children: "Billing & Subscription"
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "md:col-span-2 bg-white border border-zinc-200 rounded-xl p-6 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-sm text-zinc-500 uppercase font-semibold tracking-wide",
              children: "Current Plan"
            }), /* @__PURE__ */ jsx("h2", {
              className: "text-3xl font-bold text-zinc-900 mt-1",
              children: tier.name
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-500",
              children: tier.price
            })]
          }), /* @__PURE__ */ jsx("span", {
            className: `px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide ${tenant.subscriptionStatus === "active" ? "bg-green-100 text-green-800" : "bg-amber-100 text-amber-800"}`,
            children: tenant.subscriptionStatus || "Active"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4 mt-6",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-sm mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: "Students"
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500",
                children: [usage.students, " / ", tier.students]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: "h-full bg-blue-600 rounded-full",
                style: {
                  width: `${limitPercentage(usage.students, tier.students)}%`
                }
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-sm mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: "Storage (GB)"
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500",
                children: [usage.storageGB.toFixed(1), " / ", tier.storage, " GB"]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: "h-full bg-purple-600 rounded-full",
                style: {
                  width: `${limitPercentage(usage.storageGB, tier.storage)}%`
                }
              })
            })]
          }), (usage.streamingLimit === -1 || usage.streamingLimit > 0) && /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-sm mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: "VOD Minutes (Stored)"
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500",
                children: [usage.streamingUsage || 0, " / ", usage.streamingLimit === -1 ? "Unlimited" : usage.streamingLimit]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: `h-full rounded-full ${usage.streamingLimit !== -1 && usage.streamingUsage > usage.streamingLimit ? "bg-red-500" : "bg-pink-500"}`,
                style: {
                  width: `${limitPercentage(usage.streamingUsage, usage.streamingLimit)}%`
                }
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-sm mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: "Emails Sent (Monthly)"
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500",
                children: [usage.emailUsage || 0, " / ", usage.emailLimit === -1 ? "Unlimited" : usage.emailLimit]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: `h-full rounded-full ${usage.emailLimit !== -1 && usage.emailUsage > usage.emailLimit ? "bg-red-500" : "bg-indigo-500"}`,
                style: {
                  width: `${limitPercentage(usage.emailUsage, usage.emailLimit)}%`
                }
              })
            })]
          }), (usage.smsLimit === -1 || usage.smsLimit > 0) && /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-sm mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: "SMS Sent (Monthly)"
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500",
                children: [usage.smsUsage || 0, " / ", usage.smsLimit === -1 ? "Unlimited" : usage.smsLimit]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 bg-zinc-100 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: `h-full rounded-full ${usage.smsLimit !== -1 && usage.smsUsage > usage.smsLimit ? "bg-red-500" : "bg-blue-500"}`,
                style: {
                  width: `${limitPercentage(usage.smsUsage, usage.smsLimit)}%`
                }
              })
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-zinc-50 border border-zinc-200 rounded-xl p-6",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-900 mb-4",
          children: "Manage Subscription"
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-3",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: handleManageSubscription,
            className: "w-full py-2 bg-white border border-zinc-300 text-zinc-700 rounded-lg hover:bg-zinc-50 font-medium text-sm transition-colors cursor-pointer",
            children: "Update Payment Method"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleManageSubscription,
            className: "w-full py-2 bg-white border border-zinc-300 text-zinc-700 rounded-lg hover:bg-zinc-50 font-medium text-sm transition-colors cursor-pointer",
            children: "View Invoices"
          }), /* @__PURE__ */ jsx("div", {
            className: "pt-4 border-t border-zinc-200",
            children: /* @__PURE__ */ jsx("button", {
              onClick: handleManageSubscription,
              className: "w-full py-2 bg-zinc-900 text-white rounded-lg hover:bg-zinc-800 font-medium text-sm transition-colors cursor-pointer",
              children: "Upgrade Plan"
            })
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white border border-zinc-200 rounded-xl overflow-hidden",
      children: [/* @__PURE__ */ jsx("div", {
        className: "px-6 py-4 border-b border-zinc-200 bg-zinc-50",
        children: /* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-900",
          children: "Plan Features"
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-6 grid gap-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx(Check, {
            className: "text-green-600",
            size: 18
          }), /* @__PURE__ */ jsxs("span", {
            className: "text-zinc-700",
            children: ["Zoom Integration: ", /* @__PURE__ */ jsx("span", {
              className: "font-medium",
              children: tier.name === "Basic" ? "Not Included" : "Included"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx(Check, {
            className: "text-green-600",
            size: 18
          }), /* @__PURE__ */ jsxs("span", {
            className: "text-zinc-700",
            children: ["Locations: ", /* @__PURE__ */ jsx("span", {
              className: "font-medium",
              children: tier.name === "Basic" ? "1" : tier.name === "Growth" ? "3" : "Unlimited"
            })]
          })]
        })]
      })]
    })]
  });
});
const route42 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_billing,
  loader: loader$U
}, Symbol.toStringTag, { value: "Module" }));
const API_URL = typeof window !== "undefined" ? window.ENV?.API_URL : "";
const action$d = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  const tenantSlug = args.params.slug;
  if (intent === "create_location") {
    const name = formData.get("name");
    const address = formData.get("address");
    if (!name) return {
      error: "Name is required"
    };
    try {
      await apiRequest(`/locations`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenantSlug
        },
        body: JSON.stringify({
          name,
          address
        })
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: "Failed to create location"
      };
    }
  }
  if (intent === "delete_location") {
    const id = formData.get("id");
    try {
      await apiRequest(`/locations/${id}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": tenantSlug
        }
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: "Failed to delete location"
      };
    }
  }
  return null;
};
const loader$T = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  let locations = [];
  try {
    const res = await apiRequest(`/locations`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    locations = res.locations || [];
  } catch (e) {
    console.error("Failed to load locations", e);
  }
  return {
    locations,
    token
  };
};
const studio_$slug_settings__index = UNSAFE_withComponentProps(function SettingsIndex() {
  const {
    locations
  } = useLoaderData();
  const {
    tenant: initialTenant
  } = useOutletContext();
  const [tenant, setTenant] = useState(initialTenant);
  const [name, setName] = useState(tenant.name);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const [isAddingLocation, setIsAddingLocation] = useState(false);
  const submit = useSubmit();
  const [confirmDeleteLocationId, setConfirmDeleteLocationId] = useState(null);
  const [showOrderReader, setShowOrderReader] = useState(false);
  const handleOrderReader = async () => {
    toast.success("Your request for a Stripe Terminal Reader (WisePOS E) has been received. Our team will contact you shortly to confirm shipping details.");
    setShowOrderReader(false);
  };
  const handleDeleteLocation = (id) => {
    setConfirmDeleteLocationId(id);
  };
  const confirmDeleteLocation = () => {
    if (confirmDeleteLocationId) {
      submit({
        intent: "delete_location",
        id: confirmDeleteLocationId
      }, {
        method: "post"
      });
      setConfirmDeleteLocationId(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-10",
    children: [/* @__PURE__ */ jsx("div", {
      className: "mb-8",
      children: /* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Studio Settings"
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-8",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-4",
        children: "General Information"
      }), error && /* @__PURE__ */ jsx("div", {
        className: "bg-red-50 text-red-600 p-3 rounded mb-4 text-sm",
        children: error
      }), success && /* @__PURE__ */ jsx("div", {
        className: "bg-green-50 text-green-600 p-3 rounded mb-4 text-sm",
        children: success
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: async (e) => {
          e.preventDefault();
          setLoading(true);
          setError(null);
          setSuccess(null);
          try {
            const token = await window.Clerk?.session?.getToken();
            await apiRequest(`/tenant/settings`, token, {
              method: "PATCH",
              headers: {
                "X-Tenant-Slug": tenant.slug
              },
              body: JSON.stringify({
                name
              })
            });
            setSuccess("Settings saved successfully");
          } catch (err) {
            setError(err.message || "Failed to save settings");
            toast.error(err.message || "Failed to save settings");
          } finally {
            setLoading(false);
          }
        },
        children: [/* @__PURE__ */ jsxs("div", {
          className: "mb-4",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-semibold text-zinc-500 uppercase tracking-wide mb-2",
            children: "Studio Name"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            value: name,
            onChange: (e) => setName(e.target.value),
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            placeholder: "Enter studio name"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-2",
          children: /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "bg-zinc-900 text-white px-4 py-2 rounded-md font-medium text-sm hover:bg-zinc-800 disabled:opacity-70",
            children: loading ? "Saving..." : "Save Changes"
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "mt-6 pt-6 border-t border-zinc-100 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-xs font-semibold text-zinc-500 uppercase tracking-wide mb-2",
          children: "Studio Logo"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-400 mb-3",
          children: "Upload a logo that will appear in the sidebar header. Recommended: 200x200px or larger."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-20 h-20 rounded-lg border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 flex items-center justify-center overflow-hidden",
            children: tenant.branding?.logoUrl ? /* @__PURE__ */ jsx("img", {
              src: tenant.branding.logoUrl,
              alt: "Studio logo",
              className: "w-full h-full object-contain"
            }) : /* @__PURE__ */ jsx("span", {
              className: "text-zinc-400 text-xs text-center px-2",
              children: "No logo"
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex-1",
            children: [/* @__PURE__ */ jsx("input", {
              type: "file",
              id: "logo-upload",
              accept: "image/*",
              className: "hidden",
              onChange: async (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                try {
                  setLoading(true);
                  const token = await window.Clerk?.session?.getToken();
                  const formData = new FormData();
                  formData.append("file", file);
                  const response = await fetch(`${API_URL}/uploads/logo`, {
                    method: "POST",
                    headers: {
                      "Authorization": `Bearer ${token}`,
                      "X-Tenant-Slug": tenant.slug
                    },
                    body: formData
                  });
                  const result = await response.json();
                  if (result.error) throw new Error(result.error);
                  setSuccess("Logo uploaded successfully");
                  window.location.reload();
                } catch (err) {
                  setError(err.message || "Failed to upload logo");
                } finally {
                  setLoading(false);
                }
              }
            }), /* @__PURE__ */ jsx("label", {
              htmlFor: "logo-upload",
              className: "inline-flex items-center gap-2 px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-md text-sm font-medium text-zinc-700 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-800 cursor-pointer transition-colors",
              children: loading ? "Uploading..." : "Upload Logo"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-400 mt-1",
              children: "PNG, JPG or WebP. Max 5MB."
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "flex justify-between items-start mb-4",
        children: /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100",
            children: "Registration"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 dark:text-zinc-400 mt-1",
            children: "Control how new students sign up for your studio."
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-200 dark:border-zinc-700",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "font-medium text-zinc-900 dark:text-zinc-100",
            children: "Public Student Registration"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
            children: tenant.settings?.enableStudentRegistration ? "Students can create accounts on your public site." : "Only you can add students manually."
          })]
        }), /* @__PURE__ */ jsxs("label", {
          className: "relative inline-flex items-center cursor-pointer",
          children: [/* @__PURE__ */ jsx("input", {
            type: "checkbox",
            className: "sr-only peer",
            checked: tenant.settings?.enableStudentRegistration || false,
            onChange: async (e) => {
              const checked = e.target.checked;
              try {
                const token = await window.Clerk?.session?.getToken();
                await apiRequest(`/tenant/settings`, token, {
                  method: "PATCH",
                  headers: {
                    "X-Tenant-Slug": tenant.slug
                  },
                  body: JSON.stringify({
                    settings: {
                      enableStudentRegistration: checked
                    }
                  })
                });
                window.location.reload();
              } catch (err) {
                toast.error("Failed to update setting");
              }
            }
          }), /* @__PURE__ */ jsx("div", {
            className: "w-11 h-6 bg-zinc-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-4",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100",
          children: "Notifications & Automation"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Manage email alerts and studio automation settings."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Admin Notification Email"
          }), /* @__PURE__ */ jsx("input", {
            type: "email",
            className: "w-full border-zinc-300 dark:border-zinc-700 rounded text-sm px-3 py-2 bg-white dark:bg-zinc-800",
            placeholder: "admin@studio.com",
            defaultValue: tenant.settings?.notifications?.adminEmail || "",
            onBlur: async (e) => {
              const val = e.target.value;
              const token = await window.Clerk?.session?.getToken();
              await apiRequest(`/tenant/settings`, token, {
                method: "PATCH",
                headers: {
                  "X-Tenant-Slug": tenant.slug
                },
                body: JSON.stringify({
                  settings: {
                    notifications: {
                      ...tenant.settings?.notifications,
                      adminEmail: val
                    }
                  }
                })
              });
            }
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
            children: "Where should we send system alerts?"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between p-3 bg-zinc-50 dark:bg-zinc-800/50 rounded border border-zinc-200 dark:border-zinc-700",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "New Student Alerts"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Email on registration."
              })]
            }), /* @__PURE__ */ jsxs("label", {
              className: "relative inline-flex items-center cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "sr-only peer",
                checked: tenant.settings?.notifications?.newStudentAlert || false,
                onChange: async (e) => {
                  const checked = e.target.checked;
                  const token = await window.Clerk?.session?.getToken();
                  await apiRequest(`/tenant/settings`, token, {
                    method: "PATCH",
                    headers: {
                      "X-Tenant-Slug": tenant.slug
                    },
                    body: JSON.stringify({
                      settings: {
                        notifications: {
                          ...tenant.settings?.notifications,
                          newStudentAlert: checked
                        }
                      }
                    })
                  });
                  window.location.reload();
                }
              }), /* @__PURE__ */ jsx("div", {
                className: "w-9 h-5 bg-zinc-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between p-3 bg-zinc-50 dark:bg-zinc-800/50 rounded border border-zinc-200 dark:border-zinc-700",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "BCC on User Emails"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Copy of booking emails."
              })]
            }), /* @__PURE__ */ jsxs("label", {
              className: "relative inline-flex items-center cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "sr-only peer",
                checked: tenant.settings?.notifications?.enableBcc || false,
                onChange: async (e) => {
                  const checked = e.target.checked;
                  const token = await window.Clerk?.session?.getToken();
                  await apiRequest(`/tenant/settings`, token, {
                    method: "PATCH",
                    headers: {
                      "X-Tenant-Slug": tenant.slug
                    },
                    body: JSON.stringify({
                      settings: {
                        notifications: {
                          ...tenant.settings?.notifications,
                          enableBcc: checked
                        }
                      }
                    })
                  });
                  window.location.reload();
                }
              }), /* @__PURE__ */ jsx("div", {
                className: "w-9 h-5 bg-zinc-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 border-t border-zinc-100 dark:border-zinc-800",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Enable No-Show Fee Automation"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Automatically charge fees for missed classes."
              })]
            }), /* @__PURE__ */ jsxs("label", {
              className: "relative inline-flex items-center cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "sr-only peer",
                checked: tenant.settings?.noShowFeeEnabled || false,
                onChange: async (e) => {
                  const checked = e.target.checked;
                  try {
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          noShowFeeEnabled: checked
                        }
                      })
                    });
                    window.location.reload();
                  } catch (err) {
                    toast.error("Failed to save");
                  }
                }
              }), /* @__PURE__ */ jsx("div", {
                className: "w-11 h-6 bg-zinc-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
              })]
            })]
          }), tenant.settings?.noShowFeeEnabled && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "mb-4",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-1",
                children: "Fee Amount ($)"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                step: "0.01",
                className: "w-full border-zinc-300 dark:border-zinc-700 rounded text-sm px-3 py-2 bg-white dark:bg-zinc-800",
                placeholder: "10.00",
                defaultValue: tenant.settings?.noShowFeeAmount ? (tenant.settings.noShowFeeAmount / 100).toFixed(2) : "10.00",
                onBlur: async (e) => {
                  const val = parseFloat(e.target.value);
                  if (val > 0) {
                    const cents = Math.round(val * 100);
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          noShowFeeAmount: cents
                        }
                      })
                    });
                  }
                }
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
                children: 'Fee will be charged automatically when marking "No Show".'
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "mb-4 ml-1",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.noShowSms !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            noShowSms: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "Send SMS Alert"
                })]
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 ml-6 mt-1",
                children: "Notify student via SMS when charged/marked."
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between pb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Auto-Mark No Shows"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Automatically mark expected students as No Show."
              })]
            }), /* @__PURE__ */ jsxs("label", {
              className: "relative inline-flex items-center cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "sr-only peer",
                checked: tenant.settings?.noShowAutoMarkEnabled || false,
                onChange: async (e) => {
                  const checked = e.target.checked;
                  try {
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          noShowAutoMarkEnabled: checked
                        }
                      })
                    });
                    window.location.reload();
                  } catch (err) {
                    toast.error("Failed to save");
                  }
                }
              }), /* @__PURE__ */ jsx("div", {
                className: "w-11 h-6 bg-zinc-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"
              })]
            })]
          }), tenant.settings?.noShowAutoMarkEnabled && /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "When to Mark?"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full border-zinc-300 dark:border-zinc-700 rounded text-sm px-3 py-2 bg-white dark:bg-zinc-800",
              defaultValue: tenant.settings?.noShowAutoMarkTime || "end_of_class",
              onChange: async (e) => {
                const val = e.target.value;
                const token = await window.Clerk?.session?.getToken();
                await apiRequest(`/tenant/settings`, token, {
                  method: "PATCH",
                  headers: {
                    "X-Tenant-Slug": tenant.slug
                  },
                  body: JSON.stringify({
                    settings: {
                      noShowAutoMarkTime: val
                    }
                  })
                });
              },
              children: [/* @__PURE__ */ jsx("option", {
                value: "start_of_class",
                children: "Start of Class"
              }), /* @__PURE__ */ jsx("option", {
                value: "15_mins_after_start",
                children: "15 Minutes After Start"
              }), /* @__PURE__ */ jsx("option", {
                value: "end_of_class",
                children: "End of Class"
              })]
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-4",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100",
          children: "Class Management"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Configure booking windows and cancellation policies."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-2 gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-2",
            children: "Attendance Switch Cutoff"
          }), /* @__PURE__ */ jsx(NumberStepper, {
            value: tenant.settings?.classSettings?.attendanceSwitchCutoffMinutes || 15,
            min: 0,
            step: 5,
            suffix: "min",
            onChange: async (val) => {
              const token = await window.Clerk?.session?.getToken();
              await apiRequest(`/tenant/settings`, token, {
                method: "PATCH",
                headers: {
                  "X-Tenant-Slug": tenant.slug
                },
                body: JSON.stringify({
                  settings: {
                    classSettings: {
                      ...tenant.settings?.classSettings,
                      attendanceSwitchCutoffMinutes: val
                    }
                  }
                })
              });
            }
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-2",
            children: "When students can last switch between In-Person and Zoom."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-700 dark:text-zinc-300 mb-2",
            children: "Cancellation Cutoff"
          }), /* @__PURE__ */ jsx(NumberStepper, {
            value: tenant.settings?.classSettings?.cancellationCutoffMinutes || 60,
            min: 0,
            step: 15,
            suffix: "min",
            onChange: async (val) => {
              const token = await window.Clerk?.session?.getToken();
              await apiRequest(`/tenant/settings`, token, {
                method: "PATCH",
                headers: {
                  "X-Tenant-Slug": tenant.slug
                },
                body: JSON.stringify({
                  settings: {
                    classSettings: {
                      ...tenant.settings?.classSettings,
                      cancellationCutoffMinutes: val
                    }
                  }
                })
              });
            }
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-2",
            children: "Latest time a student can cancel without penalty."
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "md:col-span-2 border-t border-zinc-100 dark:border-zinc-800 pt-4 mt-2",
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Auto-Cancel Low Enrollment"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Automatically cancel classes that don't meet minimum enrollment."
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-4",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.classSettings?.defaultAutoCancelEnabled !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          classSettings: {
                            ...tenant.settings?.classSettings,
                            defaultAutoCancelEnabled: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "Enable by Default"
                })]
              }), tenant.settings?.classSettings?.defaultAutoCancelEnabled !== false && /* @__PURE__ */ jsx("div", {
                className: "flex items-center gap-2",
                children: /* @__PURE__ */ jsx(NumberStepper, {
                  value: tenant.settings?.classSettings?.defaultAutoCancelThresholdHours || 2,
                  min: 1,
                  step: 1,
                  suffix: "hours pre-class",
                  onChange: async (val) => {
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          classSettings: {
                            ...tenant.settings?.classSettings,
                            defaultAutoCancelThresholdHours: val
                          }
                        }
                      })
                    });
                  }
                })
              })]
            })]
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "md:col-span-2 border-t border-zinc-100 dark:border-zinc-800 pt-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between pb-4 border-b border-zinc-100 dark:border-zinc-800 mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Booking Confirmations"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Notify students when they book a class."
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.bookingEmail !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            bookingEmail: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "Email"
                })]
              }), /* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.bookingSms !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            bookingSms: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "SMS"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between pb-4 border-b border-zinc-100 dark:border-zinc-800 mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Waitlist Promotions"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Notify students when they come off the waitlist."
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.waitlistEmail !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            waitlistEmail: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "Email"
                })]
              }), /* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.waitlistSms !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            waitlistSms: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "SMS"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                children: "Cancellation Notifications"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: "Notify students when you cancel a class."
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4",
              children: [/* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.cancellationEmail !== false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            cancellationEmail: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "Email"
                })]
              }), /* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: tenant.settings?.notificationSettings?.cancellationSms || false,
                  onChange: async (e) => {
                    const checked = e.target.checked;
                    const token = await window.Clerk?.session?.getToken();
                    await apiRequest(`/tenant/settings`, token, {
                      method: "PATCH",
                      headers: {
                        "X-Tenant-Slug": tenant.slug
                      },
                      body: JSON.stringify({
                        settings: {
                          notificationSettings: {
                            ...tenant.settings?.notificationSettings,
                            cancellationSms: checked
                          }
                        }
                      })
                    });
                    window.location.reload();
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 dark:text-zinc-300",
                  children: "SMS"
                })]
              })]
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx(Link, {
      to: `/studio/${tenant.slug}/settings/billing`,
      className: "block bg-white border border-zinc-200 rounded-lg p-6 shadow-sm mb-8 hover:border-blue-300 transition-colors group",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-semibold group-hover:text-blue-600 transition-colors",
            children: "Billing & Subscription"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500",
            children: "Manage your plan, payment methods, and view usage."
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "bg-zinc-100 p-2 rounded-full group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors",
          children: /* @__PURE__ */ jsx(CreditCard, {
            className: "h-5 w-5"
          })
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center mb-6",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-semibold",
          children: "Locations"
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setIsAddingLocation(true),
          className: "flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-800",
          children: [/* @__PURE__ */ jsx(Plus, {
            className: "h-4 w-4"
          }), "Add Location"]
        })]
      }), isAddingLocation && /* @__PURE__ */ jsxs("div", {
        className: "bg-zinc-50 border border-zinc-200 rounded p-4 mb-6",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-sm font-semibold mb-3",
          children: "New Location"
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: () => setIsAddingLocation(false),
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "create_location"
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs text-zinc-500 mb-1",
                children: "Name"
              }), /* @__PURE__ */ jsx("input", {
                name: "name",
                required: true,
                placeholder: "e.g. Main Studio",
                className: "w-full text-sm border-zinc-300 rounded px-3 py-2"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs text-zinc-500 mb-1",
                children: "Address (Optional)"
              }), /* @__PURE__ */ jsx("input", {
                name: "address",
                placeholder: "123 Yoga St",
                className: "w-full text-sm border-zinc-300 rounded px-3 py-2"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsAddingLocation(false),
              className: "px-3 py-1.5 text-xs border border-zinc-300 rounded hover:bg-zinc-100",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",
              children: "Save Location"
            })]
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "space-y-3",
        children: locations.length === 0 ? /* @__PURE__ */ jsx("div", {
          className: "text-center py-8 text-zinc-500 text-sm italic",
          children: "No locations added yet."
        }) : locations.map((loc) => /* @__PURE__ */ jsxs("div", {
          className: "flex items-center justify-between p-4 border border-zinc-100 rounded hover:bg-zinc-50 transition-colors",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-start gap-3",
            children: [/* @__PURE__ */ jsx("div", {
              className: "mt-1 p-2 bg-blue-50 text-blue-600 rounded",
              children: /* @__PURE__ */ jsx(MapPin, {
                className: "h-4 w-4"
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900",
                children: loc.name
              }), loc.address && /* @__PURE__ */ jsx("div", {
                className: "text-sm text-zinc-500",
                children: loc.address
              })]
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => handleDeleteLocation(loc.id),
            className: "text-zinc-400 hover:text-red-600 p-2 rounded hover:bg-zinc-100",
            children: /* @__PURE__ */ jsx(Trash2, {
              className: "h-4 w-4"
            })
          })]
        }, loc.id))
      }), /* @__PURE__ */ jsx(ConfirmationDialog, {
        isOpen: !!confirmDeleteLocationId,
        onClose: () => setConfirmDeleteLocationId(null),
        onConfirm: confirmDeleteLocation,
        title: "Delete Location",
        message: "Are you sure you want to delete this location? This action cannot be undone.",
        confirmText: "Delete",
        isDestructive: true
      }), /* @__PURE__ */ jsx(Link, {
        to: `/studio/${tenant.slug}/settings/domain`,
        className: "block bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-8 hover:border-purple-300 transition-colors group",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h2", {
              className: "text-lg font-semibold dark:text-zinc-100 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors",
              children: "Custom Domain"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400",
              children: ["Connect your own website domain (e.g. studio.com). ", /* @__PURE__ */ jsx("span", {
                className: "inline-block bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-[10px] px-1.5 py-0.5 rounded ml-2 uppercase font-bold tracking-wider",
                children: "Scale"
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "bg-zinc-100 dark:bg-zinc-800 p-2 rounded-full group-hover:bg-purple-50 dark:group-hover:bg-purple-900/30 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors",
            children: /* @__PURE__ */ jsx(Globe, {
              className: "h-5 w-5"
            })
          })]
        })
      }), showOrderReader && /* @__PURE__ */ jsx("div", {
        className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white w-full max-w-md rounded-2xl p-8 shadow-2xl",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold mb-2",
            children: "Order BBPOS WisePOS E"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 mb-6",
            children: "Connect your Stripe account to the physical world with a pre-certified card reader. $249/unit."
          }), /* @__PURE__ */ jsx("div", {
            className: "bg-zinc-50 p-4 rounded-xl mb-6 flex justify-center",
            children: /* @__PURE__ */ jsx(CreditCard, {
              size: 48,
              className: "text-zinc-300"
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-4",
            children: [/* @__PURE__ */ jsx("button", {
              onClick: () => setShowOrderReader(false),
              className: "flex-1 py-3 font-bold text-zinc-500 hover:bg-zinc-100 rounded-xl",
              children: "Cancel"
            }), /* @__PURE__ */ jsxs("button", {
              onClick: handleOrderReader,
              className: "flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 flex items-center justify-center gap-2",
              children: [/* @__PURE__ */ jsx(ShoppingBag, {
                size: 16
              }), " Place Order"]
            })]
          })]
        })
      })]
    })]
  });
});
function NumberStepper({
  value,
  onChange,
  min = 0,
  max = 1e3,
  step = 1,
  suffix = ""
}) {
  const [localValue, setLocalValue] = useState(value);
  useEffect(() => {
    setLocalValue(value);
  }, [value]);
  const handleChange = (val) => {
    const clampped = Math.max(min, Math.min(max, val));
    setLocalValue(clampped);
    onChange(clampped);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex items-center gap-3",
    children: [/* @__PURE__ */ jsx("button", {
      type: "button",
      onClick: () => handleChange(localValue - step),
      className: "w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition-colors border border-blue-200",
      children: /* @__PURE__ */ jsx("span", {
        className: "text-lg font-bold leading-none mb-0.5",
        children: "âˆ’"
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "min-w-[80px] text-center font-mono font-medium text-lg text-zinc-700 dark:text-zinc-200",
      children: [localValue, " ", /* @__PURE__ */ jsx("span", {
        className: "text-xs text-zinc-400 font-sans",
        children: suffix
      })]
    }), /* @__PURE__ */ jsx("button", {
      type: "button",
      onClick: () => handleChange(localValue + step),
      className: "w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center hover:bg-blue-100 transition-colors border border-blue-200",
      children: /* @__PURE__ */ jsx("span", {
        className: "text-lg font-bold leading-none mb-0.5",
        children: "+"
      })
    })]
  });
}
const route43 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$d,
  default: studio_$slug_settings__index,
  loader: loader$T
}, Symbol.toStringTag, { value: "Module" }));
const loader$S = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  let features = [];
  let tenantId = "";
  try {
    const info = await apiRequest(`/tenant/info`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    tenantId = info.id;
    features = (info.features || []).map((f) => ({
      featureKey: f,
      enabled: true
    }));
  } catch (e) {
    console.error("Failed to load addons", e);
  }
  return {
    features,
    tenantId,
    token,
    slug
  };
};
const studio_$slug_settings_addons = UNSAFE_withComponentProps(function AddonsPage() {
  const {
    features: initialFeatures,
    tenantId,
    token,
    slug
  } = useLoaderData();
  const [features, setFeatures] = useState(initialFeatures || []);
  const [loading, setLoading] = useState(null);
  const smsEnabled = features.find((f) => f.featureKey === "sms" && f.enabled);
  async function toggleSMS() {
    if (!tenantId) return;
    setLoading("sms");
    const newState = !smsEnabled;
    try {
      await apiRequest(`/tenant/features`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          featureKey: "sms",
          enabled: newState
        })
      });
      if (newState) {
        setFeatures([...features, {
          featureKey: "sms",
          enabled: true
        }]);
      } else {
        setFeatures(features.filter((f) => f.featureKey !== "sms"));
      }
      toast.success(`SMS Add-on ${newState ? "enabled" : "disabled"}`);
    } catch (e) {
      toast.error("Failed to update add-on");
      console.error(e);
    } finally {
      setLoading(null);
    }
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900",
        children: "Add-ons"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500",
        children: "Enable power features for your studio."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid gap-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white border border-zinc-200 rounded-xl p-6 flex flex-col md:flex-row items-start md:items-center justify-between shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-blue-100 p-3 rounded-lg text-blue-600",
            children: /* @__PURE__ */ jsx(MessageSquare, {
              className: "h-6 w-6"
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-lg font-semibold text-zinc-900",
              children: "SMS Notifications"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-600 max-w-md mt-1",
              children: "Send automated text reminders for classes, waitlist alerts, and announcements to your students."
            }), /* @__PURE__ */ jsxs("div", {
              className: "mt-2 flex items-center gap-2 text-sm text-zinc-500",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-900",
                children: "$10.00/mo"
              }), /* @__PURE__ */ jsx("span", {
                children: "+ $0.01 per message"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "mt-4 md:mt-0 flex gap-3 items-center",
          children: [smsEnabled ? /* @__PURE__ */ jsxs("span", {
            className: "flex items-center gap-1 text-green-600 text-sm font-medium bg-green-50 px-3 py-1 rounded-full",
            children: [/* @__PURE__ */ jsx(Check, {
              className: "h-4 w-4"
            }), " Active"]
          }) : /* @__PURE__ */ jsx("span", {
            className: "text-zinc-400 text-sm",
            children: "Inactive"
          }), /* @__PURE__ */ jsx("button", {
            onClick: toggleSMS,
            disabled: !!loading,
            className: `px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${smsEnabled ? "border-red-200 text-red-700 hover:bg-red-50" : "bg-blue-600 text-white border-transparent hover:bg-blue-700"}`,
            children: loading === "sms" ? "Updating..." : smsEnabled ? "Disable" : "Enable Add-on"
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "bg-zinc-50 border border-zinc-200 border-dashed rounded-xl p-6 text-center text-zinc-500",
        children: "More add-ons coming soon (Payroll, Branded App, etc.)"
      })]
    })]
  });
});
const route44 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_addons,
  loader: loader$S
}, Symbol.toStringTag, { value: "Module" }));
const loader$R = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const res = await apiRequest(`/tenant/domain`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      domainInfo: res
    };
  } catch (e) {
    return {
      domainInfo: {
        domain: null
      }
    };
  }
};
const studio_$slug_settings_domain = UNSAFE_withComponentProps(function DomainSettings() {
  const {
    tenant
  } = useOutletContext();
  const {
    domainInfo
  } = useLoaderData();
  const [loading, setLoading] = useState(false);
  const [domainInput, setDomainInput] = useState("");
  const [error, setError] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  if (tenant.tier !== "scale") {
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-4xl mx-auto py-10",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-8",
        children: [/* @__PURE__ */ jsx(Link, {
          to: `/studio/${tenant.slug}/settings`,
          className: "text-sm text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300 mb-2 inline-block",
          children: "â† Back to Settings"
        }), /* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Custom Domain"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-gradient-to-br from-purple-50 to-white dark:from-purple-900/10 dark:to-zinc-900 border border-purple-100 dark:border-purple-800/30 rounded-xl p-8 text-center max-w-2xl mx-auto shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-16 h-16 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-full flex items-center justify-center mx-auto mb-6",
          children: /* @__PURE__ */ jsx(Globe, {
            className: "w-8 h-8"
          })
        }), /* @__PURE__ */ jsx("h2", {
          className: "text-xl font-bold text-zinc-900 dark:text-zinc-50 mb-2",
          children: "Connect Your Own Domain"
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-zinc-600 dark:text-zinc-400 mb-6",
          children: ["Use a custom domain (e.g., ", /* @__PURE__ */ jsx("span", {
            className: "font-mono text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/30 px-1 rounded",
            children: "www.mystudio.com"
          }), ") instead of ", /* @__PURE__ */ jsx("span", {
            className: "font-mono",
            children: "studio-platform.com"
          }), ". This feature is exclusive to the ", /* @__PURE__ */ jsx("strong", {
            children: "Scale"
          }), " plan."]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-center gap-4",
          children: /* @__PURE__ */ jsx(Link, {
            to: `/studio/${tenant.slug}/settings/billing`,
            className: "bg-purple-600 hover:bg-purple-700 text-white px-6 py-2.5 rounded-lg font-medium transition-colors shadow-sm",
            children: "Upgrade to Scale"
          })
        })]
      })]
    });
  }
  const handleAddDomain = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/tenant/domain`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          domain: domainInput
        })
      });
      window.location.reload();
    } catch (e2) {
      setError(e2.message || "Failed to add domain.");
    } finally {
      setLoading(false);
    }
  };
  const handleDeleteDomain = async () => {
    setShowDeleteConfirm(true);
  };
  const confirmDelete = async () => {
    setLoading(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/tenant/domain`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      window.location.reload();
    } catch (e) {
      toast.error(e.message);
    } finally {
      setLoading(false);
      setShowDeleteConfirm(false);
    }
  };
  const hasDomain = !!domainInfo?.domain;
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-10",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx(Link, {
        to: `/studio/${tenant.slug}/settings`,
        className: "text-sm text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300 mb-2 inline-block",
        children: "â† Back to Settings"
      }), /* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Custom Domain"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400 mt-1",
        children: "Connect your own web address to your studio portal."
      })]
    }), error && /* @__PURE__ */ jsxs("div", {
      className: "bg-red-50 text-red-600 p-4 rounded-lg mb-6 text-sm flex items-start gap-2 border border-red-100",
      children: [/* @__PURE__ */ jsx(AlertTriangle, {
        className: "w-5 h-5 shrink-0"
      }), error]
    }), !hasDomain ? /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-4",
        children: "Add a Custom Domain"
      }), /* @__PURE__ */ jsx("form", {
        onSubmit: handleAddDomain,
        className: "max-w-md",
        children: /* @__PURE__ */ jsxs("div", {
          className: "mb-4",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-semibold text-zinc-500 uppercase tracking-wide mb-2",
            children: "Domain Name"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "text",
              value: domainInput,
              onChange: (e) => setDomainInput(e.target.value),
              className: "flex-1 px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md bg-white dark:bg-zinc-800 outline-none focus:ring-2 focus:ring-blue-500",
              placeholder: "studio.example.com",
              disabled: loading
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: loading || !domainInput,
              className: "bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 px-4 py-2 rounded-md font-medium text-sm hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50",
              children: loading ? "Adding..." : "Add Domain"
            })]
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-xs text-zinc-500 mt-2",
            children: ["We recommend using a subdomain like ", /* @__PURE__ */ jsx("span", {
              className: "font-mono",
              children: "app.yourdomain.com"
            }), " or ", /* @__PURE__ */ jsx("span", {
              className: "font-mono",
              children: "studio.yourdomain.com"
            }), "."]
          })]
        })
      })]
    }) : /* @__PURE__ */ jsx("div", {
      className: "space-y-6",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsx("div", {
              className: `p-2 rounded-full ${domainInfo.status === "active" ? "bg-green-100 text-green-600" : "bg-yellow-100 text-yellow-600"}`,
              children: domainInfo.status === "active" ? /* @__PURE__ */ jsx(CheckCircle, {
                className: "w-6 h-6"
              }) : /* @__PURE__ */ jsx(RefreshCw, {
                className: `w-6 h-6 ${domainInfo.status !== "active" ? "animate-spin-slow" : ""}`
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h2", {
                className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
                children: domainInfo.domain
              }), /* @__PURE__ */ jsx("p", {
                className: `text-sm font-medium ${domainInfo.status === "active" ? "text-green-600" : "text-yellow-600"}`,
                children: domainInfo.status === "active" ? "Active & Secured" : "Verification Pending"
              })]
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleDeleteDomain,
            disabled: loading,
            className: "text-zinc-400 hover:text-red-600 p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",
            title: "Remove Domain",
            children: /* @__PURE__ */ jsx(Trash2, {
              className: "w-5 h-5"
            })
          })]
        }), domainInfo.status !== "active" && /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-lg p-4 mb-4",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold text-zinc-900 dark:text-zinc-100 text-sm mb-3",
            children: "DNS Configuration Required"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-600 dark:text-zinc-400 mb-4",
            children: "To verify ownership and route traffic, please add the following DNS records to your domain provider (e.g. GoDaddy, Namecheap)."
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-3",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded p-3 text-sm font-mono flex justify-between items-center group",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex-1",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Type"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200",
                  children: "CNAME"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-[2] border-l border-zinc-100 dark:border-zinc-800 pl-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Name (Host)"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200",
                  children: domainInfo.domain
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-[3] border-l border-zinc-100 dark:border-zinc-800 pl-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Content (Target)"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200 break-all",
                  children: "studio-platform-web.pages.dev"
                })]
              })]
            }), domainInfo.dns_records?.length > 0 && domainInfo.dns_records.map((rec, i) => /* @__PURE__ */ jsxs("div", {
              className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded p-3 text-sm font-mono flex justify-between items-center group",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex-1",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Type"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200",
                  children: "TXT"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-[2] border-l border-zinc-100 dark:border-zinc-800 pl-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Name"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200",
                  children: rec.txt_name || "_cf-custom-hostname"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-[3] border-l border-zinc-100 dark:border-zinc-800 pl-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-400 uppercase tracking-wide mb-1",
                  children: "Content"
                }), /* @__PURE__ */ jsx("div", {
                  className: "font-semibold text-zinc-800 dark:text-zinc-200 break-all",
                  children: rec.txt_value
                })]
              })]
            }, i))]
          }), /* @__PURE__ */ jsx("div", {
            className: "mt-4 flex justify-end",
            children: /* @__PURE__ */ jsxs("button", {
              onClick: () => window.location.reload(),
              className: "text-xs font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1",
              children: [/* @__PURE__ */ jsx(RefreshCw, {
                className: "w-3 h-3"
              }), " Check Verification Status"]
            })
          })]
        }), domainInfo.status === "active" && /* @__PURE__ */ jsxs("div", {
          className: "bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 p-4 rounded-lg flex items-start gap-3",
          children: [/* @__PURE__ */ jsx(ShieldCheck, {
            className: "w-5 h-5 shrink-0 mt-0.5"
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-semibold text-sm",
              children: "SSL Certificate Active"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm mt-1 opacity-90",
              children: "Your custom domain is secured with a managed SSL certificate. It may take up to 24 hours for DNS to propagate globally."
            }), /* @__PURE__ */ jsxs("a", {
              href: `https://${domainInfo.domain}`,
              target: "_blank",
              rel: "noreferrer",
              className: "inline-flex items-center gap-1 mt-3 text-sm font-medium hover:underline",
              children: ["Visit ", domainInfo.domain, " ", /* @__PURE__ */ jsx(ExternalLink, {
                className: "w-3 h-3"
              })]
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: showDeleteConfirm,
      onClose: () => setShowDeleteConfirm(false),
      onConfirm: confirmDelete,
      title: "Disconnect Domain",
      message: "Are you sure? This will disconnect your custom domain immediately. Your studio will revert to the default subdomain.",
      confirmText: "Disconnect",
      isDestructive: true
    })]
  });
});
const route45 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_domain,
  loader: loader$R
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_settings_embeds = UNSAFE_withComponentProps(function StudioSettingsEmbeds() {
  const {
    tenant
  } = useOutletContext();
  const {
    slug
  } = useParams();
  const [copied, setCopied] = useState(null);
  const baseUrl = typeof window !== "undefined" ? window.location.origin : "https://platform.com";
  const calendarUrl = `${baseUrl}/embed/${slug}/calendar`;
  const getIframeCode = (url, height = 800) => {
    return `<iframe 
  src="${url}" 
  style="width: 100%; height: ${height}px; border: none; border-radius: 8px; overflow: hidden;"
  title="${tenant.name} Schedule"
></iframe>`;
  };
  const handleCopy = (code, id) => {
    navigator.clipboard.writeText(code);
    setCopied(id);
    setTimeout(() => setCopied(null), 2e3);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl p-8 animate-in fade-in duration-500",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 tracking-tight mb-2",
        children: "Website Widgets"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Embed your studio schedule directly into your website (Wix, Squarespace, WordPress, etc.)."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-xl h-fit",
              children: /* @__PURE__ */ jsx(Link$1, {
                size: 24
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h3", {
                className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
                children: "Class Calendar"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm text-zinc-500 mt-1 max-w-lg",
                children: "Display your upcoming classes. Students can view details and clear up availability. Booking actions will open in a secure window."
              })]
            })]
          }), /* @__PURE__ */ jsxs("a", {
            href: calendarUrl,
            target: "_blank",
            rel: "noreferrer",
            className: "flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline",
            children: [/* @__PURE__ */ jsx(ExternalLink, {
              size: 14
            }), "Preview"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 font-mono text-xs overflow-x-auto relative group",
          children: [/* @__PURE__ */ jsx("code", {
            className: "text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap break-all",
            children: getIframeCode(calendarUrl)
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => handleCopy(getIframeCode(calendarUrl), "calendar"),
            className: "absolute top-4 right-4 p-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md shadow-sm hover:bg-zinc-50 transition-colors",
            children: copied === "calendar" ? /* @__PURE__ */ jsx(Check, {
              size: 14,
              className: "text-emerald-500"
            }) : /* @__PURE__ */ jsx(Copy, {
              size: 14,
              className: "text-zinc-500"
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "mt-6 flex flex-col gap-4",
          children: [/* @__PURE__ */ jsx("h4", {
            className: "font-bold text-sm text-zinc-900 dark:text-zinc-100",
            children: "Setup Instructions"
          }), /* @__PURE__ */ jsxs("ol", {
            className: "list-decimal list-inside text-sm text-zinc-600 dark:text-zinc-400 space-y-2",
            children: [/* @__PURE__ */ jsx("li", {
              children: "Copy the code snippet above."
            }), /* @__PURE__ */ jsx("li", {
              children: "Go to your website builder (Wix, Squarespace, etc.)."
            }), /* @__PURE__ */ jsxs("li", {
              children: ["Add an ", /* @__PURE__ */ jsx("strong", {
                children: "Embed"
              }), " or ", /* @__PURE__ */ jsx("strong", {
                children: "HTML Code"
              }), " block."]
            }), /* @__PURE__ */ jsx("li", {
              children: "Paste the code snippet and save."
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 shadow-sm",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-6",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-3 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-xl h-fit",
              children: /* @__PURE__ */ jsx(Code, {
                size: 24
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h3", {
                className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
                children: "Membership Pricing"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm text-zinc-500 mt-1 max-w-lg",
                children: "Showcase your memberships and class packs. The layout is responsive and adapts to your site width."
              })]
            })]
          }), /* @__PURE__ */ jsxs("a", {
            href: `${baseUrl}/embed/${slug}/pricing`,
            target: "_blank",
            rel: "noreferrer",
            className: "flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline",
            children: [/* @__PURE__ */ jsx(ExternalLink, {
              size: 14
            }), "Preview"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 font-mono text-xs overflow-x-auto relative group",
          children: [/* @__PURE__ */ jsx("code", {
            className: "text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap break-all",
            children: getIframeCode(`${baseUrl}/embed/${slug}/pricing`, 600)
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => handleCopy(getIframeCode(`${baseUrl}/embed/${slug}/pricing`, 600), "pricing"),
            className: "absolute top-4 right-4 p-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md shadow-sm hover:bg-zinc-50 transition-colors",
            children: copied === "pricing" ? /* @__PURE__ */ jsx(Check, {
              size: 14,
              className: "text-emerald-500"
            }) : /* @__PURE__ */ jsx(Copy, {
              size: 14,
              className: "text-zinc-500"
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "mt-6 flex flex-col gap-4",
          children: [/* @__PURE__ */ jsx("h4", {
            className: "font-bold text-sm text-zinc-900 dark:text-zinc-100",
            children: "Usage Tips"
          }), /* @__PURE__ */ jsxs("ul", {
            className: "list-disc list-inside text-sm text-zinc-600 dark:text-zinc-400 space-y-2",
            children: [/* @__PURE__ */ jsxs("li", {
              children: ["Set the iframe height to ", /* @__PURE__ */ jsx("code", {
                children: "600px"
              }), " or more to avoid scrollbars."]
            }), /* @__PURE__ */ jsx("li", {
              children: "If you have no memberships created, a demo preview (based on average studio pricing) will appear to help you visualize the layout."
            })]
          })]
        })]
      })]
    })]
  });
});
const route46 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_embeds
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_settings_mobile = UNSAFE_withComponentProps(function MobileAppSettings() {
  const {
    tenant,
    token
  } = useOutletContext();
  const [loading, setLoading] = useState(false);
  const [uploading, setUploading] = useState(null);
  const [config, setConfig] = useState(tenant.mobileAppConfig || {
    appName: tenant.name,
    iconUrl: "",
    splashUrl: "",
    primaryColor: tenant.branding?.primaryColor || "#000000"
  });
  const [message, setMessage] = useState(null);
  const handleImageUpload = async (file, type) => {
    setUploading(type);
    setMessage(null);
    try {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("title", `Mobile App ${type === "icon" ? "Icon" : "Splash"} - ${file.name}`);
      const res = await apiRequest("/uploads/r2-image", token, {
        method: "POST",
        body: formData
      });
      if (res.url) {
        setConfig((prev) => ({
          ...prev,
          [type + "Url"]: res.url
        }));
        setMessage({
          type: "success",
          text: `${type === "icon" ? "Icon" : "Splash Screen"} uploaded successfully.`
        });
      } else {
        throw new Error("Upload failed, no URL returned.");
      }
    } catch (e) {
      console.error(e);
      setMessage({
        type: "error",
        text: `Upload failed: ${e.message}`
      });
    } finally {
      setUploading(null);
    }
  };
  const handleSave = async () => {
    setLoading(true);
    setMessage(null);
    try {
      const res = await apiRequest("/tenant/settings", token, {
        method: "PATCH",
        body: JSON.stringify({
          mobileAppConfig: config
        })
      });
      if (res.success) {
        setMessage({
          type: "success",
          text: "Mobile app settings saved successfully."
        });
      } else {
        throw new Error("Failed to save.");
      }
    } catch (e) {
      setMessage({
        type: "error",
        text: e.message
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-4xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-4 mb-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",
        children: /* @__PURE__ */ jsx(Smartphone, {
          className: "text-blue-600 dark:text-blue-400",
          size: 32
        })
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Mobile App Builder"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Customize your white-label mobile application."
        })]
      })]
    }), message && /* @__PURE__ */ jsxs("div", {
      className: `mb-6 p-4 rounded-lg flex items-center gap-2 ${message.type === "success" ? "bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300" : "bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300"}`,
      children: [message.type === "success" ? /* @__PURE__ */ jsx(CheckCircle2, {
        size: 18
      }) : /* @__PURE__ */ jsx(AlertCircle, {
        size: 18
      }), /* @__PURE__ */ jsx("span", {
        className: "text-sm font-medium",
        children: message.text
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
            children: "App Identity"
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "App Name"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                value: config.appName,
                onChange: (e) => setConfig({
                  ...config,
                  appName: e.target.value
                }),
                className: "w-full text-sm p-2 rounded border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none",
                placeholder: "My Studio App"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-400 mt-1",
                children: "This name will appear on the user's home screen."
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "Primary Color"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "color",
                  value: config.primaryColor,
                  onChange: (e) => setConfig({
                    ...config,
                    primaryColor: e.target.value
                  }),
                  className: "h-9 w-16 p-0 rounded border border-zinc-200 dark:border-zinc-700 cursor-pointer"
                }), /* @__PURE__ */ jsx("input", {
                  type: "text",
                  value: config.primaryColor,
                  onChange: (e) => setConfig({
                    ...config,
                    primaryColor: e.target.value
                  }),
                  className: "flex-1 text-sm p-2 rounded border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 uppercase font-mono focus:ring-2 focus:ring-blue-500 outline-none"
                })]
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold mb-4 text-zinc-900 dark:text-zinc-100",
            children: "Assets"
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-6",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "App Icon"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2 mb-2",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "text",
                  value: config.iconUrl,
                  onChange: (e) => setConfig({
                    ...config,
                    iconUrl: e.target.value
                  }),
                  className: "flex-1 text-sm p-2 rounded border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none",
                  placeholder: "https://..."
                }), /* @__PURE__ */ jsxs("label", {
                  className: `cursor-pointer bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300 px-3 py-2 rounded-md transition-colors border border-zinc-200 dark:border-zinc-700 flex items-center gap-2 ${uploading === "icon" ? "opacity-50 cursor-not-allowed" : ""}`,
                  children: [/* @__PURE__ */ jsx(Upload, {
                    size: 16
                  }), /* @__PURE__ */ jsx("span", {
                    className: "text-sm font-medium",
                    children: uploading === "icon" ? "..." : "Upload"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "file",
                    accept: "image/*",
                    className: "hidden",
                    disabled: !!uploading,
                    onChange: (e) => e.target.files?.[0] && handleImageUpload(e.target.files[0], "icon")
                  })]
                })]
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-400 mt-1",
                children: "Recommended: 1024x1024 PNG (No transparency)"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-bold text-zinc-500 uppercase mb-1",
                children: "Splash Screen"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2 mb-2",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "text",
                  value: config.splashUrl,
                  onChange: (e) => setConfig({
                    ...config,
                    splashUrl: e.target.value
                  }),
                  className: "flex-1 text-sm p-2 rounded border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none",
                  placeholder: "https://..."
                }), /* @__PURE__ */ jsxs("label", {
                  className: `cursor-pointer bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300 px-3 py-2 rounded-md transition-colors border border-zinc-200 dark:border-zinc-700 flex items-center gap-2 ${uploading === "splash" ? "opacity-50 cursor-not-allowed" : ""}`,
                  children: [/* @__PURE__ */ jsx(Upload, {
                    size: 16
                  }), /* @__PURE__ */ jsx("span", {
                    className: "text-sm font-medium",
                    children: uploading === "splash" ? "..." : "Upload"
                  }), /* @__PURE__ */ jsx("input", {
                    type: "file",
                    accept: "image/*",
                    className: "hidden",
                    disabled: !!uploading,
                    onChange: (e) => e.target.files?.[0] && handleImageUpload(e.target.files[0], "splash")
                  })]
                })]
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: handleSave,
          disabled: loading,
          className: "w-full py-2.5 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg font-bold hover:opacity-90 transition-opacity flex justify-center items-center gap-2",
          children: [loading && /* @__PURE__ */ jsx(Loader2, {
            size: 16,
            className: "animate-spin"
          }), "Save Configuration"]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex justify-center pt-8",
        children: /* @__PURE__ */ jsxs("div", {
          className: "relative border-4 border-zinc-800 bg-zinc-900 rounded-[3rem] h-[600px] w-[300px] shadow-2xl overflow-hidden",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "absolute top-0 w-full h-8 bg-black/20 z-20 flex justify-between px-4 items-center text-[10px] text-white font-bold",
            children: [/* @__PURE__ */ jsx("span", {
              children: "9:41"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-1",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-3 h-3 bg-white rounded-full opacity-50"
              }), /* @__PURE__ */ jsx("div", {
                className: "w-3 h-3 bg-white rounded-full"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "h-full w-full bg-white flex flex-col pt-12",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "px-4 pb-4 border-b border-zinc-100 flex items-center justify-between",
              children: [/* @__PURE__ */ jsx("h2", {
                className: "font-bold text-lg",
                style: {
                  color: config.primaryColor
                },
                children: config.appName || "Studio App"
              }), /* @__PURE__ */ jsx("div", {
                className: "w-8 h-8 rounded-full bg-zinc-100"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "p-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "aspect-video rounded-xl bg-zinc-100 mb-4 flex items-center justify-center text-zinc-300 relative overflow-hidden",
                children: config.splashUrl ? /* @__PURE__ */ jsx("img", {
                  src: config.splashUrl,
                  alt: "Splash",
                  className: "w-full h-full object-cover"
                }) : /* @__PURE__ */ jsx(Image$1, {
                  size: 24
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "space-y-2",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "h-4 w-2/3 bg-zinc-100 rounded"
                }), /* @__PURE__ */ jsx("div", {
                  className: "h-4 w-1/2 bg-zinc-100 rounded"
                })]
              })]
            }), config.iconUrl && /* @__PURE__ */ jsxs("div", {
              className: "absolute bottom-12 left-1/2 -translate-x-1/2 flex flex-col items-center",
              children: [/* @__PURE__ */ jsx("img", {
                src: config.iconUrl,
                alt: "Icon",
                className: "w-16 h-16 rounded-2xl shadow-lg mb-2 bg-white"
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-white bg-black/50 px-2 py-0.5 rounded",
                children: "App Icon"
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1 bg-white/50 rounded-full"
          })]
        })
      })]
    })]
  });
});
const route47 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_mobile
}, Symbol.toStringTag, { value: "Module" }));
const ConfigNode = ({
  node,
  index,
  parentPath,
  onUpdate,
  onDelete
}) => {
  const [expanded, setExpanded] = useState(true);
  return /* @__PURE__ */ jsxs("div", {
    className: "border border-zinc-200 dark:border-zinc-800 rounded-lg bg-white dark:bg-zinc-900 overflow-hidden mb-2",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "p-3 bg-zinc-50 dark:bg-zinc-800/50 flex items-center gap-2 border-b border-zinc-100 dark:border-zinc-800",
      children: [/* @__PURE__ */ jsx("button", {
        onClick: () => setExpanded(!expanded),
        className: "p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded text-zinc-500 dark:text-zinc-400",
        children: /* @__PURE__ */ jsx(ChevronRight, {
          size: 14,
          className: `transition-transform ${expanded ? "rotate-90" : ""}`
        })
      }), /* @__PURE__ */ jsx("input", {
        value: node.label,
        onChange: (e) => onUpdate({
          ...node,
          label: e.target.value
        }),
        className: "bg-transparent font-medium text-sm focus:outline-none flex-1 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400",
        placeholder: "Option Label"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-1",
        children: [/* @__PURE__ */ jsxs("select", {
          value: node.type,
          onChange: (e) => onUpdate({
            ...node,
            type: e.target.value,
            children: e.target.value === "menu" ? [] : void 0
          }),
          className: "text-xs border border-zinc-200 dark:border-zinc-700 rounded px-1 py-0.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200",
          children: [/* @__PURE__ */ jsx("option", {
            value: "action",
            children: "Action"
          }), /* @__PURE__ */ jsx("option", {
            value: "menu",
            children: "Sub-Menu"
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: onDelete,
          className: "text-red-500 p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",
          children: /* @__PURE__ */ jsx(Trash2, {
            size: 14
          })
        })]
      })]
    }), expanded && /* @__PURE__ */ jsx("div", {
      className: "p-3 space-y-3 bg-white dark:bg-zinc-900",
      children: node.type === "action" ? /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-2 gap-3",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-1",
            children: "Route To Role"
          }), /* @__PURE__ */ jsxs("select", {
            value: node.routeToRole || "support",
            onChange: (e) => onUpdate({
              ...node,
              routeToRole: e.target.value
            }),
            className: "w-full text-sm border border-zinc-200 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 focus:ring-2 focus:ring-black dark:focus:ring-zinc-600 outline-none",
            children: [/* @__PURE__ */ jsx("option", {
              value: "support",
              children: "General Support"
            }), /* @__PURE__ */ jsx("option", {
              value: "instructor",
              children: "Instructor"
            }), /* @__PURE__ */ jsx("option", {
              value: "admin",
              children: "Admin / Billing"
            }), /* @__PURE__ */ jsx("option", {
              value: "owner",
              children: "Owner"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-1",
            children: "Auto-Reply Message"
          }), /* @__PURE__ */ jsx("input", {
            value: node.autoReply || "",
            onChange: (e) => onUpdate({
              ...node,
              autoReply: e.target.value
            }),
            className: "w-full text-sm border border-zinc-200 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 focus:ring-2 focus:ring-black dark:focus:ring-zinc-600 outline-none",
            placeholder: "Optional auto-reply..."
          })]
        })]
      }) : /* @__PURE__ */ jsxs("div", {
        className: "pl-4 border-l-2 border-zinc-100 dark:border-zinc-800",
        children: [node.children?.map((child, i) => /* @__PURE__ */ jsx(ConfigNode, {
          node: child,
          index: i,
          parentPath: [...parentPath, i],
          onUpdate: (updated) => {
            const newChildren = [...node.children || []];
            newChildren[i] = updated;
            onUpdate({
              ...node,
              children: newChildren
            });
          },
          onDelete: () => {
            const newChildren = [...node.children || []];
            newChildren.splice(i, 1);
            onUpdate({
              ...node,
              children: newChildren
            });
          }
        }, child.id)), /* @__PURE__ */ jsxs("button", {
          onClick: () => {
            const newChild = {
              id: crypto.randomUUID(),
              label: "New Option",
              type: "action"
            };
            onUpdate({
              ...node,
              children: [...node.children || [], newChild]
            });
          },
          className: "flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 font-medium mt-2 hover:underline",
          children: [/* @__PURE__ */ jsx(CornerDownRight, {
            size: 12
          }), " Add Sub-Option"]
        })]
      })
    })]
  });
};
const studio_$slug_settings_chat = UNSAFE_withComponentProps(function ChatSettingsPage() {
  const {
    slug
  } = useParams();
  const {
    tenant
  } = useOutletContext() || {};
  const [config, setConfig] = useState(tenant?.settings?.chatConfig || [{
    id: "init-1",
    label: "I have a question about classes",
    type: "action",
    actionType: "message",
    routeToRole: "instructor",
    autoReply: "An instructor will get back to you shortly."
  }, {
    id: "init-2",
    label: "Billing Issue",
    type: "action",
    actionType: "message",
    routeToRole: "admin",
    autoReply: "We are checking your billing details."
  }]);
  const [saving, setSaving] = useState(false);
  const handleSave = async () => {
    setSaving(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/studios/${tenant.id}/integrations`, token, {
        method: "PUT",
        headers: {
          "X-Tenant-Slug": slug || ""
        },
        body: JSON.stringify({
          chatEnabled: tenant.settings?.chatEnabled,
          // Keep existing toggle state
          chatConfig: config
        })
      });
      toast.success("Chat configuration saved!");
      window.location.reload();
    } catch (e) {
      toast.error(e.message || "Failed to save");
    } finally {
      setSaving(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-20",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-6 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Chat Configuration"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Design the decision tree for your support chat."
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: handleSave,
        disabled: saving,
        className: "flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 transition-colors font-medium",
        children: saving ? "Saving..." : /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsx(Save, {
            size: 16
          }), " Save Config"]
        })
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "grid gap-6",
      children: /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsx(CardTitle, {
            children: "Main Menu"
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "These are the top-level options users will see when they open the chat."
          })]
        }), /* @__PURE__ */ jsxs(CardContent, {
          children: [config.map((node, i) => /* @__PURE__ */ jsx(ConfigNode, {
            node,
            index: i,
            parentPath: [i],
            onUpdate: (updated) => {
              const newConfig = [...config];
              newConfig[i] = updated;
              setConfig(newConfig);
            },
            onDelete: () => {
              const newConfig = [...config];
              newConfig.splice(i, 1);
              setConfig(newConfig);
            }
          }, node.id || `node-${i}`)), /* @__PURE__ */ jsxs("button", {
            onClick: () => setConfig([...config, {
              id: crypto.randomUUID(),
              label: "New Option",
              type: "action"
            }]),
            className: "w-full py-3 border-2 border-dashed border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-500 dark:text-zinc-400 hover:border-zinc-300 dark:hover:border-zinc-600 hover:text-zinc-700 dark:hover:text-zinc-300 font-medium text-sm flex items-center justify-center gap-2 mt-4 transition-colors",
            children: [/* @__PURE__ */ jsx(Plus, {
              size: 16
            }), " Add Root Option"]
          })]
        })]
      })
    })]
  });
});
const route48 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_chat
}, Symbol.toStringTag, { value: "Module" }));
function QRCodeDisplay({
  value,
  title,
  description,
  size = 200,
  color = "#000000",
  bgColor = "#FFFFFF"
}) {
  const wrapperRef = useRef(null);
  const downloadQRCode = () => {
    if (!wrapperRef.current) return;
    const svg = wrapperRef.current.querySelector("svg");
    if (!svg) return;
    const svgData = new XMLSerializer().serializeToString(svg);
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const img = new Image();
    const padding = 40;
    canvas.width = size + padding * 2;
    canvas.height = size + padding * 2;
    img.onload = () => {
      if (!ctx) return;
      ctx.fillStyle = "#FFFFFF";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, padding, padding);
      const pngFile = canvas.toDataURL("image/png");
      const downloadLink = document.createElement("a");
      downloadLink.download = `${title || "qrcode"}.png`;
      downloadLink.href = pngFile;
      downloadLink.click();
    };
    img.src = "data:image/svg+xml;base64," + btoa(svgData);
  };
  return /* @__PURE__ */ jsxs("div", { className: "flex flex-col items-center p-6 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl shadow-sm hover:shadow-md transition-all", children: [
    title && /* @__PURE__ */ jsx("h3", { className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2", children: title }),
    description && /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 dark:text-zinc-400 text-center mb-6 max-w-[250px]", children: description }),
    /* @__PURE__ */ jsx("div", { ref: wrapperRef, className: "p-4 bg-white rounded-lg border border-zinc-100 dark:border-zinc-800 mb-6", children: /* @__PURE__ */ jsx(
      QRCode,
      {
        size,
        style: { height: "auto", maxWidth: "100%", width: "100%" },
        value,
        viewBox: `0 0 256 256`,
        fgColor: color,
        bgColor
      }
    ) }),
    /* @__PURE__ */ jsxs(
      "button",
      {
        onClick: downloadQRCode,
        className: "flex items-center gap-2 px-4 py-2 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-900 dark:text-zinc-100 text-sm font-medium rounded-lg transition-colors",
        children: [
          /* @__PURE__ */ jsx(Download, { size: 16 }),
          "Download PNG"
        ]
      }
    )
  ] });
}
const studio_$slug_settings_qr = UNSAFE_withComponentProps(function StudioQRCodes() {
  const {
    tenant
  } = useOutletContext();
  const [baseUrl, setBaseUrl] = useState("");
  useEffect(() => {
    if (typeof window !== "undefined") {
      setBaseUrl(window.location.origin);
    }
  }, []);
  const utmParams = "?utm_source=qr&utm_medium=offline";
  (tenant.customDomain ? `https://${tenant.customDomain}` : `${baseUrl}/site/${tenant.slug}`) + utmParams;
  const cleanPublicUrl = tenant.customDomain ? `https://${tenant.customDomain}` : `${baseUrl}/site/${tenant.slug}`;
  const publicUrlWithUtm = `${cleanPublicUrl}${utmParams}`;
  const scheduleUrlWithUtm = `${cleanPublicUrl}/classes${utmParams}`;
  const kioskUrlWithUtm = `${baseUrl}/studio/${tenant.slug}/checkin/kiosk${utmParams}`;
  const appUrl = tenant.mobileAppConfig?.publicDownloadUrl ? `${tenant.mobileAppConfig.publicDownloadUrl}${utmParams}` : "";
  if (!baseUrl) return null;
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "QR Codes"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Download and print these QR codes to display in your studio or share with students."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsx(QRCodeDisplay, {
        value: publicUrlWithUtm,
        title: "Studio Website",
        description: "Direct link to your studio's home page.",
        color: tenant.branding?.primaryColor || "#000000"
      }), /* @__PURE__ */ jsx(QRCodeDisplay, {
        value: kioskUrlWithUtm,
        title: "Kiosk Check-in",
        description: "Display this at your front desk for quick student check-ins.",
        color: tenant.branding?.primaryColor || "#000000"
      }), /* @__PURE__ */ jsx(QRCodeDisplay, {
        value: scheduleUrlWithUtm,
        title: "Class Schedule",
        description: "Direct link for students to view classes and book.",
        color: tenant.branding?.primaryColor || "#000000"
      }), appUrl && /* @__PURE__ */ jsx(QRCodeDisplay, {
        value: appUrl,
        title: "Download App",
        description: "Direct link to download your studio's mobile app.",
        color: tenant.branding?.primaryColor || "#000000"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mt-12 p-6 bg-blue-50 dark:bg-zinc-900 border border-blue-100 dark:border-zinc-800 rounded-xl",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",
        children: "ðŸ’¡ Tips for using QR Codes"
      }), /* @__PURE__ */ jsxs("ul", {
        className: "list-disc list-inside text-sm text-blue-800 dark:text-blue-200 space-y-1",
        children: [/* @__PURE__ */ jsxs("li", {
          children: ["Print the ", /* @__PURE__ */ jsx("strong", {
            children: "Kiosk Check-in"
          }), " code and place it on your front desk."]
        }), /* @__PURE__ */ jsxs("li", {
          children: ["Add the ", /* @__PURE__ */ jsx("strong", {
            children: "Studio Website"
          }), " code to your business cards or flyers."]
        }), /* @__PURE__ */ jsxs("li", {
          children: ["Post the ", /* @__PURE__ */ jsx("strong", {
            children: "Download App"
          }), " code in your lobby to encourage students to book via the app."]
        })]
      })]
    })]
  });
});
const route49 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_settings_qr
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_students = UNSAFE_withComponentProps(function StudioStudentsLayout() {
  const context = useOutletContext();
  return /* @__PURE__ */ jsx(Outlet, {
    context
  });
});
const route50 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_students
}, Symbol.toStringTag, { value: "Module" }));
const loader$Q = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const res = await apiRequest("/members", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    const members = Array.isArray(res.members) ? res.members : [];
    return {
      members
    };
  } catch (e) {
    console.error("Failed to load members", e);
    return {
      members: [],
      error: e.message,
      errorDetails: e.data
    };
  }
};
const studio_$slug_students__index = UNSAFE_withComponentProps(function StudioStudents() {
  const {
    members,
    error,
    errorDetails
  } = useLoaderData();
  const {
    roles
  } = useOutletContext();
  const params = useParams();
  const slug = params.slug;
  const isOwner = roles && roles.includes("owner");
  const {
    getToken
  } = useAuth();
  const [updating, setUpdating] = useState(null);
  const [searchQuery, setSearchQuery] = useState("");
  const [isAddingMember, setIsAddingMember] = useState(false);
  const [isSubmittingMember, setIsSubmittingMember] = useState(false);
  const [editingMember, setEditingMember] = useState(null);
  const [pendingRoleChange, setPendingRoleChange] = useState(null);
  const [showRemoveConfirm, setShowRemoveConfirm] = useState(false);
  const [selectedIds, setSelectedIds] = useState(/* @__PURE__ */ new Set());
  const [bulkAction, setBulkAction] = useState(null);
  const [isProcessingBulk, setIsProcessingBulk] = useState(false);
  const toggleSelectAll = () => {
    if (selectedIds.size === filteredMembers.length) {
      setSelectedIds(/* @__PURE__ */ new Set());
    } else {
      setSelectedIds(new Set(filteredMembers.map((m) => m.id)));
    }
  };
  const toggleSelect = (id) => {
    const next = new Set(selectedIds);
    if (next.has(id)) next.delete(id);
    else next.add(id);
    setSelectedIds(next);
  };
  const filteredMembers = (members || []).filter((m) => {
    const q = searchQuery.toLowerCase();
    const name = `${m.user?.profile?.firstName || ""} ${m.user?.profile?.lastName || ""}`.toLowerCase();
    const email = (m.user?.email || "").toLowerCase();
    return name.includes(q) || email.includes(q);
  });
  const handleAddMember = async (e) => {
    e.preventDefault();
    setIsSubmittingMember(true);
    const formData = new FormData(e.currentTarget);
    const email = formData.get("email");
    const firstName = formData.get("firstName");
    const lastName = formData.get("lastName");
    if (!slug) {
      toast.error("Missing studio slug");
      setIsSubmittingMember(false);
      return;
    }
    try {
      const token = await getToken();
      const res = await apiRequest(`/members`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          email,
          firstName,
          lastName
        })
      });
      if (res.error) {
        toast.error(res.error);
      } else {
        toast.success("Member added successfully");
        window.location.reload();
      }
    } catch (e2) {
      toast.error(e2.message);
    } finally {
      setIsSubmittingMember(false);
      setIsAddingMember(false);
    }
  };
  const handleRemoveMember = async () => {
    if (!editingMember) return;
    setShowRemoveConfirm(true);
  };
  const confirmRemoveMember = async () => {
    if (!editingMember) return;
    setUpdating(editingMember.id);
    try {
      const token = await getToken();
      const res = await apiRequest(`/members/${editingMember.id}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      if (res.error) toast.error(res.error);
      else {
        toast.success("Member removed");
        setEditingMember(null);
        window.location.reload();
      }
    } catch (e) {
      toast.error(e.message);
    } finally {
      setUpdating(null);
      setShowRemoveConfirm(false);
    }
  };
  const handleRoleChange = (memberId, newRole) => {
    setPendingRoleChange({
      memberId,
      newRole
    });
  };
  const confirmRoleChange = async () => {
    if (!pendingRoleChange) return;
    const {
      memberId,
      newRole
    } = pendingRoleChange;
    setUpdating(memberId);
    if (!slug) {
      toast.error("Missing studio slug");
      setUpdating(null);
      return;
    }
    try {
      const token = await getToken();
      const res = await apiRequest(`/members/${memberId}/role`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          role: newRole
        })
      });
      if (res.error) toast.error(res.error);
      else {
        toast.success("Role updated");
        window.location.reload();
      }
    } catch (e) {
      toast.error(e.message);
    } finally {
      setUpdating(null);
      setPendingRoleChange(null);
    }
  };
  const handleBulkAction = async (action2, data) => {
    if (selectedIds.size === 0) return;
    setIsProcessingBulk(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/members/bulk`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          action: action2,
          memberIds: Array.from(selectedIds),
          data
        })
      });
      if (res.error) {
        toast.error(res.error);
      } else if (action2 === "export" && res.csv) {
        const blob = new Blob([res.csv], {
          type: "text/csv"
        });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.setAttribute("hidden", "");
        a.setAttribute("href", url);
        a.setAttribute("download", `members_export_${(/* @__PURE__ */ new Date()).getTime()}.csv`);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        toast.success("Export started");
      } else {
        toast.success("Bulk action completed successfully");
        window.location.reload();
      }
    } catch (e) {
      toast.error(e.message);
    } finally {
      setIsProcessingBulk(false);
      setBulkAction(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "People"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2",
        children: [/* @__PURE__ */ jsx("input", {
          placeholder: "Search members...",
          value: searchQuery,
          onChange: (e) => setSearchQuery(e.target.value),
          className: "px-3 py-2 border border-zinc-200 dark:border-zinc-800 rounded-md text-sm min-w-[250px] bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setIsAddingMember(true),
          className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 text-sm font-medium transition-colors",
          children: "Add Member"
        })]
      })]
    }), error && /* @__PURE__ */ jsxs("div", {
      className: "bg-red-50 text-red-700 p-4 rounded mb-4 text-sm border border-red-100",
      children: ["Failed to load members: ", error, errorDetails && /* @__PURE__ */ jsx("pre", {
        className: "mt-2 text-xs bg-red-100 p-2 rounded overflow-auto",
        children: JSON.stringify(errorDetails, null, 2)
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider w-10",
              children: /* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "rounded border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-blue-600 focus:ring-blue-500",
                checked: filteredMembers.length > 0 && selectedIds.size === filteredMembers.length,
                onChange: toggleSelectAll
              })
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Name"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Email"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Role"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Joined"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: members.length === 0 ? /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 5,
              className: "px-6 py-8 text-center text-zinc-500 dark:text-zinc-400 italic",
              children: "No members found yet."
            })
          }) : filteredMembers.length === 0 ? /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsxs("td", {
              colSpan: 5,
              className: "px-6 py-8 text-center text-zinc-500 dark:text-zinc-400 italic",
              children: ['No members match your search for "', searchQuery, '".']
            })
          }) : filteredMembers.map((member) => /* @__PURE__ */ jsxs("tr", {
            className: `hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors ${selectedIds.has(member.id) ? "bg-blue-50/50 dark:bg-blue-900/10" : ""}`,
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("input", {
                type: "checkbox",
                className: "rounded border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-blue-600 focus:ring-blue-500",
                checked: selectedIds.has(member.id),
                onChange: () => toggleSelect(member.id)
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 font-medium text-zinc-900 dark:text-zinc-100",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "h-8 w-8 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-xs font-bold uppercase ring-1 ring-blue-200 dark:ring-blue-800",
                  children: (member.user?.email || "??").substring(0, 2)
                }), /* @__PURE__ */ jsx(Link, {
                  to: `${member.id}`,
                  className: "hover:text-blue-600 dark:hover:text-blue-400 hover:underline",
                  children: member.user?.profile?.firstName ? `${member.user.profile.firstName} ${member.user.profile.lastName}` : "Unknown Student"
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-zinc-600 dark:text-zinc-400 text-sm",
              children: member.user.email
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: isOwner ? /* @__PURE__ */ jsxs("select", {
                disabled: updating === member.id,
                className: "text-sm border border-zinc-200 dark:border-zinc-700 rounded-md p-1.5 bg-zinc-50 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none",
                value: (Array.isArray(member.roles) ? member.roles : []).find((r) => r.role === "owner" || r.role === "instructor")?.role || "student",
                onChange: (e) => handleRoleChange(member.id, e.target.value),
                children: [/* @__PURE__ */ jsx("option", {
                  value: "student",
                  children: "Student"
                }), /* @__PURE__ */ jsx("option", {
                  value: "instructor",
                  children: "Instructor"
                }), /* @__PURE__ */ jsx("option", {
                  value: "owner",
                  children: "Owner"
                })]
              }) : /* @__PURE__ */ jsx("span", {
                className: "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 capitalize border border-zinc-200 dark:border-zinc-700",
                children: (Array.isArray(member.roles) ? member.roles : []).map((r) => r.role).join(", ") || "Student"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-zinc-500 dark:text-zinc-400 text-sm",
              children: new Date(member.joinedAt).toLocaleDateString()
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("button", {
                onClick: () => setEditingMember(member),
                className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 text-sm font-medium transition-colors",
                children: "Edit"
              })
            })]
          }, member.id))
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50 text-center text-xs text-zinc-500 dark:text-zinc-400",
        children: ["Showing ", filteredMembers.length, " member", filteredMembers.length === 1 ? "" : "s"]
      })]
    }), isAddingMember && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-md shadow-2xl border border-zinc-200 dark:border-zinc-700 animate-in zoom-in-95 duration-200",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "Add New Member"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsAddingMember(false),
            className: "text-zinc-400 hover:text-zinc-600",
            children: /* @__PURE__ */ jsxs("svg", {
              xmlns: "http://www.w3.org/2000/svg",
              width: "24",
              height: "24",
              viewBox: "0 0 24 24",
              fill: "none",
              stroke: "currentColor",
              strokeWidth: "2",
              strokeLinecap: "round",
              strokeLinejoin: "round",
              children: [/* @__PURE__ */ jsx("path", {
                d: "M18 6 6 18"
              }), /* @__PURE__ */ jsx("path", {
                d: "m6 6 18 18"
              })]
            })
          })]
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleAddMember,
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Email Address"
            }), /* @__PURE__ */ jsx("input", {
              type: "email",
              name: "email",
              required: true,
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-shadow",
              placeholder: "student@example.com"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
                children: "First Name"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                name: "firstName",
                className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-shadow",
                placeholder: "Jane"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
                children: "Last Name"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                name: "lastName",
                className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-shadow",
                placeholder: "Doe"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3 mt-6 pt-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsAddingMember(false),
              className: "px-4 py-2 text-sm font-medium border border-zinc-300 dark:border-zinc-700 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300 transition-colors",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: isSubmittingMember,
              className: "px-4 py-2 text-sm font-bold bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 transition-colors shadow-sm",
              children: isSubmittingMember ? "Adding Member..." : "Add Member"
            })]
          })]
        })]
      })
    }), editingMember && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-md shadow-2xl border border-zinc-200 dark:border-zinc-700 animate-in zoom-in-95 duration-200",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "Manage Member"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setEditingMember(null),
            className: "text-zinc-400 hover:text-zinc-600",
            children: /* @__PURE__ */ jsxs("svg", {
              xmlns: "http://www.w3.org/2000/svg",
              width: "24",
              height: "24",
              viewBox: "0 0 24 24",
              fill: "none",
              stroke: "currentColor",
              strokeWidth: "2",
              strokeLinecap: "round",
              strokeLinejoin: "round",
              children: [/* @__PURE__ */ jsx("path", {
                d: "M18 6 6 18"
              }), /* @__PURE__ */ jsx("path", {
                d: "m6 6 18 18"
              })]
            })
          })]
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-500 mb-6",
          children: ["Managing ", /* @__PURE__ */ jsx("strong", {
            children: editingMember.user.email
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-6",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",
              children: "Role"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 disabled:opacity-50",
              value: (Array.isArray(editingMember.roles) ? editingMember.roles : []).find((r) => r.role === "owner" || r.role === "instructor")?.role || "student",
              onChange: (e) => handleRoleChange(editingMember.id, e.target.value),
              disabled: !isOwner,
              children: [/* @__PURE__ */ jsx("option", {
                value: "student",
                children: "Student"
              }), /* @__PURE__ */ jsx("option", {
                value: "instructor",
                children: "Instructor"
              })]
            }), !isOwner && /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 mt-1",
              children: "Only owners can manage roles."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-red-50 dark:bg-red-900/10 p-4 rounded-lg border border-red-100 dark:border-red-900/20",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "text-sm font-bold text-red-900 dark:text-red-400 mb-1",
              children: "Danger Zone"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-red-700 dark:text-red-300 mb-3",
              children: "Removing a member will archive their access to the studio."
            }), /* @__PURE__ */ jsx("button", {
              onClick: handleRemoveMember,
              disabled: updating === editingMember.id || !isOwner,
              className: "w-full px-4 py-2 text-sm bg-white dark:bg-zinc-900 border border-red-300 dark:border-red-800 text-red-700 dark:text-red-400 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-50 font-medium transition-colors",
              children: updating === editingMember.id ? "Removing..." : "Remove from Studio"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: showRemoveConfirm,
      onClose: () => setShowRemoveConfirm(false),
      onConfirm: confirmRemoveMember,
      title: "Remove Member",
      message: `Are you sure you want to remove ${editingMember?.user.email} from the studio? This will archive their membership.`,
      isDestructive: true,
      confirmText: "Remove"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!pendingRoleChange,
      onClose: () => setPendingRoleChange(null),
      onConfirm: confirmRoleChange,
      title: "Change Role",
      message: `Are you sure you want to change this user's role to ${pendingRoleChange?.newRole}?`,
      confirmText: "Change Role"
    }), selectedIds.size > 0 && /* @__PURE__ */ jsxs("div", {
      className: "fixed bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-4 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-6 py-4 rounded-full shadow-2xl z-50 animate-in slide-in-from-bottom-8 duration-300 ring-1 ring-white/10 dark:ring-black/10",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3 pr-4 border-r border-zinc-700 dark:border-zinc-300",
        children: [/* @__PURE__ */ jsxs("span", {
          className: "text-sm font-bold truncate max-w-[100px]",
          children: [selectedIds.size, " Selected"]
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setSelectedIds(/* @__PURE__ */ new Set()),
          className: "bg-zinc-800 dark:bg-zinc-200 p-1 rounded-full hover:bg-zinc-700 dark:hover:bg-zinc-300 transition-colors",
          children: /* @__PURE__ */ jsx(X, {
            size: 14
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => setBulkAction("email"),
          className: "flex items-center gap-2 px-3 py-1.5 rounded-full hover:bg-zinc-800 dark:hover:bg-zinc-200 text-sm font-medium transition-colors",
          children: [/* @__PURE__ */ jsx(Mail, {
            size: 16
          }), /* @__PURE__ */ jsx("span", {
            children: "Email"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setBulkAction("status"),
          className: "flex items-center gap-2 px-3 py-1.5 rounded-full hover:bg-zinc-800 dark:hover:bg-zinc-200 text-sm font-medium transition-colors",
          children: [/* @__PURE__ */ jsx(ShieldCheck, {
            size: 16
          }), /* @__PURE__ */ jsx("span", {
            children: "Status"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => handleBulkAction("export"),
          className: "flex items-center gap-2 px-3 py-1.5 rounded-full hover:bg-zinc-800 dark:hover:bg-zinc-200 text-sm font-medium transition-colors",
          children: [/* @__PURE__ */ jsx(Download, {
            size: 16
          }), /* @__PURE__ */ jsx("span", {
            children: "Export"
          })]
        })]
      })]
    }), bulkAction === "email" && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-lg shadow-2xl border border-zinc-200 dark:border-zinc-700",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-xl font-bold mb-4 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Mail, {
            className: "text-blue-500"
          }), "Bulk Email"]
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: (e) => {
            e.preventDefault();
            const formData = new FormData(e.currentTarget);
            handleBulkAction("email", {
              subject: formData.get("subject"),
              body: formData.get("body")
            });
          },
          children: [/* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Subject"
              }), /* @__PURE__ */ jsx("input", {
                name: "subject",
                required: true,
                className: "w-full px-3 py-2 border rounded-md dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
                placeholder: "Important Update"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Message"
              }), /* @__PURE__ */ jsx("textarea", {
                name: "body",
                required: true,
                rows: 5,
                className: "w-full px-3 py-2 border rounded-md dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
                placeholder: "Hello students..."
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3 mt-6",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setBulkAction(null),
              className: "px-4 py-2 text-sm border rounded-md",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: isProcessingBulk,
              className: "px-4 py-2 text-sm bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md font-bold disabled:opacity-50",
              children: isProcessingBulk ? "Sending..." : "Send to Selected"
            })]
          })]
        })]
      })
    }), bulkAction === "status" && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-sm shadow-2xl border border-zinc-200 dark:border-zinc-700",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-xl font-bold mb-4",
          children: "Update Status"
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-500 mb-6",
          children: ["Select a new status for the ", selectedIds.size, " selected members."]
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: (e) => {
            e.preventDefault();
            const formData = new FormData(e.currentTarget);
            handleBulkAction("status", {
              status: formData.get("status")
            });
          },
          children: [/* @__PURE__ */ jsxs("select", {
            name: "status",
            className: "w-full px-3 py-2 border rounded-md dark:bg-zinc-800 mb-6 text-zinc-900 dark:text-zinc-100",
            children: [/* @__PURE__ */ jsx("option", {
              value: "active",
              children: "Active"
            }), /* @__PURE__ */ jsx("option", {
              value: "inactive",
              children: "Inactive"
            }), /* @__PURE__ */ jsx("option", {
              value: "archived",
              children: "Archived"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setBulkAction(null),
              className: "px-4 py-2 text-sm border rounded-md",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: isProcessingBulk,
              className: "px-4 py-2 text-sm bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md font-bold",
              children: "Apply Changes"
            })]
          })]
        })]
      })
    })]
  });
});
const route51 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_students__index,
  loader: loader$Q
}, Symbol.toStringTag, { value: "Module" }));
const loader$P = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const memberId = params.id;
  if (!memberId) throw new Error("Member ID is required");
  try {
    const [memberData, notesData, packsData, couponsData] = await Promise.all([apiRequest(`/members/${memberId}`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest(`/members/${memberId}/notes`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest(`/commerce/packs`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest(`/members/${memberId}/coupons`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    })]);
    if (memberData.error) throw new Error(memberData.error);
    return {
      member: memberData.member,
      notes: notesData.notes || [],
      availablePacks: packsData.packs || [],
      coupons: couponsData?.coupons || []
    };
  } catch (e) {
    console.error("Failed to load student", e);
    throw e;
  }
};
const action$c = async (args) => {
  const {
    params,
    request
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const memberId = params.id;
  if (!memberId) return null;
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "add_note") {
    const note = formData.get("note");
    if (!note) return {
      error: "Note cannot be empty"
    };
    try {
      const res = await apiRequest(`/members/${memberId}/notes`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          note
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "delete_note") {
    const noteId = formData.get("noteId");
    try {
      const res = await apiRequest(`/members/${memberId}/notes/${noteId}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": params.slug
        }
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "edit_note") {
    const noteId = formData.get("noteId");
    const note = formData.get("note");
    try {
      const res = await apiRequest(`/members/${memberId}/notes/${noteId}`, token, {
        method: "PUT",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          note
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "assign_pack") {
    const packId = formData.get("packId");
    try {
      const res = await apiRequest(`/commerce/purchase`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          memberId,
          packId
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "update_profile") {
    const firstName = formData.get("firstName");
    const lastName = formData.get("lastName");
    const phone = formData.get("phone");
    try {
      const res = await apiRequest(`/members/${memberId}`, token, {
        method: "PUT",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          firstName,
          lastName,
          phone
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "send_email") {
    const subject = formData.get("subject");
    const body = formData.get("body");
    try {
      const res = await apiRequest(`/members/${memberId}/email`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          subject,
          body
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "update_status") {
    const status = formData.get("status");
    try {
      const res = await apiRequest(`/members/${memberId}/status`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          status
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  if (intent === "reactivate_coupon") {
    const couponId = formData.get("couponId");
    try {
      const res = await apiRequest(`/commerce/coupons/${couponId}/reactivate`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          days: 7
        })
      });
      if (res.error) return {
        error: res.error
      };
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  return null;
};
const studio_$slug_students_$id = UNSAFE_withComponentProps(function StudentProfile() {
  const {
    member,
    notes,
    availablePacks,
    coupons
  } = useLoaderData();
  const {
    isStudentView,
    tenant
  } = useOutletContext();
  const navigation = useNavigation();
  const submit = useSubmit();
  const userProfile = member.user.profile || {};
  const [activeTab, setActiveTab] = useState("overview");
  const [editingNoteId, setEditingNoteId] = useState(null);
  const [isAssigningPack, setIsAssigningPack] = useState(false);
  const [isEditingProfile, setIsEditingProfile] = useState(false);
  const [showActions, setShowActions] = useState(false);
  const [isSendingEmail, setIsSendingEmail] = useState(false);
  const [isDeactivating, setIsDeactivating] = useState(false);
  const [isUploadingPhoto, setIsUploadingPhoto] = useState(false);
  const [noteToDelete, setNoteToDelete] = useState(null);
  const fullName = [userProfile.firstName, userProfile.lastName].filter(Boolean).join(" ") || member.user.email;
  const rolesStr = member.roles.map((r) => r.role).join(", ") || "Student";
  const totalCredits = (member.purchasedPacks || []).reduce((acc, p) => acc + p.remainingCredits, 0);
  const noShows = member.bookings.filter((b) => {
    if (b.status !== "confirmed") return false;
    const isPast = new Date(b.class?.startTime || b.createdAt) < /* @__PURE__ */ new Date();
    const notCheckedIn = !b.checkedInAt;
    return isPast && notCheckedIn;
  }).length;
  const hasActiveMembership = member.memberships.some((m) => m.status === "active");
  const membershipStatus = hasActiveMembership ? "Active" : "Inactive";
  const handlePhotoUpload = async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    try {
      setIsUploadingPhoto(true);
      const token = await window.Clerk?.session?.getToken();
      const formData = new FormData();
      formData.append("file", file);
      formData.append("memberId", member.id);
      const response = await fetch(`${API_URL$1}/uploads/portrait`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "X-Tenant-Slug": tenant.slug
        },
        body: formData
      });
      const result = await response.json();
      if (result.error) throw new Error(result.error);
      window.location.reload();
    } catch (err) {
      alert(err.message || "Failed to upload photo");
    } finally {
      setIsUploadingPhoto(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-5xl mx-auto pb-10",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-start justify-between mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsxs("label", {
          className: "relative h-20 w-20 bg-zinc-100 rounded-full flex items-center justify-center border border-zinc-200 overflow-hidden cursor-pointer group",
          children: [userProfile.portraitUrl ? /* @__PURE__ */ jsx("img", {
            src: userProfile.portraitUrl,
            alt: fullName,
            className: "h-full w-full object-cover"
          }) : /* @__PURE__ */ jsx(User, {
            className: "h-8 w-8 text-zinc-400"
          }), /* @__PURE__ */ jsx("div", {
            className: "absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",
            children: isUploadingPhoto ? /* @__PURE__ */ jsx("span", {
              className: "text-white text-xs",
              children: "Uploading..."
            }) : /* @__PURE__ */ jsx(Camera, {
              className: "h-6 w-6 text-white"
            })
          }), /* @__PURE__ */ jsx("input", {
            type: "file",
            accept: "image/*",
            className: "hidden",
            onChange: handlePhotoUpload,
            disabled: isUploadingPhoto
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-3xl font-bold text-zinc-900",
              children: fullName
            }), /* @__PURE__ */ jsx("span", {
              className: `px-2.5 py-0.5 rounded-full text-xs font-medium border ${hasActiveMembership ? "bg-green-100 text-green-800 border-green-200" : "bg-zinc-100 text-zinc-600 border-zinc-200"}`,
              children: membershipStatus
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2 mt-1 text-zinc-500 text-sm",
            children: [/* @__PURE__ */ jsx(Mail, {
              className: "h-4 w-4"
            }), /* @__PURE__ */ jsx("span", {
              children: member.user.email
            }), /* @__PURE__ */ jsx("span", {
              className: "mx-1",
              children: "â€¢"
            }), /* @__PURE__ */ jsx("span", {
              className: "capitalize px-2 py-0.5 bg-zinc-100 rounded-full text-xs font-medium border border-zinc-200",
              children: rolesStr
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs text-zinc-400 mt-1",
            children: ["Joined ", format(new Date(member.joinedAt), "MMM d, yyyy")]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2 relative",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setIsEditingProfile(true),
          className: "px-3 py-2 border border-zinc-300 rounded-md text-sm font-medium hover:bg-zinc-50",
          children: "Edit Profile"
        }), /* @__PURE__ */ jsxs("div", {
          className: "relative",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setShowActions(!showActions),
            className: "px-3 py-2 bg-zinc-900 text-white rounded-md text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",
            children: ["Actions", /* @__PURE__ */ jsx(MoreHorizontal, {
              className: "h-4 w-4"
            })]
          }), showActions && /* @__PURE__ */ jsxs("div", {
            className: "absolute right-0 mt-2 w-48 bg-white border border-zinc-200 rounded-md shadow-lg z-10 py-1",
            children: [/* @__PURE__ */ jsx("button", {
              onClick: () => {
                setShowActions(false);
                setIsSendingEmail(true);
              },
              className: "block w-full text-left px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-50",
              children: "Send Email"
            }), /* @__PURE__ */ jsx("div", {
              className: "border-t border-zinc-100 my-1"
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => {
                setShowActions(false);
                setIsDeactivating(true);
              },
              className: "block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",
              children: "Deactivate Member"
            })]
          })]
        })]
      })]
    }), isSendingEmail && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 w-full max-w-lg shadow-xl",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-lg font-bold mb-4",
          children: ["Send Email to ", fullName]
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: () => setIsSendingEmail(false),
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "send_email"
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 mb-1",
                children: "Subject"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                name: "subject",
                required: true,
                className: "w-full px-3 py-2 border border-zinc-300 rounded-md text-sm",
                placeholder: "e.g. Important Update regarding your membership"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 mb-1",
                children: "Message"
              }), /* @__PURE__ */ jsx("textarea", {
                name: "body",
                rows: 6,
                required: true,
                className: "w-full px-3 py-2 border border-zinc-300 rounded-md text-sm",
                placeholder: "Write your message here..."
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3 mt-6",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsSendingEmail(false),
              className: "px-4 py-2 text-sm border border-zinc-300 rounded-md hover:bg-zinc-50",
              children: "Cancel"
            }), /* @__PURE__ */ jsxs("button", {
              type: "submit",
              className: "px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(Mail, {
                className: "h-4 w-4"
              }), "Send"]
            })]
          })]
        })]
      })
    }), isDeactivating && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 w-full max-w-md shadow-xl",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold text-red-600 mb-2",
          children: "Deactivate Member?"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-600 mb-6",
          children: "This will prevent the member from booking classes or accessing studio content. Their history will be preserved. You can reactivate them later."
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: () => setIsDeactivating(false),
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "update_status"
          }), /* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "status",
            value: "inactive"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsDeactivating(false),
              className: "px-4 py-2 text-sm border border-zinc-300 rounded-md hover:bg-zinc-50",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 text-sm bg-red-600 text-white rounded-md hover:bg-red-700",
              children: "Deactivate"
            })]
          })]
        })]
      })
    }), isEditingProfile && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 w-full max-w-md shadow-xl",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold mb-4",
          children: "Edit Profile"
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          onSubmit: () => setIsEditingProfile(false),
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "update_profile"
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "grid grid-cols-2 gap-4",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-sm font-medium text-zinc-700 mb-1",
                  children: "First Name"
                }), /* @__PURE__ */ jsx("input", {
                  type: "text",
                  name: "firstName",
                  defaultValue: userProfile.firstName,
                  className: "w-full px-3 py-2 border border-zinc-300 rounded-md text-sm"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-sm font-medium text-zinc-700 mb-1",
                  children: "Last Name"
                }), /* @__PURE__ */ jsx("input", {
                  type: "text",
                  name: "lastName",
                  defaultValue: userProfile.lastName,
                  className: "w-full px-3 py-2 border border-zinc-300 rounded-md text-sm"
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium text-zinc-700 mb-1",
                children: "Phone"
              }), /* @__PURE__ */ jsx("input", {
                type: "tel",
                name: "phone",
                defaultValue: userProfile.phone,
                className: "w-full px-3 py-2 border border-zinc-300 rounded-md text-sm"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3 mt-6",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsEditingProfile(false),
              className: "px-4 py-2 text-sm border border-zinc-300 rounded-md hover:bg-zinc-50",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 text-sm bg-zinc-900 text-white rounded-md hover:bg-zinc-800",
              children: "Save Changes"
            })]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "flex border-b border-zinc-200 mb-6",
      children: [{
        id: "overview",
        label: "Overview"
      }, {
        id: "memberships",
        label: "Memberships & Credits"
      }, {
        id: "coupons",
        label: "Generated Coupons"
      }, {
        id: "attendance",
        label: "Attendance"
      }, {
        id: "documents",
        label: "Documents"
      }, {
        id: "notes",
        label: "Staff Notes"
      }].map((tab) => /* @__PURE__ */ jsx("button", {
        onClick: () => setActiveTab(tab.id),
        className: `px-4 py-2 text-sm font-medium border-b-2 text-zinc-600 hover:text-zinc-900 ${activeTab === tab.id ? "border-blue-600 text-blue-600" : "border-transparent"}`,
        children: tab.label
      }, tab.id))
    }), /* @__PURE__ */ jsxs("div", {
      className: "min-h-[400px]",
      children: [activeTab === "overview" && /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-3 gap-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "col-span-2 space-y-6",
          children: /* @__PURE__ */ jsxs("div", {
            className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-lg mb-4",
              children: "Quick Stats"
            }), /* @__PURE__ */ jsxs("div", {
              className: "grid grid-cols-3 gap-4",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "p-4 bg-zinc-50 rounded border border-zinc-100",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-2xl font-bold text-zinc-900",
                  children: member.bookings.length
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 uppercase tracking-wide mt-1",
                  children: "Classes Taken"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "p-4 bg-zinc-50 rounded border border-zinc-100",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-2xl font-bold text-zinc-900",
                  children: totalCredits
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 uppercase tracking-wide mt-1",
                  children: "Available Credits"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "p-4 bg-zinc-50 rounded border border-zinc-100",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-2xl font-bold text-red-600",
                  children: noShows
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 uppercase tracking-wide mt-1",
                  children: "No Shows"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "p-4 bg-zinc-50 rounded border border-zinc-100",
                children: [/* @__PURE__ */ jsx("div", {
                  className: `text-2xl font-bold ${hasActiveMembership ? "text-green-600" : "text-zinc-400"}`,
                  children: membershipStatus
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 uppercase tracking-wide mt-1",
                  children: "Membership Status"
                })]
              })]
            })]
          })
        }), /* @__PURE__ */ jsx("div", {
          children: /* @__PURE__ */ jsxs("div", {
            className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-sm mb-4 uppercase text-zinc-500 tracking-wider",
              children: "Contact Info"
            }), /* @__PURE__ */ jsxs("div", {
              className: "space-y-3 text-sm",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-xs text-zinc-400",
                  children: "Email"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-zinc-800",
                  children: member.user.email
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-xs text-zinc-400",
                  children: "Phone"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-zinc-800",
                  children: userProfile.phone || "Not provided"
                })]
              })]
            })]
          })
        })]
      }), activeTab === "memberships" && /* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setIsAssigningPack(!isAssigningPack),
            className: "flex items-center gap-2 px-3 py-2 bg-white border border-zinc-300 rounded-md text-sm font-medium hover:bg-zinc-50",
            children: [/* @__PURE__ */ jsx(Plus, {
              className: "h-4 w-4"
            }), "Assign Pack"]
          }), /* @__PURE__ */ jsxs("button", {
            className: "flex items-center gap-2 px-3 py-2 bg-white border border-zinc-300 rounded-md text-sm font-medium hover:bg-zinc-50",
            children: [/* @__PURE__ */ jsx(Plus, {
              className: "h-4 w-4"
            }), "Add Plan"]
          })]
        }), isAssigningPack && /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 border border-zinc-200 rounded-lg p-4 mb-4",
          children: [/* @__PURE__ */ jsx("h4", {
            className: "font-semibold text-sm mb-3",
            children: "Assign Class Pack (Internal / POS)"
          }), /* @__PURE__ */ jsxs(Form, {
            method: "post",
            onSubmit: () => setIsAssigningPack(false),
            className: "flex gap-4 items-end",
            children: [/* @__PURE__ */ jsx("input", {
              type: "hidden",
              name: "intent",
              value: "assign_pack"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-medium text-zinc-500 mb-1",
                children: "Select Pack"
              }), /* @__PURE__ */ jsx("select", {
                name: "packId",
                className: "w-full text-sm border-zinc-300 rounded-md",
                children: (availablePacks || []).map((p) => /* @__PURE__ */ jsxs("option", {
                  value: p.id,
                  children: [p.name, " (", p.credits, " credits) - $", (p.price / 100).toFixed(2)]
                }, p.id))
              })]
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",
              children: "Assign & Charge"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-medium text-zinc-900 mb-3",
            children: "Active Memberships"
          }), member.memberships && member.memberships.length > 0 ? /* @__PURE__ */ jsx("div", {
            className: "space-y-3",
            children: member.memberships.map((membership) => /* @__PURE__ */ jsxs("div", {
              className: "bg-white border border-zinc-200 rounded-lg p-4 shadow-sm flex items-center justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "font-semibold text-zinc-900",
                  children: membership.plan?.name || "Unknown Plan"
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-sm text-zinc-500 mt-1",
                  children: ["Status: ", /* @__PURE__ */ jsx("span", {
                    className: "capitalize font-medium text-zinc-700",
                    children: membership.status
                  }), /* @__PURE__ */ jsx("span", {
                    className: "mx-2",
                    children: "â€¢"
                  }), "Started ", format(new Date(membership.startDate), "MMM d, yyyy")]
                })]
              }), /* @__PURE__ */ jsx("span", {
                className: `px-2.5 py-0.5 rounded-full text-xs font-medium border ${membership.status === "active" ? "bg-green-50 text-green-700 border-green-200" : "bg-zinc-100 text-zinc-600 border-zinc-200"}`,
                children: membership.status.toUpperCase()
              })]
            }, membership.id))
          }) : /* @__PURE__ */ jsx("div", {
            className: "text-sm text-zinc-500 italic",
            children: "No active memberships."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-medium text-zinc-900 mb-3",
            children: "Class Packs & Credits"
          }), member.purchasedPacks && member.purchasedPacks.length > 0 ? /* @__PURE__ */ jsx("div", {
            className: "space-y-3",
            children: member.purchasedPacks.map((pack) => /* @__PURE__ */ jsxs("div", {
              className: "bg-white border border-zinc-200 rounded-lg p-4 shadow-sm flex items-center justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "font-semibold text-zinc-900",
                  children: pack.definition?.name || "Unknown Pack"
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-sm text-zinc-500 mt-1 flex items-center gap-3",
                  children: [/* @__PURE__ */ jsxs("span", {
                    children: ["Purchased ", format(/* @__PURE__ */ new Date(), "MMM d, yyyy")]
                  }), " ", pack.expiresAt && /* @__PURE__ */ jsxs(Fragment, {
                    children: [/* @__PURE__ */ jsx("span", {
                      children: "â€¢"
                    }), /* @__PURE__ */ jsxs("span", {
                      className: new Date(pack.expiresAt) < /* @__PURE__ */ new Date() ? "text-red-600" : "",
                      children: ["Expires ", format(new Date(pack.expiresAt), "MMM d, yyyy")]
                    })]
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-right",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "text-lg font-bold text-zinc-900",
                  children: [pack.remainingCredits, " / ", pack.initialCredits]
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 uppercase",
                  children: "Credits Left"
                })]
              })]
            }, pack.id))
          }) : /* @__PURE__ */ jsx("div", {
            className: "text-sm text-zinc-500 italic",
            children: "No packs purchased."
          })]
        })]
      }), activeTab === "coupons" && /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",
          children: /* @__PURE__ */ jsx("p", {
            className: "text-sm text-blue-800",
            children: "These are coupons automatically generated for this student by marketing automations. If a student missed their window, you can manually reactivate a coupon for 7 days."
          })
        }), coupons && coupons.length > 0 ? /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",
          children: coupons.map((coupon) => {
            const isExpired = new Date(coupon.expiresAt) < /* @__PURE__ */ new Date();
            const canReactivate = !coupon.active || isExpired;
            return /* @__PURE__ */ jsxs("div", {
              className: "bg-white border border-zinc-200 rounded-lg p-4 shadow-sm relative",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex justify-between items-start mb-2",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-mono text-lg font-bold text-zinc-900 bg-zinc-100 px-2 py-1 rounded",
                  children: coupon.code
                }), /* @__PURE__ */ jsx("span", {
                  className: `text-xs px-2 py-1 rounded-full font-medium ${!coupon.active ? "bg-zinc-100 text-zinc-500" : isExpired ? "bg-red-100 text-red-700" : "bg-green-100 text-green-700"}`,
                  children: !coupon.active ? "Inactive" : isExpired ? "Expired" : "Active"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-sm text-zinc-600 mb-4",
                children: [coupon.type === "percent" ? `${coupon.value}% Off` : `$${coupon.value} Off`, /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-400 mt-1",
                  children: ["Expires: ", format(new Date(coupon.expiresAt), "MMM d, yyyy")]
                })]
              }), canReactivate && /* @__PURE__ */ jsxs(Form, {
                method: "post",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "intent",
                  value: "reactivate_coupon"
                }), /* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "couponId",
                  value: coupon.id
                }), /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  className: "w-full py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded hover:bg-blue-100 transition-colors",
                  children: "Reactivate for 7 Days"
                })]
              })]
            }, coupon.id);
          })
        }) : /* @__PURE__ */ jsx("div", {
          className: "text-center py-10 bg-zinc-50 rounded-lg border border-zinc-200 text-zinc-500",
          children: "No coupons have been generated for this student."
        })]
      }), activeTab === "attendance" && /* @__PURE__ */ jsx("div", {
        className: "bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",
        children: /* @__PURE__ */ jsxs("table", {
          className: "w-full text-left text-sm",
          children: [/* @__PURE__ */ jsx("thead", {
            className: "bg-zinc-50 border-b border-zinc-200",
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Date"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Class"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Status"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            className: "divide-y divide-zinc-100",
            children: member.bookings.length === 0 ? /* @__PURE__ */ jsx("tr", {
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 3,
                className: "px-4 py-8 text-center text-zinc-400",
                children: "No attendance history"
              })
            }) : member.bookings.map((booking) => /* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50",
              children: [/* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-600",
                children: format(new Date(booking.createdAt), "MMM d, yyyy h:mm a")
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-900 font-medium",
                children: booking.class?.title || "Unknown Class"
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3",
                children: /* @__PURE__ */ jsx("span", {
                  className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize
                                                    ${booking.status === "confirmed" ? "bg-green-100 text-green-800" : booking.status === "cancelled" ? "bg-red-100 text-red-800" : "bg-yellow-100 text-yellow-800"}`,
                  children: booking.status
                })
              })]
            }, booking.id))
          })]
        })
      }), activeTab === "documents" && /* @__PURE__ */ jsx("div", {
        className: "bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",
        children: /* @__PURE__ */ jsxs("table", {
          className: "w-full text-left text-sm",
          children: [/* @__PURE__ */ jsx("thead", {
            className: "bg-zinc-50 border-b border-zinc-200",
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Document"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Signed Date"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-medium text-zinc-500",
                children: "Status"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            className: "divide-y divide-zinc-100",
            children: member.waiverSignatures?.length === 0 ? /* @__PURE__ */ jsx("tr", {
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 3,
                className: "px-4 py-8 text-center text-zinc-400",
                children: "No signed documents"
              })
            }) : member.waiverSignatures?.map((sig) => /* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50",
              children: [/* @__PURE__ */ jsxs("td", {
                className: "px-4 py-3 text-zinc-900 font-medium flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(FileText, {
                  size: 16,
                  className: "text-zinc-400"
                }), sig.template?.title || "Waiver"]
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-600",
                children: format(new Date(sig.signedAt), "MMM d, yyyy h:mm a")
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3",
                children: /* @__PURE__ */ jsxs("span", {
                  className: "inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",
                  children: [/* @__PURE__ */ jsx(Check, {
                    size: 12
                  }), "Signed"]
                })
              })]
            }, sig.id))
          })]
        })
      }), activeTab === "notes" && /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-2 gap-8",
        children: [/* @__PURE__ */ jsx("div", {
          children: /* @__PURE__ */ jsxs("div", {
            className: "bg-zinc-50 border border-zinc-200 rounded-lg p-4 mb-6",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-sm mb-3",
              children: "Add Note"
            }), /* @__PURE__ */ jsxs(Form, {
              method: "post",
              children: [/* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "intent",
                value: "add_note"
              }), /* @__PURE__ */ jsx("textarea", {
                name: "note",
                rows: 4,
                className: "w-full border border-zinc-300 rounded p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none mb-3 bg-white",
                placeholder: "Enter confidential notes about this student...",
                required: true
              }), /* @__PURE__ */ jsx("div", {
                className: "flex justify-end",
                children: /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  disabled: navigation.state === "submitting",
                  className: "px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700 disabled:opacity-50",
                  children: navigation.state === "submitting" ? "Saving..." : "Save Note"
                })
              })]
            })]
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "space-y-4",
          children: notes.length === 0 ? /* @__PURE__ */ jsx("div", {
            className: "text-center text-zinc-400 py-10 italic",
            children: "No notes added yet."
          }) : notes.map((note) => /* @__PURE__ */ jsx("div", {
            className: "bg-white border border-zinc-200 rounded-lg p-4 shadow-sm relative group",
            children: editingNoteId === note.id ? /* @__PURE__ */ jsxs(Form, {
              method: "post",
              onSubmit: () => setEditingNoteId(null),
              children: [/* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "intent",
                value: "edit_note"
              }), /* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "noteId",
                value: note.id
              }), /* @__PURE__ */ jsx("textarea", {
                name: "note",
                defaultValue: note.note,
                rows: 3,
                className: "w-full border border-zinc-300 rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none mb-2",
                required: true,
                autoFocus: true
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex justify-end gap-2",
                children: [/* @__PURE__ */ jsx("button", {
                  type: "button",
                  onClick: () => setEditingNoteId(null),
                  className: "px-3 py-1 text-xs border border-zinc-300 rounded hover:bg-zinc-50",
                  children: "Cancel"
                }), /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  className: "px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",
                  children: "Save"
                })]
              })]
            }) : /* @__PURE__ */ jsxs(Fragment, {
              children: [/* @__PURE__ */ jsx("div", {
                className: "text-sm text-zinc-800 whitespace-pre-wrap pr-8",
                children: note.note
              }), /* @__PURE__ */ jsxs("div", {
                className: "absolute top-2 right-2 flex items-center gap-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity",
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => setEditingNoteId(note.id),
                  className: "p-1.5 text-zinc-400 hover:text-blue-600 hover:bg-zinc-50 rounded",
                  title: "Edit",
                  children: /* @__PURE__ */ jsx(Pencil, {
                    className: "h-3.5 w-3.5"
                  })
                }), /* @__PURE__ */ jsx("button", {
                  type: "button",
                  onClick: () => setNoteToDelete(note.id),
                  className: "p-1.5 text-zinc-400 hover:text-red-600 hover:bg-zinc-50 rounded",
                  title: "Delete",
                  children: /* @__PURE__ */ jsx(Trash2, {
                    className: "h-3.5 w-3.5"
                  })
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "mt-3 flex items-center justify-between text-xs text-zinc-400 border-t border-zinc-50 pt-2",
                children: [/* @__PURE__ */ jsxs("span", {
                  children: ["Add by ", note.author?.user?.profile?.firstName || note.author?.user?.email || "Unknown Staff"]
                }), /* @__PURE__ */ jsx("span", {
                  children: format(new Date(note.createdAt), "MMM d, yyyy")
                })]
              })]
            })
          }, note.id))
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!noteToDelete,
      onOpenChange: (open) => !open && setNoteToDelete(null),
      onConfirm: () => {
        if (noteToDelete) {
          submit({
            intent: "delete_note",
            noteId: noteToDelete
          }, {
            method: "post"
          });
          setNoteToDelete(null);
        }
      },
      title: "Delete Note",
      description: "Are you sure you want to delete this note?",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
});
const route52 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$c,
  default: studio_$slug_students_$id,
  loader: loader$P
}, Symbol.toStringTag, { value: "Module" }));
const loader$O = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = args.params;
  const now = /* @__PURE__ */ new Date();
  const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
  try {
    const classes = await apiRequest(`/classes?startDate=${startOfDay.toISOString()}&endDate=${endOfDay.toISOString()}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      classes,
      token
    };
  } catch (e) {
    console.error("Check-in loader failed", e);
    return {
      classes: [],
      token
    };
  }
};
const studio_$slug_checkin = UNSAFE_withComponentProps(function StaffCheckInPage() {
  const {
    classes: initialClasses,
    token
  } = useLoaderData();
  const {
    slug
  } = useParams();
  const {
    roles,
    isStudentView
  } = useOutletContext();
  const [selectedClass, setSelectedClass] = useState(null);
  const [roster, setRoster] = useState([]);
  const [loading, setLoading] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");
  const [isKioskMode, setIsKioskMode] = useState(false);
  const [feedback, setFeedback] = useState(null);
  useEffect(() => {
    if (selectedClass) {
      loadRoster(selectedClass.id);
    }
  }, [selectedClass]);
  const loadRoster = async (classId) => {
    setLoading(true);
    try {
      const res = await apiRequest(`/classes/${classId}/bookings`, token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setRoster(res || []);
    } catch (e) {
      alert("Failed to load roster");
    } finally {
      setLoading(false);
    }
  };
  const toggleCheckIn = async (booking) => {
    const isCheckingIn = !booking.checkedInAt;
    setRoster((prev) => prev.map((b) => b.id === booking.id ? {
      ...b,
      checkedInAt: isCheckingIn ? /* @__PURE__ */ new Date() : null
    } : b));
    try {
      await apiRequest(`/classes/${selectedClass.id}/bookings/${booking.id}/check-in`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          checkedIn: isCheckingIn
        })
      });
    } catch (e) {
      alert("Check-in failed. Please try again.");
      setRoster((prev) => prev.map((b) => b.id === booking.id ? {
        ...b,
        checkedInAt: !isCheckingIn ? /* @__PURE__ */ new Date() : null
      } : b));
    }
  };
  useEffect(() => {
    if (isKioskMode && feedback?.type === "success") {
      const timer = setTimeout(() => {
        setFeedback(null);
        setSearchQuery("");
      }, 3e3);
      return () => clearTimeout(timer);
    }
  }, [feedback, isKioskMode]);
  const handleKioskCheckIn = async (booking) => {
    if (booking.checkedInAt) {
      setFeedback({
        message: `Already checked in!`,
        type: "error"
      });
      return;
    }
    await toggleCheckIn(booking);
    setFeedback({
      message: `Welcome, ${booking.user.profile?.firstName}!`,
      type: "success"
    });
  };
  if (isStudentView || !roles.includes("instructor") && !roles.includes("owner")) {
    const [history, setHistory] = useState([]);
    const [loadingHistory, setLoadingHistory] = useState(true);
    useEffect(() => {
      const fetchHistory = async () => {
        setLoadingHistory(true);
        try {
          const res = await apiRequest("/members/me/bookings", token, {
            headers: {
              "X-Tenant-Slug": slug
            }
          });
          setHistory(res.bookings || []);
        } catch (e) {
          console.error("Failed into fetch history", e);
        } finally {
          setLoadingHistory(false);
        }
      };
      fetchHistory();
    }, [token, slug]);
    const completed = history.filter((b) => b.status === "confirmed" && b.checkedInAt).length;
    const upcoming = history.filter((b) => b.status === "confirmed" && new Date(b.class.startTime) > /* @__PURE__ */ new Date()).length;
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-4xl mx-auto p-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-8",
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",
          children: [/* @__PURE__ */ jsx(CheckCircle2, {
            className: "text-emerald-500",
            size: 32
          }), "Attendance History"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mt-2",
          children: "Track your class attendance and upcoming sessions."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-bold text-zinc-500 uppercase tracking-widest mb-1",
            children: "Classes Attended"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-4xl font-black text-emerald-600",
            children: completed
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-bold text-zinc-500 uppercase tracking-widest mb-1",
            children: "Upcoming Classes"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-4xl font-black text-blue-600",
            children: upcoming
          })]
        })]
      }), /* @__PURE__ */ jsx("h2", {
        className: "text-xl font-bold mb-4 text-zinc-900 dark:text-zinc-100",
        children: "Your Classes"
      }), loadingHistory ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center text-zinc-400",
        children: [/* @__PURE__ */ jsx(Loader2, {
          className: "animate-spin mx-auto h-8 w-8 mb-2"
        }), "Loading history..."]
      }) : history.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center bg-zinc-50 dark:bg-zinc-900 rounded-2xl border border-dashed border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsx(Calendar, {
          className: "mx-auto h-12 w-12 text-zinc-300 mb-4"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-zinc-900 dark:text-zinc-100 font-bold mb-1",
          children: "No classes yet"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 mb-4",
          children: "You haven't booked any classes yet."
        }), /* @__PURE__ */ jsx(Link, {
          to: `/studio/${slug}/classes`,
          className: "inline-block px-6 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 font-bold rounded-lg hover:opacity-90 transition-opacity",
          children: "Book a Class"
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: history.map((booking) => {
          const isPast = new Date(booking.class.startTime) < /* @__PURE__ */ new Date();
          const isCancelled = booking.status === "cancelled";
          return /* @__PURE__ */ jsxs("div", {
            className: `bg-white dark:bg-zinc-900 p-6 rounded-2xl border ${isCancelled ? "border-red-200 bg-red-50/50 opacity-75" : "border-zinc-200 dark:border-zinc-800"} shadow-sm flex flex-col md:flex-row md:items-center gap-6`,
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex-shrink-0 flex flex-col items-center justify-center w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-2xl",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-xs font-bold text-zinc-500 uppercase",
                children: new Date(booking.class.startTime).toLocaleDateString([], {
                  month: "short"
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-2xl font-black text-zinc-900 dark:text-zinc-100",
                children: new Date(booking.class.startTime).getDate()
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1 min-w-0",
              children: [/* @__PURE__ */ jsx("h3", {
                className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-1",
                children: booking.class.title
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex flex-wrap gap-4 text-sm text-zinc-500",
                children: [/* @__PURE__ */ jsxs("span", {
                  className: "flex items-center gap-1.5",
                  children: [/* @__PURE__ */ jsx(Calendar, {
                    size: 14
                  }), new Date(booking.class.startTime).toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit"
                  })]
                }), booking.class.location && /* @__PURE__ */ jsxs("span", {
                  className: "flex items-center gap-1.5",
                  children: [/* @__PURE__ */ jsx(Circle, {
                    size: 8,
                    className: "fill-current text-zinc-300"
                  }), booking.class.location.name]
                })]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "flex-shrink-0 text-right",
              children: isCancelled ? /* @__PURE__ */ jsx("span", {
                className: "px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold uppercase tracking-wider",
                children: "Cancelled"
              }) : booking.checkedInAt ? /* @__PURE__ */ jsxs("span", {
                className: "flex items-center gap-2 text-emerald-600 font-bold",
                children: [/* @__PURE__ */ jsx(CheckCircle2, {
                  size: 18
                }), "Checked In"]
              }) : isPast ? /* @__PURE__ */ jsx("span", {
                className: "text-zinc-400 font-medium text-sm",
                children: "Completed"
              }) : /* @__PURE__ */ jsx("span", {
                className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold uppercase tracking-wider",
                children: "Upcoming"
              })
            })]
          }, booking.id);
        })
      })]
    });
  }
  if (selectedClass) {
    const filteredRoster = roster.filter((b) => b.user.email.toLowerCase().includes(searchQuery.toLowerCase()) || JSON.stringify(b.user.profile).toLowerCase().includes(searchQuery.toLowerCase()));
    return /* @__PURE__ */ jsxs("div", {
      className: "flex flex-col h-screen bg-white dark:bg-zinc-950",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center gap-4 bg-zinc-50 dark:bg-zinc-900/50 sticky top-0 z-10",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => setSelectedClass(null),
          className: "p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",
          children: /* @__PURE__ */ jsx(ArrowLeft, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex-1 min-w-0",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "font-bold truncate text-zinc-900 dark:text-zinc-100",
            children: selectedClass.title
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-xs text-zinc-500",
            children: [new Date(selectedClass.startTime).toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit"
            }), " â€¢ ", selectedClass.location?.name || "Studio Main"]
          })]
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: () => setIsKioskMode(!isKioskMode),
        className: `px-4 py-2 rounded-lg text-sm font-bold border transition-colors ${isKioskMode ? "bg-blue-600 text-white border-blue-600" : "bg-white dark:bg-zinc-900 text-zinc-600 dark:text-zinc-400 border-zinc-200 dark:border-zinc-800"}`,
        children: isKioskMode ? "Exit Kiosk" : "Kiosk Mode"
      }), isKioskMode ? /* @__PURE__ */ jsx("div", {
        className: "flex-1 flex flex-col items-center justify-start pt-24 px-8 bg-zinc-50 dark:bg-zinc-950",
        children: /* @__PURE__ */ jsxs("div", {
          className: "max-w-2xl w-full",
          children: [/* @__PURE__ */ jsxs("h1", {
            className: "text-4xl font-extrabold text-center text-zinc-900 dark:text-zinc-100 mb-8 tracking-tight",
            children: ["Welcome to ", selectedClass.location?.name || "the Studio"]
          }), feedback ? /* @__PURE__ */ jsxs("div", {
            className: `p-12 rounded-3xl text-center animate-in fade-in zoom-in duration-300 ${feedback.type === "success" ? "bg-emerald-500 text-white" : "bg-red-500 text-white"}`,
            children: [/* @__PURE__ */ jsx(CheckCircle2, {
              size: 64,
              className: "mx-auto mb-4"
            }), /* @__PURE__ */ jsx("h2", {
              className: "text-3xl font-bold",
              children: feedback.message
            }), /* @__PURE__ */ jsx("p", {
              className: "mt-2 opacity-80 uppercase tracking-widest font-medium text-sm",
              children: "Enjoy your class!"
            })]
          }) : /* @__PURE__ */ jsxs("div", {
            className: "space-y-6",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "relative",
              children: [/* @__PURE__ */ jsx(Search, {
                className: "absolute left-6 top-1/2 -translate-y-1/2 h-8 w-8 text-zinc-400"
              }), /* @__PURE__ */ jsx("input", {
                type: "text",
                placeholder: "Enter your name...",
                value: searchQuery,
                onChange: (e) => setSearchQuery(e.target.value),
                className: "w-full pl-20 pr-8 py-8 bg-white dark:bg-zinc-900 border-2 border-zinc-200 dark:border-zinc-800 rounded-3xl text-3xl font-bold focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none shadow-xl",
                autoFocus: true
              })]
            }), searchQuery.length > 1 && /* @__PURE__ */ jsxs("div", {
              className: "bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",
              children: [filteredRoster.map((booking) => /* @__PURE__ */ jsxs("button", {
                onClick: () => handleKioskCheckIn(booking),
                className: "w-full flex items-center justify-between p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border-b border-zinc-100 dark:border-zinc-800 last:border-0 transition-colors text-left",
                children: [/* @__PURE__ */ jsxs("span", {
                  className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
                  children: [booking.user.profile?.firstName, " ", booking.user.profile?.lastName]
                }), booking.checkedInAt ? /* @__PURE__ */ jsxs("span", {
                  className: "text-emerald-500 font-bold flex items-center gap-2",
                  children: [/* @__PURE__ */ jsx(CheckCircle2, {}), " Checked In"]
                }) : /* @__PURE__ */ jsx("span", {
                  className: "bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm",
                  children: "Check In"
                })]
              }, booking.id)), filteredRoster.length === 0 && /* @__PURE__ */ jsx("div", {
                className: "p-8 text-center text-zinc-400",
                children: "No students found."
              })]
            })]
          })]
        })
      }) : /* @__PURE__ */ jsxs(Fragment, {
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-4 bg-white dark:bg-zinc-950 sticky top-[73px] z-10 border-b border-zinc-100 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("div", {
            className: "relative",
            children: [/* @__PURE__ */ jsx(Search, {
              className: "absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              placeholder: "Find student...",
              value: searchQuery,
              onChange: (e) => setSearchQuery(e.target.value),
              className: "w-full pl-10 pr-4 py-3 bg-zinc-100 dark:bg-zinc-900 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none"
            })]
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "flex-1 overflow-y-auto pb-24",
          children: loading && roster.length === 0 ? /* @__PURE__ */ jsxs("div", {
            className: "p-12 text-center text-zinc-400",
            children: [/* @__PURE__ */ jsx(Loader2, {
              className: "animate-spin mx-auto h-8 w-8 mb-2"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm",
              children: "Loading Roster..."
            })]
          }) : /* @__PURE__ */ jsxs("div", {
            className: "divide-y divide-zinc-50 dark:divide-zinc-900",
            children: [filteredRoster.map((booking) => /* @__PURE__ */ jsxs("button", {
              onClick: () => toggleCheckIn(booking),
              className: "w-full flex items-center gap-4 p-4 active:bg-zinc-50 dark:active:bg-zinc-900 transition-colors text-left group",
              children: [/* @__PURE__ */ jsx("div", {
                className: "flex-shrink-0",
                children: booking.checkedInAt ? /* @__PURE__ */ jsx("div", {
                  className: "p-2 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 rounded-full",
                  children: /* @__PURE__ */ jsx(CheckCircle2, {
                    size: 24
                  })
                }) : /* @__PURE__ */ jsx("div", {
                  className: "p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 rounded-full group-hover:bg-blue-50 group-hover:text-blue-500 transition-colors",
                  children: /* @__PURE__ */ jsx(Circle, {
                    size: 24
                  })
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-1 min-w-0",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "font-bold text-zinc-900 dark:text-zinc-100 truncate",
                  children: [booking.user.profile?.firstName || "Student", " ", booking.user.profile?.lastName || ""]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 flex items-center gap-2 mt-0.5",
                  children: [booking.status === "confirmed" ? /* @__PURE__ */ jsx("span", {
                    className: "text-emerald-500 font-bold uppercase tracking-tighter text-[9px]",
                    children: "Reserved"
                  }) : /* @__PURE__ */ jsx("span", {
                    className: "text-amber-500 font-bold uppercase tracking-tighter text-[9px]",
                    children: booking.status
                  }), /* @__PURE__ */ jsx("span", {
                    children: "â€¢"
                  }), /* @__PURE__ */ jsx("span", {
                    children: booking.user.email
                  })]
                }), booking.paymentMethod === "drop_in" && /* @__PURE__ */ jsx("div", {
                  className: "mt-1",
                  children: /* @__PURE__ */ jsx("span", {
                    className: "text-[10px] font-bold uppercase tracking-wider text-red-600 bg-red-100 px-1.5 py-0.5 rounded",
                    children: "Unpaid / Pay at Door"
                  })
                })]
              }), /* @__PURE__ */ jsx("div", {
                className: "flex-shrink-0",
                children: booking.checkedInAt ? /* @__PURE__ */ jsxs("span", {
                  className: "text-[10px] text-zinc-400 font-medium",
                  children: ["Checked in ", new Date(booking.checkedInAt).toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit"
                  })]
                }) : /* @__PURE__ */ jsx("span", {
                  className: "text-[10px] text-blue-600 font-bold bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded",
                  children: "CHECK IN"
                })
              })]
            }, booking.id)), filteredRoster.length === 0 && /* @__PURE__ */ jsxs("div", {
              className: "p-12 text-center text-zinc-400",
              children: [/* @__PURE__ */ jsx(Users, {
                className: "mx-auto h-12 w-12 mb-4 opacity-20"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm",
                children: "No students booked yet."
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs mt-1",
                children: "Bookings for this class will appear here."
              })]
            })]
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-950 flex gap-4 sticky bottom-0 shadow-2xl",
          children: /* @__PURE__ */ jsxs("button", {
            className: "flex-1 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform",
            children: [/* @__PURE__ */ jsx(UserPlus, {
              size: 20
            }), "Quick Add Student"]
          })
        })]
      })]
    });
  }
  return /* @__PURE__ */ jsx("div", {
    className: "min-h-screen bg-zinc-50 dark:bg-zinc-950 pb-12",
    children: /* @__PURE__ */ jsxs("div", {
      className: "p-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-8",
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(CheckCircle2, {
            className: "text-blue-600"
          }), " Instructor Check-in"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 mt-1",
          children: "Select today's session to start checking in students."
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",
        children: initialClasses.length > 0 ? initialClasses.map((cls) => /* @__PURE__ */ jsxs("button", {
          onClick: () => setSelectedClass(cls),
          className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all text-left group shadow-sm flex flex-col gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-start",
            children: [/* @__PURE__ */ jsx("div", {
              className: "bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg text-blue-600 group-hover:scale-110 transition-transform",
              children: /* @__PURE__ */ jsx(Calendar, {
                size: 20
              })
            }), /* @__PURE__ */ jsx("span", {
              className: "text-[10px] font-bold uppercase tracking-widest text-zinc-400 bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded",
              children: new Date(cls.startTime).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit"
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex-1",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-bold text-zinc-900 dark:text-zinc-100 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight mb-1",
              children: cls.title
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-xs text-zinc-500 flex items-center gap-1.5 mt-1",
              children: [/* @__PURE__ */ jsx(Users, {
                size: 12
              }), cls.confirmedCount || 0, " students booked"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-4 border-t border-zinc-100 dark:border-zinc-800 flex items-center gap-2 text-blue-600 text-xs font-bold uppercase tracking-wider",
            children: ["Start Check-in", /* @__PURE__ */ jsx("div", {
              className: "w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"
            })]
          })]
        }, cls.id)) : /* @__PURE__ */ jsxs("div", {
          className: "col-span-full py-24 text-center bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-200 dark:border-zinc-800 border-dashed",
          children: [/* @__PURE__ */ jsx(AlertCircle, {
            className: "mx-auto h-12 w-12 text-zinc-300 mb-4"
          }), /* @__PURE__ */ jsx("h3", {
            className: "text-zinc-500 font-bold mb-1",
            children: "No Classes Today"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-400",
            children: "Enjoy your day off! Classes will appear here automatically."
          })]
        })
      })]
    })
  });
});
const route53 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_checkin,
  loader: loader$O
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_classes = UNSAFE_withComponentProps(function StudioClassesLayout() {
  const context = useOutletContext();
  return /* @__PURE__ */ jsx(Outlet, {
    context
  });
});
const route54 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_classes
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_classes_$classId_live = UNSAFE_withComponentProps(function LiveClassPage() {
  const {
    classId
  } = useParams();
  const [token, setToken] = useState("");
  const {
    getToken
  } = useAuth();
  useEffect(() => {
    const fetchToken = async () => {
      try {
        const authToken = await getToken();
        const response = await apiRequest("/video/token", authToken, {
          method: "POST",
          body: JSON.stringify({
            classId,
            isInstructor: false
          })
        });
        if (response.token) {
          setToken(response.token);
        }
      } catch (error) {
        console.error("Failed to get video token", error);
      }
    };
    if (classId) fetchToken();
  }, [classId]);
  if (!token) {
    return /* @__PURE__ */ jsx("div", {
      className: "flex items-center justify-center h-screen bg-zinc-900 text-white",
      children: /* @__PURE__ */ jsx("p", {
        children: "Loading Studio..."
      })
    });
  }
  return /* @__PURE__ */ jsx(LiveKitRoom, {
    video: true,
    audio: true,
    token,
    serverUrl: "wss://your-project.livekit.cloud",
    "data-lk-theme": "default",
    style: {
      height: "100vh"
    },
    children: /* @__PURE__ */ jsx(VideoConference, {})
  });
});
const route55 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_classes_$classId_live
}, Symbol.toStringTag, { value: "Module" }));
const action$b = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  const bookingId = formData.get("bookingId");
  const classId = params.id;
  if (intent === "check_in") {
    const checkedIn = formData.get("checkedIn") === "true";
    await apiRequest(`/classes/${classId}/bookings/${bookingId}/check-in`, token, {
      method: "PATCH",
      headers: {
        "X-Tenant-Slug": params.slug
      },
      body: JSON.stringify({
        checkedIn
      })
    });
    return {
      success: true
    };
  }
  if (intent === "cancel_booking") {
    await apiRequest(`/classes/${classId}/bookings/${bookingId}/cancel`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      success: true
    };
  }
  if (intent === "promote") {
    await apiRequest(`/classes/${classId}/bookings/${bookingId}/promote`, token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      success: true
    };
  }
  return null;
};
const loader$N = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug,
    id
  } = args.params;
  try {
    const bookings = await apiRequest(`/classes/${id}/bookings`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      bookings
    };
  } catch (e) {
    console.error("Failed to load roster", e);
    throw new Response("Failed to load roster", {
      status: 500
    });
  }
};
function PaymentBadge({
  method
}) {
  switch (method) {
    case "subscription":
      return /* @__PURE__ */ jsx("span", {
        className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",
        children: "Membership"
      });
    case "credit":
      return /* @__PURE__ */ jsx("span", {
        className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",
        children: "Credit"
      });
    case "drop_in":
      return /* @__PURE__ */ jsx("span", {
        className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",
        children: "Pay Later"
      });
    case "free":
      return /* @__PURE__ */ jsx("span", {
        className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",
        children: "Free"
      });
    default:
      return /* @__PURE__ */ jsx("span", {
        className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 text-zinc-500",
        children: "Unknown"
      });
  }
}
const studio_$slug_classes_$id_roster = UNSAFE_withComponentProps(function StudioClassRoster() {
  const {
    bookings
  } = useLoaderData();
  const {
    slug,
    id
  } = useParams();
  const fetcher = useFetcher();
  const confirmedBookings = bookings.filter((b) => b.status === "confirmed");
  const waitlistBookings = bookings.filter((b) => b.status === "waitlisted");
  const [selectedStudentId, setSelectedStudentId] = useState(null);
  const [notesOpen, setNotesOpen] = useState(false);
  const [addStudentOpen, setAddStudentOpen] = useState(false);
  const [bookingToCancel, setBookingToCancel] = useState(null);
  const handleConfirmCancel = () => {
    if (bookingToCancel) {
      fetcher.submit({
        intent: "cancel_booking",
        bookingId: bookingToCancel
      }, {
        method: "post"
      });
      setBookingToCancel(null);
    }
  };
  const selectedBooking = bookings.find((b) => b.memberId === selectedStudentId);
  return /* @__PURE__ */ jsxs("div", {
    className: "relative",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsx(Link, {
          to: `/studio/${slug}/schedule`,
          className: "text-zinc-500 hover:text-zinc-800 font-medium text-sm flex items-center gap-1",
          children: "â† Back to Schedule"
        }), /* @__PURE__ */ jsx("div", {
          className: "h-6 w-px bg-zinc-300"
        }), /* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-bold",
          children: "Class Roster"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setAddStudentOpen(true),
        className: "flex items-center gap-2 bg-zinc-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-zinc-800 transition-colors",
        children: [/* @__PURE__ */ jsx(UserPlus, {
          size: 16
        }), "Add Student"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm mb-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "px-6 py-4 border-b border-zinc-200 bg-zinc-50",
        children: /* @__PURE__ */ jsxs("h3", {
          className: "font-semibold text-zinc-900",
          children: ["Attending (", confirmedBookings.length, ")"]
        })
      }), /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 border-b border-zinc-200",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Student"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Payment"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Waiver"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Attendance"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-100",
          children: [confirmedBookings.map((booking) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 transition-colors",
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "h-8 w-8 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",
                  children: booking.user.profile?.firstName?.[0] || booking.user.email[0].toUpperCase()
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "font-medium text-zinc-900",
                    children: booking.user.profile?.fullName || "Unknown Student"
                  }), /* @__PURE__ */ jsx("div", {
                    className: "text-xs text-zinc-500",
                    children: booking.user.email
                  })]
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => {
                    setSelectedStudentId(booking.memberId);
                    setNotesOpen(true);
                  },
                  className: `ml-2 p-1.5 rounded-full transition-colors ${booking.hasNotes ? "bg-amber-100 text-amber-600 hover:bg-amber-200" : "text-zinc-400 hover:bg-zinc-100 hover:text-zinc-600"}`,
                  title: booking.hasNotes ? "View Notes" : "Add Note",
                  children: /* @__PURE__ */ jsx(StickyNote, {
                    size: 14,
                    className: booking.hasNotes ? "fill-current" : ""
                  })
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx(PaymentBadge, {
                method: booking.paymentMethod
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: booking.waiverSigned ? /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-1 text-green-600 text-xs font-medium",
                children: [/* @__PURE__ */ jsx(FileText, {
                  size: 14
                }), "Signed"]
              }) : /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-1 text-amber-600 text-xs font-bold animate-pulse",
                children: [/* @__PURE__ */ jsx(AlertTriangle, {
                  size: 14
                }), "Needs Signature"]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("span", {
                className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",
                children: "Confirmed"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsxs(fetcher.Form, {
                method: "post",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "bookingId",
                  value: booking.id
                }), /* @__PURE__ */ jsx("input", {
                  type: "hidden",
                  name: "intent",
                  value: "check_in"
                }), booking.checkedInAt ? /* @__PURE__ */ jsxs("button", {
                  name: "checkedIn",
                  value: "false",
                  className: "inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200",
                  children: [/* @__PURE__ */ jsx(Check, {
                    size: 12
                  }), "Checked In"]
                }) : /* @__PURE__ */ jsx("button", {
                  name: "checkedIn",
                  value: "true",
                  className: "inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-zinc-100 text-zinc-500 hover:bg-zinc-200",
                  children: "Mark Present"
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right",
              children: /* @__PURE__ */ jsxs("button", {
                type: "button",
                onClick: () => setBookingToCancel(booking.id),
                className: "text-red-600 hover:text-red-800 text-xs font-medium inline-flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(X, {
                  size: 12
                }), "Cancel"]
              })
            })]
          }, booking.id)), confirmedBookings.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 5,
              className: "px-6 py-12 text-center text-zinc-500",
              children: "No attending students."
            })
          })]
        })]
      })]
    }), waitlistBookings.length > 0 && /* @__PURE__ */ jsxs("div", {
      className: "bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "px-6 py-4 border-b border-zinc-200 bg-amber-50 flex justify-between items-center",
        children: [/* @__PURE__ */ jsxs("h3", {
          className: "font-semibold text-amber-900",
          children: ["Waitlist (", waitlistBookings.length, ")"]
        }), /* @__PURE__ */ jsx("span", {
          className: "text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full",
          children: "Sorted by join order"
        })]
      }), /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 border-b border-zinc-200",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Student"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Joined At"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100",
          children: waitlistBookings.map((booking, index) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 transition-colors",
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "h-6 w-6 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",
                  children: index + 1
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "font-medium text-zinc-900",
                    children: booking.user.profile?.fullName || "Unknown Student"
                  }), /* @__PURE__ */ jsxs("button", {
                    onClick: () => {
                      setSelectedStudentId(booking.memberId);
                      setNotesOpen(true);
                    },
                    className: `mt-1 text-xs flex items-center gap-1 ${booking.hasNotes ? "text-amber-600 font-medium" : "text-zinc-400 hover:text-zinc-600"}`,
                    children: [/* @__PURE__ */ jsx(StickyNote, {
                      size: 12,
                      className: booking.hasNotes ? "fill-current" : ""
                    }), booking.hasNotes ? "Has Notes" : "Add Note"]
                  })]
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-zinc-400 text-sm",
              children: new Date(booking.createdAt).toLocaleString()
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center justify-end gap-3",
                children: [/* @__PURE__ */ jsxs(fetcher.Form, {
                  method: "post",
                  children: [/* @__PURE__ */ jsx("input", {
                    type: "hidden",
                    name: "bookingId",
                    value: booking.id
                  }), /* @__PURE__ */ jsx("input", {
                    type: "hidden",
                    name: "intent",
                    value: "promote"
                  }), /* @__PURE__ */ jsx("button", {
                    className: "inline-flex items-center gap-1 px-3 py-1 rounded bg-green-600 text-white text-xs font-medium hover:bg-green-700",
                    children: "Promote"
                  })]
                }), /* @__PURE__ */ jsx("button", {
                  type: "button",
                  onClick: () => setBookingToCancel(booking.id),
                  className: "text-red-600 hover:text-red-800 text-xs font-medium",
                  children: "Remove"
                })]
              })
            })]
          }, booking.id))
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "mt-4 flex justify-end",
      children: /* @__PURE__ */ jsx("button", {
        className: "px-4 py-2 border border-zinc-300 rounded-md text-sm font-medium text-zinc-700 hover:bg-zinc-50",
        onClick: () => window.print(),
        children: "Print Roster"
      })
    }), notesOpen && selectedStudentId && /* @__PURE__ */ jsx(NotesModal, {
      memberId: selectedStudentId,
      studentName: selectedBooking?.user.profile?.fullName || selectedBooking?.user.email || "Student",
      onClose: () => setNotesOpen(false),
      slug
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!bookingToCancel,
      onOpenChange: (open) => !open && setBookingToCancel(null),
      onConfirm: handleConfirmCancel,
      title: "Cancel Booking",
      description: "Are you sure you want to cancel this booking? The student will be removed from the roster.",
      confirmText: "Cancel Booking",
      variant: "destructive"
    })]
  });
});
function NotesModal({
  memberId,
  studentName,
  onClose,
  slug
}) {
  const [notes, setNotes] = useState([]);
  const [loading, setLoading] = useState(true);
  const [newNote, setNewNote] = useState("");
  const [submitting, setSubmitting] = useState(false);
  const [noteToDelete, setNoteToDelete] = useState(null);
  useEffect(() => {
    loadNotes();
  }, [memberId]);
  const loadNotes = async () => {
    setLoading(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      const res = await apiRequest(`/members/${memberId}/notes`, token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setNotes(res.notes || []);
    } catch (e) {
      console.error(e);
    } finally {
      setLoading(false);
    }
  };
  const handleAddNote = async (e) => {
    e.preventDefault();
    setSubmitting(true);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/members/${memberId}/notes`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          note: newNote
        })
      });
      setNewNote("");
      loadNotes();
    } catch (e2) {
      alert("Failed to add note");
    } finally {
      setSubmitting(false);
    }
  };
  const handleDelete = (noteId) => {
    setNoteToDelete(noteId);
  };
  const handleConfirmDelete = async () => {
    if (!noteToDelete) return;
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/members/${memberId}/notes/${noteToDelete}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setNotes(notes.filter((n) => n.id !== noteToDelete));
      setNoteToDelete(null);
    } catch (e) {
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[80vh]",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between p-4 border-b border-zinc-200",
        children: [/* @__PURE__ */ jsxs("h3", {
          className: "font-semibold text-lg",
          children: ["Notes: ", studentName]
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex-1 overflow-y-auto p-4 space-y-4",
        children: loading ? /* @__PURE__ */ jsx("div", {
          className: "text-center py-4 text-zinc-400",
          children: "Loading notes..."
        }) : notes.length === 0 ? /* @__PURE__ */ jsx("div", {
          className: "text-center py-8 text-zinc-400 italic bg-zinc-50 rounded-lg",
          children: "No notes yet."
        }) : notes.map((note) => /* @__PURE__ */ jsxs("div", {
          className: "bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm relative group",
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-zinc-800 whitespace-pre-wrap",
            children: note.note
          }), /* @__PURE__ */ jsxs("div", {
            className: "mt-2 text-xs text-zinc-500 flex justify-between items-center",
            children: [/* @__PURE__ */ jsxs("span", {
              children: [new Date(note.createdAt).toLocaleDateString(), " by ", note.author?.user?.profile?.firstName || "Staff"]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => handleDelete(note.id),
              className: "text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",
              children: /* @__PURE__ */ jsx(Trash2, {
                size: 12
              })
            })]
          })]
        }, note.id))
      }), /* @__PURE__ */ jsx("div", {
        className: "p-4 border-t border-zinc-200 bg-zinc-50",
        children: /* @__PURE__ */ jsxs("form", {
          onSubmit: handleAddNote,
          children: [/* @__PURE__ */ jsx("textarea", {
            value: newNote,
            onChange: (e) => setNewNote(e.target.value),
            placeholder: "Add a medical note, injury, or preference...",
            className: "w-full text-sm border-zinc-300 rounded-md mb-2 focus:ring-blue-500 min-h-[80px]",
            required: true
          }), /* @__PURE__ */ jsx("div", {
            className: "flex justify-end",
            children: /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: submitting,
              className: "bg-zinc-900 text-white px-4 py-2 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",
              children: submitting ? "Adding..." : "Add Note"
            })
          })]
        })
      })]
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!noteToDelete,
      onOpenChange: (open) => !open && setNoteToDelete(null),
      onConfirm: handleConfirmDelete,
      title: "Delete Note",
      description: "Are you sure you want to delete this note?",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
}
const route56 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$b,
  default: studio_$slug_classes_$id_roster,
  loader: loader$N
}, Symbol.toStringTag, { value: "Module" }));
const loader$M = async (args) => {
  const {
    params,
    request
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const url = new URL(request.url);
  const includeArchived = url.searchParams.get("includeArchived") === "true";
  try {
    const [classes, familyRes, locationsRes, instructorsRes, plansRes] = await Promise.all([apiRequest(`/classes${includeArchived ? "?includeArchived=true" : ""}`, token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }), apiRequest("/users/me/family", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      family: []
    })), apiRequest("/locations", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      locations: []
    })), apiRequest("/members?role=instructor", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => ({
      members: []
    })), apiRequest("/memberships/plans", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    }).catch(() => [])]);
    return {
      classes,
      family: familyRes.family || [],
      locations: locationsRes.locations || [],
      instructors: instructorsRes.members || [],
      plans: plansRes || []
    };
  } catch (e) {
    console.error("Failed to load classes", e);
    return {
      classes: [],
      family: [],
      locations: [],
      instructors: [],
      error: e.message
    };
  }
};
const action$a = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  const classId = formData.get("classId");
  const attendanceType = formData.get("attendanceType");
  const memberId = formData.get("memberId");
  if (!token) return {
    error: "Unauthorized"
  };
  try {
    if (intent === "book") {
      const body = {
        classId,
        attendanceType: attendanceType || "in_person"
      };
      if (memberId) body.memberId = memberId;
      await apiRequest("/bookings", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify(body)
      });
      return {
        success: true
      };
    }
    if (intent === "waitlist") {
      const body = {};
      if (memberId) body.userId = memberId;
      await apiRequest(`/waitlist/${classId}/join`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify(body)
        // Body ignored by current impl but good for future
      });
      return {
        success: true
      };
    }
    if (intent === "cancel_booking") {
      const bookingId = formData.get("bookingId");
      await apiRequest(`/bookings/${bookingId}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": params.slug
        }
      });
      return {
        success: true
      };
    }
    if (intent === "switch_attendance") {
      const bookingId = formData.get("bookingId");
      await apiRequest(`/bookings/${bookingId}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          attendanceType
        })
      });
      return {
        success: true
      };
    }
  } catch (e) {
    return {
      error: e.message || "Action failed"
    };
  }
  return null;
};
const studio_$slug_classes__index = UNSAFE_withComponentProps(function StudioPublicClasses() {
  const {
    classes: initialClasses,
    family,
    error,
    locations,
    instructors,
    plans
  } = useLoaderData();
  const {
    member,
    roles,
    tenant,
    me
  } = useOutletContext() || {};
  const fetcher = useFetcher();
  const [searchParams, setSearchParams] = useSearchParams();
  const [classes, setClasses] = useState(initialClasses);
  useEffect(() => {
    setClasses(initialClasses);
  }, [initialClasses]);
  const [selectedClass, setSelectedClass] = useState(null);
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const isAdmin = roles?.includes("owner") || roles?.includes("instructor");
  const [confirmArchiveData, setConfirmArchiveData] = useState(null);
  const [confirmCancelData, setConfirmCancelData] = useState(null);
  const handleBookClick = (cls) => {
    if (family.length > 0) {
      setSelectedClass(cls);
    } else {
      if (cls.zoomEnabled) {
        setSelectedClass(cls);
      }
    }
  };
  const handleCreateSuccess = (newClass) => {
    setClasses([...classes, newClass]);
  };
  const handleArchiveClick = (classId, archive) => {
    setConfirmArchiveData({
      id: classId,
      archive
    });
  };
  const confirmArchiveAction = async () => {
    if (!confirmArchiveData) return;
    const {
      id,
      archive
    } = confirmArchiveData;
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/classes/${id}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: JSON.stringify({
          status: archive ? "archived" : "active"
        })
      });
      setClasses(classes.map((c) => c.id === id ? {
        ...c,
        status: archive ? "archived" : "active"
      } : c));
      toast.success(archive ? "Class archived" : "Class restored");
    } catch (e) {
      toast.error("Failed to update class status");
    } finally {
      setConfirmArchiveData(null);
    }
  };
  const confirmCancelAction = () => {
    if (!confirmCancelData) return;
    fetcher.submit({
      intent: "cancel_booking",
      bookingId: confirmCancelData.bookingId,
      classId: confirmCancelData.classId
    }, {
      method: "post"
    });
    setConfirmCancelData(null);
  };
  const grouped = classes.reduce((acc, cls) => {
    const date = new Date(cls.startTime).toLocaleDateString(void 0, {
      weekday: "long",
      month: "long",
      day: "numeric"
    });
    if (!acc[date]) acc[date] = [];
    acc[date].push(cls);
    return acc;
  }, {});
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsx(CreateClassModal, {
      isOpen: isCreateOpen,
      onClose: () => setIsCreateOpen(false),
      onSuccess: handleCreateSuccess,
      tenantId: tenant?.id,
      locations,
      instructors,
      plans
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-2xl font-bold",
        children: "Class Schedule"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [isAdmin && /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs("label", {
            className: "flex items-center gap-1.5 text-sm cursor-pointer mr-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "checkbox",
              className: "rounded border-zinc-300",
              checked: searchParams.get("includeArchived") === "true",
              onChange: (e) => {
                const newParams = new URLSearchParams(searchParams);
                if (e.target.checked) newParams.set("includeArchived", "true");
                else newParams.delete("includeArchived");
                setSearchParams(newParams);
              }
            }), /* @__PURE__ */ jsx("span", {
              className: "text-zinc-600 dark:text-zinc-400",
              children: "Show Archived"
            })]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: () => setIsCreateOpen(true),
            className: "flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md hover:opacity-90 transition-opacity font-medium text-sm",
            children: [/* @__PURE__ */ jsx(Plus, {
              size: 16
            }), "Create Class"]
          })]
        }), !me && /* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "Sign in to book classes."
        })]
      })]
    }), error && /* @__PURE__ */ jsxs("div", {
      className: "bg-red-50 text-red-700 p-4 rounded mb-4 text-sm",
      children: ["Failed to load schedule: ", error]
    }), /* @__PURE__ */ jsx(BookingModal, {
      isOpen: !!selectedClass,
      onClose: () => setSelectedClass(null),
      classEvent: selectedClass,
      family,
      member
    }), /* @__PURE__ */ jsx("div", {
      className: "space-y-8",
      children: Object.keys(grouped).length === 0 ? /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg",
        children: "No upcoming classes scheduled."
      }) : Object.entries(grouped).map(([date, events]) => /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-3 sticky top-0 bg-zinc-50/95 dark:bg-zinc-950/95 py-2 backdrop-blur",
          children: date
        }), /* @__PURE__ */ jsx("div", {
          className: "space-y-3",
          children: events.map((cls) => /* @__PURE__ */ jsxs("div", {
            className: `p-4 rounded-lg border shadow-sm transition-colors flex justify-between items-center ${cls.status === "archived" ? "bg-zinc-50 dark:bg-zinc-900/50 border-zinc-100 dark:border-zinc-800 opacity-60" : "bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-zinc-300"}`,
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-bold text-zinc-900 dark:text-zinc-100",
                  children: cls.title
                }), cls.status === "archived" && /* @__PURE__ */ jsx("span", {
                  className: "text-[10px] uppercase bg-zinc-200 text-zinc-600 px-1.5 py-0.5 rounded",
                  children: "Archived"
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "text-sm text-zinc-500 dark:text-zinc-400 flex flex-wrap gap-x-3",
                children: [/* @__PURE__ */ jsxs("span", {
                  children: [new Date(cls.startTime).toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit"
                  }), " â€¢ ", cls.durationMinutes, " min"]
                }), cls.instructor?.user?.profile && /* @__PURE__ */ jsxs("span", {
                  children: ["with ", cls.instructor.user.profile.firstName]
                }), cls.capacity && /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-wrap gap-2 text-xs",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: `px-1.5 py-0.5 rounded ${(cls.inPersonCount || 0) >= cls.capacity ? "bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400" : "bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400"}`,
                    children: ["In-Person: ", cls.inPersonCount || 0, " / ", cls.capacity]
                  }), cls.zoomEnabled && /* @__PURE__ */ jsxs("span", {
                    className: "px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800",
                    children: ["Virtual: ", cls.virtualCount || 0]
                  })]
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-4",
              children: [isAdmin && /* @__PURE__ */ jsx("button", {
                onClick: () => handleArchiveClick(cls.id, cls.status !== "archived"),
                className: "p-1.5 text-zinc-400 hover:text-zinc-600 hover:bg-zinc-100 rounded",
                title: cls.status === "archived" ? "Restore Class" : "Archive Class",
                children: cls.status === "archived" ? /* @__PURE__ */ jsx(ArchiveRestore, {
                  size: 16
                }) : /* @__PURE__ */ jsx(Archive, {
                  size: 16
                })
              }), cls.status !== "archived" && /* @__PURE__ */ jsx("div", {
                children: member ? /* @__PURE__ */ jsx(Fragment, {
                  children: family.length > 0 ? /* @__PURE__ */ jsx("button", {
                    onClick: () => handleBookClick(cls),
                    disabled: cls.userBookingStatus === "confirmed",
                    className: `px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${cls.userBookingStatus === "confirmed" ? "bg-zinc-100 text-zinc-500 cursor-default" : "bg-zinc-900 text-white hover:bg-zinc-800"}`,
                    children: cls.userBookingStatus === "confirmed" ? "Booked" : !cls.zoomEnabled && (cls.inPersonCount || 0) >= (cls.capacity || Infinity) ? "Join Waitlist" : "Book"
                  }) : /* @__PURE__ */ jsx("div", {
                    className: "flex flex-col gap-2 items-end",
                    children: cls.userBookingStatus === "confirmed" ? /* @__PURE__ */ jsxs("div", {
                      className: "flex items-center gap-2",
                      children: [cls.zoomEnabled && cls.userBooking ? /* @__PURE__ */ jsxs(fetcher.Form, {
                        method: "post",
                        children: [/* @__PURE__ */ jsx("input", {
                          type: "hidden",
                          name: "intent",
                          value: "switch_attendance"
                        }), /* @__PURE__ */ jsx("input", {
                          type: "hidden",
                          name: "classId",
                          value: cls.id
                        }), /* @__PURE__ */ jsx("input", {
                          type: "hidden",
                          name: "bookingId",
                          value: cls.userBooking.id
                        }), /* @__PURE__ */ jsx("input", {
                          type: "hidden",
                          name: "attendanceType",
                          value: cls.userBooking.attendanceType === "zoom" ? "in_person" : "zoom"
                        }), /* @__PURE__ */ jsxs("button", {
                          type: "submit",
                          title: "Switch Attendance Type",
                          disabled: fetcher.state !== "idle",
                          className: "text-xs text-blue-600 hover:underline disabled:opacity-50",
                          children: ["Switch to ", cls.userBooking.attendanceType === "zoom" ? "In-Person" : "Zoom"]
                        })]
                      }) : null, /* @__PURE__ */ jsx("button", {
                        type: "button",
                        onClick: () => setConfirmCancelData({
                          bookingId: cls.userBooking.id,
                          classId: cls.id
                        }),
                        disabled: fetcher.state !== "idle",
                        className: "text-xs text-red-600 hover:underline disabled:opacity-50",
                        children: "Cancel"
                      }), /* @__PURE__ */ jsxs("span", {
                        className: "px-4 py-2 text-sm font-medium rounded bg-zinc-100 text-zinc-500 cursor-default",
                        children: ["Booked ", cls.userBooking?.attendanceType === "zoom" ? "(Virtual)" : "(In-Person)"]
                      })]
                    }) : /* @__PURE__ */ jsxs(fetcher.Form, {
                      method: "post",
                      children: [/* @__PURE__ */ jsx("input", {
                        type: "hidden",
                        name: "intent",
                        value: (cls.confirmedCount || 0) >= (cls.capacity || Infinity) ? "waitlist" : "book"
                      }), /* @__PURE__ */ jsx("input", {
                        type: "hidden",
                        name: "classId",
                        value: cls.id
                      }), /* @__PURE__ */ jsx("button", {
                        type: "submit",
                        onClick: (e) => {
                          if (cls.zoomEnabled) {
                            e.preventDefault();
                            setSelectedClass(cls);
                          }
                        },
                        disabled: fetcher.state !== "idle" && fetcher.formData?.get("classId") === cls.id || cls.userBookingStatus === "confirmed" || cls.userBookingStatus === "waitlisted",
                        className: `px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${cls.userBookingStatus === "confirmed" || cls.userBookingStatus === "waitlisted" ? "bg-zinc-100 text-zinc-500 cursor-default" : "bg-zinc-900 text-white hover:bg-zinc-800"}`,
                        children: fetcher.state !== "idle" && fetcher.formData?.get("classId") === cls.id ? "Processing..." : cls.userBookingStatus === "confirmed" ? "Booked" : cls.userBookingStatus === "waitlisted" ? "On Waitlist" : !cls.zoomEnabled && (cls.inPersonCount || 0) >= (cls.capacity || Infinity) ? "Join Waitlist" : "Book"
                      })]
                    })
                  })
                }) : /* @__PURE__ */ jsx("a", {
                  href: "/sign-in",
                  className: "px-4 py-2 border border-zinc-300 text-zinc-700 text-sm font-medium rounded hover:bg-zinc-50",
                  children: "Login to Book"
                })
              })]
            })]
          }, cls.id))
        })]
      }, date))
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmArchiveData,
      onClose: () => setConfirmArchiveData(null),
      onConfirm: confirmArchiveAction,
      title: confirmArchiveData?.archive ? "Archive Class" : "Restore Class",
      message: `Are you sure you want to ${confirmArchiveData?.archive ? "archive" : "unarchive"} this class?`,
      confirmText: confirmArchiveData?.archive ? "Archive" : "Restore",
      isDestructive: confirmArchiveData?.archive
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmCancelData,
      onClose: () => setConfirmCancelData(null),
      onConfirm: confirmCancelAction,
      title: "Cancel Booking",
      message: "Are you sure you want to cancel this booking?",
      confirmText: "Cancel Booking",
      isDestructive: true
    })]
  });
});
const route57 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$a,
  default: studio_$slug_classes__index,
  loader: loader$M
}, Symbol.toStringTag, { value: "Module" }));
const loader$L = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = args.params;
  try {
    const challenges = await apiRequest("/challenges/my-progress", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      challenges: Array.isArray(challenges) ? challenges : [],
      isOwnerOrAdmin: false,
      // Default, will override in component via Context or check Me here
      error: null
    };
  } catch (e) {
    return {
      challenges: [],
      isOwnerOrAdmin: false,
      error: "Failed to load challenges"
    };
  }
};
const action$9 = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = params;
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "join") {
    const challengeId = formData.get("challengeId");
    try {
      await apiRequest(`/challenges/${challengeId}/join`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message || "Failed to join challenge"
      };
    }
  }
  if (intent === "create") {
    const rewardType = formData.get("rewardType");
    let rewardValue = {};
    if (rewardType === "retail_credit") {
      rewardValue = {
        creditAmount: formData.get("creditAmount")
      };
    } else if (formData.get("rewardValue")) {
      try {
        rewardValue = JSON.parse(formData.get("rewardValue"));
      } catch (e) {
      }
    }
    const data = {
      title: formData.get("title"),
      description: formData.get("description"),
      type: formData.get("type"),
      targetValue: parseInt(formData.get("targetValue") || "0"),
      frequency: parseInt(formData.get("frequency") || "1"),
      period: formData.get("period"),
      rewardType,
      rewardValue,
      startDate: formData.get("startDate"),
      endDate: formData.get("endDate")
    };
    try {
      await apiRequest("/challenges", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(data)
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message || "Failed to create"
      };
    }
  }
  return null;
};
const studio_$slug_loyalty = UNSAFE_withComponentProps(function LoyaltyPage() {
  const {
    challenges,
    error
  } = useLoaderData();
  const actionData = useActionData();
  const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);
  useEffect(() => {
    if (actionData && actionData.success) {
      setIsCreateModalOpen(false);
    }
  }, [actionData]);
  const {
    me
  } = useOutletContext();
  const isManager = me?.roles?.includes("owner") || me?.roles?.includes("admin") || me?.roles?.includes("instructor");
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto animate-in fade-in duration-500",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Award, {
            className: "text-yellow-500"
          }), "Loyalty Challenges"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Gamify attendance with challenges and rewards."
        })]
      }), isManager && /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreateModalOpen(true),
        className: "flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg hover:opacity-90 transition-opacity font-medium shadow-sm",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 16
        }), "Create Challenge"]
      })]
    }), error && /* @__PURE__ */ jsx("div", {
      className: "bg-red-50 text-red-600 p-4 rounded-lg mb-6 border border-red-100",
      children: error
    }), actionData && actionData.error && /* @__PURE__ */ jsx("div", {
      className: "bg-red-50 text-red-600 p-4 rounded-lg mb-6 border border-red-100",
      children: actionData.error
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",
      children: [challenges.map((challenge) => {
        const progress = challenge.userProgress || {};
        const isJoined = !!progress.id;
        const isCompleted = progress.status === "completed" || progress.progress >= challenge.targetValue;
        const percentage = Math.min(100, Math.round(progress.progress / challenge.targetValue * 100));
        return /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group flex flex-col h-full",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-start mb-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-3 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg text-yellow-600 dark:text-yellow-400",
              children: /* @__PURE__ */ jsx(Target, {
                size: 24
              })
            }), /* @__PURE__ */ jsx("span", {
              className: `px-2 py-1 text-xs rounded-full font-medium ${challenge.active ? "bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400" : "bg-zinc-100 text-zinc-500"}`,
              children: challenge.active ? "Active" : "Inactive"
            })]
          }), /* @__PURE__ */ jsx("h3", {
            className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",
            children: challenge.title
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 dark:text-zinc-400 mb-4 line-clamp-2 min-h-[40px] flex-1",
            children: challenge.description
          }), !isJoined && challenge.active && /* @__PURE__ */ jsxs(Form, {
            method: "post",
            className: "mb-4",
            children: [/* @__PURE__ */ jsx("input", {
              type: "hidden",
              name: "intent",
              value: "join"
            }), /* @__PURE__ */ jsx("input", {
              type: "hidden",
              name: "challengeId",
              value: challenge.id
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-sm text-sm",
              children: "Join Challenge"
            })]
          }), isJoined && /* @__PURE__ */ jsxs("div", {
            className: "mb-4 space-y-2",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-xs font-semibold uppercase text-zinc-500 dark:text-zinc-400",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Progress"
              }), /* @__PURE__ */ jsxs("span", {
                children: [progress.progress, " / ", challenge.targetValue]
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-2 w-full bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: "h-full bg-blue-600 rounded-full transition-all duration-1000 ease-out",
                style: {
                  width: `${percentage}%`
                }
              })
            }), isCompleted && /* @__PURE__ */ jsx("div", {
              className: "text-center mt-2",
              children: /* @__PURE__ */ jsxs("span", {
                className: "inline-flex items-center gap-1.5 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-xs font-bold",
                children: [/* @__PURE__ */ jsx(Award, {
                  size: 12
                }), "Challenge Completed!"]
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-4 border-t border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 mt-auto",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between mb-2",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(Target, {
                  size: 14,
                  className: "text-zinc-400"
                }), /* @__PURE__ */ jsx("span", {
                  children: "Goal"
                })]
              }), /* @__PURE__ */ jsxs("span", {
                className: "font-medium",
                children: [challenge.targetValue, " ", challenge.type === "count" ? "Classes" : challenge.type === "minutes" ? "Min" : "Days"]
              })]
            }), challenge.endDate && /* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between text-xs text-zinc-500",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Ends"
              }), /* @__PURE__ */ jsx("span", {
                children: new Date(challenge.endDate).toLocaleDateString()
              })]
            })]
          })]
        }, challenge.id);
      }), challenges.length === 0 && /* @__PURE__ */ jsxs("div", {
        className: "col-span-full py-16 text-center border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl bg-zinc-50/50 dark:bg-zinc-900/20",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-400",
          children: /* @__PURE__ */ jsx(Award, {
            size: 32
          })
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-medium text-zinc-900 dark:text-zinc-100",
          children: "No active challenges"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 max-w-sm mx-auto mt-2 text-sm",
          children: "Check back later for new challenges!"
        })]
      })]
    }), isCreateModalOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-in zoom-in-95 duration-200",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-6 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "New Challenge"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsCreateModalOpen(false),
            className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 transition-colors",
            children: /* @__PURE__ */ jsx(Trash2, {
              size: 20,
              className: "rotate-45"
            })
          })]
        }), /* @__PURE__ */ jsxs(Form, {
          method: "post",
          className: "p-6 space-y-4",
          children: [/* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "intent",
            value: "create"
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
              children: "Title"
            }), /* @__PURE__ */ jsx("input", {
              name: "title",
              required: true,
              className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",
              placeholder: "e.g. Summer Warrior"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
              children: "Description"
            }), /* @__PURE__ */ jsx("textarea", {
              name: "description",
              rows: 3,
              className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none",
              placeholder: "Attend 10 classes in June..."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "Goal Type"
              }), /* @__PURE__ */ jsxs("div", {
                className: "relative",
                children: [/* @__PURE__ */ jsxs("select", {
                  name: "type",
                  className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",
                  onChange: (e) => {
                    const val = e.target.value;
                    const targetInput = document.getElementById("targetValue-group");
                    const streakInput = document.getElementById("streak-group");
                    if (val === "streak") {
                      if (targetInput) targetInput.style.display = "none";
                      if (streakInput) streakInput.style.display = "grid";
                    } else {
                      if (targetInput) targetInput.style.display = "block";
                      if (streakInput) streakInput.style.display = "none";
                    }
                  },
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "count",
                    children: "Total Classes"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "minutes",
                    children: "Total Minutes"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "streak",
                    children: "Streak"
                  })]
                }), /* @__PURE__ */ jsx("div", {
                  className: "absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-500",
                  children: /* @__PURE__ */ jsx(Target, {
                    size: 14
                  })
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              id: "targetValue-group",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "Target Value"
              }), /* @__PURE__ */ jsx("input", {
                name: "targetValue",
                type: "number",
                defaultValue: "10",
                min: "1",
                className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            id: "streak-group",
            className: "hidden grid-cols-2 gap-4 p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-100 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("div", {
              className: "col-span-2 text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2",
              children: "Streak Settings"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "Frequency"
              }), /* @__PURE__ */ jsx("input", {
                name: "frequency",
                type: "number",
                defaultValue: "3",
                min: "1",
                className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 mt-1",
                children: "Times per period"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "Period"
              }), /* @__PURE__ */ jsxs("select", {
                name: "period",
                className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",
                children: [/* @__PURE__ */ jsx("option", {
                  value: "week",
                  children: "Weekly"
                }), /* @__PURE__ */ jsx("option", {
                  value: "month",
                  children: "Monthly"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsx("script", {
            dangerouslySetInnerHTML: {
              __html: `
                                document.querySelector('select[name="type"]').addEventListener('change', function(e) {
                                    const val = e.target.value;
                                    const streakGroup = document.getElementById('streak-group');
                                    const targetGroup = document.getElementById('targetValue-group');
                                    if(val === 'streak') {
                                        streakGroup.classList.remove('hidden');
                                        streakGroup.classList.add('grid');
                                        targetGroup.classList.add('hidden');
                                    } else {
                                        streakGroup.classList.add('hidden');
                                        streakGroup.classList.remove('grid');
                                        targetGroup.classList.remove('hidden');
                                    }
                                });
                             `
            }
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "Reward Type"
              }), /* @__PURE__ */ jsxs("div", {
                className: "relative",
                children: [/* @__PURE__ */ jsxs("select", {
                  name: "rewardType",
                  className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",
                  onChange: (e) => {
                    const val = e.target.value;
                    const creditInput = document.getElementById("credit-input");
                    if (val === "retail_credit" && creditInput) creditInput.classList.remove("hidden");
                    else if (creditInput) creditInput.classList.add("hidden");
                  },
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "badge",
                    children: "Digital Badge"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "coupon",
                    children: "Discount Coupon"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "retail_credit",
                    children: "Retail Credit"
                  })]
                }), /* @__PURE__ */ jsx("div", {
                  className: "absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-500",
                  children: /* @__PURE__ */ jsx(Gift, {
                    size: 14
                  })
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
                children: "End Date"
              }), /* @__PURE__ */ jsx("input", {
                name: "endDate",
                type: "date",
                className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            id: "credit-input",
            className: "hidden",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",
              children: "Credit Amount ($)"
            }), /* @__PURE__ */ jsx("input", {
              name: "creditAmount",
              type: "number",
              min: "1",
              className: "w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",
              placeholder: "e.g. 50"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-6 flex justify-end gap-3 border-t border-zinc-100 dark:border-zinc-800 mt-2",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsCreateModalOpen(false),
              className: "px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors font-medium text-sm",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm shadow-blue-200 dark:shadow-none",
              children: "Create Challenge"
            })]
          })]
        })]
      })
    })]
  });
});
const route58 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$9,
  default: studio_$slug_loyalty,
  loader: loader$L
}, Symbol.toStringTag, { value: "Module" }));
function FamilyManager({ token }) {
  const fetcher = useFetcher();
  const [family, setFamily] = useState([]);
  const [isAdding, setIsAdding] = useState(false);
  const [error, setError] = useState(null);
  useEffect(() => {
    if (!token) return;
    apiRequest("/users/me/family", token).then((data) => {
      if (data.family) setFamily(data.family);
    }).catch((err) => {
      console.error("Failed to load family", err);
      setError("Failed to load family members");
    });
  }, [token]);
  useEffect(() => {
    if (fetcher.data?.success && fetcher.data?.child) {
      setFamily((prev) => [...prev, fetcher.data.child]);
      setIsAdding(false);
    }
  }, [fetcher.data]);
  const switchProfile = async (targetUserId) => {
    try {
      const res = await apiRequest("/users/me/switch-profile", token, {
        method: "POST",
        body: JSON.stringify({ targetUserId })
      });
      if (res.token) {
        document.cookie = `__impersonate_token=${res.token}; path=/; SameSite=Lax`;
        localStorage.setItem("impersonation_token", res.token);
        window.location.reload();
      }
    } catch (e) {
      console.error(e);
      setError(e.message || "Failed to switch profile");
    }
  };
  return /* @__PURE__ */ jsxs("div", { className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 mt-6", children: [
    /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-center mb-4", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("h3", { className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100", children: "Family Members" }),
        /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 dark:text-zinc-400", children: "Manage household accounts and dependents." })
      ] }),
      /* @__PURE__ */ jsx(
        "button",
        {
          onClick: () => setIsAdding(!isAdding),
          className: "text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",
          children: isAdding ? "Cancel" : "+ Add Child"
        }
      )
    ] }),
    error && /* @__PURE__ */ jsx("div", { className: "p-3 mb-4 text-sm text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400 rounded-md border border-red-200 dark:border-red-800", children: error }),
    isAdding && /* @__PURE__ */ jsxs(fetcher.Form, { method: "post", className: "mb-6 p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-md border border-zinc-200 dark:border-zinc-800 animate-in fade-in slide-in-from-top-2", children: [
      /* @__PURE__ */ jsx("input", { type: "hidden", name: "intent", value: "add_child" }),
      /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4 mb-4", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-1", children: "First Name" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              name: "firstName",
              required: true,
              className: "w-full px-3 py-2 bg-white dark:bg-zinc-950 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",
              placeholder: "e.g. Leo"
            }
          )
        ] }),
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-1", children: "Last Name" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              name: "lastName",
              required: true,
              className: "w-full px-3 py-2 bg-white dark:bg-zinc-950 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",
              placeholder: "e.g. Smith"
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "mb-4", children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-1", children: "Date of Birth" }),
        /* @__PURE__ */ jsx(
          "input",
          {
            name: "dob",
            type: "date",
            className: "w-full px-3 py-2 bg-white dark:bg-zinc-950 border border-zinc-300 dark:border-zinc-700 rounded-md text-sm text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all"
          }
        )
      ] }),
      /* @__PURE__ */ jsx("div", { className: "flex justify-end pt-2", children: /* @__PURE__ */ jsx(
        "button",
        {
          type: "submit",
          disabled: fetcher.state === "submitting",
          className: "bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 text-sm font-medium rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 transition-colors shadow-sm",
          children: fetcher.state === "submitting" ? "Adding Profile..." : "Create Child Profile"
        }
      ) })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "space-y-3", children: [
      family.length === 0 && !isAdding && /* @__PURE__ */ jsxs("div", { className: "text-center py-8 bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-dashed border-zinc-200 dark:border-zinc-800", children: [
        /* @__PURE__ */ jsx(UsersIcon, { className: "w-8 h-8 text-zinc-300 mx-auto mb-2" }),
        /* @__PURE__ */ jsx("p", { className: "text-zinc-500 dark:text-zinc-400 text-sm", children: "No family members linked yet." })
      ] }),
      family.map((member) => /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between p-3 border border-zinc-100 dark:border-zinc-800 rounded-lg bg-zinc-50 dark:bg-zinc-900/30 hover:bg-zinc-100 dark:hover:bg-zinc-900/50 transition-colors group", children: [
        /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3", children: [
          /* @__PURE__ */ jsx("div", { className: "w-9 h-9 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-sm shadow-sm ring-1 ring-white dark:ring-zinc-800", children: member.firstName[0] }),
          /* @__PURE__ */ jsxs("div", { children: [
            /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxs("p", { className: "font-medium text-sm text-zinc-900 dark:text-zinc-100", children: [
                member.firstName,
                " ",
                member.lastName
              ] }),
              member.memberId && /* @__PURE__ */ jsx("span", { className: "text-[10px] font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-1.5 py-0.5 rounded-full", children: "Member" })
            ] }),
            /* @__PURE__ */ jsx("div", { className: "flex items-center gap-3 mt-0.5", children: member.dob && /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-1 text-xs text-zinc-500 dark:text-zinc-400", children: [
              /* @__PURE__ */ jsx(Baby, { size: 12 }),
              /* @__PURE__ */ jsx("span", { children: new Date(member.dob).toLocaleDateString() })
            ] }) })
          ] })
        ] }),
        /* @__PURE__ */ jsx(
          "button",
          {
            onClick: () => switchProfile(member.userId),
            className: "bg-white dark:bg-black border border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 px-3 py-1.5 text-xs font-medium rounded-md hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors shadow-sm opacity-0 group-hover:opacity-100",
            children: "Switch Profile"
          }
        )
      ] }, member.userId))
    ] })
  ] });
}
function UsersIcon({ className }) {
  return /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className, children: [
    /* @__PURE__ */ jsx("path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }),
    /* @__PURE__ */ jsx("circle", { cx: "9", cy: "7", r: "4" }),
    /* @__PURE__ */ jsx("path", { d: "M22 21v-2a4 4 0 0 0-3-3.87" }),
    /* @__PURE__ */ jsx("path", { d: "M16 3.13a4 4 0 0 1 0 7.75" })
  ] });
}
function AvailabilityManager({ token, tenantSlug }) {
  const [availabilities, setAvailabilities] = useState([]);
  const [loading, setLoading] = useState(true);
  const [isSaving, setIsSaving] = useState(false);
  const days = [
    { id: 1, label: "Monday" },
    { id: 2, label: "Tuesday" },
    { id: 3, label: "Wednesday" },
    { id: 4, label: "Thursday" },
    { id: 5, label: "Friday" },
    { id: 6, label: "Saturday" },
    { id: 0, label: "Sunday" }
  ];
  useEffect(() => {
    loadAvailability();
  }, []);
  async function loadAvailability() {
    try {
      const res = await apiRequest("/appointments/availability/settings", token, {
        headers: { "X-Tenant-Slug": tenantSlug }
      });
      if (res.availabilities) {
        setAvailabilities(res.availabilities);
      }
    } catch (e) {
      console.error("Failed to load availability", e);
    } finally {
      setLoading(false);
    }
  }
  async function handleSave(e) {
    e.preventDefault();
    setIsSaving(true);
    const form = e.target;
    const formData = new FormData(form);
    const dayOfWeek = Number(formData.get("dayOfWeek"));
    const startTime = formData.get("startTime");
    const endTime = formData.get("endTime");
    try {
      await apiRequest("/appointments/availability", token, {
        method: "POST",
        headers: { "X-Tenant-Slug": tenantSlug },
        body: JSON.stringify({ dayOfWeek, startTime, endTime })
      });
      await loadAvailability();
      form.reset();
    } catch (e2) {
      alert("Failed to save");
    } finally {
      setIsSaving(false);
    }
  }
  if (loading) return /* @__PURE__ */ jsx("div", { children: "Loading availability..." });
  return /* @__PURE__ */ jsxs("div", { className: "bg-white rounded-lg border border-zinc-200 p-6 mb-6", children: [
    /* @__PURE__ */ jsx("h3", { className: "text-lg font-semibold mb-4", children: "Instructor Availability" }),
    /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 mb-4", children: "Set your weekly recurring available hours for private sessions." }),
    /* @__PURE__ */ jsxs("div", { className: "space-y-2 mb-6", children: [
      availabilities.length === 0 && /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-400 italic", children: "No availability set." }),
      availabilities.map((slot) => /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between bg-zinc-50 px-3 py-2 rounded text-sm", children: [
        /* @__PURE__ */ jsx("span", { className: "font-medium text-zinc-700", children: days.find((d) => d.id === slot.dayOfWeek)?.label }),
        /* @__PURE__ */ jsxs("span", { className: "text-zinc-600", children: [
          slot.startTime,
          " - ",
          slot.endTime
        ] })
      ] }, slot.id))
    ] }),
    /* @__PURE__ */ jsxs("form", { onSubmit: handleSave, className: "flex gap-3 items-end border-t border-zinc-100 pt-4", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-1", children: "Day" }),
        /* @__PURE__ */ jsx("select", { name: "dayOfWeek", className: "text-sm border border-zinc-300 rounded px-2 py-1.5 focus:ring-2 focus:ring-blue-500 outline-none", children: days.map((d) => /* @__PURE__ */ jsx("option", { value: d.id, children: d.label }, d.id)) })
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-1", children: "Start" }),
        /* @__PURE__ */ jsx("input", { name: "startTime", type: "time", required: true, className: "text-sm border border-zinc-300 rounded px-2 py-1.5" })
      ] }),
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("label", { className: "block text-xs font-medium text-zinc-600 mb-1", children: "End" }),
        /* @__PURE__ */ jsx("input", { name: "endTime", type: "time", required: true, className: "text-sm border border-zinc-300 rounded px-2 py-1.5" })
      ] }),
      /* @__PURE__ */ jsx(
        "button",
        {
          type: "submit",
          disabled: isSaving,
          className: "bg-zinc-900 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",
          children: isSaving ? "Adding..." : "Add Slot"
        }
      )
    ] })
  ] });
}
const loader$K = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = args.params;
  const user = await apiRequest("/users/me", token);
  return {
    user,
    token,
    slug
  };
};
const action$8 = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "add_child") {
    const firstName = formData.get("firstName");
    const lastName = formData.get("lastName");
    const dob = formData.get("dob");
    try {
      const data = await apiRequest("/users/me/family", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          firstName,
          lastName,
          dob
        })
      });
      return data;
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  return null;
};
function NotificationSettings({
  token,
  slug
}) {
  const [settings, setSettings] = useState(null);
  const [loading, setLoading] = useState(false);
  useEffect(() => {
    apiRequest("/members/me", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).then((res) => {
      if (res.member) {
        setSettings(res.member.settings || {});
      }
    }).catch(console.error);
  }, [token, slug]);
  async function toggleSMS() {
    if (!settings) return;
    setLoading(true);
    const currentParams = settings.notifications || {};
    const newState = !currentParams.sms;
    try {
      const res = await apiRequest("/members/me/settings", token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          notifications: {
            sms: newState
          }
        })
      });
      if (res.settings) {
        setSettings(res.settings);
      }
    } catch (e) {
      alert("Failed to update settings");
    } finally {
      setLoading(false);
    }
  }
  if (!settings) return null;
  const smsActive = settings.notifications?.sms === true;
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white rounded-lg border border-zinc-200 p-6 mb-6",
    children: [/* @__PURE__ */ jsx("h3", {
      className: "text-lg font-semibold mb-4",
      children: "Notifications"
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-sm font-medium text-zinc-900",
          children: "SMS Notifications"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500",
          children: "Receive class reminders and updates via text."
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: toggleSMS,
        disabled: loading,
        className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${smsActive ? "bg-zinc-900" : "bg-zinc-200"}`,
        children: /* @__PURE__ */ jsx("span", {
          className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${smsActive ? "translate-x-6" : "translate-x-1"}`
        })
      })]
    })]
  });
}
const studio_$slug_profile = UNSAFE_withComponentProps(function StudioProfilePage() {
  const {
    user,
    token,
    slug
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-2xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsx("h1", {
      className: "text-3xl font-bold text-zinc-900 mb-2",
      children: "Your Profile"
    }), /* @__PURE__ */ jsx("p", {
      className: "text-zinc-500 mb-8",
      children: "Manage your information and family members."
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-lg border border-zinc-200 p-6 mb-6",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "text-lg font-semibold mb-4",
        children: "Personal Info"
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-2 gap-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "text-xs font-semibold text-zinc-500 uppercase",
            children: "First Name"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-900",
            children: user.profile?.firstName
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "text-xs font-semibold text-zinc-500 uppercase",
            children: "Last Name"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-900",
            children: user.profile?.lastName
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "col-span-2",
          children: [/* @__PURE__ */ jsx("label", {
            className: "text-xs font-semibold text-zinc-500 uppercase",
            children: "Email"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-900",
            children: user.email
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx(NotificationSettings, {
      token,
      slug
    }), /* @__PURE__ */ jsx(AvailabilityManager, {
      token,
      tenantSlug: slug
    }), /* @__PURE__ */ jsx(FamilyManager, {
      token
    })]
  });
});
const route59 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$8,
  default: studio_$slug_profile,
  loader: loader$K
}, Symbol.toStringTag, { value: "Module" }));
function ProjectionsCalculator() {
  const [mode, setMode] = useState("growth");
  const [scenarios, setScenarios] = useState([]);
  const [scenarioName, setScenarioName] = useState("");
  const [isSaveOpen, setIsSaveOpen] = useState(false);
  useEffect(() => {
    const saved = localStorage.getItem("studio_projection_scenarios");
    if (saved) {
      try {
        setScenarios(JSON.parse(saved));
      } catch (e) {
        console.error("Failed to load scenarios", e);
      }
    }
  }, []);
  const [inputs, setInputs] = useState({
    studentCount: 50,
    avgMembershipPrice: 120,
    avgDropInPrice: 25,
    membershipSplit: 60,
    // 60% members, 40% drop-in
    classesPerDropIn: 4.5,
    rent: 2e3,
    payrollPerClass: 40,
    classesPerMonth: 60,
    otherExpenses: 500,
    // New Growth Inputs
    churnRate: 5,
    // % per month
    growthRate: 8,
    // New students per month
    seasonalityResult: 15,
    // % drop in bad months
    seasonalityEnabled: false
  });
  const projection = useMemo(() => {
    const memberCount = Math.round(inputs.studentCount * (inputs.membershipSplit / 100));
    const dropInCount = inputs.studentCount - memberCount;
    const membershipRevenue = memberCount * inputs.avgMembershipPrice;
    const dropInRevenue = dropInCount * inputs.classesPerDropIn * inputs.avgDropInPrice;
    const totalRevenue = membershipRevenue + dropInRevenue;
    const payroll = inputs.classesPerMonth * inputs.payrollPerClass;
    const totalExpenses = inputs.rent + payroll + inputs.otherExpenses;
    const profit = totalRevenue - totalExpenses;
    const margin = totalRevenue > 0 ? profit / totalRevenue * 100 : 0;
    return {
      totalRevenue,
      totalExpenses,
      profit,
      margin,
      breakdown: { membershipRevenue, dropInRevenue }
    };
  }, [inputs]);
  const chartData = useMemo(() => {
    const data = [];
    const maxStudents = Math.max(inputs.studentCount * 3, 200);
    const step = Math.ceil(maxStudents / 20);
    for (let count = 0; count <= maxStudents; count += step) {
      const memberCount = Math.round(count * (inputs.membershipSplit / 100));
      const dropInCount = count - memberCount;
      const revenue = memberCount * inputs.avgMembershipPrice + dropInCount * inputs.classesPerDropIn * inputs.avgDropInPrice;
      const payroll = inputs.classesPerMonth * inputs.payrollPerClass;
      const expenses = inputs.rent + payroll + inputs.otherExpenses;
      data.push({
        students: count,
        revenue,
        expenses,
        profit: revenue - expenses
      });
    }
    return data;
  }, [inputs]);
  const timeSeriesData = useMemo(() => {
    const data = [];
    let currentStudents = inputs.studentCount;
    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const startMonthIndex = (/* @__PURE__ */ new Date()).getMonth();
    for (let i = 0; i < 24; i++) {
      const monthIndex = (startMonthIndex + i) % 12;
      const monthName = months[monthIndex];
      let impact = 1;
      if (inputs.seasonalityEnabled) {
        if (monthIndex === 5 || monthIndex === 6 || monthIndex === 7) {
          impact = 1 - inputs.seasonalityResult / 100;
        }
      }
      const churned = currentStudents * (inputs.churnRate / 100);
      const newStudents = inputs.growthRate * impact;
      currentStudents = Math.max(0, currentStudents - churned + newStudents);
      const memberCount = Math.round(currentStudents * (inputs.membershipSplit / 100));
      const dropInCount = currentStudents - memberCount;
      const revenue = memberCount * inputs.avgMembershipPrice + dropInCount * inputs.classesPerDropIn * inputs.avgDropInPrice;
      const payroll = inputs.classesPerMonth * inputs.payrollPerClass;
      const expenses = inputs.rent + payroll + inputs.otherExpenses;
      data.push({
        month: i === 0 ? "Now" : i <= 11 ? monthName : `${monthName} '25`,
        // Rough Year
        students: Math.round(currentStudents),
        revenue,
        expenses,
        profit: revenue - expenses
      });
    }
    return data;
  }, [inputs]);
  const handleInputChange = (field, value) => {
    if (typeof value === "boolean") {
      setInputs((prev) => ({ ...prev, [field]: value }));
      return;
    }
    const num = typeof value === "string" ? parseFloat(value) || 0 : value;
    setInputs((prev) => ({ ...prev, [field]: num }));
  };
  const saveScenario = () => {
    if (!scenarioName) return;
    const newScenarios = [...scenarios, { name: scenarioName, data: inputs }];
    setScenarios(newScenarios);
    localStorage.setItem("studio_projection_scenarios", JSON.stringify(newScenarios));
    setScenarioName("");
    setIsSaveOpen(false);
  };
  const loadScenario = (idx) => {
    setInputs(scenarios[idx].data);
  };
  const deleteScenario = (idx) => {
    const newScenarios = scenarios.filter((_, i) => i !== idx);
    setScenarios(newScenarios);
    localStorage.setItem("studio_projection_scenarios", JSON.stringify(newScenarios));
  };
  return /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in slide-in-from-bottom-4", children: [
    /* @__PURE__ */ jsx("div", { className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-fit space-y-8", children: /* @__PURE__ */ jsxs("div", { children: [
      /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between mb-6", children: [
        /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2 text-zinc-900 dark:text-zinc-100 font-bold text-lg", children: [
          /* @__PURE__ */ jsx(Calculator, { className: "text-blue-600" }),
          /* @__PURE__ */ jsx("h3", { children: "Simulator Inputs" })
        ] }),
        /* @__PURE__ */ jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxs("div", { className: "relative group", children: [
            /* @__PURE__ */ jsx("button", { className: "p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-500", children: /* @__PURE__ */ jsx(FolderOpen, { size: 18 }) }),
            /* @__PURE__ */ jsxs("div", { className: "absolute top-full right-0 mt-2 w-48 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-xl p-2 hidden group-hover:block z-50", children: [
              /* @__PURE__ */ jsx("div", { className: "text-xs font-semibold text-zinc-400 px-2 py-1 mb-1", children: "LOAD SCENARIO" }),
              scenarios.length === 0 && /* @__PURE__ */ jsx("div", { className: "px-2 py-1 text-xs text-zinc-500 italic", children: "No saved scenarios" }),
              scenarios.map((s, i) => /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between px-2 py-1.5 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded cursor-pointer group/item", children: [
                /* @__PURE__ */ jsx("span", { onClick: () => loadScenario(i), className: "text-sm truncate flex-1", children: s.name }),
                /* @__PURE__ */ jsx(Trash2, { size: 12, className: "text-red-400 opacity-0 group-hover/item:opacity-100 hover:text-red-600", onClick: (e) => {
                  e.stopPropagation();
                  deleteScenario(i);
                } })
              ] }, i))
            ] })
          ] }),
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              "button",
              {
                onClick: () => setIsSaveOpen(!isSaveOpen),
                className: "p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-blue-600",
                children: /* @__PURE__ */ jsx(Save, { size: 18 })
              }
            ),
            isSaveOpen && /* @__PURE__ */ jsxs("div", { className: "absolute top-full right-0 mt-2 w-64 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-xl p-3 z-50", children: [
              /* @__PURE__ */ jsx("div", { className: "text-xs font-semibold text-zinc-400 mb-2", children: "SAVE CURRENT SCENARIO" }),
              /* @__PURE__ */ jsxs("div", { className: "flex gap-2", children: [
                /* @__PURE__ */ jsx(
                  "input",
                  {
                    className: "flex-1 min-w-0 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded px-2 py-1 text-sm",
                    placeholder: "Scenario Name...",
                    value: scenarioName,
                    onChange: (e) => setScenarioName(e.target.value)
                  }
                ),
                /* @__PURE__ */ jsx("button", { onClick: saveScenario, disabled: !scenarioName, className: "bg-blue-600 text-white px-3 py-1 rounded text-xs font-bold disabled:opacity-50", children: "Save" })
              ] })
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "space-y-6", children: [
        /* @__PURE__ */ jsxs("div", { className: "space-y-4", children: [
          /* @__PURE__ */ jsxs("h4", { className: "text-xs font-bold text-zinc-400 uppercase tracking-widest flex items-center gap-2", children: [
            /* @__PURE__ */ jsx(Users, { size: 14 }),
            " Current Status"
          ] }),
          /* @__PURE__ */ jsx(InputGroup, { label: "Total Active Students", value: inputs.studentCount, onChange: (v) => handleInputChange("studentCount", v) }),
          /* @__PURE__ */ jsx(InputGroup, { label: "Avg. Membership Price ($)", value: inputs.avgMembershipPrice, onChange: (v) => handleInputChange("avgMembershipPrice", v) }),
          /* @__PURE__ */ jsx(InputGroup, { label: "Avg. Drop-In Price ($)", value: inputs.avgDropInPrice, onChange: (v) => handleInputChange("avgDropInPrice", v) }),
          /* @__PURE__ */ jsxs("div", { className: "space-y-1", children: [
            /* @__PURE__ */ jsxs("label", { className: "text-sm font-medium text-zinc-700 dark:text-zinc-300 flex justify-between", children: [
              /* @__PURE__ */ jsx("span", { children: "Membership Split" }),
              /* @__PURE__ */ jsxs("span", { className: "text-zinc-500", children: [
                inputs.membershipSplit,
                "% Members"
              ] })
            ] }),
            /* @__PURE__ */ jsx(
              "input",
              {
                type: "range",
                min: "0",
                max: "100",
                value: inputs.membershipSplit,
                onChange: (e) => handleInputChange("membershipSplit", e.target.value),
                className: "w-full accent-blue-600"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxs("div", { className: "pt-4 border-t border-zinc-100 dark:border-zinc-800 space-y-4", children: [
          /* @__PURE__ */ jsxs("h4", { className: "text-xs font-bold text-purple-500 uppercase tracking-widest flex items-center gap-2", children: [
            /* @__PURE__ */ jsx(TrendingUp, { size: 14 }),
            " Growth & Churn"
          ] }),
          /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsx(InputGroup, { label: "New Students / Mo", value: inputs.growthRate, onChange: (v) => handleInputChange("growthRate", v) }),
            /* @__PURE__ */ jsx(InputGroup, { label: "Churn Rate (%)", value: inputs.churnRate, onChange: (v) => handleInputChange("churnRate", v) })
          ] }),
          /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-between p-3 bg-zinc-50 dark:bg-zinc-800 rounded-lg border border-zinc-100 dark:border-zinc-700", children: [
            /* @__PURE__ */ jsxs("div", { className: "space-y-0.5", children: [
              /* @__PURE__ */ jsx("label", { className: "text-sm font-medium text-zinc-900 dark:text-zinc-100", children: "Seasonality" }),
              /* @__PURE__ */ jsx("div", { className: "text-xs text-zinc-500", children: "Summer slump simulation" })
            ] }),
            /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-3", children: [
              inputs.seasonalityEnabled && /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-1 text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full border border-amber-100", children: [
                "-",
                inputs.seasonalityResult,
                "%"
              ] }),
              /* @__PURE__ */ jsx(
                "button",
                {
                  onClick: () => handleInputChange("seasonalityEnabled", !inputs.seasonalityEnabled),
                  className: `w-10 h-6 rounded-full transition-colors relative ${inputs.seasonalityEnabled ? "bg-blue-600" : "bg-zinc-200 dark:bg-zinc-700"}`,
                  children: /* @__PURE__ */ jsx("div", { className: `w-4 h-4 rounded-full bg-white absolute top-1 transition-transform ${inputs.seasonalityEnabled ? "left-5" : "left-1"}` })
                }
              )
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxs("div", { className: "pt-4 border-t border-zinc-100 dark:border-zinc-800 space-y-4", children: [
          /* @__PURE__ */ jsxs("h4", { className: "text-xs font-bold text-red-400 uppercase tracking-widest flex items-center gap-2", children: [
            /* @__PURE__ */ jsx(DollarSign, { size: 14 }),
            " Expenses (Monthly)"
          ] }),
          /* @__PURE__ */ jsx(InputGroup, { label: "Rent & Utilities", value: inputs.rent, onChange: (v) => handleInputChange("rent", v) }),
          /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsx(InputGroup, { label: "Pay / Class", value: inputs.payrollPerClass, onChange: (v) => handleInputChange("payrollPerClass", v) }),
            /* @__PURE__ */ jsx(InputGroup, { label: "Classes / Mo", value: inputs.classesPerMonth, onChange: (v) => handleInputChange("classesPerMonth", v) })
          ] }),
          /* @__PURE__ */ jsx(InputGroup, { label: "Other Expenses", value: inputs.otherExpenses, onChange: (v) => handleInputChange("otherExpenses", v) })
        ] })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxs("div", { className: "lg:col-span-2 space-y-6", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg w-fit", children: [
        /* @__PURE__ */ jsxs(
          "button",
          {
            onClick: () => setMode("growth"),
            className: `px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2 ${mode === "growth" ? "bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100" : "text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,
            children: [
              /* @__PURE__ */ jsx(Calendar, { size: 16 }),
              "24-Month Forecast"
            ]
          }
        ),
        /* @__PURE__ */ jsxs(
          "button",
          {
            onClick: () => setMode("static"),
            className: `px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2 ${mode === "static" ? "bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100" : "text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,
            children: [
              /* @__PURE__ */ jsx(TrendingUp, { size: 16 }),
              "Profitability Curve"
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [
        /* @__PURE__ */ jsxs("div", { className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm", children: [
          /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1", children: "Current Revenue" }),
          /* @__PURE__ */ jsxs("div", { className: "text-3xl font-black text-zinc-900 dark:text-zinc-100", children: [
            "$",
            projection.totalRevenue.toLocaleString(void 0, { maximumFractionDigits: 0 }),
            /* @__PURE__ */ jsx("span", { className: "text-sm font-normal text-zinc-400", children: "/mo" })
          ] }),
          /* @__PURE__ */ jsxs("div", { className: "text-xs text-zinc-500 mt-2 flex gap-2", children: [
            "Margins: ",
            /* @__PURE__ */ jsxs("span", { className: projection.margin > 20 ? "text-green-600" : "text-zinc-600", children: [
              projection.margin.toFixed(1),
              "%"
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxs("div", { className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm", children: [
          /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1", children: "12-Month Outlook" }),
          /* @__PURE__ */ jsxs("div", { className: "text-3xl font-black text-blue-600 flex items-center gap-2", children: [
            "$",
            timeSeriesData[11].revenue.toLocaleString(void 0, { maximumFractionDigits: 0 }),
            timeSeriesData[11].revenue > projection.totalRevenue ? /* @__PURE__ */ jsx(TrendingUp, { size: 20 }) : /* @__PURE__ */ jsx(ArrowRight, { size: 20 })
          ] }),
          /* @__PURE__ */ jsxs("p", { className: "text-xs text-zinc-500 mt-2", children: [
            timeSeriesData[11].students,
            " Active Students (+",
            timeSeriesData[11].students - inputs.studentCount,
            ")"
          ] })
        ] }),
        /* @__PURE__ */ jsxs("div", { className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm", children: [
          /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1", children: "Net Income (12mo)" }),
          /* @__PURE__ */ jsxs("div", { className: `text-3xl font-black ${timeSeriesData[11].profit >= 0 ? "text-green-600 dark:text-green-400" : "text-red-600 dark:text-red-400"}`, children: [
            timeSeriesData[11].profit >= 0 ? "+" : "",
            "$",
            timeSeriesData[11].profit.toLocaleString(void 0, { maximumFractionDigits: 0 })
          ] }),
          /* @__PURE__ */ jsxs("p", { className: "text-xs text-zinc-500 mt-2", children: [
            "Projected for ",
            timeSeriesData[11].month
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-[450px]", children: [
        /* @__PURE__ */ jsx("h3", { className: "text-lg font-bold mb-6 flex items-center gap-2", children: mode === "growth" ? "24-Month Growth Forecast" : "Profitability Analysis" }),
        /* @__PURE__ */ jsx(ResponsiveContainer, { width: "100%", height: "100%", minHeight: 300, children: mode === "growth" ? /* @__PURE__ */ jsxs(LineChart, { data: timeSeriesData, margin: { top: 10, right: 30, left: 10, bottom: 0 }, children: [
          /* @__PURE__ */ jsx(XAxis, { dataKey: "month", tickLine: false, axisLine: false, tick: { fontSize: 12, fill: "#71717A" } }),
          /* @__PURE__ */ jsx(YAxis, { yAxisId: "left", tickLine: false, axisLine: false, tick: { fontSize: 12, fill: "#71717A" }, tickFormatter: (val) => `$${val / 1e3}k` }),
          /* @__PURE__ */ jsx(YAxis, { yAxisId: "right", orientation: "right", tickLine: false, axisLine: false, tick: { fontSize: 12, fill: "#71717A" } }),
          /* @__PURE__ */ jsx(CartesianGrid, { vertical: false, strokeDasharray: "3 3", stroke: "#E4E4E7" }),
          /* @__PURE__ */ jsx(
            Tooltip,
            {
              contentStyle: { borderRadius: "12px", border: "none", boxShadow: "0 10px 15px -3px rgb(0 0 0 / 0.1)" },
              formatter: (val, name) => [name === "Students" ? val : `$${Number(val).toLocaleString()}`, name]
            }
          ),
          /* @__PURE__ */ jsx(Legend, {}),
          /* @__PURE__ */ jsx(Line, { yAxisId: "left", type: "monotone", dataKey: "revenue", name: "Revenue", stroke: "#3B82F6", strokeWidth: 3, dot: false }),
          /* @__PURE__ */ jsx(Line, { yAxisId: "left", type: "monotone", dataKey: "expenses", name: "Expenses", stroke: "#EF4444", strokeWidth: 2, strokeDasharray: "5 5", dot: false }),
          /* @__PURE__ */ jsx(Line, { yAxisId: "right", type: "monotone", dataKey: "students", name: "Students", stroke: "#8B5CF6", strokeWidth: 2, dot: false })
        ] }) : /* @__PURE__ */ jsxs(AreaChart, { data: chartData, margin: { top: 10, right: 30, left: 10, bottom: 0 }, children: [
          /* @__PURE__ */ jsxs("defs", { children: [
            /* @__PURE__ */ jsxs("linearGradient", { id: "colorRevenue", x1: "0", y1: "0", x2: "0", y2: "1", children: [
              /* @__PURE__ */ jsx("stop", { offset: "5%", stopColor: "#3B82F6", stopOpacity: 0.1 }),
              /* @__PURE__ */ jsx("stop", { offset: "95%", stopColor: "#3B82F6", stopOpacity: 0 })
            ] }),
            /* @__PURE__ */ jsxs("linearGradient", { id: "colorProfit", x1: "0", y1: "0", x2: "0", y2: "1", children: [
              /* @__PURE__ */ jsx("stop", { offset: "5%", stopColor: "#10B981", stopOpacity: 0.1 }),
              /* @__PURE__ */ jsx("stop", { offset: "95%", stopColor: "#10B981", stopOpacity: 0 })
            ] })
          ] }),
          /* @__PURE__ */ jsx(XAxis, { dataKey: "students", tickLine: false, axisLine: false, tick: { fontSize: 12, fill: "#71717A" }, label: { value: "Number of Students", position: "insideBottomRight", offset: -10, fontSize: 12, fill: "#71717A" } }),
          /* @__PURE__ */ jsx(YAxis, { tickLine: false, axisLine: false, tick: { fontSize: 12, fill: "#71717A" }, tickFormatter: (val) => `$${val / 1e3}k` }),
          /* @__PURE__ */ jsx(CartesianGrid, { vertical: false, strokeDasharray: "3 3", stroke: "#E4E4E7" }),
          /* @__PURE__ */ jsx(Tooltip, { contentStyle: { borderRadius: "12px", border: "none", boxShadow: "0 10px 15px -3px rgb(0 0 0 / 0.1)" }, formatter: (val) => [`$${Number(val).toLocaleString()}`, ""] }),
          /* @__PURE__ */ jsx(Area, { type: "monotone", dataKey: "revenue", name: "Revenue", stroke: "#3B82F6", fillOpacity: 1, fill: "url(#colorRevenue)", strokeWidth: 2 }),
          /* @__PURE__ */ jsx(Area, { type: "monotone", dataKey: "expenses", name: "Expenses", stroke: "#EF4444", fill: "none", strokeWidth: 2, strokeDasharray: "5 5" }),
          /* @__PURE__ */ jsx(Area, { type: "monotone", dataKey: "profit", name: "Net Profit", stroke: "#10B981", fillOpacity: 1, fill: "url(#colorProfit)", strokeWidth: 2 }),
          /* @__PURE__ */ jsx(ReferenceLine, { x: inputs.studentCount, stroke: "#F59E0B", strokeDasharray: "3 3", label: { position: "top", value: "Current", fill: "#F59E0B", fontSize: 12 } })
        ] }) })
      ] })
    ] })
  ] });
}
function InputGroup({ label, value, onChange }) {
  return /* @__PURE__ */ jsxs("div", { className: "space-y-1", children: [
    /* @__PURE__ */ jsx("label", { className: "text-sm font-medium text-zinc-700 dark:text-zinc-300", children: label }),
    /* @__PURE__ */ jsx(
      "input",
      {
        type: "number",
        value,
        onChange: (e) => onChange(e.target.value),
        className: "w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
      }
    )
  ] });
}
function PrivacyBlur({ revealed, children, blurAmount = "blur-sm", className = "", placeholder }) {
  if (revealed) {
    return /* @__PURE__ */ jsx(Fragment, { children });
  }
  return /* @__PURE__ */ jsxs("span", { className: `relative inline-block select-none ${className}`, title: "Hidden for privacy", children: [
    /* @__PURE__ */ jsx("span", { className: `filter ${blurAmount} opacity-50`, children }),
    placeholder && /* @__PURE__ */ jsx("span", { className: "absolute inset-0 flex items-center justify-center text-xs font-mono text-zinc-500 font-bold bg-white/50 dark:bg-black/50 backdrop-blur-md rounded", children: placeholder })
  ] });
}
function useAdminPrivacy(isPlatformAdmin = false) {
  const [isPrivacyMode, setIsPrivacyMode] = useState(false);
  useEffect(() => {
    if (typeof window !== "undefined") {
      const showFinancials = localStorage.getItem("admin_show_financials") === "true";
      setIsPrivacyMode(!showFinancials);
    }
  }, []);
  return { isPrivacyMode };
}
const studio_$slug_reports = UNSAFE_withComponentProps(function StudioReports() {
  const {
    tenant
  } = useOutletContext();
  const [activeTab, setActiveTab] = useState("financials");
  const [loading, setLoading] = useState(true);
  const [revenueData, setRevenueData] = useState(null);
  const [attendanceData, setAttendanceData] = useState(null);
  const [dateRange, setDateRange] = useState("30d");
  const [exporting, setExporting] = useState(false);
  const [showSchedules, setShowSchedules] = useState(false);
  const [schedules, setSchedules] = useState([]);
  const [isCreatingSchedule, setIsCreatingSchedule] = useState(false);
  const [newSchedule, setNewSchedule] = useState({
    reportType: "revenue",
    frequency: "weekly",
    recipients: ""
  });
  const [impersonating, setImpersonating] = useState(false);
  useEffect(() => {
    setImpersonating(!!localStorage.getItem("impersonation_token"));
  }, []);
  const {
    isPrivacyMode
  } = useAdminPrivacy();
  const shouldBlur = impersonating && isPrivacyMode;
  useEffect(() => {
    fetchData();
    if (showSchedules) fetchSchedules();
  }, [activeTab, dateRange, showSchedules]);
  const fetchSchedules = async () => {
    const token = await window.Clerk?.session?.getToken();
    try {
      const res = await apiRequest("/reports/schedules", token);
      setSchedules(res);
    } catch (e) {
      console.error("Failed to fetch schedules", e);
    }
  };
  const handleCreateSchedule = async (e) => {
    e.preventDefault();
    setIsCreatingSchedule(true);
    const token = await window.Clerk?.session?.getToken();
    try {
      const recipients = newSchedule.recipients.split(",").map((r) => r.trim()).filter((r) => !!r);
      await apiRequest("/reports/schedules", token, {
        method: "POST",
        body: JSON.stringify({
          ...newSchedule,
          recipients
        })
      });
      toast.success("Schedule created");
      fetchSchedules();
      setNewSchedule({
        reportType: "revenue",
        frequency: "weekly",
        recipients: ""
      });
    } catch (e2) {
      toast.error(e2.message);
    } finally {
      setIsCreatingSchedule(false);
    }
  };
  const handleDeleteSchedule = async (id) => {
    const token = await window.Clerk?.session?.getToken();
    try {
      await apiRequest(`/reports/schedules/${id}`, token, {
        method: "DELETE"
      });
      toast.success("Schedule deleted");
      fetchSchedules();
    } catch (e) {
      toast.error(e.message);
    }
  };
  const fetchData = async () => {
    setLoading(true);
    const end = /* @__PURE__ */ new Date();
    const start = /* @__PURE__ */ new Date();
    if (dateRange === "30d") start.setDate(end.getDate() - 30);
    if (dateRange === "90d") start.setDate(end.getDate() - 90);
    if (dateRange === "1y") start.setFullYear(end.getFullYear() - 1);
    const token = await window.Clerk?.session?.getToken();
    try {
      if (activeTab === "financials") {
        const res = await apiRequest(`/reports/revenue?startDate=${start.toISOString()}&endDate=${end.toISOString()}`, token);
        setRevenueData(res);
      } else {
        const res = await apiRequest(`/reports/attendance?startDate=${start.toISOString()}&endDate=${end.toISOString()}`, token);
        setAttendanceData(res);
      }
    } catch (e) {
      console.error("Failed to fetch report data", e);
    } finally {
      setLoading(false);
    }
  };
  const handleExportJournal = async () => {
    setExporting(true);
    const end = /* @__PURE__ */ new Date();
    const start = /* @__PURE__ */ new Date();
    if (dateRange === "30d") start.setDate(end.getDate() - 30);
    if (dateRange === "90d") start.setDate(end.getDate() - 90);
    if (dateRange === "1y") start.setFullYear(end.getFullYear() - 1);
    const token = await window.Clerk?.session?.getToken();
    try {
      const response = await fetch(`${"https://studio-platform-api.slichti.workers.dev"}/reports/accounting/journal?format=csv&startDate=${start.toISOString()}&endDate=${end.toISOString()}`, {
        headers: {
          "Authorization": `Bearer ${token}`,
          "X-Tenant-Slug": tenant.slug
        }
      });
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `journal_${start.toISOString().split("T")[0]}_${end.toISOString().split("T")[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    } catch (e) {
      console.error("Failed to export journal", e);
    } finally {
      setExporting(false);
    }
  };
  if (loading && !revenueData && !attendanceData) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-8 flex justify-center",
      children: /* @__PURE__ */ jsx(Loader2, {
        className: "animate-spin text-zinc-400"
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-7xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Analytics"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Performance metrics and insights."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-4",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: handleExportJournal,
          disabled: exporting,
          className: "px-4 py-2 text-sm font-medium rounded-md bg-emerald-600 text-white shadow hover:bg-emerald-700 transition-colors flex items-center gap-2 disabled:opacity-50",
          children: [/* @__PURE__ */ jsx(Download, {
            size: 16
          }), exporting ? "Exporting..." : "Export Journal"]
        }), /* @__PURE__ */ jsx(Link, {
          to: "custom",
          className: "px-4 py-2 text-sm font-medium rounded-md bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 shadow hover:opacity-90 transition-opacity",
          children: "Custom Query"
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setActiveTab("financials"),
            className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === "financials" ? "bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100" : "text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,
            children: "Financials"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setActiveTab("attendance"),
            className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === "attendance" ? "bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100" : "text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,
            children: "Attendance"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setActiveTab("projections"),
            className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === "projections" ? "bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100" : "text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,
            children: "Projections"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 border border-blue-100 dark:border-blue-900/20 p-6 rounded-xl shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center mb-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-white dark:bg-zinc-800 rounded-lg shadow-sm",
            children: /* @__PURE__ */ jsx(Calendar, {
              className: "text-blue-600",
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-lg font-bold text-zinc-900 dark:text-zinc-100",
              children: "Scheduled Reports"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400",
              children: "Automated summaries delivered to your inbox."
            })]
          })]
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => setShowSchedules(!showSchedules),
          className: "text-sm font-medium text-blue-600 dark:text-blue-400 hover:underline",
          children: showSchedules ? "Hide Management" : "Manage Schedules"
        })]
      }), showSchedules && /* @__PURE__ */ jsx("div", {
        className: "mt-6 space-y-6",
        children: /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-8",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 p-5 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
            children: [/* @__PURE__ */ jsxs("h4", {
              className: "font-semibold mb-4 text-sm flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(Plus, {
                size: 16
              }), " New Schedule"]
            }), /* @__PURE__ */ jsxs("form", {
              onSubmit: handleCreateSchedule,
              className: "space-y-4",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-2 gap-4",
                children: [/* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-xs font-medium text-zinc-500 mb-1",
                    children: "Report Type"
                  }), /* @__PURE__ */ jsxs("select", {
                    value: newSchedule.reportType,
                    onChange: (e) => setNewSchedule({
                      ...newSchedule,
                      reportType: e.target.value
                    }),
                    className: "w-full text-sm border rounded-md p-2 dark:bg-zinc-800",
                    children: [/* @__PURE__ */ jsx("option", {
                      value: "revenue",
                      children: "Revenue"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "attendance",
                      children: "Attendance"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "journal",
                      children: "Journal"
                    })]
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "block text-xs font-medium text-zinc-500 mb-1",
                    children: "Frequency"
                  }), /* @__PURE__ */ jsxs("select", {
                    value: newSchedule.frequency,
                    onChange: (e) => setNewSchedule({
                      ...newSchedule,
                      frequency: e.target.value
                    }),
                    className: "w-full text-sm border rounded-md p-2 dark:bg-zinc-800",
                    children: [/* @__PURE__ */ jsx("option", {
                      value: "daily",
                      children: "Daily"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "weekly",
                      children: "Weekly"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "monthly",
                      children: "Monthly"
                    })]
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "block text-xs font-medium text-zinc-500 mb-1",
                  children: "Recipients (comma separated)"
                }), /* @__PURE__ */ jsx("input", {
                  placeholder: "owner@example.com, manager@example.com",
                  value: newSchedule.recipients,
                  onChange: (e) => setNewSchedule({
                    ...newSchedule,
                    recipients: e.target.value
                  }),
                  className: "w-full text-sm border rounded-md p-2 dark:bg-zinc-800",
                  required: true
                })]
              }), /* @__PURE__ */ jsx("button", {
                type: "submit",
                disabled: isCreatingSchedule,
                className: "w-full bg-blue-600 text-white rounded-md py-2 text-sm font-bold hover:bg-blue-700 disabled:opacity-50 transition-colors",
                children: isCreatingSchedule ? "Creating..." : "Create Email Schedule"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-3",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-semibold text-sm",
              children: "Active Schedules"
            }), schedules.length === 0 ? /* @__PURE__ */ jsx("div", {
              className: "text-zinc-400 text-sm italic py-8 text-center border-2 border-dashed rounded-lg",
              children: "No schedules configured."
            }) : schedules.map((s) => /* @__PURE__ */ jsxs("div", {
              className: "bg-white dark:bg-zinc-900 p-3 rounded-lg border border-zinc-100 dark:border-zinc-800 flex justify-between items-center shadow-sm",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "w-10 h-10 bg-zinc-50 dark:bg-zinc-800 rounded-full flex items-center justify-center text-blue-600",
                  children: /* @__PURE__ */ jsx(Mail, {
                    size: 18
                  })
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "text-sm font-bold capitalize",
                    children: [s.reportType, " ", s.frequency]
                  }), /* @__PURE__ */ jsx("div", {
                    className: "text-xs text-zinc-500 truncate max-w-[200px]",
                    children: s.recipients.join(", ")
                  })]
                })]
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleDeleteSchedule(s.id),
                className: "p-2 text-zinc-400 hover:text-red-500 transition-colors",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 16
                })
              })]
            }, s.id))]
          })]
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",
      children: [activeTab === "financials" && revenueData && /* @__PURE__ */ jsxs(Fragment, {
        children: [/* @__PURE__ */ jsx(MetricCard$2, {
          title: "Gross Volume (Period)",
          value: /* @__PURE__ */ jsx(PrivacyBlur, {
            revealed: !shouldBlur,
            placeholder: "***",
            children: `$${(revenueData.grossVolume / 100).toFixed(2)}`
          }),
          icon: /* @__PURE__ */ jsx(DollarSign, {
            size: 20,
            className: "text-green-500"
          })
        }), /* @__PURE__ */ jsx(MetricCard$2, {
          title: "Monthly Recurring Revenue",
          value: /* @__PURE__ */ jsx(PrivacyBlur, {
            revealed: !shouldBlur,
            placeholder: "***",
            children: `$${(revenueData.mrr / 100).toFixed(2)}`
          }),
          subtext: "Active subscriptions snapshot",
          icon: /* @__PURE__ */ jsx(TrendingUp, {
            size: 20,
            className: "text-blue-500"
          })
        }), /* @__PURE__ */ jsx(MetricCard$2, {
          title: "Sales Breakdown",
          value: /* @__PURE__ */ jsx(PrivacyBlur, {
            revealed: !shouldBlur,
            placeholder: "***",
            children: `${(revenueData.breakdown.retail / (revenueData.grossVolume || 1) * 100).toFixed(0)}% Retail`
          }),
          subtext: `$${(revenueData.breakdown.packs / 100).toFixed(0)} Packs`,
          icon: /* @__PURE__ */ jsx(DollarSign, {
            size: 20,
            className: "text-purple-500"
          })
        })]
      }), activeTab === "attendance" && attendanceData && /* @__PURE__ */ jsxs(Fragment, {
        children: [/* @__PURE__ */ jsx(MetricCard$2, {
          title: "Total Bookings",
          value: attendanceData.totalBookings,
          icon: /* @__PURE__ */ jsx(Users, {
            size: 20,
            className: "text-blue-500"
          })
        }), /* @__PURE__ */ jsx(MetricCard$2, {
          title: "Check-in Rate",
          value: `${(attendanceData.totalCheckins / (attendanceData.totalBookings || 1) * 100).toFixed(0)}%`,
          subtext: `${attendanceData.totalCheckins} Checked-in`,
          icon: /* @__PURE__ */ jsx(CheckCircle2, {
            size: 20,
            className: "text-green-500"
          })
        })]
      })]
    }), activeTab === "projections" ? /* @__PURE__ */ jsx(ProjectionsCalculator, {}) : /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "lg:col-span-2 bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm relative",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-semibold mb-6",
          children: activeTab === "financials" ? "Revenue Trends" : "Attendance Trends"
        }), shouldBlur && activeTab === "financials" && /* @__PURE__ */ jsx("div", {
          className: "absolute inset-0 z-10 backdrop-blur-md bg-white/30 dark:bg-black/30 flex items-center justify-center rounded-xl",
          children: /* @__PURE__ */ jsx("div", {
            className: "bg-white dark:bg-zinc-800 px-4 py-2 rounded-lg shadow lg text-sm font-medium",
            children: "Privacy Mode Enabled"
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "h-80 w-full flex items-center justify-center text-zinc-400 text-sm",
          children: [activeTab === "financials" && revenueData?.chartData ? isEmpty(revenueData.chartData) ? /* @__PURE__ */ jsxs("div", {
            className: "text-center",
            children: [/* @__PURE__ */ jsx("div", {
              className: "mb-2",
              children: "No revenue data for this period"
            }), /* @__PURE__ */ jsx("div", {
              className: "text-xs text-zinc-500",
              children: "Record sales in POS to see trends"
            })]
          }) : /* @__PURE__ */ jsx(ResponsiveContainer, {
            width: "100%",
            height: "100%",
            children: /* @__PURE__ */ jsxs(AreaChart, {
              data: revenueData.chartData,
              children: [/* @__PURE__ */ jsx(CartesianGrid, {
                strokeDasharray: "3 3",
                vertical: false,
                stroke: "#E4E4E7"
              }), /* @__PURE__ */ jsx(XAxis, {
                dataKey: "name",
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                },
                dy: 10,
                tickFormatter: (val) => formatDate(val)
              }), /* @__PURE__ */ jsx(YAxis, {
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                }
              }), /* @__PURE__ */ jsx(Tooltip, {
                contentStyle: {
                  borderRadius: "8px",
                  border: "none",
                  boxShadow: "0 4px 6px -1px rgb(0 0 0 / 0.1)"
                },
                formatter: (value) => [`$${Number(value).toFixed(2)}`, "Revenue"],
                labelFormatter: (l) => new Date(l).toLocaleDateString()
              }), /* @__PURE__ */ jsx(Area, {
                type: "monotone",
                dataKey: "value",
                stroke: "#3B82F6",
                fill: "#EFF6FF",
                strokeWidth: 2
              })]
            })
          }) : null, activeTab === "attendance" && attendanceData?.chartData ? isEmpty(attendanceData.chartData) ? /* @__PURE__ */ jsx("div", {
            className: "text-center",
            children: /* @__PURE__ */ jsx("div", {
              className: "mb-2",
              children: "No attendance data for this period"
            })
          }) : /* @__PURE__ */ jsx(ResponsiveContainer, {
            width: "100%",
            height: "100%",
            children: /* @__PURE__ */ jsxs(AreaChart, {
              data: attendanceData.chartData,
              children: [/* @__PURE__ */ jsx(CartesianGrid, {
                strokeDasharray: "3 3",
                vertical: false,
                stroke: "#E4E4E7"
              }), /* @__PURE__ */ jsx(XAxis, {
                dataKey: "name",
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                },
                dy: 10,
                tickFormatter: (val) => formatDate(val)
              }), /* @__PURE__ */ jsx(YAxis, {
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                }
              }), /* @__PURE__ */ jsx(Tooltip, {
                contentStyle: {
                  borderRadius: "8px",
                  border: "none",
                  boxShadow: "0 4px 6px -1px rgb(0 0 0 / 0.1)"
                },
                formatter: (value) => [value, "Attendees"],
                labelFormatter: (l) => new Date(l).toLocaleDateString()
              }), /* @__PURE__ */ jsx(Area, {
                type: "monotone",
                dataKey: "value",
                stroke: "#10B981",
                fill: "#ECFDF5",
                strokeWidth: 2
              })]
            })
          }) : null]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm relative",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-semibold mb-6",
          children: activeTab === "financials" ? "Top Selling" : "Top Classes"
        }), shouldBlur && activeTab === "financials" && /* @__PURE__ */ jsx("div", {
          className: "absolute inset-0 z-10 backdrop-blur-md bg-white/30 dark:bg-black/30 flex items-center justify-center rounded-xl"
        }), activeTab === "attendance" && attendanceData?.topClasses && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [attendanceData.topClasses.map((c, i) => /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium truncate max-w-[180px]",
              children: c.title
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-24 h-2 bg-zinc-100 rounded-full overflow-hidden",
                children: /* @__PURE__ */ jsx("div", {
                  className: "h-full bg-blue-500",
                  style: {
                    width: `${Math.min(c.attendees / 50 * 100, 100)}%`
                  }
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500 w-6 text-right",
                children: c.attendees
              })]
            })]
          }, i)), attendanceData.topClasses.length === 0 && /* @__PURE__ */ jsx("div", {
            className: "text-center text-sm text-zinc-500 py-8",
            children: "No data available"
          })]
        }), activeTab === "financials" && revenueData?.breakdown && /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [Object.entries(revenueData.breakdown).map(([key, value]) => {
            const val = Number(value);
            if (val === 0) return null;
            const total = revenueData.grossVolume || 1;
            const percent = val / total * 100;
            return /* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium capitalize text-zinc-700 dark:text-zinc-300",
                children: key
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "w-24 h-2 bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",
                  children: /* @__PURE__ */ jsx("div", {
                    className: "h-full bg-emerald-500",
                    style: {
                      width: `${percent}%`
                    }
                  })
                }), /* @__PURE__ */ jsxs("span", {
                  className: "text-xs font-mono text-zinc-500 w-16 text-right",
                  children: ["$", (val / 100).toFixed(2)]
                })]
              })]
            }, key);
          }), Object.values(revenueData.breakdown).every((v) => v === 0) && /* @__PURE__ */ jsx("div", {
            className: "text-center text-sm text-zinc-500 py-8",
            children: "No specific sales data recorded."
          })]
        })]
      })]
    })]
  });
});
function MetricCard$2({
  title,
  value,
  subtext,
  icon
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
    children: [/* @__PURE__ */ jsx("div", {
      className: "flex justify-between items-start mb-4",
      children: /* @__PURE__ */ jsx("div", {
        className: "p-2 bg-zinc-50 dark:bg-zinc-800 rounded-lg",
        children: icon
      })
    }), /* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("p", {
        className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1",
        children: title
      }), /* @__PURE__ */ jsx("div", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: value
      }), subtext && /* @__PURE__ */ jsx("p", {
        className: "text-xs text-zinc-500 mt-2",
        children: subtext
      })]
    })]
  });
}
function isEmpty(data) {
  if (!data || data.length === 0) return true;
  return data.every((d) => d.value === 0);
}
function formatDate(iso) {
  const d = new Date(iso);
  return `${d.getMonth() + 1}/${d.getDate()}`;
}
const route60 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_reports
}, Symbol.toStringTag, { value: "Module" }));
const loader$J = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const url = new URL(args.request.url);
  const days = url.searchParams.get("days") || "30";
  const token = await getToken();
  try {
    const [revenueData, attendanceData] = await Promise.all([apiRequest(`/reports/revenue?days=${days}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), apiRequest(`/reports/attendance?days=${days}`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    return {
      revenue: revenueData,
      attendance: attendanceData,
      days: parseInt(days)
    };
  } catch (e) {
    console.error("Reports Loader Error", e);
    return {
      revenue: null,
      attendance: null,
      days: parseInt(days)
    };
  }
};
const studio_$slug_reports_advanced = UNSAFE_withComponentProps(function AdvancedReports() {
  const {
    revenue,
    attendance,
    days
  } = useLoaderData();
  const [searchParams, setSearchParams] = useSearchParams();
  const formatCurrency = (cents) => `$${(cents / 100).toLocaleString("en-US", {
    minimumFractionDigits: 2
  })}`;
  const formatNumber = (n) => n.toLocaleString();
  const changeDays = (newDays) => {
    setSearchParams({
      days: newDays.toString()
    });
  };
  const maxValue = Math.max(...revenue?.chartData?.map((d) => d.value) || [1]);
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsx("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-zinc-900 rounded-lg text-white",
            children: /* @__PURE__ */ jsx(BarChart3, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-xl font-bold text-zinc-900",
              children: "Advanced Reports"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500",
              children: "Analytics & insights"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsxs("select", {
            value: days,
            onChange: (e) => changeDays(parseInt(e.target.value)),
            className: "px-3 py-2 border border-zinc-200 rounded-lg text-sm",
            children: [/* @__PURE__ */ jsx("option", {
              value: "7",
              children: "Last 7 days"
            }), /* @__PURE__ */ jsx("option", {
              value: "30",
              children: "Last 30 days"
            }), /* @__PURE__ */ jsx("option", {
              value: "90",
              children: "Last 90 days"
            }), /* @__PURE__ */ jsx("option", {
              value: "365",
              children: "Last year"
            })]
          }), /* @__PURE__ */ jsx("button", {
            className: "p-2 hover:bg-zinc-100 rounded-lg",
            children: /* @__PURE__ */ jsx(Download, {
              size: 18
            })
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 overflow-y-auto p-6 space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-4 gap-4",
        children: [/* @__PURE__ */ jsx(MetricCard$1, {
          icon: DollarSign,
          label: "Gross Revenue",
          value: formatCurrency(revenue?.grossVolume || 0),
          color: "emerald"
        }), /* @__PURE__ */ jsx(MetricCard$1, {
          icon: Activity,
          label: "MRR",
          value: formatCurrency(revenue?.mrr || 0),
          color: "blue"
        }), /* @__PURE__ */ jsx(MetricCard$1, {
          icon: Calendar,
          label: "Total Bookings",
          value: formatNumber(attendance?.totalBookings || 0),
          color: "purple"
        }), /* @__PURE__ */ jsx(MetricCard$1, {
          icon: Target,
          label: "Check-in Rate",
          value: attendance?.totalBookings ? `${Math.round((attendance?.totalCheckins || 0) / attendance.totalBookings * 100)}%` : "0%",
          color: "orange"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 p-6",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "font-bold text-zinc-900 mb-4 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(TrendingUp, {
            size: 18,
            className: "text-emerald-500"
          }), " Revenue Over Time"]
        }), /* @__PURE__ */ jsx("div", {
          className: "h-48 flex items-end gap-1",
          children: revenue?.chartData?.slice(-30).map((d, i) => /* @__PURE__ */ jsx("div", {
            className: "flex-1 bg-emerald-500 rounded-t hover:bg-emerald-600 transition relative group",
            style: {
              height: `${Math.max(2, d.value / maxValue * 100)}%`
            },
            children: /* @__PURE__ */ jsxs("div", {
              className: "absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-2 py-1 bg-zinc-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 whitespace-nowrap",
              children: [d.name, ": ", formatCurrency(d.value)]
            })
          }, i)) || /* @__PURE__ */ jsx("div", {
            className: "flex-1 text-center text-zinc-400",
            children: "No data"
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between mt-2 text-xs text-zinc-500",
          children: [/* @__PURE__ */ jsx("span", {
            children: revenue?.chartData?.[0]?.name || ""
          }), /* @__PURE__ */ jsx("span", {
            children: revenue?.chartData?.[revenue?.chartData?.length - 1]?.name || ""
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-2 gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-xl border border-zinc-200 p-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "font-bold text-zinc-900 mb-4",
            children: "Revenue Sources"
          }), /* @__PURE__ */ jsx("div", {
            className: "space-y-3",
            children: revenue?.breakdown && Object.entries(revenue.breakdown).map(([key, value], i) => /* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "w-3 h-3 rounded-full",
                  style: {
                    backgroundColor: ["#10b981", "#3b82f6", "#8b5cf6", "#f59e0b"][i % 4]
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 capitalize",
                  children: key
                })]
              }), /* @__PURE__ */ jsx("span", {
                className: "font-medium",
                children: formatCurrency(value)
              })]
            }, i)) || /* @__PURE__ */ jsx("p", {
              className: "text-zinc-400 text-sm",
              children: "No breakdown available"
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-xl border border-zinc-200 p-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "font-bold text-zinc-900 mb-4",
            children: "Top Classes"
          }), /* @__PURE__ */ jsx("div", {
            className: "space-y-3",
            children: attendance?.topClasses?.slice(0, 5).map((cls, i) => /* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "w-6 h-6 bg-zinc-100 rounded-full flex items-center justify-center text-xs font-medium",
                  children: i + 1
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-700 truncate max-w-[200px]",
                  children: cls.title
                })]
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-sm text-zinc-500",
                children: [cls.attendees, " attendees"]
              })]
            }, i)) || /* @__PURE__ */ jsx("p", {
              className: "text-zinc-400 text-sm",
              children: "No classes data"
            })
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 p-6",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "font-bold text-zinc-900 mb-4 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Calendar, {
            size: 18,
            className: "text-purple-500"
          }), " Attendance Over Time"]
        }), /* @__PURE__ */ jsx("div", {
          className: "h-32 flex items-end gap-1",
          children: attendance?.chartData?.slice(-30).map((d, i) => {
            const max = Math.max(...attendance?.chartData?.map((x) => x.value) || [1]);
            return /* @__PURE__ */ jsx("div", {
              className: "flex-1 bg-purple-500 rounded-t hover:bg-purple-600 transition",
              style: {
                height: `${Math.max(2, d.value / max * 100)}%`
              }
            }, i);
          }) || /* @__PURE__ */ jsx("div", {
            className: "flex-1 text-center text-zinc-400",
            children: "No data"
          })
        })]
      })]
    })]
  });
});
function MetricCard$1({
  icon: Icon,
  label,
  value,
  color
}) {
  const colors = {
    emerald: "bg-emerald-100 text-emerald-600",
    blue: "bg-blue-100 text-blue-600",
    purple: "bg-purple-100 text-purple-600",
    orange: "bg-orange-100 text-orange-600"
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white rounded-xl border border-zinc-200 p-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-2 mb-2",
      children: [/* @__PURE__ */ jsx("div", {
        className: `p-1.5 rounded-lg ${colors[color]}`,
        children: /* @__PURE__ */ jsx(Icon, {
          size: 16
        })
      }), /* @__PURE__ */ jsx("span", {
        className: "text-xs font-medium text-zinc-500",
        children: label
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "text-2xl font-bold text-zinc-900",
      children: value
    })]
  });
}
const route61 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_reports_advanced,
  loader: loader$J
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_reports_custom = UNSAFE_withComponentProps(function CustomReports() {
  const {
    tenant
  } = useOutletContext() || {};
  const {
    slug
  } = useParams();
  const [savedReports, setSavedReports] = useState([]);
  const [loading, setLoading] = useState(false);
  const [selectedMetrics, setSelectedMetrics] = useState(["revenue"]);
  const [selectedDimensions, setSelectedDimensions] = useState(["date"]);
  const [dateRange, setDateRange] = useState({
    start: "",
    end: ""
  });
  const [instructorId, setInstructorId] = useState("");
  const [activeResult, setActiveResult] = useState(null);
  const [reportName, setReportName] = useState("");
  const [reportToDelete, setReportToDelete] = useState(null);
  useEffect(() => {
    loadSavedReports();
    const end = /* @__PURE__ */ new Date();
    const start = /* @__PURE__ */ new Date();
    start.setDate(end.getDate() - 30);
    setDateRange({
      start: start.toISOString().split("T")[0],
      end: end.toISOString().split("T")[0]
    });
  }, []);
  const loadSavedReports = async () => {
    const token = await window.Clerk?.session?.getToken();
    try {
      const res = await apiRequest("/reports/custom", token);
      setSavedReports(res.reports || []);
    } catch (e) {
      console.error("Failed to load reports", e);
    }
  };
  const runQuery = async () => {
    setLoading(true);
    const token = await window.Clerk?.session?.getToken();
    try {
      const res = await apiRequest("/reports/custom/query", token, {
        method: "POST",
        body: JSON.stringify({
          metrics: selectedMetrics,
          dimensions: selectedDimensions,
          filters: {
            startDate: dateRange.start,
            endDate: dateRange.end,
            instructorId: instructorId || void 0
          }
        })
      });
      setActiveResult(res);
    } catch (e) {
      console.error(e);
      alert("Query failed");
    } finally {
      setLoading(false);
    }
  };
  const saveReport = async () => {
    if (!reportName) return alert("Enter a name");
    const token = await window.Clerk?.session?.getToken();
    try {
      await apiRequest("/reports/custom", token, {
        method: "POST",
        body: JSON.stringify({
          name: reportName,
          config: {
            metrics: selectedMetrics,
            dimensions: selectedDimensions,
            filters: {
              startDate: dateRange.start,
              endDate: dateRange.end,
              // Store absolute or relative? simplified absolute for now
              instructorId
            }
          }
        })
      });
      setReportName("");
      loadSavedReports();
    } catch (e) {
      console.error(e);
    }
  };
  const loadReportConfig = (report) => {
    const config = report.config;
    if (config.metrics) setSelectedMetrics(config.metrics);
    if (config.dimensions) setSelectedDimensions(config.dimensions);
    if (config.filters) {
      setDateRange({
        start: config.filters.startDate ? new Date(config.filters.startDate).toISOString().split("T")[0] : "",
        end: config.filters.endDate ? new Date(config.filters.endDate).toISOString().split("T")[0] : ""
      });
      setInstructorId(config.filters.instructorId || "");
    }
  };
  const deleteReport = (id, e) => {
    e.stopPropagation();
    setReportToDelete(id);
  };
  const confirmDeleteReport = async () => {
    if (!reportToDelete) return;
    const token = await window.Clerk?.session?.getToken();
    await apiRequest(`/reports/custom/${reportToDelete}`, token, {
      method: "DELETE"
    });
    loadSavedReports();
    setReportToDelete(null);
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-7xl mx-auto min-h-screen",
    children: [/* @__PURE__ */ jsx("div", {
      className: "flex justify-between items-center mb-8",
      children: /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 text-zinc-500 mb-1",
          children: [/* @__PURE__ */ jsx(Link, {
            to: `/studio/${slug}/reports`,
            className: "hover:underline",
            children: "Analytics"
          }), /* @__PURE__ */ jsx("span", {
            children: "/"
          }), /* @__PURE__ */ jsx("span", {
            children: "Custom Query"
          })]
        }), /* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Custom Report Builder"
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-4 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "font-semibold mb-4 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Filter, {
              size: 16
            }), " Query Options"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-medium text-zinc-500 uppercase mb-2 block",
                children: "Metrics"
              }), /* @__PURE__ */ jsx("div", {
                className: "space-y-2",
                children: ["revenue", "attendance"].map((m) => /* @__PURE__ */ jsxs("label", {
                  className: "flex items-center gap-2 text-sm",
                  children: [/* @__PURE__ */ jsx("input", {
                    type: "checkbox",
                    checked: selectedMetrics.includes(m),
                    onChange: (e) => {
                      if (e.target.checked) setSelectedMetrics([...selectedMetrics, m]);
                      else setSelectedMetrics(selectedMetrics.filter((x) => x !== m));
                    },
                    className: "rounded border-zinc-300 text-brand-600 focus:ring-brand-500"
                  }), /* @__PURE__ */ jsx("span", {
                    className: "capitalize",
                    children: m
                  })]
                }, m))
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-medium text-zinc-500 uppercase mb-2 block",
                children: "Group By"
              }), /* @__PURE__ */ jsx("div", {
                className: "space-y-2",
                children: ["date", "instructor"].map((d) => /* @__PURE__ */ jsxs("label", {
                  className: "flex items-center gap-2 text-sm",
                  children: [/* @__PURE__ */ jsx("input", {
                    type: "checkbox",
                    checked: selectedDimensions.includes(d),
                    onChange: (e) => {
                      if (e.target.checked) setSelectedDimensions([...selectedDimensions, d]);
                      else setSelectedDimensions(selectedDimensions.filter((x) => x !== d));
                    }
                  }), /* @__PURE__ */ jsx("span", {
                    className: "capitalize",
                    children: d
                  })]
                }, d))
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "text-xs font-medium text-zinc-500 uppercase mb-2 block",
                children: "Date Range"
              }), /* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-2 gap-2",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "date",
                  value: dateRange.start,
                  onChange: (e) => setDateRange({
                    ...dateRange,
                    start: e.target.value
                  }),
                  className: "w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"
                }), /* @__PURE__ */ jsx("input", {
                  type: "date",
                  value: dateRange.end,
                  onChange: (e) => setDateRange({
                    ...dateRange,
                    end: e.target.value
                  }),
                  className: "w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"
                })]
              })]
            }), /* @__PURE__ */ jsxs("button", {
              onClick: runQuery,
              disabled: loading,
              className: "w-full py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg font-medium hover:opacity-90 flex justify-center items-center gap-2",
              children: [loading && /* @__PURE__ */ jsx(Loader2, {
                size: 16,
                className: "animate-spin"
              }), "Run Query"]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold mb-4 text-sm",
            children: "Saved Reports"
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-2",
            children: [savedReports.map((r) => /* @__PURE__ */ jsxs("div", {
              onClick: () => loadReportConfig(r),
              className: "p-3 bg-zinc-50 dark:bg-zinc-800 rounded-lg cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-700 group flex justify-between items-center",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium",
                children: r.name
              }), /* @__PURE__ */ jsx("button", {
                onClick: (e) => deleteReport(r.id, e),
                className: "text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 12
                })
              })]
            }, r.id)), savedReports.length === 0 && /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500",
              children: "No saved reports."
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "lg:col-span-3 space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm flex justify-between items-center",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("h2", {
              className: "font-semibold text-lg",
              children: "Results"
            }), activeResult && /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4 text-sm text-zinc-500",
              children: [activeResult.summary.revenue !== void 0 && /* @__PURE__ */ jsxs("span", {
                children: ["Revenue: ", /* @__PURE__ */ jsxs("b", {
                  children: ["$", activeResult.summary.revenue.toFixed(2)]
                })]
              }), activeResult.summary.attendance !== void 0 && /* @__PURE__ */ jsxs("span", {
                children: ["Attendance: ", /* @__PURE__ */ jsx("b", {
                  children: activeResult.summary.attendance
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex gap-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "text",
              placeholder: "Report Name",
              value: reportName,
              onChange: (e) => setReportName(e.target.value),
              className: "px-3 py-1.5 rounded border border-zinc-300 dark:border-zinc-700 bg-transparent text-sm"
            }), /* @__PURE__ */ jsxs("button", {
              onClick: saveReport,
              className: "flex items-center gap-2 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 rounded text-sm font-medium",
              children: [/* @__PURE__ */ jsx(Save, {
                size: 14
              }), " Save"]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm min-h-[400px]",
          children: activeResult && activeResult.chartData && activeResult.chartData.length > 0 ? /* @__PURE__ */ jsx(ResponsiveContainer, {
            width: "100%",
            height: 400,
            children: /* @__PURE__ */ jsxs(BarChart, {
              data: activeResult.chartData,
              children: [/* @__PURE__ */ jsx(CartesianGrid, {
                strokeDasharray: "3 3",
                vertical: false,
                stroke: "#E4E4E7"
              }), /* @__PURE__ */ jsx(XAxis, {
                dataKey: "name",
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                },
                dy: 10,
                tickFormatter: (val) => val.length > 10 ? new Date(val).toLocaleDateString() : val
              }), /* @__PURE__ */ jsx(YAxis, {
                axisLine: false,
                tickLine: false,
                tick: {
                  fill: "#71717A",
                  fontSize: 12
                }
              }), /* @__PURE__ */ jsx(Tooltip, {
                contentStyle: {
                  borderRadius: "8px",
                  border: "none",
                  boxShadow: "0 4px 6px -1px rgb(0 0 0 / 0.1)"
                }
              }), /* @__PURE__ */ jsx(Legend, {}), selectedMetrics.includes("revenue") && /* @__PURE__ */ jsx(Bar, {
                dataKey: "revenue",
                fill: "#3B82F6",
                name: "Revenue ($)",
                radius: [4, 4, 0, 0]
              }), selectedMetrics.includes("attendance") && /* @__PURE__ */ jsx(Bar, {
                dataKey: "attendance",
                fill: "#10B981",
                name: "Attendance",
                radius: [4, 4, 0, 0]
              })]
            })
          }) : /* @__PURE__ */ jsxs("div", {
            className: "h-full flex flex-col items-center justify-center text-zinc-400",
            children: [/* @__PURE__ */ jsx(BarChart3, {
              size: 48,
              className: "mb-4 opacity-50"
            }), /* @__PURE__ */ jsx("p", {
              children: "Run a query to see results"
            })]
          })
        })]
      })]
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!reportToDelete,
      onOpenChange: (open) => !open && setReportToDelete(null),
      onConfirm: confirmDeleteReport,
      title: "Delete Report",
      description: "Are you sure you want to delete this saved report?",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
});
const route62 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_reports_custom
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_waivers = UNSAFE_withComponentProps(function StudioWaiversLayout() {
  const context = useOutletContext();
  return /* @__PURE__ */ jsx(Outlet, {
    context
  });
});
const route63 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_waivers
}, Symbol.toStringTag, { value: "Module" }));
function SignaturePad({ onChange, width = 500, height = 200 }) {
  const canvasRef = useRef(null);
  const [isDrawing, setIsDrawing] = useState(false);
  const [hasSignature, setHasSignature] = useState(false);
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000000";
  }, []);
  const draw = (e) => {
    if (!isDrawing) return;
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    const rect = canvas.getBoundingClientRect();
    let x, y;
    if ("touches" in e) {
      x = e.touches[0].clientX - rect.left;
      y = e.touches[0].clientY - rect.top;
    } else {
      x = e.clientX - rect.left;
      y = e.clientY - rect.top;
    }
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
  };
  const handleMouseDown = (e) => {
    setIsDrawing(true);
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    ctx.beginPath();
    ctx.moveTo(x, y);
  };
  const clear = (e) => {
    e.preventDefault();
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    setHasSignature(false);
    onChange(null);
  };
  return /* @__PURE__ */ jsxs("div", { className: "border border-zinc-300 rounded-lg overflow-hidden bg-white inline-block", children: [
    /* @__PURE__ */ jsx(
      "canvas",
      {
        ref: canvasRef,
        width,
        height,
        className: "touch-none cursor-crosshair bg-white",
        style: { touchAction: "none" },
        onMouseDown: handleMouseDown,
        onMouseMove: (e) => {
          if (!isDrawing) return;
          draw(e);
        },
        onMouseUp: () => {
          setIsDrawing(false);
          const canvas = canvasRef.current;
          if (canvas) {
            const ctx = canvas.getContext("2d");
            ctx?.beginPath();
            onChange(canvas.toDataURL());
            setHasSignature(true);
          }
        },
        onMouseLeave: () => {
          setIsDrawing(false);
          const canvas = canvasRef.current;
          if (canvas && isDrawing) {
            const ctx = canvas.getContext("2d");
            ctx?.beginPath();
            onChange(canvas.toDataURL());
            setHasSignature(true);
          }
        },
        onTouchStart: (e) => {
          const canvas = canvasRef.current;
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          if (!ctx) return;
          const rect = canvas.getBoundingClientRect();
          const x = e.touches[0].clientX - rect.left;
          const y = e.touches[0].clientY - rect.top;
          ctx.beginPath();
          ctx.moveTo(x, y);
          setIsDrawing(true);
        },
        onTouchMove: (e) => {
          if (!isDrawing) return;
          draw(e);
        },
        onTouchEnd: () => {
          setIsDrawing(false);
          const canvas = canvasRef.current;
          if (canvas) {
            const ctx = canvas.getContext("2d");
            ctx?.beginPath();
            onChange(canvas.toDataURL());
            setHasSignature(true);
          }
        }
      }
    ),
    /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 border-t border-zinc-200 p-2 flex justify-between items-center px-4", children: [
      /* @__PURE__ */ jsx("span", { className: "text-xs text-zinc-500", children: "Sign above" }),
      /* @__PURE__ */ jsx(
        "button",
        {
          type: "button",
          onClick: clear,
          className: "text-xs text-red-600 hover:text-red-800 font-medium",
          children: "Clear Signature"
        }
      )
    ] })
  ] });
}
const loader$I = async (args) => {
  const {
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const data = await apiRequest("/waivers", token, {
      headers: {
        "X-Tenant-Slug": params.slug
      }
    });
    return {
      data
    };
  } catch (e) {
    console.error("Failed to load waivers", e);
    return {
      data: null,
      error: e.message
    };
  }
};
const action$7 = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const intent = formData.get("intent");
  if (intent === "create") {
    const title = formData.get("title");
    const content = formData.get("content");
    const pdfUrl = formData.get("pdfUrl");
    try {
      await apiRequest("/waivers", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          title,
          content,
          pdfUrl
        })
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  } else if (intent === "toggle_active") {
    const templateId = formData.get("templateId");
    const active = formData.get("active") === "true";
    try {
      await apiRequest(`/waivers/${templateId}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          active
        })
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  } else if (intent === "sign") {
    const templateId = formData.get("templateId");
    const signatureData = formData.get("signatureData");
    const onBehalfOfMemberId = formData.get("onBehalfOfMemberId");
    try {
      await apiRequest(`/waivers/${templateId}/sign`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": params.slug
        },
        body: JSON.stringify({
          signatureData,
          onBehalfOfMemberId
        })
      });
      return {
        success: true
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  return null;
};
const studio_$slug_waivers__index = UNSAFE_withComponentProps(function StudioWaivers() {
  const {
    data,
    error
  } = useLoaderData();
  const {
    me,
    roles
  } = useOutletContext();
  const isOwner = roles.includes("owner");
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";
  const [signature, setSignature] = useState(null);
  if (error) {
    return /* @__PURE__ */ jsxs("div", {
      className: "p-8 text-red-600",
      children: ["Error: ", error]
    });
  }
  if (isOwner) {
    const templates = data?.templates || [];
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-4xl mx-auto py-8 px-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center mb-6",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Waivers & Forms"
        }), /* @__PURE__ */ jsx(Link, {
          to: "new",
          className: "px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium flex items-center gap-2",
          children: "+ Create Waiver"
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "space-y-4",
        children: templates.length === 0 ? /* @__PURE__ */ jsxs("div", {
          className: "p-12 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-700",
          children: [/* @__PURE__ */ jsx("p", {
            className: "mb-2 font-medium",
            children: "No waiver templates yet"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm",
            children: "Create a liability waiver for your members to sign."
          })]
        }) : templates.map((t) => /* @__PURE__ */ jsxs("div", {
          className: "p-6 rounded-lg shadow-sm bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 transition-colors",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-start mb-2",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-bold text-lg text-zinc-900 dark:text-zinc-100",
              children: t.title
            }), /* @__PURE__ */ jsxs(Form, {
              method: "post",
              children: [/* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "intent",
                value: "toggle_active"
              }), /* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "templateId",
                value: t.id
              }), /* @__PURE__ */ jsx("input", {
                type: "hidden",
                name: "active",
                value: (!t.active).toString()
              }), /* @__PURE__ */ jsx("button", {
                type: "submit",
                className: `text-xs px-2 py-1 rounded border font-medium transition-colors ${t.active ? "bg-green-100 text-green-800 border-green-200 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800" : "bg-zinc-100 text-zinc-800 border-zinc-200 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}`,
                children: t.active ? "Active" : "Inactive"
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "text-sm line-clamp-3 mb-1 whitespace-pre-wrap text-zinc-600 dark:text-zinc-400 font-mono bg-zinc-50 dark:bg-zinc-950 p-3 rounded border border-zinc-100 dark:border-zinc-800/50",
            children: t.content
          })]
        }, t.id))
      })]
    });
  }
  const {
    waiver,
    required,
    signed,
    signatureDate,
    family,
    signedMemberIds
  } = data || {};
  const [selectedMemberId, setSelectedMemberId] = useState(null);
  if (!required || !waiver) {
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-md mx-auto py-12 px-4 text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "mb-4 inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",
        children: /* @__PURE__ */ jsxs("svg", {
          xmlns: "http://www.w3.org/2000/svg",
          width: "24",
          height: "24",
          viewBox: "0 0 24 24",
          fill: "none",
          stroke: "currentColor",
          strokeWidth: "2",
          strokeLinecap: "round",
          strokeLinejoin: "round",
          children: [/* @__PURE__ */ jsx("path", {
            d: "M22 11.08V12a10 10 0 1 1-5.93-9.14"
          }), /* @__PURE__ */ jsx("polyline", {
            points: "22 4 12 14.01 9 11.01"
          })]
        })
      }), /* @__PURE__ */ jsx("h2", {
        className: "text-xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",
        children: "Good to go!"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "You have no pending waivers to sign."
      })]
    });
  }
  const isSigned = signedMemberIds?.includes(selectedMemberId || me?.id);
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-2xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsx("h2", {
      className: "text-2xl font-bold mb-6 text-zinc-900 dark:text-zinc-100",
      children: waiver.title
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-6 max-h-[60vh] overflow-y-auto",
      children: /* @__PURE__ */ jsx("div", {
        className: "prose dark:prose-invert text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap font-serif text-sm leading-relaxed",
        children: waiver.content
      })
    }), family && family.length > 0 && /* @__PURE__ */ jsxs("div", {
      className: "mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-lg p-4",
      children: [/* @__PURE__ */ jsx("label", {
        className: "block text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",
        children: "Who are you signing for?"
      }), /* @__PURE__ */ jsxs("select", {
        className: "w-full bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-md text-sm px-3 py-2",
        value: selectedMemberId || "",
        onChange: (e) => setSelectedMemberId(e.target.value || null),
        children: [/* @__PURE__ */ jsxs("option", {
          value: "",
          children: ["Myself ", signed ? "âœ…" : ""]
        }), family.map((f) => /* @__PURE__ */ jsxs("option", {
          value: f.memberId,
          children: [f.firstName, " ", f.lastName, " ", signedMemberIds?.includes(f.memberId) ? "âœ…" : ""]
        }, f.memberId))]
      })]
    }), isSigned ? /* @__PURE__ */ jsxs("div", {
      className: "bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900/50 text-green-800 dark:text-green-300 p-6 rounded-lg flex flex-col items-center justify-center gap-2 text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "text-2xl",
        children: "âœ…"
      }), /* @__PURE__ */ jsx("div", {
        className: "font-bold",
        children: "Waiver Signed"
      }), /* @__PURE__ */ jsx("div", {
        className: "text-sm opacity-80",
        children: "This member has successfully signed the waiver."
      })]
    }) : /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "font-bold mb-4 text-zinc-900 dark:text-white",
        children: "Sign Waiver"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-sm text-zinc-600 dark:text-zinc-400 mb-4",
        children: "Please draw your signature below to accept this agreement."
      }), /* @__PURE__ */ jsx("div", {
        className: "mb-6 bg-white dark:bg-zinc-950 rounded border border-zinc-200 dark:border-zinc-800 overflow-hidden",
        children: /* @__PURE__ */ jsx(SignaturePad, {
          onChange: (data2) => setSignature(data2),
          width: 600,
          height: 200
        })
      }), signature && /* @__PURE__ */ jsxs("p", {
        className: "text-xs text-green-600 dark:text-green-400 mb-4 flex items-center gap-1 font-medium",
        children: [/* @__PURE__ */ jsx("svg", {
          xmlns: "http://www.w3.org/2000/svg",
          width: "16",
          height: "16",
          viewBox: "0 0 24 24",
          fill: "none",
          stroke: "currentColor",
          strokeWidth: "2",
          strokeLinecap: "round",
          strokeLinejoin: "round",
          children: /* @__PURE__ */ jsx("polyline", {
            points: "20 6 9 17 4 12"
          })
        }), "Signature captured"]
      }), /* @__PURE__ */ jsxs(Form, {
        method: "post",
        children: [/* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "intent",
          value: "sign"
        }), /* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "templateId",
          value: waiver.id
        }), /* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "signatureData",
          value: signature || ""
        }), /* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "onBehalfOfMemberId",
          value: selectedMemberId || ""
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-3 mb-6",
          children: [/* @__PURE__ */ jsx("input", {
            type: "checkbox",
            required: true,
            id: "agree",
            className: "mt-1 w-4 h-4 rounded border-zinc-300 text-blue-600 focus:ring-blue-500"
          }), /* @__PURE__ */ jsx("label", {
            htmlFor: "agree",
            className: "text-sm text-zinc-700 dark:text-zinc-300 leading-snug",
            children: "I have read and agree to the terms of this waiver. By drawing my signature above and checking this box, I electronically sign this document."
          })]
        }), /* @__PURE__ */ jsx("button", {
          type: "submit",
          disabled: !signature || isSubmitting,
          className: "w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",
          children: isSubmitting ? "Signing..." : "Sign Waiver"
        })]
      })]
    })]
  });
});
const route64 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$7,
  default: studio_$slug_waivers__index,
  loader: loader$I
}, Symbol.toStringTag, { value: "Module" }));
const action$6 = async (args) => {
  const {
    request,
    params
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const title = formData.get("title");
  const content = formData.get("content");
  const pdfUrl = formData.get("pdfUrl");
  try {
    const res = await apiRequest("/waivers", token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": params.slug
      },
      body: JSON.stringify({
        title,
        content,
        pdfUrl
      })
    });
    if (res.error) return {
      error: res.error
    };
    return {
      success: true,
      id: res.id
    };
  } catch (e) {
    return {
      error: e.message
    };
  }
};
const studio_$slug_waivers_new = UNSAFE_withComponentProps(function NewWaiverTemplate() {
  const actionData = useActionData();
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";
  if (actionData?.success) {
    return /* @__PURE__ */ jsxs("div", {
      className: "max-w-2xl mx-auto py-12 text-center",
      children: [/* @__PURE__ */ jsx("div", {
        className: "w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4",
        children: /* @__PURE__ */ jsx(Save, {
          className: "w-8 h-8"
        })
      }), /* @__PURE__ */ jsx("h2", {
        className: "text-2xl font-bold mb-2",
        children: "Template Created!"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-600 mb-8",
        children: "Your waiver template has been successfully saved."
      }), /* @__PURE__ */ jsx("div", {
        className: "flex justify-center gap-4",
        children: /* @__PURE__ */ jsx(Link, {
          to: "../waivers",
          className: "px-4 py-2 bg-zinc-900 text-white rounded-md hover:bg-zinc-800 transition",
          children: "Back to Waivers"
        })
      })]
    });
  }
  const [uploading, setUploading] = useState(false);
  const {
    getToken
  } = useAuth();
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto py-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsxs(Link, {
        to: "../waivers",
        className: "flex items-center text-sm text-zinc-500 hover:text-zinc-900 mb-4 transition-colors",
        children: [/* @__PURE__ */ jsx(ArrowLeft, {
          className: "w-4 h-4 mr-1"
        }), "Back to Waivers"]
      }), /* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Create Waiver Template"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "Design a liability waiver for your members to sign."
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",
      children: /* @__PURE__ */ jsxs(Form, {
        method: "post",
        className: "space-y-6",
        children: [actionData && "error" in actionData && actionData.error && /* @__PURE__ */ jsxs("div", {
          className: "text-red-600 text-sm bg-red-50 p-2 rounded border border-red-200",
          children: ["Error saving: ", actionData.error]
        }), "                ", /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Document Title"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            name: "title",
            required: true,
            placeholder: "e.g. Activity Liability Waiver 2024",
            className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsxs("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: ["Legal Content", /* @__PURE__ */ jsx("span", {
              className: "ml-2 text-xs font-normal text-zinc-500",
              children: "(You can paste plain text or HTML here)"
            })]
          }), /* @__PURE__ */ jsx("textarea", {
            name: "content",
            required: true,
            rows: 15,
            placeholder: "I, the undersigned, agree to...",
            className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 font-mono text-sm"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Create from PDF (Optional)"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 mb-2",
            children: "Upload a PDF to link it or extract text (extraction not yet supported, just linking)."
          }), /* @__PURE__ */ jsx("input", {
            type: "file",
            accept: ".pdf",
            onChange: async (e) => {
              const file = e.target.files?.[0];
              if (file) {
                setUploading(true);
                try {
                  const token = await getToken();
                  const slug = window.location.pathname.split("/")[2];
                  const formData = new FormData();
                  formData.append("file", file);
                  const res = await fetch(`${"https://studio-platform-api.slichti.workers.dev"}/uploads/pdf`, {
                    method: "POST",
                    headers: {
                      "Authorization": `Bearer ${token}`,
                      "X-Tenant-Slug": slug
                    },
                    body: formData
                  });
                  if (!res.ok) throw new Error(await res.text());
                  const data = await res.json();
                  const input = document.getElementById("pdf-url-input");
                  if (input) input.value = data.url;
                  toast.success("PDF Uploaded successfully!");
                } catch (err) {
                  toast.error("Upload failed: " + err.message);
                } finally {
                  setUploading(false);
                }
              }
            },
            className: "block w-full text-sm text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          }), /* @__PURE__ */ jsx("input", {
            type: "hidden",
            name: "pdfUrl",
            id: "pdf-url-input"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-end pt-4 border-t border-zinc-100 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("button", {
            type: "submit",
            disabled: isSubmitting || uploading,
            className: "flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",
            children: [/* @__PURE__ */ jsx(Save, {
              className: "w-4 h-4"
            }), isSubmitting ? "Saving..." : "Save Template"]
          })
        })]
      })
    })]
  });
});
const route65 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$6,
  default: studio_$slug_waivers_new
}, Symbol.toStringTag, { value: "Module" }));
const loader$H = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const {
    slug
  } = args.params;
  try {
    const [stats, myProgress] = await Promise.all([apiRequest(`/tenant/stats`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).catch(() => ({
      activeStudents: 0
    })), apiRequest(`/challenges/my-progress`, token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }).catch(() => [])]);
    return {
      stats,
      myProgress
    };
  } catch (e) {
    console.error("Dashboard loader failed:", e);
    return {
      stats: {
        activeStudents: 0,
        upcomingBookings: 0,
        monthlyRevenueCents: 0
      },
      myProgress: []
    };
  }
};
const studio_$slug__index = UNSAFE_withComponentProps(function StudioDashboardIndex() {
  const {
    tenant,
    roles,
    me,
    isStudentView
  } = useOutletContext();
  const {
    stats
  } = useLoaderData();
  const {
    user: clerkUser
  } = useUser();
  const isOwner = roles.includes("owner");
  const displayName = clerkUser?.firstName || me?.firstName || "Studio Admin";
  const getRoleLabel = () => {
    const isPlatformAdmin = me?.user?.isPlatformAdmin;
    let baseRole = "";
    if (isPlatformAdmin) baseRole = "Admin";
    else if (me?.roles?.includes("owner")) baseRole = "Owner";
    else if (me?.roles?.includes("admin")) baseRole = "Manager";
    else if (me?.roles?.includes("instructor")) baseRole = "Instructor";
    if (isStudentView && baseRole) return ` (${baseRole})`;
    return "";
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-6xl pb-10 p-8 animate-in fade-in duration-500",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 tracking-tight",
          children: ["Welcome back, ", displayName, getRoleLabel(), "!"]
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: ["Here's what's happening at ", tenant.name, " today."]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2 text-sm font-medium text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1.5 rounded-full",
        children: [/* @__PURE__ */ jsx(Activity, {
          size: 16
        }), /* @__PURE__ */ jsx("span", {
          children: "System Online"
        })]
      })]
    }), isOwner && /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow group",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-xl group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(Users, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] font-bold uppercase tracking-wider text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-0.5 rounded",
            children: "Students"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: stats.activeStudents
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-xs text-zinc-500 mt-1 flex items-center gap-1",
          children: [/* @__PURE__ */ jsx(TrendingUp, {
            size: 12,
            className: "text-emerald-500"
          }), /* @__PURE__ */ jsx("span", {
            children: "Active this month"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow group",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-xl group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(Calendar, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] font-bold uppercase tracking-wider text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-0.5 rounded",
            children: "Bookings"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: stats.upcomingBookings
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mt-1",
          children: "Confirmed upcoming sessions"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow group border-b-4 border-b-emerald-500 relative overflow-hidden",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4 relative z-10",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-xl group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(DollarSign, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] font-bold uppercase tracking-wider text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-0.5 rounded",
            children: "Gross Sales"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100 relative z-10",
          children: ["$", (stats.monthlyRevenueCents / 100).toLocaleString(void 0, {
            minimumFractionDigits: 2
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mt-1 italic relative z-10",
          children: "Current billing period"
        }), /* @__PURE__ */ jsx("div", {
          className: "absolute top-4 right-4 text-emerald-100/20 z-0",
          children: /* @__PURE__ */ jsx(DollarSign, {
            size: 100
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow group",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 rounded-xl group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(FileSignature, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] font-bold uppercase tracking-wider text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-0.5 rounded",
            children: "Compliance"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: [stats.waiverCompliance ? Math.round(stats.waiverCompliance.signed / (stats.waiverCompliance.total || 1) * 100) : 0, "%"]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mt-1 flex items-center gap-1",
          children: stats.waiverCompliance?.activeWaiver ? /* @__PURE__ */ jsx("span", {
            className: "text-emerald-600",
            children: "Active Waiver Enforcement"
          }) : /* @__PURE__ */ jsx("span", {
            className: "text-amber-600",
            children: "No Active Waiver"
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow group",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-start mb-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-3 bg-pink-50 dark:bg-pink-900/20 text-pink-600 dark:text-pink-400 rounded-xl group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(Ticket, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "text-[10px] font-bold uppercase tracking-wider text-zinc-400 bg-zinc-50 dark:bg-zinc-800 px-2 py-0.5 rounded",
            children: "GC Liability"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: ["$", ((stats.giftCardLiability || 0) / 100).toLocaleString(void 0, {
            minimumFractionDigits: 2
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-500 mt-1",
          children: "Outstanding Store Credit"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "lg:col-span-2 bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8",
        children: !isStudentView ? /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsx("h3", {
            className: "text-lg font-bold mb-1 text-zinc-900 dark:text-zinc-100",
            children: "Getting Started"
          }), /* @__PURE__ */ jsx("p", {
            className: "mb-6 text-sm text-zinc-500 dark:text-zinc-400",
            children: "Your studio is live! Use these shortcuts to manage your operations."
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-1 sm:grid-cols-2 gap-4",
            children: [isOwner && /* @__PURE__ */ jsx(DashboardAction, {
              to: "branding",
              title: "Customize Branding",
              description: "Update your colors, logo and style."
            }), /* @__PURE__ */ jsx(DashboardAction, {
              to: "schedule",
              title: "Manage Schedule",
              description: "Add classes and view bookings."
            }), isOwner && /* @__PURE__ */ jsx(DashboardAction, {
              to: "memberships",
              title: "Setup Memberships",
              description: "Create recurring revenue plans."
            }), /* @__PURE__ */ jsx(DashboardAction, {
              to: "students",
              title: "Add Students",
              description: "Grow your community today."
            })]
          })]
        }) : /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "text-lg font-bold mb-4 text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Award, {
              className: "text-yellow-500"
            }), "Your Achievements"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-1 md:grid-cols-2 gap-4",
            children: [(useLoaderData().myProgress || []).map((challenge) => /* @__PURE__ */ jsxs("div", {
              className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-4 rounded-xl flex items-center gap-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400 shrink-0",
                children: challenge.userProgress.status === "completed" ? /* @__PURE__ */ jsx(Award, {
                  size: 24
                }) : /* @__PURE__ */ jsx(Target, {
                  size: 24
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-1 min-w-0",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex justify-between items-center mb-1",
                  children: [/* @__PURE__ */ jsx("h4", {
                    className: "font-bold text-sm text-zinc-900 dark:text-zinc-100 truncate",
                    children: challenge.title
                  }), challenge.userProgress.status === "completed" && /* @__PURE__ */ jsx("span", {
                    className: "text-[10px] font-bold bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full",
                    children: "EARNED"
                  })]
                }), /* @__PURE__ */ jsx("div", {
                  className: "w-full bg-zinc-100 dark:bg-zinc-800 rounded-full h-2 mb-1",
                  children: /* @__PURE__ */ jsx("div", {
                    className: "bg-yellow-500 h-2 rounded-full transition-all",
                    style: {
                      width: `${Math.min(100, challenge.userProgress.progress / challenge.targetValue * 100)}%`
                    }
                  })
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 flex justify-between",
                  children: [challenge.type === "streak" ? /* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1 font-medium text-amber-600",
                    children: [/* @__PURE__ */ jsx(Flame, {
                      size: 12,
                      className: challenge.userProgress.status === "completed" ? "" : "animate-pulse"
                    }), challenge.userProgress.progress, " / ", challenge.targetValue, " ", challenge.period || "streak", "s"]
                  }) : /* @__PURE__ */ jsxs("span", {
                    children: [challenge.userProgress.progress, " / ", challenge.targetValue, " ", challenge.type === "minutes" ? "mins" : "classes"]
                  }), /* @__PURE__ */ jsxs("span", {
                    children: [Math.round(challenge.userProgress.progress / challenge.targetValue * 100), "%"]
                  })]
                })]
              })]
            }, challenge.id)), (!useLoaderData().myProgress || useLoaderData().myProgress.length === 0) && /* @__PURE__ */ jsx("div", {
              className: "col-span-2 text-center py-4 text-zinc-500 dark:text-zinc-400 text-sm italic",
              children: "Join active challenges to earn rewards!"
            })]
          })]
        })
      }), /* @__PURE__ */ jsx("div", {
        className: "bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-6 shadow-sm",
        children: isStudentView ? /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Activity, {
              size: 18,
              className: "text-blue-500"
            }), "Announcements & Updates"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900 rounded-lg",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex justify-between items-start mb-1",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "text-[10px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider",
                  children: "New"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-[10px] text-zinc-400",
                  children: "Today"
                })]
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm text-zinc-700 dark:text-zinc-300 font-medium",
                children: "Summer schedule is live! Check out our new morning flow classes."
              })]
            }), /* @__PURE__ */ jsxs("h3", {
              className: "font-bold text-zinc-900 dark:text-zinc-100 mt-6 mb-2 flex items-center gap-2 text-sm",
              children: [/* @__PURE__ */ jsx(Flame, {
                size: 16,
                className: "text-orange-500"
              }), "Quick Discounts"]
            }), /* @__PURE__ */ jsxs("div", {
              className: "p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-900 rounded-lg",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex justify-between items-center mb-1",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "text-xs font-bold text-orange-700 dark:text-orange-400",
                  children: "3 Spots Left!"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-[10px] bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-1.5 py-0.5 rounded",
                  children: "20% OFF"
                })]
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm font-medium text-zinc-800 dark:text-zinc-200",
                children: "Power Yoga @ 6:00 PM"
              }), /* @__PURE__ */ jsx(Link, {
                to: "classes",
                className: "text-xs text-blue-600 hover:underline mt-1 block",
                children: "Book Now â†’"
              })]
            })]
          })]
        }) : /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Activity, {
              size: 18,
              className: "text-blue-500"
            }), "Quick Tips"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "p-3 bg-zinc-50 dark:bg-zinc-900 rounded-lg text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",
              children: [/* @__PURE__ */ jsx("strong", {
                children: "Did you know?"
              }), " You can now use the ", /* @__PURE__ */ jsx(Link, {
                to: "pos",
                className: "text-blue-600 font-bold hover:underline",
                children: "POS System"
              }), " to sell drinks and gear directly at your front desk."]
            }), /* @__PURE__ */ jsxs("div", {
              className: "p-3 bg-zinc-50 dark:bg-zinc-900 rounded-lg text-xs leading-relaxed text-zinc-600 dark:text-zinc-400",
              children: ["Enable ", /* @__PURE__ */ jsx(Link, {
                to: "settings",
                className: "text-blue-600 font-bold hover:underline",
                children: "SMS Notifications"
              }), " to reduce no-shows by up to 30%."]
            })]
          })]
        })
      })]
    })]
  });
});
function DashboardAction({
  to,
  title,
  description
}) {
  return /* @__PURE__ */ jsxs(Link, {
    to,
    className: "group flex items-center gap-4 p-4 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl hover:border-blue-500 dark:hover:border-blue-500 transition-all hover:translate-y-[-2px] shadow-sm",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex-1 min-w-0",
      children: [/* @__PURE__ */ jsx("div", {
        className: "font-bold text-zinc-900 dark:text-zinc-100 text-sm group-hover:text-blue-600 transition-colors",
        children: title
      }), /* @__PURE__ */ jsx("div", {
        className: "text-xs text-zinc-500 dark:text-zinc-400 truncate",
        children: description
      })]
    }), /* @__PURE__ */ jsx(ArrowRight, {
      size: 16,
      className: "text-zinc-300 group-hover:text-blue-500 transition-colors"
    })]
  });
}
const route66 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug__index,
  loader: loader$H
}, Symbol.toStringTag, { value: "Module" }));
const loader$G = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  const tenantSlug = slug || "";
  try {
    const productsData = await apiRequest("/products", token, {
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    });
    return {
      products: productsData || []
    };
  } catch (e) {
    console.error("Retail Loader Error", e);
    return {
      products: []
    };
  }
};
const action$5 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const {
    slug
  } = args.params;
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  const tenantSlug = slug || "";
  if (intent === "upload_image") {
    const file = formData.get("file");
    const uploadData = new FormData();
    if (file) uploadData.append("file", file);
    const data = await apiRequest("/products/images", token, {
      method: "POST",
      body: uploadData
    });
    return data;
  }
  if (intent === "import_products") {
    const jsonStr = formData.get("products");
    let products = [];
    try {
      products = JSON.parse(jsonStr);
    } catch (e) {
      return {
        error: "Invalid JSON"
      };
    }
    const res = await apiRequest("/products/import", token, {
      method: "POST",
      headers: {
        "X-Tenant-Slug": tenantSlug
      },
      body: JSON.stringify({
        products
      })
    });
    return res;
  }
  if (intent === "create" || intent === "update") {
    const id = formData.get("id");
    const payload = {
      name: formData.get("name"),
      description: formData.get("description"),
      category: formData.get("category"),
      sku: formData.get("sku"),
      price: parseInt(formData.get("price") || "0"),
      stockQuantity: parseInt(formData.get("stockQuantity") || "0"),
      imageUrl: formData.get("imageUrl"),
      isActive: formData.get("isActive") === "true"
    };
    await apiRequest(id ? `/products/${id}` : "/products", token, {
      method: id ? "PATCH" : "POST",
      headers: {
        "X-Tenant-Slug": tenantSlug
      },
      body: JSON.stringify(payload)
    });
  }
  if (intent === "delete") {
    const id = formData.get("id");
    await apiRequest(`/products/${id}`, token, {
      method: "DELETE",
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    });
  }
  return {
    success: true
  };
};
const studio_$slug_retail = UNSAFE_withComponentProps(function RetailManagement() {
  const {
    products
  } = useLoaderData();
  const submit = useSubmit();
  useRevalidator();
  const [searchQuery, setSearchQuery] = useState("");
  const [categoryFilter, setCategoryFilter] = useState("");
  const [isEditing, setIsEditing] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [isImporting, setIsImporting] = useState(false);
  const [confirmDeleteId, setConfirmDeleteId] = useState(null);
  const categories = [...new Set(products.map((p) => p.category).filter(Boolean))];
  const filteredProducts = products.filter((p) => {
    if (searchQuery && !p.name.toLowerCase().includes(searchQuery.toLowerCase())) return false;
    if (categoryFilter && p.category !== categoryFilter) return false;
    return true;
  });
  const handleDeleteClick = (id) => {
    setConfirmDeleteId(id);
  };
  const confirmDeleteAction = () => {
    if (confirmDeleteId) {
      submit({
        intent: "delete",
        id: confirmDeleteId
      }, {
        method: "post"
      });
      setConfirmDeleteId(null);
      toast.success("Product deleted");
    }
  };
  const formatPrice = (cents) => `$${(cents / 100).toFixed(2)}`;
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col h-full bg-zinc-50",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-zinc-900 rounded-lg text-white",
            children: /* @__PURE__ */ jsx(Package, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h1", {
              className: "text-xl font-bold text-zinc-900",
              children: "Retail"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-sm text-zinc-500",
              children: [products.length, " products"]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setIsImporting(true),
            className: "px-3 py-2 border border-zinc-200 rounded-lg text-sm font-medium hover:bg-zinc-50 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Upload, {
              size: 16
            }), " Import"]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: () => setIsCreating(true),
            className: "px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Plus, {
              size: 16
            }), " Add Product"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-4 mt-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "relative flex-1",
          children: [/* @__PURE__ */ jsx(Search, {
            className: "absolute left-3 top-2.5 h-4 w-4 text-zinc-400"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            placeholder: "Search products...",
            className: "w-full pl-9 pr-4 py-2 border border-zinc-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-black/5",
            value: searchQuery,
            onChange: (e) => setSearchQuery(e.target.value)
          })]
        }), /* @__PURE__ */ jsxs("select", {
          value: categoryFilter,
          onChange: (e) => setCategoryFilter(e.target.value),
          className: "px-4 py-2 border border-zinc-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-black/5",
          children: [/* @__PURE__ */ jsx("option", {
            value: "",
            children: "All Categories"
          }), categories.map((cat) => /* @__PURE__ */ jsx("option", {
            value: cat,
            children: cat
          }, cat))]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-y-auto p-6",
      children: filteredProducts.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "text-center py-20 text-zinc-500",
        children: [/* @__PURE__ */ jsx(Package, {
          size: 48,
          className: "mx-auto mb-4 opacity-50"
        }), /* @__PURE__ */ jsx("p", {
          children: "No products found"
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2 justify-center mt-4",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setIsCreating(true),
            className: "text-sm text-zinc-900 underline",
            children: "Add manually"
          }), /* @__PURE__ */ jsx("span", {
            className: "text-zinc-300",
            children: "|"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsImporting(true),
            className: "text-sm text-zinc-900 underline",
            children: "Import JSON"
          })]
        })]
      }) : /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",
        children: filteredProducts.map((product) => /* @__PURE__ */ jsxs("div", {
          className: "bg-white rounded-lg border border-zinc-200 overflow-hidden group hover:border-zinc-300 transition",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "aspect-square bg-zinc-100 relative",
            children: [product.imageUrl ? /* @__PURE__ */ jsx("img", {
              src: product.imageUrl,
              alt: product.name,
              className: "w-full h-full object-cover"
            }) : /* @__PURE__ */ jsx("div", {
              className: "w-full h-full flex items-center justify-center",
              children: /* @__PURE__ */ jsx(Package, {
                size: 48,
                className: "text-zinc-300"
              })
            }), !product.isActive && /* @__PURE__ */ jsx("div", {
              className: "absolute top-2 left-2 px-2 py-1 bg-red-100 text-red-600 text-xs font-medium rounded",
              children: "Inactive"
            }), /* @__PURE__ */ jsxs("div", {
              className: "absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition flex gap-1",
              children: [/* @__PURE__ */ jsx("button", {
                onClick: () => setIsEditing(product),
                className: "p-1.5 bg-white rounded shadow hover:bg-zinc-50",
                children: /* @__PURE__ */ jsx(Edit, {
                  size: 14
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleDeleteClick(product.id),
                className: "p-1.5 bg-white rounded shadow hover:bg-red-50 text-red-500",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 14
                })
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-start justify-between",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "font-medium text-zinc-900",
                  children: product.name
                }), /* @__PURE__ */ jsx("p", {
                  className: "text-sm text-zinc-500",
                  children: product.category || "Uncategorized"
                })]
              }), /* @__PURE__ */ jsx("span", {
                className: "text-lg font-bold text-zinc-900",
                children: formatPrice(product.price)
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "mt-3 flex items-center justify-between text-xs text-zinc-500",
              children: [/* @__PURE__ */ jsxs("span", {
                className: "flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(Box, {
                  size: 12
                }), " ", product.stockQuantity, " in stock"]
              }), product.sku && /* @__PURE__ */ jsx("span", {
                className: "font-mono",
                children: product.sku
              })]
            })]
          })]
        }, product.id))
      })
    }), (isEditing || isCreating) && /* @__PURE__ */ jsx(ProductModal, {
      product: isEditing,
      onClose: () => {
        setIsEditing(null);
        setIsCreating(false);
      },
      onSave: (data) => {
        const formData = new FormData();
        formData.append("intent", isEditing ? "update" : "create");
        if (isEditing) formData.append("id", isEditing.id);
        Object.entries(data).forEach(([key, value]) => {
          formData.append(key, String(value));
        });
        submit(formData, {
          method: "post"
        });
        setIsEditing(null);
        setIsCreating(false);
      }
    }), isImporting && /* @__PURE__ */ jsx(ImportModal, {
      onClose: () => setIsImporting(false),
      onImport: (json) => {
        const formData = new FormData();
        formData.append("intent", "import_products");
        formData.append("products", json);
        submit(formData, {
          method: "post"
        });
        setIsImporting(false);
      }
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmDeleteId,
      onClose: () => setConfirmDeleteId(null),
      onConfirm: confirmDeleteAction,
      title: "Delete Product",
      message: "Are you sure you want to delete this product? This action cannot be undone.",
      confirmText: "Delete Product",
      isDestructive: true
    })]
  });
});
function ProductModal({
  product,
  onClose,
  onSave
}) {
  const [name, setName] = useState(product?.name || "");
  const [description, setDescription] = useState(product?.description || "");
  const [category, setCategory] = useState(product?.category || "");
  const [sku, setSku] = useState(product?.sku || "");
  const [price, setPrice] = useState(product?.price ? (product.price / 100).toFixed(2) : "");
  const [stockQuantity, setStockQuantity] = useState(product?.stockQuantity?.toString() || "0");
  const [imageUrl, setImageUrl] = useState(product?.imageUrl || "");
  const [isActive, setIsActive] = useState(product?.isActive !== false);
  const fetcher = useFetcher();
  const isUploading = fetcher.state !== "idle";
  useEffect(() => {
    if (fetcher.data && fetcher.data.url && fetcher.data.url !== imageUrl) {
      setImageUrl(fetcher.data.url);
    }
  }, [fetcher.data]);
  const handleFileChange = (e) => {
    if (e.target.files && e.target.files[0]) {
      const formData = new FormData();
      formData.append("intent", "upload_image");
      formData.append("file", e.target.files[0]);
      fetcher.submit(formData, {
        method: "post",
        encType: "multipart/form-data"
      });
    }
  };
  const handleSubmit = (e) => {
    e.preventDefault();
    onSave({
      name,
      description,
      category,
      sku,
      price: Math.round(parseFloat(price || "0") * 100),
      stockQuantity: parseInt(stockQuantity || "0"),
      imageUrl,
      isActive
    });
  };
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: product ? "Edit Product" : "New Product"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSubmit,
        className: "p-6 space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "col-span-2",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Name *"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              required: true,
              value: name,
              onChange: (e) => setName(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Price ($)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              step: "0.01",
              value: price,
              onChange: (e) => setPrice(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Stock"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              value: stockQuantity,
              onChange: (e) => setStockQuantity(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Category"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: category,
              onChange: (e) => setCategory(e.target.value),
              placeholder: "e.g. Apparel",
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "SKU"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: sku,
              onChange: (e) => setSku(e.target.value),
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 font-mono"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "col-span-2",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Description"
            }), /* @__PURE__ */ jsx("textarea", {
              value: description,
              onChange: (e) => setDescription(e.target.value),
              rows: 3,
              className: "w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 resize-none"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "col-span-2",
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Image"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex gap-2",
              children: [/* @__PURE__ */ jsx("input", {
                type: "url",
                value: imageUrl,
                onChange: (e) => setImageUrl(e.target.value),
                placeholder: "https://...",
                className: "flex-1 px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"
              }), /* @__PURE__ */ jsxs("label", {
                className: `px-3 py-2 border border-zinc-200 rounded-lg bg-zinc-50 hover:bg-zinc-100 cursor-pointer flex items-center gap-2 ${isUploading ? "opacity-50 pointer-events-none" : ""}`,
                children: [/* @__PURE__ */ jsx("input", {
                  type: "file",
                  accept: "image/*",
                  className: "hidden",
                  onChange: handleFileChange,
                  disabled: isUploading
                }), /* @__PURE__ */ jsx(Upload, {
                  size: 16,
                  className: "text-zinc-500"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm font-medium text-zinc-600",
                  children: isUploading ? "..." : "Upload"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "col-span-2 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "checkbox",
              id: "isActive",
              checked: isActive,
              onChange: (e) => setIsActive(e.target.checked),
              className: "w-4 h-4"
            }), /* @__PURE__ */ jsx("label", {
              htmlFor: "isActive",
              className: "text-sm text-zinc-700",
              children: "Active (visible to customers)"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex justify-end gap-3 border-t border-zinc-100",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: onClose,
            className: "px-4 py-2 text-sm font-medium text-zinc-500 hover:text-zinc-700",
            children: "Cancel"
          }), /* @__PURE__ */ jsxs("button", {
            type: "submit",
            className: "px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Save, {
              size: 16
            }), " ", product ? "Save Changes" : "Create Product"]
          })]
        })]
      })]
    })
  });
}
function ImportModal({
  onClose,
  onImport
}) {
  const [json, setJson] = useState("");
  return /* @__PURE__ */ jsx("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
    children: /* @__PURE__ */ jsxs("div", {
      className: "bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold",
          children: "Import Products"
        }), /* @__PURE__ */ jsx("button", {
          onClick: onClose,
          children: /* @__PURE__ */ jsx(X, {
            size: 20,
            className: "text-zinc-400 hover:text-zinc-600"
          })
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-6",
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-sm font-medium text-zinc-700 mb-2",
          children: "Paste JSON Array"
        }), /* @__PURE__ */ jsx("textarea", {
          value: json,
          onChange: (e) => setJson(e.target.value),
          className: "w-full h-64 p-3 border border-zinc-200 rounded-lg font-mono text-xs",
          placeholder: '[{"name": "Product 1", "price": 1000}, ...]'
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500 mt-2",
          children: "Required: name, price (cents). Optional: description, sku, category."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-200 flex justify-end gap-2",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: onClose,
          className: "px-4 py-2 text-sm text-zinc-500",
          children: "Cancel"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => onImport(json),
          disabled: !json,
          className: "px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",
          children: "Import"
        })]
      })]
    })
  });
}
const route67 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$5,
  default: studio_$slug_retail,
  loader: loader$G
}, Symbol.toStringTag, { value: "Module" }));
const loader$F = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  try {
    const res = await apiRequest("/leads", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      leads: res.leads || [],
      token,
      slug
    };
  } catch (e) {
    return {
      leads: [],
      token,
      slug,
      error: e.message
    };
  }
};
const studio_$slug_leads = UNSAFE_withComponentProps(function LeadsPage() {
  const {
    leads: initialLeads,
    token,
    slug
  } = useLoaderData();
  const [leads, setLeads] = useState(initialLeads);
  const [isAddOpen, setIsAddOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedLead, setSelectedLead] = useState(null);
  const [leadTasks, setLeadTasks] = useState([]);
  const [isTaskLoading, setIsTaskLoading] = useState(false);
  const [newTaskTitle, setNewTaskTitle] = useState("");
  const [isEditingLead, setIsEditingLead] = useState(false);
  const [editFormData, setEditFormData] = useState({});
  const [formData, setFormData] = useState({
    firstName: "",
    lastName: "",
    email: "",
    phone: "",
    source: "",
    notes: ""
  });
  const openLeadDetail = async (lead) => {
    setSelectedLead(lead);
    setIsEditingLead(false);
    setEditFormData({
      ...lead
    });
    setIsTaskLoading(true);
    try {
      const tasks = await apiRequest(`/tasks?leadId=${lead.id}`, token, {
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setLeadTasks(Array.isArray(tasks) ? tasks : []);
    } catch (e) {
      console.error("Failed to load tasks", e);
    } finally {
      setIsTaskLoading(false);
    }
  };
  const handleUpdateLead = async (e) => {
    e.preventDefault();
    try {
      await apiRequest(`/leads/${selectedLead.id}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(editFormData)
      });
      setSelectedLead({
        ...selectedLead,
        ...editFormData
      });
      setLeads(leads.map((l) => l.id === selectedLead.id ? {
        ...l,
        ...editFormData
      } : l));
      setIsEditingLead(false);
      toast.success("Lead updated");
    } catch (e2) {
      toast.error("Failed to update lead: " + e2.message);
    }
  };
  const handleCreateTask = async (e) => {
    e.preventDefault();
    if (!newTaskTitle) return;
    try {
      const newTask = await apiRequest("/tasks", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          title: newTaskTitle,
          relatedLeadId: selectedLead.id,
          status: "todo",
          priority: "medium",
          dueDate: new Date(Date.now() + 24 * 60 * 60 * 1e3)
          // Tomorrow
        })
      });
      setLeadTasks([newTask, ...leadTasks]);
      setNewTaskTitle("");
      toast.success("Task created");
    } catch (e2) {
      toast.error("Failed to create task: " + e2.message);
    }
  };
  const toggleTaskStatus = async (taskId, currentStatus) => {
    const newStatus = currentStatus === "done" ? "todo" : "done";
    setLeadTasks(leadTasks.map((t) => t.id === taskId ? {
      ...t,
      status: newStatus
    } : t));
    await apiRequest(`/tasks/${taskId}`, token, {
      method: "PATCH",
      headers: {
        "X-Tenant-Slug": slug
      },
      body: JSON.stringify({
        status: newStatus
      })
    });
  };
  const handleCreate = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const res = await apiRequest("/leads", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(formData)
      });
      if (res.error) {
        toast.error(res.error);
      } else {
        const refreshed = await apiRequest("/leads", token, {
          headers: {
            "X-Tenant-Slug": slug
          }
        });
        setLeads(refreshed.leads || []);
        setIsAddOpen(false);
        setFormData({
          firstName: "",
          lastName: "",
          email: "",
          phone: "",
          source: "",
          notes: ""
        });
        toast.success("Lead created");
      }
    } catch (e2) {
      toast.error("Failed to create lead: " + e2.message);
    } finally {
      setLoading(false);
    }
  };
  const handleStatusChange = async (leadId, newStatus) => {
    setLeads(leads.map((l) => l.id === leadId ? {
      ...l,
      status: newStatus
    } : l));
    try {
      await apiRequest(`/leads/${leadId}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          status: newStatus
        })
      });
    } catch (e) {
      console.error(e);
    }
  };
  const filteredLeads = leads.filter((l) => l.email.toLowerCase().includes(searchTerm.toLowerCase()) || (l.firstName + " " + l.lastName).toLowerCase().includes(searchTerm.toLowerCase()));
  const getStatusColor = (status) => {
    switch (status) {
      case "new":
        return "bg-blue-100 text-blue-800";
      case "contacted":
        return "bg-yellow-100 text-yellow-800";
      case "trialing":
        return "bg-purple-100 text-purple-800";
      case "converted":
        return "bg-green-100 text-green-800";
      case "lost":
        return "bg-gray-100 text-gray-800";
      default:
        return "bg-gray-100 text-gray-800";
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-7xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Leads CRM"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Track and manage prospective students."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsAddOpen(true),
        className: "bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-all hover:translate-y-[-1px]",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 18
        }), "Add New Lead"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl shadow-sm overflow-hidden",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center gap-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "relative flex-1 max-w-md",
          children: [/* @__PURE__ */ jsx(Search, {
            className: "absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",
            size: 16
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            placeholder: "Search leads...",
            value: searchTerm,
            onChange: (e) => setSearchTerm(e.target.value),
            className: "w-full pl-10 pr-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg text-sm bg-zinc-50 dark:bg-zinc-800 focus:ring-2 focus:ring-blue-500 outline-none"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-sm text-zinc-500",
          children: [filteredLeads.length, " leads found"]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "overflow-x-auto",
        children: /* @__PURE__ */ jsxs("table", {
          className: "w-full text-left",
          children: [/* @__PURE__ */ jsx("thead", {
            className: "bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
                children: "Name"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
                children: "Contact"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
                children: "Status"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
                children: "Source"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
                children: "Added"
              })]
            })
          }), /* @__PURE__ */ jsxs("tbody", {
            className: "divide-y divide-zinc-100 dark:divide-zinc-800",
            children: [filteredLeads.map((lead) => /* @__PURE__ */ jsxs("tr", {
              onClick: () => openLeadDetail(lead),
              className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors cursor-pointer",
              children: [/* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-3",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs uppercase",
                    children: [lead.firstName?.[0], lead.lastName?.[0]]
                  }), /* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "font-medium text-zinc-900 dark:text-zinc-100",
                      children: [lead.firstName, " ", lead.lastName]
                    }), lead.notes && /* @__PURE__ */ jsx("div", {
                      className: "text-xs text-zinc-400 truncate max-w-[200px]",
                      title: lead.notes,
                      children: lead.notes
                    })]
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-col gap-1 text-sm text-zinc-600 dark:text-zinc-400",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex items-center gap-2",
                    children: [/* @__PURE__ */ jsx(Mail, {
                      size: 14,
                      className: "text-zinc-400"
                    }), /* @__PURE__ */ jsx("span", {
                      children: lead.email
                    })]
                  }), lead.phone && /* @__PURE__ */ jsxs("div", {
                    className: "flex items-center gap-2",
                    children: [/* @__PURE__ */ jsx(Phone, {
                      size: 14,
                      className: "text-zinc-400"
                    }), /* @__PURE__ */ jsx("span", {
                      children: lead.phone
                    })]
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("select", {
                  value: lead.status,
                  onChange: (e) => handleStatusChange(lead.id, e.target.value),
                  className: `text-xs font-bold uppercase px-2 py-1 rounded border-none outline-none cursor-pointer focus:ring-2 focus:ring-blue-500/50 ${getStatusColor(lead.status)}`,
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "new",
                    children: "New"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "contacted",
                    children: "Contacted"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "trialing",
                    children: "Trialing"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "converted",
                    children: "Converted"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "lost",
                    children: "Lost"
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 text-sm text-zinc-600 dark:text-zinc-400",
                children: lead.source ? /* @__PURE__ */ jsx("span", {
                  className: "bg-zinc-100 dark:bg-zinc-800 px-2 py-1 rounded text-xs border border-zinc-200 dark:border-zinc-700",
                  children: lead.source
                }) : /* @__PURE__ */ jsx("span", {
                  className: "text-zinc-400 text-xs italic",
                  children: "Unknown"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 text-sm text-zinc-500",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-1",
                  title: new Date(lead.createdAt).toLocaleString(),
                  children: [/* @__PURE__ */ jsx(Clock, {
                    size: 14,
                    className: "text-zinc-400"
                  }), format(new Date(lead.createdAt), "MMM d")]
                })
              })]
            }, lead.id)), filteredLeads.length === 0 && /* @__PURE__ */ jsx("tr", {
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 5,
                className: "px-6 py-12 text-center text-zinc-500",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-col items-center gap-2",
                  children: [/* @__PURE__ */ jsx(AlertCircle, {
                    size: 32,
                    className: "text-zinc-300"
                  }), /* @__PURE__ */ jsx("p", {
                    children: "No leads found matching your criteria."
                  })]
                })
              })
            })]
          })]
        })
      })]
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: isAddOpen,
      onClose: () => setIsAddOpen(false),
      title: "Add New Lead",
      children: /* @__PURE__ */ jsxs("form", {
        onSubmit: handleCreate,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "First Name"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              required: true,
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: formData.firstName,
              onChange: (e) => setFormData({
                ...formData,
                firstName: e.target.value
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Last Name"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: formData.lastName,
              onChange: (e) => setFormData({
                ...formData,
                lastName: e.target.value
              })
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Email Address"
          }), /* @__PURE__ */ jsx("input", {
            type: "email",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
            value: formData.email,
            onChange: (e) => setFormData({
              ...formData,
              email: e.target.value
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Phone (Optional)"
            }), /* @__PURE__ */ jsx("input", {
              type: "tel",
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: formData.phone,
              onChange: (e) => setFormData({
                ...formData,
                phone: e.target.value
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Source"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: formData.source,
              onChange: (e) => setFormData({
                ...formData,
                source: e.target.value
              }),
              children: [/* @__PURE__ */ jsx("option", {
                value: "",
                children: "Select source..."
              }), /* @__PURE__ */ jsx("option", {
                value: "Walk-in",
                children: "Walk-in"
              }), /* @__PURE__ */ jsx("option", {
                value: "Website",
                children: "Website"
              }), /* @__PURE__ */ jsx("option", {
                value: "Referral",
                children: "Referral"
              }), /* @__PURE__ */ jsx("option", {
                value: "Social Media",
                children: "Social Media"
              }), /* @__PURE__ */ jsx("option", {
                value: "Other",
                children: "Other"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
            children: "Notes"
          }), /* @__PURE__ */ jsx("textarea", {
            className: "w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none h-24 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
            value: formData.notes,
            onChange: (e) => setFormData({
              ...formData,
              notes: e.target.value
            }),
            placeholder: "Interests, goals, availability..."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setIsAddOpen(false),
            className: "flex-1 px-4 py-2 border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium transition-colors",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50",
            children: loading ? "Adding..." : "Add Lead"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: !!selectedLead,
      onClose: () => setSelectedLead(null),
      title: selectedLead ? `${selectedLead.firstName} ${selectedLead.lastName}` : "Lead Details",
      children: selectedLead && /* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-800 p-4 rounded-lg flex flex-col gap-3 relative group",
          children: [/* @__PURE__ */ jsx("div", {
            className: "flex justify-between items-start",
            children: isEditingLead ? /* @__PURE__ */ jsxs("form", {
              onSubmit: handleUpdateLead,
              className: "w-full space-y-3",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-2 gap-4",
                children: [/* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-500 uppercase",
                    children: "First Name"
                  }), /* @__PURE__ */ jsx("input", {
                    className: "w-full px-2 py-1 border rounded",
                    value: editFormData.firstName,
                    onChange: (e) => setEditFormData({
                      ...editFormData,
                      firstName: e.target.value
                    })
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-500 uppercase",
                    children: "Last Name"
                  }), /* @__PURE__ */ jsx("input", {
                    className: "w-full px-2 py-1 border rounded",
                    value: editFormData.lastName,
                    onChange: (e) => setEditFormData({
                      ...editFormData,
                      lastName: e.target.value
                    })
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "grid grid-cols-2 gap-4",
                children: [/* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-500 uppercase",
                    children: "Email"
                  }), /* @__PURE__ */ jsx("input", {
                    className: "w-full px-2 py-1 border rounded",
                    value: editFormData.email,
                    onChange: (e) => setEditFormData({
                      ...editFormData,
                      email: e.target.value
                    })
                  })]
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("label", {
                    className: "text-xs font-bold text-zinc-500 uppercase",
                    children: "Phone"
                  }), /* @__PURE__ */ jsx("input", {
                    className: "w-full px-2 py-1 border rounded",
                    value: editFormData.phone,
                    onChange: (e) => setEditFormData({
                      ...editFormData,
                      phone: e.target.value
                    })
                  })]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("label", {
                  className: "text-xs font-bold text-zinc-500 uppercase",
                  children: "Notes"
                }), /* @__PURE__ */ jsx("textarea", {
                  className: "w-full px-2 py-1 border rounded h-20",
                  value: editFormData.notes,
                  onChange: (e) => setEditFormData({
                    ...editFormData,
                    notes: e.target.value
                  })
                })]
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2 justify-end",
                children: [/* @__PURE__ */ jsx("button", {
                  type: "button",
                  onClick: () => setIsEditingLead(false),
                  className: "px-3 py-1 text-sm bg-zinc-200 rounded hover:bg-zinc-300",
                  children: "Cancel"
                }), /* @__PURE__ */ jsx("button", {
                  type: "submit",
                  className: "px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",
                  children: "Save"
                })]
              })]
            }) : /* @__PURE__ */ jsxs(Fragment, {
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsxs("h2", {
                  className: "text-xl font-bold",
                  children: [selectedLead.firstName, " ", selectedLead.lastName]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-sm text-zinc-500 flex gap-4 mt-1",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Mail, {
                      size: 14
                    }), " ", selectedLead.email]
                  }), selectedLead.phone && /* @__PURE__ */ jsxs("span", {
                    className: "flex items-center gap-1",
                    children: [/* @__PURE__ */ jsx(Phone, {
                      size: 14
                    }), " ", selectedLead.phone]
                  })]
                })]
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => setIsEditingLead(true),
                className: "p-2 text-zinc-400 hover:text-blue-600 rounded-full hover:bg-blue-50 transition-colors",
                children: /* @__PURE__ */ jsx(Pencil, {
                  size: 18
                })
              })]
            })
          }), !isEditingLead && /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx("span", {
                className: `px-2 py-0.5 rounded text-xs font-bold uppercase ${getStatusColor(selectedLead.status)}`,
                children: selectedLead.status
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-xs text-zinc-400",
                children: ["Added ", format(new Date(selectedLead.createdAt), "MMM d, yyyy")]
              })]
            }), selectedLead.notes && /* @__PURE__ */ jsxs("div", {
              className: "mt-2 text-sm text-zinc-600 italic border-t border-zinc-200 dark:border-zinc-700 pt-3 relative pl-3",
              children: [/* @__PURE__ */ jsx("span", {
                className: "absolute left-0 top-3 bottom-0 w-1 bg-zinc-300 rounded-full"
              }), '"', selectedLead.notes, '"']
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsxs("h3", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2 mb-4",
            children: [/* @__PURE__ */ jsx(Clock, {
              size: 18
            }), "Activity Timeline"]
          }), /* @__PURE__ */ jsxs("form", {
            onSubmit: handleCreateTask,
            className: "flex gap-2 mb-6",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "relative flex-1",
              children: [/* @__PURE__ */ jsx("input", {
                className: "w-full pl-9 pr-3 py-2 border rounded-lg bg-white dark:bg-zinc-800 dark:border-zinc-700 text-sm focus:ring-2 focus:ring-blue-500 outline-none",
                placeholder: "Add a new task or note...",
                value: newTaskTitle,
                onChange: (e) => setNewTaskTitle(e.target.value)
              }), /* @__PURE__ */ jsx(Plus, {
                className: "absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",
                size: 16
              })]
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-sm",
              children: "Add"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "relative pl-4 border-l-2 border-zinc-100 dark:border-zinc-800 space-y-6",
            children: [leadTasks.map((task) => /* @__PURE__ */ jsxs("div", {
              className: "relative",
              children: [/* @__PURE__ */ jsx("div", {
                className: `absolute -left-[21px] top-1 w-3 h-3 rounded-full border-2 border-white dark:border-zinc-900 ${task.status === "done" ? "bg-green-500" : "bg-blue-500"}`
              }), /* @__PURE__ */ jsx("div", {
                className: "bg-white dark:bg-zinc-800 p-3 rounded-lg border border-zinc-100 dark:border-zinc-800 shadow-sm hover:shadow-md transition-shadow group",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex items-start gap-3",
                  children: [/* @__PURE__ */ jsx("button", {
                    onClick: (e) => {
                      e.stopPropagation();
                      toggleTaskStatus(task.id, task.status);
                    },
                    className: `mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${task.status === "done" ? "bg-green-500 border-green-500 text-white" : "border-zinc-300 dark:border-zinc-600 hover:border-green-500"}`,
                    children: task.status === "done" && /* @__PURE__ */ jsx(CheckCircle, {
                      size: 12
                    })
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex-1",
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "flex justify-between items-start",
                      children: [/* @__PURE__ */ jsx("span", {
                        className: `font-medium ${task.status === "done" ? "line-through text-zinc-400" : "text-zinc-900 dark:text-zinc-100"}`,
                        children: task.title
                      }), /* @__PURE__ */ jsx("span", {
                        className: "text-[10px] text-zinc-400",
                        children: task.dueDate ? format(new Date(task.dueDate), "MMM d") : "No date"
                      })]
                    }), /* @__PURE__ */ jsx("div", {
                      className: "mt-1 flex gap-2",
                      children: /* @__PURE__ */ jsx("span", {
                        className: `text-[10px] px-1.5 py-0.5 rounded border uppercase ${task.priority === "high" ? "bg-red-50 text-red-600 border-red-100" : "bg-zinc-50 text-zinc-500 border-zinc-100"}`,
                        children: task.priority
                      })
                    })]
                  })]
                })
              })]
            }, task.id)), leadTasks.length === 0 && /* @__PURE__ */ jsx("div", {
              className: "text-zinc-400 text-xs italic pl-2",
              children: "No activity recorded yet."
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-end pt-2",
          children: /* @__PURE__ */ jsx("button", {
            onClick: () => setSelectedLead(null),
            className: "text-zinc-500 hover:text-zinc-700 text-sm",
            children: "Close"
          })
        })]
      })
    })]
  });
});
const route68 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_leads,
  loader: loader$F
}, Symbol.toStringTag, { value: "Module" }));
const loader$E = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const slug = args.params.slug;
  try {
    const tasks = await apiRequest("/tasks", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    const me = await apiRequest("/tenant/me", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    return {
      initialTasks: tasks || [],
      me,
      token,
      slug
    };
  } catch (e) {
    return {
      initialTasks: [],
      me: null,
      token,
      slug,
      error: e.message
    };
  }
};
const studio_$slug_tasks = UNSAFE_withComponentProps(function TasksPage() {
  const {
    initialTasks,
    me,
    token,
    slug
  } = useLoaderData();
  const [tasks, setTasks] = useState(initialTasks);
  const [isAddOpen, setIsAddOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [filterAssignee, setFilterAssignee] = useState("all");
  const [editingTask, setEditingTask] = useState(null);
  const [taskToDelete, setTaskToDelete] = useState(null);
  const [formData, setFormData] = useState({
    title: "",
    description: "",
    priority: "medium",
    status: "todo",
    dueDate: "",
    assignedToId: me?.id || ""
  });
  const refreshTasks = async () => {
    const res = await apiRequest("/tasks", token, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    setTasks(res || []);
  };
  const handleOpenAdd = () => {
    setEditingTask(null);
    setFormData({
      title: "",
      description: "",
      priority: "medium",
      status: "todo",
      dueDate: "",
      assignedToId: me?.id || ""
    });
    setIsAddOpen(true);
  };
  const handleOpenEdit = (task) => {
    setEditingTask(task);
    setFormData({
      title: task.title,
      description: task.description || "",
      priority: task.priority,
      status: task.status,
      dueDate: task.dueDate ? new Date(task.dueDate).toISOString().split("T")[0] : "",
      assignedToId: task.assignedToId || ""
    });
    setIsAddOpen(true);
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const endpoint = editingTask ? `/tasks/${editingTask.id}` : "/tasks";
      const method = editingTask ? "PATCH" : "POST";
      await apiRequest(endpoint, token, {
        method,
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify(formData)
      });
      await refreshTasks();
      setIsAddOpen(false);
    } catch (e2) {
      alert("Failed to save task: " + e2.message);
    } finally {
      setLoading(false);
    }
  };
  const handleDelete = (taskId) => {
    setTaskToDelete(taskId);
  };
  const handleConfirmDelete = async () => {
    if (!taskToDelete) return;
    try {
      await apiRequest(`/tasks/${taskToDelete}`, token, {
        method: "DELETE",
        headers: {
          "X-Tenant-Slug": slug
        }
      });
      setTasks(tasks.filter((t) => t.id !== taskToDelete));
      if (editingTask?.id === taskToDelete) setIsAddOpen(false);
      setTaskToDelete(null);
    } catch (e) {
      console.error(e);
    }
  };
  const handleQuickStatusChange = async (taskId, newStatus) => {
    setTasks(tasks.map((t) => t.id === taskId ? {
      ...t,
      status: newStatus
    } : t));
    try {
      await apiRequest(`/tasks/${taskId}`, token, {
        method: "PATCH",
        headers: {
          "X-Tenant-Slug": slug
        },
        body: JSON.stringify({
          status: newStatus
        })
      });
    } catch (e) {
      console.error(e);
    }
  };
  const filteredTasks = tasks.filter((t) => {
    if (filterAssignee === "mine") return t.assignedToId === me?.id;
    return true;
  });
  const getPriorityColor = (p) => {
    switch (p) {
      case "high":
        return "text-red-700 bg-red-50 border-red-200";
      case "medium":
        return "text-orange-700 bg-orange-50 border-orange-200";
      case "low":
        return "text-blue-700 bg-blue-50 border-blue-200";
      default:
        return "text-gray-700 bg-gray-50";
    }
  };
  const columns = [{
    id: "todo",
    title: "To Do",
    color: "bg-zinc-100 dark:bg-zinc-800/50",
    border: "border-zinc-200 dark:border-zinc-700"
  }, {
    id: "in_progress",
    title: "In Progress",
    color: "bg-blue-50/50 dark:bg-blue-900/10",
    border: "border-blue-200 dark:border-blue-800"
  }, {
    id: "done",
    title: "Done",
    color: "bg-green-50/50 dark:bg-green-900/10",
    border: "border-green-200 dark:border-green-800"
  }];
  return /* @__PURE__ */ jsxs("div", {
    className: "p-6 h-[calc(100vh-64px)] flex flex-col",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",
      children: [/* @__PURE__ */ jsx("div", {
        children: /* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx("div", {
            className: "p-2 bg-blue-100 text-blue-600 rounded-lg",
            children: /* @__PURE__ */ jsx(CheckCircle, {
              size: 24
            })
          }), "Tasks Board"]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2 items-center",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex bg-zinc-100 dark:bg-zinc-800 rounded-lg p-1",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setFilterAssignee("all"),
            className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${filterAssignee === "all" ? "bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100" : "text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-300"}`,
            children: "All Tasks"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setFilterAssignee("mine"),
            className: `px-3 py-1.5 text-sm font-medium rounded-md transition-all ${filterAssignee === "mine" ? "bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100" : "text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-300"}`,
            children: "My Tasks"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: handleOpenAdd,
          className: "bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-all hover:scale-105 active:scale-95",
          children: [/* @__PURE__ */ jsx(Plus, {
            size: 18
          }), "New Task"]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-x-auto overflow-y-hidden",
      children: /* @__PURE__ */ jsx("div", {
        className: "flex gap-6 h-full min-w-[1000px]",
        children: columns.map((col) => {
          const colTasks = filteredTasks.filter((t) => t.status === col.id);
          return /* @__PURE__ */ jsxs("div", {
            className: `flex-1 flex flex-col rounded-xl border ${col.border} ${col.color} backdrop-blur-sm min-w-[300px]`,
            children: [/* @__PURE__ */ jsxs("div", {
              className: "p-4 flex items-center justify-between border-b border-inherit",
              children: [/* @__PURE__ */ jsxs("h3", {
                className: "font-semibold text-zinc-700 dark:text-zinc-200 flex items-center gap-2",
                children: [col.title, /* @__PURE__ */ jsx("span", {
                  className: "bg-white/50 dark:bg-black/20 px-2 py-0.5 rounded-full text-xs",
                  children: colTasks.length
                })]
              }), col.id === "todo" && /* @__PURE__ */ jsx("button", {
                onClick: handleOpenAdd,
                className: "text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200",
                children: /* @__PURE__ */ jsx(Plus, {
                  size: 16
                })
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "p-3 flex-1 overflow-y-auto space-y-3",
              children: colTasks.map((task) => /* @__PURE__ */ jsxs("div", {
                onClick: () => handleOpenEdit(task),
                className: "bg-white dark:bg-zinc-800 p-4 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-700 hover:border-blue-400 dark:hover:border-blue-500 hover:shadow-md transition-all cursor-pointer group animate-in fade-in slide-in-from-bottom-2 duration-300",
                children: [/* @__PURE__ */ jsxs("div", {
                  className: "flex justify-between items-start mb-2",
                  children: [/* @__PURE__ */ jsx("span", {
                    className: `px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border ${getPriorityColor(task.priority)}`,
                    children: task.priority
                  }), col.id !== "done" && /* @__PURE__ */ jsx("button", {
                    onClick: (e) => {
                      e.stopPropagation();
                      handleQuickStatusChange(task.id, "done");
                    },
                    className: "text-zinc-300 hover:text-green-500 opacity-0 group-hover:opacity-100 transition-opacity",
                    title: "Mark as Done",
                    children: /* @__PURE__ */ jsx(CheckCircle, {
                      size: 16
                    })
                  })]
                }), /* @__PURE__ */ jsx("h4", {
                  className: "font-medium text-zinc-900 dark:text-zinc-100 mb-1 leading-snug",
                  children: task.title
                }), task.description && /* @__PURE__ */ jsx("p", {
                  className: "text-xs text-zinc-500 dark:text-zinc-400 line-clamp-2 mb-3",
                  children: task.description
                }), /* @__PURE__ */ jsx("div", {
                  className: "flex items-center justify-between mt-3 pt-3 border-t border-zinc-100 dark:border-zinc-700/50",
                  children: /* @__PURE__ */ jsxs("div", {
                    className: "flex items-center gap-2",
                    children: [task.assignee?.userProfile?.firstName && /* @__PURE__ */ jsx("div", {
                      className: "w-5 h-5 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center text-[10px] font-bold",
                      title: task.assignee.userProfile.firstName,
                      children: task.assignee.userProfile.firstName[0]
                    }), task.dueDate && /* @__PURE__ */ jsxs("div", {
                      className: `flex items-center gap-1 text-[10px] ${new Date(task.dueDate) < /* @__PURE__ */ new Date() && task.status !== "done" ? "text-red-500 font-bold" : "text-zinc-400"}`,
                      children: [/* @__PURE__ */ jsx(Calendar, {
                        size: 10
                      }), format(new Date(task.dueDate), "MMM d")]
                    })]
                  })
                })]
              }, task.id))
            })]
          }, col.id);
        })
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: isAddOpen,
      onClose: () => setIsAddOpen(false),
      title: editingTask ? "Edit Task" : "Create New Task",
      children: /* @__PURE__ */ jsxs("form", {
        onSubmit: handleSubmit,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium mb-1 dark:text-zinc-300",
            children: "Task Title"
          }), /* @__PURE__ */ jsx("input", {
            required: true,
            className: "w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none transition-all",
            value: formData.title,
            onChange: (e) => setFormData({
              ...formData,
              title: e.target.value
            }),
            placeholder: "e.g. Follow up with John"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium mb-1 dark:text-zinc-300",
            children: "Description"
          }), /* @__PURE__ */ jsx("textarea", {
            className: "w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none transition-all h-24 resize-none",
            value: formData.description,
            onChange: (e) => setFormData({
              ...formData,
              description: e.target.value
            }),
            placeholder: "Details about the task..."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1 dark:text-zinc-300",
              children: "Status"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              value: formData.status,
              onChange: (e) => setFormData({
                ...formData,
                status: e.target.value
              }),
              children: [/* @__PURE__ */ jsx("option", {
                value: "todo",
                children: "To Do"
              }), /* @__PURE__ */ jsx("option", {
                value: "in_progress",
                children: "In Progress"
              }), /* @__PURE__ */ jsx("option", {
                value: "done",
                children: "Done"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1 dark:text-zinc-300",
              children: "Priority"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              value: formData.priority,
              onChange: (e) => setFormData({
                ...formData,
                priority: e.target.value
              }),
              children: [/* @__PURE__ */ jsx("option", {
                value: "low",
                children: "Low"
              }), /* @__PURE__ */ jsx("option", {
                value: "medium",
                children: "Medium"
              }), /* @__PURE__ */ jsx("option", {
                value: "high",
                children: "High"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-2 gap-4",
          children: /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1 dark:text-zinc-300",
              children: "Due Date"
            }), /* @__PURE__ */ jsx("input", {
              type: "date",
              className: "w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              value: formData.dueDate,
              onChange: (e) => setFormData({
                ...formData,
                dueDate: e.target.value
              })
            })]
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-3 justify-end pt-6 border-t dark:border-zinc-700",
          children: [editingTask && /* @__PURE__ */ jsxs("button", {
            type: "button",
            onClick: () => handleDelete(editingTask.id),
            className: "px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg mr-auto flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Trash2, {
              size: 16
            }), "Delete"]
          }), /* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setIsAddOpen(false),
            className: "px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg font-medium",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50 shadow-sm hover:shadow active:scale-95 transition-all",
            children: loading ? "Saving..." : editingTask ? "Save Changes" : "Create Task"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!taskToDelete,
      onOpenChange: (open) => !open && setTaskToDelete(null),
      onConfirm: handleConfirmDelete,
      title: "Delete Task",
      description: "Are you sure you want to delete this task? This cannot be undone.",
      confirmText: "Delete",
      variant: "destructive"
    })]
  });
});
const route69 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_tasks,
  loader: loader$E
}, Symbol.toStringTag, { value: "Module" }));
const loader$D = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const [rooms, tenantInfo] = await Promise.all([apiRequest("/chat/rooms?type=support", token), apiRequest("/tenant/info", token)]);
    return {
      rooms,
      tenant: tenantInfo,
      token,
      error: null
    };
  } catch (e) {
    return {
      rooms: [],
      tenant: null,
      token: null,
      error: e.message
    };
  }
};
const studio_$slug_chat = UNSAFE_withComponentProps(function StudioChat() {
  const {
    rooms,
    tenant,
    token,
    error
  } = useLoaderData();
  const {
    slug
  } = useParams();
  const [isSettingsOpen, setIsSettingsOpen] = useState(false);
  const [chatConfig, setChatConfig] = useState(tenant?.settings?.chatConfig || {
    timezone: "UTC",
    offlineEmail: "",
    schedule: {
      Mon: ["09:00", "17:00"],
      Tue: ["09:00", "17:00"],
      Wed: ["09:00", "17:00"],
      Thu: ["09:00", "17:00"],
      Fri: ["09:00", "17:00"]
    }
  });
  const saveSettings = async () => {
    try {
      await apiRequest("/tenant/settings", token, {
        method: "PATCH",
        body: JSON.stringify({
          settings: {
            chatConfig
          }
        })
      });
      setIsSettingsOpen(false);
    } catch (e) {
      toast.error("Failed to save settings");
    }
  };
  const updateSchedule = (start, end) => {
    const days = ["Mon", "Tue", "Wed", "Thu", "Fri"];
    const newSchedule = {
      ...chatConfig.schedule
    };
    days.forEach((day) => {
      newSchedule[day] = [start, end];
    });
    setChatConfig({
      ...chatConfig,
      schedule: newSchedule
    });
  };
  const [roleFilter, setRoleFilter] = useState("all");
  if (error) {
    return /* @__PURE__ */ jsxs("div", {
      className: "p-8 text-red-600",
      children: ["Error: ", error]
    });
  }
  const customerChats = rooms.filter((r) => r.metadata?.source === "widget" || r.customerEmail);
  const platformTickets = rooms.filter((r) => !r.customerEmail && r.metadata?.source !== "widget");
  const filteredCustomerChats = roleFilter === "all" ? customerChats : customerChats.filter((r) => r.metadata?.routedRole === roleFilter);
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto h-full flex flex-col",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold text-zinc-900 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(MessageCircle, {
            className: "text-blue-600"
          }), "Messages"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 mt-1",
          children: "Manage customer support inquiries and platform tickets"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => setIsSettingsOpen(true),
          className: "flex items-center gap-2 text-sm text-zinc-600 hover:text-zinc-900 mr-4",
          children: [/* @__PURE__ */ jsx(Settings, {
            size: 14
          }), "Chat Settings"]
        }), /* @__PURE__ */ jsxs(Link, {
          to: `/embed/${slug}/chat`,
          target: "_blank",
          className: "flex items-center gap-2 text-sm text-blue-600 hover:underline",
          children: [/* @__PURE__ */ jsx(ExternalLink, {
            size: 14
          }), "Test Widget"]
        })]
      })]
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: isSettingsOpen,
      onClose: () => setIsSettingsOpen(false),
      title: "Chat Settings",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Offline Email"
          }), /* @__PURE__ */ jsx("input", {
            type: "email",
            className: "w-full border border-zinc-300 rounded-lg p-2 text-sm",
            placeholder: "support@example.com",
            value: chatConfig.offlineEmail,
            onChange: (e) => setChatConfig({
              ...chatConfig,
              offlineEmail: e.target.value
            })
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-zinc-500 mt-1",
            children: "Visitors will be asked to email this address when you are offline."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Timezone"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full border border-zinc-300 rounded-lg p-2 text-sm",
            value: chatConfig.timezone,
            onChange: (e) => setChatConfig({
              ...chatConfig,
              timezone: e.target.value
            }),
            children: [/* @__PURE__ */ jsx("option", {
              value: "UTC",
              children: "UTC"
            }), /* @__PURE__ */ jsx("option", {
              value: "America/New_York",
              children: "Eastern Time (US)"
            }), /* @__PURE__ */ jsx("option", {
              value: "America/Chicago",
              children: "Central Time (US)"
            }), /* @__PURE__ */ jsx("option", {
              value: "America/Denver",
              children: "Mountain Time (US)"
            }), /* @__PURE__ */ jsx("option", {
              value: "America/Los_Angeles",
              children: "Pacific Time (US)"
            }), /* @__PURE__ */ jsx("option", {
              value: "Europe/London",
              children: "London (UK)"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Weekday Hours (Mon-Fri)"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("input", {
              type: "time",
              className: "border border-zinc-300 rounded-lg p-2 text-sm",
              value: chatConfig.schedule?.Mon?.[0] || "09:00",
              onChange: (e) => updateSchedule(e.target.value, chatConfig.schedule?.Mon?.[1] || "17:00")
            }), /* @__PURE__ */ jsx("span", {
              className: "text-zinc-400",
              children: "to"
            }), /* @__PURE__ */ jsx("input", {
              type: "time",
              className: "border border-zinc-300 rounded-lg p-2 text-sm",
              value: chatConfig.schedule?.Mon?.[1] || "17:00",
              onChange: (e) => updateSchedule(chatConfig.schedule?.Mon?.[0] || "09:00", e.target.value)
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "pt-4 flex justify-end",
          children: /* @__PURE__ */ jsx("button", {
            onClick: saveSettings,
            className: "bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700",
            children: "Save Settings"
          })
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 overflow-hidden flex flex-col h-[600px]",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 border-b border-zinc-200 bg-zinc-50 flex justify-between items-center",
          children: [/* @__PURE__ */ jsxs("h2", {
            className: "font-semibold text-zinc-900 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(User, {
              size: 18,
              className: "text-blue-600"
            }), "Customer Inquiries"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsxs("select", {
              value: roleFilter,
              onChange: (e) => setRoleFilter(e.target.value),
              className: "text-xs border border-zinc-200 rounded px-2 py-1",
              children: [/* @__PURE__ */ jsx("option", {
                value: "all",
                children: "All"
              }), /* @__PURE__ */ jsx("option", {
                value: "owner",
                children: "Owner"
              }), /* @__PURE__ */ jsx("option", {
                value: "admin",
                children: "Admin"
              }), /* @__PURE__ */ jsx("option", {
                value: "instructor",
                children: "Instructor"
              }), /* @__PURE__ */ jsx("option", {
                value: "support",
                children: "Support"
              })]
            }), /* @__PURE__ */ jsx("span", {
              className: "text-xs bg-zinc-200 text-zinc-600 px-2 py-0.5 rounded-full",
              children: filteredCustomerChats.length
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex-1 overflow-y-auto divide-y divide-zinc-100",
          children: filteredCustomerChats.length === 0 ? /* @__PURE__ */ jsx("div", {
            className: "p-8 text-center text-zinc-500 text-sm",
            children: roleFilter === "all" ? "No customer messages yet." : `No messages routed to ${roleFilter}.`
          }) : filteredCustomerChats.map((room) => /* @__PURE__ */ jsxs(Link, {
            to: `/studio/${slug}/chat/${room.id}`,
            className: "block p-4 hover:bg-zinc-50 transition-colors",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-900",
                children: room.name
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-400",
                children: new Date(room.createdAt).toLocaleDateString()
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2 text-xs text-zinc-500",
              children: [room.customerEmail && /* @__PURE__ */ jsx("span", {
                children: room.customerEmail
              }), /* @__PURE__ */ jsx("span", {
                className: `px-1.5 py-0.5 rounded capitalize ${room.status === "open" ? "bg-green-100 text-green-700" : room.status === "closed" ? "bg-zinc-100 text-zinc-500" : "bg-blue-50 text-blue-700"}`,
                children: room.status || "open"
              }), room.metadata?.routedRole && /* @__PURE__ */ jsxs("span", {
                className: "px-1.5 py-0.5 rounded bg-purple-50 text-purple-700 capitalize",
                children: ["â†’ ", room.metadata.routedRole]
              })]
            })]
          }, room.id))
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-xl border border-zinc-200 overflow-hidden flex flex-col h-[600px]",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 border-b border-zinc-200 bg-zinc-50 flex justify-between items-center",
          children: [/* @__PURE__ */ jsxs("h2", {
            className: "font-semibold text-zinc-900 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Shield, {
              size: 18,
              className: "text-purple-600"
            }), "Platform Support Tickets"]
          }), /* @__PURE__ */ jsxs("button", {
            className: "text-xs flex items-center gap-1 bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors",
            children: [/* @__PURE__ */ jsx(Plus, {
              size: 12
            }), "New Ticket"]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex-1 overflow-y-auto divide-y divide-zinc-100",
          children: platformTickets.length === 0 ? /* @__PURE__ */ jsx("div", {
            className: "p-8 text-center text-zinc-500 text-sm",
            children: "No active support tickets with Platform Admin."
          }) : platformTickets.map((room) => /* @__PURE__ */ jsxs(Link, {
            to: `/studio/${slug}/chat/${room.id}`,
            className: "block p-4 hover:bg-zinc-50 transition-colors",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-900",
                children: room.name
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-400",
                children: new Date(room.createdAt).toLocaleDateString()
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2 text-xs text-zinc-500",
              children: [/* @__PURE__ */ jsx("span", {
                className: `px-1.5 py-0.5 rounded capitalize ${room.status === "open" ? "bg-green-100 text-green-700" : room.status === "closed" ? "bg-zinc-100 text-zinc-500" : "bg-blue-50 text-blue-700"}`,
                children: room.status || "open"
              }), room.assignedToId && /* @__PURE__ */ jsx("span", {
                className: "bg-purple-50 text-purple-700 px-1.5 py-0.5 rounded",
                children: "Assigned"
              })]
            })]
          }, room.id))
        })]
      })]
    })]
  });
});
const route70 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_chat,
  loader: loader$D
}, Symbol.toStringTag, { value: "Module" }));
const loader$C = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const token = await getToken();
  const roomId = args.params.roomId;
  if (!userId) throw new Response("Unauthorized", {
    status: 401
  });
  try {
    const room = await apiRequest(`/chat/rooms/${roomId}`, token);
    const me = await apiRequest("/tenant/me", token);
    return {
      room,
      token,
      user: {
        id: me.userId,
        name: me.firstName + " " + me.lastName
      },
      apiUrl: API_URL$1
    };
  } catch (e) {
    throw new Response("Room not found or access denied", {
      status: 404
    });
  }
};
const studio_$slug_chat_$roomId = UNSAFE_withComponentProps(function StudioChatRoom() {
  const {
    room,
    token,
    user,
    apiUrl
  } = useLoaderData();
  const {
    slug
  } = useParams();
  const [status, setStatus] = useState(room.status || "open");
  const isCustomerChat = room.metadata?.source === "widget" || room.customerEmail;
  const updateStatus = async (newStatus) => {
    try {
      await apiRequest(`/chat/rooms/${room.id}`, token, {
        method: "PATCH",
        body: JSON.stringify({
          status: newStatus
        })
      });
      setStatus(newStatus);
    } catch (e) {
      toast.error("Failed to update status");
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "h-[calc(100vh-64px)] bg-zinc-50 flex flex-col",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-3 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsx(Link, {
          to: `/studio/${slug}/chat`,
          className: "p-2 hover:bg-zinc-100 rounded-full text-zinc-500",
          children: /* @__PURE__ */ jsx(ArrowLeft, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "font-bold text-zinc-900 leading-tight",
            children: room.name
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs text-zinc-500 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("span", {
              className: "uppercase tracking-wider font-semibold",
              children: isCustomerChat ? "Customer Inquiry" : "Platform Ticket"
            }), /* @__PURE__ */ jsx("span", {
              children: "â€¢"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-mono text-zinc-400",
              children: room.id.slice(0, 8)
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("span", {
          className: `px-2 py-1 rounded text-xs font-medium capitalize ${status === "open" ? "bg-green-100 text-green-700" : status === "closed" ? "bg-zinc-100 text-zinc-600" : "bg-blue-50 text-blue-700"}`,
          children: status
        }), isCustomerChat && status !== "closed" && /* @__PURE__ */ jsxs("button", {
          onClick: () => updateStatus("closed"),
          className: "flex items-center gap-1 px-3 py-1.5 bg-green-600 text-white rounded-md text-sm hover:bg-green-700",
          children: [/* @__PURE__ */ jsx(CheckCircle, {
            size: 14
          }), "Resolve"]
        }), isCustomerChat && status === "closed" && /* @__PURE__ */ jsxs("button", {
          onClick: () => updateStatus("open"),
          className: "flex items-center gap-1 px-3 py-1.5 bg-zinc-100 text-zinc-700 rounded-md text-sm hover:bg-zinc-200",
          children: [/* @__PURE__ */ jsx(Clock, {
            size: 14
          }), "Reopen"]
        })]
      })]
    }), /* @__PURE__ */ jsx("main", {
      className: "flex-1 p-6 flex justify-center overflow-hidden",
      children: /* @__PURE__ */ jsx("div", {
        className: "w-full max-w-4xl h-full flex flex-col",
        children: /* @__PURE__ */ jsx(ChatWindow, {
          roomId: room.id,
          token,
          currentUser: user,
          wsUrl: apiUrl
        })
      })
    })]
  });
});
const route71 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_chat_$roomId,
  loader: loader$C
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_data = UNSAFE_withComponentProps(function StudioDataLayout() {
  const {
    tenant
  } = useOutletContext();
  const location = useLocation();
  const tabs = [{
    name: "Export Data",
    path: `/studio/${tenant.slug}/data/export`,
    icon: Download
  }, {
    name: "Import Data",
    path: `/studio/${tenant.slug}/data/import`,
    icon: Upload
  }];
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl p-8 animate-in fade-in duration-500",
    children: [/* @__PURE__ */ jsx("div", {
      className: "mb-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3 mb-2",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-lg",
          children: /* @__PURE__ */ jsx(Database, {
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "Data Management"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-500 dark:text-zinc-400",
            children: "Manage your studio's data, exports, and migrations."
          })]
        })]
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "border-b border-zinc-200 dark:border-zinc-800 mb-8",
      children: /* @__PURE__ */ jsx("nav", {
        className: "-mb-px flex space-x-8",
        children: tabs.map((tab) => {
          const Icon = tab.icon;
          const isActive = location.pathname === tab.path || tab.path.endsWith("/export") && location.pathname.endsWith("/data");
          return /* @__PURE__ */ jsxs(Link, {
            to: tab.path,
            className: `
                                    flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
                                    ${isActive ? "border-blue-500 text-blue-600 dark:text-blue-400" : "border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300 dark:text-zinc-400 dark:hover:text-zinc-300"}
                                `,
            children: [/* @__PURE__ */ jsx(Icon, {
              size: 16
            }), tab.name]
          }, tab.name);
        })
      })
    }), /* @__PURE__ */ jsx(Outlet, {
      context: useOutletContext()
    })]
  });
});
const route72 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_data
}, Symbol.toStringTag, { value: "Module" }));
const loader$B = async ({
  request
}) => {
  const url = new URL(request.url);
  if (!url.pathname.endsWith("/export")) {
    return redirect(`${url.pathname}/export`);
  }
  return null;
};
const studio_$slug_data__index = UNSAFE_withComponentProps(function DataIndex() {
  return null;
});
const route73 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_data__index,
  loader: loader$B
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_data_export = UNSAFE_withComponentProps(function DataExport() {
  const {
    tenant
  } = useOutletContext();
  const [exportLoading, setExportLoading] = useState(null);
  const [errorDialog, setErrorDialog] = useState({
    isOpen: false,
    message: ""
  });
  const handleExport = async (type) => {
    setExportLoading(type);
    try {
      const token = await window.Clerk?.session?.getToken();
      const response = await fetch(`${API_URL$1}/tenant/settings/export?type=${type}`, {
        headers: {
          "Authorization": `Bearer ${token}`,
          "X-Tenant-Slug": tenant.slug
        }
      });
      if (!response.ok) throw new Error("Export failed");
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `export_${type}_${tenant.slug}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: "Export failed. Please try again."
      });
    } finally {
      setExportLoading(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      message: errorDialog.message
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "mb-6",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Download, {
            size: 20,
            className: "text-blue-500"
          }), "Export Data"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Download your studio data in CSV format for analysis or backup."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-1 md:grid-cols-3 gap-4",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => handleExport("subscribers"),
          disabled: !!exportLoading,
          className: "group flex flex-col items-center justify-center p-6 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:border-blue-200 dark:hover:border-blue-800 transition-all text-center",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-12 h-12 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(BarChart3, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "font-semibold text-zinc-900 dark:text-zinc-100",
            children: "Subscribers"
          }), /* @__PURE__ */ jsx("span", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-2",
            children: exportLoading === "subscribers" ? "Generating CSV..." : "Active members & history"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => handleExport("financials"),
          disabled: !!exportLoading,
          className: "group flex flex-col items-center justify-center p-6 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:border-emerald-200 dark:hover:border-emerald-800 transition-all text-center",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-12 h-12 rounded-full bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(CreditCard, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "font-semibold text-zinc-900 dark:text-zinc-100",
            children: "Financials"
          }), /* @__PURE__ */ jsx("span", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-2",
            children: exportLoading === "financials" ? "Generating CSV..." : "Invoices & Transactions"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => handleExport("products"),
          disabled: !!exportLoading,
          className: "group flex flex-col items-center justify-center p-6 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:border-purple-200 dark:hover:border-purple-800 transition-all text-center",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-12 h-12 rounded-full bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",
            children: /* @__PURE__ */ jsx(ShoppingBag, {
              size: 24
            })
          }), /* @__PURE__ */ jsx("span", {
            className: "font-semibold text-zinc-900 dark:text-zinc-100",
            children: "Products"
          }), /* @__PURE__ */ jsx("span", {
            className: "text-xs text-zinc-500 dark:text-zinc-400 mt-2",
            children: exportLoading === "products" ? "Generating CSV..." : "Memberships & Items"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 dark:bg-zinc-900/50 rounded-lg p-4 text-xs text-zinc-500 dark:text-zinc-400",
      children: [/* @__PURE__ */ jsx("strong", {
        children: "Note:"
      }), " Exports include sensitive data. Please handle these files securely."]
    })]
  });
});
const route74 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_data_export
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_data_import = UNSAFE_withComponentProps(function DataImport() {
  const {
    tenant
  } = useOutletContext();
  const [file, setFile] = useState(null);
  const [uploading, setUploading] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState(null);
  const handleFileChange = (e) => {
    if (e.target.files && e.target.files[0]) {
      setFile(e.target.files[0]);
      setError(null);
      setResult(null);
    }
  };
  const handleUpload = async (e) => {
    e.preventDefault();
    if (!file) {
      setError("Please select a file.");
      return;
    }
    setUploading(true);
    setError(null);
    setResult(null);
    try {
      const token = await window.Clerk?.session?.getToken();
      const formData = new FormData();
      formData.append("file", file);
      const res = await apiRequest(`/import/csv`, token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenant.slug
        },
        body: formData
      });
      if (res.error) {
        setError(res.error);
        if (res.details) {
          console.error(res.details);
        }
      } else {
        setResult(res);
      }
    } catch (err) {
      setError(err.message || "Upload failed.");
    } finally {
      setUploading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl pb-10",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900",
        children: "Data Import"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 mt-2",
        children: "Migrate your data from another system using CSV files."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm mb-8",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-lg font-semibold mb-4",
        children: "Import Users & Memberships"
      }), /* @__PURE__ */ jsxs("div", {
        className: "mb-6 p-4 bg-blue-50 text-blue-800 rounded text-sm",
        children: [/* @__PURE__ */ jsx("p", {
          className: "font-semibold mb-1",
          children: "CSV Format Requirements:"
        }), /* @__PURE__ */ jsxs("ul", {
          className: "list-disc pl-5 space-y-1",
          children: [/* @__PURE__ */ jsxs("li", {
            children: ["Headers required: ", /* @__PURE__ */ jsx("code", {
              children: "email"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "firstname"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "lastname"
            })]
          }), /* @__PURE__ */ jsxs("li", {
            children: ["Optional: ", /* @__PURE__ */ jsx("code", {
              children: "phone"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "address"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "dob"
            }), " (YYYY-MM-DD), ", /* @__PURE__ */ jsx("code", {
              children: "minor"
            }), " (yes/no)"]
          }), /* @__PURE__ */ jsxs("li", {
            children: ["Membership: ", /* @__PURE__ */ jsx("code", {
              children: "membership"
            }), " (Plan Name - must match exactly)"]
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "font-semibold mt-3 mb-1",
          children: "OR Import Classes:"
        }), /* @__PURE__ */ jsxs("ul", {
          className: "list-disc pl-5 space-y-1",
          children: [/* @__PURE__ */ jsxs("li", {
            children: ["Headers required: ", /* @__PURE__ */ jsx("code", {
              children: "title"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "start_time"
            }), " (ISO 8601), ", /* @__PURE__ */ jsx("code", {
              children: "duration"
            }), " (minutes), ", /* @__PURE__ */ jsx("code", {
              children: "instructor_email"
            })]
          }), /* @__PURE__ */ jsxs("li", {
            children: ["Optional: ", /* @__PURE__ */ jsx("code", {
              children: "description"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "capacity"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "price"
            }), ", ", /* @__PURE__ */ jsx("code", {
              children: "location"
            }), " (Name)"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleUpload,
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "border-2 border-dashed border-zinc-300 rounded-lg p-8 flex flex-col items-center justify-center text-center hover:bg-zinc-50 transition-colors",
          children: [/* @__PURE__ */ jsx(Upload, {
            className: "h-10 w-10 text-zinc-400 mb-3"
          }), file ? /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2 text-zinc-900 font-medium",
            children: [/* @__PURE__ */ jsx(FileText, {
              className: "h-5 w-5 text-blue-500"
            }), file.name]
          }) : /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("label", {
              htmlFor: "file-upload",
              className: "cursor-pointer",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-blue-600 font-medium hover:text-blue-500",
                children: "Upload a file"
              }), /* @__PURE__ */ jsx("span", {
                className: "text-zinc-500",
                children: " or drag and drop"
              }), /* @__PURE__ */ jsx("input", {
                id: "file-upload",
                name: "file-upload",
                type: "file",
                className: "sr-only",
                accept: ".csv",
                onChange: handleFileChange
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 mt-1",
              children: "CSV up to 10MB"
            })]
          })]
        }), error && /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-2 bg-red-50 text-red-600 p-3 rounded",
          children: [/* @__PURE__ */ jsx(AlertCircle, {
            className: "h-5 w-5 shrink-0"
          }), /* @__PURE__ */ jsx("span", {
            className: "text-sm",
            children: error
          })]
        }), result && /* @__PURE__ */ jsxs("div", {
          className: "bg-green-50 text-green-800 p-4 rounded border border-green-200",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2 mb-2 font-semibold",
            children: [/* @__PURE__ */ jsx(CheckCircle, {
              className: "h-5 w-5"
            }), "Import Complete"]
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-sm space-y-1",
            children: [/* @__PURE__ */ jsxs("p", {
              children: ["Total Rows: ", result.total]
            }), /* @__PURE__ */ jsxs("p", {
              children: ["Created: ", result.created]
            }), /* @__PURE__ */ jsxs("p", {
              children: ["Skipped: ", result.skipped]
            }), result.errors && result.errors.length > 0 && /* @__PURE__ */ jsxs("div", {
              className: "mt-2",
              children: [/* @__PURE__ */ jsx("p", {
                className: "font-medium text-red-600",
                children: "Errors:"
              }), /* @__PURE__ */ jsx("ul", {
                className: "list-disc pl-5 text-red-600 max-h-32 overflow-y-auto",
                children: result.errors.map((e, i) => /* @__PURE__ */ jsx("li", {
                  children: e
                }, i))
              })]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-end",
          children: /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: !file || uploading,
            className: "bg-zinc-900 text-white px-4 py-2 rounded-md font-medium text-sm hover:bg-zinc-800 disabled:opacity-50 flex items-center gap-2",
            children: uploading ? "Importing..." : "Start Import"
          })
        })]
      })]
    })]
  });
});
const route75 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_data_import
}, Symbol.toStringTag, { value: "Module" }));
const studio_$slug_pos = UNSAFE_withComponentProps(function POSTerminal() {
  const {
    tenant,
    token,
    features
  } = useOutletContext() || {};
  const [products, setProducts] = useState([]);
  const [cart, setCart] = useState([]);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);
  const [terminal, setTerminal] = useState(null);
  const [terminalStatus, setTerminalStatus] = useState("disconnected");
  const [readers, setReaders] = useState([]);
  const [activeReader, setActiveReader] = useState(null);
  const [showReaderModal, setShowReaderModal] = useState(false);
  const [showProductModal, setShowProductModal] = useState(false);
  const [editingProduct, setEditingProduct] = useState(null);
  const [refreshTrigger, setRefreshTrigger] = useState(0);
  const [selectedCustomer, setSelectedCustomer] = useState(null);
  const [showCustomerSearch, setShowCustomerSearch] = useState(false);
  const [customerQuery, setCustomerQuery] = useState("");
  const [customerResults, setCustomerResults] = useState([]);
  const [searchingCustomer, setSearchingCustomer] = useState(false);
  const [showNewCustomerModal, setShowNewCustomerModal] = useState(false);
  const [couponCode, setCouponCode] = useState("");
  const [discountAmount, setDiscountAmount] = useState(0);
  const [couponError, setCouponError] = useState("");
  const [activeCoupon, setActiveCoupon] = useState(null);
  useEffect(() => {
    loadProducts();
  }, [refreshTrigger, tenant]);
  const loadProducts = async () => {
    try {
      const res = await apiRequest("/pos/products", token);
      if (res.products) {
        setProducts(res.products.filter((p) => p.isActive));
      }
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };
  useEffect(() => {
    if (!tenant) return;
    const initTerminal = async () => {
      const StripeTerminal = await loadStripeTerminal();
      if (!StripeTerminal) return;
      const t = StripeTerminal.create({
        onFetchConnectionToken: async () => {
          const res = await apiRequest("/pos/connection-token", token, {
            method: "POST"
          });
          if (res.error) throw new Error(res.error);
          return res.secret;
        },
        onUnexpectedReaderDisconnect: () => {
          setTerminalStatus("disconnected");
          setActiveReader(null);
        }
      });
      setTerminal(t);
    };
    initTerminal();
  }, [tenant]);
  const handleConnectReader = async (reader) => {
    setTerminalStatus("connecting");
    try {
      const result = await terminal.connectReader(reader);
      if (result.reader) {
        setActiveReader(result.reader);
        setTerminalStatus("connected");
        setShowReaderModal(false);
      } else {
        console.error("Connect failed", result.error);
        setTerminalStatus("disconnected");
      }
    } catch (e) {
      console.error("Connect error", e);
      setTerminalStatus("disconnected");
    }
  };
  const addToCart = (product) => {
    setCart((prev) => {
      const existing = prev.find((p) => p.productId === product.id);
      if (existing) {
        return prev.map((p) => p.productId === product.id ? {
          ...p,
          quantity: p.quantity + 1
        } : p);
      }
      return [...prev, {
        productId: product.id,
        name: product.name,
        price: product.price,
        quantity: 1
      }];
    });
  };
  const removeFromCart = (productId) => {
    setCart((prev) => prev.filter((p) => p.productId !== productId));
  };
  const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const total = Math.max(0, subtotal - discountAmount);
  const handleApplyCoupon = async () => {
    if (!couponCode) return;
    setProcessing(true);
    setCouponError("");
    try {
      const res = await apiRequest("/pos/validate-coupon", token, {
        method: "POST",
        body: JSON.stringify({
          code: couponCode,
          cartTotal: subtotal
        })
      });
      if (res.valid) {
        setDiscountAmount(res.discountAmount);
        setActiveCoupon({
          code: couponCode,
          id: res.couponId
        });
        setCouponError("");
      } else {
        setCouponError(res.error || "Invalid coupon");
        setDiscountAmount(0);
        setActiveCoupon(null);
      }
    } catch (e) {
      setCouponError(e.message);
    } finally {
      setProcessing(false);
    }
  };
  useEffect(() => {
    if (cart.length === 0) {
      setDiscountAmount(0);
      setActiveCoupon(null);
      setCouponCode("");
    } else if (activeCoupon) {
      handleApplyCoupon();
    }
  }, [cart.length]);
  const handleCheckout = async (paymentMethod) => {
    if (cart.length === 0) return;
    setProcessing(true);
    try {
      if (paymentMethod === "terminal") {
        if (terminalStatus !== "connected" || !activeReader) {
          alert("Please connect a reader first.");
          setProcessing(false);
          setShowReaderModal(true);
          return;
        }
        const piRes = await apiRequest("/pos/process-payment", token, {
          method: "POST",
          body: JSON.stringify({
            items: cart,
            customerId: selectedCustomer?.stripeCustomerId
          })
        });
        if (piRes.error) throw new Error(piRes.error);
        const clientSecret = piRes.clientSecret;
        const result = await terminal.collectPaymentMethod(clientSecret);
        if (result.error) throw new Error(result.error.message);
        const processResult = await terminal.processPayment(result.paymentIntent);
        if (processResult.error) throw new Error(processResult.error.message);
        await createOrder("card", processResult.paymentIntent.id, selectedCustomer?.id);
      } else if (paymentMethod === "card") {
        await createOrder("card", "manual_entry", selectedCustomer?.id);
      } else {
        await createOrder("cash", null, selectedCustomer?.id);
      }
      setCart([]);
      setSelectedCustomer(null);
      alert("Order Completed!");
      setRefreshTrigger((p) => p + 1);
    } catch (err) {
      console.error(err);
      alert(`Checkout Failed: ${err.message}`);
    } finally {
      setProcessing(false);
    }
  };
  const createOrder = async (method, paymentRef, memberId) => {
    await apiRequest("/pos/orders", token, {
      method: "POST",
      body: JSON.stringify({
        items: cart,
        memberId: memberId || null,
        paymentMethod: method,
        totalAmount: total,
        // uses discounted total
        couponCode: activeCoupon?.code
        // stripePaymentIntentId: paymentRef 
      })
    });
  };
  useEffect(() => {
    if (!customerQuery || customerQuery.length < 2) {
      setCustomerResults([]);
      return;
    }
    const timer = setTimeout(async () => {
      setSearchingCustomer(true);
      try {
        const res = await apiRequest(`/pos/customers?query=${customerQuery}`, token);
        setCustomerResults(res.customers || []);
      } catch (e) {
        console.error(e);
      } finally {
        setSearchingCustomer(false);
      }
    }, 500);
    return () => clearTimeout(timer);
  }, [customerQuery]);
  return /* @__PURE__ */ jsxs("div", {
    className: "flex h-full",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex-1 p-6 overflow-y-auto bg-zinc-50 dark:bg-zinc-950",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center mb-6",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
            children: "POS & Retail"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500",
            children: "Manage inventory and process sales."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setShowReaderModal(true),
            className: `flex items-center gap-2 px-3 py-2 rounded-lg border text-sm transition-colors ${terminalStatus === "connected" ? "bg-green-50 text-green-700 border-green-200" : "bg-white text-zinc-700 border-zinc-200"}`,
            children: [/* @__PURE__ */ jsx(Wifi, {
              size: 16
            }), terminalStatus === "connected" ? activeReader?.label || "Reader Connected" : "Connect Reader"]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: () => {
              setEditingProduct(null);
              setShowProductModal(true);
            },
            className: "flex items-center gap-2 px-3 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg text-sm hover:opacity-90",
            children: [/* @__PURE__ */ jsx(Plus, {
              size: 16
            }), " Add Product"]
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",
        children: products.map((product) => /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 flex flex-col gap-3 shadow-sm hover:shadow-md transition-shadow group relative",
          children: [/* @__PURE__ */ jsx("div", {
            className: "absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",
            children: /* @__PURE__ */ jsx("button", {
              onClick: () => {
                setEditingProduct(product);
                setShowProductModal(true);
              },
              className: "p-1.5 bg-zinc-100 rounded text-zinc-600 hover:text-blue-600",
              children: /* @__PURE__ */ jsx(Edit, {
                size: 14
              })
            })
          }), /* @__PURE__ */ jsx("div", {
            className: "aspect-square bg-zinc-100 dark:bg-zinc-800 rounded-lg flex items-center justify-center text-zinc-300",
            children: product.imageUrl ? /* @__PURE__ */ jsx("img", {
              src: product.imageUrl,
              className: "w-full h-full object-cover rounded-lg"
            }) : /* @__PURE__ */ jsx(Archive, {
              size: 32
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start",
              children: [/* @__PURE__ */ jsx("h3", {
                className: "font-medium text-zinc-900 dark:text-zinc-100 truncate",
                children: product.name
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-xs font-bold bg-zinc-100 dark:bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-600",
                children: ["$", (product.price / 100).toFixed(2)]
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 truncate",
              children: product.category || "General"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "mt-auto pt-2 flex items-center justify-between",
            children: [/* @__PURE__ */ jsxs("span", {
              className: `text-xs ${product.stockQuantity > 0 ? "text-green-600" : "text-red-500"} font-medium`,
              children: [product.stockQuantity, " in stock"]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => addToCart(product),
              disabled: product.stockQuantity <= 0,
              className: "p-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed",
              children: /* @__PURE__ */ jsx(Plus, {
                size: 16
              })
            })]
          })]
        }, product.id))
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "w-96 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 flex flex-col z-10 shadow-xl",
      children: [/* @__PURE__ */ jsx("div", {
        className: "p-4 border-b border-zinc-100 dark:border-zinc-800",
        children: selectedCustomer ? /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-100 dark:border-blue-800",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsx("div", {
              className: "w-8 h-8 rounded-full bg-blue-200 text-blue-700 flex items-center justify-center text-xs font-bold",
              children: selectedCustomer.profile?.firstName?.[0] || selectedCustomer.name?.[0] || "C"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("div", {
                className: "text-sm font-medium text-blue-900 dark:text-blue-100",
                children: selectedCustomer.profile ? `${selectedCustomer.profile.firstName} ${selectedCustomer.profile.lastName}` : selectedCustomer.name
              }), /* @__PURE__ */ jsx("div", {
                className: "text-[10px] text-blue-600 dark:text-blue-300 truncate w-32",
                children: selectedCustomer.email
              })]
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setSelectedCustomer(null),
            className: "text-blue-400 hover:text-blue-600",
            children: /* @__PURE__ */ jsx(X, {
              size: 14
            })
          })]
        }) : /* @__PURE__ */ jsxs("div", {
          className: "relative",
          children: [/* @__PURE__ */ jsxs("button", {
            onClick: () => setShowCustomerSearch(!showCustomerSearch),
            className: "w-full flex items-center justify-between px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm text-zinc-500 hover:border-blue-400 transition-colors",
            children: [/* @__PURE__ */ jsxs("span", {
              className: "flex items-center gap-2",
              children: [/* @__PURE__ */ jsx(User, {
                size: 14
              }), " Add Customer to Sale"]
            }), /* @__PURE__ */ jsx(Plus, {
              size: 14
            })]
          }), showCustomerSearch && /* @__PURE__ */ jsxs("div", {
            className: "absolute top-12 left-0 right-0 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg shadow-lg p-2 z-20",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2 px-2 py-1 bg-zinc-50 rounded border border-zinc-100 mb-2",
              children: [/* @__PURE__ */ jsx(Search, {
                size: 14,
                className: "text-zinc-400"
              }), /* @__PURE__ */ jsx("input", {
                autoFocus: true,
                className: "bg-transparent text-sm w-full outline-none",
                placeholder: "Search name or email...",
                value: customerQuery,
                onChange: (e) => setCustomerQuery(e.target.value)
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "max-h-48 overflow-y-auto space-y-1",
              children: [searchingCustomer && /* @__PURE__ */ jsx("div", {
                className: "text-xs text-center p-2 text-zinc-400",
                children: "Searching..."
              }), customerResults.map((c) => /* @__PURE__ */ jsxs("button", {
                onClick: () => {
                  setSelectedCustomer(c);
                  setShowCustomerSearch(false);
                  setCustomerQuery("");
                },
                className: "w-full text-left p-2 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded text-sm group",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium",
                  children: c.profile ? `${c.profile.firstName} ${c.profile.lastName}` : c.name
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500",
                  children: c.email
                }), c.isStripeGuest && /* @__PURE__ */ jsx("span", {
                  className: "text-[10px] bg-indigo-50 text-indigo-600 px-1 rounded ml-auto",
                  children: "Stripe"
                })]
              }, c.id || c.stripeCustomerId)), /* @__PURE__ */ jsx("button", {
                onClick: () => {
                  setShowNewCustomerModal(true);
                  setShowCustomerSearch(false);
                },
                className: "w-full text-left p-2 border-t border-zinc-100 text-blue-600 text-xs font-medium hover:bg-blue-50 rounded mt-1",
                children: "+ Create New Customer"
              })]
            })]
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex-1 overflow-y-auto p-4 space-y-3",
        children: [cart.map((item, idx) => /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center group",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
              children: item.name
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-xs text-zinc-500",
              children: ["$", (item.price / 100).toFixed(2), " x ", item.quantity]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "font-medium text-sm",
              children: ["$", (item.price * item.quantity / 100).toFixed(2)]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => removeFromCart(item.productId),
              className: "text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",
              children: /* @__PURE__ */ jsx(Trash2, {
                size: 14
              })
            })]
          })]
        }, idx)), cart.length === 0 && /* @__PURE__ */ jsxs("div", {
          className: "h-full flex flex-col items-center justify-center text-zinc-400 space-y-2 opacity-50",
          children: [/* @__PURE__ */ jsx(ShoppingCart, {
            size: 32
          }), /* @__PURE__ */ jsx("span", {
            className: "text-sm",
            children: "Cart is empty"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 space-y-3",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsx("input", {
            className: "flex-1 px-3 py-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm uppercase font-mono",
            placeholder: "PROMO CODE",
            value: couponCode,
            onChange: (e) => setCouponCode(e.target.value.toUpperCase()),
            disabled: !!activeCoupon
          }), activeCoupon ? /* @__PURE__ */ jsx("button", {
            onClick: () => {
              setActiveCoupon(null);
              setDiscountAmount(0);
              setCouponCode("");
            },
            className: "px-3 py-2 bg-red-100 text-red-600 rounded-lg text-sm font-medium hover:bg-red-200",
            children: "Remove"
          }) : /* @__PURE__ */ jsx("button", {
            onClick: handleApplyCoupon,
            disabled: !couponCode || cart.length === 0,
            className: "px-3 py-2 bg-zinc-900 dark:bg-zinc-700 text-white rounded-lg text-sm font-medium hover:opacity-90 disabled:opacity-50",
            children: "Apply"
          })]
        }), couponError && /* @__PURE__ */ jsx("div", {
          className: "text-xs text-red-500 font-medium",
          children: couponError
        }), activeCoupon && /* @__PURE__ */ jsxs("div", {
          className: "text-xs text-green-600 font-medium flex justify-between",
          children: [/* @__PURE__ */ jsxs("span", {
            children: ["Coupon applied: ", activeCoupon.code]
          }), " ", /* @__PURE__ */ jsxs("span", {
            children: ["-$", (discountAmount / 100).toFixed(2)]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center text-sm text-zinc-500",
          children: [/* @__PURE__ */ jsx("span", {
            children: "Subtotal"
          }), /* @__PURE__ */ jsxs("span", {
            children: ["$", (subtotal / 100).toFixed(2)]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center text-lg font-bold text-zinc-900 dark:text-zinc-100",
          children: [/* @__PURE__ */ jsx("span", {
            children: "Total"
          }), /* @__PURE__ */ jsxs("span", {
            children: ["$", (total / 100).toFixed(2)]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-2",
          children: [/* @__PURE__ */ jsxs("button", {
            disabled: processing || cart.length === 0,
            onClick: () => handleCheckout("card"),
            className: "bg-white border border-zinc-200 text-zinc-700 py-3 rounded-lg font-medium hover:bg-zinc-50 flex items-center justify-center gap-2 disabled:opacity-50",
            children: [/* @__PURE__ */ jsx(CreditCard, {
              size: 16
            }), " Manual Card"]
          }), /* @__PURE__ */ jsx("button", {
            disabled: processing || cart.length === 0,
            onClick: () => handleCheckout("cash"),
            className: "bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50",
            children: "Cash"
          })]
        }), /* @__PURE__ */ jsxs("button", {
          disabled: processing || cart.length === 0,
          onClick: () => handleCheckout("terminal"),
          className: `w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-all ${terminalStatus === "connected" ? "bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-blue-900/20" : "bg-zinc-200 text-zinc-500 cursor-not-allowed"}`,
          children: [processing ? /* @__PURE__ */ jsx(Loader2, {
            className: "animate-spin"
          }) : /* @__PURE__ */ jsx(Wifi, {
            size: 20
          }), terminalStatus === "connected" ? "Charge Application" : "Connect Reader to Charge"]
        })]
      })]
    }), showProductModal && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden p-6 space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-bold",
            children: editingProduct ? "Edit Product" : "New Product"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setShowProductModal(false),
            children: /* @__PURE__ */ jsx(X, {
              size: 20
            })
          })]
        }), /* @__PURE__ */ jsx(ProductForm, {
          token,
          product: editingProduct,
          onSuccess: () => {
            setShowProductModal(false);
            setRefreshTrigger((p) => p + 1);
          }
        })]
      })
    }), showReaderModal && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 w-full max-w-lg rounded-2xl shadow-2xl p-6 space-y-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center",
          children: [/* @__PURE__ */ jsxs("h2", {
            className: "text-xl font-bold flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Wifi, {}), " Connect Reader"]
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setShowReaderModal(false),
            children: /* @__PURE__ */ jsx(X, {
              size: 20
            })
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex flex-col gap-4 min-h-[200px]",
          children: readers.length === 0 ? /* @__PURE__ */ jsxs("div", {
            className: "flex-1 flex flex-col items-center justify-center space-y-4 text-center",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-4 bg-zinc-100 rounded-full",
              children: /* @__PURE__ */ jsx(Search, {
                size: 24,
                className: "text-zinc-400"
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("p", {
                className: "font-medium",
                children: "No Readers Found"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm text-zinc-500 max-w-xs mx-auto mt-1",
                children: "Make sure your WisePOS E or Verifone P630 is on, connected to WiFi, and registered in your Stripe Dashboard > Terminal."
              })]
            }), /* @__PURE__ */ jsx("button", {
              onClick: async () => {
                setProcessing(true);
                if (terminal) {
                  const res = await terminal.discoverReaders({
                    discoveryMethod: "internet",
                    simulated: false
                  }).catch((e) => ({
                    error: e
                  }));
                  if (res && res.discoveredReaders) {
                    setReaders(res.discoveredReaders);
                  } else if (res && res.error) {
                    console.error(res.error);
                  }
                  if (!res || !res.discoveredReaders) ;
                }
                setProcessing(false);
              },
              disabled: processing,
              className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium disabled:opacity-50",
              children: processing ? "Scanning..." : "Scan for Readers"
            })]
          }) : /* @__PURE__ */ jsx("div", {
            className: "space-y-2",
            children: readers.map((r, i) => /* @__PURE__ */ jsxs("div", {
              className: "flex items-center justify-between p-3 border rounded-lg hover:bg-zinc-50",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium",
                  children: r.label || r.serialNumber
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500",
                  children: [r.deviceType, " â€¢ ", r.status]
                })]
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleConnectReader(r),
                className: "px-3 py-1.5 bg-zinc-900 text-white rounded text-sm font-medium",
                children: "Connect"
              })]
            }, i))
          })
        })]
      })
    }), showNewCustomerModal && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 w-full max-w-md rounded-2xl shadow-2xl p-6",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold mb-4",
          children: "Create New Customer"
        }), /* @__PURE__ */ jsx(CustomerForm, {
          token,
          onSuccess: (c) => {
            setSelectedCustomer(c);
            setShowNewCustomerModal(false);
          },
          onCancel: () => setShowNewCustomerModal(false)
        })]
      })
    })]
  });
});
function ProductForm({
  token,
  product,
  onSuccess
}) {
  const [submitting, setSubmitting] = useState(false);
  return /* @__PURE__ */ jsxs("form", {
    className: "space-y-4",
    onSubmit: async (e) => {
      e.preventDefault();
      setSubmitting(true);
      const fd = new FormData(e.currentTarget);
      const data = Object.fromEntries(fd);
      data.price = (parseFloat(data.price) * 100).toString();
      const payload = {
        ...data,
        price: Math.round(parseFloat(data.price) * 100),
        stockQuantity: parseInt(data.stockQuantity),
        isActive: true
      };
      const url = product ? `/pos/products/${product.id}` : "/pos/products";
      const method = product ? "PUT" : "POST";
      await apiRequest(url, token, {
        method,
        body: JSON.stringify(payload)
      });
      setSubmitting(false);
      onSuccess();
    },
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("label", {
        className: "block text-xs font-medium mb-1",
        children: "Product Name"
      }), /* @__PURE__ */ jsx("input", {
        name: "name",
        defaultValue: product?.name,
        required: true,
        className: "w-full input-field border border-zinc-200 rounded p-2"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-2 gap-4",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-xs font-medium mb-1",
          children: "Price ($)"
        }), /* @__PURE__ */ jsx("input", {
          name: "price",
          type: "number",
          step: "0.01",
          defaultValue: product ? product.price / 100 : "",
          required: true,
          className: "w-full input-field border border-zinc-200 rounded p-2"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("label", {
          className: "block text-xs font-medium mb-1",
          children: "Stock"
        }), /* @__PURE__ */ jsx("input", {
          name: "stockQuantity",
          type: "number",
          defaultValue: product?.stockQuantity,
          required: true,
          className: "w-full input-field border border-zinc-200 rounded p-2"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("label", {
        className: "block text-xs font-medium mb-1",
        children: "Description"
      }), /* @__PURE__ */ jsx("textarea", {
        name: "description",
        defaultValue: product?.description,
        className: "w-full input-field h-20 border border-zinc-200 rounded p-2"
      })]
    }), product && /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center text-xs text-zinc-500",
      children: [/* @__PURE__ */ jsx("span", {
        children: "Active product"
      }), /* @__PURE__ */ jsx("button", {
        type: "button",
        onClick: async () => {
          if (!confirm("Archive this product?")) return;
          await apiRequest(`/pos/products/${product.id}/archive`, token, {
            method: "POST"
          });
          onSuccess();
        },
        className: "text-red-500 hover:underline",
        children: "Archive Product"
      })]
    }), /* @__PURE__ */ jsx("button", {
      disabled: submitting,
      type: "submit",
      className: "w-full bg-zinc-900 text-white rounded p-2 hover:bg-zinc-800",
      children: submitting ? "Saving..." : "Save Product"
    })]
  });
}
function CustomerForm({
  token,
  onSuccess,
  onCancel
}) {
  const [submitting, setSubmitting] = useState(false);
  return /* @__PURE__ */ jsxs("form", {
    className: "space-y-4",
    onSubmit: async (e) => {
      e.preventDefault();
      setSubmitting(true);
      const fd = new FormData(e.currentTarget);
      const data = Object.fromEntries(fd);
      const res = await apiRequest("/pos/customers", token, {
        method: "POST",
        body: JSON.stringify(data)
      });
      setSubmitting(false);
      if (res.customer) onSuccess(res.customer);
    },
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("label", {
        className: "block text-xs font-medium mb-1",
        children: "Customer Name"
      }), /* @__PURE__ */ jsx("input", {
        name: "name",
        required: true,
        className: "w-full input-field border border-zinc-200 rounded p-2",
        placeholder: "Jane Doe"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("label", {
        className: "block text-xs font-medium mb-1",
        children: "Email"
      }), /* @__PURE__ */ jsx("input", {
        name: "email",
        type: "email",
        required: true,
        className: "w-full input-field border border-zinc-200 rounded p-2",
        placeholder: "jane@example.com"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex gap-2 justify-end pt-2",
      children: [/* @__PURE__ */ jsx("button", {
        type: "button",
        onClick: onCancel,
        className: "px-4 py-2 border rounded-lg text-sm",
        children: "Cancel"
      }), /* @__PURE__ */ jsx("button", {
        type: "submit",
        disabled: submitting,
        className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm",
        children: submitting ? "Creating..." : "Create Customer"
      })]
    })]
  });
}
const route76 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: studio_$slug_pos
}, Symbol.toStringTag, { value: "Module" }));
const loader$A = async ({
  params
}) => {
  const {
    slug
  } = params;
  const API_URL2 = "https://studio-platform-api.slichti.workers.dev";
  const res = await fetch(`${API_URL2}/public/tenant/${slug}`);
  if (!res.ok) {
    throw new Response("Studio not found", {
      status: 404
    });
  }
  const tenant = await res.json();
  return {
    tenant
  };
};
const embed_$slug = UNSAFE_withComponentProps(function EmbedLayout() {
  const {
    tenant
  } = useLoaderData();
  const style = tenant.branding ? {
    "--primary": tenant.branding.primaryColor || "#3b82f6",
    "--font-sans": tenant.branding.font || "Inter"
  } : {};
  return /* @__PURE__ */ jsx(ThemeProvider, {
    defaultTheme: "light",
    storageKey: "vite-ui-theme",
    children: /* @__PURE__ */ jsxs("div", {
      style,
      className: "font-sans antialiased bg-transparent min-h-screen",
      children: [/* @__PURE__ */ jsx("style", {
        children: `
                    :root {
                        --radius: 0.5rem;
                    }
                `
      }), /* @__PURE__ */ jsx(Outlet, {
        context: {
          tenant
        }
      })]
    })
  });
});
const route77 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug,
  loader: loader$A
}, Symbol.toStringTag, { value: "Module" }));
const loader$z = async ({
  params,
  request
}) => {
  const {
    slug
  } = params;
  const API_URL2 = "https://studio-platform-api.slichti.workers.dev";
  try {
    const res = await fetch(`${API_URL2}/classes`, {
      headers: {
        "X-Tenant-Slug": slug
      }
    });
    if (!res.ok) throw new Error("Failed to load classes");
    const classes = await res.json();
    return {
      classes: Array.isArray(classes) ? classes : []
    };
  } catch (e) {
    return {
      classes: [],
      error: "Could not load schedule."
    };
  }
};
const embed_$slug_calendar = UNSAFE_withComponentProps(function EmbedCalendar() {
  const {
    classes,
    error
  } = useLoaderData();
  const {
    tenant
  } = useOutletContext();
  const grouped = (classes || []).reduce((acc, cls) => {
    const date = new Date(cls.startTime);
    const key = format(date, "EEEE, MMMM d");
    if (!acc[key]) acc[key] = [];
    acc[key].push(cls);
    return acc;
  }, {});
  const handleBook = () => {
    const url = `${window.location.origin}/studio/${tenant.slug}/classes`;
    window.open(url, "_blank");
  };
  if (error) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-4 text-red-500 text-sm text-center",
      children: error
    });
  }
  if (classes.length === 0) {
    return /* @__PURE__ */ jsxs("div", {
      className: "flex flex-col items-center justify-center p-8 text-zinc-500 bg-white border rounded",
      children: [/* @__PURE__ */ jsx(Calendar, {
        className: "mb-2 opacity-50"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-sm",
        children: "No classes scheduled."
      })]
    });
  }
  return /* @__PURE__ */ jsx("div", {
    className: "bg-white min-h-[400px]",
    children: Object.entries(grouped).map(([date, events]) => /* @__PURE__ */ jsxs("div", {
      className: "mb-6 last:mb-0",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "sticky top-0 z-10 bg-white/95 backdrop-blur py-2 px-4 border-b border-zinc-100 font-bold text-zinc-900 text-lg shadow-sm",
        children: date
      }), /* @__PURE__ */ jsx("div", {
        className: "divide-y divide-zinc-100",
        children: events.map((cls) => /* @__PURE__ */ jsxs("div", {
          className: "p-4 flex items-center justify-between hover:bg-zinc-50 transition-colors group",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex-1 min-w-0 pr-4",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex items-center gap-2 mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-bold text-zinc-900 truncate",
                children: cls.title
              }), cls.zoomEnabled && /* @__PURE__ */ jsx(Video, {
                size: 14,
                className: "text-blue-500"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-sm text-zinc-500 flex flex-wrap gap-x-3 items-center",
              children: [/* @__PURE__ */ jsx("span", {
                className: "font-medium text-zinc-700",
                children: format(new Date(cls.startTime), "h:mm a")
              }), /* @__PURE__ */ jsx("span", {
                className: "text-zinc-300",
                children: "â€¢"
              }), /* @__PURE__ */ jsxs("span", {
                children: [cls.durationMinutes, " min"]
              }), cls.instructor?.user?.profile?.firstName && /* @__PURE__ */ jsxs(Fragment, {
                children: [/* @__PURE__ */ jsx("span", {
                  className: "text-zinc-300",
                  children: "â€¢"
                }), /* @__PURE__ */ jsx("span", {
                  children: cls.instructor.user.profile.firstName
                })]
              })]
            })]
          }), /* @__PURE__ */ jsxs("button", {
            onClick: handleBook,
            className: "shrink-0 px-4 py-2 bg-zinc-900 text-white text-sm font-medium rounded-lg hover:bg-zinc-800 transition-colors flex items-center gap-2",
            children: ["Book", /* @__PURE__ */ jsx(ExternalLink, {
              size: 14,
              className: "opacity-70"
            })]
          })]
        }, cls.id))
      })]
    }, date))
  });
});
const route78 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug_calendar,
  loader: loader$z
}, Symbol.toStringTag, { value: "Module" }));
const loader$y = async ({
  params,
  request
}) => {
  const {
    slug
  } = params;
  const API_URL2 = "https://studio-platform-api.slichti.workers.dev";
  try {
    const [packsRes, membershipsRes] = await Promise.all([fetch(`${API_URL2}/commerce/packs`, {
      headers: {
        "X-Tenant-Slug": slug
      }
    }), fetch(`${API_URL2}/contracts/definitions`, {
      headers: {
        "X-Tenant-Slug": slug
      }
    })]);
    const packsData = packsRes.ok ? await packsRes.json() : {
      packs: []
    };
    const membershipsData = membershipsRes.ok ? await membershipsRes.json() : {
      definitions: []
    };
    return {
      packs: packsData.packs || [],
      memberships: membershipsData.definitions || [],
      error: null
    };
  } catch (e) {
    console.error("Failed to load pricing", e);
    return {
      packs: [],
      memberships: [],
      error: "Could not load pricing."
    };
  }
};
const embed_$slug_pricing = UNSAFE_withComponentProps(function EmbedPricing() {
  const {
    packs,
    memberships,
    error
  } = useLoaderData();
  const {
    tenant
  } = useOutletContext();
  const hasData = packs.length > 0 || memberships.length > 0;
  const displayPacks = hasData ? packs : [{
    id: "demo-1",
    name: "Drop-in Class",
    credits: 1,
    price: 2200,
    expirationDays: 30
  }, {
    id: "demo-2",
    name: "5-Class Pack",
    credits: 5,
    price: 9500,
    expirationDays: 90
  }, {
    id: "demo-3",
    name: "10-Class Pack",
    credits: 10,
    price: 18e3,
    expirationDays: 180
  }];
  const displayMemberships = hasData ? memberships : [{
    id: "demo-m1",
    name: "Monthly Unlimited",
    price: 13500,
    interval: "month",
    description: "Unlimited access to all classes. Auto-renews monthly.",
    billingCycles: null
  }];
  const handleBuy = (itemId, type) => {
    if (!hasData) {
      alert("This is a demo preview. Please configure pricing in your Studio Dashboard.");
      return;
    }
    const url = `${window.location.origin}/studio/${tenant.slug}/checkout?${type === "pack" ? "packId" : "membershipId"}=${itemId}`;
    window.open(url, "_blank");
  };
  if (error) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-4 text-red-500 text-sm text-center",
      children: error
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white min-h-[400px] p-4 font-sans text-zinc-900",
    children: [!hasData && /* @__PURE__ */ jsxs("div", {
      className: "mb-6 bg-blue-50 text-blue-800 p-3 rounded-lg text-sm flex items-center gap-2 border border-blue-100",
      children: [/* @__PURE__ */ jsx(AlertCircle, {
        className: "w-4 h-4"
      }), /* @__PURE__ */ jsx("span", {
        children: "No pricing configured yet. Showing example yoga studio pricing based on market averages."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h3", {
          className: "text-lg font-bold mb-4 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Sparkles, {
            className: "w-5 h-5 text-amber-500"
          }), "Memberships"]
        }), /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-4",
          children: displayMemberships.map((m) => /* @__PURE__ */ jsxs("div", {
            className: "border border-zinc-200 rounded-xl p-6 hover:shadow-lg transition-shadow bg-white flex flex-col",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "mb-4",
              children: [/* @__PURE__ */ jsx("h4", {
                className: "font-bold text-xl",
                children: m.name
              }), /* @__PURE__ */ jsx("p", {
                className: "text-zinc-500 text-sm mt-1",
                children: m.description || "Recurring membership"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "mt-auto pt-4 border-t border-zinc-100",
              children: [/* @__PURE__ */ jsx("div", {
                className: "flex justify-between items-end mb-4",
                children: /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "text-3xl font-bold",
                    children: ["$", (m.price / 100).toFixed(0)]
                  }), /* @__PURE__ */ jsxs("span", {
                    className: "text-zinc-500 text-sm",
                    children: ["/", m.interval === "month" ? "mo" : m.interval]
                  })]
                })
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => handleBuy(m.id, "membership"),
                className: "w-full py-2.5 bg-zinc-900 text-white rounded-lg font-medium hover:bg-zinc-800 transition-colors",
                children: "Select Plan"
              })]
            })]
          }, m.id))
        })]
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h3", {
          className: "text-lg font-bold mb-4 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Tag, {
            className: "w-5 h-5 text-blue-500"
          }), "Class Packs"]
        }), /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-1 sm:grid-cols-3 gap-4",
          children: displayPacks.map((p) => /* @__PURE__ */ jsxs("div", {
            className: "border border-zinc-200 rounded-xl p-5 hover:border-zinc-300 transition-colors bg-zinc-50/50",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-semibold text-lg mb-1",
              children: p.name
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex items-baseline gap-1 mb-3",
              children: [/* @__PURE__ */ jsxs("span", {
                className: "text-2xl font-bold",
                children: ["$", (p.price / 100).toFixed(0)]
              }), /* @__PURE__ */ jsxs("span", {
                className: "text-zinc-500 text-xs",
                children: ["/ ", (p.price / 100 / p.credits).toFixed(0), " per class"]
              })]
            }), /* @__PURE__ */ jsxs("ul", {
              className: "text-sm text-zinc-600 space-y-2 mb-4",
              children: [/* @__PURE__ */ jsxs("li", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(Check, {
                  className: "w-3 h-3 text-green-600"
                }), p.credits, " Credits"]
              }), /* @__PURE__ */ jsxs("li", {
                className: "flex items-center gap-2",
                children: [/* @__PURE__ */ jsx(Check, {
                  className: "w-3 h-3 text-green-600"
                }), "Valid for ", p.expirationDays || 365, " days"]
              })]
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => handleBuy(p.id, "pack"),
              className: "w-full py-2 border border-zinc-300 bg-white text-zinc-900 rounded-lg text-sm font-medium hover:bg-zinc-50 transition-colors",
              children: "Purchase"
            })]
          }, p.id))
        })]
      })]
    })]
  });
});
const route79 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug_pricing,
  loader: loader$y
}, Symbol.toStringTag, { value: "Module" }));
function BookingWidget({ tenantSlug }) {
  const [schedule, setSchedule] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedDate, setSelectedDate] = useState(/* @__PURE__ */ new Date());
  const [selectedClass, setSelectedClass] = useState(null);
  const [guestForm, setGuestForm] = useState({ name: "", email: "" });
  const [bookingStatus, setBookingStatus] = useState("idle");
  useEffect(() => {
    fetchSchedule();
  }, [tenantSlug, selectedDate]);
  const fetchSchedule = async () => {
    setLoading(true);
    try {
      const start = startOfWeek$1(selectedDate).toISOString();
      const res = await fetch(`https://studio-platform-api.slichti.workers.dev/guest/schedule/${tenantSlug}?start=${start}`);
      const data = await res.json();
      setSchedule(data.classes || []);
    } catch (e) {
      console.error("Failed to load schedule", e);
    } finally {
      setLoading(false);
    }
  };
  const handleBook = async () => {
    setBookingStatus("submitting");
    try {
      const res = await fetch(`https://studio-platform-api.slichti.workers.dev/guest/booking`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          classId: selectedClass.id,
          tenantId: selectedClass.tenantId,
          guestDetails: guestForm
        })
      });
      if (res.ok) {
        setBookingStatus("success");
      } else {
        setBookingStatus("error");
      }
    } catch (e) {
      setBookingStatus("error");
    }
  };
  if (bookingStatus === "success") {
    return /* @__PURE__ */ jsxs("div", { className: "p-8 text-center bg-green-50 rounded-xl", children: [
      /* @__PURE__ */ jsx("h3", { className: "text-2xl font-bold text-green-800", children: "Booking Confirmed!" }),
      /* @__PURE__ */ jsx("p", { className: "mt-2 text-green-700", children: "Check your email for details." }),
      /* @__PURE__ */ jsx(
        "button",
        {
          onClick: () => {
            setBookingStatus("idle");
            setSelectedClass(null);
          },
          className: "mt-6 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",
          children: "Book Another Class"
        }
      )
    ] });
  }
  return /* @__PURE__ */ jsxs("div", { className: "w-full max-w-4xl mx-auto bg-white rounded-xl shadow-sm border border-zinc-200 overflow-hidden flex flex-col md:flex-row h-[600px]", children: [
    /* @__PURE__ */ jsxs("div", { className: "w-full md:w-1/3 bg-zinc-50 border-r border-zinc-200 p-6 flex flex-col", children: [
      /* @__PURE__ */ jsx("h2", { className: "text-xl font-bold text-zinc-900 mb-6", children: "Select a Date" }),
      /* @__PURE__ */ jsx("div", { className: "space-y-2", children: [0, 1, 2, 3, 4, 5, 6].map((offset) => {
        const date = addDays(startOfWeek$1(selectedDate), offset);
        const isSelected = isSameDay(date, selectedDate);
        return /* @__PURE__ */ jsxs(
          "button",
          {
            onClick: () => setSelectedDate(date),
            className: `w-full text-left px-4 py-3 rounded-lg transition-colors flex justify-between items-center ${isSelected ? "bg-blue-600 text-white shadow-md" : "hover:bg-zinc-200 text-zinc-700"}`,
            children: [
              /* @__PURE__ */ jsx("span", { className: "font-medium", children: format(date, "EEEE") }),
              /* @__PURE__ */ jsx("span", { className: isSelected ? "text-blue-200" : "text-zinc-500", children: format(date, "MMM d") })
            ]
          },
          offset
        );
      }) })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "flex-1 p-6 overflow-y-auto bg-white", children: [
      /* @__PURE__ */ jsxs("h2", { className: "text-xl font-bold text-zinc-900 mb-6 sticky top-0 bg-white py-2 z-10", children: [
        "Classes for ",
        format(selectedDate, "MMMM do")
      ] }),
      loading ? /* @__PURE__ */ jsx("div", { className: "animate-pulse space-y-4", children: [1, 2, 3].map((i) => /* @__PURE__ */ jsx("div", { className: "h-24 bg-zinc-100 rounded-lg" }, i)) }) : schedule.filter((c) => isSameDay(new Date(c.startTime), selectedDate)).length === 0 ? /* @__PURE__ */ jsx("div", { className: "text-center py-12 text-zinc-500", children: "No classes scheduled for this day." }) : /* @__PURE__ */ jsx("div", { className: "space-y-4", children: schedule.filter((c) => isSameDay(new Date(c.startTime), selectedDate)).map((cls) => /* @__PURE__ */ jsx("div", { className: "group border border-zinc-200 rounded-xl p-4 hover:border-blue-300 hover:shadow-md transition-all", children: /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-start", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("div", { className: "font-bold text-zinc-900 text-lg", children: format(new Date(cls.startTime), "h:mm a") }),
          /* @__PURE__ */ jsx("h3", { className: "text-zinc-800 font-semibold mt-1", children: cls.title }),
          /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500 mt-1", children: cls.instructor?.user?.name || cls.instructor?.user?.email || "Instructor" })
        ] }),
        /* @__PURE__ */ jsx(
          "button",
          {
            onClick: () => setSelectedClass(cls),
            className: "px-4 py-2 bg-white border border-zinc-300 text-zinc-700 font-medium rounded-lg hover:bg-zinc-50 group-hover:border-blue-500 group-hover:text-blue-600 transition-colors",
            children: "Book"
          }
        )
      ] }) }, cls.id)) })
    ] }),
    selectedClass && /* @__PURE__ */ jsx("div", { className: "absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50", children: /* @__PURE__ */ jsxs("div", { className: "bg-white rounded-2xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in-95 duration-200", children: [
      /* @__PURE__ */ jsxs("div", { className: "flex justify-between items-center mb-6", children: [
        /* @__PURE__ */ jsx("h3", { className: "text-xl font-bold text-zinc-900", children: "Complete Booking" }),
        /* @__PURE__ */ jsxs("button", { onClick: () => setSelectedClass(null), className: "text-zinc-400 hover:text-zinc-600", children: [
          /* @__PURE__ */ jsx("span", { className: "sr-only", children: "Close" }),
          /* @__PURE__ */ jsx("svg", { className: "w-6 h-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }) })
        ] })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "bg-zinc-50 p-4 rounded-xl mb-6", children: [
        /* @__PURE__ */ jsx("p", { className: "font-bold text-zinc-900", children: selectedClass.title }),
        /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-600 mt-1", children: format(new Date(selectedClass.startTime), "EEEE, MMMM do @ h:mm a") })
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Full Name" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "text",
              value: guestForm.name,
              onChange: (e) => setGuestForm({ ...guestForm, name: e.target.value }),
              className: "w-full px-3 py-2 border border-zinc-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",
              placeholder: "Jane Doe"
            }
          )
        ] }),
        /* @__PURE__ */ jsxs("div", { children: [
          /* @__PURE__ */ jsx("label", { className: "block text-sm font-medium text-zinc-700 mb-1", children: "Email Address" }),
          /* @__PURE__ */ jsx(
            "input",
            {
              type: "email",
              value: guestForm.email,
              onChange: (e) => setGuestForm({ ...guestForm, email: e.target.value }),
              className: "w-full px-3 py-2 border border-zinc-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",
              placeholder: "jane@example.com"
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsx("div", { className: "mt-8", children: /* @__PURE__ */ jsx(
        "button",
        {
          onClick: handleBook,
          disabled: !guestForm.name || !guestForm.email || bookingStatus === "submitting",
          className: "w-full py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-sm transition-all transform active:scale-[0.98]",
          children: bookingStatus === "submitting" ? "Booking..." : "Confirm Booking"
        }
      ) })
    ] }) })
  ] });
}
async function loader$x({
  params
}) {
  const {
    slug
  } = params;
  if (!slug) throw new Response("Slug required", {
    status: 404
  });
  return {
    slug
  };
}
const embed_$slug_book = UNSAFE_withComponentProps(function EmbedBookingPage() {
  const {
    slug
  } = useLoaderData();
  return /* @__PURE__ */ jsx("div", {
    className: "min-h-screen bg-transparent flex items-center justify-center p-4 font-sans",
    children: /* @__PURE__ */ jsx(BookingWidget, {
      tenantSlug: slug
    })
  });
});
const route80 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug_book,
  loader: loader$x
}, Symbol.toStringTag, { value: "Module" }));
const loader$w = async ({
  params
}) => {
  try {
    const res = await fetch(`${API_URL$1}/public/tenant/${params.slug}`);
    if (!res.ok) throw new Error("Tenant not found");
    const tenant = await res.json();
    return {
      apiUrl: API_URL$1,
      tenant
    };
  } catch (e) {
    return {
      apiUrl: API_URL$1,
      tenant: null
    };
  }
};
const embed_$slug_chat = UNSAFE_withComponentProps(function EmbedChat() {
  const {
    apiUrl,
    tenant
  } = useLoaderData();
  const {
    slug
  } = useParams();
  const [view, setView] = useState("welcome");
  const [session, setSession] = useState(null);
  const [loading, setLoading] = useState(false);
  const isOnline = () => {
    if (!tenant?.chatConfig?.schedule) return true;
    const {
      timezone,
      schedule
    } = tenant.chatConfig;
    try {
      const now = /* @__PURE__ */ new Date();
      const formatter = new Intl.DateTimeFormat("en-US", {
        timeZone: timezone || "UTC",
        weekday: "short",
        hour: "numeric",
        minute: "numeric",
        hour12: false
      });
      const parts = formatter.formatToParts(now);
      const weekday = parts.find((p) => p.type === "weekday")?.value;
      const hour = parseInt(parts.find((p) => p.type === "hour")?.value || "0");
      const minute = parseInt(parts.find((p) => p.type === "minute")?.value || "0");
      const currentTime = hour * 60 + minute;
      if (!weekday) return true;
      const ranges = schedule[weekday];
      if (!ranges || !Array.isArray(ranges) || ranges.length !== 2) return false;
      const [startStr, endStr] = ranges;
      const [startH, startM] = startStr.split(":").map(Number);
      const [endH, endM] = endStr.split(":").map(Number);
      const startTime = startH * 60 + startM;
      const endTime = endH * 60 + endM;
      return currentTime >= startTime && currentTime < endTime;
    } catch (e) {
      console.error("Timezone Check Error", e);
      return true;
    }
  };
  const online = isOnline();
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");
  const [selectedRoutedRole, setSelectedRoutedRole] = useState(null);
  useEffect(() => {
    const stored = localStorage.getItem(`chat_session_${slug}`);
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        setSession(parsed);
        setView("chat");
      } catch (e) {
        localStorage.removeItem(`chat_session_${slug}`);
      }
    }
  }, [slug]);
  const startChat = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const authRes = await fetch(`${apiUrl}/guest/token`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name,
          email
        })
      });
      const authData = await authRes.json();
      if (authData.error) throw new Error(authData.error);
      const token = authData.token;
      const user = authData.user;
      const roomRes = await fetch(`${apiUrl}/chat/rooms`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
          "X-Tenant-Slug": slug || ""
          // Identify target tenant
        },
        body: JSON.stringify({
          type: "support",
          name: `Support: ${name}`,
          customer_email: email,
          metadata: {
            source: "widget",
            initialMessage: message
          },
          priority: "normal",
          routedRole: selectedRoutedRole || void 0
        })
      });
      const roomData = await roomRes.json();
      if (roomData.error) throw new Error(roomData.error);
      const roomId = roomData.id;
      if (message.trim()) {
        await fetch(`${apiUrl}/chat/rooms/${roomId}/messages`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
            "X-Tenant-Slug": slug || ""
          },
          body: JSON.stringify({
            content: message
          })
        });
      }
      const newSession = {
        token,
        roomId,
        user
      };
      setSession(newSession);
      localStorage.setItem(`chat_session_${slug}`, JSON.stringify(newSession));
      setView("chat");
    } catch (e2) {
      alert("Failed to start chat: " + e2.message);
    } finally {
      setLoading(false);
    }
  };
  const handleClose = () => {
    window.parent.postMessage({
      type: "studio-chat-close"
    }, "*");
  };
  if (view === "welcome") {
    return /* @__PURE__ */ jsxs("div", {
      className: "h-screen w-screen bg-white flex flex-col font-sans",
      children: [/* @__PURE__ */ jsx("div", {
        className: "bg-blue-600 p-4 text-white flex justify-between items-center shadow-md",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(MessageCircle, {
            size: 20
          }), /* @__PURE__ */ jsx("h1", {
            className: "font-semibold",
            children: "Support Chat"
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex-1 p-6 flex flex-col justify-center",
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-zinc-600 mb-6 text-center",
          children: online ? "Welcome! Please fill in your details to start a support chat with us." : `We are currently offline. Please leave a message and we'll get back to you at ${tenant?.chatConfig?.offlineEmail || "email"}.`
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: startChat,
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Name"
            }), /* @__PURE__ */ jsx("input", {
              required: true,
              className: "w-full border border-zinc-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none",
              placeholder: "Your Name",
              value: name,
              onChange: (e) => setName(e.target.value)
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Email"
            }), /* @__PURE__ */ jsx("input", {
              required: true,
              type: "email",
              className: "w-full border border-zinc-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none",
              placeholder: "you@example.com",
              value: email,
              onChange: (e) => setEmail(e.target.value)
            })]
          }), tenant?.settings?.chatConfig && Array.isArray(tenant.settings.chatConfig) && tenant.settings.chatConfig.length > 0 && /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Topic"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full border border-zinc-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none",
              value: selectedRoutedRole || "",
              onChange: (e) => setSelectedRoutedRole(e.target.value || null),
              children: [/* @__PURE__ */ jsx("option", {
                value: "",
                children: "Select a topic..."
              }), tenant.settings.chatConfig.map((opt) => /* @__PURE__ */ jsx("option", {
                value: opt.routeToRole || "",
                children: opt.label
              }, opt.id))]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Message"
            }), /* @__PURE__ */ jsx("textarea", {
              required: true,
              rows: 3,
              className: "w-full border border-zinc-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none",
              placeholder: "How can we help?",
              value: message,
              onChange: (e) => setMessage(e.target.value)
            })]
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: `w-full text-white font-semibold py-3 rounded-lg shadow-sm disabled:opacity-50 ${online ? "bg-blue-600 hover:bg-blue-700" : "bg-zinc-800 hover:bg-zinc-900"}`,
            children: loading ? "Sending..." : online ? "Start Chat" : "Send Message"
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "p-4 text-center text-xs text-zinc-400 border-t border-zinc-100",
        children: "Powered by Studio Platform"
      })]
    });
  }
  if (!session) return null;
  return /* @__PURE__ */ jsx("div", {
    className: "h-screen w-screen bg-white",
    children: /* @__PURE__ */ jsxs("div", {
      className: "h-full flex flex-col relative",
      children: [/* @__PURE__ */ jsx("div", {
        className: "absolute top-0 right-0 z-50 p-2 hidden",
        children: /* @__PURE__ */ jsx("button", {
          onClick: handleClose,
          children: /* @__PURE__ */ jsx(X, {})
        })
      }), /* @__PURE__ */ jsx(ChatWindow, {
        roomId: session.roomId,
        token: session.token,
        currentUser: session.user,
        wsUrl: apiUrl,
        onClose: handleClose
      })]
    })
  });
});
const route81 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug_chat,
  loader: loader$w
}, Symbol.toStringTag, { value: "Module" }));
const loader$v = async (args) => {
  const {
    slug
  } = args.params;
  try {
    const products = await apiRequest("/products?active=true", null, {
      headers: {
        "X-Tenant-Slug": slug || ""
      }
    });
    return {
      products: products || [],
      slug
    };
  } catch (e) {
    console.error("Shop Loader Error", e);
    return {
      products: [],
      slug
    };
  }
};
const embed_$slug_shop = UNSAFE_withComponentProps(function EmbedShop() {
  const {
    products,
    slug
  } = useLoaderData();
  const [cart, setCart] = useState(/* @__PURE__ */ new Map());
  const [isCartOpen, setIsCartOpen] = useState(false);
  const addToCart = (productId) => {
    setCart((prev) => {
      const next = new Map(prev);
      next.set(productId, (next.get(productId) || 0) + 1);
      return next;
    });
  };
  const removeFromCart = (productId) => {
    setCart((prev) => {
      const next = new Map(prev);
      const current = next.get(productId) || 0;
      if (current <= 1) {
        next.delete(productId);
      } else {
        next.set(productId, current - 1);
      }
      return next;
    });
  };
  const cartItemCount = Array.from(cart.values()).reduce((a, b) => a + b, 0);
  const cartTotal = Array.from(cart.entries()).reduce((total, [id, qty]) => {
    const product = products.find((p) => p.id === id);
    return total + (product?.price || 0) * qty;
  }, 0);
  const formatPrice = (cents) => `$${(cents / 100).toFixed(2)}`;
  const categories = [...new Set(products.map((p) => p.category || "Other"))];
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-zinc-50",
    children: [/* @__PURE__ */ jsx("header", {
      className: "sticky top-0 z-40 bg-white border-b border-zinc-200 px-4 py-3",
      children: /* @__PURE__ */ jsxs("div", {
        className: "max-w-6xl mx-auto flex items-center justify-between",
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-xl font-bold text-zinc-900",
          children: "Shop"
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setIsCartOpen(true),
          className: "relative p-2 hover:bg-zinc-100 rounded-full transition",
          children: [/* @__PURE__ */ jsx(ShoppingCart, {
            size: 24
          }), cartItemCount > 0 && /* @__PURE__ */ jsx("span", {
            className: "absolute -top-1 -right-1 w-5 h-5 bg-zinc-900 text-white text-xs font-bold rounded-full flex items-center justify-center",
            children: cartItemCount
          })]
        })]
      })
    }), /* @__PURE__ */ jsx("main", {
      className: "max-w-6xl mx-auto px-4 py-8",
      children: products.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "text-center py-20 text-zinc-500",
        children: [/* @__PURE__ */ jsx(Package, {
          size: 48,
          className: "mx-auto mb-4 opacity-50"
        }), /* @__PURE__ */ jsx("p", {
          children: "No products available"
        })]
      }) : categories.map((category) => /* @__PURE__ */ jsxs("section", {
        className: "mb-12",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-bold text-zinc-900 mb-4",
          children: category
        }), /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",
          children: products.filter((p) => (p.category || "Other") === category).map((product) => /* @__PURE__ */ jsxs("div", {
            className: "bg-white rounded-lg border border-zinc-200 overflow-hidden hover:shadow-md transition",
            children: [/* @__PURE__ */ jsx("div", {
              className: "aspect-square bg-zinc-100",
              children: product.imageUrl ? /* @__PURE__ */ jsx("img", {
                src: product.imageUrl,
                alt: product.name,
                className: "w-full h-full object-cover"
              }) : /* @__PURE__ */ jsx("div", {
                className: "w-full h-full flex items-center justify-center",
                children: /* @__PURE__ */ jsx(Package, {
                  size: 32,
                  className: "text-zinc-300"
                })
              })
            }), /* @__PURE__ */ jsxs("div", {
              className: "p-3",
              children: [/* @__PURE__ */ jsx("h3", {
                className: "font-medium text-zinc-900 text-sm",
                children: product.name
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center justify-between mt-2",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "font-bold text-zinc-900",
                  children: formatPrice(product.price)
                }), product.stockQuantity <= 0 ? /* @__PURE__ */ jsx("span", {
                  className: "text-xs text-red-500",
                  children: "Out of Stock"
                }) : /* @__PURE__ */ jsx("button", {
                  onClick: () => addToCart(product.id),
                  className: "p-1.5 bg-zinc-900 text-white rounded-full hover:bg-zinc-800 transition",
                  children: /* @__PURE__ */ jsx(Plus, {
                    size: 16
                  })
                })]
              })]
            })]
          }, product.id))
        })]
      }, category))
    }), isCartOpen && /* @__PURE__ */ jsxs("div", {
      className: "fixed inset-0 z-50",
      children: [/* @__PURE__ */ jsx("div", {
        className: "absolute inset-0 bg-black/30",
        onClick: () => setIsCartOpen(false)
      }), /* @__PURE__ */ jsxs("div", {
        className: "absolute right-0 top-0 bottom-0 w-full max-w-md bg-white shadow-xl flex flex-col animate-in slide-in-from-right",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 border-b border-zinc-200 flex items-center justify-between",
          children: [/* @__PURE__ */ jsxs("h2", {
            className: "text-lg font-bold",
            children: ["Your Cart (", cartItemCount, ")"]
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsCartOpen(false),
            children: /* @__PURE__ */ jsx(X, {
              size: 24
            })
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex-1 overflow-y-auto p-4 space-y-4",
          children: cart.size === 0 ? /* @__PURE__ */ jsx("p", {
            className: "text-center text-zinc-500 py-8",
            children: "Your cart is empty"
          }) : Array.from(cart.entries()).map(([productId, qty]) => {
            const product = products.find((p) => p.id === productId);
            if (!product) return null;
            return /* @__PURE__ */ jsxs("div", {
              className: "flex gap-4 p-3 bg-zinc-50 rounded-lg",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-16 h-16 bg-zinc-200 rounded flex-shrink-0",
                children: product.imageUrl && /* @__PURE__ */ jsx("img", {
                  src: product.imageUrl,
                  className: "w-full h-full object-cover rounded"
                })
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex-1",
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "font-medium text-sm",
                  children: product.name
                }), /* @__PURE__ */ jsx("p", {
                  className: "text-sm text-zinc-500",
                  children: formatPrice(product.price)
                }), /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-2 mt-2",
                  children: [/* @__PURE__ */ jsx("button", {
                    onClick: () => removeFromCart(productId),
                    className: "p-1 bg-white border rounded",
                    children: /* @__PURE__ */ jsx(Minus, {
                      size: 14
                    })
                  }), /* @__PURE__ */ jsx("span", {
                    className: "text-sm font-medium w-6 text-center",
                    children: qty
                  }), /* @__PURE__ */ jsx("button", {
                    onClick: () => addToCart(productId),
                    className: "p-1 bg-white border rounded",
                    children: /* @__PURE__ */ jsx(Plus, {
                      size: 14
                    })
                  })]
                })]
              }), /* @__PURE__ */ jsx("div", {
                className: "font-bold text-sm",
                children: formatPrice(product.price * qty)
              })]
            }, productId);
          })
        }), cart.size > 0 && /* @__PURE__ */ jsxs("div", {
          className: "p-4 border-t border-zinc-200 space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between text-lg font-bold",
            children: [/* @__PURE__ */ jsx("span", {
              children: "Total"
            }), /* @__PURE__ */ jsx("span", {
              children: formatPrice(cartTotal)
            })]
          }), /* @__PURE__ */ jsx("a", {
            href: `/studio/${slug}/checkout?cart=${encodeURIComponent(JSON.stringify(Object.fromEntries(cart)))}`,
            className: "block w-full py-3 bg-zinc-900 text-white text-center font-medium rounded-lg hover:bg-zinc-800",
            children: "Checkout"
          })]
        })]
      })]
    })]
  });
});
const route82 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: embed_$slug_shop,
  loader: loader$v
}, Symbol.toStringTag, { value: "Module" }));
const BASE_DOMAIN = "studio-platform-dev.slichti.org";
const RESERVED_SUBDOMAINS = ["www", "api", "admin", "app", "mail", "staging", "dev", "test"];
function getSubdomain(request) {
  const url = new URL(request.url);
  const hostname = url.hostname;
  const normalizedHostname = hostname.toLowerCase();
  if (normalizedHostname === BASE_DOMAIN) return null;
  if (normalizedHostname.endsWith(`.${BASE_DOMAIN}`)) {
    const subdomain = normalizedHostname.slice(0, -1 * (BASE_DOMAIN.length + 1));
    if (RESERVED_SUBDOMAINS.includes(subdomain)) {
      return null;
    }
    return subdomain;
  }
  return null;
}
async function getStudioPage(tenantSlug, pageSlug) {
  try {
    const page = await apiRequest(`/website/public/pages/${pageSlug}`, null, {
      headers: {
        "X-Tenant-Slug": tenantSlug
      }
    });
    return page;
  } catch (e) {
    console.error(`Failed to load page ${pageSlug} for tenant ${tenantSlug}:`, e);
    return null;
  }
}
function PublicPageRenderer({ page, tenantSlug }) {
  const { user } = useUser();
  return /* @__PURE__ */ jsxs("div", { className: "min-h-screen bg-white relative", children: [
    /* @__PURE__ */ jsx(Render, { config: puckConfig, data: page.content }),
    /* @__PURE__ */ jsx(
      ChatWidget,
      {
        roomId: user ? `support-${user.id}` : "support-guest",
        tenantId: tenantSlug || "",
        userId: user?.id,
        userName: user?.fullName || "Guest",
        enabled: page.tenantSettings?.chatEnabled !== false && page.content?.root?.props?.chatEnabled !== false,
        chatConfig: page.tenantSettings?.chatConfig
      }
    ),
    /* @__PURE__ */ jsx(SignedIn, { children: /* @__PURE__ */ jsx("div", { className: "fixed bottom-6 left-6 z-50", children: /* @__PURE__ */ jsxs(
      Link,
      {
        to: `/studio/${tenantSlug}/website/editor/${page.id}`,
        className: "flex items-center gap-2 bg-zinc-900 text-white px-4 py-2.5 rounded-full shadow-lg hover:bg-zinc-800 transition-transform hover:scale-105",
        children: [
          /* @__PURE__ */ jsx(Edit2, { size: 16 }),
          /* @__PURE__ */ jsx("span", { className: "font-medium text-sm", children: "Edit Page" })
        ]
      }
    ) }) })
  ] });
}
const meta$1 = ({
  data
}) => {
  if (!data?.page) {
    return [{
      title: "Page Not Found"
    }];
  }
  return [{
    title: data.page.seoTitle || data.page.title
  }, {
    name: "description",
    content: data.page.seoDescription || ""
  }];
};
async function loader$u({
  request,
  params
}) {
  const subdomain = getSubdomain(request);
  const {
    pageSlug
  } = params;
  if (!subdomain) {
    throw new Response("Not Found", {
      status: 404
    });
  }
  if (!pageSlug) {
    throw new Response("Not Found", {
      status: 404
    });
  }
  const page = await getStudioPage(subdomain, pageSlug);
  if (!page) {
    throw new Response("Page Not Found", {
      status: 404
    });
  }
  return {
    page,
    tenantSlug: subdomain
  };
}
const $pageSlug = UNSAFE_withComponentProps(function DynamicPage() {
  const {
    page,
    tenantSlug
  } = useLoaderData();
  return /* @__PURE__ */ jsx(PublicPageRenderer, {
    page,
    tenantSlug
  });
});
const route83 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: $pageSlug,
  loader: loader$u,
  meta: meta$1
}, Symbol.toStringTag, { value: "Module" }));
function Layout({ children, tenantName = "Studio Platform", role, navItems, title = "Overview" }) {
  const { user, isLoaded } = useUser();
  const { signOut } = useClerk();
  const [isDropdownOpen, setIsDropdownOpen] = useState(false);
  const [impersonationToken, setImpersonationToken] = useState(null);
  useEffect(() => {
    setImpersonationToken(localStorage.getItem("impersonation_token"));
  }, []);
  const handleLogout = () => {
    if (typeof window !== "undefined") {
      localStorage.removeItem("impersonation_token");
      setImpersonationToken(null);
    }
    signOut({ redirectUrl: "/" });
  };
  return /* @__PURE__ */ jsxs("div", { className: "flex h-screen bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 font-sans transition-colors duration-300", children: [
    /* @__PURE__ */ jsxs("aside", { className: "w-64 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col transition-colors duration-300", children: [
      /* @__PURE__ */ jsxs("div", { className: "p-6 flex items-center gap-4 border-b border-zinc-200 dark:border-zinc-800", children: [
        /* @__PURE__ */ jsx("div", { className: "text-3xl", children: "ðŸ§˜â€â™€ï¸" }),
        /* @__PURE__ */ jsx("div", { children: /* @__PURE__ */ jsx("h1", { className: "text-lg font-bold text-indigo-600 dark:text-indigo-400 leading-tight", children: tenantName }) })
      ] }),
      /* @__PURE__ */ jsx("nav", { className: "flex-1 overflow-y-auto p-4 flex flex-col gap-2", children: navItems || /* @__PURE__ */ jsx(Fragment, { children: /* @__PURE__ */ jsx(
        NavLink,
        {
          to: "/dashboard",
          className: ({ isActive }) => `block px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${isActive ? "bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-white" : "text-zinc-500 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:text-zinc-900 dark:hover:text-zinc-200"}`,
          children: "Overview"
        }
      ) }) })
    ] }),
    /* @__PURE__ */ jsxs("div", { className: "flex-1 flex flex-col overflow-hidden", children: [
      impersonationToken && /* @__PURE__ */ jsxs("div", { className: "bg-red-500 text-white px-4 py-2 flex items-center justify-center gap-3 text-sm font-medium", children: [
        /* @__PURE__ */ jsxs("span", { children: [
          "âš ï¸ Impersonating ",
          typeof window !== "undefined" ? localStorage.getItem("impersonation_target_email") : "User"
        ] }),
        /* @__PURE__ */ jsx(
          "button",
          {
            onClick: () => {
              localStorage.removeItem("impersonation_token");
              localStorage.removeItem("impersonation_target_email");
              setImpersonationToken(null);
              window.location.href = "/";
            },
            className: "bg-white text-red-500 px-2 py-0.5 rounded text-xs font-bold hover:bg-red-50",
            children: "Exit"
          }
        )
      ] }),
      /* @__PURE__ */ jsxs("header", { className: "h-[70px] bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between px-8 transition-colors duration-300", children: [
        /* @__PURE__ */ jsx("div", { className: "text-lg font-medium text-zinc-900 dark:text-zinc-100", children: title }),
        /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-5", children: [
          /* @__PURE__ */ jsx(ThemeToggle, {}),
          isLoaded && user && /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxs(
              "button",
              {
                className: "flex items-center gap-3 p-1 rounded-xl hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",
                onClick: () => setIsDropdownOpen(!isDropdownOpen),
                children: [
                  /* @__PURE__ */ jsx("div", { className: "w-10 h-10 rounded-full overflow-hidden bg-indigo-600 flex items-center justify-center text-white font-bold text-lg", children: user.imageUrl ? /* @__PURE__ */ jsx("img", { src: user.imageUrl, alt: user.fullName || "User", className: "w-full h-full object-cover" }) : /* @__PURE__ */ jsx("span", { children: user.firstName ? user.firstName[0] : "U" }) }),
                  /* @__PURE__ */ jsxs("div", { className: "text-left hidden md:block", children: [
                    /* @__PURE__ */ jsx("div", { className: "font-semibold text-sm text-zinc-900 dark:text-zinc-100", children: user.fullName }),
                    /* @__PURE__ */ jsx("div", { className: "text-xs text-zinc-500 dark:text-zinc-400 capitalize", children: role || "admin" })
                  ] }),
                  /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className: "text-zinc-400", children: /* @__PURE__ */ jsx("polyline", { points: "6 9 12 15 18 9" }) })
                ]
              }
            ),
            isDropdownOpen && /* @__PURE__ */ jsxs(Fragment, { children: [
              /* @__PURE__ */ jsx("div", { className: "fixed inset-0 z-40", onClick: () => setIsDropdownOpen(false) }),
              /* @__PURE__ */ jsxs("div", { className: "absolute top-full right-0 mt-2 w-56 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl shadow-lg p-2 z-50 animate-in fade-in zoom-in-95 duration-200", children: [
                /* @__PURE__ */ jsxs(
                  NavLink,
                  {
                    to: "/dashboard/profile",
                    onClick: () => setIsDropdownOpen(false),
                    className: "flex items-center gap-2 px-3 py-2 rounded-lg text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",
                    children: [
                      /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
                        /* @__PURE__ */ jsx("path", { d: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" }),
                        /* @__PURE__ */ jsx("circle", { cx: "12", cy: "7", r: "4" })
                      ] }),
                      "My Profile"
                    ]
                  }
                ),
                impersonationToken && /* @__PURE__ */ jsxs(
                  "button",
                  {
                    onClick: () => {
                      setIsDropdownOpen(false);
                      localStorage.removeItem("impersonation_token");
                      localStorage.removeItem("impersonation_target_email");
                      setImpersonationToken(null);
                      window.location.href = "/admin";
                    },
                    className: "w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm text-indigo-600 dark:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors",
                    children: [
                      /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
                        /* @__PURE__ */ jsx("path", { d: "M12 2a10 10 0 0 0-10 10v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6a10 10 0 0 0-10-10Z" }),
                        /* @__PURE__ */ jsx("path", { d: "M12 12v6" }),
                        /* @__PURE__ */ jsx("circle", { cx: "12", cy: "7", r: "1" })
                      ] }),
                      "Return to Admin"
                    ]
                  }
                ),
                /* @__PURE__ */ jsx("div", { className: "h-px bg-zinc-100 dark:bg-zinc-800 my-1" }),
                /* @__PURE__ */ jsxs(
                  "button",
                  {
                    onClick: () => {
                      setIsDropdownOpen(false);
                      handleLogout();
                    },
                    className: "w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",
                    children: [
                      /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
                        /* @__PURE__ */ jsx("path", { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" }),
                        /* @__PURE__ */ jsx("polyline", { points: "16 17 21 12 16 7" }),
                        /* @__PURE__ */ jsx("line", { x1: "21", y1: "12", x2: "9", y2: "12" })
                      ] }),
                      "Sign Out"
                    ]
                  }
                )
              ] })
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsx("main", { className: "flex-1 p-8 overflow-y-auto bg-zinc-50 dark:bg-zinc-950 transition-colors duration-300", children })
    ] })
  ] });
}
const loader$t = async (args) => {
  const {
    userId,
    getToken
  } = await getAuth(args);
  if (!userId) {
    return redirect("/sign-in");
  }
  const token = await getToken();
  let isPlatformAdmin = false;
  let tenants = [];
  let userProfile = null;
  let error = null;
  try {
    const user = await apiRequest("/users/me", token);
    if (user) {
      if (user.isPlatformAdmin || user.role === "admin") {
        isPlatformAdmin = true;
      }
      tenants = user.tenants || [];
      userProfile = user;
    }
  } catch (e) {
    console.error("Failed to fetch user profile", e);
    error = e.message || "Failed to load profile";
  }
  if (isPlatformAdmin && tenants.length === 0) {
    return redirect("/admin");
  }
  return {
    isPlatformAdmin,
    tenants,
    userProfile,
    error
  };
};
const dashboard = UNSAFE_withComponentProps(function DashboardRoute() {
  const {
    isPlatformAdmin,
    userProfile
  } = useLoaderData();
  let navItems = [/* @__PURE__ */ jsx(NavLink, {
    to: "/dashboard",
    end: true,
    className: ({
      isActive
    }) => `block px-3 py-2 rounded-md text-sm font-medium transition-colors ${isActive ? "bg-zinc-800 text-white" : "text-zinc-600 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800 dark:hover:text-white"}`,
    children: "Overview"
  }, "overview")];
  if (isPlatformAdmin) {
    navItems.push(/* @__PURE__ */ jsx("div", {
      className: "my-2 border-t border-zinc-200 dark:border-zinc-800"
    }, "separator"));
    navItems.push(/* @__PURE__ */ jsx(NavLink, {
      to: "/admin",
      className: "block px-3 py-2 rounded-md text-sm font-medium text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors",
      children: "ðŸ›¡ï¸ Platform Admin"
    }, "admin"));
  }
  return /* @__PURE__ */ jsxs(Layout, {
    navItems,
    role: userProfile?.role,
    children: [isPlatformAdmin === false && useLoaderData().error && /* @__PURE__ */ jsxs("div", {
      className: "bg-red-50 text-red-700 p-4 border-b border-red-200 text-sm text-center",
      children: ["Warning: Profile load failed. Admin features may be hidden. ", /* @__PURE__ */ jsx("br", {}), /* @__PURE__ */ jsx("span", {
        className: "font-mono text-xs opacity-75",
        children: useLoaderData().error
      })]
    }), /* @__PURE__ */ jsx(Outlet, {})]
  });
});
const route84 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: dashboard,
  loader: loader$t
}, Symbol.toStringTag, { value: "Module" }));
const dashboard_classes = UNSAFE_withComponentProps(function DashboardClassesLayout() {
  const context = useOutletContext();
  return /* @__PURE__ */ jsx(Outlet, {
    context
  });
});
const route85 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: dashboard_classes
}, Symbol.toStringTag, { value: "Module" }));
const loader$s = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const bookings = await apiRequest(`/classes/${args.params.id}/bookings`, token);
  return {
    bookings,
    classId: args.params.id
  };
};
const dashboard_classes_$id_roster = UNSAFE_withComponentProps(function ClassRoster() {
  const {
    bookings,
    classId
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsxs("div", {
      style: {
        marginBottom: "20px"
      },
      children: [/* @__PURE__ */ jsx(Link, {
        to: "/dashboard/classes",
        style: {
          color: "#71717a",
          textDecoration: "none",
          fontSize: "0.875rem"
        },
        children: "â† Back to Classes"
      }), /* @__PURE__ */ jsx("h2", {
        style: {
          fontSize: "1.875rem",
          fontWeight: "bold",
          marginTop: "10px"
        },
        children: "Class Roster"
      })]
    }), /* @__PURE__ */ jsx("div", {
      style: {
        background: "white",
        borderRadius: "8px",
        border: "1px solid #e4e4e7",
        overflow: "hidden"
      },
      children: /* @__PURE__ */ jsxs("table", {
        style: {
          width: "100%",
          borderCollapse: "collapse"
        },
        children: [/* @__PURE__ */ jsx("thead", {
          style: {
            background: "#f4f4f5",
            borderBottom: "1px solid #e4e4e7"
          },
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              style: {
                textAlign: "left",
                padding: "12px 20px",
                fontSize: "0.875rem",
                color: "#52525b"
              },
              children: "Student"
            }), /* @__PURE__ */ jsx("th", {
              style: {
                textAlign: "left",
                padding: "12px 20px",
                fontSize: "0.875rem",
                color: "#52525b"
              },
              children: "Email"
            }), /* @__PURE__ */ jsx("th", {
              style: {
                textAlign: "left",
                padding: "12px 20px",
                fontSize: "0.875rem",
                color: "#52525b"
              },
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              style: {
                textAlign: "left",
                padding: "12px 20px",
                fontSize: "0.875rem",
                color: "#52525b"
              },
              children: "Booked At"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          children: [bookings.map((booking) => /* @__PURE__ */ jsxs("tr", {
            style: {
              borderBottom: "1px solid #e4e4e7"
            },
            children: [/* @__PURE__ */ jsx("td", {
              style: {
                padding: "12px 20px"
              },
              children: /* @__PURE__ */ jsx("span", {
                style: {
                  fontWeight: "500"
                },
                children: booking.user.profile?.fullName || "Unknown"
              })
            }), /* @__PURE__ */ jsx("td", {
              style: {
                padding: "12px 20px",
                color: "#52525b"
              },
              children: booking.user.email
            }), /* @__PURE__ */ jsx("td", {
              style: {
                padding: "12px 20px"
              },
              children: /* @__PURE__ */ jsx("span", {
                style: {
                  padding: "4px 10px",
                  borderRadius: "999px",
                  fontSize: "0.75rem",
                  fontWeight: "bold",
                  background: booking.status === "confirmed" ? "#dcfce7" : "#f4f4f5",
                  color: booking.status === "confirmed" ? "#166534" : "#52525b"
                },
                children: booking.status
              })
            }), /* @__PURE__ */ jsx("td", {
              style: {
                padding: "12px 20px",
                color: "#71717a",
                fontSize: "0.875rem"
              },
              children: new Date(booking.createdAt).toLocaleDateString()
            })]
          }, booking.id)), bookings.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 4,
              style: {
                padding: "40px",
                textAlign: "center",
                color: "#71717a"
              },
              children: "No bookings yet."
            })
          })]
        })]
      })
    })]
  });
});
const route86 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: dashboard_classes_$id_roster,
  loader: loader$s
}, Symbol.toStringTag, { value: "Module" }));
const loader$r = async (args) => {
  const {
    params
  } = args;
  const {
    getToken,
    userId
  } = await getAuth(args);
  const token = await getToken();
  try {
    const [recordingData, classData] = await Promise.all([apiRequest(`/classes/${params.id}/recording`, token), apiRequest(`/classes/${params.id}`, token).catch(() => ({
      title: "Class Recording"
    }))]);
    return {
      id: params.id,
      title: classData.title || "Class Recording",
      ...recordingData
      // videoId, status
    };
  } catch (e) {
    throw new Response("Error loading recording", {
      status: 500
    });
  }
};
const dashboard_classes_$id_watch = UNSAFE_withComponentProps(function WatchRecording() {
  const {
    classId,
    videoId,
    title
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsx("div", {
      style: {
        marginBottom: "20px"
      },
      children: /* @__PURE__ */ jsx(Link, {
        to: "/dashboard/classes",
        style: {
          color: "#71717a",
          textDecoration: "none",
          fontSize: "0.875rem"
        },
        children: "â† Back to Classes"
      })
    }), /* @__PURE__ */ jsxs("div", {
      style: {
        maxWidth: "800px",
        margin: "0 auto"
      },
      children: [/* @__PURE__ */ jsx("h1", {
        style: {
          fontSize: "1.5rem",
          fontWeight: "bold",
          marginBottom: "20px"
        },
        children: title
      }), videoId ? /* @__PURE__ */ jsx("div", {
        style: {
          position: "relative",
          paddingTop: "56.25%"
          /* 16:9 Aspect Ratio */
        },
        children: /* @__PURE__ */ jsx("iframe", {
          src: `https://customer-<YOUR_CODE>.cloudflarestream.com/${videoId}/iframe`,
          style: {
            border: "none",
            position: "absolute",
            top: 0,
            left: 0,
            height: "100%",
            width: "100%"
          },
          allow: "accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",
          allowFullScreen: true
        })
      }) : /* @__PURE__ */ jsxs("div", {
        style: {
          padding: "60px",
          background: "#f4f4f5",
          borderRadius: "8px",
          textAlign: "center",
          color: "#71717a"
        },
        children: [/* @__PURE__ */ jsx("p", {
          children: "Recording is processing or not available."
        }), /* @__PURE__ */ jsx("p", {
          style: {
            fontSize: "0.875rem",
            marginTop: "10px"
          },
          children: "Simulated Video Player"
        })]
      })]
    })]
  });
});
const route87 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: dashboard_classes_$id_watch,
  loader: loader$r
}, Symbol.toStringTag, { value: "Module" }));
function ImageUploader({ onUploadComplete }) {
  const { getToken } = useAuth();
  const [uploading, setUploading] = useState(false);
  const [preview, setPreview] = useState(null);
  const handleFileChange = async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    setUploading(true);
    try {
      const token = await getToken();
      const { uploadURL } = await apiRequest("/uploads/image", token, {
        method: "POST"
      });
      const formData = new FormData();
      formData.append("file", file);
      const cfResponse = await fetch(uploadURL, {
        method: "POST",
        body: formData
      });
      if (!cfResponse.ok) {
        throw new Error("Failed to upload image to Cloudflare");
      }
      const cfData = await cfResponse.json();
      const imageId = cfData.result.id;
      onUploadComplete(imageId);
      setPreview(URL.createObjectURL(file));
    } catch (e2) {
      console.error(e2);
      alert("Upload failed");
    } finally {
      setUploading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", { style: { marginTop: "10px" }, children: [
    /* @__PURE__ */ jsx("label", { style: { display: "block", fontSize: "0.875rem", marginBottom: "5px" }, children: "Thumbnail" }),
    /* @__PURE__ */ jsx(
      "input",
      {
        type: "file",
        accept: "image/*",
        onChange: handleFileChange,
        disabled: uploading,
        style: { fontSize: "0.875rem" }
      }
    ),
    uploading && /* @__PURE__ */ jsx("span", { style: { fontSize: "0.875rem", color: "#71717a", marginLeft: "10px" }, children: "Uploading..." }),
    preview && /* @__PURE__ */ jsx("div", { style: { marginTop: "10px" }, children: /* @__PURE__ */ jsx("img", { src: preview, alt: "Preview", style: { width: "100px", height: "100px", objectFit: "cover", borderRadius: "6px" } }) })
  ] });
}
const loader$q = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const classes = await apiRequest("/classes", token);
  return {
    classes
  };
};
const action$4 = async (args) => {
  const {
    request
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const title = formData.get("title");
  const startTime = formData.get("startTime");
  const duration = formData.get("duration");
  const createZoom = formData.get("createZoom") === "on";
  const thumbnailId = formData.get("thumbnailId");
  try {
    await apiRequest("/classes", token, {
      method: "POST",
      body: JSON.stringify({
        title,
        description: "Class created via Dashboard",
        startTime,
        durationMinutes: Number(duration),
        capacity: 20,
        // Default
        createZoomMeeting: createZoom,
        thumbnailUrl: thumbnailId ? `https://imagedelivery.net/<ACCOUNT_HASH>/${thumbnailId}/public` : void 0
        // Need Hash
      })
    });
    return {
      success: true
    };
  } catch (e) {
    return {
      error: e.message
    };
  }
};
const dashboard_classes__index = UNSAFE_withComponentProps(function ClassesRoute() {
  const {
    classes
  } = useLoaderData();
  const actionData = useActionData();
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";
  const [thumbnailId, setThumbnailId] = useState(null);
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsx("div", {
      style: {
        display: "flex",
        justifyContent: "space-between",
        alignItems: "center",
        marginBottom: "30px"
      },
      children: /* @__PURE__ */ jsx("h2", {
        style: {
          fontSize: "1.875rem",
          fontWeight: "bold"
        },
        children: "Classes"
      })
    }), /* @__PURE__ */ jsxs("div", {
      style: {
        background: "white",
        padding: "20px",
        borderRadius: "8px",
        border: "1px solid #e4e4e7",
        marginBottom: "40px"
      },
      children: [/* @__PURE__ */ jsx("h3", {
        style: {
          fontSize: "1.1rem",
          fontWeight: "semibold",
          marginBottom: "15px"
        },
        children: "Create New Class"
      }), /* @__PURE__ */ jsxs(Form, {
        method: "post",
        style: {
          display: "grid",
          gridTemplateColumns: "1fr 1fr 1fr auto",
          gap: "20px",
          alignItems: "end"
        },
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px"
            },
            children: "Title"
          }), /* @__PURE__ */ jsx("input", {
            name: "title",
            required: true,
            type: "text",
            style: {
              width: "100%",
              padding: "8px",
              borderRadius: "4px",
              border: "1px solid #d4d4d8"
            }
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px"
            },
            children: "Start Time"
          }), /* @__PURE__ */ jsx("input", {
            name: "startTime",
            required: true,
            type: "datetime-local",
            style: {
              width: "100%",
              padding: "8px",
              borderRadius: "4px",
              border: "1px solid #d4d4d8"
            }
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px"
            },
            children: "Duration (min)"
          }), /* @__PURE__ */ jsx("input", {
            name: "duration",
            required: true,
            type: "number",
            defaultValue: "60",
            style: {
              width: "100%",
              padding: "8px",
              borderRadius: "4px",
              border: "1px solid #d4d4d8"
            }
          })]
        }), /* @__PURE__ */ jsx("input", {
          type: "hidden",
          name: "thumbnailId",
          value: thumbnailId || ""
        }), /* @__PURE__ */ jsx("div", {
          style: {
            marginBottom: "10px"
          },
          children: /* @__PURE__ */ jsxs("label", {
            style: {
              display: "flex",
              alignItems: "center",
              gap: "8px",
              fontSize: "0.875rem"
            },
            children: [/* @__PURE__ */ jsx("input", {
              name: "createZoom",
              type: "checkbox"
            }), "Auto-create Zoom?"]
          })
        }), /* @__PURE__ */ jsx("button", {
          disabled: isSubmitting,
          type: "submit",
          style: {
            padding: "10px 20px",
            background: "#18181b",
            color: "white",
            borderRadius: "6px",
            border: "none",
            cursor: "pointer"
          },
          children: isSubmitting ? "Creating..." : "Create Class"
        })]
      }), /* @__PURE__ */ jsx("div", {
        style: {
          marginTop: "10px"
        },
        children: /* @__PURE__ */ jsx(ImageUploader, {
          onUploadComplete: (id) => setThumbnailId(id)
        })
      }), actionData?.error && /* @__PURE__ */ jsx("p", {
        style: {
          color: "red",
          marginTop: "10px"
        },
        children: actionData.error
      })]
    }), /* @__PURE__ */ jsxs("div", {
      style: {
        display: "grid",
        gap: "15px"
      },
      children: [classes.map((cls) => /* @__PURE__ */ jsxs("div", {
        style: {
          background: "white",
          padding: "20px",
          borderRadius: "8px",
          border: "1px solid #e4e4e7",
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center"
        },
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h4", {
            style: {
              fontWeight: "bold"
            },
            children: cls.title
          }), /* @__PURE__ */ jsx("p", {
            style: {
              color: "#71717a",
              fontSize: "0.875rem"
            },
            children: new Date(cls.startTime).toLocaleString()
          })]
        }), /* @__PURE__ */ jsxs("div", {
          style: {
            display: "flex",
            gap: "10px",
            alignItems: "center"
          },
          children: [cls.zoomMeetingUrl && /* @__PURE__ */ jsx("a", {
            href: cls.zoomMeetingUrl,
            target: "_blank",
            rel: "noreferrer",
            style: {
              fontSize: "0.875rem",
              color: "#2563eb"
            },
            children: "Zoom Link"
          }), /* @__PURE__ */ jsx("a", {
            href: `/dashboard/classes/${cls.id}/roster`,
            style: {
              fontSize: "0.875rem",
              textDecoration: "underline"
            },
            children: "View Roster"
          })]
        })]
      }, cls.id)), classes.length === 0 && /* @__PURE__ */ jsx("p", {
        style: {
          color: "#71717a"
        },
        children: "No classes found."
      })]
    })]
  });
});
const route88 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$4,
  default: dashboard_classes__index,
  loader: loader$q
}, Symbol.toStringTag, { value: "Module" }));
const loader$p = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const user = await apiRequest("/users/me", token);
    return {
      user
    };
  } catch (e) {
    return {
      user: null,
      error: "Could not load profile"
    };
  }
};
const action$3 = async (args) => {
  const {
    request
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await request.formData();
  const phoneNumber = formData.get("phoneNumber");
  const address = formData.get("address");
  const emailPref = formData.get("pref_email") === "on";
  const smsPref = formData.get("pref_sms") === "on";
  try {
    await apiRequest("/users/me/profile", token, {
      method: "PUT",
      body: JSON.stringify({
        phoneNumber,
        address,
        contactPreferences: {
          email: emailPref,
          sms: smsPref
        }
      })
    });
    return {
      success: true
    };
  } catch (e) {
    return {
      error: e.message
    };
  }
};
const dashboard_profile = UNSAFE_withComponentProps(function ProfileRoute() {
  const {
    user,
    error
  } = useLoaderData();
  const actionData = useActionData();
  const navigation = useNavigation();
  const isSubmitting = navigation.state === "submitting";
  if (error || !user) {
    return /* @__PURE__ */ jsxs("div", {
      style: {
        color: "red"
      },
      children: ["Error loading profile: ", error || "Unknown error"]
    });
  }
  const profile = user.profile || {};
  return /* @__PURE__ */ jsxs("div", {
    style: {
      maxWidth: "600px",
      margin: "0 auto"
    },
    children: [/* @__PURE__ */ jsx("h2", {
      style: {
        fontSize: "1.875rem",
        fontWeight: "bold",
        marginBottom: "20px",
        color: "var(--text)"
      },
      children: "My Profile"
    }), /* @__PURE__ */ jsxs("div", {
      style: {
        background: "var(--card-bg)",
        padding: "30px",
        borderRadius: "12px",
        border: "1px solid var(--border)"
      },
      children: [actionData?.success && /* @__PURE__ */ jsx("div", {
        style: {
          padding: "10px",
          background: "rgba(16, 185, 129, 0.1)",
          color: "#10b981",
          borderRadius: "6px",
          marginBottom: "20px",
          border: "1px solid #10b981"
        },
        children: "Profile updated successfully!"
      }), actionData?.error && /* @__PURE__ */ jsxs("div", {
        style: {
          padding: "10px",
          background: "rgba(239, 68, 68, 0.1)",
          color: "#ef4444",
          borderRadius: "6px",
          marginBottom: "20px",
          border: "1px solid #ef4444"
        },
        children: ["Error: ", actionData.error]
      }), /* @__PURE__ */ jsxs(Form, {
        method: "post",
        style: {
          display: "flex",
          flexDirection: "column",
          gap: "20px"
        },
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px",
              color: "var(--text-muted)"
            },
            children: "Email"
          }), /* @__PURE__ */ jsx("input", {
            disabled: true,
            value: user.email,
            style: {
              width: "100%",
              padding: "10px",
              borderRadius: "6px",
              border: "1px solid var(--border)",
              background: "var(--bg)",
              color: "var(--text-muted)",
              cursor: "not-allowed"
            }
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px",
              color: "var(--text)"
            },
            children: "Phone Number"
          }), /* @__PURE__ */ jsx("input", {
            name: "phoneNumber",
            type: "tel",
            defaultValue: profile.phoneNumber || "",
            style: {
              width: "100%",
              padding: "10px",
              borderRadius: "6px",
              border: "1px solid var(--border)",
              background: "var(--bg)",
              color: "var(--text)"
            },
            placeholder: "+1 (555) 000-0000"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "5px",
              color: "var(--text)"
            },
            children: "Home Address"
          }), /* @__PURE__ */ jsx("textarea", {
            name: "address",
            rows: 3,
            defaultValue: profile.address || "",
            style: {
              width: "100%",
              padding: "10px",
              borderRadius: "6px",
              border: "1px solid var(--border)",
              background: "var(--bg)",
              color: "var(--text)",
              fontFamily: "inherit"
            },
            placeholder: "123 Yoga Lane..."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            style: {
              display: "block",
              fontSize: "0.875rem",
              marginBottom: "10px",
              color: "var(--text)",
              fontWeight: "600"
            },
            children: "Contact Preferences"
          }), /* @__PURE__ */ jsxs("div", {
            style: {
              display: "flex",
              flexDirection: "column",
              gap: "10px"
            },
            children: [/* @__PURE__ */ jsxs("label", {
              style: {
                display: "flex",
                alignItems: "center",
                gap: "10px",
                color: "var(--text)"
              },
              children: [/* @__PURE__ */ jsx("input", {
                name: "pref_email",
                type: "checkbox",
                defaultChecked: profile.contactPreferences?.email ?? true
              }), "Receive Email Notifications"]
            }), /* @__PURE__ */ jsxs("label", {
              style: {
                display: "flex",
                alignItems: "center",
                gap: "10px",
                color: "var(--text)"
              },
              children: [/* @__PURE__ */ jsx("input", {
                name: "pref_sms",
                type: "checkbox",
                defaultChecked: profile.contactPreferences?.sms ?? false
              }), "Receive SMS Notifications"]
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          style: {
            marginTop: "10px",
            display: "flex",
            justifyContent: "flex-end"
          },
          children: /* @__PURE__ */ jsx("button", {
            disabled: isSubmitting,
            type: "submit",
            style: {
              padding: "10px 24px",
              background: "var(--accent)",
              color: "white",
              borderRadius: "6px",
              border: "none",
              cursor: "pointer",
              fontWeight: "600",
              opacity: isSubmitting ? 0.7 : 1
            },
            children: isSubmitting ? "Saving..." : "Save Profile"
          })
        })]
      })]
    })]
  });
});
const route89 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$3,
  default: dashboard_profile,
  loader: loader$p
}, Symbol.toStringTag, { value: "Module" }));
const dashboard__index = UNSAFE_withComponentProps(function DashboardIndex() {
  const data = useRouteLoaderData("routes/dashboard");
  const isPlatformAdmin = data?.isPlatformAdmin || false;
  const tenants = data?.tenants || [];
  const user = data?.userProfile;
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-5xl mx-auto py-8 px-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-10",
      children: [/* @__PURE__ */ jsxs("h2", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-50 tracking-tight",
        children: ["Welcome back", user?.firstName ? `, ${user.firstName}` : "", "!"]
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400 mt-2",
        children: "Manage your studios, memberships, and classes from one place."
      })]
    }), isPlatformAdmin && /* @__PURE__ */ jsxs("div", {
      className: "mb-12",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "text-sm font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-4",
        children: "Platform Administration"
      }), /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",
        children: /* @__PURE__ */ jsx(Link, {
          to: "/admin",
          className: "group block p-6 bg-gradient-to-br from-purple-50 to-white dark:from-purple-900/20 dark:to-zinc-900 border border-purple-100 dark:border-purple-800/50 rounded-xl shadow-sm hover:shadow-md transition-all",
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-3 bg-purple-100 dark:bg-purple-900/50 rounded-lg text-purple-600 dark:text-purple-300",
              children: /* @__PURE__ */ jsx(ShieldCheck, {
                className: "w-6 h-6"
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h3", {
                className: "font-semibold text-zinc-900 dark:text-zinc-50 group-hover:text-purple-700 dark:group-hover:text-purple-300 transition-colors",
                children: "Admin Portal"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-sm text-zinc-500 dark:text-zinc-400 mt-1",
                children: "Manage tenants, users, and platform settings."
              })]
            })]
          })
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mb-12",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-center mb-6",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-semibold text-zinc-900 dark:text-zinc-50",
          children: "My Studios"
        }), /* @__PURE__ */ jsxs(Link, {
          to: "/create-studio",
          className: "inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400",
          children: [/* @__PURE__ */ jsx(Plus, {
            className: "w-4 h-4"
          }), "Create new Studio"]
        })]
      }), tenants.length > 0 ? /* @__PURE__ */ jsx("div", {
        className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",
        children: tenants.map((tenant) => /* @__PURE__ */ jsxs(Link, {
          to: `/studio/${tenant.slug}/dashboard`,
          className: "group block bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm hover:shadow-md hover:border-blue-400 dark:hover:border-blue-600 transition-all",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "h-32 bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center relative overflow-hidden",
            children: [tenant.branding?.logoUrl ? /* @__PURE__ */ jsx("img", {
              src: tenant.branding.logoUrl,
              alt: tenant.name,
              className: "h-16 w-16 object-contain"
            }) : /* @__PURE__ */ jsx(Building2, {
              className: "w-12 h-12 text-zinc-300 dark:text-zinc-700"
            }), /* @__PURE__ */ jsx("div", {
              className: "absolute top-3 right-3 px-2 py-1 bg-white/90 dark:bg-black/90 backdrop-blur-sm rounded text-xs font-medium text-zinc-600 dark:text-zinc-300 capitalize shadow-sm border border-zinc-200 dark:border-zinc-700",
              children: tenant.roles.join(", ")
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-5",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "font-bold text-zinc-900 dark:text-zinc-50 text-lg mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",
              children: tenant.name
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400 font-mono",
              children: tenant.slug
            })]
          })]
        }, tenant.id))
      }) : /* @__PURE__ */ jsxs("div", {
        className: "text-center py-12 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-dashed border-zinc-300 dark:border-zinc-700",
        children: [/* @__PURE__ */ jsx(Building2, {
          className: "w-12 h-12 text-zinc-300 dark:text-zinc-600 mx-auto mb-4"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-medium text-zinc-900 dark:text-zinc-100",
          children: "No studios yet"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1 mb-6 max-w-sm mx-auto",
          children: "You haven't joined or created any studios yet. Get started by creating your own or finding one to join."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-center gap-4",
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/create-studio",
            className: "px-4 py-2 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-md text-sm font-medium hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",
            children: "Create Studio"
          }), /* @__PURE__ */ jsx("button", {
            disabled: true,
            className: "px-4 py-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-md text-sm font-medium opacity-50 cursor-not-allowed",
            children: "Find a Studio"
          })]
        })]
      })]
    })]
  });
});
const route90 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: dashboard__index
}, Symbol.toStringTag, { value: "Module" }));
const loader$o = async ({
  request
}) => {
  return new Response(`
    <html>
        <head><title>SSR Debug</title></head>
        <body style="font-family:system-ui; padding:2rem;">
            <h1>SSR is Working</h1>
            <p>Time: ${(/* @__PURE__ */ new Date()).toISOString()}</p>
            <p>Url: ${request.url}</p>
            <pre>
Headers:
${JSON.stringify(Object.fromEntries(request.headers.entries()), null, 2)}
            </pre>
        </body>
    </html>
    `, {
    headers: {
      "Content-Type": "text/html"
    }
  });
};
const debugSsr = UNSAFE_withComponentProps(function DebugSSR() {
  return null;
});
const route91 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: debugSsr,
  loader: loader$o
}, Symbol.toStringTag, { value: "Module" }));
const signIn_$ = UNSAFE_withComponentProps(function SignInPage() {
  return /* @__PURE__ */ jsxs("div", {
    style: {
      display: "flex",
      height: "100vh",
      width: "100vw",
      overflow: "hidden"
    },
    children: [/* @__PURE__ */ jsxs("div", {
      style: {
        flex: "1",
        background: "linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4338ca 100%)",
        display: "flex",
        flexDirection: "column",
        justifyContent: "space-between",
        padding: "60px",
        color: "white",
        position: "relative"
      },
      children: [/* @__PURE__ */ jsx("div", {
        style: {
          position: "absolute",
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          opacity: 0.1,
          backgroundImage: "radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0%, transparent 20%), radial-gradient(circle at 80% 80%, rgba(255,255,255,0.4) 0%, transparent 20%)"
        }
      }), /* @__PURE__ */ jsx("div", {
        style: {
          position: "relative",
          zIndex: 1
        },
        children: /* @__PURE__ */ jsx("h1", {
          style: {
            fontSize: "1.5rem",
            fontWeight: "bold",
            letterSpacing: "-0.025em"
          },
          children: "Studio Platform"
        })
      }), /* @__PURE__ */ jsxs("div", {
        style: {
          position: "relative",
          zIndex: 1,
          maxWidth: "480px"
        },
        children: [/* @__PURE__ */ jsx("h2", {
          style: {
            fontSize: "3rem",
            fontWeight: "bold",
            lineHeight: "1.1",
            marginBottom: "20px",
            letterSpacing: "-0.03em"
          },
          children: "Manage your wellness business with elegance."
        }), /* @__PURE__ */ jsx("p", {
          style: {
            fontSize: "1.125rem",
            opacity: 0.8,
            lineHeight: "1.6"
          },
          children: "Everything you need to run your studio, engage students, and grow your community in one beautiful platform."
        })]
      }), /* @__PURE__ */ jsx("div", {
        style: {
          position: "relative",
          zIndex: 1,
          opacity: 0.6,
          fontSize: "0.875rem"
        },
        children: "Â© 2025 Studio Platform Inc."
      })]
    }), /* @__PURE__ */ jsx("div", {
      style: {
        flex: "1",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        background: "#ffffff",
        padding: "40px"
      },
      children: /* @__PURE__ */ jsx(SignIn, {
        appearance: {
          elements: {
            rootBox: {
              width: "100%",
              maxWidth: "400px"
            },
            card: {
              boxShadow: "none",
              border: "none",
              width: "100%"
            },
            headerTitle: {
              fontSize: "1.75rem",
              fontWeight: "700",
              color: "#111827"
            },
            headerSubtitle: {
              color: "#6b7280",
              fontSize: "1rem"
            },
            formButtonPrimary: {
              backgroundColor: "#4338ca",
              fontSize: "0.95rem",
              fontWeight: "600",
              textTransform: "none",
              padding: "12px",
              "&:hover": {
                backgroundColor: "#3730a3"
              }
            },
            formFieldInput: {
              borderRadius: "8px",
              borderColor: "#e5e7eb",
              padding: "10px 12px",
              fontSize: "1rem"
            },
            socialButtonsBlockButton: {
              borderRadius: "8px",
              borderColor: "#e5e7eb",
              textTransform: "none",
              fontWeight: "500"
            },
            footerActionLink: {
              color: "#4338ca",
              fontWeight: "600"
            }
          },
          layout: {
            socialButtonsPlacement: "bottom",
            logoPlacement: "none"
          }
        }
      })
    })]
  });
});
const route92 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: signIn_$
}, Symbol.toStringTag, { value: "Module" }));
const signUp_$ = UNSAFE_withComponentProps(function SignUpPage() {
  return /* @__PURE__ */ jsx("div", {
    style: {
      display: "flex",
      justifyContent: "center",
      alignItems: "center",
      height: "100vh"
    },
    children: /* @__PURE__ */ jsx(SignUp, {})
  });
});
const route93 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: signUp_$
}, Symbol.toStringTag, { value: "Module" }));
const meta = ({
  data
}) => {
  if (data?.isStudioPage && data?.page) {
    return [{
      title: data.page.seoTitle || data.page.title
    }, {
      name: "description",
      content: data.page.seoDescription || ""
    }];
  }
  return [{
    title: "Studio Platform"
  }, {
    name: "description",
    content: "Modern Studio Management Platform"
  }];
};
async function loader$n({
  request
}) {
  const subdomain = getSubdomain(request);
  if (subdomain) {
    const page = await getStudioPage(subdomain, "home");
    if (page) {
      return {
        isStudioPage: true,
        page,
        tenantSlug: subdomain
      };
    }
  }
  return {
    isStudioPage: false,
    page: null,
    tenantSlug: null
  };
}
const _index = UNSAFE_withComponentProps(function Index() {
  const {
    user
  } = useUser();
  const data = useLoaderData();
  if (data.isStudioPage && data.page) {
    return /* @__PURE__ */ jsx(PublicPageRenderer, {
      page: data.page,
      tenantSlug: data.tenantSlug || ""
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "font-sans min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-50 transition-colors duration-300",
    children: [/* @__PURE__ */ jsxs("nav", {
      className: "flex justify-between items-center px-8 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950/80 backdrop-blur-sm sticky top-0 z-50",
      children: [/* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-3",
        children: /* @__PURE__ */ jsx("span", {
          className: "text-xl font-bold tracking-tight",
          children: "ðŸ§˜ Studio Platform"
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-6",
        children: [/* @__PURE__ */ jsx(ThemeToggle, {}), /* @__PURE__ */ jsx(Link, {
          to: "/pricing",
          className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
          children: "Pricing"
        }), !!user?.publicMetadata?.isPlatformAdmin && /* @__PURE__ */ jsx(Link, {
          to: "/admin",
          className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
          children: "Admin"
        }), /* @__PURE__ */ jsxs(SignedIn, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/dashboard",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Dashboard"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3 pl-2 border-l border-zinc-200 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm text-zinc-700 dark:text-zinc-300",
              children: user?.firstName ? `Hi, ${user.firstName}` : ""
            }), /* @__PURE__ */ jsx(UserButton, {
              afterSignOutUrl: "/"
            })]
          })]
        }), /* @__PURE__ */ jsxs(SignedOut, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/sign-in",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Sign In"
          }), /* @__PURE__ */ jsx(Link, {
            to: "/sign-up",
            className: "px-4 py-2 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-md text-sm font-medium hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",
            children: "Get Started"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("main", {
      className: "max-w-7xl mx-auto px-6 py-24 text-center",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-5xl md:text-6xl font-extrabold mb-6 tracking-tight bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent pb-2",
        children: "Modern Studio Management"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-xl text-zinc-600 dark:text-zinc-400 mb-12 max-w-2xl mx-auto leading-relaxed",
        children: "Streamline your yoga studio operations with our comprehensive platform. Manage classes, memberships, and students all in one place."
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex flex-col sm:flex-row gap-4 justify-center items-center mt-8",
        children: [/* @__PURE__ */ jsx(SignedIn, {
          children: /* @__PURE__ */ jsx(Link, {
            to: "/dashboard",
            className: "px-8 py-3.5 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-lg font-semibold text-lg hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-all shadow-lg hover:shadow-xl",
            children: "Go to Dashboard"
          })
        }), /* @__PURE__ */ jsxs(SignedOut, {
          children: [/* @__PURE__ */ jsx(Link, {
            to: "/sign-up",
            className: "px-8 py-3.5 bg-zinc-900 dark:bg-zinc-50 text-white dark:text-zinc-900 rounded-lg font-semibold text-lg hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-all shadow-lg hover:shadow-xl",
            children: "Start Your Free Trial"
          }), /* @__PURE__ */ jsx(Link, {
            to: "/sign-in",
            className: "px-8 py-3.5 bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-zinc-200 dark:border-zinc-700 rounded-lg font-semibold text-lg hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-all",
            children: "Log In"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-zinc-50 dark:bg-zinc-900/50 py-24 px-6 border-t border-zinc-100 dark:border-zinc-800",
      children: /* @__PURE__ */ jsx("div", {
        className: "max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8",
        children: [{
          title: "Class Scheduling",
          desc: "Easy to use calendar for managing all your classes and recurring sessions."
        }, {
          title: "Member Management",
          desc: "Track attendance, memberships, and payments for all your students."
        }, {
          title: "Instructor Portal",
          desc: "Give your instructors access to their schedules and rosters."
        }, {
          title: "Point of Sale",
          desc: "Integrated retail checkout with support for credit card terminals and inventory management."
        }, {
          title: "Family Accounts",
          desc: "Link family members, share payment methods, and manage bookings for children."
        }, {
          title: "Marketing CRM",
          desc: "Automated email campaigns, lead tracking, and retention tools to grow your studio."
        }].map((feature, i) => /* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-950 p-8 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm hover:shadow-md transition-shadow",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "text-xl font-bold mb-3 text-zinc-900 dark:text-zinc-100",
            children: feature.title
          }), /* @__PURE__ */ jsx("p", {
            className: "text-zinc-600 dark:text-zinc-400 leading-relaxed",
            children: feature.desc
          })]
        }, i))
      })
    }), /* @__PURE__ */ jsx("div", {
      className: "py-24 px-6 border-t border-zinc-100 dark:border-zinc-800",
      children: /* @__PURE__ */ jsxs("div", {
        className: "max-w-4xl mx-auto text-center",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-3xl font-bold mb-6 text-zinc-900 dark:text-white",
          children: "Enterprise-Grade Security"
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-lg text-zinc-600 dark:text-zinc-400 mb-8 leading-relaxed",
          children: ["Security is our top priority. We use industry-leading Identity Providers (IDPs) like Google and Apple to handle your authentication. This means we ", /* @__PURE__ */ jsx("strong", {
            children: "never"
          }), " store your passwords or sensitive login credentials."]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-6 text-left",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "p-6 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-100 dark:border-blue-900/30",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-blue-900 dark:text-blue-300 mb-2",
              children: "No Stored Passwords"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-blue-700 dark:text-blue-400",
              children: "By relying on secure IDPs, we eliminate the risk of password leaks from our databases. Your credentials stay with the providers you trust."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-6 bg-purple-50 dark:bg-purple-900/10 rounded-lg border border-purple-100 dark:border-purple-900/30",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-purple-900 dark:text-purple-300 mb-2",
              children: "Advanced Protection"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-sm text-purple-700 dark:text-purple-400",
              children: "Benefit from the multi-factor authentication (MFA) and anomaly detection systems of major identity providers automatically."
            })]
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "mt-12 text-left",
          children: /* @__PURE__ */ jsx("div", {
            className: "p-8 bg-white dark:bg-zinc-900 rounded-xl text-zinc-900 dark:text-white shadow-lg border border-zinc-200 dark:border-zinc-800",
            children: /* @__PURE__ */ jsx("div", {
              className: "flex flex-col md:flex-row items-start md:items-center gap-6",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex-1",
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "text-2xl font-bold mb-3 flex items-center gap-2",
                  children: "Powered by Stripe Connect"
                }), /* @__PURE__ */ jsxs("p", {
                  className: "opacity-90 leading-relaxed mb-4 text-zinc-600 dark:text-zinc-300",
                  children: ["We use Stripe to handle all payment processing. This means we never see or store your credit card information, ensuring full ", /* @__PURE__ */ jsx("strong", {
                    children: "PCI Compliance"
                  }), " from day one."]
                }), /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-col sm:flex-row gap-4 mt-6",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex-1 bg-zinc-50 dark:bg-zinc-950/50 p-4 rounded-lg border border-zinc-100 dark:border-zinc-800",
                    children: [/* @__PURE__ */ jsx("strong", {
                      className: "block mb-1",
                      children: "Bring Your Own Stripe"
                    }), /* @__PURE__ */ jsx("span", {
                      className: "text-sm opacity-80 text-zinc-600 dark:text-zinc-400",
                      children: "Connect your existing Stripe account to keep your history, or create a new one that you fully own and control."
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex-1 bg-zinc-50 dark:bg-zinc-950/50 p-4 rounded-lg border border-zinc-100 dark:border-zinc-800",
                    children: [/* @__PURE__ */ jsx("strong", {
                      className: "block mb-1",
                      children: "Direct Payouts"
                    }), /* @__PURE__ */ jsx("span", {
                      className: "text-sm opacity-80 text-zinc-600 dark:text-zinc-400",
                      children: "Funds flow directly to your bank account. We don't hold your money."
                    })]
                  })]
                })]
              })
            })
          })
        })]
      })
    }), /* @__PURE__ */ jsx(ChatWidget, {
      roomId: user ? `support-${user.id}` : "support-guest",
      tenantId: "platform",
      userId: user?.id,
      userName: user?.fullName || "Guest"
    })]
  });
});
const route94 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: _index,
  loader: loader$n,
  meta
}, Symbol.toStringTag, { value: "Module" }));
function LogoutButton({ className }) {
  const { signOut } = useClerk();
  const navigate = useNavigate();
  const handleLogout = async () => {
    if (typeof window !== "undefined") {
      localStorage.removeItem("impersonation_token");
    }
    await signOut();
    navigate("/");
  };
  return /* @__PURE__ */ jsx(
    "button",
    {
      onClick: handleLogout,
      title: "Sign Out",
      className: `flex items-center justify-center p-2 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 ${className}`,
      children: /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", children: [
        /* @__PURE__ */ jsx("path", { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" }),
        /* @__PURE__ */ jsx("polyline", { points: "16 17 21 12 16 7" }),
        /* @__PURE__ */ jsx("line", { x1: "21", y1: "12", x2: "9", y2: "12" })
      ] })
    }
  );
}
const ALLOWED_ADMIN_EMAILS = [
  "slichti@gmail.com"
  // "admin@studioplatform.com", // Disabled until domain is active
];
const ALLOWED_DOMAINS = [
  // "studioplatform.com" // Disabled until domain is active
];
const loader$m = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const token = await getToken();
  if (!userId || !token) {
    return redirect("/sign-in?redirect_url=/admin");
  }
  try {
    const env = args.context.cloudflare?.env || args.context.env || {};
    const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
    const user = await apiRequest("/users/me", token, {}, apiUrl);
    if (!user.isPlatformAdmin && user.role !== "admin") {
      console.warn(`Admin Access Denied: User ${user.email} (${user.id}) is not a Platform Admin.`);
      throw new Response("Forbidden", {
        status: 403
      });
    }
    const email = (user.email || "").toLowerCase();
    const isAllowedEmail = ALLOWED_ADMIN_EMAILS.includes(email);
    const isAllowedDomain = ALLOWED_DOMAINS.some((d) => email.endsWith(`@${d}`));
    if (!isAllowedEmail && !isAllowedDomain) {
      console.warn(`Admin Access Denied: User ${user.email} is not in the Allowlist.`);
      throw new Response("Access Denied: You are not authorized to view this portal.", {
        status: 403
      });
    }
    return {
      user,
      token
    };
  } catch (e) {
    if (e.status === 403 || e.message?.includes("Forbidden")) {
      throw new Response("Access Denied", {
        status: 403
      });
    }
    if (e.status === 401) {
      return redirect("/sign-in?redirect_url=/admin");
    }
    console.error("Admin Loader Error:", e);
    throw new Response(`System Unavailable: ${e.message}`, {
      status: 503
    });
  }
};
const admin = UNSAFE_withComponentProps(function AdminLayout() {
  const {
    user: clerkUser,
    isLoaded
  } = useUser();
  const loaderData = useLoaderData();
  const dbUser = loaderData?.user;
  const displayName = dbUser?.firstName || clerkUser?.fullName || "Admin User";
  const displayEmail = dbUser?.email || clerkUser?.primaryEmailAddress?.emailAddress || "admin@platform.com";
  const displayImage = dbUser?.portraitUrl || clerkUser?.imageUrl;
  const navItems = [
    {
      label: "Overview",
      href: "/admin",
      end: true,
      icon: "ðŸ“Š"
    },
    {
      label: "Tenants",
      href: "/admin/tenants",
      icon: "ðŸ¢"
    },
    {
      label: "Financials",
      href: "/admin/financials",
      icon: "ðŸ’°"
    },
    {
      label: "Projections",
      href: "/admin/projections",
      icon: "ðŸ“ˆ"
    },
    {
      label: "Communications",
      href: "/admin/comms",
      icon: "ðŸ“¡"
    },
    {
      label: "Activity Logs",
      href: "/admin/logs",
      icon: "ðŸ“‹"
    },
    {
      label: "Global User Directory",
      href: "/admin/users",
      icon: "ðŸ‘¥"
    },
    {
      label: "Video Manager",
      href: "/admin/videos",
      icon: "ðŸŽ¬"
    },
    {
      label: "Website Builder",
      href: "/admin/website",
      icon: "ðŸŒ"
    },
    {
      label: "Chat System",
      href: "/admin/chat",
      icon: "ðŸ’¬"
    },
    {
      label: "Platform Features",
      href: "/admin/features",
      icon: "âš™ï¸"
    },
    {
      label: "System Status",
      href: "/admin/status",
      icon: "ðŸŸ¢"
    },
    {
      label: "Architecture",
      href: "/admin/architecture",
      icon: "ðŸ—ï¸"
    },
    {
      label: "Process Workflows",
      href: "/admin/workflows",
      icon: "ðŸ“‹"
    },
    // [NEW] Link
    {
      label: "Coupons",
      href: "/admin/coupons",
      icon: "ðŸŽŸï¸"
    },
    {
      label: "Diagnostics",
      href: "/admin/diagnostics",
      icon: "ðŸ©º"
    }
  ];
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-zinc-50 dark:bg-zinc-950 font-sans flex text-zinc-900 dark:text-zinc-100",
    children: [/* @__PURE__ */ jsxs("aside", {
      className: "w-64 bg-zinc-950 text-zinc-400 flex flex-col border-r border-zinc-800 shadow-xl z-10",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-6 border-b border-zinc-900/50 flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center text-white font-bold shadow-lg shadow-indigo-900/20",
          children: "S"
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "font-semibold text-zinc-100 leading-tight",
            children: "Studio Platform"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-[10px] uppercase tracking-wider text-zinc-500 font-medium",
            children: dbUser?.role === "owner" ? "Platform Owner" : "Platform Admin"
          })]
        })]
      }), /* @__PURE__ */ jsx("nav", {
        className: "flex-1 p-3 space-y-1 mt-2",
        children: navItems.map((item) => /* @__PURE__ */ jsxs(NavLink, {
          to: item.href,
          end: item.end,
          className: ({
            isActive
          }) => `flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${isActive ? "bg-zinc-800/80 text-white shadow-inner" : "hover:bg-zinc-900 hover:text-zinc-200"}`,
          children: [/* @__PURE__ */ jsx("span", {
            className: "opacity-70",
            children: item.icon
          }), item.label]
        }, item.href))
      }), /* @__PURE__ */ jsx("div", {
        className: "p-4 border-t border-zinc-900/50 text-xs text-zinc-600 text-center",
        children: "Â© 2024 Studio Platform"
      })]
    }), /* @__PURE__ */ jsxs("main", {
      className: "flex-1 flex flex-col h-screen overflow-hidden bg-zinc-50/50 dark:bg-zinc-950",
      children: [/* @__PURE__ */ jsxs("header", {
        className: "h-16 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between px-8",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2 text-sm text-zinc-500",
          children: [/* @__PURE__ */ jsx("span", {
            className: "hover:text-zinc-900 dark:hover:text-zinc-300 cursor-pointer",
            children: "Admin"
          }), /* @__PURE__ */ jsx("span", {
            children: "/"
          }), /* @__PURE__ */ jsx("span", {
            className: "font-medium text-zinc-900 dark:text-zinc-100",
            children: "Dashboard"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4",
          children: [/* @__PURE__ */ jsx("span", {
            className: "text-xs font-mono text-zinc-400 bg-zinc-100 dark:bg-zinc-800 px-2 py-1 rounded",
            children: "v1.0.0-dev"
          }), /* @__PURE__ */ jsxs("button", {
            onClick: () => window.dispatchEvent(new CustomEvent("open-command-bar")),
            className: "flex items-center gap-2 px-3 py-1.5 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-500 dark:text-zinc-400 hover:border-blue-500 transition-all shadow-sm group",
            children: [/* @__PURE__ */ jsx(Search, {
              size: 14,
              className: "group-hover:text-blue-500"
            }), /* @__PURE__ */ jsx("span", {
              children: "Search..."
            }), /* @__PURE__ */ jsx("kbd", {
              className: "ml-2 px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-700 rounded font-sans opacity-50",
              children: "âŒ˜K"
            })]
          }), /* @__PURE__ */ jsx(ThemeToggle, {}), /* @__PURE__ */ jsx("div", {
            className: "h-4 w-px bg-zinc-200 dark:bg-zinc-800 mx-2"
          }), isLoaded && (clerkUser || dbUser) ? /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-end",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-zinc-900 dark:text-zinc-100 leading-none",
                children: displayName
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500",
                children: displayEmail
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "w-8 h-8 rounded-full bg-zinc-100 border border-zinc-200 overflow-hidden",
              children: /* @__PURE__ */ jsx("img", {
                src: displayImage,
                alt: "Profile",
                className: "w-full h-full object-cover"
              })
            })]
          }) : /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3 animate-pulse",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-end gap-1",
              children: [/* @__PURE__ */ jsx("div", {
                className: "h-4 w-24 bg-zinc-100 rounded"
              }), /* @__PURE__ */ jsx("div", {
                className: "h-3 w-32 bg-zinc-100 rounded"
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "w-8 h-8 rounded-full bg-zinc-100"
            })]
          }), /* @__PURE__ */ jsx(LogoutButton, {})]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex-1 overflow-auto p-8",
        children: /* @__PURE__ */ jsx(Outlet, {})
      }), /* @__PURE__ */ jsx(CommandBar, {
        token: loaderData?.token || ""
      })]
    })]
  });
});
const route95 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin,
  loader: loader$m
}, Symbol.toStringTag, { value: "Module" }));
const loader$l = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const pageId = args.params.pageId;
  try {
    const pages = await apiRequest("/platform-pages/pages", token);
    const page = pages.find((p) => p.id === pageId);
    if (!page) {
      throw new Error("Page not found");
    }
    return {
      page,
      error: null
    };
  } catch (e) {
    return {
      page: null,
      error: e.message
    };
  }
};
const admin_website_edit_$pageId = UNSAFE_withComponentProps(function PlatformWebsiteEditor() {
  const {
    page: initialPage,
    error
  } = useLoaderData();
  const {
    getToken
  } = useAuth();
  const navigate = useNavigate();
  const params = useParams();
  const [saving, setSaving] = useState(false);
  const [lastSaved, setLastSaved] = useState(null);
  const [data, setData] = useState(initialPage?.content || {
    root: {
      props: {}
    },
    content: []
  });
  const [errorDialog, setErrorDialog] = useState({
    isOpen: false,
    message: ""
  });
  const handleSave = async (puckData) => {
    setSaving(true);
    try {
      const token = await getToken();
      await apiRequest(`/platform-pages/pages/${params.pageId}`, token, {
        method: "PUT",
        body: JSON.stringify({
          content: puckData
        })
      });
      setLastSaved(/* @__PURE__ */ new Date());
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: "Failed to save: " + e.message
      });
    } finally {
      setSaving(false);
    }
  };
  if (error) {
    return /* @__PURE__ */ jsxs("div", {
      className: "p-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",
        children: ["Error: ", error]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => navigate("/admin/website"),
        className: "mt-4 text-blue-600 hover:underline flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(ArrowLeft, {
          size: 16
        }), " Back to Pages"]
      })]
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "h-screen flex flex-col",
    children: [/* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      message: errorDialog.message
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white border-b border-zinc-200 px-4 py-3 flex items-center justify-between z-50",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => navigate("/admin/website"),
          className: "flex items-center gap-2 text-zinc-600 hover:text-zinc-900",
          children: [/* @__PURE__ */ jsx(ArrowLeft, {
            size: 18
          }), /* @__PURE__ */ jsx("span", {
            className: "text-sm",
            children: "Back"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "h-6 w-px bg-zinc-200"
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "font-medium text-zinc-900",
            children: initialPage?.title
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-xs text-zinc-500",
            children: ["/", initialPage?.slug, " â€¢ Platform Page"]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [lastSaved && /* @__PURE__ */ jsxs("span", {
          className: "text-xs text-zinc-400",
          children: ["Saved ", lastSaved.toLocaleTimeString()]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => {
            const url = initialPage?.slug === "home" ? "/" : `/${initialPage?.slug}`;
            window.open(url, "_blank");
          },
          className: "flex items-center gap-2 px-3 py-1.5 text-sm text-zinc-600 hover:bg-zinc-100 rounded-lg",
          children: [/* @__PURE__ */ jsx(Eye, {
            size: 16
          }), "Preview"]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => handleSave(data),
          disabled: saving,
          className: "flex items-center gap-2 px-4 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50",
          children: [/* @__PURE__ */ jsx(Save, {
            size: 16
          }), saving ? "Saving..." : "Save"]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "flex-1 overflow-hidden",
      children: /* @__PURE__ */ jsx(Puck, {
        config: puckConfig,
        data,
        onPublish: handleSave,
        onChange: setData
      })
    })]
  });
});
const route96 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_website_edit_$pageId,
  loader: loader$l
}, Symbol.toStringTag, { value: "Module" }));
const loader$k = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  if (!userId) return {
    logs: [],
    pagination: {},
    error: "Unauthorized"
  };
  const token = await getToken();
  const url = new URL(args.request.url);
  const params = new URLSearchParams(url.search);
  if (!params.get("page")) params.set("page", "1");
  if (!params.get("limit")) params.set("limit", "50");
  try {
    const data = await apiRequest(`/admin/communications/logs?${params.toString()}`, token);
    return {
      logs: data.logs || [],
      pagination: data.pagination || {
        page: 1,
        pages: 1
      },
      params: Object.fromEntries(params),
      error: null
    };
  } catch (e) {
    return {
      logs: [],
      pagination: {
        page: 1,
        pages: 1
      },
      params: {},
      error: e.message
    };
  }
};
const admin_communications_logs = UNSAFE_withComponentProps(function EmailLogs() {
  const {
    logs,
    pagination,
    params,
    error
  } = useLoaderData();
  const [searchParams, setSearchParams] = useSearchParams();
  const [resendingId, setResendingId] = useState(null);
  const handleSearch = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const search = formData.get("search");
    setSearchParams((prev) => {
      prev.set("search", search);
      prev.set("page", "1");
      return prev;
    });
  };
  const handleFilterChange = (key, value) => {
    setSearchParams((prev) => {
      if (value === "all") prev.delete(key);
      else prev.set(key, value);
      prev.set("page", "1");
      return prev;
    });
  };
  const handleResend = async (id) => {
    setResendingId(id);
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/admin/communications/resend/${id}`, token, {
        method: "POST"
      });
      toast.success("Email resent successfully");
    } catch (e) {
      toast.error("Failed to resend: " + e.message);
    } finally {
      setResendingId(null);
    }
  };
  const StatusBadge2 = ({
    status,
    errorMsg
  }) => {
    if (status === "sent") {
      return /* @__PURE__ */ jsxs("span", {
        className: "inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",
        children: [/* @__PURE__ */ jsx(CheckCircle, {
          className: "w-3 h-3"
        }), " Sent"]
      });
    }
    if (status === "failed") {
      return /* @__PURE__ */ jsxs("span", {
        className: "inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",
        title: errorMsg,
        children: [/* @__PURE__ */ jsx(XCircle, {
          className: "w-3 h-3"
        }), " Failed"]
      });
    }
    return /* @__PURE__ */ jsx("span", {
      className: "inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300",
      children: status
    });
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold tracking-tight text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Mail, {
            className: "text-blue-600"
          }), "Email Logs"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Monitor and manage platform communication logs."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        className: "inline-flex items-center gap-2 px-4 py-2 rounded-md border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-700 text-sm font-medium transition",
        onClick: () => window.location.reload(),
        children: [/* @__PURE__ */ jsx(RefreshCw, {
          className: "w-4 h-4"
        }), " Refresh"]
      })]
    }), error && /* @__PURE__ */ jsx("div", {
      className: "bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded-lg text-sm",
      children: error
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-100 dark:border-zinc-800 flex flex-col sm:flex-row gap-4 justify-between",
        children: [/* @__PURE__ */ jsxs("form", {
          onSubmit: handleSearch,
          className: "flex gap-2 w-full sm:w-auto",
          children: [/* @__PURE__ */ jsx("input", {
            name: "search",
            placeholder: "Search subject or recipient...",
            defaultValue: params.search,
            className: "flex-1 sm:w-[300px] px-3 py-2 text-sm border border-zinc-200 dark:border-zinc-700 rounded-md bg-transparent dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            className: "px-3 py-2 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded-md transition",
            children: /* @__PURE__ */ jsx(Search, {
              className: "w-4 h-4"
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsxs("select", {
            onChange: (e) => handleFilterChange("status", e.target.value),
            defaultValue: params.status || "all",
            className: "h-9 px-3 text-sm border border-zinc-200 dark:border-zinc-700 rounded-md bg-transparent dark:text-white focus:ring-2 focus:ring-blue-500 outline-none",
            children: [/* @__PURE__ */ jsx("option", {
              value: "all",
              children: "All Status"
            }), /* @__PURE__ */ jsx("option", {
              value: "sent",
              children: "Sent"
            }), /* @__PURE__ */ jsx("option", {
              value: "failed",
              children: "Failed"
            })]
          }), /* @__PURE__ */ jsxs("select", {
            onChange: (e) => handleFilterChange("type", e.target.value),
            defaultValue: params.type || "all",
            className: "h-9 px-3 text-sm border border-zinc-200 dark:border-zinc-700 rounded-md bg-transparent dark:text-white focus:ring-2 focus:ring-blue-500 outline-none",
            children: [/* @__PURE__ */ jsx("option", {
              value: "all",
              children: "All Types"
            }), /* @__PURE__ */ jsx("option", {
              value: "transactional",
              children: "Transactional"
            }), /* @__PURE__ */ jsx("option", {
              value: "campaign",
              children: "Marketing"
            })]
          })]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "overflow-x-auto",
        children: /* @__PURE__ */ jsxs("table", {
          className: "w-full text-sm text-left",
          children: [/* @__PURE__ */ jsx("thead", {
            className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800",
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Sent At"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Recipient"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Subject"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Type"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Tenant"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400",
                children: "Status"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-4 py-3 font-semibold text-xs uppercase text-zinc-500 dark:text-zinc-400 text-right",
                children: "Actions"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            className: "divide-y divide-zinc-100 dark:divide-zinc-800",
            children: logs.length === 0 ? /* @__PURE__ */ jsx("tr", {
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 7,
                className: "text-center py-12 text-zinc-500 dark:text-zinc-400",
                children: "No logs found."
              })
            }) : logs.map((log) => /* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition",
              children: [/* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 font-mono text-xs text-zinc-500 dark:text-zinc-400 whitespace-nowrap",
                children: format(new Date(log.sentAt), "MMM d, HH:mm:ss")
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-900 dark:text-zinc-100",
                children: log.recipient
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 max-w-[300px] truncate text-zinc-700 dark:text-zinc-300",
                title: log.subject,
                children: log.subject
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3",
                children: /* @__PURE__ */ jsx("span", {
                  className: "inline-flex px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 font-mono",
                  children: log.templateId || (log.campaignId ? "Campaign" : "Generic")
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-zinc-600 dark:text-zinc-300",
                children: log.tenantName || "-"
              }), /* @__PURE__ */ jsxs("td", {
                className: "px-4 py-3",
                children: [/* @__PURE__ */ jsx(StatusBadge2, {
                  status: log.status,
                  errorMsg: log.error
                }), log.error && /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-red-500 mt-1 truncate max-w-[200px]",
                  title: log.error,
                  children: log.error
                })]
              }), /* @__PURE__ */ jsx("td", {
                className: "px-4 py-3 text-right",
                children: /* @__PURE__ */ jsx("button", {
                  className: "p-2 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded-md transition",
                  onClick: () => handleResend(log.id),
                  disabled: resendingId === log.id,
                  title: "Resend Email",
                  children: /* @__PURE__ */ jsx(Send, {
                    className: `w-4 h-4 ${resendingId === log.id ? "animate-pulse" : ""}`
                  })
                })
              })]
            }, log.id))
          })]
        })
      }), /* @__PURE__ */ jsxs("div", {
        className: "p-4 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-end gap-4",
        children: [/* @__PURE__ */ jsx("button", {
          className: "px-3 py-1.5 text-sm border border-zinc-200 dark:border-zinc-700 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800 disabled:opacity-50 transition",
          onClick: () => setSearchParams((prev) => {
            prev.set("page", (pagination.page - 1).toString());
            return prev;
          }),
          disabled: pagination.page <= 1,
          children: "Previous"
        }), /* @__PURE__ */ jsxs("span", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: ["Page ", pagination.page, " of ", pagination.pages || 1]
        }), /* @__PURE__ */ jsx("button", {
          className: "px-3 py-1.5 text-sm border border-zinc-200 dark:border-zinc-700 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800 disabled:opacity-50 transition",
          onClick: () => setSearchParams((prev) => {
            prev.set("page", (pagination.page + 1).toString());
            return prev;
          }),
          disabled: pagination.page >= pagination.pages,
          children: "Next"
        })]
      })]
    })]
  });
});
const route97 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_communications_logs,
  loader: loader$k
}, Symbol.toStringTag, { value: "Module" }));
const loader$j = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const env = args.context.cloudflare?.env || args.context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  const coupons = await apiRequest("/coupons", token, {}, apiUrl);
  return {
    coupons,
    apiUrl,
    token
  };
};
const admin_coupons__index = UNSAFE_withComponentProps(function CouponsPage2() {
  const {
    coupons,
    apiUrl,
    token
  } = useLoaderData();
  const revalidator = useRevalidator();
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [formData, setFormData] = useState({
    code: "",
    type: "percent",
    // percent | amount
    value: 10,
    usageLimit: "",
    expiresAt: ""
  });
  const handleCreate = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    try {
      await apiRequest("/coupons", token, {
        method: "POST",
        body: JSON.stringify({
          ...formData,
          value: Number(formData.value),
          usageLimit: formData.usageLimit ? Number(formData.usageLimit) : null,
          expiresAt: formData.expiresAt || null
        })
      }, apiUrl);
      toast.success("Coupon created");
      setIsCreateOpen(false);
      setFormData({
        code: "",
        type: "percent",
        value: 10,
        usageLimit: "",
        expiresAt: ""
      });
      revalidator.revalidate();
    } catch (err) {
      toast.error(err.message || "Failed to create coupon");
    } finally {
      setIsSubmitting(false);
    }
  };
  const handleDelete = async (id) => {
    if (!confirm("Are you sure?")) return;
    try {
      await apiRequest(`/coupons/${id}`, token, {
        method: "DELETE"
      }, apiUrl);
      toast.success("Coupon deleted/archived");
      revalidator.revalidate();
    } catch (err) {
      toast.error(err.message);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Coupons"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500",
          children: "Manage discount codes and promotions."
        })]
      }), /* @__PURE__ */ jsx("button", {
        onClick: () => setIsCreateOpen(true),
        className: "bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition",
        children: "+ Create Coupon"
      })]
    }), /* @__PURE__ */ jsx(Card$1, {
      className: "overflow-hidden",
      children: /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left text-sm",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500",
              children: "Code"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500",
              children: "Discount"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500",
              children: "Usage"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500",
              children: "Expires"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 font-medium text-zinc-500 text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-200 dark:divide-zinc-800",
          children: coupons.length === 0 ? /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 6,
              className: "px-6 py-8 text-center text-zinc-500",
              children: "No coupons found. Create one to get started."
            })
          }) : coupons.map((c) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 dark:hover:bg-zinc-900/50",
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 font-mono font-medium",
              children: c.code
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: c.type === "percent" ? `${c.value}%` : `$${(c.value / 100).toFixed(2)}`
            }), /* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4",
              children: [c.redemptions, " ", c.usageLimit ? `/ ${c.usageLimit}` : "(Unlimited)"]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: c.expiresAt ? format(new Date(c.expiresAt), "MMM d, yyyy") : "Never"
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("span", {
                className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${c.active ? "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400" : "bg-zinc-100 text-zinc-500 dark:bg-zinc-800 dark:text-zinc-400"}`,
                children: c.active ? "Active" : "Archived"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right",
              children: /* @__PURE__ */ jsx("button", {
                onClick: () => handleDelete(c.id),
                className: "text-red-600 hover:text-red-700 text-xs font-medium",
                children: "Delete"
              })
            })]
          }, c.id))
        })]
      })
    }), isCreateOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl w-full max-w-md overflow-hidden ring-1 ring-zinc-200 dark:ring-zinc-800",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-semibold text-lg",
            children: "Create Coupon"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsCreateOpen(false),
            className: "text-zinc-500 hover:text-zinc-700",
            children: "âœ•"
          })]
        }), /* @__PURE__ */ jsxs("form", {
          onSubmit: handleCreate,
          className: "p-6 space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium mb-1",
              children: "Coupon Code"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              required: true,
              className: "w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent uppercase font-mono",
              placeholder: "SUMMER2025",
              value: formData.code,
              onChange: (e) => setFormData({
                ...formData,
                code: e.target.value.toUpperCase()
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Type"
              }), /* @__PURE__ */ jsxs("select", {
                className: "w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",
                value: formData.type,
                onChange: (e) => setFormData({
                  ...formData,
                  type: e.target.value
                }),
                children: [/* @__PURE__ */ jsx("option", {
                  value: "percent",
                  children: "Percentage (%)"
                }), /* @__PURE__ */ jsx("option", {
                  value: "amount",
                  children: "Fixed Amount ($)"
                })]
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Value"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                required: true,
                min: "1",
                className: "w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",
                value: formData.value,
                onChange: (e) => setFormData({
                  ...formData,
                  value: Number(e.target.value)
                })
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Usage Limit"
              }), /* @__PURE__ */ jsx("input", {
                type: "number",
                className: "w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",
                placeholder: "Unlimited",
                value: formData.usageLimit,
                onChange: (e) => setFormData({
                  ...formData,
                  usageLimit: e.target.value
                })
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-sm font-medium mb-1",
                children: "Expires At"
              }), /* @__PURE__ */ jsx("input", {
                type: "date",
                className: "w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",
                value: formData.expiresAt,
                onChange: (e) => setFormData({
                  ...formData,
                  expiresAt: e.target.value
                })
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-end gap-3 pt-4",
            children: [/* @__PURE__ */ jsx("button", {
              type: "button",
              onClick: () => setIsCreateOpen(false),
              className: "px-4 py-2 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition",
              children: "Cancel"
            }), /* @__PURE__ */ jsx("button", {
              type: "submit",
              disabled: isSubmitting,
              className: "px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition disabled:opacity-50",
              children: isSubmitting ? "Creating..." : "Create Coupon"
            })]
          })]
        })]
      })
    })]
  });
});
const route98 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_coupons__index,
  loader: loader$j
}, Symbol.toStringTag, { value: "Module" }));
const loader$i = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const pages = await apiRequest("/platform-pages/pages", token);
    return {
      pages,
      error: null
    };
  } catch (e) {
    return {
      pages: [],
      error: e.message
    };
  }
};
const admin_website__index = UNSAFE_withComponentProps(function AdminWebsite() {
  const {
    pages: initialPages,
    error
  } = useLoaderData();
  const [pages, setPages] = useState(initialPages || []);
  const {
    getToken
  } = useAuth();
  useNavigate();
  const [creating, setCreating] = useState(false);
  const [newPage, setNewPage] = useState({
    title: "",
    slug: ""
  });
  const [deleteId, setDeleteId] = useState(null);
  const [errorState, setErrorState] = useState({
    isOpen: false,
    message: ""
  });
  const handleCreate = async () => {
    if (!newPage.title || !newPage.slug) return;
    try {
      const token = await getToken();
      const created = await apiRequest("/platform-pages/pages", token, {
        method: "POST",
        body: JSON.stringify(newPage)
      });
      setPages([...pages, created]);
      setCreating(false);
      setNewPage({
        title: "",
        slug: ""
      });
    } catch (e) {
      setErrorState({
        isOpen: true,
        message: "Failed to create page: " + e.message
      });
    }
  };
  const confirmDelete = async () => {
    if (!deleteId) return;
    try {
      const token = await getToken();
      await apiRequest(`/platform-pages/pages/${deleteId}`, token, {
        method: "DELETE"
      });
      setPages(pages.filter((p) => p.id !== deleteId));
      setDeleteId(null);
    } catch (e) {
      setErrorState({
        isOpen: true,
        message: "Failed to delete: " + e.message
      });
    }
  };
  const handleTogglePublish = async (page) => {
    try {
      const token = await getToken();
      await apiRequest(`/platform-pages/pages/${page.id}/publish`, token, {
        method: "POST",
        body: JSON.stringify({
          isPublished: !page.isPublished
        })
      });
      setPages(pages.map((p) => p.id === page.id ? {
        ...p,
        isPublished: !p.isPublished
      } : p));
    } catch (e) {
      setErrorState({
        isOpen: true,
        message: "Failed to update: " + e.message
      });
    }
  };
  if (error) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",
        children: ["Error: ", error]
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!deleteId,
      onClose: () => setDeleteId(null),
      onConfirm: confirmDelete,
      title: "Delete Page",
      message: "Are you sure you want to delete this page? This cannot be undone.",
      confirmText: "Delete",
      isDestructive: true
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorState.isOpen,
      onClose: () => setErrorState({
        ...errorState,
        isOpen: false
      }),
      message: errorState.message
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Globe, {
            className: "text-blue-600"
          }), "Platform Website Builder"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: "Manage main site pages (Home, Pricing, About, etc.)"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setCreating(true),
        className: "flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 18
        }), "New Page"]
      })]
    }), creating && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-md shadow-xl",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-lg font-semibold mb-4 dark:text-zinc-100",
          children: "Create New Platform Page"
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Page Title"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: newPage.title,
              onChange: (e) => setNewPage({
                ...newPage,
                title: e.target.value
              }),
              className: "w-full border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 py-2 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              placeholder: "e.g., About Us"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "URL Slug"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              value: newPage.slug,
              onChange: (e) => setNewPage({
                ...newPage,
                slug: e.target.value.toLowerCase().replace(/\s+/g, "-")
              }),
              className: "w-full border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 py-2 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              placeholder: "e.g., about"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-xs text-zinc-400 mt-1",
              children: ["studio-platform.com/", newPage.slug || "slug"]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 mt-6",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setCreating(false),
            className: "px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleCreate,
            className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",
            children: "Create Page"
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 mb-8 text-white",
      children: [/* @__PURE__ */ jsx("h2", {
        className: "font-semibold mb-3",
        children: "Common Pages"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-white/70 text-sm mb-4",
        children: "Create pages for these common routes if they don't exist:"
      }), /* @__PURE__ */ jsx("div", {
        className: "flex gap-2 flex-wrap",
        children: ["home", "pricing", "about", "contact", "features"].map((slug) => {
          const exists = pages.some((p) => p.slug === slug);
          return /* @__PURE__ */ jsxs("span", {
            className: `px-3 py-1 rounded-full text-sm ${exists ? "bg-white/20" : "bg-white/10 opacity-60"}`,
            children: ["/", slug, " ", exists ? "âœ“" : ""]
          }, slug);
        })
      })]
    }), pages.length === 0 ? /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 dark:bg-zinc-900/50 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl p-12 text-center",
      children: [/* @__PURE__ */ jsx(FileText, {
        size: 48,
        className: "mx-auto text-zinc-300 dark:text-zinc-600 mb-4"
      }), /* @__PURE__ */ jsx("h3", {
        className: "text-lg font-medium text-zinc-700 dark:text-zinc-300 mb-2",
        children: "No platform pages yet"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400 mb-4",
        children: "Create your first page to customize the main site"
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setCreating(true),
        className: "inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg",
        children: [/* @__PURE__ */ jsx(Plus, {
          size: 18
        }), "Create First Page"]
      })]
    }) : /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 divide-y divide-zinc-200 dark:divide-zinc-800",
      children: pages.map((page) => /* @__PURE__ */ jsxs("div", {
        className: "p-4 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: `p-2 rounded-lg ${page.isPublished ? "bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400" : "bg-zinc-100 dark:bg-zinc-800 text-zinc-400 dark:text-zinc-500"}`,
            children: /* @__PURE__ */ jsx(FileText, {
              size: 20
            })
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-medium text-zinc-900 dark:text-zinc-100",
              children: page.title
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-sm text-zinc-500 dark:text-zinc-400",
              children: ["/", page.slug]
            })]
          }), /* @__PURE__ */ jsx("span", {
            className: `text-xs px-2 py-0.5 rounded-full font-medium ${page.isPublished ? "bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300" : "bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,
            children: page.isPublished ? "Published" : "Draft"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => handleTogglePublish(page),
            className: "p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-600 dark:text-zinc-400",
            title: page.isPublished ? "Unpublish" : "Publish",
            children: page.isPublished ? /* @__PURE__ */ jsx(EyeOff, {
              size: 18
            }) : /* @__PURE__ */ jsx(Eye, {
              size: 18
            })
          }), /* @__PURE__ */ jsx("a", {
            href: page.slug === "home" ? "/" : `/${page.slug}`,
            target: "_blank",
            rel: "noopener noreferrer",
            className: "p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-600 dark:text-zinc-400",
            children: /* @__PURE__ */ jsx(ExternalLink, {
              size: 18
            })
          }), /* @__PURE__ */ jsx(Link, {
            to: `/admin/website/edit/${page.id}`,
            className: "p-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",
            children: /* @__PURE__ */ jsx(Edit2, {
              size: 18
            })
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setDeleteId(page.id),
            className: "p-2 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg text-red-600 dark:text-red-400",
            children: /* @__PURE__ */ jsx(Trash2, {
              size: 18
            })
          })]
        })]
      }, page.id))
    })]
  });
});
const route99 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_website__index,
  loader: loader$i
}, Symbol.toStringTag, { value: "Module" }));
const loader$h = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const userId = args.params.userId;
  const env = args.context.cloudflare?.env || args.context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  try {
    const [user, tenants] = await Promise.all([apiRequest(`/admin/users/${userId}`, token, {}, apiUrl), apiRequest(`/admin/tenants`, token, {}, apiUrl)]);
    return {
      user,
      tenants
    };
  } catch (e) {
    throw new Response("User Not Found", {
      status: 404
    });
  }
};
const admin_users_$userId = UNSAFE_withComponentProps(function EditUser() {
  const {
    user,
    tenants
  } = useLoaderData();
  const {
    getToken
  } = useAuth();
  const navigate = useNavigate();
  const [isPlatformAdmin, setIsPlatformAdmin] = useState(user.isPlatformAdmin);
  const [saving, setSaving] = useState(false);
  const [error, setError] = useState("");
  const [memberships, setMemberships] = useState(user.memberships || []);
  const [isAddModalOpen, setIsAddModalOpen] = useState(false);
  const [newMembership, setNewMembership] = useState({
    tenantId: "",
    role: "student"
  });
  const [statusDialog, setStatusDialog] = useState({
    isOpen: false,
    type: "success",
    message: ""
  });
  const [confirmRemoveMembershipId, setConfirmRemoveMembershipId] = useState(null);
  const [showImpersonateConfirm, setShowImpersonateConfirm] = useState(false);
  const handleSave = async () => {
    setSaving(true);
    setError("");
    try {
      const token = await getToken();
      await apiRequest(`/admin/users/${user.id}`, token, {
        method: "PUT",
        body: JSON.stringify({
          isPlatformAdmin
        })
      });
      navigate("/admin/users");
    } catch (e) {
      setError(e.message || "Failed to update user");
    } finally {
      setSaving(false);
    }
  };
  const handleAddMembership = async () => {
    if (!newMembership.tenantId) return;
    try {
      const token = await getToken();
      await apiRequest(`/admin/users/${user.id}/memberships`, token, {
        method: "POST",
        body: JSON.stringify(newMembership)
      });
      const tenant = tenants.find((t) => t.id === newMembership.tenantId);
      setMemberships([...memberships, {
        id: "temp",
        tenant,
        role: newMembership.role
      }]);
      setIsAddModalOpen(false);
      setNewMembership({
        tenantId: "",
        role: "student"
      });
      setStatusDialog({
        isOpen: true,
        type: "success",
        message: "Access granted successfully."
      });
    } catch (e) {
      setStatusDialog({
        isOpen: true,
        type: "error",
        message: e.message
      });
    }
  };
  const removeMembership = (tenantId) => {
    setConfirmRemoveMembershipId(tenantId);
  };
  const confirmRemoveMembershipAction = async () => {
    if (!confirmRemoveMembershipId) return;
    const tenantId = confirmRemoveMembershipId;
    try {
      const token = await getToken();
      await apiRequest(`/admin/users/${user.id}/memberships`, token, {
        method: "DELETE",
        body: JSON.stringify({
          tenantId
        })
      });
      setMemberships(memberships.filter((m) => m.tenant.id !== tenantId));
    } catch (e) {
      setStatusDialog({
        isOpen: true,
        type: "error",
        message: e.message
      });
    } finally {
      setConfirmRemoveMembershipId(null);
    }
  };
  const handleImpersonate = () => {
    setShowImpersonateConfirm(true);
  };
  const confirmImpersonate = async () => {
    try {
      const token = await getToken();
      const res = await apiRequest("/admin/impersonate", token, {
        method: "POST",
        body: JSON.stringify({
          targetUserId: user.id
        })
      });
      if (res.token) {
        localStorage.setItem("impersonation_token", res.token);
        document.cookie = `__impersonate_token=${res.token}; path=/; max-age=3600; SameSite=Lax`;
        if (memberships.length > 0) {
          const slug = memberships[0].tenant.slug;
          window.location.href = `/studio/${slug}`;
        } else {
          setStatusDialog({
            isOpen: true,
            type: "error",
            message: "User has no studio memberships to access."
          });
        }
      }
    } catch (e) {
      setStatusDialog({
        isOpen: true,
        type: "error",
        message: `Impersonation failed: ${e.message}`
      });
    } finally {
      setShowImpersonateConfirm(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto space-y-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => navigate("/admin/users"),
          className: "text-sm text-zinc-500 hover:text-zinc-900 mb-2 flex items-center gap-1",
          children: "â† Back to Directory"
        }), /* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-bold",
          children: "Edit User"
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex gap-2",
        children: /* @__PURE__ */ jsxs("button", {
          onClick: handleImpersonate,
          className: "px-4 py-2 border border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 rounded-lg transition-colors font-medium text-sm flex items-center gap-2",
          children: [/* @__PURE__ */ jsxs("svg", {
            xmlns: "http://www.w3.org/2000/svg",
            width: "16",
            height: "16",
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round",
            children: [/* @__PURE__ */ jsx("path", {
              d: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
            }), /* @__PURE__ */ jsx("circle", {
              cx: "12",
              cy: "7",
              r: "4"
            })]
          }), "Impersonate"]
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsx("div", {
        className: "md:col-span-2 space-y-6",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4 mb-6",
            children: [/* @__PURE__ */ jsx("div", {
              className: "w-16 h-16 rounded-full bg-zinc-100 flex items-center justify-center text-xl font-bold text-zinc-500 overflow-hidden",
              children: user.profile?.portraitUrl ? /* @__PURE__ */ jsx("img", {
                src: user.profile.portraitUrl,
                className: "w-full h-full object-cover"
              }) : user.profile?.firstName?.[0] || "U"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-semibold text-xl",
                children: user.email === "slichti@gmail.com" && user.profile?.firstName === "System" && user.profile?.lastName === "Admin" ? "Steven Lichti" : `${user.profile?.firstName} ${user.profile?.lastName}`
              }), /* @__PURE__ */ jsx("div", {
                className: "text-zinc-500",
                children: user.email
              }), /* @__PURE__ */ jsx("div", {
                className: "text-zinc-400 font-mono text-xs mt-1",
                children: user.id
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "pt-6 border-t border-zinc-100",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-sm font-medium text-zinc-900 mb-4",
              children: "Platform Roles"
            }), /* @__PURE__ */ jsxs("label", {
              className: "flex items-start gap-3 cursor-pointer p-4 rounded-lg border border-zinc-200 hover:bg-zinc-50 transition-colors",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                checked: isPlatformAdmin,
                onChange: (e) => setIsPlatformAdmin(e.target.checked),
                className: "mt-1 w-5 h-5 rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500"
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-zinc-900",
                  children: "Platform Administrator"
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-sm text-zinc-500 mt-1",
                  children: "Grants full access to modify all tenants, users, and system settings."
                })]
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "mt-6 flex justify-end",
            children: /* @__PURE__ */ jsx("button", {
              onClick: handleSave,
              disabled: saving,
              className: "px-4 py-2 bg-zinc-900 hover:bg-zinc-800 text-white rounded-lg transition-colors font-medium text-sm disabled:opacity-50",
              children: saving ? "Saving..." : "Update Profile"
            })
          }), error && /* @__PURE__ */ jsx("div", {
            className: "mt-4 text-red-600 text-sm text-center",
            children: error
          })]
        })
      }), /* @__PURE__ */ jsx("div", {
        className: "md:col-span-1 space-y-6",
        children: /* @__PURE__ */ jsxs("div", {
          className: "bg-white border border-zinc-200 rounded-lg p-6 shadow-sm h-full",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between mb-4",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-zinc-900",
              children: "Studio Access"
            }), /* @__PURE__ */ jsx("button", {
              onClick: () => setIsAddModalOpen(true),
              className: "text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded hover:bg-blue-100 font-medium",
              children: "+ Add"
            })]
          }), memberships.length === 0 ? /* @__PURE__ */ jsx("div", {
            className: "text-center py-8 text-zinc-500 text-sm bg-zinc-50 rounded-lg border border-dashed border-zinc-200",
            children: "This user does not belong to any studios."
          }) : /* @__PURE__ */ jsx("div", {
            className: "space-y-3",
            children: memberships.map((m) => /* @__PURE__ */ jsxs("div", {
              className: "p-3 border border-zinc-200 rounded-lg bg-zinc-50/50 flex justify-between items-center group",
              children: [/* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-sm text-zinc-900",
                  children: m.tenant.name
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 capitalize",
                  children: m.role || m.roles?.map((r) => r.role).join(", ") || "No Role"
                })]
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => removeMembership(m.tenant.id),
                className: "text-zinc-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-all p-1",
                title: "Remove access",
                children: /* @__PURE__ */ jsxs("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "14",
                  height: "14",
                  viewBox: "0 0 24 24",
                  fill: "none",
                  stroke: "currentColor",
                  strokeWidth: "2",
                  strokeLinecap: "round",
                  strokeLinejoin: "round",
                  children: [/* @__PURE__ */ jsx("path", {
                    d: "M18 6 6 18"
                  }), /* @__PURE__ */ jsx("path", {
                    d: "m6 6 12 12"
                  })]
                })
              })]
            }, m.tenant.id))
          }), /* @__PURE__ */ jsx("div", {
            className: "mt-4 text-xs text-zinc-400 leading-relaxed",
            children: "Users can have different roles (Owner, Instructor, Student) in different studios."
          })]
        })
      })]
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: isAddModalOpen,
      onClose: () => setIsAddModalOpen(false),
      title: "Grant Studio Access",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Select Studio"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full border border-zinc-300 rounded-md p-2 text-sm",
            value: newMembership.tenantId,
            onChange: (e) => setNewMembership({
              ...newMembership,
              tenantId: e.target.value
            }),
            children: [/* @__PURE__ */ jsx("option", {
              value: "",
              children: "-- Select a Studio --"
            }), tenants.map((t) => /* @__PURE__ */ jsxs("option", {
              value: t.id,
              children: [t.name, " (", t.slug, ")"]
            }, t.id))]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Role"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full border border-zinc-300 rounded-md p-2 text-sm",
            value: newMembership.role,
            onChange: (e) => setNewMembership({
              ...newMembership,
              role: e.target.value
            }),
            children: [/* @__PURE__ */ jsx("option", {
              value: "student",
              children: "Student"
            }), /* @__PURE__ */ jsx("option", {
              value: "instructor",
              children: "Instructor"
            }), /* @__PURE__ */ jsx("option", {
              value: "owner",
              children: "Owner"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "mt-2 text-xs text-zinc-500 bg-zinc-50 p-2 rounded border border-zinc-200 leading-relaxed",
            children: [/* @__PURE__ */ jsx("strong", {
              children: "Note:"
            }), " Owners generally function as Instructors and Students as well. Instructors often participate as Students.", /* @__PURE__ */ jsx("br", {}), /* @__PURE__ */ jsx("br", {}), "This system treats roles independently, so you may assign multiple roles to a user for a single studio if needed."]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex justify-end gap-2",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setIsAddModalOpen(false),
            className: "px-3 py-2 text-zinc-600 hover:bg-zinc-100 rounded text-sm",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleAddMembership,
            disabled: !newMembership.tenantId,
            className: "px-3 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded text-sm disabled:opacity-50",
            children: "Grant Access"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: statusDialog.isOpen && statusDialog.type === "success",
      onClose: () => setStatusDialog({
        ...statusDialog,
        isOpen: false
      }),
      onConfirm: () => setStatusDialog({
        ...statusDialog,
        isOpen: false
      }),
      title: "Success",
      message: statusDialog.message,
      confirmText: "OK",
      cancelText: "Close"
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: statusDialog.isOpen && statusDialog.type === "error",
      onClose: () => setStatusDialog({
        ...statusDialog,
        isOpen: false
      }),
      title: "Error",
      message: statusDialog.message
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!confirmRemoveMembershipId,
      onClose: () => setConfirmRemoveMembershipId(null),
      onConfirm: confirmRemoveMembershipAction,
      title: "Remove Studio Access",
      message: "Are you sure you want to remove this user from the studio?",
      isDestructive: true,
      confirmText: "Remove Access"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: showImpersonateConfirm,
      onClose: () => setShowImpersonateConfirm(false),
      onConfirm: confirmImpersonate,
      title: "Impersonate User",
      message: `You are about to sign in as ${user.email}. This will assume their identity.`,
      confirmText: "Impersonate",
      isDestructive: true
    })]
  });
});
const route100 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_users_$userId,
  loader: loader$h
}, Symbol.toStringTag, { value: "Module" }));
const loader$g = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const stats = await apiRequest("/admin/stats/architecture", token);
    return {
      stats,
      error: null
    };
  } catch (e) {
    return {
      stats: null,
      error: e.message
    };
  }
};
const ServiceCard = ({
  title,
  sub,
  icon: Icon,
  color,
  status = "online",
  items
}) => /* @__PURE__ */ jsxs("div", {
  className: `relative overflow-hidden rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white/50 dark:bg-zinc-900/80 p-5 backdrop-blur-sm transition-all hover:bg-white hover:dark:bg-zinc-900 hover:border-${color}-500/30 group z-10 shadow-sm`,
  children: [/* @__PURE__ */ jsx("div", {
    className: `absolute top-0 right-0 p-3 opacity-50`,
    children: /* @__PURE__ */ jsx("div", {
      className: `w-24 h-24 rounded-full bg-${color}-500/10 blur-2xl -mr-10 -mt-10 transition-all group-hover:bg-${color}-500/20`
    })
  }), /* @__PURE__ */ jsxs("div", {
    className: "flex justify-between items-start mb-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-3",
      children: [/* @__PURE__ */ jsx("div", {
        className: `p-2 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-${color}-500 dark:text-${color}-400`,
        children: /* @__PURE__ */ jsx(Icon, {
          size: 18
        })
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-900 dark:text-zinc-100 text-sm",
          children: title
        }), /* @__PURE__ */ jsx("p", {
          className: "text-[10px] text-zinc-500 font-mono text-zinc-500 dark:text-zinc-500",
          children: sub
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-500/10 border border-emerald-500/20",
      children: [/* @__PURE__ */ jsx("div", {
        className: "w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"
      }), /* @__PURE__ */ jsx("span", {
        className: "text-[10px] font-medium text-emerald-500 uppercase tracking-wide",
        children: "ON LINE"
      })]
    })]
  }), items && /* @__PURE__ */ jsx("div", {
    className: "space-y-1.5",
    children: items.map((item, i) => /* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-2 text-[11px] text-zinc-500 dark:text-zinc-400",
      children: [/* @__PURE__ */ jsx("div", {
        className: `w-1 h-1 rounded-full bg-${color}-500/50`
      }), item]
    }, i))
  })]
});
const ConnectorLayer = () => /* @__PURE__ */ jsxs("div", {
  className: "grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto px-4 h-8 mb-[-1px]",
  children: [/* @__PURE__ */ jsxs("div", {
    className: "relative h-full",
    children: [/* @__PURE__ */ jsx("div", {
      className: "absolute top-0 right-0 h-1/2 w-1/2 border-b border-l border-zinc-300 dark:border-zinc-700 rounded-bl-xl opacity-30"
    }), /* @__PURE__ */ jsx("div", {
      className: "absolute top-[50%] left-1/2 h-1/2 w-px bg-zinc-300 dark:bg-zinc-700 opacity-30"
    })]
  }), /* @__PURE__ */ jsx("div", {
    className: "relative h-full flex justify-center",
    children: /* @__PURE__ */ jsx("div", {
      className: "h-full w-px bg-zinc-300 dark:bg-zinc-700 opacity-30"
    })
  }), /* @__PURE__ */ jsxs("div", {
    className: "relative h-full",
    children: [/* @__PURE__ */ jsx("div", {
      className: "absolute top-0 left-0 h-1/2 w-1/2 border-b border-r border-zinc-300 dark:border-zinc-700 rounded-br-xl opacity-30"
    }), /* @__PURE__ */ jsx("div", {
      className: "absolute top-[50%] left-1/2 h-1/2 w-px bg-zinc-300 dark:bg-zinc-700 opacity-30"
    })]
  })]
});
const DotPattern = () => /* @__PURE__ */ jsx("div", {
  className: "absolute inset-0 z-0 opacity-20 pointer-events-none",
  style: {
    backgroundImage: "radial-gradient(#6366f1 1px, transparent 1px)",
    backgroundSize: "32px 32px"
  }
});
const admin_architecture = UNSAFE_withComponentProps(function AdminArchitecture() {
  const {
    stats,
    error
  } = useLoaderData();
  const revalidator = useRevalidator();
  const [isRefreshing, setIsRefreshing] = useState(false);
  const handleRefresh = () => {
    setIsRefreshing(true);
    revalidator.revalidate();
    setTimeout(() => setIsRefreshing(false), 1e3);
  };
  if (error) return /* @__PURE__ */ jsxs("div", {
    className: "p-8 text-red-600",
    children: ["Error: ", error]
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3",
          children: [/* @__PURE__ */ jsx("h1", {
            className: "text-2xl font-bold text-zinc-900",
            children: "System Architecture"
          }), /* @__PURE__ */ jsx("span", {
            className: "px-2 py-1 rounded-full bg-indigo-100 text-indigo-700 text-[10px] font-bold uppercase tracking-wider",
            children: "Live View"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-500 mt-1",
          children: "Microservices overview and communication status"
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: handleRefresh,
        disabled: isRefreshing,
        className: "flex items-center gap-2 px-3 py-1.5 bg-white border border-zinc-200 text-zinc-600 text-sm font-medium rounded-lg hover:bg-zinc-50 transition-colors shadow-sm",
        children: [/* @__PURE__ */ jsx(RefreshCw, {
          size: 14,
          className: isRefreshing ? "animate-spin" : ""
        }), "Refresh"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "rounded-2xl bg-white dark:bg-zinc-950 p-8 pb-12 relative overflow-hidden shadow-xl shadow-zinc-200/50 dark:shadow-zinc-900/10 border border-zinc-200 dark:border-zinc-900/50 transition-colors",
      children: [/* @__PURE__ */ jsx(DotPattern, {}), /* @__PURE__ */ jsxs("div", {
        className: "relative z-10",
        children: [/* @__PURE__ */ jsx("div", {
          className: "flex justify-center gap-4 mb-4",
          children: [{
            icon: Globe,
            label: "Web App"
          }, {
            icon: Smartphone,
            label: "Mobile App"
          }, {
            icon: Layout$1,
            label: "Admin Portal"
          }, {
            icon: Globe,
            label: "Public API"
          }].map((item, i) => /* @__PURE__ */ jsxs("div", {
            className: "px-3 py-1.5 rounded-full border border-zinc-200 dark:border-zinc-800 bg-white/80 dark:bg-zinc-900/80 text-zinc-600 dark:text-zinc-400 text-xs flex items-center gap-2 backdrop-blur-sm shadow-sm",
            children: [/* @__PURE__ */ jsx(item.icon, {
              size: 12
            }), " ", item.label]
          }, i))
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-center h-8 mb-4",
          children: /* @__PURE__ */ jsx("div", {
            className: "w-px border-l border-dashed border-zinc-300 dark:border-zinc-800"
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "max-w-xl mx-auto mb-4 relative",
          children: [/* @__PURE__ */ jsx("div", {
            className: "absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-[4px] text-[9px] font-bold bg-indigo-600 text-white uppercase tracking-wider shadow-lg shadow-indigo-500/20 z-10",
            children: "Entrance"
          }), /* @__PURE__ */ jsxs("div", {
            className: "rounded-xl border border-indigo-200 dark:border-indigo-500/20 bg-white/80 dark:bg-zinc-900/80 p-6 text-center relative overflow-hidden backdrop-blur-xl shadow-2xl shadow-indigo-500/10 dark:shadow-indigo-900/10 transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "absolute inset-0 bg-gradient-to-b from-indigo-500/5 to-transparent pointer-events-none"
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-center gap-1.5 relative z-10",
              children: [/* @__PURE__ */ jsx(Layers, {
                className: "text-indigo-400 mb-1",
                size: 24
              }), /* @__PURE__ */ jsx("h2", {
                className: "text-lg font-bold text-zinc-900 dark:text-white",
                children: "API Gateway"
              }), /* @__PURE__ */ jsx("span", {
                className: "font-mono text-zinc-500 dark:text-zinc-600 text-xs",
                children: "`packages/api`"
              }), /* @__PURE__ */ jsx("div", {
                className: "flex gap-1 mt-3 justify-center flex-wrap",
                children: ["Routing", "Rate Limiting", "Auth Context", "Observability"].map((tag) => /* @__PURE__ */ jsx("span", {
                  className: "px-1.5 py-0.5 rounded bg-indigo-50 dark:bg-indigo-500/5 border border-indigo-100 dark:border-indigo-500/10 text-indigo-600 dark:text-indigo-300/[0.7] text-[10px] font-medium",
                  children: tag
                }, tag))
              })]
            })]
          })]
        }), /* @__PURE__ */ jsx(ConnectorLayer, {}), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mb-12 px-4",
          children: [/* @__PURE__ */ jsx(ServiceCard, {
            title: "Core API",
            sub: "apps/core-api",
            icon: Shield,
            color: "emerald",
            items: ["Identity", "Tenants", "Onboarding", "Platform Admin"]
          }), /* @__PURE__ */ jsx(ServiceCard, {
            title: "Commerce API",
            sub: "apps/commerce-api",
            icon: CreditCard,
            color: "blue",
            items: ["Billing", "Subscriptions", "Products", "POS", "Webhooks"]
          }), /* @__PURE__ */ jsx(ServiceCard, {
            title: "Studio API",
            sub: "apps/studio-api",
            icon: Calendar,
            color: "orange",
            items: ["Classes", "Bookings", "Members", "Waivers", "Payroll"]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "max-w-4xl mx-auto mb-8 relative",
          children: [/* @__PURE__ */ jsx("div", {
            className: "absolute -top-3 left-1/2 -translate-x-1/2 bg-white dark:bg-zinc-950 px-2 text-[10px] uppercase font-bold text-zinc-400 dark:text-zinc-600 tracking-widest z-10 transition-colors",
            children: "External Integration"
          }), /* @__PURE__ */ jsxs("div", {
            className: "border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 bg-zinc-50/50 dark:bg-zinc-900/20 border-dashed flex justify-around items-center gap-4 transition-colors",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-center gap-2 group",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-10 h-10 rounded-lg bg-[#635BFF]/10 border border-[#635BFF]/20 flex items-center justify-center text-[#635BFF] transition-all group-hover:bg-[#635BFF]/20",
                children: /* @__PURE__ */ jsx(CreditCard, {
                  size: 18
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",
                children: "Stripe"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-center gap-2 group",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-10 h-10 rounded-lg bg-[#2D8CFF]/10 border border-[#2D8CFF]/20 flex items-center justify-center text-[#2D8CFF] transition-all group-hover:bg-[#2D8CFF]/20",
                children: /* @__PURE__ */ jsx(Globe, {
                  size: 18
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",
                children: "Zoom"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-center gap-2 group",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-10 h-10 rounded-lg bg-zinc-900/5 dark:bg-white/10 border border-zinc-900/10 dark:border-white/20 flex items-center justify-center text-zinc-900 dark:text-white transition-all group-hover:bg-zinc-900/10 dark:group-hover:bg-white/20",
                children: /* @__PURE__ */ jsx(Smartphone, {
                  size: 18
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",
                children: "Resend"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex flex-col items-center gap-2 group",
              children: [/* @__PURE__ */ jsx("div", {
                className: "w-10 h-10 rounded-lg bg-[#F22F46]/10 border border-[#F22F46]/20 flex items-center justify-center text-[#F22F46] transition-all group-hover:bg-[#F22F46]/20",
                children: /* @__PURE__ */ jsx(Smartphone, {
                  size: 18
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",
                children: "Twilio"
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "max-w-2xl mx-auto flex gap-4 opacity-80 pt-8 border-t border-zinc-200 dark:border-zinc-900",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex-1 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 p-3 flex items-center gap-3 hover:border-zinc-400 dark:hover:border-zinc-700 transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-2 bg-white dark:bg-zinc-900 rounded text-zinc-500 border border-zinc-200 dark:border-zinc-800",
              children: /* @__PURE__ */ jsx(Database, {
                size: 16
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h4", {
                className: "text-xs font-semibold text-zinc-700 dark:text-zinc-300",
                children: "Database"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-[10px] text-zinc-600",
                children: "Cloudflare D1"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex-1 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 p-3 flex items-center gap-3 hover:border-zinc-400 dark:hover:border-zinc-700 transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "p-2 bg-white dark:bg-zinc-900 rounded text-zinc-500 border border-zinc-200 dark:border-zinc-800",
              children: /* @__PURE__ */ jsx(Box, {
                size: 16
              })
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h4", {
                className: "text-xs font-semibold text-zinc-700 dark:text-zinc-300",
                children: "Shared Lib"
              }), /* @__PURE__ */ jsx("p", {
                className: "text-[10px] text-zinc-500 dark:text-zinc-600",
                children: "Utils, Types"
              })]
            })]
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-8 mt-12 pt-8 border-t border-zinc-200",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-xs font-bold text-zinc-500 uppercase tracking-widest",
          children: "Platform Activity"
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-5 shadow-sm transition-colors",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start mb-2",
              children: [/* @__PURE__ */ jsx("div", {
                className: "p-2 rounded-lg bg-indigo-500/10 text-indigo-400",
                children: /* @__PURE__ */ jsx(Globe, {
                  size: 18
                })
              }), /* @__PURE__ */ jsx("span", {
                className: "text-[10px] uppercase font-bold text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded-full",
                children: "Live"
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "text-3xl font-bold text-zinc-900 dark:text-white mb-1",
              children: stats?.connectedUsers || 0
            }), /* @__PURE__ */ jsx("div", {
              className: "text-xs text-zinc-400 font-medium",
              children: "Active Users"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-5 shadow-sm transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "flex justify-between items-start mb-2",
              children: /* @__PURE__ */ jsx("div", {
                className: "p-2 rounded-lg bg-orange-500/10 text-orange-400",
                children: /* @__PURE__ */ jsx(Layout$1, {
                  size: 18
                })
              })
            }), /* @__PURE__ */ jsx("div", {
              className: "text-3xl font-bold text-zinc-900 dark:text-white mb-1",
              children: stats?.tenantCount || 0
            }), /* @__PURE__ */ jsx("div", {
              className: "text-xs text-zinc-400 font-medium",
              children: "Total Tenants"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4 mt-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800 shadow-sm transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-[10px] text-zinc-500 dark:text-zinc-400 font-bold uppercase tracking-wider mb-1",
              children: "DB Latency"
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
              children: [stats?.latency?.database_ms || 0, /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 font-normal ml-1",
                children: "ms"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800 shadow-sm transition-colors",
            children: [/* @__PURE__ */ jsx("div", {
              className: "text-[10px] text-zinc-500 dark:text-zinc-400 font-bold uppercase tracking-wider mb-1",
              children: "Edge Latency"
            }), /* @__PURE__ */ jsxs("div", {
              className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
              children: [stats?.latency?.edge_ms || 0, /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 font-normal ml-1",
                children: "ms"
              })]
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6 shadow-sm transition-colors",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-6",
          children: "User Geography"
        }), /* @__PURE__ */ jsx("div", {
          className: "space-y-4",
          children: stats?.userRegions?.map((region, i) => /* @__PURE__ */ jsxs("div", {
            className: "group",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-end mb-1",
              children: [/* @__PURE__ */ jsxs("span", {
                className: "text-sm font-medium text-zinc-700 dark:text-zinc-300 flex items-center gap-2",
                children: [/* @__PURE__ */ jsx("span", {
                  className: "text-xs text-zinc-400 dark:text-zinc-500 font-mono w-6",
                  children: region.code
                }), region.name]
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 font-mono",
                children: region.count
              })]
            }), /* @__PURE__ */ jsx("div", {
              className: "h-1.5 w-full bg-zinc-800 rounded-full overflow-hidden",
              children: /* @__PURE__ */ jsx("div", {
                className: `h-full rounded-full bg-indigo-500`,
                style: {
                  width: `${region.count / (stats?.userRegions[0]?.count || 1) * 100}%`
                }
              })
            })]
          }, region.code))
        })]
      })]
    })]
  });
});
const route101 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_architecture,
  loader: loader$g
}, Symbol.toStringTag, { value: "Module" }));
const Input = React.forwardRef(
  ({ className = "", type, ...props }, ref) => {
    return /* @__PURE__ */ jsx(
      "input",
      {
        type,
        className: `flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${className}`,
        ref,
        ...props
      }
    );
  }
);
Input.displayName = "Input";
const Label = React.forwardRef(
  ({ className = "", ...props }, ref) => /* @__PURE__ */ jsx(
    "label",
    {
      ref,
      className: `text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${className}`,
      ...props
    }
  )
);
Label.displayName = "Label";
const Select = React.forwardRef(
  ({ className = "", children, ...props }, ref) => {
    return /* @__PURE__ */ jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsx(
        "select",
        {
          className: `appearance-none flex h-10 w-full items-center justify-between rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300 ${className}`,
          ref,
          ...props,
          children
        }
      ),
      /* @__PURE__ */ jsx(ChevronDown, { className: "absolute right-3 top-3 h-4 w-4 opacity-50 pointer-events-none" })
    ] });
  }
);
Select.displayName = "Select";
const loader$f = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const url = new URL(args.request.url);
  const search = url.searchParams.get("search") || "";
  const tenantId = url.searchParams.get("tenantId") || "";
  const context = args.context;
  const env = context.cloudflare?.env || context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  try {
    const params = new URLSearchParams();
    if (search) params.append("search", search);
    if (tenantId) params.append("tenantId", tenantId);
    const sort = url.searchParams.get("sort");
    if (sort) params.append("sort", sort);
    const [users, tenants] = await Promise.all([apiRequest(`/admin/users?${params.toString()}`, token, {}, apiUrl), apiRequest(`/admin/tenants`, token, {}, apiUrl)]);
    return {
      users,
      tenants: tenants || [],
      error: null
    };
  } catch (e) {
    const message = e instanceof Error ? e.message : "Unauthorized";
    return {
      users: [],
      tenants: [],
      error: message
    };
  }
};
const admin_users__index = UNSAFE_withComponentProps(function AdminUsers() {
  const {
    users,
    tenants
  } = useLoaderData();
  const [searchParams, setSearchParams] = useSearchParams();
  const submit = useSubmit();
  const [selectedUsers, setSelectedUsers] = useState(/* @__PURE__ */ new Set());
  const [groupByTenant, setGroupByTenant] = useState(false);
  const [expandedGroups, setExpandedGroups] = useState(/* @__PURE__ */ new Set());
  const [statusDialog, setStatusDialog] = useState({
    isOpen: false,
    type: "success",
    message: ""
  });
  const [isAddUserOpen, setIsAddUserOpen] = useState(false);
  const [newUser, setNewUser] = useState({
    firstName: "",
    lastName: "",
    email: "",
    isPlatformAdmin: false,
    initialTenantId: "",
    initialRole: "student"
  });
  const [impersonateTargetId, setImpersonateTargetId] = useState(null);
  const [userToDelete, setUserToDelete] = useState(null);
  const usersList = Array.isArray(users) ? users : [];
  const groupedData = useMemo(() => {
    if (!groupByTenant) return null;
    const groups = {};
    groups["platform_admins"] = {
      tenant: {
        id: "platform_admins",
        name: "Platform Administrators"
      },
      users: []
    };
    usersList.forEach((u) => {
      if (u.isPlatformAdmin) {
        groups["platform_admins"].users.push(u);
      }
      if (u.memberships && u.memberships.length > 0) {
        u.memberships.forEach((m) => {
          const tId = m.tenant.id;
          if (!groups[tId]) {
            groups[tId] = {
              tenant: m.tenant,
              users: []
            };
          }
          const userRole = m.roles?.[0]?.role || m.role || "member";
          groups[tId].users.push({
            ...u,
            contextRole: userRole
          });
        });
      } else {
        if (!groups["unassigned"]) {
          groups["unassigned"] = {
            tenant: {
              id: "unassigned",
              name: "Unassigned / Global"
            },
            users: []
          };
        }
        groups["unassigned"].users.push(u);
      }
    });
    if (groups["platform_admins"].users.length === 0) {
      delete groups["platform_admins"];
    }
    return groups;
  }, [usersList, groupByTenant]);
  const handleSearch = (e) => {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);
    const q = formData.get("search");
    setSearchParams((prev) => {
      if (q) prev.set("search", q);
      else prev.delete("search");
      return prev;
    });
  };
  const toggleSelectAll = () => {
    if (selectedUsers.size === usersList.length) {
      setSelectedUsers(/* @__PURE__ */ new Set());
    } else {
      setSelectedUsers(new Set(usersList.map((u) => u.id)));
    }
  };
  const toggleUser = (id) => {
    const newSet = new Set(selectedUsers);
    if (newSet.has(id)) newSet.delete(id);
    else newSet.add(id);
    setSelectedUsers(newSet);
  };
  const toggleGroup = (tenantId) => {
    const newSet = new Set(expandedGroups);
    if (newSet.has(tenantId)) newSet.delete(tenantId);
    else newSet.add(tenantId);
    setExpandedGroups(newSet);
  };
  const {
    getToken,
    userId
  } = useAuth();
  const executeBulk = async (action2, value) => {
    if (selectedUsers.size === 0) return;
    try {
      const token = await getToken();
      const res = await apiRequest("/admin/users/bulk", token, {
        method: "PATCH",
        body: JSON.stringify({
          userIds: Array.from(selectedUsers),
          action: action2,
          value
        })
      });
      if (res.error) throw new Error(res.error);
      setStatusDialog({
        isOpen: true,
        type: "success",
        title: "Start Execution",
        message: `Successfully updated ${selectedUsers.size} users.`
      });
      setSelectedUsers(/* @__PURE__ */ new Set());
      submit(searchParams);
    } catch (e) {
      const message = e instanceof Error ? e.message : "An error occurred";
      setStatusDialog({
        isOpen: true,
        type: "error",
        title: "Error",
        message
      });
    }
  };
  const handleCreateUser = async () => {
    if (!newUser.email || !newUser.firstName || !newUser.lastName) return;
    try {
      const token = await getToken();
      const res = await apiRequest("/admin/users", token, {
        method: "POST",
        body: JSON.stringify(newUser)
      });
      if (res.error) throw new Error(res.error);
      setStatusDialog({
        isOpen: true,
        type: "success",
        title: "User Created",
        message: "User created successfully."
      });
      setIsAddUserOpen(false);
      setNewUser({
        firstName: "",
        lastName: "",
        email: "",
        isPlatformAdmin: false,
        initialTenantId: "",
        initialRole: "student"
      });
      submit(searchParams);
    } catch (e) {
      const message = e instanceof Error ? e.message : "An error occurred";
      setStatusDialog({
        isOpen: true,
        type: "error",
        title: "Creation Failed",
        message
      });
    }
  };
  const handleConfirmImpersonate = async () => {
    if (!impersonateTargetId) return;
    try {
      const token = await getToken();
      const res = await apiRequest("/admin/impersonate", token, {
        method: "POST",
        body: JSON.stringify({
          targetUserId: impersonateTargetId
        })
      });
      if (res.error) throw new Error(res.error);
      if (res.token) {
        document.cookie = `__impersonate_token=${res.token}; path=/; max-age=3600; samesite=lax; secure`;
        const user = usersList.find((u) => u.id === impersonateTargetId);
        if (user && user.memberships && user.memberships.length > 0) {
          window.location.href = `/studio/${user.memberships[0].tenant.slug}`;
        } else {
          window.location.href = "/dashboard";
        }
      }
    } catch (e) {
      const message = e instanceof Error ? e.message : "An error occurred";
      setStatusDialog({
        isOpen: true,
        type: "error",
        title: "Impersonation Failed",
        message
      });
    } finally {
      setImpersonateTargetId(null);
    }
  };
  const handleImpersonate = (userId2) => {
    setImpersonateTargetId(userId2);
  };
  const handleDeleteUser = (user) => {
    setUserToDelete(user);
  };
  const handleConfirmDeleteUser = async () => {
    if (!userToDelete) return;
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/users/${userToDelete.id}`, token, {
        method: "DELETE"
      });
      if (res.error) throw new Error(res.error);
      submit(searchParams);
      setStatusDialog({
        isOpen: true,
        type: "success",
        title: "User Deleted",
        message: `User ${userToDelete.email} has been deleted.`
      });
    } catch (e) {
      const message = e instanceof Error ? e.message : "An error occurred";
      setStatusDialog({
        isOpen: true,
        type: "error",
        title: "Deletion Failed",
        message
      });
    } finally {
      setUserToDelete(null);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Global User Directory"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Manage all users across the platform."
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex gap-2",
        children: /* @__PURE__ */ jsxs(Button, {
          onClick: () => setIsAddUserOpen(true),
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsxs("svg", {
            xmlns: "http://www.w3.org/2000/svg",
            width: "16",
            height: "16",
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round",
            children: [/* @__PURE__ */ jsx("line", {
              x1: "12",
              y1: "5",
              x2: "12",
              y2: "19"
            }), /* @__PURE__ */ jsx("line", {
              x1: "5",
              y1: "12",
              x2: "19",
              y2: "12"
            })]
          }), "Add User"]
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex flex-col sm:flex-row gap-4 justify-between bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
      children: [/* @__PURE__ */ jsxs(Form, {
        onSubmit: handleSearch,
        className: "relative w-full sm:w-96",
        children: [/* @__PURE__ */ jsx(Input, {
          type: "search",
          name: "search",
          defaultValue: searchParams.get("search") || "",
          placeholder: "Search users...",
          className: "pl-10"
        }), /* @__PURE__ */ jsx("svg", {
          className: "absolute left-3 top-2.5 h-5 w-5 text-zinc-400",
          fill: "none",
          viewBox: "0 0 24 24",
          stroke: "currentColor",
          children: /* @__PURE__ */ jsx("path", {
            strokeLinecap: "round",
            strokeLinejoin: "round",
            strokeWidth: 2,
            d: "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          })
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-3",
        children: /* @__PURE__ */ jsxs("label", {
          className: "flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-300 font-medium cursor-pointer",
          children: [/* @__PURE__ */ jsx("input", {
            type: "checkbox",
            checked: groupByTenant,
            onChange: (e) => setGroupByTenant(e.target.checked),
            className: "rounded border-zinc-300 dark:border-zinc-600 text-zinc-900 focus:ring-zinc-900 dark:bg-zinc-700 h-4 w-4"
          }), "Group by Tenant"]
        })
      })]
    }), selectedUsers.size > 0 && /* @__PURE__ */ jsxs("div", {
      className: "fixed bottom-6 left-1/2 -translate-x-1/2 bg-zinc-900 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-6 z-50 animate-in slide-in-from-bottom-4",
      children: [/* @__PURE__ */ jsxs("span", {
        className: "font-medium",
        children: [selectedUsers.size, " users selected"]
      }), /* @__PURE__ */ jsx("div", {
        className: "h-4 w-px bg-zinc-700"
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-2",
        children: [/* @__PURE__ */ jsx("button", {
          onClick: () => executeBulk("set_role", "owner"),
          className: "hover:text-zinc-300 text-sm font-medium transition-colors",
          children: "Make Owner"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => executeBulk("set_role", "admin"),
          className: "hover:text-zinc-300 text-sm font-medium transition-colors",
          children: "Make Admin"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => executeBulk("set_role", "user"),
          className: "hover:text-zinc-300 text-sm font-medium transition-colors",
          children: "Demote"
        }), /* @__PURE__ */ jsx("div", {
          className: "w-px h-4 bg-zinc-700 mx-2"
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => {
            if (confirm(`Are you sure you want to PERMANENTLY delete ${selectedUsers.size} users?`)) {
              executeBulk("delete", true);
            }
          },
          className: "text-red-400 hover:text-red-300 text-sm font-medium transition-colors",
          children: "Delete Selected"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "grid grid-cols-12 gap-4 p-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider items-center",
        children: [/* @__PURE__ */ jsx("div", {
          className: "col-span-1 flex items-center justify-center",
          children: /* @__PURE__ */ jsx("input", {
            type: "checkbox",
            onChange: toggleSelectAll,
            checked: selectedUsers.size === usersList.length && usersList.length > 0,
            className: "rounded border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 h-4 w-4"
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "col-span-3 flex items-center gap-1 cursor-pointer hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",
          onClick: () => {
            const current = searchParams.get("sort");
            const newSort = current === "name_asc" ? "name_desc" : "name_asc";
            setSearchParams((prev) => {
              prev.set("sort", newSort);
              return prev;
            });
          },
          children: ["User ", searchParams.get("sort")?.includes("name") && (searchParams.get("sort")?.includes("desc") ? "â†“" : "â†‘")]
        }), /* @__PURE__ */ jsx("div", {
          className: "col-span-3",
          children: "Email"
        }), /* @__PURE__ */ jsx("div", {
          className: "col-span-2",
          children: "Role"
        }), /* @__PURE__ */ jsxs("div", {
          className: "col-span-2 flex items-center gap-1 cursor-pointer hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors",
          onClick: () => {
            const current = searchParams.get("sort");
            const newSort = current === "joined_asc" ? "joined_desc" : "joined_asc";
            setSearchParams((prev) => {
              prev.set("sort", newSort);
              return prev;
            });
          },
          children: ["Joined ", searchParams.get("sort")?.includes("joined") && (searchParams.get("sort")?.includes("desc") ? "â†“" : "â†‘")]
        }), /* @__PURE__ */ jsx("div", {
          className: "col-span-1 text-right",
          children: "Actions"
        })]
      }), groupByTenant && groupedData ? Object.entries(groupedData).map(([tId, group]) => /* @__PURE__ */ jsxs("div", {
        className: "border-b border-zinc-100 dark:border-zinc-800 last:border-0",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-3 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center gap-2 cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",
          onClick: () => toggleGroup(tId),
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-4 h-4 flex items-center justify-center text-zinc-400",
            children: expandedGroups.has(tId) ? "â–¼" : "â–¶"
          }), /* @__PURE__ */ jsx("span", {
            className: "font-semibold text-zinc-700 dark:text-zinc-300 text-sm",
            children: group.tenant.name
          }), /* @__PURE__ */ jsx("span", {
            className: "text-xs text-zinc-400 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 px-1.5 py-0.5 rounded-full",
            children: group.users.length
          })]
        }), expandedGroups.has(tId) && /* @__PURE__ */ jsx("div", {
          children: group.users.map((u) => /* @__PURE__ */ jsx(UserRow, {
            user: u,
            selected: selectedUsers.has(u.id),
            toggle: () => toggleUser(u.id),
            contextRole: u.contextRole,
            currentUserId: userId,
            showCheckbox: true
          }, `${u.id}-${tId}`))
        })]
      }, tId)) : usersList.map((user) => /* @__PURE__ */ jsx(UserRow, {
        user,
        selected: selectedUsers.has(user.id),
        toggle: () => toggleUser(user.id),
        showCheckbox: true,
        currentUserId: userId,
        onImpersonate: () => handleImpersonate(user.id),
        onDelete: () => handleDeleteUser(user)
      }, user.id)), usersList.length === 0 && /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500",
        children: "No users found matching your search."
      })]
    }), /* @__PURE__ */ jsx(Dialog, {
      open: isAddUserOpen,
      onOpenChange: setIsAddUserOpen,
      children: /* @__PURE__ */ jsxs(DialogContent, {
        children: [/* @__PURE__ */ jsxs(DialogHeader, {
          children: [/* @__PURE__ */ jsx(DialogTitle, {
            children: "Add New User"
          }), /* @__PURE__ */ jsx(DialogDescription, {
            children: "Create a new user profile manually."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4 py-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-4",
            children: [/* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx(Label, {
                children: "First Name"
              }), /* @__PURE__ */ jsx(Input, {
                value: newUser.firstName,
                onChange: (e) => setNewUser({
                  ...newUser,
                  firstName: e.target.value
                }),
                placeholder: "Jane"
              })]
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx(Label, {
                children: "Last Name"
              }), /* @__PURE__ */ jsx(Input, {
                value: newUser.lastName,
                onChange: (e) => setNewUser({
                  ...newUser,
                  lastName: e.target.value
                }),
                placeholder: "Doe"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx(Label, {
              children: "Email Address"
            }), /* @__PURE__ */ jsx(Input, {
              type: "email",
              value: newUser.email,
              onChange: (e) => setNewUser({
                ...newUser,
                email: e.target.value
              }),
              placeholder: "jane@example.com"
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "pt-2",
            children: /* @__PURE__ */ jsxs("label", {
              className: "flex items-center gap-2 text-sm text-zinc-700 dark:text-zinc-300 cursor-pointer",
              children: [/* @__PURE__ */ jsx("input", {
                type: "checkbox",
                checked: newUser.isPlatformAdmin,
                onChange: (e) => setNewUser({
                  ...newUser,
                  isPlatformAdmin: e.target.checked
                }),
                className: "rounded border-zinc-300"
              }), "Platform Administrator (Main Platform Access)"]
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "relative pt-4 before:content-['OR'] before:absolute before:top-2 before:left-1/2 before:-translate-x-1/2 before:bg-white dark:before:bg-zinc-900 before:px-2 before:text-xs before:text-zinc-400 border-t border-zinc-200 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3 mt-2",
              children: "Assign to Studio (Optional)"
            }), /* @__PURE__ */ jsxs("div", {
              className: "grid grid-cols-3 gap-2",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "col-span-2",
                children: [/* @__PURE__ */ jsx(Label, {
                  className: "text-xs text-zinc-500 dark:text-zinc-400 mb-1",
                  children: "Studio"
                }), /* @__PURE__ */ jsxs(Select, {
                  value: newUser.initialTenantId,
                  onChange: (e) => setNewUser({
                    ...newUser,
                    initialTenantId: e.target.value
                  }),
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "",
                    children: "-- None --"
                  }), tenants?.map((t) => /* @__PURE__ */ jsx("option", {
                    value: t.id,
                    children: t.name
                  }, t.id))]
                })]
              }), /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx(Label, {
                  className: "text-xs text-zinc-500 dark:text-zinc-400 mb-1",
                  children: "Role"
                }), /* @__PURE__ */ jsxs(Select, {
                  value: newUser.initialRole,
                  onChange: (e) => setNewUser({
                    ...newUser,
                    initialRole: e.target.value
                  }),
                  disabled: !newUser.initialTenantId,
                  children: [/* @__PURE__ */ jsx("option", {
                    value: "student",
                    children: "Student"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "instructor",
                    children: "Instructor"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "admin",
                    children: "Admin"
                  }), /* @__PURE__ */ jsx("option", {
                    value: "owner",
                    children: "Owner"
                  })]
                })]
              })]
            })]
          })]
        }), /* @__PURE__ */ jsxs(DialogFooter, {
          children: [/* @__PURE__ */ jsx(Button, {
            variant: "outline",
            onClick: () => setIsAddUserOpen(false),
            children: "Cancel"
          }), /* @__PURE__ */ jsx(Button, {
            onClick: handleCreateUser,
            disabled: !newUser.email || !newUser.firstName,
            children: "Create User"
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Dialog, {
      open: statusDialog.isOpen,
      onOpenChange: (open) => setStatusDialog({
        ...statusDialog,
        isOpen: open
      }),
      children: /* @__PURE__ */ jsxs(DialogContent, {
        children: [/* @__PURE__ */ jsx(DialogHeader, {
          children: /* @__PURE__ */ jsx(DialogTitle, {
            className: statusDialog.type === "error" ? "text-red-500" : "text-green-500",
            children: statusDialog.title || (statusDialog.type === "error" ? "Error" : "Success")
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "py-4 text-zinc-600 dark:text-zinc-300",
          children: statusDialog.message
        }), /* @__PURE__ */ jsx(DialogFooter, {
          children: /* @__PURE__ */ jsx(Button, {
            onClick: () => setStatusDialog({
              ...statusDialog,
              isOpen: false
            }),
            children: "Close"
          })
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmDialog, {
      open: !!userToDelete,
      onOpenChange: (open) => !open && setUserToDelete(null),
      onConfirm: handleConfirmDeleteUser,
      title: "Delete User",
      description: /* @__PURE__ */ jsxs(Fragment, {
        children: ["Are you sure you want to PERMANENTLY delete user ", /* @__PURE__ */ jsx("strong", {
          children: userToDelete?.email
        }), "? This cannot be undone."]
      }),
      confirmText: "Delete",
      variant: "destructive"
    }), /* @__PURE__ */ jsx(Dialog, {
      open: !!impersonateTargetId,
      onOpenChange: (open) => !open && setImpersonateTargetId(null),
      children: /* @__PURE__ */ jsxs(DialogContent, {
        children: [/* @__PURE__ */ jsxs(DialogHeader, {
          children: [/* @__PURE__ */ jsx(DialogTitle, {
            children: "Confirm Impersonation"
          }), /* @__PURE__ */ jsx(DialogDescription, {
            children: "You are about to sign in as another user. This action will be logged."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "py-4 text-zinc-600 dark:text-zinc-300",
          children: [/* @__PURE__ */ jsxs("p", {
            children: ["Are you sure you want to sign in as ", /* @__PURE__ */ jsx("strong", {
              children: usersList.find((u) => u.id === impersonateTargetId)?.email
            }), "?"]
          }), /* @__PURE__ */ jsx("p", {
            className: "mt-2 text-xs text-zinc-500",
            children: "You will need to log out to return to your admin account."
          })]
        }), /* @__PURE__ */ jsxs(DialogFooter, {
          children: [/* @__PURE__ */ jsx(Button, {
            variant: "outline",
            onClick: () => setImpersonateTargetId(null),
            children: "Cancel"
          }), /* @__PURE__ */ jsx(Button, {
            onClick: handleConfirmImpersonate,
            children: "Sign In as User"
          })]
        })]
      })
    })]
  });
});
function ClientDate({
  date
}) {
  const [formatted, setFormatted] = useState(null);
  useEffect(() => {
    if (!date) {
      setFormatted("Never");
      return;
    }
    setFormatted(new Date(date).toLocaleString());
  }, [date]);
  if (!formatted) return /* @__PURE__ */ jsx("span", {
    className: "text-zinc-300 animate-pulse",
    children: "..."
  });
  return /* @__PURE__ */ jsx("span", {
    children: formatted
  });
}
function ClientDateOnly({
  date
}) {
  const [formatted, setFormatted] = useState(null);
  useEffect(() => {
    setFormatted(new Date(date).toLocaleDateString());
  }, [date]);
  if (!formatted) return /* @__PURE__ */ jsx("span", {
    className: "text-zinc-300",
    children: "..."
  });
  return /* @__PURE__ */ jsx("span", {
    children: formatted
  });
}
function UserRow({
  user,
  selected,
  toggle,
  showCheckbox,
  currentUserId,
  contextRole,
  onImpersonate,
  onDelete
}) {
  let displayName = `${user.profile?.firstName || ""} ${user.profile?.lastName || ""}`.trim();
  if (user.email === "slichti@gmail.com" && displayName === "System Admin") {
    displayName = "Steven Lichti";
  }
  if (!displayName) displayName = user.email;
  return /* @__PURE__ */ jsxs("div", {
    className: `grid grid-cols-12 gap-4 p-4 border-b border-zinc-100 dark:border-zinc-800 items-center hover:bg-zinc-50 dark:hover:bg-zinc-800/30 transition-colors ${selected ? "bg-blue-50/50 dark:bg-blue-900/10" : ""}`,
    children: [/* @__PURE__ */ jsx("div", {
      className: "col-span-1 flex justify-center",
      children: showCheckbox ? /* @__PURE__ */ jsx("input", {
        type: "checkbox",
        className: "rounded border-zinc-300 dark:border-zinc-700 dark:bg-zinc-800 h-4 w-4",
        checked: selected,
        onChange: toggle
      }) : null
    }), /* @__PURE__ */ jsxs("div", {
      className: "col-span-3 font-medium text-zinc-900 dark:text-zinc-100 flex items-center gap-3",
      children: [/* @__PURE__ */ jsx("div", {
        className: "w-8 h-8 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold text-zinc-600 dark:text-zinc-300 overflow-hidden shrink-0",
        children: user.profile?.portraitUrl ? /* @__PURE__ */ jsx("img", {
          src: user.profile.portraitUrl,
          alt: "",
          className: "w-full h-full object-cover"
        }) : displayName[0] || "U"
      }), /* @__PURE__ */ jsxs("div", {
        className: "truncate min-w-0",
        children: [/* @__PURE__ */ jsx("div", {
          className: "truncate",
          children: displayName
        }), contextRole && /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-400 capitalize",
          children: contextRole
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "col-span-3 text-zinc-600 dark:text-zinc-400 text-sm truncate",
      title: user.email,
      children: user.email
    }), /* @__PURE__ */ jsx("div", {
      className: "col-span-2",
      children: user.role === "owner" ? /* @__PURE__ */ jsx("span", {
        className: "bg-amber-100 dark:bg-amber-900/50 text-amber-800 dark:text-amber-300 px-2 py-0.5 rounded text-xs font-bold border border-amber-200 dark:border-amber-800",
        children: "Owner"
      }) : user.role === "admin" || user.isPlatformAdmin === true ? /* @__PURE__ */ jsx("span", {
        className: "bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300 px-2 py-0.5 rounded text-xs font-bold",
        children: "Admin"
      }) : /* @__PURE__ */ jsx("span", {
        className: "text-zinc-400 dark:text-zinc-500 text-xs",
        children: "User"
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "col-span-2 text-zinc-400 dark:text-zinc-500 text-xs flex flex-col gap-0.5",
      children: [/* @__PURE__ */ jsx("span", {
        children: user.lastActiveAt ? /* @__PURE__ */ jsx(ClientDate, {
          date: user.lastActiveAt
        }) : "Never"
      }), /* @__PURE__ */ jsxs("span", {
        className: "text-zinc-300 dark:text-zinc-600 flex gap-1",
        children: ["Joined ", /* @__PURE__ */ jsx(ClientDateOnly, {
          date: user.createdAt
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "col-span-1",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex gap-3 justify-end items-center",
        children: [onImpersonate && !user.isPlatformAdmin && /* @__PURE__ */ jsx("button", {
          onClick: onImpersonate,
          className: "text-zinc-500 hover:text-zinc-900 text-sm font-medium flex items-center gap-1",
          title: "Login As",
          children: /* @__PURE__ */ jsxs("svg", {
            xmlns: "http://www.w3.org/2000/svg",
            width: "14",
            height: "14",
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round",
            children: [/* @__PURE__ */ jsx("path", {
              d: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
            }), /* @__PURE__ */ jsx("circle", {
              cx: "12",
              cy: "7",
              r: "4"
            })]
          })
        }), onDelete && user.id !== currentUserId && /* @__PURE__ */ jsx("button", {
          onClick: onDelete,
          className: "text-red-400 hover:text-red-700 text-sm font-medium flex items-center gap-1",
          title: "Delete User",
          children: /* @__PURE__ */ jsxs("svg", {
            xmlns: "http://www.w3.org/2000/svg",
            width: "14",
            height: "14",
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round",
            children: [/* @__PURE__ */ jsx("polyline", {
              points: "3 6 5 6 21 6"
            }), /* @__PURE__ */ jsx("path", {
              d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            })]
          })
        }), /* @__PURE__ */ jsx(Link, {
          to: `/admin/users/${user.id}`,
          className: "text-blue-600 hover:text-blue-800 text-sm font-medium",
          children: "Edit"
        })]
      })
    })]
  });
}
const route102 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_users__index,
  loader: loader$f
}, Symbol.toStringTag, { value: "Module" }));
function Badge({ children, variant = "default", className = "" }) {
  const variants = {
    default: "bg-zinc-900 text-white",
    success: "bg-emerald-100 text-emerald-700 border-emerald-200",
    warning: "bg-amber-100 text-amber-700 border-amber-200",
    error: "bg-red-100 text-red-700 border-red-200",
    outline: "bg-transparent border-zinc-200 text-zinc-600 border"
  };
  return /* @__PURE__ */ jsx("span", { className: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${variants[variant]} ${className}`, children });
}
const loader$e = async ({
  context
}) => {
  const env = context.cloudflare?.env || context.env || {};
  return {
    env: env.ENVIRONMENT || "production"
  };
};
const admin_diagnostics = UNSAFE_withComponentProps(function AdminDiagnostics() {
  const {
    env
  } = useLoaderData();
  const fetcher = useFetcher();
  const handleRun = async () => {
    fetcher.load("/admin/diagnostics/run");
  };
  const data = fetcher.data;
  const isLoading = fetcher.state === "loading";
  return /* @__PURE__ */ jsxs("div", {
    className: "container mx-auto py-10 space-y-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-3xl font-bold tracking-tight",
          children: "System Diagnostics"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-muted-foreground mt-2",
          children: "Real-time health checks and integration status."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: handleRun,
        disabled: isLoading,
        className: "inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-zinc-900 text-white hover:bg-zinc-900/90 h-11 px-8",
        children: [isLoading ? /* @__PURE__ */ jsx(Activity, {
          className: "mr-2 h-4 w-4 animate-spin"
        }) : /* @__PURE__ */ jsx(Activity, {
          className: "mr-2 h-4 w-4"
        }), "Run Diagnostics"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid gap-6 md:grid-cols-3",
      children: [/* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          className: "flex flex-row items-center justify-between space-y-0 pb-2",
          children: [/* @__PURE__ */ jsx(CardTitle, {
            className: "text-sm font-medium",
            children: "Environment"
          }), /* @__PURE__ */ jsx(Server, {
            className: "h-4 w-4 text-muted-foreground"
          })]
        }), /* @__PURE__ */ jsxs(CardContent, {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold capitalize",
            children: env
          }), /* @__PURE__ */ jsx("p", {
            className: "text-xs text-muted-foreground",
            children: "Running on Cloudflare Workers"
          })]
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          className: "flex flex-row items-center justify-between space-y-0 pb-2",
          children: [/* @__PURE__ */ jsx(CardTitle, {
            className: "text-sm font-medium",
            children: "Database Latency"
          }), /* @__PURE__ */ jsx(Database, {
            className: "h-4 w-4 text-muted-foreground"
          })]
        }), /* @__PURE__ */ jsx(CardContent, {
          children: data?.latency ? /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "text-2xl font-bold",
              children: [data.latency.database_read_ms || data.latency.database_ms, "ms"]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-muted-foreground",
              children: "Read check to D1"
            })]
          }) : /* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-muted-foreground",
            children: "-"
          })
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          className: "flex flex-row items-center justify-between space-y-0 pb-2",
          children: [/* @__PURE__ */ jsx(CardTitle, {
            className: "text-sm font-medium",
            children: "System Status"
          }), /* @__PURE__ */ jsx(ShieldCheck, {
            className: "h-4 w-4 text-muted-foreground"
          })]
        }), /* @__PURE__ */ jsx(CardContent, {
          children: data ? /* @__PURE__ */ jsx("div", {
            className: "flex items-center space-x-2",
            children: data.status === "ok" ? /* @__PURE__ */ jsx(Badge, {
              variant: "default",
              className: "bg-green-600 hover:bg-green-700",
              children: "Operational"
            }) : /* @__PURE__ */ jsx(Badge, {
              variant: "error",
              children: "Degraded"
            })
          }) : /* @__PURE__ */ jsx("div", {
            className: "text-2xl font-bold text-muted-foreground",
            children: "-"
          })
        })]
      })]
    }), data?.integrations && /* @__PURE__ */ jsxs(Card$1, {
      children: [/* @__PURE__ */ jsxs(CardHeader, {
        children: [/* @__PURE__ */ jsx(CardTitle, {
          children: "Integrations"
        }), /* @__PURE__ */ jsx(CardDescription, {
          children: "Status of third-party connections"
        })]
      }), /* @__PURE__ */ jsx(CardContent, {
        children: /* @__PURE__ */ jsx("div", {
          className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",
          children: Object.entries(data.integrations).map(([key, connected]) => /* @__PURE__ */ jsxs("div", {
            className: "flex items-center justify-between p-4 border rounded-lg",
            children: [/* @__PURE__ */ jsx("span", {
              className: "capitalize font-medium",
              children: key.replace("_", " ")
            }), connected ? /* @__PURE__ */ jsx(CheckCircle, {
              className: "h-5 w-5 text-green-500"
            }) : /* @__PURE__ */ jsx(XCircle, {
              className: "h-5 w-5 text-red-500"
            })]
          }, key))
        })
      })]
    }), data?.worker && /* @__PURE__ */ jsxs("div", {
      className: "grid gap-6 md:grid-cols-2",
      children: [/* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsx(CardTitle, {
            children: "Worker Performance"
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "Edge execution details"
          })]
        }), /* @__PURE__ */ jsxs(CardContent, {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium",
              children: "Memory Usage"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-mono text-sm",
              children: [data.worker.memory_used_mb, " MB"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium",
              children: "PoP (Point of Presence)"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-mono text-sm",
              children: data.worker.colo
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium",
              children: "Region"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-mono text-sm",
              children: [data.worker.city, ", ", data.worker.country]
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs(Card$1, {
        children: [/* @__PURE__ */ jsxs(CardHeader, {
          children: [/* @__PURE__ */ jsx(CardTitle, {
            children: "Database Performance"
          }), /* @__PURE__ */ jsx(CardDescription, {
            children: "D1 Read/Write Latency"
          })]
        }), /* @__PURE__ */ jsxs(CardContent, {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium",
              children: "Read Latency"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-mono text-sm",
              children: [data.latency?.database_read_ms, " ms"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-sm font-medium",
              children: "Query Latency (Write/Mixed)"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-mono text-sm",
              children: [data.latency?.database_query_ms, " ms"]
            })]
          })]
        })]
      })]
    }), data?.clientErrors && /* @__PURE__ */ jsxs(Card$1, {
      children: [/* @__PURE__ */ jsxs(CardHeader, {
        children: [/* @__PURE__ */ jsxs(CardTitle, {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Clock, {
            className: "h-4 w-4"
          }), "Recent Client Errors (Telemetry)"]
        }), /* @__PURE__ */ jsx(CardDescription, {
          children: "Errors reported by user browsers"
        })]
      }), /* @__PURE__ */ jsx(CardContent, {
        children: /* @__PURE__ */ jsx("div", {
          className: "space-y-4",
          children: data.clientErrors.length > 0 ? data.clientErrors.map((err) => /* @__PURE__ */ jsxs("div", {
            className: "flex flex-col gap-1 border-b pb-3 last:border-0 last:pb-0",
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-start",
              children: [/* @__PURE__ */ jsx("span", {
                className: "text-sm font-medium text-red-600 truncate max-w-[60%]",
                children: err.details?.message || "Unknown Error"
              }), /* @__PURE__ */ jsx("span", {
                className: "text-xs text-muted-foreground whitespace-nowrap",
                children: new Date(err.createdAt).toLocaleString()
              })]
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-center text-xs text-muted-foreground",
              children: [/* @__PURE__ */ jsx("span", {
                className: "truncate max-w-[70%]",
                children: err.details?.url || "Unknown URL"
              }), /* @__PURE__ */ jsx("span", {
                children: err.ip || "Unknown IP"
              })]
            })]
          }, err.id)) : /* @__PURE__ */ jsx("div", {
            className: "text-sm text-muted-foreground text-center py-4",
            children: "No recent client-side errors reported."
          })
        })
      })]
    })]
  });
});
const route103 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_diagnostics,
  loader: loader$e
}, Symbol.toStringTag, { value: "Module" }));
const loader$d = async (args) => {
  const {
    userId,
    getToken
  } = await getAuth(args);
  if (!userId) return {
    error: "Unauthorized",
    status: 401
  };
  const token = await getToken();
  const env = args.context.cloudflare?.env || args.context.env || {};
  const API_URL2 = env.VITE_API_URL || env.API_URL || "https://studio-platform-api.slichti.workers.dev";
  const traceId = args.request.headers.get("x-request-id") || crypto.randomUUID();
  try {
    const res = await fetch(`${API_URL2}/diagnostics`, {
      headers: {
        "Authorization": `Bearer ${token}`,
        "x-request-id": traceId
      }
    });
    if (!res.ok) {
      const text = await res.text();
      return {
        error: `API Error: ${res.status}`,
        details: text,
        status: res.status
      };
    }
    const data = await res.json();
    return data;
  } catch (error) {
    return {
      error: "Failed to fetch diagnostics",
      message: error.message,
      status: 500
    };
  }
};
const route104 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  loader: loader$d
}, Symbol.toStringTag, { value: "Module" }));
const admin_projections = UNSAFE_withComponentProps(function AdminProjections() {
  const [tenants, setTenants] = useState(50);
  const [growthRate, setGrowthRate] = useState(5);
  const [tierBasicPrice, setTierBasicPrice] = useState(29);
  const [tierGrowthPrice, setTierGrowthPrice] = useState(79);
  const [tierScalePrice, setTierScalePrice] = useState(149);
  const [mixBasic, setMixBasic] = useState(60);
  const [mixGrowth, setMixGrowth] = useState(30);
  const [avgVol, setAvgVol] = useState(5e3);
  const [platformFee, setPlatformFee] = useState(1);
  const [avgClassesPerMonth, setAvgClassesPerMonth] = useState(60);
  const [ownerMix, setOwnerMix] = useState(40);
  const [instructorRate, setInstructorRate] = useState(30);
  const [requestsPerMonth, setRequestsPerMonth] = useState(5e5);
  const [storageGB, setStorageGB] = useState(10);
  const [streamMinutes, setStreamMinutes] = useState(100);
  const [avgViewers, setAvgViewers] = useState(3);
  const [emailVol, setEmailVol] = useState(2500);
  const [smsVol, setSmsVol] = useState(200);
  const [useR2, setUseR2] = useState(true);
  const [useStream, setUseStream] = useState(true);
  const [useWorkers, setUseWorkers] = useState(true);
  const [useComms, setUseComms] = useState(true);
  const [viralMode, setViralMode] = useState(false);
  const COSTS = {
    WORKERS_REQ_PRICE: 0.3 / 1e6,
    WORKERS_BASE: 5,
    R2_STORAGE_GB: 0.015,
    STREAM_STORAGE_MIN: 5e-3,
    // $5 per 1000 mins stored
    STREAM_DELIVERY_MIN: 1e-3,
    // $1 per 1000 mins viewed
    EMAIL_COST: 6e-4,
    // $0.60 per 1000 emails (Resend)
    SMS_COST: 79e-4
    // $0.0079 per segment (Twilio)
  };
  const mixScale = Math.max(0, 100 - mixBasic - mixGrowth);
  const weightedAvgFee = (tierBasicPrice * mixBasic + tierGrowthPrice * mixGrowth + tierScalePrice * mixScale) / 100;
  const projectionData = useMemo(() => {
    const data = [];
    let currentTenants = tenants;
    const effectiveGrowth = viralMode ? 20 : growthRate;
    for (let month = 0; month < 12; month++) {
      const saasRevenue = currentTenants * weightedAvgFee;
      const tranxRevenue = currentTenants * avgVol * (platformFee / 100);
      const totalRevenue = saasRevenue + tranxRevenue;
      const workerCost = useWorkers ? Math.max(COSTS.WORKERS_BASE, currentTenants * requestsPerMonth * COSTS.WORKERS_REQ_PRICE) : 0;
      const r2Cost = useR2 ? currentTenants * storageGB * COSTS.R2_STORAGE_GB : 0;
      const streamCost = useStream ? currentTenants * (streamMinutes * COSTS.STREAM_STORAGE_MIN + streamMinutes * avgViewers * COSTS.STREAM_DELIVERY_MIN) : 0;
      const commsCost = useComms ? currentTenants * (emailVol * COSTS.EMAIL_COST + smsVol * COSTS.SMS_COST) : 0;
      const totalInfraCost = workerCost + r2Cost + streamCost + commsCost;
      const platformProfit = totalRevenue - totalInfraCost;
      const margin = totalRevenue > 0 ? platformProfit / totalRevenue * 100 : 0;
      const tenantGross = avgVol;
      const tenantStripeFee = avgVol * 0.029;
      const tenantSaasCost = weightedAvgFee;
      const hiredClasses = avgClassesPerMonth * ((100 - ownerMix) / 100);
      const tenantInstructorCost = hiredClasses * instructorRate;
      const tenantExpenses = tenantStripeFee + tenantSaasCost + tenantInstructorCost;
      const tenantNet = tenantGross - tenantExpenses;
      data.push({
        name: `Month ${month + 1}`,
        tenants: Math.round(currentTenants),
        revenue: totalRevenue,
        infraCost: totalInfraCost,
        profit: platformProfit,
        workerCost,
        r2Cost,
        streamCost,
        commsCost,
        margin,
        tenantNet
      });
      currentTenants = currentTenants * (1 + effectiveGrowth / 100);
    }
    return data;
  }, [tenants, avgVol, platformFee, growthRate, tierBasicPrice, tierGrowthPrice, tierScalePrice, mixBasic, mixGrowth, storageGB, streamMinutes, avgViewers, requestsPerMonth, emailVol, smsVol, useR2, useStream, useWorkers, useComms, viralMode, avgClassesPerMonth, ownerMix, instructorRate]);
  const finalMonth = projectionData[11];
  const totalARR = finalMonth.revenue * 12;
  projectionData.find((d) => d.profit > 0)?.name || "N/A";
  const costBreakdown = [{
    name: "Workers",
    value: finalMonth.workerCost,
    color: "#F59E0B"
  }, {
    name: "R2 Storage",
    value: finalMonth.r2Cost,
    color: "#3B82F6"
  }, {
    name: "Stream",
    value: finalMonth.streamCost,
    color: "#EF4444"
  }, {
    name: "Comms",
    value: finalMonth.commsCost,
    color: "#10B981"
  }].filter((i) => i.value > 0);
  const formatCurrency = (val) => new Intl.NumberFormat("en-US", {
    style: "currency",
    currency: "USD",
    maximumFractionDigits: 0
  }).format(val);
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500 pb-20",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex flex-col md:flex-row md:items-center justify-between gap-4",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsxs("h1", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100 tracking-tight flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(TrendingUp, {
            className: "text-indigo-600"
          }), "Platform Projections"]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mt-1",
          children: "SaaS margins and Unit Economics simulator."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setViralMode(!viralMode),
        className: `px-4 py-2 rounded-lg font-bold text-sm shadow-sm transition-all flex items-center gap-2
                        ${viralMode ? "bg-purple-600 text-white shadow-purple-500/50 scale-105 animate-pulse" : "bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700"}`,
        children: [/* @__PURE__ */ jsx(Zap, {
          size: 16,
          className: viralMode ? "fill-current" : ""
        }), viralMode ? "VIRAL MODE ACTIVE" : "Activate Viral Mode"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-4 gap-4",
      children: [/* @__PURE__ */ jsx(MetricCard, {
        label: "Proj. Annual Revenue (ARR)",
        value: formatCurrency(totalARR),
        sub: `End of Year 1 (${Math.round(finalMonth.tenants)} Tenants)`,
        color: "text-emerald-600 dark:text-emerald-400"
      }), /* @__PURE__ */ jsx(MetricCard, {
        label: "Monthly Profit (Month 12)",
        value: formatCurrency(finalMonth.profit),
        sub: `${finalMonth.margin.toFixed(1)}% Margin`,
        color: finalMonth.profit > 0 ? "text-indigo-600 dark:text-indigo-400" : "text-red-600 dark:text-red-400"
      }), /* @__PURE__ */ jsx(MetricCard, {
        label: "Avg Revenue Per Tenant",
        value: formatCurrency(weightedAvgFee),
        sub: `Weighted Avg (Mix)`,
        color: "text-zinc-900 dark:text-zinc-100"
      }), /* @__PURE__ */ jsx(MetricCard, {
        label: "Avg Tenant Net (Monthly)",
        value: formatCurrency(finalMonth.tenantNet),
        sub: "After Fees & Expenses",
        color: "text-amber-600 dark:text-amber-400"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-3 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "space-y-6",
        children: [/* @__PURE__ */ jsxs(Card, {
          title: "Growth & Revenue",
          children: [/* @__PURE__ */ jsx(Control, {
            label: "Starting Tenants",
            val: tenants,
            set: setTenants,
            min: 0,
            max: 1e3,
            step: 10
          }), /* @__PURE__ */ jsx(Control, {
            label: "Growth Rate (%)",
            val: growthRate,
            set: setGrowthRate,
            min: 0,
            max: 100,
            disabled: viralMode
          }), /* @__PURE__ */ jsx(Control, {
            label: "Avg Monthly GMV ($)",
            val: avgVol,
            set: setAvgVol,
            min: 0,
            max: 5e4,
            step: 500
          }), /* @__PURE__ */ jsx(Control, {
            label: "Platform Fee (%)",
            val: platformFee,
            set: setPlatformFee,
            min: 0,
            max: 10,
            step: 0.1
          })]
        }), /* @__PURE__ */ jsxs(Card, {
          title: "Pricing Strategy",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-3 gap-2 mb-4 text-center text-xs font-medium text-zinc-500 dark:text-zinc-400",
            children: [/* @__PURE__ */ jsx("div", {
              children: "Basic"
            }), /* @__PURE__ */ jsx("div", {
              children: "Growth"
            }), /* @__PURE__ */ jsx("div", {
              children: "Scale"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-3 gap-2 mb-6",
            children: [/* @__PURE__ */ jsx("input", {
              type: "number",
              value: tierBasicPrice,
              onChange: (e) => setTierBasicPrice(Number(e.target.value)),
              className: "w-full text-center border rounded py-1 dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              "data-lpignore": "true"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              value: tierGrowthPrice,
              onChange: (e) => setTierGrowthPrice(Number(e.target.value)),
              className: "w-full text-center border rounded py-1 dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              "data-lpignore": "true"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              value: tierScalePrice,
              onChange: (e) => setTierScalePrice(Number(e.target.value)),
              className: "w-full text-center border rounded py-1 dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",
              "data-lpignore": "true"
            })]
          }), /* @__PURE__ */ jsx("label", {
            className: "text-xs font-bold text-zinc-900 dark:text-zinc-100 uppercase",
            children: "Tier Mix"
          }), /* @__PURE__ */ jsx(Control, {
            label: "Basic %",
            val: mixBasic,
            set: setMixBasic,
            min: 0,
            max: 100
          }), /* @__PURE__ */ jsx(Control, {
            label: "Growth %",
            val: mixGrowth,
            set: setMixGrowth,
            min: 0,
            max: 100
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between items-center text-sm py-2 px-3 bg-zinc-50 dark:bg-zinc-900 rounded border border-zinc-100 dark:border-zinc-700 mt-2",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "Scale % (Remainder)"
            }), /* @__PURE__ */ jsxs("span", {
              className: "font-mono font-bold text-zinc-900 dark:text-zinc-100",
              children: [mixScale, "%"]
            })]
          })]
        }), /* @__PURE__ */ jsxs(Card, {
          title: "Tenant Economics",
          children: [/* @__PURE__ */ jsx(Control, {
            label: "Classes / Month",
            val: avgClassesPerMonth,
            set: setAvgClassesPerMonth,
            min: 0,
            max: 300
          }), /* @__PURE__ */ jsx(Control, {
            label: "Instructor Hourly ($)",
            val: instructorRate,
            set: setInstructorRate,
            min: 15,
            max: 100
          }), /* @__PURE__ */ jsx(Control, {
            label: "Owner Taught %",
            val: ownerMix,
            set: setOwnerMix,
            min: 0,
            max: 100
          })]
        }), /* @__PURE__ */ jsxs(Card, {
          title: "Infrastructure Costs",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "grid grid-cols-2 gap-2 mb-4",
            children: [/* @__PURE__ */ jsx(Toggle, {
              label: "Workers",
              checked: useWorkers,
              set: setUseWorkers
            }), /* @__PURE__ */ jsx(Toggle, {
              label: "R2 Storage",
              checked: useR2,
              set: setUseR2
            }), /* @__PURE__ */ jsx(Toggle, {
              label: "Stream VOD",
              checked: useStream,
              set: setUseStream
            }), /* @__PURE__ */ jsx(Toggle, {
              label: "Email/SMS",
              checked: useComms,
              set: setUseComms
            })]
          }), /* @__PURE__ */ jsx(Control, {
            label: "Requests (M)",
            val: requestsPerMonth / 1e6,
            set: (v) => setRequestsPerMonth(v * 1e6),
            step: 0.1,
            min: 0,
            max: 50,
            disabled: !useWorkers
          }), /* @__PURE__ */ jsx(Control, {
            label: "Storage (GB)",
            val: storageGB,
            set: setStorageGB,
            min: 0,
            max: 1e3,
            disabled: !useR2
          }), /* @__PURE__ */ jsxs("div", {
            className: "my-4 pt-4 border-t border-zinc-100 dark:border-zinc-700 space-y-4",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "text-xs font-bold text-zinc-900 dark:text-zinc-100 uppercase tracking-wide mb-2",
              children: "Streaming"
            }), /* @__PURE__ */ jsx(Control, {
              label: "Mins Stored",
              val: streamMinutes,
              set: setStreamMinutes,
              min: 0,
              max: 5e3,
              disabled: !useStream
            }), /* @__PURE__ */ jsx(Control, {
              label: "Viewers/Min",
              val: avgViewers,
              set: setAvgViewers,
              min: 1,
              max: 50,
              disabled: !useStream
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "my-4 pt-4 border-t border-zinc-100 dark:border-zinc-700 space-y-4",
            children: [/* @__PURE__ */ jsx("h4", {
              className: "text-xs font-bold text-zinc-900 dark:text-zinc-100 uppercase tracking-wide mb-2",
              children: "Communications"
            }), /* @__PURE__ */ jsx(Control, {
              label: "Emails / Mo",
              val: emailVol,
              set: setEmailVol,
              min: 0,
              max: 5e4,
              step: 100,
              disabled: !useComms
            }), /* @__PURE__ */ jsx(Control, {
              label: "SMS / Mo",
              val: smsVol,
              set: setSmsVol,
              min: 0,
              max: 5e3,
              step: 50,
              disabled: !useComms
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 p-4 rounded-xl text-sm opacity-80",
          children: [/* @__PURE__ */ jsxs("p", {
            className: "flex items-center gap-2 font-bold mb-1",
            children: [/* @__PURE__ */ jsx(Info, {
              size: 14
            }), " Unit Costs:"]
          }), /* @__PURE__ */ jsxs("ul", {
            className: "grid grid-cols-2 gap-x-4 gap-y-1 text-xs list-disc list-inside",
            children: [/* @__PURE__ */ jsx("li", {
              children: "Request: $0.30 / M"
            }), /* @__PURE__ */ jsx("li", {
              children: "R2: $0.015 / GB"
            }), /* @__PURE__ */ jsx("li", {
              children: "Stream Store: $0.005"
            }), /* @__PURE__ */ jsx("li", {
              children: "Stream View: $0.001"
            }), /* @__PURE__ */ jsx("li", {
              children: "Email: $0.60 / k"
            }), /* @__PURE__ */ jsx("li", {
              children: "SMS: $0.0079 / msg"
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "lg:col-span-2 space-y-8",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-[400px]",
          children: [/* @__PURE__ */ jsx("h3", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4",
            children: "Projected Profit vs. Cost"
          }), /* @__PURE__ */ jsx(ResponsiveContainer, {
            width: "100%",
            height: "100%",
            children: /* @__PURE__ */ jsxs(AreaChart, {
              data: projectionData,
              children: [/* @__PURE__ */ jsxs("defs", {
                children: [/* @__PURE__ */ jsxs("linearGradient", {
                  id: "colorRevenue",
                  x1: "0",
                  y1: "0",
                  x2: "0",
                  y2: "1",
                  children: [/* @__PURE__ */ jsx("stop", {
                    offset: "5%",
                    stopColor: "#10B981",
                    stopOpacity: 0.1
                  }), /* @__PURE__ */ jsx("stop", {
                    offset: "95%",
                    stopColor: "#10B981",
                    stopOpacity: 0
                  })]
                }), /* @__PURE__ */ jsxs("linearGradient", {
                  id: "colorCost",
                  x1: "0",
                  y1: "0",
                  x2: "0",
                  y2: "1",
                  children: [/* @__PURE__ */ jsx("stop", {
                    offset: "5%",
                    stopColor: "#EF4444",
                    stopOpacity: 0.1
                  }), /* @__PURE__ */ jsx("stop", {
                    offset: "95%",
                    stopColor: "#EF4444",
                    stopOpacity: 0
                  })]
                })]
              }), /* @__PURE__ */ jsx(CartesianGrid, {
                strokeDasharray: "3 3",
                vertical: false,
                stroke: "#E4E4E7"
              }), /* @__PURE__ */ jsx(XAxis, {
                dataKey: "name",
                fontSize: 12,
                stroke: "#71717A"
              }), /* @__PURE__ */ jsx(YAxis, {
                fontSize: 12,
                stroke: "#71717A",
                tickFormatter: (val) => `$${val / 1e3}k`
              }), /* @__PURE__ */ jsx(Tooltip, {
                formatter: (value) => formatCurrency(Number(value) || 0),
                contentStyle: {
                  borderRadius: "8px",
                  border: "none",
                  boxShadow: "0 4px 6px -1px rgb(0 0 0 / 0.1)",
                  backgroundColor: "#18181b",
                  color: "#fff"
                }
              }), /* @__PURE__ */ jsx(Area, {
                type: "monotone",
                dataKey: "revenue",
                stroke: "#10B981",
                strokeWidth: 2,
                fillOpacity: 1,
                fill: "url(#colorRevenue)",
                name: "Revenue"
              }), /* @__PURE__ */ jsx(Area, {
                type: "monotone",
                dataKey: "infraCost",
                stroke: "#EF4444",
                strokeWidth: 2,
                fillOpacity: 1,
                fill: "url(#colorCost)",
                name: "Infra Cost"
              }), /* @__PURE__ */ jsx(ReferenceLine, {
                y: 0,
                stroke: "#000"
              })]
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-1 md:grid-cols-2 gap-8",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-[300px] flex flex-col",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4",
              children: "Infra Cost Breakdown"
            }), costBreakdown.length > 0 ? /* @__PURE__ */ jsxs("div", {
              className: "flex-1 flex text-xs",
              children: [/* @__PURE__ */ jsx(ResponsiveContainer, {
                width: "60%",
                children: /* @__PURE__ */ jsxs(PieChart, {
                  children: [/* @__PURE__ */ jsx(Pie, {
                    data: costBreakdown,
                    cx: "50%",
                    cy: "50%",
                    innerRadius: 40,
                    outerRadius: 80,
                    paddingAngle: 5,
                    dataKey: "value",
                    children: costBreakdown.map((entry2, index) => /* @__PURE__ */ jsx(Cell, {
                      fill: entry2.color
                    }, `cell-${index}`))
                  }), /* @__PURE__ */ jsx(Tooltip, {
                    formatter: (val) => formatCurrency(Number(val) || 0)
                  })]
                })
              }), /* @__PURE__ */ jsx("div", {
                className: "flex flex-col justify-center space-y-2",
                children: costBreakdown.map((item) => /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-2",
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "w-3 h-3 rounded-full",
                    style: {
                      backgroundColor: item.color
                    }
                  }), /* @__PURE__ */ jsx("span", {
                    children: item.name
                  })]
                }, item.name))
              })]
            }) : /* @__PURE__ */ jsx("div", {
              className: "flex-1 flex items-center justify-center text-zinc-400",
              children: "No Costs Selected"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-[300px]",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-bold text-zinc-900 dark:text-zinc-100 mb-4",
              children: "Avg Tenant Profit History"
            }), /* @__PURE__ */ jsx(ResponsiveContainer, {
              width: "100%",
              height: "100%",
              children: /* @__PURE__ */ jsxs(AreaChart, {
                data: projectionData,
                children: [/* @__PURE__ */ jsx(CartesianGrid, {
                  strokeDasharray: "3 3",
                  vertical: false
                }), /* @__PURE__ */ jsx(XAxis, {
                  dataKey: "name",
                  hide: true
                }), /* @__PURE__ */ jsx(YAxis, {
                  hide: true
                }), /* @__PURE__ */ jsx(Tooltip, {
                  formatter: (val) => formatCurrency(Number(val) || 0)
                }), /* @__PURE__ */ jsx(Area, {
                  type: "monotone",
                  dataKey: "tenantNet",
                  stroke: "#F59E0B",
                  fill: "#FEF3C7",
                  strokeWidth: 3
                })]
              })
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-400 text-center mt-2",
              children: "* Simulates single studio profit after fees & payroll"
            })]
          })]
        })]
      })]
    })]
  });
});
function MetricCard({
  label,
  value,
  sub,
  color
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
    children: [/* @__PURE__ */ jsx("h4", {
      className: "text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",
      children: label
    }), /* @__PURE__ */ jsx("div", {
      className: `text-3xl font-bold tracking-tight ${color}`,
      children: value
    }), /* @__PURE__ */ jsx("div", {
      className: "text-xs text-zinc-400 dark:text-zinc-500 mt-2",
      children: sub
    })]
  });
}
function Card({
  title,
  children
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: "bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
    children: [/* @__PURE__ */ jsxs("h3", {
      className: "font-bold text-zinc-900 dark:text-zinc-100 mb-6 flex items-center gap-2",
      children: [/* @__PURE__ */ jsx(Activity, {
        size: 18,
        className: "text-zinc-400"
      }), title]
    }), /* @__PURE__ */ jsx("div", {
      className: "space-y-4",
      children
    })]
  });
}
function Control({
  label,
  val,
  set,
  step = 1,
  min = 0,
  max = 100,
  disabled
}) {
  return /* @__PURE__ */ jsxs("div", {
    className: `space-y-2 ${disabled ? "opacity-50 pointer-events-none" : ""}`,
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center",
      children: [/* @__PURE__ */ jsx("label", {
        className: "text-sm font-medium text-zinc-700 dark:text-zinc-300",
        children: label
      }), /* @__PURE__ */ jsx("input", {
        type: "number",
        step,
        value: val,
        onChange: (e) => set(parseFloat(e.target.value) || 0),
        className: "w-24 text-right px-2 py-1 border border-zinc-300 dark:border-zinc-700 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none font-mono bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
        "data-lpignore": "true",
        "data-1p-ignore": "true",
        "data-bwignore": "true",
        autoComplete: "off",
        name: `field_stat_${Math.floor(Math.random() * 1e4)}`,
        id: `field_stat_${Math.floor(Math.random() * 1e4)}`
      })]
    }), /* @__PURE__ */ jsx("input", {
      type: "range",
      min,
      max,
      step,
      value: val,
      onChange: (e) => set(parseFloat(e.target.value) || 0),
      className: "w-full accent-indigo-600 h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-lg appearance-none cursor-pointer"
    })]
  });
}
function Toggle({
  label,
  checked,
  set
}) {
  return /* @__PURE__ */ jsxs("button", {
    onClick: () => set(!checked),
    className: `flex items-center justify-between p-2 rounded-lg border transition-all w-full text-xs ${checked ? "bg-indigo-50 dark:bg-indigo-900/30 border-indigo-200 dark:border-indigo-800 text-indigo-900 dark:text-indigo-200" : "bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-500 dark:text-zinc-400"}`,
    children: [/* @__PURE__ */ jsx("span", {
      className: "font-medium",
      children: label
    }), /* @__PURE__ */ jsx("div", {
      className: `w-6 h-3 rounded-full relative transition-colors ${checked ? "bg-indigo-500" : "bg-zinc-300"}`,
      children: /* @__PURE__ */ jsx("div", {
        className: `absolute top-0.5 w-2 h-2 rounded-full bg-white transition-transform ${checked ? "left-3.5" : "left-0.5"}`
      })
    })]
  });
}
const route105 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_projections
}, Symbol.toStringTag, { value: "Module" }));
const loader$c = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const preview = await apiRequest("/admin/billing/preview", token);
    return {
      preview,
      token
    };
  } catch (e) {
    return {
      error: e.message,
      token
    };
  }
};
const admin_financials = UNSAFE_withComponentProps(function AdminFinancials() {
  const {
    preview: initialPreview,
    error: loadError,
    token
  } = useLoaderData();
  const [preview, setPreview] = useState(initialPreview);
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);
  const [showInvoiceConfirm, setShowInvoiceConfirm] = useState(false);
  const [showError, setShowError] = useState({
    isOpen: false,
    message: ""
  });
  const refreshPreview = async () => {
    setLoading(true);
    try {
      const res = await apiRequest("/admin/billing/preview", token);
      setPreview(res);
      setResult(null);
    } catch (e) {
      console.error(e);
    } finally {
      setLoading(false);
    }
  };
  const handleCharge = async () => {
    setShowInvoiceConfirm(false);
    setLoading(true);
    try {
      const res = await apiRequest("/admin/billing/charge", token, {
        method: "POST"
      });
      setResult(res);
      setTimeout(refreshPreview, 1e3);
    } catch (e) {
      setShowError({
        isOpen: true,
        message: "Charge failed: " + e.message
      });
    } finally {
      setLoading(false);
    }
  };
  const tenants = preview?.tenants || [];
  const totalRevenue = tenants.reduce((acc, t) => acc + t.total, 0).toFixed(2);
  const fees = preview?.fees || {
    sms: 75e-4,
    email: 6e-4,
    streaming: 0.05,
    storage: 0.02
  };
  if (loadError) return /* @__PURE__ */ jsxs("div", {
    className: "p-8 text-red-600",
    children: ["Error loading billing data: ", loadError]
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-6xl mx-auto pb-20 dark:text-zinc-100",
    children: [/* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: showInvoiceConfirm,
      onClose: () => setShowInvoiceConfirm(false),
      onConfirm: handleCharge,
      title: "Confirm Invoicing",
      message: `Are you sure you want to invoice ${tenants.length} tenants for a total of $${totalRevenue}?`,
      confirmText: "Invoice Tenants"
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: showError.isOpen,
      onClose: () => setShowError({
        ...showError,
        isOpen: false
      }),
      message: showError.message
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Financials & Chargebacks"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Review usage and invoice tenants for subscriptions and overages."
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex gap-3",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: refreshPreview,
          disabled: loading,
          className: "px-4 py-2 border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-300 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(RefreshCw, {
            size: 16,
            className: loading ? "animate-spin" : ""
          }), "Refresh Preview"]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setShowInvoiceConfirm(true),
          disabled: loading || tenants.length === 0,
          className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",
          children: [/* @__PURE__ */ jsx(DollarSign, {
            size: 16
          }), "Invoice ", tenants.length, " Tenants"]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",
          children: "Projected Total Revenue"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: /* @__PURE__ */ jsxs(PrivacyBlur, {
            revealed: true,
            children: ["$", totalRevenue]
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-xs text-green-600 mt-2 flex items-center gap-1",
          children: [/* @__PURE__ */ jsx(CheckCircle, {
            size: 12
          }), " Ready to invoice"]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",
          children: "Active Tenants"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: tenants.length
        }), /* @__PURE__ */ jsx("div", {
          className: "text-xs text-zinc-400 mt-2",
          children: "Managed by platform"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",
          children: "Fee Schedule"
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-sm space-y-1 mt-2",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex justify-between border-b border-zinc-50 dark:border-zinc-800 pb-1 mb-1",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "Service Fee"
            }), " ", /* @__PURE__ */ jsx("span", {
              className: "font-mono",
              children: fees.applicationFeePercent ? `${fees.applicationFeePercent * 100}%` : "Var"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "SMS"
            }), " ", /* @__PURE__ */ jsxs("span", {
              className: "font-mono",
              children: ["$", fees.sms]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "Email"
            }), " ", /* @__PURE__ */ jsxs("span", {
              className: "font-mono",
              children: ["$", fees.email]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "Stream"
            }), " ", /* @__PURE__ */ jsxs("span", {
              className: "font-mono",
              children: ["$", fees.streaming, "/min"]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex justify-between",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400",
              children: "Storage"
            }), " ", /* @__PURE__ */ jsxs("span", {
              className: "font-mono",
              children: ["$", fees.storage, "/GB"]
            })]
          })]
        })]
      })]
    }), result && /* @__PURE__ */ jsxs("div", {
      className: `mb-8 p-4 rounded-lg border ${result.success ? "bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200" : "bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200"}`,
      children: [/* @__PURE__ */ jsxs("h3", {
        className: "font-bold flex items-center gap-2",
        children: [result.success ? /* @__PURE__ */ jsx(CheckCircle, {
          size: 18
        }) : /* @__PURE__ */ jsx(AlertCircle, {
          size: 18
        }), result.success ? "Invoicing Complete" : "Invoicing Failed"]
      }), /* @__PURE__ */ jsxs("div", {
        className: "mt-2 text-sm",
        children: [result.success ? /* @__PURE__ */ jsxs("p", {
          children: ["Successfully processed ", result.charged, " invoices."]
        }) : /* @__PURE__ */ jsx("p", {
          children: result.error
        }), result.details && /* @__PURE__ */ jsx("ul", {
          className: "mt-2 list-disc list-inside opacity-80 h-32 overflow-y-auto",
          children: result.details.map((d, i) => /* @__PURE__ */ jsx("li", {
            children: d.error ? /* @__PURE__ */ jsxs("span", {
              className: "text-red-600 font-medium",
              children: ["Failed: ", d.tenantId, " - ", d.error]
            }) : /* @__PURE__ */ jsxs("span", {
              children: ["Charged ", d.name, ": $", d.total.toFixed(2), " (", d.items.length, " items)"]
            })
          }, i))
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-950/50 flex justify-between items-center",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-900 dark:text-zinc-100",
          children: "Billing Preview"
        }), /* @__PURE__ */ jsx("span", {
          className: "text-xs text-zinc-500 dark:text-zinc-400",
          children: "Including Base Subscription + Usage Overages"
        })]
      }), tenants.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center text-zinc-500",
        children: [/* @__PURE__ */ jsx(CheckCircle, {
          size: 48,
          className: "mx-auto text-green-500 mb-4 opacity-20"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-medium text-zinc-900",
          children: "All Clear"
        }), /* @__PURE__ */ jsx("p", {
          className: "max-w-sm mx-auto mt-1",
          children: "No active tenants found."
        })]
      }) : /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left text-zinc-900 dark:text-zinc-100",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-950/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Tenant"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Base Plan"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",
              children: "Usage Breakdown"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider text-right",
              children: "Total"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: tenants.map((t) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50",
            children: [/* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900 dark:text-zinc-100",
                children: t.tenant.name
              }), /* @__PURE__ */ jsx("div", {
                className: "text-zinc-500 dark:text-zinc-400 text-xs font-mono",
                children: t.tenant.slug
              }), t.tenant.stripeCustomerId ? /* @__PURE__ */ jsxs("div", {
                className: "text-[10px] text-green-600 mt-1 flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(CheckCircle, {
                  size: 10
                }), " Billing Active"]
              }) : /* @__PURE__ */ jsxs("div", {
                className: "text-[10px] text-red-500 mt-1 flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(AlertCircle, {
                  size: 10
                }), " No Billing ID"]
              }), t.tenant.stripeAccountId ? /* @__PURE__ */ jsxs("div", {
                className: "text-[10px] text-blue-600 mt-0.5 flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(CheckCircle, {
                  size: 10
                }), " Payouts Active"]
              }) : /* @__PURE__ */ jsxs("div", {
                className: "text-[10px] text-amber-500 mt-0.5 flex items-center gap-1",
                children: [/* @__PURE__ */ jsx(AlertCircle, {
                  size: 10
                }), " Payouts Pending"]
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: t.subscription && /* @__PURE__ */ jsxs("div", {
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                  children: t.subscription.name
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 dark:text-zinc-400",
                  children: ["$", t.subscription.amount.toFixed(2), "/mo"]
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: Object.entries(t.costs).length === 0 ? /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-400 italic",
                children: "No usage overages"
              }) : /* @__PURE__ */ jsx("div", {
                className: "space-y-1 text-sm",
                children: Object.entries(t.costs).map(([key, val]) => /* @__PURE__ */ jsxs("div", {
                  className: "flex justify-between max-w-[200px]",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "text-zinc-600 dark:text-zinc-400 capitalize",
                    children: [key, ":"]
                  }), /* @__PURE__ */ jsxs("span", {
                    className: "font-mono text-zinc-700 dark:text-zinc-300",
                    children: [Math.round(val.quantity).toLocaleString(), " units ($", val.amount.toFixed(2), ")"]
                  })]
                }, key))
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right",
              children: /* @__PURE__ */ jsxs("div", {
                className: "font-bold text-zinc-900 dark:text-zinc-100",
                children: ["$", t.total.toFixed(2)]
              })
            })]
          }, t.tenant.id))
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mt-8 p-4 bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-lg text-sm border border-blue-100 dark:border-blue-900/50 flex gap-3",
      children: [/* @__PURE__ */ jsx(AlertCircle, {
        className: "shrink-0 mt-0.5",
        size: 16
      }), /* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("strong", {
          children: "Note on Invoicing:"
        }), /* @__PURE__ */ jsxs("ul", {
          className: "list-disc list-inside mt-1 space-y-1 opacity-90 ml-1",
          children: [/* @__PURE__ */ jsxs("li", {
            children: ['The "Invoice" button generates standard Stripe Invoice Items for ', /* @__PURE__ */ jsx("strong", {
              children: "Usage Overages"
            }), "."]
          }), /* @__PURE__ */ jsxs("li", {
            children: ["Base Plan fees are typically handled automatically by Stripe Subscriptions if configured. The total above is a ", /* @__PURE__ */ jsx("em", {
              children: "projection"
            }), " of comprehensive revenue."]
          }), /* @__PURE__ */ jsx("li", {
            children: "Verify Stripe Subscription status before manual invoicing to avoid double-charging base fees."
          })]
        })]
      })]
    })]
  });
});
const route106 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_financials,
  loader: loader$c
}, Symbol.toStringTag, { value: "Module" }));
const loader$b = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const failedSubs = await apiRequest("/admin/billing/failed", token);
    return {
      failedSubs,
      token
    };
  } catch (e) {
    return {
      error: e.message,
      token
    };
  }
};
const admin_financials_failed = UNSAFE_withComponentProps(function AdminFailedPayments() {
  const {
    failedSubs: initialData,
    error: loadError,
    token
  } = useLoaderData();
  const [failedSubs, setFailedSubs] = useState(initialData || []);
  const [loading, setLoading] = useState(false);
  const [retryId, setRetryId] = useState(null);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const refreshData = async () => {
    setLoading(true);
    try {
      const data = await apiRequest("/admin/billing/failed", token);
      setFailedSubs(data);
    } catch (e) {
      setError(e.message);
    } finally {
      setLoading(false);
    }
  };
  const handleRetry = async () => {
    if (!retryId) return;
    setLoading(true);
    setRetryId(null);
    try {
      const sub = failedSubs.find((s) => s.id === retryId);
      if (sub && sub.tenantId) {
        await apiRequest("/admin/billing/charge", token, {
          method: "POST",
          body: JSON.stringify({
            tenantIds: [sub.tenantId]
          })
        });
        setSuccess("Payment retry initiated. Check status in a moment.");
        setTimeout(refreshData, 2e3);
      }
    } catch (e) {
      setError(e.message);
    } finally {
      setLoading(false);
    }
  };
  if (loadError) return /* @__PURE__ */ jsxs("div", {
    className: "p-8 text-red-600",
    children: ["Error loading failed payments: ", loadError]
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-6xl mx-auto pb-20",
    children: [/* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!retryId,
      onClose: () => setRetryId(null),
      onConfirm: handleRetry,
      title: "Retry Payment",
      message: "Are you sure you want to retry charging this tenant immediately?",
      confirmText: "Retry Charge"
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: !!error,
      onClose: () => setError(null),
      message: error || ""
    }), /* @__PURE__ */ jsx(SuccessDialog, {
      isOpen: !!success,
      onClose: () => setSuccess(null),
      message: success || ""
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900",
          children: "Failed Payments & Dunning"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500",
          children: "Manage subscriptions that are at risk of cancellation."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: refreshData,
        disabled: loading,
        className: "px-4 py-2 border border-zinc-200 bg-white rounded-lg hover:bg-zinc-50 text-zinc-600 flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(RefreshCw, {
          size: 16,
          className: loading ? "animate-spin" : ""
        }), "Refresh"]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-sm",
      children: failedSubs.length === 0 ? /* @__PURE__ */ jsxs("div", {
        className: "p-12 text-center text-zinc-500",
        children: [/* @__PURE__ */ jsx(CheckCircle, {
          size: 48,
          className: "mx-auto text-green-500 mb-4 opacity-20"
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-medium text-zinc-900",
          children: "All Good"
        }), /* @__PURE__ */ jsx("p", {
          className: "max-w-sm mx-auto mt-1",
          children: "No subscriptions are currently in a failed or warning state."
        })]
      }) : /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 border-b border-zinc-200",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Tenant"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Dunning Phase"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Last Attempt"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100",
          children: failedSubs.map((sub) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50",
            children: [/* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900",
                children: sub.tenant?.name || "Unknown"
              }), /* @__PURE__ */ jsx("div", {
                className: "text-zinc-500 text-xs font-mono",
                children: sub.tenant?.slug
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsx("span", {
                className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${sub.status === "active" ? "bg-green-100 text-green-800" : sub.status === "past_due" ? "bg-yellow-100 text-yellow-800" : "bg-red-100 text-red-800"}`,
                children: sub.status
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2",
                children: [sub.dunningState === "failed" && /* @__PURE__ */ jsx(AlertCircle, {
                  size: 16,
                  className: "text-red-600"
                }), sub.dunningState?.startsWith("warning") && /* @__PURE__ */ jsx(AlertTriangle, {
                  size: 16,
                  className: "text-orange-500"
                }), /* @__PURE__ */ jsx("span", {
                  className: "capitalize",
                  children: sub.dunningState?.replace(/(\d)/, " $1")
                })]
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-sm text-zinc-600",
              children: sub.lastDunningAt ? new Date(sub.lastDunningAt).toLocaleDateString() : "N/A"
            }), /* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4 text-right",
              children: [/* @__PURE__ */ jsx("button", {
                onClick: () => setRetryId(sub.id),
                className: "text-indigo-600 hover:text-indigo-800 text-sm font-medium mr-4",
                children: "Retry"
              }), sub.stripeSubscriptionId && /* @__PURE__ */ jsx("a", {
                href: `https://dashboard.stripe.com/subscriptions/${sub.stripeSubscriptionId}`,
                target: "_blank",
                rel: "noopener noreferrer",
                className: "text-zinc-400 hover:text-zinc-600 inline-flex items-center gap-1",
                title: "View in Stripe",
                children: /* @__PURE__ */ jsx(ExternalLink, {
                  size: 14
                })
              })]
            })]
          }, sub.id))
        })]
      })
    })]
  });
});
const route107 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_financials_failed,
  loader: loader$b
}, Symbol.toStringTag, { value: "Module" }));
const Textarea = React.forwardRef(
  ({ className = "", ...props }, ref) => {
    return /* @__PURE__ */ jsx(
      "textarea",
      {
        className: `flex min-h-[80px] w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${className}`,
        ref,
        ...props
      }
    );
  }
);
Textarea.displayName = "Textarea";
function Switch({ checked, onCheckedChange, disabled, className = "" }) {
  return /* @__PURE__ */ jsx(
    Switch$1,
    {
      checked,
      onChange: onCheckedChange,
      disabled,
      className: `${checked ? "bg-zinc-900 dark:bg-zinc-50" : "bg-zinc-200 dark:bg-zinc-800"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 dark:focus-visible:ring-zinc-300 dark:focus-visible:ring-offset-zinc-950 ${className}`,
      children: /* @__PURE__ */ jsx(
        "span",
        {
          className: `${checked ? "translate-x-6" : "translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`
        }
      )
    }
  );
}
const loader$a = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const env = args.context.cloudflare?.env || args.context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  try {
    const automations = await apiRequest("/studios/marketing/automations", token, {}, apiUrl);
    return {
      automations: automations || []
    };
  } catch (e) {
    console.error("Failed to load automations", e);
    return {
      automations: [],
      error: e.message
    };
  }
};
const action$2 = async (args) => {
  const {
    request,
    context
  } = args;
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const env = context.cloudflare?.env || context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  const formData = await request.formData();
  const actionType = formData.get("_action");
  try {
    if (actionType === "create") {
      const data = {
        triggerEvent: formData.get("triggerEvent"),
        subject: formData.get("subject"),
        content: formData.get("content"),
        timingType: formData.get("timingType"),
        timingValue: Number(formData.get("timingValue"))
      };
      await apiRequest("/studios/marketing/automations", token, {
        method: "POST",
        body: JSON.stringify(data)
      }, apiUrl);
    } else if (actionType === "update") {
      const id = formData.get("id");
      const data = {};
      if (formData.has("isEnabled")) data.isEnabled = formData.get("isEnabled") === "true";
      if (formData.has("subject")) data.subject = formData.get("subject");
      if (formData.has("content")) data.content = formData.get("content");
      if (formData.has("timingType")) data.timingType = formData.get("timingType");
      if (formData.has("timingValue")) data.timingValue = Number(formData.get("timingValue"));
      await apiRequest(`/studios/marketing/automations/${id}`, token, {
        method: "PATCH",
        body: JSON.stringify(data)
      }, apiUrl);
    } else if (actionType === "delete") {
      const id = formData.get("id");
      await apiRequest(`/studios/marketing/automations/${id}`, token, {
        method: "DELETE"
      }, apiUrl);
    } else if (actionType === "test") {
      const id = formData.get("id");
      const email = formData.get("email");
      await apiRequest(`/studios/marketing/automations/${id}/test`, token, {
        method: "POST",
        body: JSON.stringify({
          email
        })
      }, apiUrl);
    }
    return {
      success: true
    };
  } catch (e) {
    return {
      success: false,
      error: e.message
    };
  }
};
const admin_workflows = UNSAFE_withComponentProps(function AdminWorkflows() {
  const {
    automations
  } = useLoaderData();
  const fetcher = useFetcher();
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const getIcon = (type) => {
    switch (type) {
      case "birthday":
        return /* @__PURE__ */ jsx(Cake, {
          className: "text-pink-500"
        });
      case "new_student":
        return /* @__PURE__ */ jsx(UserPlus, {
          className: "text-emerald-500"
        });
      case "absent":
        return /* @__PURE__ */ jsx(CalendarClock, {
          className: "text-amber-500"
        });
      case "trial_ending":
        return /* @__PURE__ */ jsx(AlertCircle, {
          className: "text-indigo-500"
        });
      default:
        return /* @__PURE__ */ jsx(Clock, {
          className: "text-blue-500"
        });
    }
  };
  const getTimingLabel = (auto) => {
    if (auto.timingType === "immediate") return "Sends Immediately";
    if (auto.timingType === "delay") return `Wait ${auto.timingValue} hours`;
    if (auto.timingType === "before") return `${auto.timingValue} hours Before`;
    if (auto.timingType === "after") return `${auto.timingValue} hours After`;
    return "Custom Schedule";
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-5xl mx-auto pb-20 space-y-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Marketing Workflows"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Automate your student communication lifecycle."
        })]
      }), /* @__PURE__ */ jsxs(Dialog, {
        open: isCreateOpen,
        onOpenChange: setIsCreateOpen,
        children: [/* @__PURE__ */ jsx(DialogTrigger, {
          asChild: true,
          children: /* @__PURE__ */ jsxs(Button, {
            children: [/* @__PURE__ */ jsx(Plus, {
              className: "w-4 h-4 mr-2"
            }), " New Workflow"]
          })
        }), /* @__PURE__ */ jsxs(DialogContent, {
          className: "sm:max-w-lg",
          children: [/* @__PURE__ */ jsx(DialogHeader, {
            children: /* @__PURE__ */ jsx(DialogTitle, {
              children: "Create Workflow"
            })
          }), /* @__PURE__ */ jsx(WorkflowForm, {
            onSubmit: (formData) => {
              formData.append("_action", "create");
              fetcher.submit(formData, {
                method: "post"
              });
              setIsCreateOpen(false);
            }
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "grid gap-4",
      children: automations.map((auto) => /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6 flex flex-col sm:flex-row sm:items-center gap-6 shadow-sm hover:shadow-md transition-shadow",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-3 bg-zinc-50 dark:bg-zinc-800 rounded-full shrink-0",
          children: getIcon(auto.triggerEvent)
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex-1 space-y-1",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-3",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "font-semibold text-lg text-zinc-900 dark:text-zinc-100",
              children: auto.subject
            }), /* @__PURE__ */ jsx(Badge, {
              variant: auto.isEnabled ? "default" : "outline",
              children: auto.isEnabled ? "Active" : "Paused"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4 text-sm text-zinc-500",
            children: [/* @__PURE__ */ jsxs("span", {
              className: "flex items-center gap-1",
              children: [/* @__PURE__ */ jsx(Clock, {
                className: "w-3 h-3"
              }), getTimingLabel(auto)]
            }), /* @__PURE__ */ jsxs("span", {
              className: "capitalize px-2 py-0.5 bg-zinc-100 dark:bg-zinc-800 rounded text-xs",
              children: ["Trigger: ", auto.triggerEvent.replace("_", " ")]
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-4 pt-4 sm:pt-0 border-t sm:border-0 border-zinc-100 dark:border-zinc-800",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsx(Label, {
              htmlFor: `toggle-${auto.id}`,
              className: "sr-only",
              children: "Enable"
            }), /* @__PURE__ */ jsx(Switch, {
              checked: auto.isEnabled,
              onCheckedChange: (checked) => {
                fetcher.submit({
                  _action: "update",
                  id: auto.id,
                  isEnabled: String(checked)
                }, {
                  method: "post"
                });
              }
            })]
          }), /* @__PURE__ */ jsxs(Dialog, {
            children: [/* @__PURE__ */ jsx(DialogTrigger, {
              asChild: true,
              children: /* @__PURE__ */ jsxs(Button, {
                variant: "outline",
                children: [/* @__PURE__ */ jsx(Pencil, {
                  className: "w-4 h-4 mr-2"
                }), " Edit"]
              })
            }), /* @__PURE__ */ jsxs(DialogContent, {
              className: "sm:max-w-lg",
              children: [/* @__PURE__ */ jsx(DialogHeader, {
                children: /* @__PURE__ */ jsxs(DialogTitle, {
                  children: ['Edit "', auto.subject, '"']
                })
              }), /* @__PURE__ */ jsx(WorkflowForm, {
                initialData: auto,
                onSubmit: (formData) => {
                  formData.append("_action", "update");
                  formData.append("id", auto.id);
                  fetcher.submit(formData, {
                    method: "post"
                  });
                }
              })]
            })]
          }), /* @__PURE__ */ jsxs(Dialog, {
            children: [/* @__PURE__ */ jsx(DialogTrigger, {
              asChild: true,
              children: /* @__PURE__ */ jsx(Button, {
                variant: "ghost",
                className: "text-zinc-400 hover:text-red-500 hover:bg-zinc-100",
                children: /* @__PURE__ */ jsx(Trash2, {
                  className: "w-4 h-4"
                })
              })
            }), /* @__PURE__ */ jsxs(DialogContent, {
              children: [/* @__PURE__ */ jsxs(DialogHeader, {
                children: [/* @__PURE__ */ jsx(DialogTitle, {
                  children: "Delete Workflow?"
                }), /* @__PURE__ */ jsx(DialogDescription, {
                  children: "This action cannot be undone. Typically we recommend pausing instead."
                })]
              }), /* @__PURE__ */ jsx(DialogFooter, {
                children: /* @__PURE__ */ jsx(Button, {
                  variant: "destructive",
                  onClick: () => {
                    fetcher.submit({
                      _action: "delete",
                      id: auto.id
                    }, {
                      method: "post"
                    });
                  },
                  children: "Delete"
                })
              })]
            })]
          })]
        })]
      }, auto.id))
    })]
  });
});
function WorkflowForm({
  initialData,
  onSubmit
}) {
  const handleSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);
    onSubmit(formData);
  };
  return /* @__PURE__ */ jsxs("form", {
    onSubmit: handleSubmit,
    className: "space-y-4 py-4",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-2 gap-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "space-y-2",
        children: [/* @__PURE__ */ jsx(Label, {
          children: "Trigger Event"
        }), /* @__PURE__ */ jsxs(Select, {
          name: "triggerEvent",
          defaultValue: initialData?.triggerEvent || "new_student",
          disabled: !!initialData,
          children: [/* @__PURE__ */ jsx("option", {
            value: "new_student",
            children: "New Student Signup"
          }), /* @__PURE__ */ jsx("option", {
            value: "birthday",
            children: "Birthday"
          }), /* @__PURE__ */ jsx("option", {
            value: "absent",
            children: "Student Absent (Re-engage)"
          }), /* @__PURE__ */ jsx("option", {
            value: "trial_ending",
            children: "Trial Ending Soon"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "space-y-2",
        children: [/* @__PURE__ */ jsx(Label, {
          children: "Timing"
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2",
          children: [/* @__PURE__ */ jsxs(Select, {
            name: "timingType",
            defaultValue: initialData?.timingType || "immediate",
            className: "w-[140px]",
            children: [/* @__PURE__ */ jsx("option", {
              value: "immediate",
              children: "Immediately"
            }), /* @__PURE__ */ jsx("option", {
              value: "delay",
              children: "Wait (Delay)"
            }), /* @__PURE__ */ jsx("option", {
              value: "before",
              children: "Before Event"
            }), /* @__PURE__ */ jsx("option", {
              value: "after",
              children: "After Event"
            })]
          }), /* @__PURE__ */ jsx(Input, {
            name: "timingValue",
            type: "number",
            defaultValue: initialData?.timingValue || 0,
            placeholder: "Hours",
            className: "w-20"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-2",
      children: [/* @__PURE__ */ jsx(Label, {
        children: "Subject Line"
      }), /* @__PURE__ */ jsx(Input, {
        name: "subject",
        defaultValue: initialData?.subject,
        required: true,
        placeholder: "e.g. Welcome to the family!"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-2",
      children: [/* @__PURE__ */ jsx(Label, {
        children: "Email Content"
      }), /* @__PURE__ */ jsx(Textarea, {
        name: "content",
        defaultValue: initialData?.content,
        required: true,
        placeholder: "Hello {firstname}...",
        className: "h-32 font-mono"
      }), /* @__PURE__ */ jsxs("p", {
        className: "text-xs text-zinc-500",
        children: ["Supported variables: ", "{firstname}", ", ", "{lastname}", "."]
      })]
    }), /* @__PURE__ */ jsx(DialogFooter, {
      className: "mt-4",
      children: /* @__PURE__ */ jsx(Button, {
        type: "submit",
        children: "Save Workflow"
      })
    })]
  });
}
const route108 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$2,
  default: admin_workflows,
  loader: loader$a
}, Symbol.toStringTag, { value: "Module" }));
const loader$9 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const configs = await apiRequest("/admin/platform/config", token);
    return {
      configs,
      error: null
    };
  } catch (e) {
    return {
      configs: [],
      error: e.message
    };
  }
};
const KNOWN_FEATURES = [{
  key: "feature_mobile_app",
  label: "White-Label Mobile App",
  description: "Enable Mobile App settings and promotion across all studios. Keep disabled until apps are approved.",
  icon: Smartphone
}, {
  key: "feature_website_builder",
  label: "Website Builder",
  description: "Enable drag-and-drop website creation for tenants using Puck editor.",
  icon: Globe
}, {
  key: "feature_chat",
  label: "Chat System",
  description: "Enable real-time chat for support and community using Durable Objects.",
  icon: MessagesSquare
}, {
  key: "feature_financials",
  label: "Financials & Payouts",
  description: "Global master switch for Financial reporting and Stripe payouts.",
  icon: CreditCard
}, {
  key: "feature_vod",
  label: "Video on Demand (VOD)",
  description: "Global master switch for VOD functionality.",
  icon: Video
}, {
  key: "feature_zoom",
  label: "Zoom Integration",
  description: "Enable Zoom meeting creation and sync.",
  icon: Video
}, {
  key: "feature_pos",
  label: "POS & Retail",
  description: "Enable Point of Sale and Product management.",
  icon: CreditCard
}, {
  key: "feature_sms",
  label: "SMS Messaging",
  description: "Enable Twilio SMS features and quotas.",
  icon: MessageSquare
}, {
  key: "feature_marketing",
  label: "Marketing & CRM",
  description: "Enable Email Marketing and CRM tools.",
  icon: Mail
}, {
  key: "feature_payroll",
  label: "Payroll & Compensation",
  description: "Enable Instructor Payroll and Commission tracking.",
  icon: Save
}];
const admin_features = UNSAFE_withComponentProps(function AdminFeatures() {
  const {
    configs: initialConfigs,
    error
  } = useLoaderData();
  const [configs, setConfigs] = useState(initialConfigs || []);
  const {
    getToken
  } = useAuth();
  const [loading, setLoading] = useState(null);
  const getConfig = (key) => configs.find((c) => c.key === key) || {
    enabled: false
  };
  const handleToggle = async (key, currentValue) => {
    setLoading(key);
    setConfigs((prev) => {
      const existing = prev.find((c) => c.key === key);
      if (existing) {
        return prev.map((c) => c.key === key ? {
          ...c,
          enabled: !currentValue
        } : c);
      } else {
        return [...prev, {
          key,
          enabled: !currentValue
        }];
      }
    });
    try {
      const token = await getToken();
      await apiRequest(`/admin/platform/config/${key}`, token, {
        method: "PUT",
        body: JSON.stringify({
          enabled: !currentValue,
          description: KNOWN_FEATURES.find((k) => k.key === key)?.description
        })
      });
    } catch (e) {
      console.error(e);
      console.error(e);
      toast.error("Failed to update feature flag");
      setConfigs(initialConfigs);
    } finally {
      setLoading(null);
    }
  };
  if (error) return /* @__PURE__ */ jsxs("div", {
    className: "p-8 text-red-600",
    children: ["Error loading config: ", error]
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "max-w-4xl mx-auto py-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
        children: "Platform Features"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400 mt-2",
        children: "Manage global feature flags. Disabling a feature here hides it from all tenants."
      })]
    }), /* @__PURE__ */ jsx("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-3",
      children: KNOWN_FEATURES.map((feature) => {
        const config = getConfig(feature.key);
        const isEnabled = config.enabled;
        const Icon = feature.icon;
        return /* @__PURE__ */ jsx("div", {
          className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-3 shadow-sm",
          children: /* @__PURE__ */ jsxs("div", {
            className: "flex items-start gap-3",
            children: [/* @__PURE__ */ jsx("div", {
              className: `p-2 rounded-md flex-shrink-0 ${isEnabled ? "bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400" : "bg-zinc-100 dark:bg-zinc-800 text-zinc-400 dark:text-zinc-500"}`,
              children: /* @__PURE__ */ jsx(Icon, {
                size: 18
              })
            }), /* @__PURE__ */ jsxs("div", {
              className: "flex-1 min-w-0",
              children: [/* @__PURE__ */ jsxs("div", {
                className: "flex items-start justify-between gap-2",
                children: [/* @__PURE__ */ jsx("h3", {
                  className: "text-sm font-medium text-zinc-900 dark:text-zinc-100 leading-tight",
                  children: feature.label
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => handleToggle(feature.key, isEnabled),
                  disabled: loading === feature.key,
                  className: `relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-1 dark:focus:ring-offset-zinc-900 ${isEnabled ? "bg-blue-600" : "bg-zinc-200 dark:bg-zinc-700"}`,
                  children: /* @__PURE__ */ jsx("span", {
                    "aria-hidden": "true",
                    className: `pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${isEnabled ? "translate-x-4" : "translate-x-0"}`
                  })
                })]
              }), /* @__PURE__ */ jsx("p", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 mt-0.5 line-clamp-2",
                children: feature.description
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2 mt-1.5",
                children: [/* @__PURE__ */ jsx("span", {
                  className: `inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium ${isEnabled ? "bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300" : "bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,
                  children: isEnabled ? "Enabled" : "Disabled (Hidden)"
                }), config.updatedAt && /* @__PURE__ */ jsxs("span", {
                  className: "text-[10px] text-zinc-400 dark:text-zinc-500",
                  children: ["Updated ", new Date(config.updatedAt).toLocaleDateString()]
                })]
              })]
            })]
          })
        }, feature.key);
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg p-4",
      children: [/* @__PURE__ */ jsx("h4", {
        className: "font-medium text-blue-900 dark:text-blue-300 mb-2",
        children: "How this works"
      }), /* @__PURE__ */ jsxs("ul", {
        className: "list-disc list-inside text-sm text-blue-800 dark:text-blue-300 space-y-1",
        children: [/* @__PURE__ */ jsxs("li", {
          children: [/* @__PURE__ */ jsx("strong", {
            children: "Enabled:"
          }), " Feature is visible to tenants (subject to their subscription tier)."]
        }), /* @__PURE__ */ jsxs("li", {
          children: [/* @__PURE__ */ jsx("strong", {
            children: "Disabled:"
          }), " Feature is completely hidden from the entire platform. Useful for testing or incomplete features (e.g. Mobile App)."]
        })]
      })]
    })]
  });
});
const route109 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_features,
  loader: loader$9
}, Symbol.toStringTag, { value: "Module" }));
const DATA_TYPE_CONFIG = {
  subscribers: {
    title: "Subscribers",
    endpoint: "subscribers",
    columns: [
      { key: "email", label: "Email" },
      { key: "firstName", label: "First Name" },
      { key: "lastName", label: "Last Name" },
      { key: "roles", label: "Roles" },
      { key: "status", label: "Status" },
      { key: "joinedAt", label: "Joined" }
    ]
  },
  financials: {
    title: "Financial Transactions",
    endpoint: "transactions",
    columns: [
      { key: "memberEmail", label: "Member Email" },
      { key: "memberName", label: "Member Name" },
      { key: "planName", label: "Plan" },
      { key: "amount", label: "Amount" },
      { key: "status", label: "Status" },
      { key: "createdAt", label: "Date" }
    ]
  },
  products: {
    title: "Products",
    endpoint: "products",
    columns: [
      { key: "sku", label: "SKU" },
      { key: "name", label: "Name" },
      { key: "price", label: "Price" },
      { key: "quantity", label: "Qty" },
      { key: "category", label: "Category" },
      { key: "isActive", label: "Active" }
    ]
  }
};
function DataExportModal({ isOpen, onClose, tenantId, tenantName, dataType }) {
  const [data, setData] = useState([]);
  const [selectedIds, setSelectedIds] = useState(/* @__PURE__ */ new Set());
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const { getToken } = useAuth();
  const config = DATA_TYPE_CONFIG[dataType];
  useEffect(() => {
    if (isOpen) {
      fetchData();
    } else {
      setData([]);
      setSelectedIds(/* @__PURE__ */ new Set());
      setError(null);
    }
  }, [isOpen, tenantId, dataType]);
  const fetchData = async () => {
    setLoading(true);
    setError(null);
    try {
      const token = await getToken();
      const result = await apiRequest(`/admin/tenants/${tenantId}/${config.endpoint}`, token);
      setData(result);
    } catch (e) {
      setError(e.message);
    } finally {
      setLoading(false);
    }
  };
  const toggleSelect = (id) => {
    const newSelected = new Set(selectedIds);
    if (newSelected.has(id)) {
      newSelected.delete(id);
    } else {
      newSelected.add(id);
    }
    setSelectedIds(newSelected);
  };
  const toggleSelectAll = () => {
    if (selectedIds.size === data.length) {
      setSelectedIds(/* @__PURE__ */ new Set());
    } else {
      setSelectedIds(new Set(data.map((d) => d.id)));
    }
  };
  const exportToCSV = () => {
    const selectedData = data.filter((d) => selectedIds.has(d.id));
    if (selectedData.length === 0) return;
    const headers = config.columns.map((c) => c.label);
    const rows = selectedData.map(
      (item) => config.columns.map((c) => {
        let value = item[c.key];
        if (value instanceof Date || typeof value === "number" && c.key.includes("At")) {
          value = new Date(value).toLocaleDateString();
        }
        if (typeof value === "boolean") {
          value = value ? "Yes" : "No";
        }
        if (c.key === "amount" || c.key === "price" || c.key === "costPrice") {
          value = `$${(value / 100).toFixed(2)}`;
        }
        if (typeof value === "string" && (value.includes(",") || value.includes('"'))) {
          value = `"${value.replace(/"/g, '""')}"`;
        }
        return value ?? "";
      }).join(",")
    );
    const csv = [headers.join(","), ...rows].join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${tenantName.replace(/\s+/g, "_")}_${dataType}_export.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };
  if (!isOpen) return null;
  return /* @__PURE__ */ jsx("div", { className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50", children: /* @__PURE__ */ jsxs("div", { className: "bg-white rounded-xl w-full max-w-5xl max-h-[90vh] flex flex-col shadow-2xl", children: [
    /* @__PURE__ */ jsxs("div", { className: "px-6 py-4 border-b border-zinc-200 flex items-center justify-between", children: [
      /* @__PURE__ */ jsxs("div", { children: [
        /* @__PURE__ */ jsx("h2", { className: "text-lg font-semibold text-zinc-900", children: config.title }),
        /* @__PURE__ */ jsx("p", { className: "text-sm text-zinc-500", children: tenantName })
      ] }),
      /* @__PURE__ */ jsx("button", { onClick: onClose, className: "p-2 hover:bg-zinc-100 rounded-lg", children: /* @__PURE__ */ jsx(X, { size: 20 }) })
    ] }),
    /* @__PURE__ */ jsx("div", { className: "flex-1 overflow-auto p-6", children: loading ? /* @__PURE__ */ jsxs("div", { className: "flex items-center justify-center py-12", children: [
      /* @__PURE__ */ jsx(Loader2, { className: "animate-spin text-blue-600", size: 32 }),
      /* @__PURE__ */ jsx("span", { className: "ml-3 text-zinc-600", children: "Loading data..." })
    ] }) : error ? /* @__PURE__ */ jsxs("div", { className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg", children: [
      "Error: ",
      error
    ] }) : data.length === 0 ? /* @__PURE__ */ jsxs("div", { className: "text-center py-12 text-zinc-500", children: [
      "No ",
      config.title.toLowerCase(),
      " found for this tenant."
    ] }) : /* @__PURE__ */ jsx("div", { className: "border border-zinc-200 rounded-lg overflow-hidden", children: /* @__PURE__ */ jsxs("table", { className: "w-full text-sm", children: [
      /* @__PURE__ */ jsx("thead", { className: "bg-zinc-50", children: /* @__PURE__ */ jsxs("tr", { children: [
        /* @__PURE__ */ jsx("th", { className: "w-12 px-4 py-3 text-left", children: /* @__PURE__ */ jsx(
          "button",
          {
            onClick: toggleSelectAll,
            className: "text-zinc-600 hover:text-zinc-900",
            children: selectedIds.size === data.length ? /* @__PURE__ */ jsx(CheckSquare, { size: 18, className: "text-blue-600" }) : /* @__PURE__ */ jsx(Square, { size: 18 })
          }
        ) }),
        config.columns.map((col) => /* @__PURE__ */ jsx("th", { className: "px-4 py-3 text-left font-medium text-zinc-700", children: col.label }, col.key))
      ] }) }),
      /* @__PURE__ */ jsx("tbody", { className: "divide-y divide-zinc-100", children: data.map((item) => /* @__PURE__ */ jsxs(
        "tr",
        {
          className: `hover:bg-zinc-50 ${selectedIds.has(item.id) ? "bg-blue-50" : ""}`,
          onClick: () => toggleSelect(item.id),
          children: [
            /* @__PURE__ */ jsx("td", { className: "px-4 py-3", children: selectedIds.has(item.id) ? /* @__PURE__ */ jsx(CheckSquare, { size: 18, className: "text-blue-600" }) : /* @__PURE__ */ jsx(Square, { size: 18, className: "text-zinc-400" }) }),
            config.columns.map((col) => {
              let value = item[col.key];
              if (value instanceof Date || typeof value === "number" && col.key.includes("At")) {
                value = new Date(value).toLocaleDateString();
              }
              if (typeof value === "boolean") {
                value = value ? /* @__PURE__ */ jsx("span", { className: "text-green-600", children: "Yes" }) : /* @__PURE__ */ jsx("span", { className: "text-zinc-400", children: "No" });
              }
              if (col.key === "amount" || col.key === "price") {
                value = `$${((value || 0) / 100).toFixed(2)}`;
              }
              return /* @__PURE__ */ jsx("td", { className: "px-4 py-3 text-zinc-700", children: value ?? "-" }, col.key);
            })
          ]
        },
        item.id
      )) })
    ] }) }) }),
    /* @__PURE__ */ jsxs("div", { className: "px-6 py-4 border-t border-zinc-200 flex items-center justify-between bg-zinc-50", children: [
      /* @__PURE__ */ jsxs("div", { className: "text-sm text-zinc-600", children: [
        selectedIds.size,
        " of ",
        data.length,
        " selected"
      ] }),
      /* @__PURE__ */ jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsx("button", { onClick: onClose, className: "px-4 py-2 text-zinc-600 hover:bg-zinc-100 rounded-lg", children: "Cancel" }),
        /* @__PURE__ */ jsxs(
          "button",
          {
            onClick: exportToCSV,
            disabled: selectedIds.size === 0,
            className: "flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",
            children: [
              /* @__PURE__ */ jsx(Download, { size: 16 }),
              "Export Selected to CSV"
            ]
          }
        )
      ] })
    ] })
  ] }) });
}
const loader$8 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const [tenants, platformConfig] = await Promise.all([apiRequest("/admin/tenants", token), apiRequest("/admin/platform/config", token).catch(() => [])]);
    return {
      tenants,
      platformConfig,
      error: null
    };
  } catch (e) {
    console.error("Loader failed", e);
    return {
      tenants: [],
      platformConfig: [],
      error: e.message || "Unauthorized",
      debug: e.data?.debug
    };
  }
};
const admin_tenants = UNSAFE_withComponentProps(function AdminTenants() {
  const {
    tenants: initialTenants,
    platformConfig
  } = useLoaderData();
  const [tenants, setTenants] = useState(initialTenants);
  const [isCreateOpen, setIsCreateOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [seedingLoading, setSeedingLoading] = useState(false);
  const [seedModalOpen, setSeedModalOpen] = useState(false);
  const [seedOptions, setSeedOptions] = useState({
    tenantName: "",
    tenantSlug: "",
    ownerCount: 1,
    instructorCount: 2,
    studentCount: 10,
    tier: "growth",
    features: [],
    featureMode: "all"
  });
  const [expandedTenants, setExpandedTenants] = useState(/* @__PURE__ */ new Set());
  const [tenantFeatures, setTenantFeatures] = useState({});
  const [tenantStats, setTenantStats] = useState({});
  const [subscriptionDetails, setSubscriptionDetails] = useState({});
  const [invoices, setInvoices] = useState({});
  const [featuresLoading, setFeaturesLoading] = useState(false);
  const [exportLoading, setExportLoading] = useState(null);
  const [refundModalOpen, setRefundModalOpen] = useState(false);
  const [selectedTenantForRefund, setSelectedTenantForRefund] = useState(null);
  const [refundAmount, setRefundAmount] = useState("");
  const [refundReason, setRefundReason] = useState("requested_by_customer");
  const [refundPaymentIntent, setRefundPaymentIntent] = useState("");
  const [cancelModalOpen, setCancelModalOpen] = useState(false);
  const [selectedTenantForCancel, setSelectedTenantForCancel] = useState(null);
  const [gracePeriodModalOpen, setGracePeriodModalOpen] = useState(false);
  const [selectedTenantForGrace, setSelectedTenantForGrace] = useState(null);
  const [exportModal, setExportModal] = useState(null);
  const FEATURES2 = [{
    key: "mobile_app",
    label: "White-Label Mobile App",
    icon: Smartphone,
    sections: "Settings > Mobile App"
  }, {
    key: "website_builder",
    label: "Website Builder",
    icon: Globe,
    sections: "Settings > Website Widgets"
  }, {
    key: "chat",
    label: "Chat System",
    icon: MessagesSquare,
    sections: "Settings > Chat Settings, Chat Widget"
  }, {
    key: "financials",
    label: "Financials & Payouts",
    icon: CreditCard,
    sections: "Management > Finances, My Payouts"
  }, {
    key: "vod",
    label: "Video on Demand",
    icon: Video,
    sections: "Operations > Media Library"
  }, {
    key: "zoom",
    label: "Zoom Integration",
    icon: Monitor,
    sections: "Backend Integrations"
  }, {
    key: "pos",
    label: "POS & Retail",
    icon: ShoppingCart,
    sections: "Commerce > POS, Coupons, Gift Cards"
  }, {
    key: "sms",
    label: "SMS Messaging",
    icon: MessageSquare,
    sections: "Backend Capability (Notifications)"
  }, {
    key: "marketing",
    label: "Marketing & CRM",
    icon: Mail,
    sections: "CRM > Email Automations"
  }, {
    key: "payroll",
    label: "Payroll & Compensation",
    icon: CreditCard,
    sections: "Management > Payroll Admin"
  }];
  const [errorDialog, setErrorDialog] = useState({
    isOpen: false,
    message: ""
  });
  const [successDialog, setSuccessDialog] = useState({
    isOpen: false,
    message: ""
  });
  const [tierChange, setTierChange] = useState(null);
  const [intervalChange, setIntervalChange] = useState(null);
  const [waiveUsageId, setWaiveUsageId] = useState(null);
  const [restoreId, setRestoreId] = useState(null);
  const [renewalDateChange, setRenewalDateChange] = useState(null);
  const [deleteModalOpen, setDeleteModalOpen] = useState(false);
  const [tenantToDelete, setTenantToDelete] = useState(null);
  const [deleteInput, setDeleteInput] = useState("");
  const [deleteLoading, setDeleteLoading] = useState(false);
  const [archiveId, setArchiveId] = useState(null);
  const [archiveInput, setArchiveInput] = useState("");
  const [archiveLoading, setArchiveLoading] = useState(false);
  const {
    getToken
  } = useAuth();
  useNavigate();
  const [formData, setFormData] = useState({
    name: "",
    slug: "",
    ownerEmail: "",
    // In a real app we'd look up user or create invite
    plan: "basic"
  });
  const [sortField, setSortField] = useState("createdAt");
  const [sortDir, setSortDir] = useState("desc");
  const [statusFilter, setStatusFilter] = useState("all");
  const [tierFilter, setTierFilter] = useState("all");
  const [showFinancials, setShowFinancials] = useState(() => {
    if (typeof window !== "undefined") return localStorage.getItem("admin_show_financials") === "true";
    return false;
  });
  const [zoomModalOpen, setZoomModalOpen] = useState(false);
  const [zoomTenantId, setZoomTenantId] = useState(null);
  const [zoomData, setZoomData] = useState({
    accountId: "",
    clientId: "",
    clientSecret: ""
  });
  const openZoomConfig = (tenantId) => {
    setZoomTenantId(tenantId);
    setZoomData({
      accountId: "",
      clientId: "",
      clientSecret: ""
    });
    setZoomModalOpen(true);
  };
  const saveZoomCredentials = async (e) => {
    e.preventDefault();
    if (!zoomTenantId) return;
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${zoomTenantId}/credentials/zoom`, token, {
        method: "PUT",
        body: JSON.stringify(zoomData)
      });
      if (res.error) throw new Error(res.error);
      setSuccessDialog({
        isOpen: true,
        message: "Zoom credentials updated successfully."
      });
      setZoomModalOpen(false);
    } catch (e2) {
      setErrorDialog({
        isOpen: true,
        message: e2.message
      });
    } finally {
      setLoading(false);
    }
  };
  const toggleFinancials = () => {
    const newValue = !showFinancials;
    setShowFinancials(newValue);
    localStorage.setItem("admin_show_financials", String(newValue));
  };
  const handleSort = (field) => {
    if (sortField === field) {
      setSortDir(sortDir === "asc" ? "desc" : "asc");
    } else {
      setSortField(field);
      setSortDir("asc");
    }
  };
  const sortedTenants = () => {
    if (!Array.isArray(tenants)) return [];
    let filtered = [...tenants];
    if (statusFilter !== "all") {
      filtered = filtered.filter((t) => (t.status || "active") === statusFilter);
    }
    if (tierFilter !== "all") {
      filtered = filtered.filter((t) => (t.tier || "basic") === tierFilter);
    }
    return filtered.sort((a, b) => {
      const getVal = (obj, path) => path.split(".").reduce((acc, part) => acc && acc[part], obj);
      const valA = getVal(a, sortField);
      const valB = getVal(b, sortField);
      if (valA === valB) return 0;
      const res = valA > valB ? 1 : -1;
      return sortDir === "asc" ? res : -res;
    });
  };
  const handleCreate = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest("/admin/tenants", token, {
        method: "POST",
        body: JSON.stringify({
          name: formData.name,
          slug: formData.slug,
          tier: formData.plan,
          trialDays: formData.trialDays
        })
      });
      if (res.error) {
        setErrorDialog({
          isOpen: true,
          message: res.error
        });
      } else {
        setTenants([...tenants, res]);
        setIsCreateOpen(false);
        setFormData({
          name: "",
          slug: "",
          ownerEmail: "",
          plan: "basic"
        });
        setSuccessDialog({
          isOpen: true,
          message: `Tenant ${res.name} (${res.slug}) has been provisioned successfully.`
        });
      }
    } catch (e2) {
      console.error(e2);
      setErrorDialog({
        isOpen: true,
        message: e2.message || "Failed to create tenant. Please try again."
      });
    } finally {
      setLoading(false);
    }
  };
  const handleStatusChange = async (tenantId, newStatus) => {
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/status`, token, {
        method: "PATCH",
        body: JSON.stringify({
          status: newStatus
        })
      });
      if (res.error) {
        setErrorDialog({
          isOpen: true,
          message: res.error
        });
      } else {
        setTenants(tenants.map((t) => t.id === tenantId ? {
          ...t,
          status: newStatus
        } : t));
        setSuccessDialog({
          isOpen: true,
          message: `Tenant status updated to ${newStatus}.`
        });
      }
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Failed to update status."
      });
    }
  };
  const handleTierChange = (tenantId, newTier) => {
    setTierChange({
      id: tenantId,
      tier: newTier
    });
  };
  const confirmTierChange = async () => {
    if (!tierChange) return;
    const {
      id: tenantId,
      tier: newTier
    } = tierChange;
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/tier`, token, {
        method: "PATCH",
        body: JSON.stringify({
          tier: newTier
        })
      });
      if (res.error) {
        setErrorDialog({
          isOpen: true,
          message: res.error
        });
      } else {
        setTenants(tenants.map((t) => t.id === tenantId ? {
          ...t,
          tier: newTier
        } : t));
        setSuccessDialog({
          isOpen: true,
          message: `Tenant tier updated to ${newTier}.`
        });
      }
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Failed to update tier."
      });
    } finally {
      setTierChange(null);
    }
  };
  const handleIntervalChange = (tenantId, interval) => {
    setIntervalChange({
      id: tenantId,
      interval
    });
  };
  const confirmIntervalChange = async () => {
    if (!intervalChange) return;
    const {
      id: tenantId,
      interval
    } = intervalChange;
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/subscription`, token, {
        method: "PATCH",
        body: JSON.stringify({
          interval
        })
      });
      if (res.error) throw new Error(res.error);
      setSuccessDialog({
        isOpen: true,
        message: "Subscription interval updated."
      });
      const details = await apiRequest(`/admin/tenants/${tenantId}/billing/details`, token);
      setSubscriptionDetails((prev) => ({
        ...prev,
        [tenantId]: details
      }));
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    } finally {
      setLoading(false);
      setIntervalChange(null);
    }
  };
  const handleCancelSubscription = (tenantId) => {
    setSelectedTenantForCancel(tenantId);
    setCancelModalOpen(true);
  };
  const confirmCancelSubscription = async () => {
    if (!selectedTenantForCancel) return;
    setLoading(true);
    const immediate = false;
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${selectedTenantForCancel}/subscription/cancel`, token, {
        method: "POST",
        body: JSON.stringify({
          immediate
        })
      });
      if (res.error) throw new Error(res.error);
      setSuccessDialog({
        isOpen: true,
        message: "Subscription set to cancel at end of period."
      });
      const details = await apiRequest(`/admin/tenants/${selectedTenantForCancel}/billing/details`, token);
      setSubscriptionDetails((prev) => ({
        ...prev,
        [selectedTenantForCancel]: details
      }));
      setCancelModalOpen(false);
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    } finally {
      setLoading(false);
    }
  };
  const handleRefundSubmit = async (e) => {
    e.preventDefault();
    if (!selectedTenantForRefund) return;
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${selectedTenantForRefund}/billing/refund`, token, {
        method: "POST",
        body: JSON.stringify({
          paymentIntentId: refundPaymentIntent,
          amount: refundAmount ? Math.round(parseFloat(refundAmount) * 100) : void 0,
          // cents
          reason: refundReason
        })
      });
      if (res.error) throw new Error(res.error);
      setSuccessDialog({
        isOpen: true,
        message: "Refund processed successfully."
      });
      setRefundModalOpen(false);
    } catch (e2) {
      setErrorDialog({
        isOpen: true,
        message: e2.message
      });
    } finally {
      setLoading(false);
    }
  };
  const openRefundModal = (tenantId) => {
    setSelectedTenantForRefund(tenantId);
    setRefundAmount("");
    setRefundPaymentIntent("");
    setRefundModalOpen(true);
  };
  const handleSubscriptionUpdate = async (tenantId, daysToAdd) => {
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/subscription`, token, {
        method: "PATCH",
        body: JSON.stringify({
          trialDays: daysToAdd
        })
      });
      if (res.error) throw new Error(res.error);
      const updated = await apiRequest("/admin/tenants", token);
      setTenants(updated);
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    }
  };
  const handleDateUpdate = async (tenantId, dateStr) => {
    if (!dateStr) return;
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/subscription`, token, {
        method: "PATCH",
        body: JSON.stringify({
          currentPeriodEnd: dateStr
        })
      });
      if (res.error) throw new Error(res.error);
      const updated = await apiRequest("/admin/tenants", token);
      setTenants(updated);
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    }
  };
  const confirmRenewalDateUpdate = async () => {
    if (!renewalDateChange) return;
    await handleDateUpdate(renewalDateChange.id, renewalDateChange.date);
    setRenewalDateChange(null);
  };
  const handleLimitUpdate = async (tenantId, key, value) => {
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantId}/quotas`, token, {
        method: "PATCH",
        body: JSON.stringify({
          [key]: value
        })
      });
      if (res.error) throw new Error(res.error);
      setTenants(tenants.map((t) => t.id === tenantId ? {
        ...t,
        [key]: value
      } : t));
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    }
  };
  const handleWaiveUsage = (tenantId) => {
    setWaiveUsageId(tenantId);
  };
  const confirmWaiveUsage = async () => {
    if (!waiveUsageId) return;
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${waiveUsageId}/billing/waive`, token, {
        method: "POST"
      });
      if (res.error) throw new Error(res.error);
      setSuccessDialog({
        isOpen: true,
        message: "Usage waived and counters reset to 0."
      });
      setTenants(tenants.map((t) => t.id === waiveUsageId ? {
        ...t,
        smsUsage: 0,
        emailUsage: 0,
        streamingUsage: 0
      } : t));
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    } finally {
      setLoading(false);
      setWaiveUsageId(null);
    }
  };
  const handleExport = async (tenantId, type) => {
    setExportLoading(type);
    try {
      const token = await getToken();
      const response = await fetch(`${API_URL$1}/admin/tenants/${tenantId}/export?type=${type}`, {
        headers: {
          "Authorization": `Bearer ${token}`
        }
      });
      if (!response.ok) throw new Error("Export failed");
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `export_${type}_${tenantId}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: "Export failed"
      });
    } finally {
      setExportLoading(null);
    }
  };
  const handleGracePeriod = (tenantId, enabled) => {
    setSelectedTenantForGrace({
      id: tenantId,
      enabled
    });
    setGracePeriodModalOpen(true);
  };
  const confirmGracePeriod = async () => {
    if (!selectedTenantForGrace) return;
    const {
      id,
      enabled
    } = selectedTenantForGrace;
    setLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${id}/lifecycle/grace-period`, token, {
        method: "POST",
        body: JSON.stringify({
          enabled
        })
      });
      if (res.error) throw new Error(res.error);
      setTenants(tenants.map((t) => t.id === id ? {
        ...t,
        studentAccessDisabled: enabled
      } : t));
      setSuccessDialog({
        isOpen: true,
        message: `Student access ${enabled ? "disabled (Grace Period started)" : "re-enabled"}.`
      });
      setGracePeriodModalOpen(false);
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    } finally {
      setLoading(false);
    }
  };
  const handleArchive = (tenantId) => {
    setArchiveId(tenantId);
    setArchiveInput("");
  };
  const handleRestore = (tenantId) => {
    setRestoreId(tenantId);
  };
  const confirmRestore = async () => {
    if (!restoreId) return;
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${restoreId}/lifecycle/restore`, token, {
        method: "POST"
      });
      if (res.error) throw new Error(res.error);
      setTenants(tenants.map((t) => t.id === restoreId ? {
        ...t,
        status: "active",
        studentAccessDisabled: false
      } : t));
      setSuccessDialog({
        isOpen: true,
        message: "Tenant restored successfully."
      });
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message
      });
    } finally {
      setRestoreId(null);
    }
  };
  const toggleTenantExpand = async (tenantId) => {
    if (expandedTenants.has(tenantId)) {
      const next2 = new Set(expandedTenants);
      next2.delete(tenantId);
      setExpandedTenants(next2);
      return;
    }
    const next = new Set(expandedTenants);
    next.add(tenantId);
    setExpandedTenants(next);
    setFeaturesLoading(true);
    try {
      const token = await getToken();
      const [featuresRes, statsRes, billingRes, historyRes] = await Promise.all([apiRequest(`/admin/tenants/${tenantId}/features`, token), apiRequest(`/admin/tenants/${tenantId}/stats`, token), apiRequest(`/admin/tenants/${tenantId}/billing/details`, token).catch(() => ({})), apiRequest(`/admin/tenants/${tenantId}/billing/history`, token).catch(() => ({
        invoices: []
      }))]);
      setTenantFeatures((prev) => ({
        ...prev,
        [tenantId]: featuresRes.features || []
      }));
      setTenantFeatures((prev) => ({
        ...prev,
        [tenantId]: featuresRes.features
      }));
      setTenantStats((prev) => ({
        ...prev,
        [tenantId]: statsRes
      }));
      setSubscriptionDetails((prev) => ({
        ...prev,
        [tenantId]: billingRes
      }));
      setInvoices((prev) => ({
        ...prev,
        [tenantId]: historyRes.invoices || []
      }));
    } catch (e) {
      console.error(e);
    } finally {
      setFeaturesLoading(false);
    }
  };
  const toggleAllTenants = () => {
    if (expandedTenants.size === sortedTenants().length) {
      setExpandedTenants(/* @__PURE__ */ new Set());
    } else {
      setExpandedTenants(new Set(sortedTenants().map((t) => t.id)));
      sortedTenants().map((t) => t.id);
    }
  };
  const handleFeatureToggle = async (tenantId, featureKey, currentValue) => {
    const currentFeatures = tenantFeatures[tenantId] || {};
    const updatedFeatures = {
      ...currentFeatures,
      [featureKey]: {
        ...currentFeatures[featureKey],
        enabled: !currentValue,
        source: "manual"
      }
    };
    setTenantFeatures((prev) => ({
      ...prev,
      [tenantId]: updatedFeatures
    }));
    try {
      const token = await getToken();
      await apiRequest(`/admin/tenants/${tenantId}/features`, token, {
        method: "POST",
        body: JSON.stringify({
          featureKey,
          enabled: !currentValue,
          source: "manual"
        })
      });
    } catch (e) {
      console.error(e);
      setTenantFeatures((prev) => ({
        ...prev,
        [tenantId]: {
          ...currentFeatures,
          [featureKey]: {
            ...currentFeatures[featureKey],
            enabled: currentValue
          }
        }
      }));
    }
  };
  const handleSeedConfirm = async () => {
    setSeedingLoading(true);
    try {
      const token = await getToken();
      let featuresToSeed = [];
      if (seedOptions.featureMode === "all") {
        featuresToSeed = FEATURES2.map((f) => f.key);
      } else if (seedOptions.featureMode === "custom") {
        featuresToSeed = seedOptions.features;
      }
      const res = await apiRequest("/admin/tenants/seed", token, {
        method: "POST",
        body: JSON.stringify({
          ...seedOptions,
          features: featuresToSeed
        })
      });
      if (res.error) throw new Error(res.error);
      const updated = await apiRequest("/admin/tenants", token);
      setTenants(updated);
      setSuccessDialog({
        isOpen: true,
        message: `Test Tenant "${res.tenant?.name}" created successfully!`
      });
      setSeedModalOpen(false);
      setSeedOptions({
        tenantName: "",
        tenantSlug: "",
        ownerCount: 1,
        instructorCount: 2,
        studentCount: 10,
        tier: "growth",
        features: [],
        featureMode: "all"
      });
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Seeding failed"
      });
    } finally {
      setSeedingLoading(false);
    }
  };
  const handleDeleteTenant = async () => {
    if (!tenantToDelete) return;
    setDeleteLoading(true);
    try {
      const token = await getToken();
      const res = await apiRequest(`/admin/tenants/${tenantToDelete}`, token, {
        method: "DELETE"
      });
      if (res.error) throw new Error(res.error);
      setTenants(tenants.filter((t) => t.id !== tenantToDelete));
      setSuccessDialog({
        isOpen: true,
        message: "Tenant deleted successfully."
      });
      setDeleteModalOpen(false);
      setTenantToDelete(null);
      setDeleteInput("");
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Deletion failed"
      });
    } finally {
      setDeleteLoading(false);
    }
  };
  const handleArchiveConfirm = async () => {
    if (!archiveId) return;
    setArchiveLoading(true);
    try {
      const token = await getToken();
      await apiRequest(`/admin/tenants/${archiveId}/status`, token, {
        method: "PUT",
        body: JSON.stringify({
          status: "archived"
        })
      });
      const updated = await apiRequest("/admin/tenants", token);
      setTenants(updated);
      setSuccessDialog({
        isOpen: true,
        message: "Tenant archived successfully."
      });
      setArchiveId(null);
      setArchiveInput("");
    } catch (e) {
      setErrorDialog({
        isOpen: true,
        message: e.message || "Archive failed"
      });
    } finally {
      setArchiveLoading(false);
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "dark:text-zinc-100",
    children: [/* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorDialog.isOpen,
      onClose: () => setErrorDialog({
        ...errorDialog,
        isOpen: false
      }),
      title: "Error",
      message: errorDialog.message
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: successDialog.isOpen,
      onClose: () => setSuccessDialog({
        ...successDialog,
        isOpen: false
      }),
      title: "Success",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-600 dark:text-zinc-400",
          children: successDialog.message
        }), /* @__PURE__ */ jsx("div", {
          className: "flex justify-end",
          children: /* @__PURE__ */ jsx("button", {
            onClick: () => setSuccessDialog({
              ...successDialog,
              isOpen: false
            }),
            className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",
            children: "Dismiss"
          })
        })]
      })
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!tierChange,
      onClose: () => setTierChange(null),
      onConfirm: confirmTierChange,
      title: "Change Tenant Tier",
      message: `Are you sure you want to change this tenant to ${tierChange?.tier}?`,
      confirmText: "Change Tier"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!intervalChange,
      onClose: () => setIntervalChange(null),
      onConfirm: confirmIntervalChange,
      title: "Change Billing Interval",
      message: `Switch billing interval to ${intervalChange?.interval}? This will update the Stripe Subscription immediately.`,
      confirmText: "Update Interval"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!renewalDateChange,
      onClose: () => setRenewalDateChange(null),
      onConfirm: confirmRenewalDateUpdate,
      title: "Update Renewal Date",
      message: `Are you sure you want to update the renewal date to ${renewalDateChange?.date}?`,
      confirmText: "Update Date"
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!waiveUsageId,
      onClose: () => setWaiveUsageId(null),
      onConfirm: confirmWaiveUsage,
      title: "Waive Usage",
      message: "Are you sure you want to WAIVE all current usage for this tenant? This resets counters to 0.",
      confirmText: "Waive Usage",
      isDestructive: true
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!restoreId,
      onClose: () => setRestoreId(null),
      onConfirm: confirmRestore,
      title: "Restore Tenant",
      message: "Restore this tenant to active status?",
      confirmText: "Restore"
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: !!archiveId,
      onClose: () => setArchiveId(null),
      title: "Archive Tenant",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 bg-red-50 dark:bg-red-950/30 text-red-800 dark:text-red-200 rounded-lg text-sm border border-red-100 dark:border-red-900/50 flex gap-3",
          children: [/* @__PURE__ */ jsx(AlertTriangle, {
            className: "shrink-0 mt-0.5",
            size: 16
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("strong", {
              children: "Warning:"
            }), " This will disable all access for the tenant. Data will be retained but the studio will be offline."]
          })]
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-600 dark:text-zinc-400",
          children: ["To confirm, please type ", /* @__PURE__ */ jsx("strong", {
            children: "ARCHIVE"
          }), " below:"]
        }), /* @__PURE__ */ jsx("input", {
          type: "text",
          className: "w-full border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-red-500 outline-none",
          placeholder: "Type ARCHIVE",
          value: archiveInput,
          onChange: (e) => setArchiveInput(e.target.value)
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 pt-2",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => {
              setArchiveInput("");
              setArchiveId(null);
            },
            className: "px-3 py-2 text-zinc-600 dark:text-zinc-400 text-sm",
            children: "Cancel"
          }), /* @__PURE__ */ jsxs("button", {
            onClick: handleArchiveConfirm,
            disabled: archiveInput !== "ARCHIVE" || archiveLoading,
            className: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium disabled:opacity-50 flex items-center gap-2",
            children: [archiveLoading && /* @__PURE__ */ jsx(Activity, {
              className: "animate-spin",
              size: 14
            }), "Archive Tenant"]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: deleteModalOpen,
      onClose: () => {
        setDeleteModalOpen(false);
        setTenantToDelete(null);
        setDeleteInput("");
      },
      title: "Delete Tenant",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-3 bg-red-50 text-red-700 text-sm rounded border border-red-100 flex items-start gap-2",
          children: [/* @__PURE__ */ jsx(AlertTriangle, {
            className: "shrink-0 mt-0.5",
            size: 16
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("span", {
              className: "font-bold block mb-1",
              children: "Danger: Irreversible Action"
            }), "This will explicitly delete the tenant and all associated data."]
          })]
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-600 dark:text-zinc-400",
          children: ["To confirm, please type ", /* @__PURE__ */ jsx("strong", {
            children: "DELETE"
          }), " below:"]
        }), /* @__PURE__ */ jsx("input", {
          type: "text",
          className: "w-full text-sm border border-zinc-300 dark:border-zinc-700 rounded px-3 py-2 bg-white dark:bg-zinc-800",
          placeholder: "DELETE",
          value: deleteInput,
          onChange: (e) => setDeleteInput(e.target.value)
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 pt-2",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => {
              setDeleteModalOpen(false);
              setTenantToDelete(null);
              setDeleteInput("");
            },
            className: "px-3 py-2 text-zinc-600 dark:text-zinc-400 text-sm",
            children: "Cancel"
          }), /* @__PURE__ */ jsxs("button", {
            onClick: handleDeleteTenant,
            disabled: deleteInput !== "DELETE" || deleteLoading,
            className: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium flex items-center gap-2 disabled:opacity-50",
            children: [deleteLoading && /* @__PURE__ */ jsx(Activity, {
              className: "animate-spin",
              size: 14
            }), "Delete Tenant"]
          })]
        })]
      })
    }), /* @__PURE__ */ jsx(Modal, {
      isOpen: seedModalOpen,
      onClose: () => setSeedModalOpen(false),
      title: "Seed Test Tenant",
      children: /* @__PURE__ */ jsxs("div", {
        className: "space-y-4",
        children: [/* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-600 dark:text-zinc-400",
          children: "Configure the parameters for the generated test tenant."
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Tenant Name (Optional)"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              className: "w-full text-sm border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800",
              placeholder: "Auto-generated",
              value: seedOptions.tenantName,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                tenantName: e.target.value
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Slug (Optional)"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              className: "w-full text-sm border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800",
              placeholder: "Auto-generated",
              value: seedOptions.tenantSlug,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                tenantSlug: e.target.value
              })
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-3 pt-2",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-xs font-semibold text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Tier"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full text-sm border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800",
              value: seedOptions.tier,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                tier: e.target.value
              }),
              children: [/* @__PURE__ */ jsx("option", {
                value: "basic",
                children: "Launch"
              }), /* @__PURE__ */ jsx("option", {
                value: "growth",
                children: "Growth"
              }), /* @__PURE__ */ jsx("option", {
                value: "scale",
                children: "Scale"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between items-center mb-1",
              children: [/* @__PURE__ */ jsx("label", {
                className: "block text-xs font-semibold text-zinc-700 dark:text-zinc-300",
                children: "Features"
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex gap-2 text-xs",
                children: [/* @__PURE__ */ jsx("button", {
                  className: `px-2 py-0.5 rounded border ${seedOptions.featureMode === "all" ? "bg-blue-50 border-blue-200 text-blue-700" : "bg-transparent border-zinc-200 text-zinc-500"}`,
                  onClick: () => setSeedOptions({
                    ...seedOptions,
                    featureMode: "all"
                  }),
                  children: "All"
                }), /* @__PURE__ */ jsx("button", {
                  className: `px-2 py-0.5 rounded border ${seedOptions.featureMode === "none" ? "bg-blue-50 border-blue-200 text-blue-700" : "bg-transparent border-zinc-200 text-zinc-500"}`,
                  onClick: () => setSeedOptions({
                    ...seedOptions,
                    featureMode: "none"
                  }),
                  children: "None"
                }), /* @__PURE__ */ jsx("button", {
                  className: `px-2 py-0.5 rounded border ${seedOptions.featureMode === "custom" ? "bg-blue-50 border-blue-200 text-blue-700" : "bg-transparent border-zinc-200 text-zinc-500"}`,
                  onClick: () => setSeedOptions({
                    ...seedOptions,
                    featureMode: "custom"
                  }),
                  children: "Custom"
                })]
              })]
            }), seedOptions.featureMode === "custom" && /* @__PURE__ */ jsx("div", {
              className: "grid grid-cols-2 gap-2 p-2 bg-zinc-50 dark:bg-zinc-800/50 rounded border border-zinc-100 dark:border-zinc-800 h-24 overflow-y-auto",
              children: FEATURES2.map((f) => /* @__PURE__ */ jsxs("label", {
                className: "flex items-center gap-2 cursor-pointer",
                children: [/* @__PURE__ */ jsx("input", {
                  type: "checkbox",
                  className: "rounded border-zinc-300 text-blue-600 focus:ring-blue-500",
                  checked: seedOptions.features.includes(f.key),
                  onChange: (e) => {
                    const newFeatures = e.target.checked ? [...seedOptions.features, f.key] : seedOptions.features.filter((k) => k !== f.key);
                    setSeedOptions({
                      ...seedOptions,
                      features: newFeatures
                    });
                  }
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-xs text-zinc-600 dark:text-zinc-400",
                  children: f.label
                })]
              }, f.key))
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-xs font-medium mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Owners"
              }), /* @__PURE__ */ jsx("span", {
                children: seedOptions.ownerCount
              })]
            }), /* @__PURE__ */ jsx("input", {
              type: "range",
              min: "1",
              max: "5",
              step: "1",
              className: "w-full accent-blue-600 h-1.5 bg-zinc-200 rounded-lg appearance-none cursor-pointer dark:bg-zinc-700",
              value: seedOptions.ownerCount,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                ownerCount: parseInt(e.target.value)
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-xs font-medium mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Instructors"
              }), /* @__PURE__ */ jsx("span", {
                children: seedOptions.instructorCount
              })]
            }), /* @__PURE__ */ jsx("input", {
              type: "range",
              min: "0",
              max: "10",
              step: "1",
              className: "w-full accent-blue-600 h-1.5 bg-zinc-200 rounded-lg appearance-none cursor-pointer dark:bg-zinc-700",
              value: seedOptions.instructorCount,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                instructorCount: parseInt(e.target.value)
              })
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsxs("div", {
              className: "flex justify-between text-xs font-medium mb-1",
              children: [/* @__PURE__ */ jsx("span", {
                children: "Customers (Students)"
              }), /* @__PURE__ */ jsx("span", {
                children: seedOptions.studentCount
              })]
            }), /* @__PURE__ */ jsx("input", {
              type: "range",
              min: "0",
              max: "50",
              step: "1",
              className: "w-full accent-blue-600 h-1.5 bg-zinc-200 rounded-lg appearance-none cursor-pointer dark:bg-zinc-700",
              value: seedOptions.studentCount,
              onChange: (e) => setSeedOptions({
                ...seedOptions,
                studentCount: parseInt(e.target.value)
              })
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-2 pt-4",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setSeedModalOpen(false),
            className: "px-3 py-2 text-zinc-600 dark:text-zinc-400 text-sm",
            children: "Cancel"
          }), /* @__PURE__ */ jsxs("button", {
            onClick: handleSeedConfirm,
            disabled: seedingLoading,
            className: "px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm font-medium flex items-center gap-2 disabled:opacity-50",
            children: [seedingLoading && /* @__PURE__ */ jsx(Activity, {
              className: "animate-spin",
              size: 14
            }), "Generate Tenant"]
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "text-2xl font-bold",
          children: "Tenant Management"
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex gap-2 items-center",
          children: [/* @__PURE__ */ jsxs("select", {
            className: "text-xs border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1 bg-white dark:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-blue-500",
            value: statusFilter,
            onChange: (e) => setStatusFilter(e.target.value),
            children: [/* @__PURE__ */ jsx("option", {
              value: "all",
              children: "Status: All"
            }), /* @__PURE__ */ jsx("option", {
              value: "active",
              children: "Active"
            }), /* @__PURE__ */ jsx("option", {
              value: "paused",
              children: "Paused"
            }), /* @__PURE__ */ jsx("option", {
              value: "suspended",
              children: "Suspended"
            }), /* @__PURE__ */ jsx("option", {
              value: "archived",
              children: "Archived"
            })]
          }), /* @__PURE__ */ jsxs("select", {
            className: "text-sm border border-zinc-300 dark:border-zinc-700 rounded-md px-2 py-1 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 outline-none focus:ring-2 focus:ring-blue-500",
            value: tierFilter,
            onChange: (e) => setTierFilter(e.target.value),
            children: [/* @__PURE__ */ jsx("option", {
              value: "all",
              children: "All Tiers"
            }), /* @__PURE__ */ jsx("option", {
              value: "basic",
              children: "Launch"
            }), /* @__PURE__ */ jsx("option", {
              value: "growth",
              children: "Growth"
            }), /* @__PURE__ */ jsx("option", {
              value: "scale",
              children: "Scale"
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "h-6 w-px bg-zinc-300 dark:bg-zinc-700 mx-2"
          }), /* @__PURE__ */ jsx("div", {
            className: "flex items-center gap-2",
            children: /* @__PURE__ */ jsx("button", {
              onClick: toggleAllTenants,
              className: "text-xs font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-200 bg-zinc-100 dark:bg-zinc-800 px-3 py-1 rounded-md transition-colors",
              children: expandedTenants.size === sortedTenants().length && sortedTenants().length > 0 ? "Collapse All" : "Expand All"
            })
          }), /* @__PURE__ */ jsx("div", {
            className: "h-6 w-px bg-zinc-300 dark:bg-zinc-700 mx-2"
          }), /* @__PURE__ */ jsx("div", {
            className: "flex items-center gap-2",
            children: /* @__PURE__ */ jsxs("button", {
              onClick: () => setSeedModalOpen(true),
              disabled: seedingLoading,
              className: "text-xs font-medium bg-emerald-100 text-emerald-700 hover:bg-emerald-200 px-3 py-1 rounded-md transition-colors flex items-center gap-1.5 disabled:opacity-50",
              children: [seedingLoading ? /* @__PURE__ */ jsx(Activity, {
                className: "animate-spin",
                size: 12
              }) : /* @__PURE__ */ jsx(Activity, {
                size: 12
              }), "Seed Test Tenant"]
            })
          }), /* @__PURE__ */ jsx("div", {
            className: "h-6 w-px bg-zinc-300 dark:bg-zinc-700 mx-2"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("button", {
              onClick: toggleFinancials,
              className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${showFinancials ? "bg-indigo-600" : "bg-zinc-200 dark:bg-zinc-700"}`,
              children: /* @__PURE__ */ jsx("span", {
                className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${showFinancials ? "translate-x-6" : "translate-x-1"}`
              })
            }), /* @__PURE__ */ jsx("span", {
              className: "text-sm text-zinc-600 dark:text-zinc-400 font-medium",
              children: showFinancials ? "Financials Visible" : "Privacy Mode"
            })]
          })]
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsCreateOpen(true),
        className: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 font-medium text-sm flex items-center gap-2",
        children: [/* @__PURE__ */ jsx("span", {
          className: "text-lg",
          children: "+"
        }), " Spin Up Tenant"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",
      children: [tenants?.error && /* @__PURE__ */ jsxs("div", {
        className: "p-4 bg-red-50 text-red-700 border-b border-red-100 mb-4",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "font-bold",
          children: ["Access Denied: ", tenants.error]
        }), tenants.debug && /* @__PURE__ */ jsx("pre", {
          className: "mt-2 text-xs bg-red-100 p-2 rounded overflow-auto",
          children: JSON.stringify(tenants.debug, null, 2)
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs mt-2",
          children: "Try refreshing to re-trigger admin bootstrapping."
        })]
      }), /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left text-zinc-900 dark:text-zinc-100",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-950/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "w-8"
            }), /* @__PURE__ */ jsxs("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-900",
              onClick: () => handleSort("name"),
              children: ["Tenant ", sortField === "name" && (sortDir === "asc" ? "â†‘" : "â†“")]
            }), /* @__PURE__ */ jsxs("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider cursor-pointer hover:bg-zinc-100",
              onClick: () => handleSort("tier"),
              children: ["Tier ", sortField === "tier" && (sortDir === "asc" ? "â†‘" : "â†“")]
            }), /* @__PURE__ */ jsxs("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider text-center cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-900",
              onClick: () => handleSort("stats.owners"),
              children: ["People ", sortField === "stats.owners" && (sortDir === "asc" ? "â†‘" : "â†“")]
            }), /* @__PURE__ */ jsxs("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-center cursor-pointer hover:bg-zinc-100",
              onClick: () => handleSort("storageUsage"),
              children: ["Usage ", sortField === "storageUsage" && (sortDir === "asc" ? "â†‘" : "â†“")]
            }), /* @__PURE__ */ jsxs("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-900",
              onClick: () => handleSort("status"),
              children: ["Status ", sortField === "status" && (sortDir === "asc" ? "â†‘" : "â†“")]
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100",
          children: sortedTenants().map((t) => /* @__PURE__ */ jsxs(Fragment$1, {
            children: [/* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors cursor-pointer",
              onClick: () => toggleTenantExpand(t.id),
              children: [/* @__PURE__ */ jsx("td", {
                className: "pl-4",
                children: expandedTenants.has(t.id) ? /* @__PURE__ */ jsx(ChevronDown, {
                  size: 16,
                  className: "text-zinc-400"
                }) : /* @__PURE__ */ jsx(ChevronRight, {
                  size: 16,
                  className: "text-zinc-400"
                })
              }), /* @__PURE__ */ jsxs("td", {
                className: "px-6 py-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-zinc-900 dark:text-zinc-100",
                  children: t.name
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-zinc-500 dark:text-zinc-400 text-xs font-mono mt-0.5 bg-zinc-100 dark:bg-zinc-800 inline-block px-1 rounded",
                  children: t.slug
                })]
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                onClick: (e) => e.stopPropagation(),
                children: /* @__PURE__ */ jsx("div", {
                  className: "relative",
                  children: /* @__PURE__ */ jsxs("select", {
                    value: t.tier || "basic",
                    onChange: (e) => handleTierChange(t.id, e.target.value),
                    className: `appearance-none cursor-pointer inline-flex items-center pl-2 pr-6 py-0.5 rounded text-xs font-medium uppercase tracking-wide border outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500 ${t.tier === "scale" ? "bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800" : t.tier === "growth" ? "bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800" : "bg-zinc-100 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}`,
                    children: [/* @__PURE__ */ jsx("option", {
                      value: "basic",
                      children: "Launch"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "growth",
                      children: "Growth"
                    }), /* @__PURE__ */ jsx("option", {
                      value: "scale",
                      children: "Scale"
                    })]
                  })
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex gap-4 justify-center",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "Owners",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "Own"
                    }), /* @__PURE__ */ jsx("span", {
                      className: "text-sm font-bold text-zinc-700",
                      children: t.stats?.owners || 0
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "Instructors",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "Inst"
                    }), /* @__PURE__ */ jsx("span", {
                      className: "text-sm font-bold text-zinc-700",
                      children: t.stats?.instructors || 0
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "Subscribers",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "Cust"
                    }), /* @__PURE__ */ jsx(PrivacyBlur, {
                      revealed: showFinancials,
                      placeholder: "***",
                      children: /* @__PURE__ */ jsx("span", {
                        className: "text-sm font-bold text-blue-600",
                        children: t.stats?.subscribers || 0
                      })
                    })]
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex gap-4 justify-center",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "Storage GB",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "Storage"
                    }), /* @__PURE__ */ jsxs("span", {
                      className: "text-xs font-bold text-zinc-700",
                      children: [(t.storageUsage / (1024 * 1024 * 1024)).toFixed(1), "G"]
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "VOD Minutes",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "VOD"
                    }), /* @__PURE__ */ jsxs("span", {
                      className: "text-xs font-bold text-zinc-700",
                      children: [t.streamingUsage || 0, "m"]
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "flex flex-col items-center",
                    title: "Emails",
                    children: [/* @__PURE__ */ jsx("span", {
                      className: "text-[10px] text-zinc-400 font-bold uppercase tracking-tighter",
                      children: "Email"
                    }), /* @__PURE__ */ jsx("span", {
                      className: "text-xs font-bold text-zinc-700",
                      children: t.emailUsage || 0
                    })]
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsx("span", {
                  className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.status === "suspended" ? "bg-red-100 text-red-800" : t.status === "paused" ? "bg-amber-100 text-amber-800" : "bg-green-100 text-green-800"}`,
                  children: t.status || "Active"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex items-center gap-3",
                  children: [
                    /* @__PURE__ */ jsx(Link, {
                      to: `/studio/${t.slug}`,
                      className: "text-blue-600 hover:text-blue-800 text-xs font-semibold uppercase tracking-wide border border-blue-200 bg-blue-50 px-3 py-1 rounded-full hover:bg-blue-100 transition-colors",
                      onClick: (e) => e.stopPropagation(),
                      children: "Enter"
                    }),
                    /* @__PURE__ */ jsx("div", {
                      className: "h-4 w-px bg-zinc-200"
                    }),
                    /* Pause/Resume Logic - Only show if NOT archived or suspended (unless suspended tenants can be paused? assuming no) */
                    (t.status === "active" || t.status === "paused") && (t.status === "paused" ? /* @__PURE__ */ jsx("button", {
                      className: "text-emerald-600 hover:text-emerald-700 text-xs font-medium transition-colors",
                      onClick: (e) => {
                        e.stopPropagation();
                        handleStatusChange(t.id, "active");
                      },
                      children: "Resume"
                    }) : /* @__PURE__ */ jsx("button", {
                      className: "text-zinc-500 hover:text-amber-600 text-xs font-medium transition-colors",
                      onClick: (e) => {
                        e.stopPropagation();
                        handleStatusChange(t.id, "paused");
                      },
                      children: "Pause"
                    })),
                    /* Suspend/Activate Logic - Show for active, paused, suspended. Hide for archived. */
                    (t.status === "active" || t.status === "paused" || t.status === "suspended") && (t.status === "suspended" ? /* @__PURE__ */ jsx("button", {
                      className: "text-emerald-600 hover:text-emerald-700 text-xs font-medium transition-colors",
                      onClick: (e) => {
                        e.stopPropagation();
                        handleStatusChange(t.id, "active");
                      },
                      children: "Activate"
                    }) : /* @__PURE__ */ jsx("button", {
                      className: "text-zinc-500 hover:text-red-600 text-xs font-medium transition-colors",
                      onClick: (e) => {
                        e.stopPropagation();
                        handleStatusChange(t.id, "suspended");
                      },
                      children: "Suspend"
                    })),
                    t.status === "archived" && /* @__PURE__ */ jsx("button", {
                      className: "text-red-600 hover:text-red-800 text-xs font-medium transition-colors bg-red-50 px-2 py-0.5 rounded border border-red-100",
                      onClick: (e) => {
                        e.stopPropagation();
                        setTenantToDelete(t.id);
                        setDeleteModalOpen(true);
                      },
                      children: "Delete"
                    })
                  ]
                })
              })]
            }), expandedTenants.has(t.id) && /* @__PURE__ */ jsx("tr", {
              className: "bg-zinc-50/50 dark:bg-zinc-900/30",
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 7,
                className: "px-6 pb-6 pt-2",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-inner space-y-6",
                  children: [/* @__PURE__ */ jsxs("div", {
                    className: "bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 flex flex-col md:flex-row gap-6 justify-between items-center",
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "flex items-center gap-4",
                      children: [/* @__PURE__ */ jsxs("div", {
                        children: [/* @__PURE__ */ jsx("div", {
                          className: "text-[10px] uppercase text-zinc-500 font-bold mb-1",
                          children: "Subscription Information"
                        }), /* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-2",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${t.subscriptionStatus === "active" ? "bg-green-100 text-green-800" : t.subscriptionStatus === "past_due" ? "bg-orange-100 text-orange-800" : t.subscriptionStatus === "canceled" ? "bg-red-100 text-red-800" : "bg-zinc-200 text-zinc-800"}`,
                            children: t.subscriptionStatus === "past_due" ? "Past Due" : t.subscriptionStatus || "trialing"
                          }), /* @__PURE__ */ jsxs("select", {
                            className: "text-xs bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1 outline-none focus:border-blue-500 text-zinc-900 dark:text-zinc-100",
                            value: subscriptionDetails[t.id]?.interval || "monthly",
                            onChange: (e) => handleIntervalChange(t.id, e.target.value),
                            children: [/* @__PURE__ */ jsx("option", {
                              value: "monthly",
                              children: "Monthly"
                            }), /* @__PURE__ */ jsx("option", {
                              value: "annual",
                              children: "Annual"
                            })]
                          })]
                        }), subscriptionDetails[t.id]?.cancelAtPeriodEnd && /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-red-600 font-medium mt-1",
                          children: "Cancels at end of period"
                        })]
                      }), /* @__PURE__ */ jsx("div", {
                        className: "h-8 w-px bg-zinc-200 dark:bg-zinc-800 hidden md:block"
                      }), /* @__PURE__ */ jsxs("div", {
                        children: [/* @__PURE__ */ jsx("div", {
                          className: "text-[10px] uppercase text-zinc-500 font-bold mb-1",
                          children: "Period Ends"
                        }), /* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-2",
                          children: [/* @__PURE__ */ jsx("input", {
                            type: "date",
                            className: "text-xs border border-zinc-300 dark:border-zinc-700 rounded px-2 py-1 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 hover:border-zinc-400 transition-colors",
                            defaultValue: t.currentPeriodEnd ? new Date(t.currentPeriodEnd).toISOString().split("T")[0] : "",
                            onBlur: (e) => {
                              if (e.target.value && e.target.value !== (t.currentPeriodEnd ? new Date(t.currentPeriodEnd).toISOString().split("T")[0] : "")) {
                                setRenewalDateChange({
                                  id: t.id,
                                  date: e.target.value
                                });
                              }
                            }
                          }), /* @__PURE__ */ jsxs("div", {
                            className: "flex text-[10px] gap-1",
                            children: [/* @__PURE__ */ jsx("button", {
                              onClick: (e) => {
                                e.stopPropagation();
                                handleSubscriptionUpdate(t.id, 30);
                              },
                              className: "px-1.5 py-0.5 bg-blue-50 text-blue-600 rounded hover:bg-blue-100",
                              children: "+30d"
                            }), /* @__PURE__ */ jsx("button", {
                              onClick: (e) => {
                                e.stopPropagation();
                                handleSubscriptionUpdate(t.id, 9999);
                              },
                              className: "px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 rounded hover:bg-zinc-200 dark:hover:bg-zinc-600",
                              children: "âˆž"
                            })]
                          })]
                        }), /* @__PURE__ */ jsxs("div", {
                          className: "flex gap-2 mt-1",
                          children: [/* @__PURE__ */ jsx("button", {
                            onClick: (e) => {
                              e.stopPropagation();
                              handleCancelSubscription(t.id);
                            },
                            className: "text-[10px] text-red-600 hover:underline",
                            children: "Cancel Subs"
                          }), /* @__PURE__ */ jsx("button", {
                            onClick: (e) => {
                              e.stopPropagation();
                              openRefundModal(t.id);
                            },
                            className: "text-[10px] text-zinc-500 hover:text-zinc-800 hover:underline",
                            children: "Refund"
                          })]
                        })]
                      })]
                    }), /* @__PURE__ */ jsxs("div", {
                      className: "flex items-center gap-6 border-l border-zinc-200 dark:border-zinc-800 pl-6 border-l-0 md:border-l",
                      children: [/* @__PURE__ */ jsxs("div", {
                        children: [/* @__PURE__ */ jsx("label", {
                          className: "text-[10px] uppercase text-zinc-400 font-bold block mb-1",
                          children: "SMS Limit"
                        }), /* @__PURE__ */ jsx("input", {
                          type: "number",
                          className: `w-20 text-xs border rounded px-2 py-1 ${t.billingExempt ? "bg-zinc-100 dark:bg-zinc-800/50 text-zinc-400 dark:text-zinc-500" : "bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100"}`,
                          defaultValue: t.smsLimit || 0,
                          onBlur: (e) => handleLimitUpdate(t.id, "smsLimit", parseInt(e.target.value))
                        }), /* @__PURE__ */ jsx("div", {
                          className: "mt-2 w-full",
                          children: t.billingExempt ? /* @__PURE__ */ jsx("div", {
                            className: "text-center",
                            children: /* @__PURE__ */ jsx("span", {
                              className: "text-[10px] uppercase font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full",
                              children: "Unlimited"
                            })
                          }) : /* @__PURE__ */ jsxs("div", {
                            className: "space-y-1",
                            children: [/* @__PURE__ */ jsxs("div", {
                              className: "flex justify-between text-[10px] text-zinc-500",
                              children: [/* @__PURE__ */ jsxs("span", {
                                children: [t.smsUsage || 0, " sent"]
                              }), /* @__PURE__ */ jsxs("span", {
                                children: [Math.round((t.smsUsage || 0) / (t.smsLimit || 1) * 100), "%"]
                              })]
                            }), /* @__PURE__ */ jsx("div", {
                              className: "h-1.5 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",
                              children: /* @__PURE__ */ jsx("div", {
                                className: `h-full rounded-full transition-all ${(t.smsUsage || 0) >= (t.smsLimit || 0) ? "bg-red-500" : (t.smsUsage || 0) / (t.smsLimit || 1) > 0.8 ? "bg-amber-400" : "bg-emerald-500"}`,
                                style: {
                                  width: `${Math.min(100, (t.smsUsage || 0) / (t.smsLimit || 1) * 100)}%`
                                }
                              })
                            }), /* @__PURE__ */ jsxs("div", {
                              className: "text-[10px] text-zinc-400 text-right",
                              children: [t.smsLimit || 0, " limit"]
                            })]
                          })
                        })]
                      }), /* @__PURE__ */ jsxs("div", {
                        children: [/* @__PURE__ */ jsx("label", {
                          className: "text-[10px] uppercase text-zinc-400 font-bold block mb-1",
                          children: "Email Limit"
                        }), /* @__PURE__ */ jsx("input", {
                          type: "number",
                          className: `w-20 text-xs border rounded px-2 py-1 ${t.billingExempt ? "bg-zinc-100 dark:bg-zinc-800/50 text-zinc-400 dark:text-zinc-500" : "bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100"}`,
                          defaultValue: t.emailLimit || 0,
                          onBlur: (e) => handleLimitUpdate(t.id, "emailLimit", parseInt(e.target.value))
                        }), /* @__PURE__ */ jsx("div", {
                          className: "mt-2 w-full",
                          children: t.billingExempt ? /* @__PURE__ */ jsx("div", {
                            className: "text-center",
                            children: /* @__PURE__ */ jsx("span", {
                              className: "text-[10px] uppercase font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full",
                              children: "Unlimited"
                            })
                          }) : /* @__PURE__ */ jsxs("div", {
                            className: "space-y-1",
                            children: [/* @__PURE__ */ jsxs("div", {
                              className: "flex justify-between text-[10px] text-zinc-500",
                              children: [/* @__PURE__ */ jsxs("span", {
                                children: [t.emailUsage || 0, " sent"]
                              }), /* @__PURE__ */ jsxs("span", {
                                children: [Math.round((t.emailUsage || 0) / (t.emailLimit || 1) * 100), "%"]
                              })]
                            }), /* @__PURE__ */ jsx("div", {
                              className: "h-1.5 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",
                              children: /* @__PURE__ */ jsx("div", {
                                className: `h-full rounded-full transition-all ${(t.emailUsage || 0) >= (t.emailLimit || 0) ? "bg-red-500" : (t.emailUsage || 0) / (t.emailLimit || 1) > 0.8 ? "bg-amber-400" : "bg-emerald-500"}`,
                                style: {
                                  width: `${Math.min(100, (t.emailUsage || 0) / (t.emailLimit || 1) * 100)}%`
                                }
                              })
                            }), /* @__PURE__ */ jsxs("div", {
                              className: "text-[10px] text-zinc-400 text-right",
                              children: [t.emailLimit || 0, " limit"]
                            })]
                          })
                        })]
                      }), /* @__PURE__ */ jsxs("div", {
                        className: "flex flex-col gap-1 pt-0",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-2",
                          children: [/* @__PURE__ */ jsx("input", {
                            type: "checkbox",
                            id: `exempt-${t.id}`,
                            className: "rounded border-zinc-300 dark:border-zinc-700 dark:bg-zinc-800 text-blue-600 focus:ring-blue-500",
                            defaultChecked: !!t.billingExempt,
                            onChange: (e) => handleLimitUpdate(t.id, "billingExempt", e.target.checked)
                          }), /* @__PURE__ */ jsx("label", {
                            className: "text-xs text-zinc-700 dark:text-zinc-300 cursor-pointer select-none font-medium",
                            htmlFor: `exempt-${t.id}`,
                            children: "Billing Exempt"
                          })]
                        }), t.billingExempt && /* @__PURE__ */ jsx("span", {
                          className: "text-[10px] text-zinc-400 pl-5",
                          children: "Limits ignored"
                        }), !t.billingExempt && /* @__PURE__ */ jsx("button", {
                          onClick: (e) => {
                            e.stopPropagation();
                            handleWaiveUsage(t.id);
                          },
                          className: "mt-2 text-[10px] text-zinc-400 hover:text-blue-600 hover:underline text-left pl-5",
                          children: "Waive Usage (Reset)"
                        })]
                      })]
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 mt-4 mb-6",
                    children: [/* @__PURE__ */ jsxs("div", {
                      className: "flex items-center justify-between mb-4",
                      children: [/* @__PURE__ */ jsx("div", {
                        className: "text-[10px] uppercase text-zinc-500 font-bold",
                        children: "Lifecycle & Data"
                      }), /* @__PURE__ */ jsx("div", {
                        className: "flex gap-2",
                        children: t.status === "archived" ? /* @__PURE__ */ jsx("button", {
                          onClick: (e) => {
                            e.stopPropagation();
                            handleRestore(t.id);
                          },
                          className: "text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded hover:bg-emerald-200",
                          children: "Restore Tenant"
                        }) : /* @__PURE__ */ jsxs(Fragment, {
                          children: [/* @__PURE__ */ jsx("button", {
                            onClick: (e) => {
                              e.stopPropagation();
                              handleGracePeriod(t.id, !t.studentAccessDisabled);
                            },
                            className: `text-xs px-3 py-1.5 rounded-md border font-medium transition-colors ${t.studentAccessDisabled ? "bg-amber-100 border-amber-200 text-amber-800 hover:bg-amber-200" : "bg-white border-zinc-300 text-zinc-700 hover:bg-zinc-50"}`,
                            children: t.studentAccessDisabled ? "Enable Student Access" : "Start Grace Period"
                          }), /* @__PURE__ */ jsx("button", {
                            onClick: (e) => {
                              e.stopPropagation();
                              handleArchive(t.id);
                            },
                            className: "text-xs bg-red-50 text-red-600 border border-red-100 px-2 py-1 rounded hover:bg-red-100",
                            children: "Archive"
                          })]
                        })
                      })]
                    }), /* @__PURE__ */ jsxs("div", {
                      className: "grid grid-cols-2 md:grid-cols-3 gap-2",
                      children: [/* @__PURE__ */ jsxs("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          setExportModal({
                            isOpen: true,
                            tenantId: t.id,
                            tenantName: t.name,
                            dataType: "subscribers"
                          });
                        },
                        className: "text-left bg-zinc-50 border border-zinc-200 rounded p-2 hover:bg-zinc-100 group transition-all",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-1.5 mb-0.5",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: "bg-white p-0.5 rounded border border-zinc-200 text-zinc-500 group-hover:text-blue-600 text-[10px]",
                            children: "â¬‡"
                          }), /* @__PURE__ */ jsx("span", {
                            className: "text-xs font-bold text-zinc-700",
                            children: "Subscribers"
                          })]
                        }), /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-zinc-500 truncate",
                          children: "View & select members"
                        })]
                      }), /* @__PURE__ */ jsxs("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          setExportModal({
                            isOpen: true,
                            tenantId: t.id,
                            tenantName: t.name,
                            dataType: "financials"
                          });
                        },
                        className: "text-left bg-zinc-50 border border-zinc-200 rounded p-2 hover:bg-zinc-100 group transition-all",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-1.5 mb-0.5",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: "bg-white p-0.5 rounded border border-zinc-200 text-zinc-500 group-hover:text-green-600 text-[10px]",
                            children: "â¬‡"
                          }), /* @__PURE__ */ jsx("span", {
                            className: "text-xs font-bold text-zinc-700",
                            children: "Financials"
                          })]
                        }), /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-zinc-500 truncate",
                          children: "View & select transactions"
                        })]
                      }), /* @__PURE__ */ jsxs("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          setExportModal({
                            isOpen: true,
                            tenantId: t.id,
                            tenantName: t.name,
                            dataType: "products"
                          });
                        },
                        className: "text-left bg-zinc-50 border border-zinc-200 rounded p-2 hover:bg-zinc-100 group transition-all",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-1.5 mb-0.5",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: "bg-white p-0.5 rounded border border-zinc-200 text-zinc-500 group-hover:text-purple-600 text-[10px]",
                            children: "â¬‡"
                          }), /* @__PURE__ */ jsx("span", {
                            className: "text-xs font-bold text-zinc-700",
                            children: "Products"
                          })]
                        }), /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-zinc-500 truncate",
                          children: "View & select products"
                        })]
                      }), /* @__PURE__ */ jsxs("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          handleExport(t.id, "classes");
                        },
                        disabled: !!exportLoading,
                        className: "text-left bg-zinc-50 border border-zinc-200 rounded p-2 hover:bg-zinc-100 disabled:opacity-50 group transition-all",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-1.5 mb-0.5",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: "bg-white p-0.5 rounded border border-zinc-200 text-zinc-500 group-hover:text-amber-600 text-[10px]",
                            children: "â¬‡"
                          }), /* @__PURE__ */ jsx("span", {
                            className: "text-xs font-bold text-zinc-700",
                            children: "Classes"
                          })]
                        }), /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-zinc-500 truncate",
                          children: "Schedule & Attendance"
                        })]
                      }), /* @__PURE__ */ jsxs("button", {
                        onClick: (e) => {
                          e.stopPropagation();
                          handleExport(t.id, "vod");
                        },
                        disabled: !!exportLoading,
                        className: "text-left bg-zinc-50 border border-zinc-200 rounded p-2 hover:bg-zinc-100 disabled:opacity-50 group transition-all",
                        children: [/* @__PURE__ */ jsxs("div", {
                          className: "flex items-center gap-1.5 mb-0.5",
                          children: [/* @__PURE__ */ jsx("span", {
                            className: "bg-white p-0.5 rounded border border-zinc-200 text-zinc-500 group-hover:text-red-500 text-[10px]",
                            children: "â¬‡"
                          }), /* @__PURE__ */ jsx("span", {
                            className: "text-xs font-bold text-zinc-700",
                            children: "VOD Usage"
                          })]
                        }), /* @__PURE__ */ jsx("div", {
                          className: "text-[10px] text-zinc-500 truncate",
                          children: "Storage & Streaming"
                        })]
                      })]
                    })]
                  }), /* @__PURE__ */ jsxs("div", {
                    children: [/* @__PURE__ */ jsx("h4", {
                      className: "text-xs font-bold text-zinc-500 uppercase tracking-wider mb-3",
                      children: "Recent Payments"
                    }), /* @__PURE__ */ jsx("div", {
                      className: "bg-white border border-zinc-200 rounded-lg overflow-hidden",
                      children: /* @__PURE__ */ jsxs("table", {
                        className: "w-full text-left text-xs",
                        children: [/* @__PURE__ */ jsx("thead", {
                          className: "bg-zinc-50 border-b border-zinc-200 text-zinc-500",
                          children: /* @__PURE__ */ jsxs("tr", {
                            children: [/* @__PURE__ */ jsx("th", {
                              className: "px-4 py-2 font-medium",
                              children: "Date"
                            }), /* @__PURE__ */ jsx("th", {
                              className: "px-4 py-2 font-medium",
                              children: "Amount"
                            }), /* @__PURE__ */ jsx("th", {
                              className: "px-4 py-2 font-medium",
                              children: "Status"
                            }), /* @__PURE__ */ jsx("th", {
                              className: "px-4 py-2 font-medium text-right",
                              children: "Actions"
                            })]
                          })
                        }), /* @__PURE__ */ jsx("tbody", {
                          className: "divide-y divide-zinc-100",
                          children: invoices[t.id]?.length ? invoices[t.id].map((inv) => /* @__PURE__ */ jsxs("tr", {
                            className: "hover:bg-zinc-50",
                            children: [/* @__PURE__ */ jsx("td", {
                              className: "px-4 py-2 text-zinc-600",
                              children: new Date(inv.date).toLocaleDateString()
                            }), /* @__PURE__ */ jsxs("td", {
                              className: "px-4 py-2 font-medium text-zinc-900",
                              children: ["$", (inv.amount / 100).toFixed(2)]
                            }), /* @__PURE__ */ jsx("td", {
                              className: "px-4 py-2",
                              children: /* @__PURE__ */ jsx("span", {
                                className: `inline-flex px-1.5 py-0.5 rounded text-[10px] font-medium capitalize ${inv.status === "paid" ? "bg-emerald-100 text-emerald-800" : inv.status === "open" ? "bg-blue-100 text-blue-800" : "bg-zinc-100 text-zinc-600"}`,
                                children: inv.status
                              })
                            }), /* @__PURE__ */ jsxs("td", {
                              className: "px-4 py-2 text-right flex justify-end gap-3",
                              children: [inv.hostedUrl && /* @__PURE__ */ jsx("a", {
                                href: inv.hostedUrl,
                                target: "_blank",
                                rel: "noreferrer",
                                className: "text-blue-600 hover:underline",
                                children: "Invoice"
                              }), inv.paymentIntentId && inv.amount > 0 && inv.status === "paid" && /* @__PURE__ */ jsx("button", {
                                onClick: () => {
                                  setSelectedTenantForRefund(t.id);
                                  setRefundPaymentIntent(inv.paymentIntentId);
                                  setRefundAmount("");
                                  setRefundModalOpen(true);
                                },
                                className: "text-zinc-500 hover:text-red-600",
                                children: "Refund"
                              })]
                            })]
                          }, inv.id)) : /* @__PURE__ */ jsx("tr", {
                            children: /* @__PURE__ */ jsx("td", {
                              colSpan: 4,
                              className: "px-4 py-4 text-center text-zinc-400 italic",
                              children: "No payment history available"
                            })
                          })
                        })]
                      })
                    })]
                  }), featuresLoading ? /* @__PURE__ */ jsx("div", {
                    className: "text-sm text-zinc-500 py-2",
                    children: "Loading capabilities..."
                  }) : /* @__PURE__ */ jsx("div", {
                    className: "space-y-6",
                    children: /* @__PURE__ */ jsx("div", {
                      className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",
                      children: FEATURES2.map((f) => {
                        const state = (tenantFeatures[t.id] || {})[f.key] || {
                          enabled: false,
                          source: "manual"
                        };
                        const globalKey = `feature_${f.key}`;
                        const globalFeature = platformConfig?.find((c) => c.key === globalKey);
                        const isDisabledByPlatform = !globalFeature || !globalFeature.enabled;
                        return /* @__PURE__ */ jsxs("div", {
                          className: `flex items-center justify-between p-3 border rounded-md ${isDisabledByPlatform ? "bg-zinc-100 opacity-60" : "bg-zinc-50"}`,
                          children: [/* @__PURE__ */ jsxs("div", {
                            className: "flex items-center gap-3",
                            children: [/* @__PURE__ */ jsx(f.icon, {
                              size: 18,
                              className: isDisabledByPlatform ? "text-zinc-400" : "text-zinc-500"
                            }), /* @__PURE__ */ jsxs("div", {
                              children: [/* @__PURE__ */ jsx("div", {
                                className: `text-sm font-medium ${isDisabledByPlatform ? "text-zinc-500" : "text-zinc-900"}`,
                                children: f.label
                              }), /* @__PURE__ */ jsx("div", {
                                className: "text-xs text-zinc-500",
                                children: isDisabledByPlatform ? "Disabled by Platform" : `Source: ${state.source}`
                              }), /* @__PURE__ */ jsx("div", {
                                className: "text-[10px] text-zinc-400 mt-0.5 truncate max-w-[180px]",
                                title: f.sections,
                                children: f.sections
                              })]
                            })]
                          }), /* @__PURE__ */ jsxs("div", {
                            className: "flex items-center gap-2",
                            children: [f.key === "zoom" && state.enabled && !isDisabledByPlatform && /* @__PURE__ */ jsx("button", {
                              onClick: (e) => {
                                e.stopPropagation();
                                openZoomConfig(t.id);
                              },
                              className: "p-1 text-zinc-500 hover:text-blue-600 hover:bg-zinc-200 rounded",
                              title: "Configure Zoom Credentials",
                              children: /* @__PURE__ */ jsx(Settings, {
                                size: 16
                              })
                            }), /* @__PURE__ */ jsx("button", {
                              onClick: (e) => {
                                e.stopPropagation();
                                if (isDisabledByPlatform) return;
                                handleFeatureToggle(t.id, f.key, state.enabled);
                              },
                              disabled: isDisabledByPlatform,
                              className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${isDisabledByPlatform ? "bg-zinc-300 cursor-not-allowed" : state.enabled ? "bg-blue-600" : "bg-gray-200"}`,
                              children: /* @__PURE__ */ jsx("span", {
                                className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${state.enabled ? "translate-x-6" : "translate-x-1"}`
                              })
                            })]
                          })]
                        }, f.key);
                      })
                    })
                  })]
                })
              })
            })]
          }, t.id))
        })]
      }), (!Array.isArray(tenants) || tenants.length === 0) && /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500",
        children: "No tenants found. Create one to get started."
      })]
    }), /* @__PURE__ */ jsxs(Modal, {
      isOpen: zoomModalOpen,
      onClose: () => setZoomModalOpen(false),
      title: "Configure Zoom Integration",
      children: [/* @__PURE__ */ jsx("div", {
        className: "mb-4 text-sm text-zinc-500",
        children: "Provide the Server-to-Server OAuth credentials from the Zoom App Marketplace. This allows the platform to create meetings on behalf of this tenant."
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: saveZoomCredentials,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Account ID"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: zoomData.accountId,
            onChange: (e) => setZoomData({
              ...zoomData,
              accountId: e.target.value
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Client ID"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: zoomData.clientId,
            onChange: (e) => setZoomData({
              ...zoomData,
              clientId: e.target.value
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Client Secret"
          }), /* @__PURE__ */ jsx("input", {
            type: "password",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: zoomData.clientSecret,
            onChange: (e) => setZoomData({
              ...zoomData,
              clientSecret: e.target.value
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setZoomModalOpen(false),
            className: "flex-1 px-4 py-2 border border-zinc-300 text-zinc-700 rounded-md hover:bg-zinc-50 font-medium",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium disabled:opacity-50",
            children: loading ? "Saving..." : "Save Credentials"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs(Modal, {
      isOpen: refundModalOpen,
      onClose: () => setRefundModalOpen(false),
      title: "Issue Refund",
      children: [/* @__PURE__ */ jsx("div", {
        className: "mb-4 text-sm text-zinc-500",
        children: "Refund a payment for this tenant. You need the Stripe Payment Intent ID (from Stripe Dashboard)."
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleRefundSubmit,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Payment Intent ID"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            placeholder: "pi_...",
            value: refundPaymentIntent,
            onChange: (e) => setRefundPaymentIntent(e.target.value)
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Amount (Optional - leave empty for full)"
          }), /* @__PURE__ */ jsxs("div", {
            className: "relative",
            children: [/* @__PURE__ */ jsx("span", {
              className: "absolute left-3 top-2 text-zinc-500",
              children: "$"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              step: "0.01",
              className: "w-full pl-8 pr-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
              placeholder: "0.00",
              value: refundAmount,
              onChange: (e) => setRefundAmount(e.target.value)
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Reason"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            value: refundReason,
            onChange: (e) => setRefundReason(e.target.value),
            children: [/* @__PURE__ */ jsx("option", {
              value: "requested_by_customer",
              children: "Requested by Customer"
            }), /* @__PURE__ */ jsx("option", {
              value: "duplicate",
              children: "Duplicate"
            }), /* @__PURE__ */ jsx("option", {
              value: "fraudulent",
              children: "Fraudulent"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setRefundModalOpen(false),
            className: "flex-1 px-4 py-2 border border-zinc-300 text-zinc-700 rounded-md hover:bg-zinc-50 font-medium",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium disabled:opacity-50",
            children: loading ? "Processing..." : "Issue Refund"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs(Modal, {
      isOpen: isCreateOpen,
      onClose: () => setIsCreateOpen(false),
      title: "Spin Up New Tenant",
      children: [/* @__PURE__ */ jsx("div", {
        className: "mb-6",
        children: /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 text-sm",
          children: "Automated provisioning: This will create a database record, set up initial owner permissions, and allocate resources."
        })
      }), /* @__PURE__ */ jsxs("form", {
        onSubmit: handleCreate,
        className: "space-y-4",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "Studio Name"
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            required: true,
            className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
            placeholder: "e.g. Zen Garden Yoga",
            value: formData.name,
            onChange: (e) => {
              const newName = e.target.value;
              setFormData((prev) => {
                const slugify = (text) => text.toLowerCase().replace(/[^a-z0-9]/g, "-");
                const expectedSlug = slugify(prev.name);
                const isAuto = !prev.slug || prev.slug === expectedSlug;
                return {
                  ...prev,
                  name: newName,
                  slug: isAuto ? slugify(newName) : prev.slug
                };
              });
            }
          })]
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-sm font-medium text-zinc-700 mb-1",
            children: "URL Slug"
          }), /* @__PURE__ */ jsxs("div", {
            className: "flex",
            children: [/* @__PURE__ */ jsx("span", {
              className: "inline-flex items-center px-3 rounded-l-md border border-r-0 border-zinc-300 bg-zinc-50 text-zinc-500 text-sm",
              children: "/studio/"
            }), /* @__PURE__ */ jsx("input", {
              type: "text",
              required: true,
              className: "flex-1 px-3 py-2 border border-zinc-300 rounded-r-md focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm",
              placeholder: "zen-garden",
              value: formData.slug,
              onChange: (e) => setFormData({
                ...formData,
                slug: e.target.value
              })
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Plan Tier"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",
              value: formData.plan,
              onChange: (e) => setFormData({
                ...formData,
                plan: e.target.value
              }),
              children: [/* @__PURE__ */ jsx("option", {
                value: "basic",
                children: "Launch (Basic)"
              }), /* @__PURE__ */ jsx("option", {
                value: "growth",
                children: "Growth"
              }), /* @__PURE__ */ jsx("option", {
                value: "scale",
                children: "Scale"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 mb-1",
              children: "Trial Period (Days)"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              min: "0",
              className: "w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",
              placeholder: "14",
              value: formData.trialDays || "",
              onChange: (e) => setFormData({
                ...formData,
                trialDays: parseInt(e.target.value)
              })
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 mt-1",
              children: "Leave empty for no trial"
            })]
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-xs text-zinc-500",
          children: "This studio will be created under your admin account with billing bypassed."
        }), /* @__PURE__ */ jsxs("div", {
          className: "pt-4 flex gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            type: "button",
            onClick: () => setIsCreateOpen(false),
            className: "flex-1 px-4 py-2 border border-zinc-300 text-zinc-700 rounded-md hover:bg-zinc-50 font-medium",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            type: "submit",
            disabled: loading,
            className: "flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium disabled:opacity-50",
            children: loading ? "Provisioning..." : "Launch Studio"
          })]
        })]
      })]
    }), refundModalOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 max-w-sm w-full shadow-xl",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold mb-4",
          children: "Process Refund"
        }), /* @__PURE__ */ jsxs("div", {
          className: "mb-4",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-700 mb-1",
            children: "Amount (Leave empty for full refund)"
          }), /* @__PURE__ */ jsxs("div", {
            className: "relative",
            children: [/* @__PURE__ */ jsx("span", {
              className: "absolute left-3 top-2 text-zinc-500",
              children: "$"
            }), /* @__PURE__ */ jsx("input", {
              type: "number",
              step: "0.01",
              className: "w-full pl-6 border border-zinc-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",
              placeholder: "0.00",
              value: refundAmount,
              onChange: (e) => setRefundAmount(e.target.value)
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "mb-6",
          children: [/* @__PURE__ */ jsx("label", {
            className: "block text-xs font-medium text-zinc-700 mb-1",
            children: "Reason"
          }), /* @__PURE__ */ jsxs("select", {
            className: "w-full border border-zinc-300 rounded px-3 py-2 text-sm",
            value: refundReason,
            onChange: (e) => setRefundReason(e.target.value),
            children: [/* @__PURE__ */ jsx("option", {
              value: "requested_by_customer",
              children: "Requested by Customer"
            }), /* @__PURE__ */ jsx("option", {
              value: "duplicate",
              children: "Duplicate"
            }), /* @__PURE__ */ jsx("option", {
              value: "fraudulent",
              children: "Fraudulent"
            })]
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setRefundModalOpen(false),
            className: "px-4 py-2 text-sm text-zinc-600 hover:bg-zinc-100 rounded",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleRefundSubmit,
            disabled: loading,
            className: "px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",
            children: loading ? "Processing..." : "Confirm Refund"
          })]
        })]
      })
    }), cancelModalOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 max-w-sm w-full shadow-xl border border-red-100",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3 mb-4 text-red-600",
          children: [/* @__PURE__ */ jsx(AlertTriangle, {
            className: "h-6 w-6"
          }), /* @__PURE__ */ jsx("h3", {
            className: "text-lg font-bold",
            children: "Cancel Subscription?"
          })]
        }), /* @__PURE__ */ jsx("p", {
          className: "text-sm text-zinc-600 mb-6",
          children: "Are you sure you want to cancel the subscription for this tenant? This action will disable billing at the end of the current period."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setCancelModalOpen(false),
            className: "px-4 py-2 text-sm text-zinc-600 hover:bg-zinc-100 rounded",
            children: "No, Keep It"
          }), /* @__PURE__ */ jsx("button", {
            onClick: confirmCancelSubscription,
            disabled: loading,
            className: "px-4 py-2 text-sm bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 font-medium",
            children: loading ? "Cancelling..." : "Yes, Cancel Subscription"
          })]
        })]
      })
    }), gracePeriodModalOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg p-6 max-w-md w-full shadow-xl border border-amber-100",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex items-center gap-3 text-amber-600 mb-4 bg-amber-50 p-3 rounded-lg",
          children: [/* @__PURE__ */ jsx(Activity, {
            className: "h-6 w-6"
          }), /* @__PURE__ */ jsx("span", {
            className: "font-bold",
            children: selectedTenantForGrace?.enabled ? "Start Grace Period" : "End Grace Period"
          })]
        }), selectedTenantForGrace?.enabled ? /* @__PURE__ */ jsxs(Fragment, {
          children: [/* @__PURE__ */ jsxs("p", {
            className: "text-zinc-600 text-sm mb-4",
            children: ["Enabling ", /* @__PURE__ */ jsx("strong", {
              children: "Grace Period"
            }), " will disable access to the Student Portal and Mobile App immediately."]
          }), /* @__PURE__ */ jsxs("p", {
            className: "text-zinc-600 text-sm mb-6",
            children: ["- Admins will retain access.", /* @__PURE__ */ jsx("br", {}), "- Public schedules will be hidden.", /* @__PURE__ */ jsx("br", {}), '- Tenant status remains "Active" for billing purposes unless changed.']
          })]
        }) : /* @__PURE__ */ jsx("p", {
          className: "text-zinc-600 text-sm mb-6",
          children: "Re-enabling access will restore Student Portal and Mobile App functionality immediately."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex justify-end gap-3",
          children: [/* @__PURE__ */ jsx("button", {
            onClick: () => setGracePeriodModalOpen(false),
            className: "px-4 py-2 text-sm text-zinc-600 hover:bg-zinc-100 rounded",
            children: "Cancel"
          }), /* @__PURE__ */ jsx("button", {
            onClick: confirmGracePeriod,
            disabled: loading,
            className: `px-4 py-2 text-sm font-medium text-white rounded-md disabled:opacity-50 ${selectedTenantForGrace?.enabled ? "bg-amber-600 hover:bg-amber-700" : "bg-green-600 hover:bg-green-700"}`,
            children: loading ? "Processing..." : selectedTenantForGrace?.enabled ? "Disable Access" : "Restore Access"
          })]
        })]
      })
    }), exportModal && /* @__PURE__ */ jsx(DataExportModal, {
      isOpen: exportModal.isOpen,
      onClose: () => setExportModal(null),
      tenantId: exportModal.tenantId,
      tenantName: exportModal.tenantName,
      dataType: exportModal.dataType
    })]
  });
});
const route110 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_tenants,
  loader: loader$8
}, Symbol.toStringTag, { value: "Module" }));
function Table({ children, className = "" }) {
  return /* @__PURE__ */ jsx("div", { className: `w-full overflow-auto ${className}`, children: /* @__PURE__ */ jsx("table", { className: "w-full text-sm text-left text-zinc-600 dark:text-zinc-300", children }) });
}
function TableHeader({ children }) {
  return /* @__PURE__ */ jsx("thead", { className: "text-xs text-zinc-500 dark:text-zinc-400 uppercase bg-zinc-50/50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800", children });
}
function TableRow({ children, className = "" }) {
  return /* @__PURE__ */ jsx("tr", { className: `border-b border-zinc-100 dark:border-zinc-800 last:border-0 hover:bg-zinc-50/50 dark:hover:bg-zinc-900/50 transition-colors ${className}`, children });
}
function TableHead({ children, className = "" }) {
  return /* @__PURE__ */ jsx("th", { className: `px-6 py-3 font-medium ${className}`, children });
}
function TableCell({ children, className = "", ...props }) {
  return /* @__PURE__ */ jsx("td", { className: `px-6 py-4 ${className}`, ...props, children });
}
const loader$7 = async (args) => {
  let token;
  try {
    const {
      getToken
    } = await getAuth(args);
    token = await getToken();
  } catch (authErr) {
    console.error("Auth System Error", JSON.stringify(authErr, Object.getOwnPropertyNames(authErr)));
    return redirect("/sign-in");
  }
  if (!token) {
    return redirect("/sign-in?redirect_url=/admin");
  }
  const env = args.context.cloudflare?.env || args.context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  const [logsResult, healthResult] = await Promise.allSettled([apiRequest("/admin/logs", token, {}, apiUrl), apiRequest("/admin/stats/health", token, {}, apiUrl)]);
  const logs = logsResult.status === "fulfilled" ? logsResult.value : {
    error: logsResult.reason?.message || "Failed to load logs"
  };
  const health = healthResult.status === "fulfilled" ? healthResult.value : {
    status: "error",
    error: healthResult.reason?.message || "Failed to load health"
  };
  return {
    logs,
    health
  };
};
function StatCard({
  title,
  value,
  status,
  trend
}) {
  const statusColors = {
    success: "text-emerald-600 dark:text-emerald-400",
    warning: "text-amber-600 dark:text-amber-400",
    error: "text-red-600 dark:text-red-400",
    neutral: "text-zinc-900 dark:text-zinc-100"
  };
  return /* @__PURE__ */ jsx(Card$1, {
    children: /* @__PURE__ */ jsx(CardContent, {
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex justify-between items-start",
        children: [/* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-sm font-medium text-zinc-500 dark:text-zinc-400",
            children: title
          }), /* @__PURE__ */ jsx("h4", {
            className: `text-2xl font-bold mt-2 ${statusColors[status || "neutral"]}`,
            children: value
          })]
        }), trend && /* @__PURE__ */ jsx("span", {
          className: "text-xs font-medium px-2 py-1 bg-zinc-100 dark:bg-zinc-800 rounded-full text-zinc-600 dark:text-zinc-300",
          children: trend
        })]
      })
    })
  });
}
function formatLogDetails(log) {
  const details = typeof log.details === "string" ? JSON.parse(log.details) : log.details || {};
  const target = log.targetId ? /* @__PURE__ */ jsxs("span", {
    className: "font-mono text-xs bg-zinc-100 dark:bg-zinc-800 px-1 rounded",
    children: [log.targetId.substring(0, 8), "..."]
  }) : null;
  switch (log.action) {
    case "create_user_manual":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Created user ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.email
        })]
      });
    case "delete_user_admin":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Deleted user account ", target]
      });
    case "bulk_delete_users":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Bulk deleted ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.count
        }), " users"]
      });
    case "set_platform_admin":
    case "promote_to_admin":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Promoted ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.count
        }), " users to Platform Admin"]
      });
    case "set_platform_admin_false":
    // If I log explicit false action, or assume passed 'action' string
    case "demote_from_admin":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Revoked Platform Admin from ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.count
        }), " users"]
      });
    case "update_tenant_tier":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Changed tenant tier to ", /* @__PURE__ */ jsx(Badge, {
          variant: "outline",
          className: "text-xs uppercase",
          children: details.tier
        })]
      });
    case "impersonate_user":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Impersonated ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.targetEmail
        })]
      });
    case "update_zoom_credentials":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Updated Zoom credentials for tenant ", target]
      });
    case "grant_studio_access":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Granted ", /* @__PURE__ */ jsx("span", {
          className: "font-medium",
          children: details.role
        }), " access to studio"]
      });
    case "revoke_studio_access":
      return /* @__PURE__ */ jsx("span", {
        children: "Revoked access from studio"
      });
    case "scan_file":
      return /* @__PURE__ */ jsxs("span", {
        children: ["Virus scan result: ", /* @__PURE__ */ jsx("span", {
          className: details.infected ? "text-red-600 font-bold" : "text-green-600",
          children: details.infected ? "INFECTED" : "Clean"
        })]
      });
    case "USER_LOGIN":
      return /* @__PURE__ */ jsx("span", {
        children: "User logged in"
      });
    default:
      const keys = Object.keys(details).filter((k) => !["userAgent", "ip"].includes(k));
      if (keys.length > 0) {
        return /* @__PURE__ */ jsx("span", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: keys.map((k) => `${k}: ${details[k]}`).join(", ")
        });
      }
      return /* @__PURE__ */ jsx("span", {
        className: "text-zinc-400 dark:text-zinc-500 italic",
        children: "No additional details"
      });
  }
}
const admin__index = UNSAFE_withComponentProps(function AdminIndex() {
  const {
    logs,
    health
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6",
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("h2", {
        className: "text-2xl font-bold tracking-tight text-zinc-900 dark:text-zinc-100",
        children: "Dashboard Overview"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "System performance and activity monitoring."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-4 gap-6",
      children: [/* @__PURE__ */ jsx(StatCard, {
        title: "System Status",
        value: health?.status === "error" ? "Error" : health?.status === "healthy" ? "Operational" : "Degraded",
        status: health?.status === "error" ? "error" : health?.status === "healthy" ? "success" : "warning",
        trend: health?.status === "error" ? health?.error || "Unknown Error" : `Latency: ${health?.dbLatencyMs || 0}ms`
      }), /* @__PURE__ */ jsx(StatCard, {
        title: "Active Tenants",
        value: String(health?.activeTenants || 0),
        status: "neutral"
      }), /* @__PURE__ */ jsx(StatCard, {
        title: "Total Users",
        value: String(health?.totalUsers || 0),
        status: "neutral"
      }), /* @__PURE__ */ jsx(StatCard, {
        title: "Recent Errors",
        value: String(health?.recentErrors || 0),
        status: health?.recentErrors > 0 ? "error" : "success",
        trend: "Last 24h"
      })]
    }), /* @__PURE__ */ jsxs(Card$1, {
      children: [/* @__PURE__ */ jsx(CardHeader, {
        children: /* @__PURE__ */ jsx(CardTitle, {
          children: "Recent Audit Logs"
        })
      }), /* @__PURE__ */ jsx(CardContent, {
        className: "p-0",
        children: Array.isArray(logs) ? /* @__PURE__ */ jsxs(Table, {
          children: [/* @__PURE__ */ jsx(TableHeader, {
            children: /* @__PURE__ */ jsxs(TableRow, {
              children: [/* @__PURE__ */ jsx(TableHead, {
                className: "w-[180px]",
                children: "Time"
              }), /* @__PURE__ */ jsx(TableHead, {
                className: "w-[150px]",
                children: "Action"
              }), /* @__PURE__ */ jsx(TableHead, {
                children: "Summary"
              }), /* @__PURE__ */ jsx(TableHead, {
                children: "Actor"
              })]
            })
          }), /* @__PURE__ */ jsxs("tbody", {
            children: [logs.map((log) => /* @__PURE__ */ jsxs(TableRow, {
              className: "hover:bg-zinc-50",
              children: [/* @__PURE__ */ jsx(TableCell, {
                className: "font-mono text-xs text-zinc-500 whitespace-nowrap",
                children: new Date(log.createdAt).toLocaleString(void 0, {
                  month: "short",
                  day: "numeric",
                  hour: "numeric",
                  minute: "2-digit"
                })
              }), /* @__PURE__ */ jsx(TableCell, {
                children: /* @__PURE__ */ jsx(Badge, {
                  variant: "outline",
                  className: "font-mono text-[10px] uppercase",
                  children: log.action.replace(/_/g, " ")
                })
              }), /* @__PURE__ */ jsx(TableCell, {
                className: "text-sm",
                children: formatLogDetails(log)
              }), /* @__PURE__ */ jsx(TableCell, {
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-col",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                    children: [log.actorProfile?.firstName, " ", log.actorProfile?.lastName]
                  }), /* @__PURE__ */ jsx("span", {
                    className: "text-xs text-zinc-500 dark:text-zinc-400",
                    children: log.actorEmail
                  })]
                })
              })]
            }, log.id)), logs.length === 0 && /* @__PURE__ */ jsx(TableRow, {
              children: /* @__PURE__ */ jsx(TableCell, {
                className: "text-center text-zinc-500 dark:text-zinc-400 py-8",
                colSpan: 4,
                children: "No recent activity found."
              })
            })]
          })]
        }) : /* @__PURE__ */ jsxs("div", {
          className: "p-6 text-red-600 bg-red-50",
          children: [/* @__PURE__ */ jsx("p", {
            className: "font-medium",
            children: "Error Loading Logs"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm mt-1",
            children: logs.error
          })]
        })
      })]
    })]
  });
});
const route111 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin__index,
  loader: loader$7
}, Symbol.toStringTag, { value: "Module" }));
const loader$6 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  let stats = {
    totalSent: 0,
    byTenant: [],
    recentLogs: []
  };
  try {
    const res = await apiRequest("/admin-api/stats/email", token);
    if (!res.error) stats = res;
  } catch (e) {
    console.error("Failed to load email stats", e);
  }
  return {
    stats
  };
};
const admin_emails = UNSAFE_withComponentProps(function AdminEmailsPage() {
  const {
    stats
  } = useLoaderData();
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8",
    children: [/* @__PURE__ */ jsx("h1", {
      className: "text-3xl font-bold text-zinc-900 mb-2",
      children: "Global Email Analytics"
    }), /* @__PURE__ */ jsx("p", {
      className: "text-zinc-500 mb-8",
      children: "System-wide email volume and usage tracking."
    }), /* @__PURE__ */ jsx("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white p-6 rounded-lg border border-zinc-200 shadow-sm flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-3 bg-blue-100 rounded-full",
          children: /* @__PURE__ */ jsx(Mail, {
            className: "h-6 w-6 text-blue-600"
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("p", {
            className: "text-sm font-medium text-zinc-500",
            children: "Total Emails Sent"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-3xl font-bold text-zinc-900",
            children: stats.totalSent
          })]
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 lg:grid-cols-2 gap-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",
        children: [/* @__PURE__ */ jsx("div", {
          className: "bg-zinc-50 px-6 py-4 border-b border-zinc-200 border-zinc-200",
          children: /* @__PURE__ */ jsx("h3", {
            className: "font-semibold text-zinc-800",
            children: "Volume by Tenant"
          })
        }), /* @__PURE__ */ jsxs("table", {
          className: "min-w-full divide-y divide-zinc-200",
          children: [/* @__PURE__ */ jsx("thead", {
            children: /* @__PURE__ */ jsxs("tr", {
              className: "bg-zinc-50",
              children: [/* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
                children: "Tenant"
              }), /* @__PURE__ */ jsx("th", {
                className: "px-6 py-3 text-right text-xs font-medium text-zinc-500 uppercase",
                children: "Emails Sent"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            className: "divide-y divide-zinc-200",
            children: stats.byTenant.map((t, i) => /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("td", {
                className: "px-6 py-3 text-sm font-medium text-zinc-900",
                children: /* @__PURE__ */ jsx(Link, {
                  to: `/admin/tenants`,
                  className: "hover:underline",
                  children: t.tenantName
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-3 text-sm text-right text-zinc-600 font-mono",
                children: t.count
              })]
            }, i))
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",
        children: [/* @__PURE__ */ jsx("div", {
          className: "bg-zinc-50 px-6 py-4 border-b border-zinc-200",
          children: /* @__PURE__ */ jsx("h3", {
            className: "font-semibold text-zinc-800",
            children: "Recent Logs"
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "max-h-[400px] overflow-y-auto",
          children: /* @__PURE__ */ jsxs("table", {
            className: "min-w-full divide-y divide-zinc-200",
            children: [/* @__PURE__ */ jsx("thead", {
              children: /* @__PURE__ */ jsxs("tr", {
                className: "bg-zinc-50",
                children: [/* @__PURE__ */ jsx("th", {
                  className: "px-4 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
                  children: "Sent At"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-4 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
                  children: "Tenant"
                }), /* @__PURE__ */ jsx("th", {
                  className: "px-4 py-3 text-left text-xs font-medium text-zinc-500 uppercase",
                  children: "Subject"
                })]
              })
            }), /* @__PURE__ */ jsx("tbody", {
              className: "divide-y divide-zinc-200",
              children: stats.recentLogs.map((log) => /* @__PURE__ */ jsxs("tr", {
                children: [/* @__PURE__ */ jsx("td", {
                  className: "px-4 py-2 text-xs text-zinc-500",
                  children: new Date(log.sentAt).toLocaleString()
                }), /* @__PURE__ */ jsx("td", {
                  className: "px-4 py-2 text-xs font-medium text-zinc-900",
                  children: log.tenantName
                }), /* @__PURE__ */ jsx("td", {
                  className: "px-4 py-2 text-xs text-zinc-600 truncate max-w-[200px]",
                  children: log.subject
                })]
              }, log.id))
            })]
          })
        })]
      })]
    })]
  });
});
const route112 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_emails,
  loader: loader$6
}, Symbol.toStringTag, { value: "Module" }));
const loader$5 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const env = args.context.cloudflare?.env || args.context.env || {};
  const apiUrl = env.VITE_API_URL || "https://studio-platform-api.slichti.workers.dev";
  try {
    const stats = await apiRequest("/stats/health", token, {}, apiUrl);
    return {
      stats,
      error: null
    };
  } catch (e) {
    return {
      stats: null,
      error: e.message || "Failed to load status"
    };
  }
};
const admin_status = UNSAFE_withComponentProps(function AdminStatus() {
  const {
    stats
  } = useLoaderData();
  const services = stats?.services || {};
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsx("h2", {
      className: "text-2xl font-bold mb-6 text-zinc-900 dark:text-zinc-100",
      children: "System Status"
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-lg mb-4 text-zinc-900 dark:text-zinc-200",
          children: "Core Services"
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsx(StatusItem, {
            name: "Database (D1)",
            status: services.database ? "operational" : "degraded"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "Authentication (Clerk)",
            status: "operational"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "Storage (R2)",
            status: "operational"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "CDN (Cloudflare)",
            status: "operational"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "Emails (Resend)",
            status: services.resend ? "operational" : "pending_config",
            label: services.resend ? "Operational" : "Missing API Key"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "SMS (Twilio)",
            status: services.twilio ? "operational" : "pending_config",
            label: services.twilio ? "Operational" : "Missing Credentials"
          }), /* @__PURE__ */ jsx(StatusItem, {
            name: "Payments (Stripe)",
            status: "pending_config",
            label: "Not Configured"
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-lg mb-4 text-zinc-900 dark:text-zinc-200",
          children: "Environment"
        }), /* @__PURE__ */ jsxs("div", {
          className: "grid grid-cols-2 gap-4 text-sm",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "p-3 bg-zinc-50 dark:bg-zinc-950 rounded border border-zinc-100 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400 block text-xs uppercase tracking-wide",
              children: "Environment"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-mono text-zinc-900 dark:text-zinc-200",
              children: typeof window !== "undefined" && (window.location.hostname.includes("dev") || window.location.hostname.includes("localhost")) ? "Development" : "Production"
            })]
          }), /* @__PURE__ */ jsxs("div", {
            className: "p-3 bg-zinc-50 dark:bg-zinc-950 rounded border border-zinc-100 dark:border-zinc-800",
            children: [/* @__PURE__ */ jsx("span", {
              className: "text-zinc-500 dark:text-zinc-400 block text-xs uppercase tracking-wide",
              children: "Region"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-mono text-zinc-900 dark:text-zinc-200",
              children: "Auto (Cloudflare)"
            })]
          })]
        })]
      })]
    })]
  });
});
function StatusItem({
  name,
  status,
  label
}) {
  const colors = {
    operational: "bg-green-500",
    degraded: "bg-yellow-500",
    down: "bg-red-500",
    pending_config: "bg-zinc-300 dark:bg-zinc-700"
  };
  const labels = {
    operational: "Operational",
    degraded: "Degraded",
    down: "Down",
    pending_config: "Pending Config"
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "flex items-center justify-between",
    children: [/* @__PURE__ */ jsx("div", {
      className: "font-medium text-zinc-700 dark:text-zinc-300",
      children: name
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-2",
      children: [/* @__PURE__ */ jsx("div", {
        className: `w-2.5 h-2.5 rounded-full ${colors[status]}`
      }), /* @__PURE__ */ jsx("span", {
        className: `text-sm ${status === "operational" ? "text-green-700 dark:text-green-400" : "text-zinc-500 dark:text-zinc-500"}`,
        children: label || labels[status]
      })]
    })]
  });
}
const route113 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_status,
  loader: loader$5
}, Symbol.toStringTag, { value: "Module" }));
const loader$4 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  if (!userId) return redirect("/sign-in");
  const token = await getToken();
  const url = new URL(args.request.url);
  const q = url.searchParams.get("q") || "";
  try {
    const [videosData, brandingData, tenantsData] = await Promise.all([
      apiRequest(`/admin/videos?q=${q}`, token),
      // Update API call
      apiRequest("/admin/branding", token),
      apiRequest("/admin/tenants", token)
    ]);
    return {
      videos: videosData.videos || [],
      stats: videosData.stats || {
        totalVideos: 0,
        totalStorageBytes: 0,
        processingCount: 0
      },
      brandingAssets: brandingData.assets || [],
      tenants: tenantsData || []
    };
  } catch (e) {
    console.error("Failed to fetch admin videos", e);
    return {
      videos: [],
      stats: {
        totalVideos: 0,
        totalStorageBytes: 0,
        processingCount: 0
      },
      brandingAssets: [],
      tenants: []
    };
  }
};
const action$1 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  const id = formData.get("id");
  if (intent === "delete_video" && id) {
    await apiRequest(`/admin/videos/${id}`, token, {
      method: "DELETE"
    });
  }
  if (intent === "delete_branding" && id) {
    await apiRequest(`/admin/branding/${id}`, token, {
      method: "DELETE"
    });
  }
  return {
    success: true
  };
};
const admin_videos = UNSAFE_withComponentProps(function AdminVideos() {
  const {
    videos,
    stats,
    brandingAssets,
    tenants
  } = useLoaderData();
  const submit = useSubmit();
  const [searchParams, setSearchParams] = useSearchParams();
  const currentTab = searchParams.get("tab") || "videos";
  const revalidator = useRevalidator();
  const [query, setQuery] = useState(searchParams.get("q") || "");
  const [tenantFilter, setTenantFilter] = useState("");
  const [previewVideo, setPreviewVideo] = useState(null);
  const [isUploadOpen, setIsUploadOpen] = useState(false);
  const [selectedTenantId, setSelectedTenantId] = useState("");
  const [uploadType, setUploadType] = useState("vod");
  const [uploading, setUploading] = useState(false);
  const [uploadStatus, setUploadStatus] = useState(null);
  const [shareVideo, setShareVideo] = useState(null);
  const [shareTenantId, setShareTenantId] = useState("");
  const [deleteVideoId, setDeleteVideoId] = useState(null);
  const [deleteBrandingId, setDeleteBrandingId] = useState(null);
  const [errorState, setErrorState] = useState({
    isOpen: false,
    message: ""
  });
  const [successState, setSuccessState] = useState({
    isOpen: false,
    message: ""
  });
  const handleShare = async () => {
    if (!shareVideo || !shareTenantId) return;
    try {
      const token = await window.Clerk?.session?.getToken();
      await apiRequest(`/admin/videos/${shareVideo.id}/share`, token, {
        method: "POST",
        body: JSON.stringify({
          tenantId: shareTenantId
        })
      });
      setSuccessState({
        isOpen: true,
        message: "Video shared successfully!"
      });
      setShareVideo(null);
      setShareTenantId("");
    } catch (e) {
      console.error(e);
      setErrorState({
        isOpen: true,
        message: "Share failed"
      });
    }
  };
  const handleSearch = (e) => {
    e.preventDefault();
    setSearchParams((prev) => {
      prev.set("q", query);
      return prev;
    });
  };
  const confirmDeleteVideo = () => {
    if (deleteVideoId) {
      submit({
        intent: "delete_video",
        id: deleteVideoId
      }, {
        method: "post"
      });
      setDeleteVideoId(null);
    }
  };
  const confirmDeleteBranding = () => {
    if (deleteBrandingId) {
      submit({
        intent: "delete_branding",
        id: deleteBrandingId
      }, {
        method: "post"
      });
      setDeleteBrandingId(null);
    }
  };
  const handleUpload = async (file) => {
    setUploading(true);
    setUploadStatus("Getting upload URL...");
    try {
      const token = await window.Clerk?.session?.getToken();
      const response = await apiRequest("/admin/videos/upload-url", token, {
        method: "POST",
        body: JSON.stringify({
          targetTenantId: selectedTenantId,
          type: uploadType
        })
      });
      const {
        uploadUrl,
        uid
      } = response;
      setUploadStatus("Uploading to Cloudflare...");
      const formData = new FormData();
      formData.append("file", file);
      const cfUpload = await fetch(uploadUrl, {
        method: "POST",
        body: formData
      });
      if (!cfUpload.ok) throw new Error("Upload to video server failed");
      setUploadStatus("Registering asset...");
      await apiRequest("/admin/videos", token, {
        method: "POST",
        body: JSON.stringify({
          targetTenantId: selectedTenantId,
          type: uploadType,
          title: file.name,
          cloudflareStreamId: uid,
          description: `Uploaded by Admin`
        })
      });
      setUploadStatus("Done!");
      setIsUploadOpen(false);
      revalidator.revalidate();
      setSelectedTenantId("");
      setUploadType("vod");
    } catch (e) {
      console.error(e);
      setErrorState({
        isOpen: true,
        message: "Upload failed: " + e.message
      });
    } finally {
      setUploading(false);
      setUploadStatus(null);
    }
  };
  const filteredVideos = videos.filter((v) => {
    if (tenantFilter && v.tenantId !== tenantFilter) return false;
    return true;
  });
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-6 relative",
    children: [/* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!deleteVideoId,
      onClose: () => setDeleteVideoId(null),
      onConfirm: confirmDeleteVideo,
      title: "Delete Video",
      message: "Are you sure you want to force delete this video? This cannot be undone.",
      confirmText: "Delete Video",
      isDestructive: true
    }), /* @__PURE__ */ jsx(ConfirmationDialog, {
      isOpen: !!deleteBrandingId,
      onClose: () => setDeleteBrandingId(null),
      onConfirm: confirmDeleteBranding,
      title: "Delete Branding Asset",
      message: "Are you sure you want to delete this branding asset?",
      confirmText: "Delete Asset",
      isDestructive: true
    }), /* @__PURE__ */ jsx(ErrorDialog, {
      isOpen: errorState.isOpen,
      onClose: () => setErrorState({
        ...errorState,
        isOpen: false
      }),
      message: errorState.message
    }), /* @__PURE__ */ jsx(SuccessDialog, {
      isOpen: successState.isOpen,
      onClose: () => setSuccessState({
        ...successState,
        isOpen: false
      }),
      message: successState.message
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-start",
      children: [/* @__PURE__ */ jsxs("div", {
        children: [/* @__PURE__ */ jsx("h1", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: "Platform Video Management"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400",
          children: "Monitor storage usage and manage video assets across all studios."
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: () => setIsUploadOpen(true),
        className: "bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 transition flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(Upload, {
          size: 16
        }), "Upload Asset"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-3 gap-4",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",
          children: "Total Videos"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: stats.totalVideos
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",
          children: "Total Storage"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: formatBytes(stats.totalStorageBytes)
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",
          children: "Processing"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100",
          children: stats.processingCount
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "border-b border-zinc-200 flex flex-col md:flex-row md:items-center justify-between gap-4 pb-0",
      children: [/* @__PURE__ */ jsxs("nav", {
        className: "-mb-px flex space-x-8",
        children: [/* @__PURE__ */ jsxs("button", {
          onClick: () => setSearchParams({
            tab: "videos"
          }),
          className: `
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${currentTab === "videos" ? "border-primary-500 text-primary-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,
          children: [/* @__PURE__ */ jsx(Film, {
            size: 16
          }), "Studio Videos", /* @__PURE__ */ jsx("span", {
            className: "bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",
            children: videos.length
          })]
        }), /* @__PURE__ */ jsxs("button", {
          onClick: () => setSearchParams({
            tab: "branding"
          }),
          className: `
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${currentTab === "branding" ? "border-primary-500 text-primary-600" : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,
          children: [/* @__PURE__ */ jsx(MonitorPlay, {
            size: 16
          }), "Branding Assets", /* @__PURE__ */ jsx("span", {
            className: "bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",
            children: brandingAssets.length
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-2 pb-2 md:pb-0",
        children: [/* @__PURE__ */ jsxs("form", {
          onSubmit: handleSearch,
          className: "relative",
          children: [/* @__PURE__ */ jsx(Search, {
            className: "absolute left-2.5 top-2.5 h-4 w-4 text-zinc-400"
          }), /* @__PURE__ */ jsx("input", {
            type: "search",
            placeholder: "Search videos...",
            value: query,
            onChange: (e) => setQuery(e.target.value),
            className: "pl-9 pr-4 py-2 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm w-64 focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "relative",
          children: [/* @__PURE__ */ jsxs("select", {
            value: tenantFilter,
            onChange: (e) => setTenantFilter(e.target.value),
            className: "pl-3 pr-8 py-2 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm appearance-none bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none cursor-pointer",
            children: [/* @__PURE__ */ jsx("option", {
              value: "",
              children: "All Tenants"
            }), tenants.map((t) => /* @__PURE__ */ jsx("option", {
              value: t.id,
              children: t.name
            }, t.id))]
          }), /* @__PURE__ */ jsx(Filter, {
            className: "absolute right-2.5 top-2.5 h-4 w-4 text-zinc-400 pointer-events-none"
          })]
        })]
      })]
    }), currentTab === "videos" ? /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",
      children: /* @__PURE__ */ jsxs("table", {
        className: "w-full text-sm text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-medium",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Video"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Tenant"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Status"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Size"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3 text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: [filteredVideos.map((video) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50/50 dark:hover:bg-zinc-800/50 group",
            children: [/* @__PURE__ */ jsx("td", {
              className: "px-4 py-3",
              children: /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-3",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "w-10 h-10 bg-zinc-100 dark:bg-zinc-800 rounded flex items-center justify-center text-zinc-400 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-zinc-600 dark:hover:text-zinc-300 transition",
                  onClick: () => setPreviewVideo(video),
                  children: /* @__PURE__ */ jsx(Play, {
                    size: 16,
                    fill: "currentColor"
                  })
                }), /* @__PURE__ */ jsxs("div", {
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "font-medium text-zinc-900 dark:text-zinc-100",
                    children: video.title || "Untitled"
                  }), /* @__PURE__ */ jsx("div", {
                    className: "text-xs text-zinc-400 font-mono",
                    children: video.id
                  })]
                })]
              })
            }), /* @__PURE__ */ jsxs("td", {
              className: "px-4 py-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "text-zinc-900 dark:text-zinc-100",
                children: video.tenantName || /* @__PURE__ */ jsx("span", {
                  className: "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 border border-zinc-200 dark:border-zinc-700",
                  children: "Platform"
                })
              }), video.tenantSlug && /* @__PURE__ */ jsx("div", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: video.tenantSlug
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3",
              children: /* @__PURE__ */ jsx(StatusBadge, {
                status: video.status
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3 text-zinc-600 dark:text-zinc-400 font-mono",
              children: formatBytes(video.sizeBytes)
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3 text-right",
              children: /* @__PURE__ */ jsxs("div", {
                className: "opacity-0 group-hover:opacity-100 transition-opacity flex justify-end gap-2",
                children: [/* @__PURE__ */ jsx("button", {
                  onClick: () => setPreviewVideo(video),
                  className: "p-1 text-zinc-400 hover:text-blue-600 hover:bg-blue-50 rounded transition",
                  title: "Preview",
                  children: /* @__PURE__ */ jsx(Eye, {
                    size: 16
                  })
                }), /* @__PURE__ */ jsx("button", {
                  onClick: () => setDeleteVideoId(video.id),
                  className: "p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",
                  title: "Force Delete",
                  children: /* @__PURE__ */ jsx(Trash2, {
                    size: 16
                  })
                }), !video.tenantId && /* @__PURE__ */ jsx("button", {
                  onClick: () => setShareVideo(video),
                  className: "p-1 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition",
                  title: "Share with Tenant",
                  children: /* @__PURE__ */ jsx(Share2, {
                    size: 16
                  })
                })]
              })
            })]
          }, video.id)), filteredVideos.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 5,
              className: "px-4 py-8 text-center text-zinc-500",
              children: "No videos found matching your filters."
            })
          })]
        })]
      })
    }) : /* @__PURE__ */ jsx("div", {
      className: "bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",
      children: /* @__PURE__ */ jsxs("table", {
        className: "w-full text-sm text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-medium",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Asset Title"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Type"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Tenant"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3",
              children: "Active"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-4 py-3 text-right",
              children: "Actions"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-100",
          children: [brandingAssets.map((asset) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50/50",
            children: [/* @__PURE__ */ jsxs("td", {
              className: "px-4 py-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900 dark:text-zinc-100",
                children: asset.title
              }), /* @__PURE__ */ jsx("div", {
                className: "text-xs text-zinc-400 font-mono truncate max-w-[150px]",
                children: asset.cloudflareStreamId
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3",
              children: /* @__PURE__ */ jsx("span", {
                className: `inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize ${asset.type === "intro" ? "bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300" : "bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300"}`,
                children: asset.type
              })
            }), /* @__PURE__ */ jsxs("td", {
              className: "px-4 py-3",
              children: [/* @__PURE__ */ jsx("div", {
                className: "text-zinc-900 dark:text-zinc-100",
                children: asset.tenantName
              }), /* @__PURE__ */ jsx("div", {
                className: "text-xs text-zinc-500 dark:text-zinc-400",
                children: asset.tenantSlug
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3 text-zinc-600 dark:text-zinc-400 font-mono",
              children: asset.active ? /* @__PURE__ */ jsxs("span", {
                className: "text-emerald-600 flex items-center gap-1 text-xs font-semibold",
                children: [/* @__PURE__ */ jsx(CheckCircle, {
                  size: 12
                }), " Yes"]
              }) : /* @__PURE__ */ jsx("span", {
                className: "text-zinc-400 text-xs",
                children: "No"
              })
            }), /* @__PURE__ */ jsx("td", {
              className: "px-4 py-3 text-right",
              children: /* @__PURE__ */ jsx("button", {
                onClick: () => setDeleteBrandingId(asset.id),
                className: "p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",
                title: "Force Delete",
                children: /* @__PURE__ */ jsx(Trash2, {
                  size: 16
                })
              })
            })]
          }, asset.id)), brandingAssets.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 5,
              className: "px-4 py-8 text-center text-zinc-500",
              children: "No branding assets found."
            })
          })]
        })]
      })
    }), isUploadOpen && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200 border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center mb-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-bold text-zinc-900 dark:text-zinc-100",
            children: "Upload Video"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setIsUploadOpen(false),
            className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",
            children: /* @__PURE__ */ jsx(X, {
              size: 20
            })
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Target"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full rounded-lg border-zinc-200 dark:border-zinc-700 text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: selectedTenantId,
              onChange: (e) => setSelectedTenantId(e.target.value),
              children: [/* @__PURE__ */ jsx("option", {
                value: "",
                children: "Platform Master Asset (No Tenant)"
              }), /* @__PURE__ */ jsx("optgroup", {
                label: "Tenants",
                children: tenants.map((t) => /* @__PURE__ */ jsxs("option", {
                  value: t.id,
                  children: [t.name, " (", t.slug, ")"]
                }, t.id))
              })]
            }), /* @__PURE__ */ jsx("p", {
              className: "text-xs text-zinc-500 dark:text-zinc-400 mt-1",
              children: selectedTenantId ? "Video will be owned by this tenant." : "Video will be available to the platform. You can share it with tenants later."
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Asset Type"
            }), /* @__PURE__ */ jsxs("div", {
              className: "grid grid-cols-3 gap-2",
              children: [/* @__PURE__ */ jsx("button", {
                onClick: () => setUploadType("vod"),
                className: `px-3 py-2 text-sm rounded-md border text-center ${uploadType === "vod" ? "bg-zinc-900 text-white border-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 dark:border-zinc-100" : "bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700"}`,
                children: "Video (VOD)"
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => setUploadType("intro"),
                className: `px-3 py-2 text-sm rounded-md border text-center ${uploadType === "intro" ? "bg-indigo-600 text-white border-indigo-600" : "bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700"}`,
                children: "Intro"
              }), /* @__PURE__ */ jsx("button", {
                onClick: () => setUploadType("outro"),
                className: `px-3 py-2 text-sm rounded-md border text-center ${uploadType === "outro" ? "bg-purple-600 text-white border-purple-600" : "bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,
                children: "Outro"
              })]
            })]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "File"
            }), /* @__PURE__ */ jsxs("div", {
              className: `border-2 border-dashed rounded-lg p-8 text-center transition cursor-pointer relative ${uploading ? "bg-zinc-50 dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800" : "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border-zinc-300 dark:border-zinc-700 hover:border-zinc-400 dark:hover:border-zinc-500"}`,
              onDragOver: (e) => {
                e.preventDefault();
                e.stopPropagation();
              },
              onDrop: (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.dataTransfer.files?.[0]) handleUpload(e.dataTransfer.files[0]);
              },
              children: [/* @__PURE__ */ jsx("input", {
                type: "file",
                accept: "video/*",
                className: "absolute inset-0 w-full h-full opacity-0 cursor-pointer",
                disabled: uploading,
                onChange: (e) => e.target.files?.[0] && handleUpload(e.target.files[0])
              }), uploading ? /* @__PURE__ */ jsxs("div", {
                className: "flex flex-col items-center gap-2",
                children: [/* @__PURE__ */ jsx(RefreshCw, {
                  className: "animate-spin text-zinc-400"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-500",
                  children: uploadStatus
                })]
              }) : /* @__PURE__ */ jsxs("div", {
                className: "flex flex-col items-center gap-2",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "w-10 h-10 bg-zinc-100 rounded-full flex items-center justify-center text-zinc-400",
                  children: /* @__PURE__ */ jsx(Upload, {
                    size: 20
                  })
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-sm text-zinc-600 font-medium",
                  children: "Click or Drag video here"
                }), /* @__PURE__ */ jsx("span", {
                  className: "text-xs text-zinc-400",
                  children: "MP4, MOV, etc."
                })]
              })]
            })]
          })]
        })]
      })
    }), previewVideo && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-black rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden flex flex-col max-h-[90vh]",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "p-4 flex justify-between items-center border-b border-zinc-800",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-bold text-white max-w-2xl truncate",
            children: previewVideo.title
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setPreviewVideo(null),
            className: "text-zinc-400 hover:text-white",
            children: /* @__PURE__ */ jsx(X, {
              size: 24
            })
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "flex-1 bg-black aspect-video relative",
          children: previewVideo.cloudflareStreamId ? /* @__PURE__ */ jsx("iframe", {
            src: `https://iframe.videodelivery.net/${previewVideo.cloudflareStreamId}`,
            className: "w-full h-full absolute inset-0",
            allow: "accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",
            allowFullScreen: true
          }) : /* @__PURE__ */ jsx("div", {
            className: "flex items-center justify-center h-full text-zinc-500",
            children: "Video not available"
          })
        }), /* @__PURE__ */ jsxs("div", {
          className: "p-4 bg-zinc-900 border-t border-zinc-800 text-sm text-zinc-400 flex gap-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("span", {
              className: "block text-zinc-600 text-xs uppercase font-bold",
              children: "Duration"
            }), previewVideo.duration ? Math.floor(previewVideo.duration / 60) + "m " + previewVideo.duration % 60 + "s" : "--"]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("span", {
              className: "block text-zinc-600 text-xs uppercase font-bold",
              children: "Size"
            }), formatBytes(previewVideo.sizeBytes)]
          }), /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("span", {
              className: "block text-zinc-600 text-xs uppercase font-bold",
              children: "Status"
            }), /* @__PURE__ */ jsx("span", {
              className: "capitalize",
              children: previewVideo.status
            })]
          })]
        })]
      })
    }), shareVideo && /* @__PURE__ */ jsx("div", {
      className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl shadow-xl max-w-sm w-full p-6 animate-in fade-in zoom-in duration-200 border border-zinc-200 dark:border-zinc-800",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "flex justify-between items-center mb-6",
          children: [/* @__PURE__ */ jsx("h2", {
            className: "text-lg font-bold text-zinc-900 dark:text-zinc-100",
            children: "Share Video"
          }), /* @__PURE__ */ jsx("button", {
            onClick: () => setShareVideo(null),
            className: "text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",
            children: /* @__PURE__ */ jsx(X, {
              size: 20
            })
          })]
        }), /* @__PURE__ */ jsxs("p", {
          className: "text-sm text-zinc-500 dark:text-zinc-400 mb-4",
          children: ["Give a tenant access to ", /* @__PURE__ */ jsx("strong", {
            children: shareVideo.title
          }), "."]
        }), /* @__PURE__ */ jsxs("div", {
          className: "space-y-4",
          children: [/* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("label", {
              className: "block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",
              children: "Select Tenant"
            }), /* @__PURE__ */ jsxs("select", {
              className: "w-full rounded-lg border-zinc-200 dark:border-zinc-700 text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",
              value: shareTenantId,
              onChange: (e) => setShareTenantId(e.target.value),
              children: [/* @__PURE__ */ jsx("option", {
                value: "",
                children: "Select a tenant..."
              }), tenants.map((t) => /* @__PURE__ */ jsx("option", {
                value: t.id,
                children: t.name
              }, t.id))]
            })]
          }), /* @__PURE__ */ jsx("button", {
            onClick: handleShare,
            disabled: !shareTenantId,
            className: "w-full bg-indigo-600 text-white py-2 rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",
            children: "Grant Access"
          })]
        })]
      })
    })]
  });
});
function StatusBadge({
  status
}) {
  if (status === "ready") {
    return /* @__PURE__ */ jsxs("span", {
      className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",
      children: [/* @__PURE__ */ jsx(CheckCircle, {
        size: 12
      }), " Ready"]
    });
  }
  if (status === "processing") {
    return /* @__PURE__ */ jsxs("span", {
      className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",
      children: [/* @__PURE__ */ jsx(RefreshCw, {
        size: 12,
        className: "animate-spin"
      }), " Processing"]
    });
  }
  if (status === "error") {
    return /* @__PURE__ */ jsxs("span", {
      className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300",
      children: [/* @__PURE__ */ jsx(AlertCircle, {
        size: 12
      }), " Error"]
    });
  }
  return /* @__PURE__ */ jsx("span", {
    className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300",
    children: status
  });
}
const route114 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action: action$1,
  default: admin_videos,
  loader: loader$4
}, Symbol.toStringTag, { value: "Module" }));
const loader$3 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  let data = {
    totals: {
      email: 0,
      sms: 0
    },
    tenants: []
  };
  try {
    const res = await apiRequest("/admin/stats/communications", token);
    if (res && !res.error) data = res;
  } catch (e) {
    console.error("Failed to load comms stats", e);
  }
  return {
    data
  };
};
const admin_comms = UNSAFE_withComponentProps(function AdminCommsPage() {
  const {
    data
  } = useLoaderData();
  const {
    totals,
    tenants
  } = data;
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-7xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",
        children: "Communications"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400",
        children: "System-wide Email & SMS usage and automation tracking."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-full",
          children: /* @__PURE__ */ jsx(Mail, {
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium text-zinc-500 dark:text-zinc-400",
            children: "Total Emails"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
            children: totals.email.toLocaleString()
          })]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm flex items-center gap-4",
        children: [/* @__PURE__ */ jsx("div", {
          className: "p-4 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 rounded-full",
          children: /* @__PURE__ */ jsx(MessageSquare, {
            size: 24
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("div", {
            className: "text-sm font-medium text-zinc-500 dark:text-zinc-400",
            children: "Total SMS"
          }), /* @__PURE__ */ jsx("div", {
            className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
            children: totals.sms.toLocaleString()
          })]
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",
      children: [/* @__PURE__ */ jsx("div", {
        className: "px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",
        children: /* @__PURE__ */ jsx("h3", {
          className: "font-semibold text-zinc-900 dark:text-zinc-100",
          children: "Tenant Usage & Automations"
        })
      }), /* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",
              children: "Tenant"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase text-right",
              children: "Emails"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase text-right",
              children: "SMS"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",
              children: "Active Automations"
            })]
          })
        }), /* @__PURE__ */ jsxs("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: [tenants.map((t) => /* @__PURE__ */ jsxs("tr", {
            className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50",
            children: [/* @__PURE__ */ jsxs("td", {
              className: "px-6 py-4",
              children: [/* @__PURE__ */ jsx("div", {
                className: "font-medium text-zinc-900 dark:text-zinc-100",
                children: t.name
              }), /* @__PURE__ */ jsx("div", {
                className: "text-xs text-zinc-500 dark:text-zinc-400 font-mono",
                children: t.slug
              })]
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right font-mono text-zinc-700 dark:text-zinc-300",
              children: t.emailCount.toLocaleString()
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4 text-right font-mono text-zinc-700 dark:text-zinc-300",
              children: t.smsCount.toLocaleString()
            }), /* @__PURE__ */ jsx("td", {
              className: "px-6 py-4",
              children: t.automations.length === 0 ? /* @__PURE__ */ jsx("span", {
                className: "text-xs text-zinc-400 dark:text-zinc-500 italic",
                children: "None active"
              }) : /* @__PURE__ */ jsx("div", {
                className: "flex flex-wrap gap-2",
                children: t.automations.map((a, i) => /* @__PURE__ */ jsxs("span", {
                  className: "inline-flex items-center px-2 py-1 rounded-md bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 text-xs border border-zinc-200 dark:border-zinc-700",
                  children: [/* @__PURE__ */ jsx(Zap, {
                    size: 10,
                    className: "mr-1 text-amber-500"
                  }), formatAutomationType(a.type)]
                }, i))
              })
            })]
          }, t.id)), tenants.length === 0 && /* @__PURE__ */ jsx("tr", {
            children: /* @__PURE__ */ jsx("td", {
              colSpan: 4,
              className: "px-6 py-12 text-center text-zinc-500",
              children: "No data available"
            })
          })]
        })]
      })]
    })]
  });
});
function formatAutomationType(type) {
  return type.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase());
}
const ErrorBoundary2 = UNSAFE_withErrorBoundaryProps(function ErrorBoundary3() {
  const error = useRouteError();
  return /* @__PURE__ */ jsxs("div", {
    className: "flex flex-col items-center justify-center min-h-[50vh] text-red-600 p-4",
    children: [/* @__PURE__ */ jsx(AlertTriangle, {
      size: 48,
      className: "mb-4"
    }), /* @__PURE__ */ jsx("h1", {
      className: "text-xl font-bold mb-2",
      children: "Failed to load Communications Dashboard"
    }), /* @__PURE__ */ jsx("p", {
      className: "text-sm text-zinc-600 mb-4",
      children: isRouteErrorResponse(error) ? `${error.status} ${error.statusText}` : error instanceof Error ? error.message : "Unknown Error"
    }), /* @__PURE__ */ jsx(Link, {
      to: "/admin",
      className: "text-blue-600 hover:underline",
      children: "Return to Admin Dashboard"
    })]
  });
});
const route115 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  ErrorBoundary: ErrorBoundary2,
  default: admin_comms,
  loader: loader$3
}, Symbol.toStringTag, { value: "Module" }));
const loader$2 = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const [tenants, tickets] = await Promise.all([
      apiRequest("/admin/tenants", token),
      apiRequest("/chat/tickets?status=open", token).catch(() => [])
      // Graceful fail
    ]);
    return {
      tenants,
      tickets,
      error: null
    };
  } catch (e) {
    return {
      tenants: [],
      tickets: [],
      error: e.message
    };
  }
};
const action = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  const formData = await args.request.formData();
  const intent = formData.get("intent");
  if (intent === "create_support_room") {
    formData.get("tenantId");
    const tenantSlug = formData.get("tenantSlug");
    try {
      const room = await apiRequest("/chat/rooms", token, {
        method: "POST",
        headers: {
          "X-Tenant-Slug": tenantSlug
        },
        // Context for creating room in that tenant
        body: JSON.stringify({
          type: "support",
          name: "Platform Support",
          metadata: {
            createdBy: "admin"
          }
        })
      });
      return {
        success: true,
        roomId: room.id
      };
    } catch (e) {
      return {
        error: e.message
      };
    }
  }
  return null;
};
const admin_chat = UNSAFE_withComponentProps(function AdminChat() {
  const {
    tenants,
    tickets: initialTickets,
    error
  } = useLoaderData();
  const tickets = initialTickets || [];
  useLoaderData();
  const [loadingMap, setLoadingMap] = useState({});
  const handleOpenSupport = async (tenant) => {
    setLoadingMap((prev) => ({
      ...prev,
      [tenant.id]: true
    }));
    try {
      const token = await window.Clerk.session.getToken();
      const rooms = await apiRequest(`/chat/rooms?type=support`, token, {
        headers: {
          "X-Tenant-Slug": tenant.slug
        }
      });
      let roomId;
      if (rooms && rooms.length > 0) {
        roomId = rooms[0].id;
      } else {
        const newRoom = await apiRequest("/chat/rooms", token, {
          method: "POST",
          headers: {
            "X-Tenant-Slug": tenant.slug
          },
          body: JSON.stringify({
            type: "support",
            name: "Platform Support",
            metadata: {
              createdBy: "admin"
            }
          })
        });
        roomId = newRoom.id;
      }
      window.location.href = `/admin/chat/${roomId}`;
    } catch (e) {
      toast.error("Failed to open support chat: " + e);
      setLoadingMap((prev) => ({
        ...prev,
        [tenant.id]: false
      }));
    }
  };
  if (error) {
    return /* @__PURE__ */ jsx("div", {
      className: "p-8",
      children: /* @__PURE__ */ jsxs("div", {
        className: "bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",
        children: ["Error: ", error]
      })
    });
  }
  return /* @__PURE__ */ jsxs("div", {
    className: "p-8 max-w-6xl mx-auto",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsxs("h1", {
        className: "text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
        children: [/* @__PURE__ */ jsx(MessageCircle, {
          className: "text-blue-600"
        }), "Chat System"]
      }), /* @__PURE__ */ jsx("p", {
        className: "text-zinc-500 dark:text-zinc-400 mt-1",
        children: "Manage tenant chat rooms and platform support"
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center justify-between mb-4",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Shield, {
            className: "text-indigo-600 dark:text-indigo-400",
            size: 20
          }), "Support Inbox (Open)"]
        }), /* @__PURE__ */ jsxs("div", {
          className: "text-sm text-zinc-500",
          children: [tickets.length, " open tickets"]
        })]
      }), /* @__PURE__ */ jsx("div", {
        className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden shadow-sm",
        children: tickets.length === 0 ? /* @__PURE__ */ jsx("div", {
          className: "p-8 text-center text-zinc-500 dark:text-zinc-400",
          children: "No open support tickets found. Great job!"
        }) : /* @__PURE__ */ jsxs("table", {
          className: "w-full text-left text-sm",
          children: [/* @__PURE__ */ jsx("thead", {
            className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-100 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400",
            children: /* @__PURE__ */ jsxs("tr", {
              children: [/* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Tenant"
              }), /* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Subject"
              }), /* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Priority"
              }), /* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Status"
              }), /* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Assigned"
              }), /* @__PURE__ */ jsx("th", {
                className: "p-4 font-medium",
                children: "Action"
              })]
            })
          }), /* @__PURE__ */ jsx("tbody", {
            className: "divide-y divide-zinc-100",
            children: tickets.map((ticket) => /* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50 group",
              children: [/* @__PURE__ */ jsxs("td", {
                className: "p-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "font-medium text-zinc-900 dark:text-zinc-100",
                  children: ticket.tenantName
                }), /* @__PURE__ */ jsxs("div", {
                  className: "text-xs text-zinc-500 dark:text-zinc-400",
                  children: ["ID: ", ticket.tenantId?.slice(0, 8)]
                })]
              }), /* @__PURE__ */ jsxs("td", {
                className: "p-4",
                children: [/* @__PURE__ */ jsx("div", {
                  className: "text-zinc-900 dark:text-zinc-100",
                  children: ticket.name
                }), /* @__PURE__ */ jsx("div", {
                  className: "text-xs text-zinc-500 dark:text-zinc-400",
                  children: new Date(ticket.createdAt).toLocaleDateString()
                })]
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4",
                children: /* @__PURE__ */ jsx("span", {
                  className: `px-2 py-1 rounded text-xs font-medium capitalize
                                            ${ticket.priority === "urgent" ? "bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300" : ticket.priority === "high" ? "bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300" : "bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,
                  children: ticket.priority || "normal"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4",
                children: /* @__PURE__ */ jsx("span", {
                  className: "px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs font-medium capitalize",
                  children: ticket.status || "open"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4 text-zinc-500 dark:text-zinc-400",
                children: ticket.assignedToId ? "Agent" : "Unassigned"
              }), /* @__PURE__ */ jsx("td", {
                className: "p-4",
                children: /* @__PURE__ */ jsx(Link, {
                  to: `/admin/chat/${ticket.id}`,
                  className: "px-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm font-medium hover:bg-zinc-50 dark:hover:bg-zinc-700 text-indigo-600 dark:text-indigo-400",
                  children: "Open"
                })
              })]
            }, ticket.id))
          })]
        })
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-4 gap-4 mb-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-zinc-900 dark:text-zinc-100",
          children: tenants?.length || 0
        }), /* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "Total Tenants"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-green-600 dark:text-green-400",
          children: tenants?.filter((t) => t.features?.includes("chat"))?.length || 0
        }), /* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "With Chat Enabled"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-blue-600 dark:text-blue-400",
          children: tickets.length
        }), /* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "Open Tickets"
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",
        children: [/* @__PURE__ */ jsx("div", {
          className: "text-3xl font-bold text-purple-600 dark:text-purple-400",
          children: "â€”"
        }), /* @__PURE__ */ jsx("div", {
          className: "text-sm text-zinc-500 dark:text-zinc-400",
          children: "Messages Today"
        })]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 flex items-center justify-between",
        children: [/* @__PURE__ */ jsx("h2", {
          className: "font-medium text-zinc-900 dark:text-zinc-100",
          children: "Tenant Chat Rooms"
        }), /* @__PURE__ */ jsx("span", {
          className: "text-xs text-zinc-500 dark:text-zinc-400",
          children: "Real-time via Durable Objects"
        })]
      }), tenants.length === 0 ? /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500 dark:text-zinc-400",
        children: "No tenants available"
      }) : /* @__PURE__ */ jsx("div", {
        className: "divide-y divide-zinc-100 dark:divide-zinc-800",
        children: tenants.slice(0, 50).map((tenant) => /* @__PURE__ */ jsxs("div", {
          className: "p-4 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",
          children: [/* @__PURE__ */ jsxs("div", {
            className: "flex items-center gap-4",
            children: [/* @__PURE__ */ jsx("div", {
              className: "w-10 h-10 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg flex items-center justify-center font-medium",
              children: tenant.name?.charAt(0) || "?"
            }), /* @__PURE__ */ jsxs("div", {
              children: [/* @__PURE__ */ jsx("h3", {
                className: "font-medium text-zinc-900 dark:text-zinc-100",
                children: tenant.name
              }), /* @__PURE__ */ jsxs("div", {
                className: "flex items-center gap-2 text-sm text-zinc-500 dark:text-zinc-400",
                children: [/* @__PURE__ */ jsx("span", {
                  children: tenant.slug
                }), tenant.features?.includes("chat") && /* @__PURE__ */ jsx("span", {
                  className: "px-1.5 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-[10px] font-bold",
                  children: "CHAT ACTIVE"
                })]
              })]
            })]
          }), /* @__PURE__ */ jsx("div", {
            className: "flex items-center gap-2",
            children: /* @__PURE__ */ jsxs("button", {
              onClick: () => handleOpenSupport(tenant),
              disabled: loadingMap[tenant.id],
              className: "flex items-center gap-1 px-3 py-1.5 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg disabled:opacity-50",
              children: [/* @__PURE__ */ jsx(Shield, {
                size: 14
              }), loadingMap[tenant.id] ? "Opening..." : "Support"]
            })
          })]
        }, tenant.id))
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "mt-8 bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 rounded-xl p-4",
      children: [/* @__PURE__ */ jsx("h4", {
        className: "font-medium text-purple-900 dark:text-purple-300 mb-2",
        children: "Chat System Features"
      }), /* @__PURE__ */ jsxs("ul", {
        className: "text-sm text-purple-800 dark:text-purple-300 space-y-1",
        children: [/* @__PURE__ */ jsxs("li", {
          children: ["â€¢ ", /* @__PURE__ */ jsx("strong", {
            children: "Durable Objects:"
          }), " Real-time WebSocket connections with SQLite persistence"]
        }), /* @__PURE__ */ jsxs("li", {
          children: ["â€¢ ", /* @__PURE__ */ jsx("strong", {
            children: "Room Types:"
          }), " Support, Class, Community, Direct messaging"]
        }), /* @__PURE__ */ jsxs("li", {
          children: ["â€¢ ", /* @__PURE__ */ jsx("strong", {
            children: "User Presence:"
          }), " Live online/offline status tracking"]
        }), /* @__PURE__ */ jsxs("li", {
          children: ["â€¢ ", /* @__PURE__ */ jsx("strong", {
            children: "Message History:"
          }), " Full persistence to D1 database"]
        })]
      })]
    })]
  });
});
const route116 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  action,
  default: admin_chat,
  loader: loader$2
}, Symbol.toStringTag, { value: "Module" }));
const loader$1 = async (args) => {
  const {
    getToken,
    userId
  } = await getAuth(args);
  const token = await getToken();
  const roomId = args.params.roomId;
  if (!userId) throw new Response("Unauthorized", {
    status: 401
  });
  try {
    const room = await apiRequest(`/chat/rooms/${roomId}`, token);
    const me = await apiRequest("/users/me", token);
    return {
      room,
      token,
      user: {
        id: me.userId,
        name: me.firstName + " " + me.lastName
      },
      apiUrl: API_URL$1
    };
  } catch (e) {
    throw new Response("Room not found or access denied", {
      status: 404
    });
  }
};
const admin_chat_$roomId = UNSAFE_withComponentProps(function AdminChatRoom() {
  const {
    room,
    token,
    user,
    apiUrl
  } = useLoaderData();
  const [status, setStatus] = useState(room.status || "open");
  const [priority, setPriority] = useState(room.priority || "normal");
  const [assignee, setAssignee] = useState(room.assignedToId || null);
  const updateTicket = async (updates) => {
    try {
      await apiRequest(`/chat/rooms/${room.id}`, token, {
        method: "PATCH",
        body: JSON.stringify(updates)
      });
      if (updates.status) setStatus(updates.status);
      if (updates.priority) setPriority(updates.priority);
      if (updates.assignedToId !== void 0) setAssignee(updates.assignedToId);
    } catch (e) {
      toast.error("Failed to update ticket");
    }
  };
  return /* @__PURE__ */ jsxs("div", {
    className: "h-[calc(100vh-64px)] bg-zinc-50 flex flex-col",
    children: [/* @__PURE__ */ jsxs("header", {
      className: "bg-white border-b border-zinc-200 px-6 py-3 flex items-center justify-between",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsx(Link, {
          to: "/admin/chat",
          className: "p-2 hover:bg-zinc-100 rounded-full text-zinc-500",
          children: /* @__PURE__ */ jsx(ArrowLeft, {
            size: 20
          })
        }), /* @__PURE__ */ jsxs("div", {
          children: [/* @__PURE__ */ jsx("h1", {
            className: "font-bold text-zinc-900 leading-tight",
            children: room.name
          }), /* @__PURE__ */ jsxs("div", {
            className: "text-xs text-zinc-500 flex items-center gap-2",
            children: [/* @__PURE__ */ jsx("span", {
              className: "uppercase tracking-wider font-semibold",
              children: room.type
            }), /* @__PURE__ */ jsx("span", {
              children: "â€¢"
            }), /* @__PURE__ */ jsx("span", {
              className: "font-mono text-zinc-400",
              children: room.id.slice(0, 8)
            })]
          })]
        })]
      }), room.type === "support" && /* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-3",
        children: [/* @__PURE__ */ jsx("div", {
          className: "flex flex-col items-end",
          children: /* @__PURE__ */ jsxs("select", {
            value: status,
            onChange: (e) => updateTicket({
              status: e.target.value
            }),
            className: `text-sm rounded-md border-zinc-200 py-1 pl-2 pr-6 font-medium ${status === "open" ? "text-green-600 bg-green-50" : status === "closed" ? "text-zinc-600 bg-zinc-100" : "text-blue-600 bg-blue-50"}`,
            children: [/* @__PURE__ */ jsx("option", {
              value: "open",
              children: "Open"
            }), /* @__PURE__ */ jsx("option", {
              value: "in_progress",
              children: "In Progress"
            }), /* @__PURE__ */ jsx("option", {
              value: "closed",
              children: "Closed"
            })]
          })
        }), /* @__PURE__ */ jsx("div", {
          className: "flex flex-col items-end",
          children: /* @__PURE__ */ jsxs("select", {
            value: priority,
            onChange: (e) => updateTicket({
              priority: e.target.value
            }),
            className: `text-sm rounded-md border-zinc-200 py-1 pl-2 pr-6 font-medium ${priority === "urgent" ? "text-red-700 bg-red-50" : priority === "high" ? "text-orange-700 bg-orange-50" : "text-zinc-600 bg-zinc-50"}`,
            children: [/* @__PURE__ */ jsx("option", {
              value: "low",
              children: "Low Priority"
            }), /* @__PURE__ */ jsx("option", {
              value: "normal",
              children: "Normal"
            }), /* @__PURE__ */ jsx("option", {
              value: "high",
              children: "High Priority"
            }), /* @__PURE__ */ jsx("option", {
              value: "urgent",
              children: "Urgent"
            })]
          })
        }), /* @__PURE__ */ jsx("button", {
          onClick: () => updateTicket({
            assignedToId: assignee ? null : user.id
          }),
          className: "text-sm px-3 py-1 bg-white border border-zinc-200 rounded-md text-zinc-600 hover:bg-zinc-50",
          children: assignee ? assignee === user.id ? "Assigned to You" : "Assigned" : "Assign to Me"
        })]
      }), !room.type.includes("support") && /* @__PURE__ */ jsx("div", {
        className: "flex items-center gap-2",
        children: /* @__PURE__ */ jsx("button", {
          className: "p-2 hover:bg-zinc-100 rounded-lg text-zinc-400",
          children: /* @__PURE__ */ jsx(Settings, {
            size: 20
          })
        })
      })]
    }), /* @__PURE__ */ jsx("main", {
      className: "flex-1 p-6 flex justify-center overflow-hidden",
      children: /* @__PURE__ */ jsx("div", {
        className: "w-full max-w-4xl h-full flex flex-col",
        children: /* @__PURE__ */ jsx(ChatWindow, {
          roomId: room.id,
          token,
          currentUser: user,
          wsUrl: apiUrl
        })
      })
    })]
  });
});
const route117 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_chat_$roomId,
  loader: loader$1
}, Symbol.toStringTag, { value: "Module" }));
const loader = async (args) => {
  const {
    getToken
  } = await getAuth(args);
  const token = await getToken();
  try {
    const logs = await apiRequest("/admin/logs", token);
    return {
      logs,
      error: null
    };
  } catch (e) {
    return {
      logs: [],
      error: e.message
    };
  }
};
const admin_logs = UNSAFE_withComponentProps(function AdminLogs() {
  const {
    logs
  } = useLoaderData();
  const [expandedLog, setExpandedLog] = useState(null);
  const handleExport = () => {
    const headers = ["Timestamp", "Action", "Actor Email", "Actor Name", "Target ID", "Details"];
    const rows = (logs || []).map((log) => [
      new Date(log.createdAt).toISOString(),
      log.action,
      log.actorEmail || "",
      `${log.actorProfile?.firstName || ""} ${log.actorProfile?.lastName || ""}`.trim() || "System",
      log.targetId || "",
      JSON.stringify(log.details || {}).replace(/,/g, ";")
      // Escape commas
    ]);
    const csv = [headers, ...rows].map((r) => r.map((c) => `"${c}"`).join(",")).join("\n");
    const blob = new Blob([csv], {
      type: "text/csv"
    });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `audit_logs_${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
  };
  const getActionBadge = (action2) => {
    if (action2 === "tenant.created") return /* @__PURE__ */ jsx("span", {
      className: "bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: "New Studio"
    });
    if (action2.includes("admin")) return /* @__PURE__ */ jsx("span", {
      className: "bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: "Admin"
    });
    if (action2 === "USER_LOGIN") return /* @__PURE__ */ jsx("span", {
      className: "bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: "Login"
    });
    if (action2 === "USER_LOGOUT") return /* @__PURE__ */ jsx("span", {
      className: "bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: "Logout"
    });
    if (action2.includes("IMPERSONATION")) return /* @__PURE__ */ jsx("span", {
      className: "bg-amber-100 dark:bg-amber-900/50 text-amber-800 dark:text-amber-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: "Impersonation"
    });
    return /* @__PURE__ */ jsx("span", {
      className: "bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 px-2 py-0.5 rounded text-xs font-bold uppercase",
      children: action2.replace(/_/g, " ")
    });
  };
  const getDetailsSummary = (log) => {
    if (log.action === "tenant.created" && log.details) {
      return /* @__PURE__ */ jsxs("span", {
        className: "text-zinc-600 dark:text-zinc-300",
        children: ["Created ", /* @__PURE__ */ jsx("strong", {
          children: log.details.name
        }), " (", log.details.slug, ")", /* @__PURE__ */ jsx("span", {
          className: "mx-1 text-zinc-400",
          children: "â€¢"
        }), "Tier: ", log.details.tier]
      });
    }
    if (log.details?.message) {
      return /* @__PURE__ */ jsx("span", {
        className: "text-zinc-600 dark:text-zinc-300",
        children: log.details.message
      });
    }
    return /* @__PURE__ */ jsx("span", {
      className: "text-zinc-400 italic",
      children: "View details..."
    });
  };
  return /* @__PURE__ */ jsxs("div", {
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex justify-between items-center mb-6",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "flex items-center gap-4",
        children: [/* @__PURE__ */ jsxs("h2", {
          className: "text-2xl font-bold flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Activity, {
            className: "text-blue-600"
          }), "Activity Logs"]
        }), /* @__PURE__ */ jsxs("span", {
          className: "px-2 py-1 bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 rounded text-xs font-medium flex items-center gap-1",
          children: [/* @__PURE__ */ jsx(Shield, {
            size: 12
          }), "SOC 2 Compliant"]
        })]
      }), /* @__PURE__ */ jsxs("button", {
        onClick: handleExport,
        className: "flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg text-sm font-medium hover:opacity-90 transition-opacity",
        children: [/* @__PURE__ */ jsx(Download, {
          size: 16
        }), "Export CSV"]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",
      children: [/* @__PURE__ */ jsxs("table", {
        className: "w-full text-left",
        children: [/* @__PURE__ */ jsx("thead", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800",
          children: /* @__PURE__ */ jsxs("tr", {
            children: [/* @__PURE__ */ jsx("th", {
              className: "w-8"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Time"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Action"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Actor"
            }), /* @__PURE__ */ jsx("th", {
              className: "px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",
              children: "Summary"
            })]
          })
        }), /* @__PURE__ */ jsx("tbody", {
          className: "divide-y divide-zinc-100 dark:divide-zinc-800",
          children: logs.map((log) => /* @__PURE__ */ jsxs(Fragment, {
            children: [/* @__PURE__ */ jsxs("tr", {
              className: "hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors cursor-pointer",
              onClick: () => setExpandedLog(expandedLog === log.id ? null : log.id),
              children: [/* @__PURE__ */ jsx("td", {
                className: "pl-4",
                children: expandedLog === log.id ? /* @__PURE__ */ jsx(ChevronDown, {
                  size: 16,
                  className: "text-zinc-400"
                }) : /* @__PURE__ */ jsx(ChevronRight, {
                  size: 16,
                  className: "text-zinc-400"
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 whitespace-nowrap text-sm text-zinc-500 dark:text-zinc-400",
                children: format(new Date(log.createdAt), "MMM d, h:mm a")
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 whitespace-nowrap",
                children: getActionBadge(log.action)
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 whitespace-nowrap",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "flex flex-col",
                  children: [/* @__PURE__ */ jsxs("span", {
                    className: "text-sm font-medium text-zinc-900 dark:text-zinc-100",
                    children: [log.actorProfile?.firstName, " ", log.actorProfile?.lastName || "System"]
                  }), /* @__PURE__ */ jsx("span", {
                    className: "text-xs text-zinc-400",
                    children: log.actorEmail
                  })]
                })
              }), /* @__PURE__ */ jsx("td", {
                className: "px-6 py-4 text-sm",
                children: getDetailsSummary(log)
              })]
            }, log.id), expandedLog === log.id && /* @__PURE__ */ jsx("tr", {
              className: "bg-zinc-50/50 dark:bg-zinc-900/30",
              children: /* @__PURE__ */ jsx("td", {
                colSpan: 5,
                className: "px-6 pb-6 pt-2",
                children: /* @__PURE__ */ jsxs("div", {
                  className: "bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded p-4 text-xs font-mono overflow-auto max-h-64 dark:text-zinc-300",
                  children: [/* @__PURE__ */ jsx("div", {
                    className: "mb-2 text-zinc-500 dark:text-zinc-400 font-sans font-bold uppercase tracking-wider",
                    children: "Raw Details"
                  }), /* @__PURE__ */ jsx("pre", {
                    children: JSON.stringify(log.details, null, 2)
                  }), /* @__PURE__ */ jsxs("div", {
                    className: "mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-800 flex gap-4 text-zinc-400",
                    children: [/* @__PURE__ */ jsxs("span", {
                      children: ["Target ID: ", log.targetId || "N/A"]
                    }), /* @__PURE__ */ jsxs("span", {
                      children: ["Actor ID: ", log.actorId]
                    })]
                  })]
                })
              })
            })]
          }))
        })]
      }), logs.length === 0 && /* @__PURE__ */ jsx("div", {
        className: "p-8 text-center text-zinc-500",
        children: "No activity logs found."
      })]
    })]
  });
});
const route118 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: admin_logs,
  loader
}, Symbol.toStringTag, { value: "Module" }));
const help = UNSAFE_withComponentProps(function HelpLayout() {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const navigation = [{
    category: "Getting Started",
    items: [{
      name: "Welcome to Studio Platform",
      href: "/help",
      icon: GraduationCap
    }, {
      name: "Setting up your Studio",
      href: "/help/setup",
      icon: Settings
    }]
  }, {
    category: "Mobile App",
    items: [{
      name: "White Label App Builder",
      href: "/help/mobile-builder",
      icon: Smartphone
    }]
  }, {
    category: "Classes & Schedule",
    items: [{
      name: "Creating Classes",
      href: "/help/classes",
      icon: Book
    }]
  }];
  return /* @__PURE__ */ jsxs("div", {
    className: "min-h-screen bg-white dark:bg-zinc-950 flex flex-col",
    children: [/* @__PURE__ */ jsx("header", {
      className: "sticky top-0 z-40 w-full border-b border-zinc-200 dark:border-zinc-800 bg-white/80 dark:bg-zinc-950/80 backdrop-blur-md",
      children: /* @__PURE__ */ jsxs("div", {
        className: "flex h-16 items-center px-4 md:px-8",
        children: [/* @__PURE__ */ jsx("button", {
          className: "mr-4 md:hidden text-zinc-500",
          onClick: () => setSidebarOpen(!sidebarOpen),
          children: sidebarOpen ? /* @__PURE__ */ jsx(X, {}) : /* @__PURE__ */ jsx(Menu$1, {})
        }), /* @__PURE__ */ jsxs(Link, {
          to: "/",
          className: "flex items-center gap-2 font-bold text-lg mr-8 text-zinc-900 dark:text-zinc-100",
          children: [/* @__PURE__ */ jsx("div", {
            className: "w-8 h-8 bg-zinc-900 dark:bg-zinc-100 rounded-lg flex items-center justify-center text-white dark:text-zinc-900",
            children: /* @__PURE__ */ jsx(Book, {
              size: 18
            })
          }), /* @__PURE__ */ jsx("span", {
            children: "Help Center"
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex-1 max-w-md hidden md:flex items-center relative",
          children: [/* @__PURE__ */ jsx(Search, {
            className: "absolute left-3 text-zinc-400",
            size: 16
          }), /* @__PURE__ */ jsx("input", {
            type: "text",
            placeholder: "Search documentation...",
            className: "w-full bg-zinc-100 dark:bg-zinc-900 border-none rounded-full py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
          })]
        }), /* @__PURE__ */ jsx("div", {
          className: "ml-auto flex items-center gap-4",
          children: /* @__PURE__ */ jsx(Link, {
            to: "/sign-in",
            className: "text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",
            children: "Return to App"
          })
        })]
      })
    }), /* @__PURE__ */ jsxs("div", {
      className: "flex-1 flex",
      children: [/* @__PURE__ */ jsx("aside", {
        className: `fixed inset-y-0 left-0 z-30 w-64 transform bg-white dark:bg-zinc-950 border-r border-zinc-200 dark:border-zinc-800 transition-transform duration-200 ease-in-out md:translate-x-0 md:static md:block pt-20 md:pt-8 ${sidebarOpen ? "translate-x-0" : "-translate-x-full"}`,
        children: /* @__PURE__ */ jsx("nav", {
          className: "px-4 space-y-8",
          children: navigation.map((group, idx) => /* @__PURE__ */ jsxs("div", {
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2 px-2",
              children: group.category
            }), /* @__PURE__ */ jsx("div", {
              className: "space-y-1",
              children: group.items.map((item) => /* @__PURE__ */ jsxs(NavLink, {
                to: item.href,
                end: item.href === "/help",
                onClick: () => setSidebarOpen(false),
                className: ({
                  isActive
                }) => `flex items-center gap-2 px-2 py-1.5 rounded-lg text-sm font-medium transition-colors ${isActive ? "bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300" : "text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-900 hover:text-zinc-900 dark:hover:text-zinc-100"}`,
                children: [/* @__PURE__ */ jsx(item.icon, {
                  size: 16,
                  className: "opacity-70"
                }), item.name]
              }, item.href))
            })]
          }, idx))
        })
      }), /* @__PURE__ */ jsx("main", {
        className: "flex-1 min-w-0 px-4 md:px-12 py-8 md:py-12",
        children: /* @__PURE__ */ jsx("div", {
          className: "max-w-3xl mx-auto",
          children: /* @__PURE__ */ jsx(Outlet, {})
        })
      })]
    })]
  });
});
const route119 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: help
}, Symbol.toStringTag, { value: "Module" }));
const help_mobileBuilder = UNSAFE_withComponentProps(function MobileBuilderGuide() {
  return /* @__PURE__ */ jsxs("article", {
    className: "prose prose-zinc dark:prose-invert max-w-none",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "flex items-center gap-3 mb-6 not-prose",
      children: [/* @__PURE__ */ jsx("div", {
        className: "p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600 dark:text-purple-400",
        children: /* @__PURE__ */ jsx(Smartphone, {
          size: 24
        })
      }), /* @__PURE__ */ jsx("div", {
        className: "text-sm font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wide",
        children: "Feature Guide"
      })]
    }), /* @__PURE__ */ jsx("h1", {
      className: "text-4xl font-bold mb-6",
      children: "White Label Mobile App Builder"
    }), /* @__PURE__ */ jsx("p", {
      className: "text-xl text-zinc-500 mb-8 leading-relaxed",
      children: `Transform your studio's digital presence with a fully branded "White Label" mobile app. Your students can book classes, manage memberships, and receive push notifications directly from their home screen.`
    }), /* @__PURE__ */ jsxs("div", {
      className: "bg-zinc-50 dark:bg-zinc-900 rounded-xl p-6 mb-8 border border-zinc-200 dark:border-zinc-800 not-prose",
      children: [/* @__PURE__ */ jsx("h3", {
        className: "text-lg font-bold mb-4",
        children: "What's Included?"
      }), /* @__PURE__ */ jsxs("ul", {
        className: "grid grid-cols-1 md:grid-cols-2 gap-3",
        children: [/* @__PURE__ */ jsxs("li", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Check, {
            size: 16,
            className: "text-green-500"
          }), /* @__PURE__ */ jsx("span", {
            children: "Custom App Icon & Name"
          })]
        }), /* @__PURE__ */ jsxs("li", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Check, {
            size: 16,
            className: "text-green-500"
          }), /* @__PURE__ */ jsx("span", {
            children: "Branded Splash Screen"
          })]
        }), /* @__PURE__ */ jsxs("li", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Check, {
            size: 16,
            className: "text-green-500"
          }), /* @__PURE__ */ jsx("span", {
            children: "Native Biometric Login (FaceID)"
          })]
        }), /* @__PURE__ */ jsxs("li", {
          className: "flex items-center gap-2",
          children: [/* @__PURE__ */ jsx(Check, {
            size: 16,
            className: "text-green-500"
          }), /* @__PURE__ */ jsx("span", {
            children: "Push Notifications"
          })]
        })]
      })]
    }), /* @__PURE__ */ jsx("h2", {
      children: "Getting Started"
    }), /* @__PURE__ */ jsxs("p", {
      children: ["To configure your app, navigate to ", /* @__PURE__ */ jsx("strong", {
        children: "Settings > Mobile App"
      }), " in your studio dashboard."]
    }), /* @__PURE__ */ jsxs("ol", {
      children: [/* @__PURE__ */ jsxs("li", {
        children: [/* @__PURE__ */ jsx("strong", {
          children: "App Identity:"
        }), ' Choose the name that will appear under your app icon on user devices (e.g., "My Studio").']
      }), /* @__PURE__ */ jsxs("li", {
        children: [/* @__PURE__ */ jsx("strong", {
          children: "Primary Color:"
        }), " Select your brand's main color. This will tint buttons, active tabs, and highlights throughout the app."]
      }), /* @__PURE__ */ jsxs("li", {
        children: [/* @__PURE__ */ jsx("strong", {
          children: "Assets:"
        }), " Upload a high-resolution App Icon (1024x1024 PNG) and a Splash Screen image."]
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 rounded-r-lg my-6 not-prose",
      children: [/* @__PURE__ */ jsx("h4", {
        className: "font-bold text-blue-700 dark:text-blue-300 mb-1",
        children: "Pro Tip"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-blue-600 dark:text-blue-400 text-sm",
        children: "Keep your app icon simple. Avoid small text or complex details, as it will be viewed at very small sizes on phone screens."
      })]
    }), /* @__PURE__ */ jsx("h2", {
      children: "Publishing Process"
    }), /* @__PURE__ */ jsx("p", {
      children: "Once you save your configuration, our automated build system (powered by Expo EAS) will generate the native binaries (`.ipa` and `.aab`) for iOS and Android."
    }), /* @__PURE__ */ jsx("p", {
      children: /* @__PURE__ */ jsx("i", {
        children: "Note: Publishing to the Apple App Store requires an Apple Developer Account enrolled in the Apple Business Manager program if you are a business entity."
      })
    })]
  });
});
const route120 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: help_mobileBuilder
}, Symbol.toStringTag, { value: "Module" }));
const help_classes = UNSAFE_withComponentProps(function HelpClasses() {
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-50 mb-4 font-serif",
        children: "Creating & Managing Classes"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-lg text-zinc-600 dark:text-zinc-400 leading-relaxed",
        children: "Learn how to schedule classes, manage rosters, and handle check-ins."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "space-y-8",
      children: [/* @__PURE__ */ jsxs("div", {
        className: "prose dark:prose-invert max-w-none",
        children: [/* @__PURE__ */ jsx("h3", {
          children: "The Schedule View"
        }), /* @__PURE__ */ jsxs("p", {
          children: ["The ", /* @__PURE__ */ jsx("strong", {
            children: "Schedule"
          }), " tab is your command center. It shows a calendar view of all your upcoming classes. You can view by day, week, or month."]
        })]
      }), /* @__PURE__ */ jsxs("div", {
        className: "grid md:grid-cols-3 gap-6",
        children: [/* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl",
          children: [/* @__PURE__ */ jsx(Calendar, {
            className: "w-8 h-8 text-blue-500 mb-4"
          }), /* @__PURE__ */ jsx("h4", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-2",
            children: "Scheduling a Class"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 dark:text-zinc-400",
            children: 'Click the "New Class" button or drag on the calendar to create a session. You can set recurrence rules (e.g., "Every Monday at 9am").'
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl",
          children: [/* @__PURE__ */ jsx(Users, {
            className: "w-8 h-8 text-green-500 mb-4"
          }), /* @__PURE__ */ jsx("h4", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-2",
            children: "Managing Rosters"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 dark:text-zinc-400",
            children: "Click on any class to view its roster. You can manually add students, cancel bookings, or check students in as they arrive."
          })]
        }), /* @__PURE__ */ jsxs("div", {
          className: "bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl",
          children: [/* @__PURE__ */ jsx(Video, {
            className: "w-8 h-8 text-purple-500 mb-4"
          }), /* @__PURE__ */ jsx("h4", {
            className: "font-bold text-zinc-900 dark:text-zinc-100 mb-2",
            children: "Virtual Classes"
          }), /* @__PURE__ */ jsx("p", {
            className: "text-sm text-zinc-500 dark:text-zinc-400",
            children: 'If you enable "Virtual" for a class, a Zoom/Video link will be automatically generated and emailed to registered students.'
          })]
        })]
      })]
    })]
  });
});
const route121 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: help_classes
}, Symbol.toStringTag, { value: "Module" }));
const help__index = UNSAFE_withComponentProps(function HelpIndex() {
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-8",
    children: [/* @__PURE__ */ jsxs("div", {
      className: "space-y-4",
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-4xl font-bold text-zinc-900 dark:text-zinc-50 font-serif",
        children: "Welcome to Studio Platform Help"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-xl text-zinc-500 dark:text-zinc-400",
        children: "Everything you need to know about managing your studio, classes, and mobile app."
      })]
    }), /* @__PURE__ */ jsx("hr", {
      className: "border-zinc-200 dark:border-zinc-800"
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid grid-cols-1 md:grid-cols-2 gap-6",
      children: [/* @__PURE__ */ jsxs(Link, {
        to: "/help/setup",
        className: "group p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500 dark:hover:border-blue-500 hover:shadow-lg transition-all",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-12 h-12 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",
          children: /* @__PURE__ */ jsx(Settings, {
            size: 24
          })
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",
          children: "Studio Setup"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mb-4",
          children: "Learn how to configure your tenant, payment settings, and branding."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center text-blue-600 font-medium text-sm",
          children: ["Start Guide ", /* @__PURE__ */ jsx(ArrowRight, {
            size: 14,
            className: "ml-1 group-hover:translate-x-1 transition-transform"
          })]
        })]
      }), /* @__PURE__ */ jsxs(Link, {
        to: "/help/mobile-builder",
        className: "group p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-purple-500 dark:hover:border-purple-500 hover:shadow-lg transition-all",
        children: [/* @__PURE__ */ jsx("div", {
          className: "w-12 h-12 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",
          children: /* @__PURE__ */ jsx(Smartphone, {
            size: 24
          })
        }), /* @__PURE__ */ jsx("h3", {
          className: "text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",
          children: "Mobile App Builder"
        }), /* @__PURE__ */ jsx("p", {
          className: "text-zinc-500 dark:text-zinc-400 mb-4",
          children: "Create and publish your own white-label mobile app for iOS and Android."
        }), /* @__PURE__ */ jsxs("div", {
          className: "flex items-center text-purple-600 font-medium text-sm",
          children: ["Learn More ", /* @__PURE__ */ jsx(ArrowRight, {
            size: 14,
            className: "ml-1 group-hover:translate-x-1 transition-transform"
          })]
        })]
      })]
    })]
  });
});
const route122 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: help__index
}, Symbol.toStringTag, { value: "Module" }));
const help_setup = UNSAFE_withComponentProps(function HelpSetup() {
  return /* @__PURE__ */ jsxs("div", {
    className: "space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",
    children: [/* @__PURE__ */ jsxs("div", {
      children: [/* @__PURE__ */ jsx("h1", {
        className: "text-3xl font-bold text-zinc-900 dark:text-zinc-50 mb-4 font-serif",
        children: "Setting up your Studio"
      }), /* @__PURE__ */ jsx("p", {
        className: "text-lg text-zinc-600 dark:text-zinc-400 leading-relaxed",
        children: "Welcome to Studio Platform! This guide will help you configure the essential settings for your studio tenant."
      })]
    }), /* @__PURE__ */ jsxs("div", {
      className: "grid gap-6",
      children: [/* @__PURE__ */ jsx("section", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg text-blue-600 dark:text-blue-400",
            children: /* @__PURE__ */ jsx(Settings, {
              size: 24
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-3",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
              children: "General Configuration"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-zinc-600 dark:text-zinc-400",
              children: ["Navigate to ", /* @__PURE__ */ jsx("strong", {
                children: "Settings"
              }), " in the sidebar to access your studio's core configuration. Here you can update your studio name, contact email, and timezone."]
            }), /* @__PURE__ */ jsxs("ul", {
              className: "list-disc list-inside text-zinc-500 dark:text-zinc-400 space-y-1 ml-1",
              children: [/* @__PURE__ */ jsx("li", {
                children: "Set your Studio Name"
              }), /* @__PURE__ */ jsx("li", {
                children: "Configure Support Email"
              }), /* @__PURE__ */ jsx("li", {
                children: "Set Timezone and Currency"
              })]
            })]
          })]
        })
      }), /* @__PURE__ */ jsx("section", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-green-100 dark:bg-green-900/30 p-3 rounded-lg text-green-600 dark:text-green-400",
            children: /* @__PURE__ */ jsx(CreditCard, {
              size: 24
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-3",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
              children: "Payments & Payouts"
            }), /* @__PURE__ */ jsxs("p", {
              className: "text-zinc-600 dark:text-zinc-400",
              children: ["To receive payments from your students, you must connect a Stripe account. Go to the ", /* @__PURE__ */ jsx("strong", {
                children: "Finances"
              }), " tab to get started."]
            })]
          })]
        })
      }), /* @__PURE__ */ jsx("section", {
        className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm",
        children: /* @__PURE__ */ jsxs("div", {
          className: "flex items-start gap-4",
          children: [/* @__PURE__ */ jsx("div", {
            className: "bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg text-purple-600 dark:text-purple-400",
            children: /* @__PURE__ */ jsx(Palette, {
              size: 24
            })
          }), /* @__PURE__ */ jsxs("div", {
            className: "space-y-3",
            children: [/* @__PURE__ */ jsx("h3", {
              className: "text-xl font-bold text-zinc-900 dark:text-zinc-100",
              children: "Branding"
            }), /* @__PURE__ */ jsx("p", {
              className: "text-zinc-600 dark:text-zinc-400",
              children: "Make the platform your own by customizing your brand colors and logos. This branding will appear on your public schedule, booking widgets, and mobile app."
            }), /* @__PURE__ */ jsxs(Link, {
              to: "/help/mobile-builder",
              className: "inline-flex items-center text-purple-600 hover:text-purple-700 font-medium",
              children: ["Learn about Mobile App Branding ", /* @__PURE__ */ jsx(ArrowRight, {
                size: 14,
                className: "ml-1"
              })]
            })]
          })]
        })
      })]
    })]
  });
});
const route123 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: help_setup
}, Symbol.toStringTag, { value: "Module" }));
const serverManifest = { "entry": { "module": "/assets/entry.client-jTezAe_l.js", "imports": ["/assets/vendor-puck-EFhZVjRu.js", "/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"] }, "routes": { "root": { "id": "root", "parentId": void 0, "path": "", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": true, "module": "/assets/root-C3jCuuTr.js", "imports": ["/assets/vendor-puck-EFhZVjRu.js", "/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/index-0-uDmKCt.js", "/assets/index-D7FGTRdZ.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/site.$slug.$pageSlug": { "id": "routes/site.$slug.$pageSlug", "parentId": "root", "path": "site/:slug/:pageSlug", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/site._slug._pageSlug-DVTdNc2z.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/puck-config-q_oitvMg.js", "/assets/ChatWidget-2vY58bP0.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-D7FGTRdZ.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/pen-DIUl4YMx.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/message-circle-cE2JHAhU.js", "/assets/send-BNR5q9Wk.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/pricing.compare": { "id": "routes/pricing.compare", "parentId": "root", "path": "pricing/compare", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/pricing.compare-CduWgCrZ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/index-D7FGTRdZ.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/circle-question-mark-CQsDfPg0.js", "/assets/check-yXSU0QnA.js", "/assets/minus-TU7AVMxa.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/pricing._index": { "id": "routes/pricing._index", "parentId": "root", "path": "pricing", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/pricing._index-XhAARojW.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/check-yXSU0QnA.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/$slug.support": { "id": "routes/$slug.support", "parentId": "root", "path": ":slug/support", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/_slug.support-SiIYlgTo.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ChatWindow-CeOhxHnr.js", "/assets/message-square-DXFYk9Nj.js", "/assets/x-6mvJS0UK.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/send-BNR5q9Wk.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/accept-invite": { "id": "routes/accept-invite", "parentId": "root", "path": "accept-invite", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/accept-invite-BwpezfR6.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/index-D7FGTRdZ.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/create-studio": { "id": "routes/create-studio", "parentId": "root", "path": "create-studio", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/create-studio-BsqaP53T.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug": { "id": "routes/studio.$slug", "parentId": "root", "path": "studio/:slug", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug-DHFMcuwQ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/CommandBar-CHPYEMTk.js", "/assets/chevron-down-DOKZOgBX.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-D7FGTRdZ.js", "/assets/users-DTyswlyE.js", "/assets/use-resolve-button-type-B5XY-a5c.js", "/assets/portal-Dc6zX_3t.js", "/assets/check-yXSU0QnA.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/ChatWidget-2vY58bP0.js", "/assets/calendar-CHyLPk-n.js", "/assets/clock-CZ6xxKks.js", "/assets/circle-check-4euu8Iav.js", "/assets/trophy-Buxr5RRh.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/file-pen-line-Dj21kRfD.js", "/assets/image-BzEjuuKJ.js", "/assets/shopping-cart-eqO11M5U.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/package-koM-mwzd.js", "/assets/ticket-B5axb41_.js", "/assets/user-B9JVtPOG.js", "/assets/mail-BVU9VLVw.js", "/assets/award-ybvMWPmB.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/tag-CL7ms9wp.js", "/assets/code-GqGOaeVQ.js", "/assets/smartphone-NVyChj3R.js", "/assets/terminal-B-Ek4Gh_.js", "/assets/message-square-DXFYk9Nj.js", "/assets/database-YmXT_lcr.js", "/assets/settings-Cip7W-gj.js", "/assets/chart-column-BictQ20g.js", "/assets/circle-question-mark-CQsDfPg0.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/search-S3VI0n0n.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/api-OnQO3erh.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/x-6mvJS0UK.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/message-circle-cE2JHAhU.js", "/assets/send-BNR5q9Wk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.videos.collections.$id": { "id": "routes/studio.$slug.videos.collections.$id", "parentId": "routes/studio.$slug", "path": "videos/collections/:id", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.videos.collections._id-Cow5LhUP.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/format-CAsSOgDD.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/plus-BBRn-p3b.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/trash-2-DU-4PZMS.js", "/assets/x-6mvJS0UK.js", "/assets/search-S3VI0n0n.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.website.editor.$pageId": { "id": "routes/studio.$slug.website.editor.$pageId", "parentId": "routes/studio.$slug", "path": "website/editor/:pageId", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.website.editor._pageId-D96ftSHE.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/puck-config-q_oitvMg.js", "/assets/index-0-uDmKCt.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-D7FGTRdZ.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/eye-BvvqFSJ3.js", "/assets/save-f-wzAblY.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.financials.my-payouts": { "id": "routes/studio.$slug.financials.my-payouts", "parentId": "routes/studio.$slug", "path": "financials/my-payouts", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.financials.my-payouts-D3gmTUWl.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/calendar-CHyLPk-n.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.videos.edit.$videoId": { "id": "routes/studio.$slug.videos.edit.$videoId", "parentId": "routes/studio.$slug", "path": "videos/edit/:videoId", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.videos.edit._videoId-CNtYIvD5.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.commerce.gift-cards": { "id": "routes/studio.$slug.commerce.gift-cards", "parentId": "routes/studio.$slug", "path": "commerce/gift-cards", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.commerce.gift-cards-CFu1HkYa.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/gift-C7k9WNZ1.js", "/assets/link-BUcxi1WU.js", "/assets/plus-BBRn-p3b.js", "/assets/search-S3VI0n0n.js", "/assets/ticket-B5axb41_.js", "/assets/ellipsis-wPE1SJ2w.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/mail-BVU9VLVw.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/Modal-adSWkWLD.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.financials.payroll": { "id": "routes/studio.$slug.financials.payroll", "parentId": "routes/studio.$slug", "path": "financials/payroll", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.financials.payroll-CQV_SET_.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/button-B3geSTrU.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.financials._index": { "id": "routes/studio.$slug.financials._index", "parentId": "routes/studio.$slug", "path": "financials", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.financials._index-l0sNRNKZ.js", "imports": [], "css": [], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.commerce.coupons": { "id": "routes/studio.$slug.commerce.coupons", "parentId": "routes/studio.$slug", "path": "commerce/coupons", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.commerce.coupons-BF0MCnO-.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/tag-CL7ms9wp.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/circle-x-hiKkNN-9.js", "/assets/ticket-B5axb41_.js", "/assets/trash-2-DU-4PZMS.js", "/assets/plus-BBRn-p3b.js", "/assets/link-BUcxi1WU.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.commerce.packs": { "id": "routes/studio.$slug.commerce.packs", "parentId": "routes/studio.$slug", "path": "commerce/packs", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.commerce.packs-CMFBquHe.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/plus-BBRn-p3b.js", "/assets/package-koM-mwzd.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/calendar-CHyLPk-n.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.substitutions": { "id": "routes/studio.$slug.substitutions", "parentId": "routes/studio.$slug", "path": "substitutions", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.substitutions-CE6iIBuR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/circle-alert-Day-jl1l.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/clock-CZ6xxKks.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.videos._index": { "id": "routes/studio.$slug.videos._index", "parentId": "routes/studio.$slug", "path": "videos", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.videos._index-CfZNfIBO.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/format-CAsSOgDD.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/upload-BJQyUS3g.js", "/assets/image-BzEjuuKJ.js", "/assets/film-BQWi96s1.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/x-6mvJS0UK.js", "/assets/info-CngRlp_d.js", "/assets/plus-BBRn-p3b.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/save-f-wzAblY.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.website.pages": { "id": "routes/studio.$slug.website.pages", "parentId": "routes/studio.$slug", "path": "website/pages", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.website.pages-BQ101_Bm.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/globe-DV22Xz5a.js", "/assets/plus-BBRn-p3b.js", "/assets/file-text-CIWEYZv3.js", "/assets/eye-off-BsXKf3_1.js", "/assets/eye-BvvqFSJ3.js", "/assets/pen-DIUl4YMx.js", "/assets/trash-2-DU-4PZMS.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.appointments": { "id": "routes/studio.$slug.appointments", "parentId": "routes/studio.$slug", "path": "appointments", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.appointments-Fwdo8fq2.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/clock-CZ6xxKks.js", "/assets/calendar-CHyLPk-n.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.appointments.calendar": { "id": "routes/studio.$slug.appointments.calendar", "parentId": "routes/studio.$slug.appointments", "path": "calendar", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.appointments.calendar-OrVCBte-.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/calendar-CHyLPk-n.js", "/assets/plus-BBRn-p3b.js", "/assets/chevron-left-CjaTArII.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/x-6mvJS0UK.js", "/assets/clock-CZ6xxKks.js", "/assets/user-B9JVtPOG.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.memberships": { "id": "routes/studio.$slug.memberships", "parentId": "routes/studio.$slug", "path": "memberships", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.memberships-DU-cFS1R.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.challenges": { "id": "routes/studio.$slug.challenges", "parentId": "routes/studio.$slug", "path": "challenges", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.challenges-CFquH8Ey.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/trophy-Buxr5RRh.js", "/assets/flame-SNp5DNp_.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/clock-CZ6xxKks.js", "/assets/target-DaZesuop.js", "/assets/star-C9H_pMma.js", "/assets/calendar-CHyLPk-n.js", "/assets/check-yXSU0QnA.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.instructor": { "id": "routes/studio.$slug.instructor", "parentId": "routes/studio.$slug", "path": "instructor", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.instructor-DoChzbcI.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/users-DTyswlyE.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/calendar-CHyLPk-n.js", "/assets/clock-CZ6xxKks.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.instructor.schedule": { "id": "routes/studio.$slug.instructor.schedule", "parentId": "routes/studio.$slug.instructor", "path": "schedule", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.instructor.schedule-CqJUCUrs.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/calendar-CHyLPk-n.js", "/assets/chevron-left-CjaTArII.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/clock-CZ6xxKks.js", "/assets/users-DTyswlyE.js", "/assets/video-BR-TS2td.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.instructor.payroll": { "id": "routes/studio.$slug.instructor.payroll", "parentId": "routes/studio.$slug.instructor", "path": "payroll", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.instructor.payroll-DJdzTmkQ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/download-nknHt9WM.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.dashboard": { "id": "routes/studio.$slug.dashboard", "parentId": "routes/studio.$slug", "path": "dashboard", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.dashboard-CajJU7AX.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": [], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.discounts": { "id": "routes/studio.$slug.discounts", "parentId": "routes/studio.$slug", "path": "discounts", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.discounts-7WncOpQd.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/plus-BBRn-p3b.js", "/assets/tag-CL7ms9wp.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.marketing": { "id": "routes/studio.$slug.marketing", "parentId": "routes/studio.$slug", "path": "marketing", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.marketing-mhOWte5u.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/code-GqGOaeVQ.js", "/assets/link-BUcxi1WU.js", "/assets/image-BzEjuuKJ.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/x-6mvJS0UK.js", "/assets/mail-BVU9VLVw.js", "/assets/send-BNR5q9Wk.js", "/assets/zap-CpdSyYPf.js", "/assets/plus-BBRn-p3b.js", "/assets/sparkles-CFOYMxZM.js", "/assets/clock-CZ6xxKks.js", "/assets/pencil-DhXDeFua.js", "/assets/trash-2-DU-4PZMS.js", "/assets/settings-Cip7W-gj.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.marketing.automations": { "id": "routes/studio.$slug.marketing.automations", "parentId": "routes/studio.$slug.marketing", "path": "automations", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.marketing.automations-DOIBToTG.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/index-0-uDmKCt.js", "/assets/zap-CpdSyYPf.js", "/assets/plus-BBRn-p3b.js", "/assets/users-DTyswlyE.js", "/assets/calendar-CHyLPk-n.js", "/assets/target-DaZesuop.js", "/assets/clock-CZ6xxKks.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/x-6mvJS0UK.js", "/assets/trash-2-DU-4PZMS.js", "/assets/pencil-DhXDeFua.js", "/assets/play-Yex43xXq.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/sparkles-CFOYMxZM.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.marketing.referrals": { "id": "routes/studio.$slug.marketing.referrals", "parentId": "routes/studio.$slug.marketing", "path": "referrals", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.marketing.referrals-DEMPmwaE.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/gift-C7k9WNZ1.js", "/assets/sparkles-CFOYMxZM.js", "/assets/check-yXSU0QnA.js", "/assets/copy-ATUPUJUF.js", "/assets/share-2-DTZ3QQ_X.js", "/assets/users-DTyswlyE.js", "/assets/clock-CZ6xxKks.js", "/assets/award-ybvMWPmB.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.branding": { "id": "routes/studio.$slug.branding", "parentId": "routes/studio.$slug", "path": "branding", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.branding-dySAQzFa.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.checkout": { "id": "routes/studio.$slug.checkout", "parentId": "routes/studio.$slug", "path": "checkout", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.checkout-BjdLnq4A.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-fwG0o7XZ.js", "/assets/api-OnQO3erh.js", "/assets/circle-check-4euu8Iav.js", "/assets/circle-x-hiKkNN-9.js", "/assets/ticket-B5axb41_.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/index-Chjiymov.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.checkout.return": { "id": "routes/studio.$slug.checkout.return", "parentId": "routes/studio.$slug.checkout", "path": "return", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.checkout.return-BVWuJB1I.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.finances": { "id": "routes/studio.$slug.finances", "parentId": "routes/studio.$slug", "path": "finances", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.finances-DRXLSIpR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.schedule": { "id": "routes/studio.$slug.schedule", "parentId": "routes/studio.$slug", "path": "schedule", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.schedule-pqwAEhc9.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-fwG0o7XZ.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/BookingModal-Dh4IcWkC.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/api-OnQO3erh.js", "/assets/x-6mvJS0UK.js", "/assets/video-BR-TS2td.js", "/assets/trash-2-DU-4PZMS.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/dialog-B59PPLIp.js", "/assets/plus-BBRn-p3b.js", "/assets/index-Chjiymov.js", "/assets/Modal-adSWkWLD.js", "/assets/user-B9JVtPOG.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/users-DTyswlyE.js", "/assets/button-B3geSTrU.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/portal-Dc6zX_3t.js"], "css": ["/assets/studio._slug-BSwzzYnC.css", "/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings": { "id": "routes/studio.$slug.settings", "parentId": "routes/studio.$slug", "path": "settings", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings-Cwsq-qfp.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.integrations": { "id": "routes/studio.$slug.settings.integrations", "parentId": "routes/studio.$slug.settings", "path": "integrations", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.integrations-C_KABJHo.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/Card-Bhh18rui.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/shield-BH971nBf.js", "/assets/mail-BVU9VLVw.js", "/assets/send-BNR5q9Wk.js", "/assets/message-square-DXFYk9Nj.js", "/assets/terminal-B-Ek4Gh_.js", "/assets/trash-2-DU-4PZMS.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.locations": { "id": "routes/studio.$slug.settings.locations", "parentId": "routes/studio.$slug.settings", "path": "locations", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.locations-D4pRkhQs.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/index-0-uDmKCt.js", "/assets/map-pin-kPXbYZuQ.js", "/assets/plus-BBRn-p3b.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/star-C9H_pMma.js", "/assets/clock-CZ6xxKks.js", "/assets/phone-Cg6yI70C.js", "/assets/square-pen-DpcRMrVj.js", "/assets/trash-2-DU-4PZMS.js", "/assets/x-6mvJS0UK.js", "/assets/Modal-adSWkWLD.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.branding": { "id": "routes/studio.$slug.settings.branding", "parentId": "routes/studio.$slug.settings", "path": "branding", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.branding-DL6RViIP.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/image-BzEjuuKJ.js", "/assets/upload-BJQyUS3g.js", "/assets/video-BR-TS2td.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/trash-2-DU-4PZMS.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.hardware": { "id": "routes/studio.$slug.settings.hardware", "parentId": "routes/studio.$slug.settings", "path": "hardware", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.hardware-QtdoV19E.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.billing": { "id": "routes/studio.$slug.settings.billing", "parentId": "routes/studio.$slug.settings", "path": "billing", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.billing-DVy0l5q8.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/check-yXSU0QnA.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings._index": { "id": "routes/studio.$slug.settings._index", "parentId": "routes/studio.$slug.settings", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings._index-DVwOswv1.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/plus-BBRn-p3b.js", "/assets/map-pin-kPXbYZuQ.js", "/assets/trash-2-DU-4PZMS.js", "/assets/globe-DV22Xz5a.js", "/assets/shopping-bag-DfkooIBe.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.addons": { "id": "routes/studio.$slug.settings.addons", "parentId": "routes/studio.$slug.settings", "path": "addons", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.addons-DO2YecxH.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/message-square-DXFYk9Nj.js", "/assets/check-yXSU0QnA.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.domain": { "id": "routes/studio.$slug.settings.domain", "parentId": "routes/studio.$slug.settings", "path": "domain", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.domain-Ch1ckVOq.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/globe-DV22Xz5a.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/trash-2-DU-4PZMS.js", "/assets/shield-check-slWAEzyf.js", "/assets/external-link-B6GLlcGt.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.embeds": { "id": "routes/studio.$slug.settings.embeds", "parentId": "routes/studio.$slug.settings", "path": "embeds", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.embeds-B7hRMqSO.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/link-BUcxi1WU.js", "/assets/external-link-B6GLlcGt.js", "/assets/check-yXSU0QnA.js", "/assets/copy-ATUPUJUF.js", "/assets/code-GqGOaeVQ.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.mobile": { "id": "routes/studio.$slug.settings.mobile", "parentId": "routes/studio.$slug.settings", "path": "mobile", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.mobile-CRVGh2KC.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/smartphone-NVyChj3R.js", "/assets/circle-check-4euu8Iav.js", "/assets/circle-alert-Day-jl1l.js", "/assets/upload-BJQyUS3g.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/image-BzEjuuKJ.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.chat": { "id": "routes/studio.$slug.settings.chat", "parentId": "routes/studio.$slug.settings", "path": "chat", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.chat-D0WhspFd.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/Card-Bhh18rui.js", "/assets/index-0-uDmKCt.js", "/assets/save-f-wzAblY.js", "/assets/plus-BBRn-p3b.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/trash-2-DU-4PZMS.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.settings.qr": { "id": "routes/studio.$slug.settings.qr", "parentId": "routes/studio.$slug.settings", "path": "qr", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.settings.qr-kGyP9xOW.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-Chjiymov.js", "/assets/download-nknHt9WM.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.students": { "id": "routes/studio.$slug.students", "parentId": "routes/studio.$slug", "path": "students", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.students-uUNqbI8X.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.students._index": { "id": "routes/studio.$slug.students._index", "parentId": "routes/studio.$slug.students", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.students._index-9PMY5-FC.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/x-6mvJS0UK.js", "/assets/mail-BVU9VLVw.js", "/assets/shield-check-slWAEzyf.js", "/assets/download-nknHt9WM.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.students.$id": { "id": "routes/studio.$slug.students.$id", "parentId": "routes/studio.$slug.students", "path": ":id", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.students._id-Com-PoG8.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/user-B9JVtPOG.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/mail-BVU9VLVw.js", "/assets/ellipsis-wPE1SJ2w.js", "/assets/plus-BBRn-p3b.js", "/assets/file-text-CIWEYZv3.js", "/assets/check-yXSU0QnA.js", "/assets/pencil-DhXDeFua.js", "/assets/trash-2-DU-4PZMS.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.checkin": { "id": "routes/studio.$slug.checkin", "parentId": "routes/studio.$slug", "path": "checkin", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.checkin-Ck_c3Av6.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/circle-check-4euu8Iav.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/calendar-CHyLPk-n.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/search-S3VI0n0n.js", "/assets/users-DTyswlyE.js", "/assets/user-plus-wgpaf6QU.js", "/assets/circle-alert-Day-jl1l.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.classes": { "id": "routes/studio.$slug.classes", "parentId": "routes/studio.$slug", "path": "classes", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.classes-6uAObJD3.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.classes.$classId.live": { "id": "routes/studio.$slug.classes.$classId.live", "parentId": "routes/studio.$slug.classes", "path": ":classId/live", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.classes._classId.live-D7M0kGCa.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/vendor-livekit-KB5nVx5f.js", "/assets/api-OnQO3erh.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css", "/assets/vendor-livekit-DLFhKdHL.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.classes.$id.roster": { "id": "routes/studio.$slug.classes.$id.roster", "parentId": "routes/studio.$slug.classes", "path": ":id/roster", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.classes._id.roster-DzCnydWR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/user-plus-wgpaf6QU.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/file-text-CIWEYZv3.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/check-yXSU0QnA.js", "/assets/x-6mvJS0UK.js", "/assets/trash-2-DU-4PZMS.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.classes._index": { "id": "routes/studio.$slug.classes._index", "parentId": "routes/studio.$slug.classes", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.classes._index-Xp-nnNaS.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/BookingModal-Dh4IcWkC.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/plus-BBRn-p3b.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/archive-D-1vvCVw.js", "/assets/Modal-adSWkWLD.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js", "/assets/user-B9JVtPOG.js", "/assets/users-DTyswlyE.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.loyalty": { "id": "routes/studio.$slug.loyalty", "parentId": "routes/studio.$slug", "path": "loyalty", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.loyalty-nnxSZVAu.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/award-ybvMWPmB.js", "/assets/plus-BBRn-p3b.js", "/assets/target-DaZesuop.js", "/assets/trash-2-DU-4PZMS.js", "/assets/gift-C7k9WNZ1.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.profile": { "id": "routes/studio.$slug.profile", "parentId": "routes/studio.$slug", "path": "profile", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.profile-B42GoVku.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.reports": { "id": "routes/studio.$slug.reports", "parentId": "routes/studio.$slug", "path": "reports", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.reports-6xc48DaW.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/trash-2-DU-4PZMS.js", "/assets/save-f-wzAblY.js", "/assets/users-DTyswlyE.js", "/assets/trending-up-WhR0C78Z.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/calendar-CHyLPk-n.js", "/assets/arrow-right-TLLbqErj.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/api-OnQO3erh.js", "/assets/PrivacyBlur-Vp26brL3.js", "/assets/index-0-uDmKCt.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/download-nknHt9WM.js", "/assets/plus-BBRn-p3b.js", "/assets/mail-BVU9VLVw.js", "/assets/circle-check-4euu8Iav.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.reports.advanced": { "id": "routes/studio.$slug.reports.advanced", "parentId": "routes/studio.$slug.reports", "path": "advanced", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.reports.advanced-BCQnkAVz.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/chart-column-BictQ20g.js", "/assets/download-nknHt9WM.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/activity-ZAJHCsfc.js", "/assets/calendar-CHyLPk-n.js", "/assets/target-DaZesuop.js", "/assets/trending-up-WhR0C78Z.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.reports.custom": { "id": "routes/studio.$slug.reports.custom", "parentId": "routes/studio.$slug.reports", "path": "custom", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.reports.custom-BkMIC6LV.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/funnel-CMCL3Bgb.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/trash-2-DU-4PZMS.js", "/assets/save-f-wzAblY.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chart-column-BictQ20g.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.waivers": { "id": "routes/studio.$slug.waivers", "parentId": "routes/studio.$slug", "path": "waivers", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.waivers-D3kJlJag.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.waivers._index": { "id": "routes/studio.$slug.waivers._index", "parentId": "routes/studio.$slug.waivers", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.waivers._index-iXXTcnlB.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.waivers.new": { "id": "routes/studio.$slug.waivers.new", "parentId": "routes/studio.$slug.waivers", "path": "new", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.waivers.new-JyuFuwXS.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/save-f-wzAblY.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug._index": { "id": "routes/studio.$slug._index", "parentId": "routes/studio.$slug", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug._index-CNolfjqO.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/activity-ZAJHCsfc.js", "/assets/users-DTyswlyE.js", "/assets/trending-up-WhR0C78Z.js", "/assets/calendar-CHyLPk-n.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/file-pen-line-Dj21kRfD.js", "/assets/ticket-B5axb41_.js", "/assets/award-ybvMWPmB.js", "/assets/target-DaZesuop.js", "/assets/flame-SNp5DNp_.js", "/assets/arrow-right-TLLbqErj.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.retail": { "id": "routes/studio.$slug.retail", "parentId": "routes/studio.$slug", "path": "retail", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.retail-E00gGkIf.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/package-koM-mwzd.js", "/assets/upload-BJQyUS3g.js", "/assets/plus-BBRn-p3b.js", "/assets/search-S3VI0n0n.js", "/assets/square-pen-DpcRMrVj.js", "/assets/trash-2-DU-4PZMS.js", "/assets/box-B7ngXQvL.js", "/assets/x-6mvJS0UK.js", "/assets/save-f-wzAblY.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.leads": { "id": "routes/studio.$slug.leads", "parentId": "routes/studio.$slug", "path": "leads", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.leads-tUuBI35K.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/index-0-uDmKCt.js", "/assets/plus-BBRn-p3b.js", "/assets/search-S3VI0n0n.js", "/assets/mail-BVU9VLVw.js", "/assets/phone-Cg6yI70C.js", "/assets/clock-CZ6xxKks.js", "/assets/circle-alert-Day-jl1l.js", "/assets/pencil-DhXDeFua.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.tasks": { "id": "routes/studio.$slug.tasks", "parentId": "routes/studio.$slug", "path": "tasks", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.tasks-BBEy2McN.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/plus-BBRn-p3b.js", "/assets/calendar-CHyLPk-n.js", "/assets/trash-2-DU-4PZMS.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/button-B3geSTrU.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.chat": { "id": "routes/studio.$slug.chat", "parentId": "routes/studio.$slug", "path": "chat", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.chat-CTBEGDLm.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/index-0-uDmKCt.js", "/assets/message-circle-cE2JHAhU.js", "/assets/settings-Cip7W-gj.js", "/assets/external-link-B6GLlcGt.js", "/assets/user-B9JVtPOG.js", "/assets/shield-BH971nBf.js", "/assets/plus-BBRn-p3b.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.chat.$roomId": { "id": "routes/studio.$slug.chat.$roomId", "parentId": "routes/studio.$slug.chat", "path": ":roomId", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.chat._roomId-BXIa8hBI.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ChatWindow-CeOhxHnr.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/clock-CZ6xxKks.js", "/assets/send-BNR5q9Wk.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.data": { "id": "routes/studio.$slug.data", "parentId": "routes/studio.$slug", "path": "data", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.data-Eift14GM.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/download-nknHt9WM.js", "/assets/upload-BJQyUS3g.js", "/assets/database-YmXT_lcr.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.data._index": { "id": "routes/studio.$slug.data._index", "parentId": "routes/studio.$slug.data", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.data._index-B8uO9Zhh.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": [], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.data.export": { "id": "routes/studio.$slug.data.export", "parentId": "routes/studio.$slug.data", "path": "export", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.data.export-DllshoQR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/download-nknHt9WM.js", "/assets/chart-column-BictQ20g.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/shopping-bag-DfkooIBe.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.data.import": { "id": "routes/studio.$slug.data.import", "parentId": "routes/studio.$slug.data", "path": "import", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.data.import-BtJSY58p.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/upload-BJQyUS3g.js", "/assets/file-text-CIWEYZv3.js", "/assets/circle-alert-Day-jl1l.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/studio.$slug.pos": { "id": "routes/studio.$slug.pos", "parentId": "routes/studio.$slug", "path": "pos", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/studio._slug.pos-C7IN1r78.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/plus-BBRn-p3b.js", "/assets/square-pen-DpcRMrVj.js", "/assets/archive-D-1vvCVw.js", "/assets/x-6mvJS0UK.js", "/assets/user-B9JVtPOG.js", "/assets/search-S3VI0n0n.js", "/assets/trash-2-DU-4PZMS.js", "/assets/shopping-cart-eqO11M5U.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/loader-circle-CaGZsKjo.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug": { "id": "routes/embed.$slug", "parentId": "root", "path": "embed/:slug", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug-CUDctG5P.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug.calendar": { "id": "routes/embed.$slug.calendar", "parentId": "routes/embed.$slug", "path": "calendar", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug.calendar-COZ-4D2q.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/calendar-CHyLPk-n.js", "/assets/video-BR-TS2td.js", "/assets/external-link-B6GLlcGt.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug.pricing": { "id": "routes/embed.$slug.pricing", "parentId": "routes/embed.$slug", "path": "pricing", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug.pricing-B9z0QCsr.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/circle-alert-Day-jl1l.js", "/assets/sparkles-CFOYMxZM.js", "/assets/tag-CL7ms9wp.js", "/assets/check-yXSU0QnA.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug.book": { "id": "routes/embed.$slug.book", "parentId": "routes/embed.$slug", "path": "book", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug.book-DcjJnInI.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/vendor-date-fns-MAbw63O8.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug.chat": { "id": "routes/embed.$slug.chat", "parentId": "routes/embed.$slug", "path": "chat", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug.chat-VgSc0bf8.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ChatWindow-CeOhxHnr.js", "/assets/message-circle-cE2JHAhU.js", "/assets/x-6mvJS0UK.js", "/assets/send-BNR5q9Wk.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/embed.$slug.shop": { "id": "routes/embed.$slug.shop", "parentId": "routes/embed.$slug", "path": "shop", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/embed._slug.shop-BJC34by2.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/shopping-cart-eqO11M5U.js", "/assets/package-koM-mwzd.js", "/assets/plus-BBRn-p3b.js", "/assets/x-6mvJS0UK.js", "/assets/minus-TU7AVMxa.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/$pageSlug": { "id": "routes/$pageSlug", "parentId": "root", "path": ":pageSlug", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/_pageSlug-BkMDrxpb.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/PublicPageRenderer-C3KYv6qH.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/puck-config-q_oitvMg.js", "/assets/ChatWidget-2vY58bP0.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/message-circle-cE2JHAhU.js", "/assets/send-BNR5q9Wk.js", "/assets/pen-DIUl4YMx.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard": { "id": "routes/dashboard", "parentId": "root", "path": "dashboard", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard-BGforM_g.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/index-DBhWJA_Y.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard.classes": { "id": "routes/dashboard.classes", "parentId": "routes/dashboard", "path": "classes", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard.classes-CXDA9963.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard.classes.$id.roster": { "id": "routes/dashboard.classes.$id.roster", "parentId": "routes/dashboard.classes", "path": ":id/roster", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard.classes._id.roster-Dwoam-Rq.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard.classes.$id.watch": { "id": "routes/dashboard.classes.$id.watch", "parentId": "routes/dashboard.classes", "path": ":id/watch", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard.classes._id.watch-Dq1Uleeb.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard.classes._index": { "id": "routes/dashboard.classes._index", "parentId": "routes/dashboard.classes", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard.classes._index-kihc7Jj4.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard.profile": { "id": "routes/dashboard.profile", "parentId": "routes/dashboard", "path": "profile", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard.profile-uJCtDsgb.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/dashboard._index": { "id": "routes/dashboard._index", "parentId": "routes/dashboard", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/dashboard._index-DlMUjouZ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/shield-check-slWAEzyf.js", "/assets/plus-BBRn-p3b.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/debug-ssr": { "id": "routes/debug-ssr", "parentId": "root", "path": "debug-ssr", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/debug-ssr-CaOlOd_y.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": [], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/sign-in.$": { "id": "routes/sign-in.$", "parentId": "root", "path": "sign-in/*", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/sign-in._-JCKN87sR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/uiComponents-BYeyFplI.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-D7FGTRdZ.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/sign-up.$": { "id": "routes/sign-up.$", "parentId": "root", "path": "sign-up/*", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/sign-up._-CqEQEkd_.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/uiComponents-BYeyFplI.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-D7FGTRdZ.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/_index": { "id": "routes/_index", "parentId": "root", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/_index-DT0HqQ7E.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/ChatWidget-2vY58bP0.js", "/assets/PublicPageRenderer-C3KYv6qH.js", "/assets/index-DBhWJA_Y.js", "/assets/chunk-VMBS36YX-C_USBOdA.js", "/assets/chunk-6WD75OPE-C9tS5P-4.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/x-6mvJS0UK.js", "/assets/message-circle-cE2JHAhU.js", "/assets/send-BNR5q9Wk.js", "/assets/puck-config-q_oitvMg.js", "/assets/pen-DIUl4YMx.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin": { "id": "routes/admin", "parentId": "root", "path": "admin", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin-ChwtcvRZ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/index-DBhWJA_Y.js", "/assets/ThemeToggle-D_MvhTuz.js", "/assets/CommandBar-CHPYEMTk.js", "/assets/search-S3VI0n0n.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/ThemeProvider-B6hSw8Vj.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/api-OnQO3erh.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/x-6mvJS0UK.js", "/assets/user-B9JVtPOG.js", "/assets/shopping-cart-eqO11M5U.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.website.edit.$pageId": { "id": "routes/admin.website.edit.$pageId", "parentId": "routes/admin", "path": "website/edit/:pageId", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.website.edit._pageId-_7HI33Li.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/puck-config-q_oitvMg.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/eye-BvvqFSJ3.js", "/assets/save-f-wzAblY.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.communications.logs": { "id": "routes/admin.communications.logs", "parentId": "routes/admin", "path": "communications/logs", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.communications.logs-BWtKRYfh.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/index-0-uDmKCt.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/mail-BVU9VLVw.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/search-S3VI0n0n.js", "/assets/send-BNR5q9Wk.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/circle-x-hiKkNN-9.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.coupons._index": { "id": "routes/admin.coupons._index", "parentId": "routes/admin", "path": "coupons", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.coupons._index-1XxySgVd.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/api-OnQO3erh.js", "/assets/Card-Bhh18rui.js", "/assets/index-0-uDmKCt.js", "/assets/vendor-date-fns-MAbw63O8.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.website._index": { "id": "routes/admin.website._index", "parentId": "routes/admin", "path": "website", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.website._index-BYujUY0X.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/globe-DV22Xz5a.js", "/assets/plus-BBRn-p3b.js", "/assets/file-text-CIWEYZv3.js", "/assets/eye-off-BsXKf3_1.js", "/assets/eye-BvvqFSJ3.js", "/assets/external-link-B6GLlcGt.js", "/assets/pen-DIUl4YMx.js", "/assets/trash-2-DU-4PZMS.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.users.$userId": { "id": "routes/admin.users.$userId", "parentId": "routes/admin", "path": "users/:userId", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.users._userId-DFTdRe-l.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.architecture": { "id": "routes/admin.architecture", "parentId": "routes/admin", "path": "architecture", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.architecture-IGlbhPvi.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/globe-DV22Xz5a.js", "/assets/smartphone-NVyChj3R.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/shield-BH971nBf.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/calendar-CHyLPk-n.js", "/assets/database-YmXT_lcr.js", "/assets/box-B7ngXQvL.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.users._index": { "id": "routes/admin.users._index", "parentId": "routes/admin", "path": "users", "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.users._index-Cw6HMJsM.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/button-B3geSTrU.js", "/assets/select-Bq9GVLUc.js", "/assets/ConfirmDialog-Tx5rE5JB.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/dialog-B59PPLIp.js", "/assets/portal-Dc6zX_3t.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/chevron-down-DOKZOgBX.js", "/assets/index-DBhWJA_Y.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.diagnostics": { "id": "routes/admin.diagnostics", "parentId": "routes/admin", "path": "diagnostics", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.diagnostics-CjycIYQH.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/Card-Bhh18rui.js", "/assets/Badge-gemha__y.js", "/assets/activity-ZAJHCsfc.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/database-YmXT_lcr.js", "/assets/shield-check-slWAEzyf.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/circle-x-hiKkNN-9.js", "/assets/clock-CZ6xxKks.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.diagnostics.run": { "id": "routes/admin.diagnostics.run", "parentId": "routes/admin.diagnostics", "path": "run", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.diagnostics.run-l0sNRNKZ.js", "imports": [], "css": [], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.projections": { "id": "routes/admin.projections", "parentId": "routes/admin", "path": "projections", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.projections-BOlIZGCW.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/trending-up-WhR0C78Z.js", "/assets/zap-CpdSyYPf.js", "/assets/info-CngRlp_d.js", "/assets/vendor-charts-4N5lwHtV.js", "/assets/activity-ZAJHCsfc.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.financials": { "id": "routes/admin.financials", "parentId": "routes/admin", "path": "financials", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.financials-ri2wjUPL.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/PrivacyBlur-Vp26brL3.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/dollar-sign-Br6sogR3.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/circle-alert-Day-jl1l.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.financials.failed": { "id": "routes/admin.financials.failed", "parentId": "routes/admin.financials", "path": "failed", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.financials.failed-z-odbEmR.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/circle-alert-Day-jl1l.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/external-link-B6GLlcGt.js", "/assets/Modal-adSWkWLD.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.workflows": { "id": "routes/admin.workflows", "parentId": "routes/admin", "path": "workflows", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.workflows-DkFZbSYu.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/button-B3geSTrU.js", "/assets/Badge-gemha__y.js", "/assets/select-Bq9GVLUc.js", "/assets/use-resolve-button-type-B5XY-a5c.js", "/assets/portal-Dc6zX_3t.js", "/assets/dialog-B59PPLIp.js", "/assets/plus-BBRn-p3b.js", "/assets/clock-CZ6xxKks.js", "/assets/pencil-DhXDeFua.js", "/assets/trash-2-DU-4PZMS.js", "/assets/circle-alert-Day-jl1l.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/user-plus-wgpaf6QU.js", "/assets/x-6mvJS0UK.js", "/assets/chevron-down-DOKZOgBX.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.features": { "id": "routes/admin.features", "parentId": "routes/admin", "path": "features", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.features-DPue7h1G.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/smartphone-NVyChj3R.js", "/assets/globe-DV22Xz5a.js", "/assets/messages-square-D_ugcQAx.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/video-BR-TS2td.js", "/assets/message-square-DXFYk9Nj.js", "/assets/mail-BVU9VLVw.js", "/assets/save-f-wzAblY.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.tenants": { "id": "routes/admin.tenants", "parentId": "routes/admin", "path": "tenants", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.tenants-_BzUOJeP.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Modal-adSWkWLD.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/PrivacyBlur-Vp26brL3.js", "/assets/x-6mvJS0UK.js", "/assets/loader-circle-CaGZsKjo.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/download-nknHt9WM.js", "/assets/chunk-OT5FTIRN-Cb4DR1Nk.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/activity-ZAJHCsfc.js", "/assets/smartphone-NVyChj3R.js", "/assets/globe-DV22Xz5a.js", "/assets/messages-square-D_ugcQAx.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/video-BR-TS2td.js", "/assets/shopping-cart-eqO11M5U.js", "/assets/message-square-DXFYk9Nj.js", "/assets/mail-BVU9VLVw.js", "/assets/chevron-down-DOKZOgBX.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/settings-Cip7W-gj.js", "/assets/index-DBhWJA_Y.js", "/assets/vendor-charts-4N5lwHtV.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin._index": { "id": "routes/admin._index", "parentId": "routes/admin", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin._index-DNb6yNvE.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/Card-Bhh18rui.js", "/assets/Badge-gemha__y.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.emails": { "id": "routes/admin.emails", "parentId": "routes/admin", "path": "emails", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.emails-DU_MQWFu.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/mail-BVU9VLVw.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.status": { "id": "routes/admin.status", "parentId": "routes/admin", "path": "status", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.status-DbzwemeZ.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.videos": { "id": "routes/admin.videos", "parentId": "routes/admin", "path": "videos", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.videos-D1i12gcn.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/format-CAsSOgDD.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/Dialogs-CRbAoiUz.js", "/assets/upload-BJQyUS3g.js", "/assets/film-BQWi96s1.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/search-S3VI0n0n.js", "/assets/funnel-CMCL3Bgb.js", "/assets/play-Yex43xXq.js", "/assets/eye-BvvqFSJ3.js", "/assets/trash-2-DU-4PZMS.js", "/assets/share-2-DTZ3QQ_X.js", "/assets/circle-check-big-Cgvy_36a.js", "/assets/x-6mvJS0UK.js", "/assets/refresh-cw-DFGUiFki.js", "/assets/circle-alert-Day-jl1l.js", "/assets/Modal-adSWkWLD.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.comms": { "id": "routes/admin.comms", "parentId": "routes/admin", "path": "comms", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": true, "module": "/assets/admin.comms-B_ZEmar_.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/mail-BVU9VLVw.js", "/assets/message-square-DXFYk9Nj.js", "/assets/zap-CpdSyYPf.js", "/assets/triangle-alert-CAr0UhK4.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.chat": { "id": "routes/admin.chat", "parentId": "routes/admin", "path": "chat", "index": void 0, "caseSensitive": void 0, "hasAction": true, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.chat-CpD-755I.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/message-circle-cE2JHAhU.js", "/assets/shield-BH971nBf.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.chat.$roomId": { "id": "routes/admin.chat.$roomId", "parentId": "routes/admin.chat", "path": ":roomId", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.chat._roomId-DfUw1Q_P.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/ChatWindow-CeOhxHnr.js", "/assets/api-OnQO3erh.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/index-0-uDmKCt.js", "/assets/arrow-left-CpQHwIrP.js", "/assets/settings-Cip7W-gj.js", "/assets/send-BNR5q9Wk.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/admin.logs": { "id": "routes/admin.logs", "parentId": "routes/admin", "path": "logs", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": true, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/admin.logs-B7TKtvXK.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/activity-ZAJHCsfc.js", "/assets/shield-BH971nBf.js", "/assets/download-nknHt9WM.js", "/assets/chevron-down-DOKZOgBX.js", "/assets/chevron-right-Dyvx1VDk.js", "/assets/vendor-date-fns-MAbw63O8.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/help": { "id": "routes/help", "parentId": "root", "path": "help", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/help-C-wgVwNi.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/x-6mvJS0UK.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/search-S3VI0n0n.js", "/assets/settings-Cip7W-gj.js", "/assets/smartphone-NVyChj3R.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/help.mobile-builder": { "id": "routes/help.mobile-builder", "parentId": "routes/help", "path": "mobile-builder", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/help.mobile-builder--1OQKqeO.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/smartphone-NVyChj3R.js", "/assets/check-yXSU0QnA.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/help.classes": { "id": "routes/help.classes", "parentId": "routes/help", "path": "classes", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/help.classes-BWOyCtW8.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/calendar-CHyLPk-n.js", "/assets/users-DTyswlyE.js", "/assets/video-BR-TS2td.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/help._index": { "id": "routes/help._index", "parentId": "routes/help", "path": void 0, "index": true, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/help._index-B0KYLv_5.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/settings-Cip7W-gj.js", "/assets/arrow-right-TLLbqErj.js", "/assets/smartphone-NVyChj3R.js", "/assets/vendor-sentry-BD1MTpLq.js", "/assets/createLucideIcon-DgXJrNmH.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 }, "routes/help.setup": { "id": "routes/help.setup", "parentId": "routes/help", "path": "setup", "index": void 0, "caseSensitive": void 0, "hasAction": false, "hasLoader": false, "hasClientAction": false, "hasClientLoader": false, "hasClientMiddleware": false, "hasErrorBoundary": false, "module": "/assets/help.setup-DZPuxS6J.js", "imports": ["/assets/chunk-JMJ3UQ3L-DIHTCPR9.js", "/assets/vendor-puck-EFhZVjRu.js", "/assets/settings-Cip7W-gj.js", "/assets/credit-card-BC1Ru1Ky.js", "/assets/createLucideIcon-DgXJrNmH.js", "/assets/arrow-right-TLLbqErj.js", "/assets/vendor-sentry-BD1MTpLq.js"], "css": ["/assets/vendor-puck-B4Ym435T.css"], "clientActionModule": void 0, "clientLoaderModule": void 0, "clientMiddlewareModule": void 0, "hydrateFallbackModule": void 0 } }, "url": "/assets/manifest-04354355.js", "version": "04354355", "sri": void 0 };
const assetsBuildDirectory = "build/client";
const basename = "/";
const future = { "unstable_optimizeDeps": false, "unstable_subResourceIntegrity": false, "unstable_trailingSlashAwareDataRequests": false, "v8_middleware": false, "v8_splitRouteModules": false, "v8_viteEnvironmentApi": false };
const ssr = true;
const isSpaMode = false;
const prerender = [];
const routeDiscovery = { "mode": "lazy", "manifestPath": "/__manifest" };
const publicPath = "/";
const entry = { module: entryServer };
const routes = {
  "root": {
    id: "root",
    parentId: void 0,
    path: "",
    index: void 0,
    caseSensitive: void 0,
    module: route0
  },
  "routes/site.$slug.$pageSlug": {
    id: "routes/site.$slug.$pageSlug",
    parentId: "root",
    path: "site/:slug/:pageSlug",
    index: void 0,
    caseSensitive: void 0,
    module: route1
  },
  "routes/pricing.compare": {
    id: "routes/pricing.compare",
    parentId: "root",
    path: "pricing/compare",
    index: void 0,
    caseSensitive: void 0,
    module: route2
  },
  "routes/pricing._index": {
    id: "routes/pricing._index",
    parentId: "root",
    path: "pricing",
    index: true,
    caseSensitive: void 0,
    module: route3
  },
  "routes/$slug.support": {
    id: "routes/$slug.support",
    parentId: "root",
    path: ":slug/support",
    index: void 0,
    caseSensitive: void 0,
    module: route4
  },
  "routes/accept-invite": {
    id: "routes/accept-invite",
    parentId: "root",
    path: "accept-invite",
    index: void 0,
    caseSensitive: void 0,
    module: route5
  },
  "routes/create-studio": {
    id: "routes/create-studio",
    parentId: "root",
    path: "create-studio",
    index: void 0,
    caseSensitive: void 0,
    module: route6
  },
  "routes/studio.$slug": {
    id: "routes/studio.$slug",
    parentId: "root",
    path: "studio/:slug",
    index: void 0,
    caseSensitive: void 0,
    module: route7
  },
  "routes/studio.$slug.videos.collections.$id": {
    id: "routes/studio.$slug.videos.collections.$id",
    parentId: "routes/studio.$slug",
    path: "videos/collections/:id",
    index: void 0,
    caseSensitive: void 0,
    module: route8
  },
  "routes/studio.$slug.website.editor.$pageId": {
    id: "routes/studio.$slug.website.editor.$pageId",
    parentId: "routes/studio.$slug",
    path: "website/editor/:pageId",
    index: void 0,
    caseSensitive: void 0,
    module: route9
  },
  "routes/studio.$slug.financials.my-payouts": {
    id: "routes/studio.$slug.financials.my-payouts",
    parentId: "routes/studio.$slug",
    path: "financials/my-payouts",
    index: void 0,
    caseSensitive: void 0,
    module: route10
  },
  "routes/studio.$slug.videos.edit.$videoId": {
    id: "routes/studio.$slug.videos.edit.$videoId",
    parentId: "routes/studio.$slug",
    path: "videos/edit/:videoId",
    index: void 0,
    caseSensitive: void 0,
    module: route11
  },
  "routes/studio.$slug.commerce.gift-cards": {
    id: "routes/studio.$slug.commerce.gift-cards",
    parentId: "routes/studio.$slug",
    path: "commerce/gift-cards",
    index: void 0,
    caseSensitive: void 0,
    module: route12
  },
  "routes/studio.$slug.financials.payroll": {
    id: "routes/studio.$slug.financials.payroll",
    parentId: "routes/studio.$slug",
    path: "financials/payroll",
    index: void 0,
    caseSensitive: void 0,
    module: route13
  },
  "routes/studio.$slug.financials._index": {
    id: "routes/studio.$slug.financials._index",
    parentId: "routes/studio.$slug",
    path: "financials",
    index: true,
    caseSensitive: void 0,
    module: route14
  },
  "routes/studio.$slug.commerce.coupons": {
    id: "routes/studio.$slug.commerce.coupons",
    parentId: "routes/studio.$slug",
    path: "commerce/coupons",
    index: void 0,
    caseSensitive: void 0,
    module: route15
  },
  "routes/studio.$slug.commerce.packs": {
    id: "routes/studio.$slug.commerce.packs",
    parentId: "routes/studio.$slug",
    path: "commerce/packs",
    index: void 0,
    caseSensitive: void 0,
    module: route16
  },
  "routes/studio.$slug.substitutions": {
    id: "routes/studio.$slug.substitutions",
    parentId: "routes/studio.$slug",
    path: "substitutions",
    index: void 0,
    caseSensitive: void 0,
    module: route17
  },
  "routes/studio.$slug.videos._index": {
    id: "routes/studio.$slug.videos._index",
    parentId: "routes/studio.$slug",
    path: "videos",
    index: true,
    caseSensitive: void 0,
    module: route18
  },
  "routes/studio.$slug.website.pages": {
    id: "routes/studio.$slug.website.pages",
    parentId: "routes/studio.$slug",
    path: "website/pages",
    index: void 0,
    caseSensitive: void 0,
    module: route19
  },
  "routes/studio.$slug.appointments": {
    id: "routes/studio.$slug.appointments",
    parentId: "routes/studio.$slug",
    path: "appointments",
    index: void 0,
    caseSensitive: void 0,
    module: route20
  },
  "routes/studio.$slug.appointments.calendar": {
    id: "routes/studio.$slug.appointments.calendar",
    parentId: "routes/studio.$slug.appointments",
    path: "calendar",
    index: void 0,
    caseSensitive: void 0,
    module: route21
  },
  "routes/studio.$slug.memberships": {
    id: "routes/studio.$slug.memberships",
    parentId: "routes/studio.$slug",
    path: "memberships",
    index: void 0,
    caseSensitive: void 0,
    module: route22
  },
  "routes/studio.$slug.challenges": {
    id: "routes/studio.$slug.challenges",
    parentId: "routes/studio.$slug",
    path: "challenges",
    index: void 0,
    caseSensitive: void 0,
    module: route23
  },
  "routes/studio.$slug.instructor": {
    id: "routes/studio.$slug.instructor",
    parentId: "routes/studio.$slug",
    path: "instructor",
    index: void 0,
    caseSensitive: void 0,
    module: route24
  },
  "routes/studio.$slug.instructor.schedule": {
    id: "routes/studio.$slug.instructor.schedule",
    parentId: "routes/studio.$slug.instructor",
    path: "schedule",
    index: void 0,
    caseSensitive: void 0,
    module: route25
  },
  "routes/studio.$slug.instructor.payroll": {
    id: "routes/studio.$slug.instructor.payroll",
    parentId: "routes/studio.$slug.instructor",
    path: "payroll",
    index: void 0,
    caseSensitive: void 0,
    module: route26
  },
  "routes/studio.$slug.dashboard": {
    id: "routes/studio.$slug.dashboard",
    parentId: "routes/studio.$slug",
    path: "dashboard",
    index: void 0,
    caseSensitive: void 0,
    module: route27
  },
  "routes/studio.$slug.discounts": {
    id: "routes/studio.$slug.discounts",
    parentId: "routes/studio.$slug",
    path: "discounts",
    index: void 0,
    caseSensitive: void 0,
    module: route28
  },
  "routes/studio.$slug.marketing": {
    id: "routes/studio.$slug.marketing",
    parentId: "routes/studio.$slug",
    path: "marketing",
    index: void 0,
    caseSensitive: void 0,
    module: route29
  },
  "routes/studio.$slug.marketing.automations": {
    id: "routes/studio.$slug.marketing.automations",
    parentId: "routes/studio.$slug.marketing",
    path: "automations",
    index: void 0,
    caseSensitive: void 0,
    module: route30
  },
  "routes/studio.$slug.marketing.referrals": {
    id: "routes/studio.$slug.marketing.referrals",
    parentId: "routes/studio.$slug.marketing",
    path: "referrals",
    index: void 0,
    caseSensitive: void 0,
    module: route31
  },
  "routes/studio.$slug.branding": {
    id: "routes/studio.$slug.branding",
    parentId: "routes/studio.$slug",
    path: "branding",
    index: void 0,
    caseSensitive: void 0,
    module: route32
  },
  "routes/studio.$slug.checkout": {
    id: "routes/studio.$slug.checkout",
    parentId: "routes/studio.$slug",
    path: "checkout",
    index: void 0,
    caseSensitive: void 0,
    module: route33
  },
  "routes/studio.$slug.checkout.return": {
    id: "routes/studio.$slug.checkout.return",
    parentId: "routes/studio.$slug.checkout",
    path: "return",
    index: void 0,
    caseSensitive: void 0,
    module: route34
  },
  "routes/studio.$slug.finances": {
    id: "routes/studio.$slug.finances",
    parentId: "routes/studio.$slug",
    path: "finances",
    index: void 0,
    caseSensitive: void 0,
    module: route35
  },
  "routes/studio.$slug.schedule": {
    id: "routes/studio.$slug.schedule",
    parentId: "routes/studio.$slug",
    path: "schedule",
    index: void 0,
    caseSensitive: void 0,
    module: route36
  },
  "routes/studio.$slug.settings": {
    id: "routes/studio.$slug.settings",
    parentId: "routes/studio.$slug",
    path: "settings",
    index: void 0,
    caseSensitive: void 0,
    module: route37
  },
  "routes/studio.$slug.settings.integrations": {
    id: "routes/studio.$slug.settings.integrations",
    parentId: "routes/studio.$slug.settings",
    path: "integrations",
    index: void 0,
    caseSensitive: void 0,
    module: route38
  },
  "routes/studio.$slug.settings.locations": {
    id: "routes/studio.$slug.settings.locations",
    parentId: "routes/studio.$slug.settings",
    path: "locations",
    index: void 0,
    caseSensitive: void 0,
    module: route39
  },
  "routes/studio.$slug.settings.branding": {
    id: "routes/studio.$slug.settings.branding",
    parentId: "routes/studio.$slug.settings",
    path: "branding",
    index: void 0,
    caseSensitive: void 0,
    module: route40
  },
  "routes/studio.$slug.settings.hardware": {
    id: "routes/studio.$slug.settings.hardware",
    parentId: "routes/studio.$slug.settings",
    path: "hardware",
    index: void 0,
    caseSensitive: void 0,
    module: route41
  },
  "routes/studio.$slug.settings.billing": {
    id: "routes/studio.$slug.settings.billing",
    parentId: "routes/studio.$slug.settings",
    path: "billing",
    index: void 0,
    caseSensitive: void 0,
    module: route42
  },
  "routes/studio.$slug.settings._index": {
    id: "routes/studio.$slug.settings._index",
    parentId: "routes/studio.$slug.settings",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route43
  },
  "routes/studio.$slug.settings.addons": {
    id: "routes/studio.$slug.settings.addons",
    parentId: "routes/studio.$slug.settings",
    path: "addons",
    index: void 0,
    caseSensitive: void 0,
    module: route44
  },
  "routes/studio.$slug.settings.domain": {
    id: "routes/studio.$slug.settings.domain",
    parentId: "routes/studio.$slug.settings",
    path: "domain",
    index: void 0,
    caseSensitive: void 0,
    module: route45
  },
  "routes/studio.$slug.settings.embeds": {
    id: "routes/studio.$slug.settings.embeds",
    parentId: "routes/studio.$slug.settings",
    path: "embeds",
    index: void 0,
    caseSensitive: void 0,
    module: route46
  },
  "routes/studio.$slug.settings.mobile": {
    id: "routes/studio.$slug.settings.mobile",
    parentId: "routes/studio.$slug.settings",
    path: "mobile",
    index: void 0,
    caseSensitive: void 0,
    module: route47
  },
  "routes/studio.$slug.settings.chat": {
    id: "routes/studio.$slug.settings.chat",
    parentId: "routes/studio.$slug.settings",
    path: "chat",
    index: void 0,
    caseSensitive: void 0,
    module: route48
  },
  "routes/studio.$slug.settings.qr": {
    id: "routes/studio.$slug.settings.qr",
    parentId: "routes/studio.$slug.settings",
    path: "qr",
    index: void 0,
    caseSensitive: void 0,
    module: route49
  },
  "routes/studio.$slug.students": {
    id: "routes/studio.$slug.students",
    parentId: "routes/studio.$slug",
    path: "students",
    index: void 0,
    caseSensitive: void 0,
    module: route50
  },
  "routes/studio.$slug.students._index": {
    id: "routes/studio.$slug.students._index",
    parentId: "routes/studio.$slug.students",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route51
  },
  "routes/studio.$slug.students.$id": {
    id: "routes/studio.$slug.students.$id",
    parentId: "routes/studio.$slug.students",
    path: ":id",
    index: void 0,
    caseSensitive: void 0,
    module: route52
  },
  "routes/studio.$slug.checkin": {
    id: "routes/studio.$slug.checkin",
    parentId: "routes/studio.$slug",
    path: "checkin",
    index: void 0,
    caseSensitive: void 0,
    module: route53
  },
  "routes/studio.$slug.classes": {
    id: "routes/studio.$slug.classes",
    parentId: "routes/studio.$slug",
    path: "classes",
    index: void 0,
    caseSensitive: void 0,
    module: route54
  },
  "routes/studio.$slug.classes.$classId.live": {
    id: "routes/studio.$slug.classes.$classId.live",
    parentId: "routes/studio.$slug.classes",
    path: ":classId/live",
    index: void 0,
    caseSensitive: void 0,
    module: route55
  },
  "routes/studio.$slug.classes.$id.roster": {
    id: "routes/studio.$slug.classes.$id.roster",
    parentId: "routes/studio.$slug.classes",
    path: ":id/roster",
    index: void 0,
    caseSensitive: void 0,
    module: route56
  },
  "routes/studio.$slug.classes._index": {
    id: "routes/studio.$slug.classes._index",
    parentId: "routes/studio.$slug.classes",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route57
  },
  "routes/studio.$slug.loyalty": {
    id: "routes/studio.$slug.loyalty",
    parentId: "routes/studio.$slug",
    path: "loyalty",
    index: void 0,
    caseSensitive: void 0,
    module: route58
  },
  "routes/studio.$slug.profile": {
    id: "routes/studio.$slug.profile",
    parentId: "routes/studio.$slug",
    path: "profile",
    index: void 0,
    caseSensitive: void 0,
    module: route59
  },
  "routes/studio.$slug.reports": {
    id: "routes/studio.$slug.reports",
    parentId: "routes/studio.$slug",
    path: "reports",
    index: void 0,
    caseSensitive: void 0,
    module: route60
  },
  "routes/studio.$slug.reports.advanced": {
    id: "routes/studio.$slug.reports.advanced",
    parentId: "routes/studio.$slug.reports",
    path: "advanced",
    index: void 0,
    caseSensitive: void 0,
    module: route61
  },
  "routes/studio.$slug.reports.custom": {
    id: "routes/studio.$slug.reports.custom",
    parentId: "routes/studio.$slug.reports",
    path: "custom",
    index: void 0,
    caseSensitive: void 0,
    module: route62
  },
  "routes/studio.$slug.waivers": {
    id: "routes/studio.$slug.waivers",
    parentId: "routes/studio.$slug",
    path: "waivers",
    index: void 0,
    caseSensitive: void 0,
    module: route63
  },
  "routes/studio.$slug.waivers._index": {
    id: "routes/studio.$slug.waivers._index",
    parentId: "routes/studio.$slug.waivers",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route64
  },
  "routes/studio.$slug.waivers.new": {
    id: "routes/studio.$slug.waivers.new",
    parentId: "routes/studio.$slug.waivers",
    path: "new",
    index: void 0,
    caseSensitive: void 0,
    module: route65
  },
  "routes/studio.$slug._index": {
    id: "routes/studio.$slug._index",
    parentId: "routes/studio.$slug",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route66
  },
  "routes/studio.$slug.retail": {
    id: "routes/studio.$slug.retail",
    parentId: "routes/studio.$slug",
    path: "retail",
    index: void 0,
    caseSensitive: void 0,
    module: route67
  },
  "routes/studio.$slug.leads": {
    id: "routes/studio.$slug.leads",
    parentId: "routes/studio.$slug",
    path: "leads",
    index: void 0,
    caseSensitive: void 0,
    module: route68
  },
  "routes/studio.$slug.tasks": {
    id: "routes/studio.$slug.tasks",
    parentId: "routes/studio.$slug",
    path: "tasks",
    index: void 0,
    caseSensitive: void 0,
    module: route69
  },
  "routes/studio.$slug.chat": {
    id: "routes/studio.$slug.chat",
    parentId: "routes/studio.$slug",
    path: "chat",
    index: void 0,
    caseSensitive: void 0,
    module: route70
  },
  "routes/studio.$slug.chat.$roomId": {
    id: "routes/studio.$slug.chat.$roomId",
    parentId: "routes/studio.$slug.chat",
    path: ":roomId",
    index: void 0,
    caseSensitive: void 0,
    module: route71
  },
  "routes/studio.$slug.data": {
    id: "routes/studio.$slug.data",
    parentId: "routes/studio.$slug",
    path: "data",
    index: void 0,
    caseSensitive: void 0,
    module: route72
  },
  "routes/studio.$slug.data._index": {
    id: "routes/studio.$slug.data._index",
    parentId: "routes/studio.$slug.data",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route73
  },
  "routes/studio.$slug.data.export": {
    id: "routes/studio.$slug.data.export",
    parentId: "routes/studio.$slug.data",
    path: "export",
    index: void 0,
    caseSensitive: void 0,
    module: route74
  },
  "routes/studio.$slug.data.import": {
    id: "routes/studio.$slug.data.import",
    parentId: "routes/studio.$slug.data",
    path: "import",
    index: void 0,
    caseSensitive: void 0,
    module: route75
  },
  "routes/studio.$slug.pos": {
    id: "routes/studio.$slug.pos",
    parentId: "routes/studio.$slug",
    path: "pos",
    index: void 0,
    caseSensitive: void 0,
    module: route76
  },
  "routes/embed.$slug": {
    id: "routes/embed.$slug",
    parentId: "root",
    path: "embed/:slug",
    index: void 0,
    caseSensitive: void 0,
    module: route77
  },
  "routes/embed.$slug.calendar": {
    id: "routes/embed.$slug.calendar",
    parentId: "routes/embed.$slug",
    path: "calendar",
    index: void 0,
    caseSensitive: void 0,
    module: route78
  },
  "routes/embed.$slug.pricing": {
    id: "routes/embed.$slug.pricing",
    parentId: "routes/embed.$slug",
    path: "pricing",
    index: void 0,
    caseSensitive: void 0,
    module: route79
  },
  "routes/embed.$slug.book": {
    id: "routes/embed.$slug.book",
    parentId: "routes/embed.$slug",
    path: "book",
    index: void 0,
    caseSensitive: void 0,
    module: route80
  },
  "routes/embed.$slug.chat": {
    id: "routes/embed.$slug.chat",
    parentId: "routes/embed.$slug",
    path: "chat",
    index: void 0,
    caseSensitive: void 0,
    module: route81
  },
  "routes/embed.$slug.shop": {
    id: "routes/embed.$slug.shop",
    parentId: "routes/embed.$slug",
    path: "shop",
    index: void 0,
    caseSensitive: void 0,
    module: route82
  },
  "routes/$pageSlug": {
    id: "routes/$pageSlug",
    parentId: "root",
    path: ":pageSlug",
    index: void 0,
    caseSensitive: void 0,
    module: route83
  },
  "routes/dashboard": {
    id: "routes/dashboard",
    parentId: "root",
    path: "dashboard",
    index: void 0,
    caseSensitive: void 0,
    module: route84
  },
  "routes/dashboard.classes": {
    id: "routes/dashboard.classes",
    parentId: "routes/dashboard",
    path: "classes",
    index: void 0,
    caseSensitive: void 0,
    module: route85
  },
  "routes/dashboard.classes.$id.roster": {
    id: "routes/dashboard.classes.$id.roster",
    parentId: "routes/dashboard.classes",
    path: ":id/roster",
    index: void 0,
    caseSensitive: void 0,
    module: route86
  },
  "routes/dashboard.classes.$id.watch": {
    id: "routes/dashboard.classes.$id.watch",
    parentId: "routes/dashboard.classes",
    path: ":id/watch",
    index: void 0,
    caseSensitive: void 0,
    module: route87
  },
  "routes/dashboard.classes._index": {
    id: "routes/dashboard.classes._index",
    parentId: "routes/dashboard.classes",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route88
  },
  "routes/dashboard.profile": {
    id: "routes/dashboard.profile",
    parentId: "routes/dashboard",
    path: "profile",
    index: void 0,
    caseSensitive: void 0,
    module: route89
  },
  "routes/dashboard._index": {
    id: "routes/dashboard._index",
    parentId: "routes/dashboard",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route90
  },
  "routes/debug-ssr": {
    id: "routes/debug-ssr",
    parentId: "root",
    path: "debug-ssr",
    index: void 0,
    caseSensitive: void 0,
    module: route91
  },
  "routes/sign-in.$": {
    id: "routes/sign-in.$",
    parentId: "root",
    path: "sign-in/*",
    index: void 0,
    caseSensitive: void 0,
    module: route92
  },
  "routes/sign-up.$": {
    id: "routes/sign-up.$",
    parentId: "root",
    path: "sign-up/*",
    index: void 0,
    caseSensitive: void 0,
    module: route93
  },
  "routes/_index": {
    id: "routes/_index",
    parentId: "root",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route94
  },
  "routes/admin": {
    id: "routes/admin",
    parentId: "root",
    path: "admin",
    index: void 0,
    caseSensitive: void 0,
    module: route95
  },
  "routes/admin.website.edit.$pageId": {
    id: "routes/admin.website.edit.$pageId",
    parentId: "routes/admin",
    path: "website/edit/:pageId",
    index: void 0,
    caseSensitive: void 0,
    module: route96
  },
  "routes/admin.communications.logs": {
    id: "routes/admin.communications.logs",
    parentId: "routes/admin",
    path: "communications/logs",
    index: void 0,
    caseSensitive: void 0,
    module: route97
  },
  "routes/admin.coupons._index": {
    id: "routes/admin.coupons._index",
    parentId: "routes/admin",
    path: "coupons",
    index: true,
    caseSensitive: void 0,
    module: route98
  },
  "routes/admin.website._index": {
    id: "routes/admin.website._index",
    parentId: "routes/admin",
    path: "website",
    index: true,
    caseSensitive: void 0,
    module: route99
  },
  "routes/admin.users.$userId": {
    id: "routes/admin.users.$userId",
    parentId: "routes/admin",
    path: "users/:userId",
    index: void 0,
    caseSensitive: void 0,
    module: route100
  },
  "routes/admin.architecture": {
    id: "routes/admin.architecture",
    parentId: "routes/admin",
    path: "architecture",
    index: void 0,
    caseSensitive: void 0,
    module: route101
  },
  "routes/admin.users._index": {
    id: "routes/admin.users._index",
    parentId: "routes/admin",
    path: "users",
    index: true,
    caseSensitive: void 0,
    module: route102
  },
  "routes/admin.diagnostics": {
    id: "routes/admin.diagnostics",
    parentId: "routes/admin",
    path: "diagnostics",
    index: void 0,
    caseSensitive: void 0,
    module: route103
  },
  "routes/admin.diagnostics.run": {
    id: "routes/admin.diagnostics.run",
    parentId: "routes/admin.diagnostics",
    path: "run",
    index: void 0,
    caseSensitive: void 0,
    module: route104
  },
  "routes/admin.projections": {
    id: "routes/admin.projections",
    parentId: "routes/admin",
    path: "projections",
    index: void 0,
    caseSensitive: void 0,
    module: route105
  },
  "routes/admin.financials": {
    id: "routes/admin.financials",
    parentId: "routes/admin",
    path: "financials",
    index: void 0,
    caseSensitive: void 0,
    module: route106
  },
  "routes/admin.financials.failed": {
    id: "routes/admin.financials.failed",
    parentId: "routes/admin.financials",
    path: "failed",
    index: void 0,
    caseSensitive: void 0,
    module: route107
  },
  "routes/admin.workflows": {
    id: "routes/admin.workflows",
    parentId: "routes/admin",
    path: "workflows",
    index: void 0,
    caseSensitive: void 0,
    module: route108
  },
  "routes/admin.features": {
    id: "routes/admin.features",
    parentId: "routes/admin",
    path: "features",
    index: void 0,
    caseSensitive: void 0,
    module: route109
  },
  "routes/admin.tenants": {
    id: "routes/admin.tenants",
    parentId: "routes/admin",
    path: "tenants",
    index: void 0,
    caseSensitive: void 0,
    module: route110
  },
  "routes/admin._index": {
    id: "routes/admin._index",
    parentId: "routes/admin",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route111
  },
  "routes/admin.emails": {
    id: "routes/admin.emails",
    parentId: "routes/admin",
    path: "emails",
    index: void 0,
    caseSensitive: void 0,
    module: route112
  },
  "routes/admin.status": {
    id: "routes/admin.status",
    parentId: "routes/admin",
    path: "status",
    index: void 0,
    caseSensitive: void 0,
    module: route113
  },
  "routes/admin.videos": {
    id: "routes/admin.videos",
    parentId: "routes/admin",
    path: "videos",
    index: void 0,
    caseSensitive: void 0,
    module: route114
  },
  "routes/admin.comms": {
    id: "routes/admin.comms",
    parentId: "routes/admin",
    path: "comms",
    index: void 0,
    caseSensitive: void 0,
    module: route115
  },
  "routes/admin.chat": {
    id: "routes/admin.chat",
    parentId: "routes/admin",
    path: "chat",
    index: void 0,
    caseSensitive: void 0,
    module: route116
  },
  "routes/admin.chat.$roomId": {
    id: "routes/admin.chat.$roomId",
    parentId: "routes/admin.chat",
    path: ":roomId",
    index: void 0,
    caseSensitive: void 0,
    module: route117
  },
  "routes/admin.logs": {
    id: "routes/admin.logs",
    parentId: "routes/admin",
    path: "logs",
    index: void 0,
    caseSensitive: void 0,
    module: route118
  },
  "routes/help": {
    id: "routes/help",
    parentId: "root",
    path: "help",
    index: void 0,
    caseSensitive: void 0,
    module: route119
  },
  "routes/help.mobile-builder": {
    id: "routes/help.mobile-builder",
    parentId: "routes/help",
    path: "mobile-builder",
    index: void 0,
    caseSensitive: void 0,
    module: route120
  },
  "routes/help.classes": {
    id: "routes/help.classes",
    parentId: "routes/help",
    path: "classes",
    index: void 0,
    caseSensitive: void 0,
    module: route121
  },
  "routes/help._index": {
    id: "routes/help._index",
    parentId: "routes/help",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: route122
  },
  "routes/help.setup": {
    id: "routes/help.setup",
    parentId: "routes/help",
    path: "setup",
    index: void 0,
    caseSensitive: void 0,
    module: route123
  }
};
const allowedActionOrigins = false;
export {
  allowedActionOrigins,
  serverManifest as assets,
  assetsBuildDirectory,
  basename,
  entry,
  future,
  isSpaMode,
  prerender,
  publicPath,
  routeDiscovery,
  routes,
  ssr
};
