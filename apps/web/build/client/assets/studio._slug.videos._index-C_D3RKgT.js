import{w as M,u as V,h as _,a as B,e as R,L as J}from"./chunk-JMJ3UQ3L-BFmd18Yu.js";import{j as e}from"./vendor-puck-aUaaDwmz.js";import{a as I}from"./api-D1U4i9fn.js";import{a as $}from"./format-CAsSOgDD.js";import{a as n}from"./vendor-livekit-D3VpklN2.js";import{t as L}from"./index-BFgzoDOP.js";import{U as q}from"./upload-DoKnH7Yo.js";import{I as D}from"./image-B4UGPaq8.js";import{F as A}from"./film-Cpmj_PU0.js";import{c as H}from"./createLucideIcon-CcD9UNCP.js";import{X as O}from"./x-Cbj0htte.js";import{I as X}from"./info-C37kSVMz.js";import{P as K}from"./plus-Cj1r96us.js";import{R as Z}from"./refresh-cw-DEg60w5A.js";import{S as G}from"./save-BvwiY0_u.js";const Q=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],F=H("folder",Q),fe=M(function(){const{videos:a,storageUsage:o,images:r,collections:x}=V(),g=_(),[j,b]=B(),{isStudentView:m}=R(),c=j.get("tab")||"videos",[z,k]=n.useState("grid"),[p,u]=n.useState(null),[y,S]=n.useState(!1),[N,C]=n.useState("video"),[l,h]=n.useState(!1),[w,f]=n.useState(null),U=async t=>{h(!0);try{const i=await window.Clerk?.session?.getToken(),d=await I("/video-management/upload-url",i,{method:"POST",body:JSON.stringify({type:"vod"}),headers:{"X-Tenant-Slug":window.tenantSlug||""}}),{uploadUrl:v,uid:P}=d,E=new FormData;if(E.append("file",t),!(await fetch(v,{method:"POST",body:E})).ok)throw new Error("Upload to video server failed");await I("/video-management/",i,{method:"POST",body:JSON.stringify({title:t.name,cloudflareStreamId:P})}),g.revalidate()}catch(i){console.error(i),f("Upload failed: "+i.message)}finally{h(!1)}},T=async t=>{h(!0),f(null);try{const i=await window.Clerk?.session?.getToken(),d=new FormData;if(d.append("file",t),!(await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:d})).ok)throw new Error("Image upload failed");g.revalidate()}catch(i){f("Upload failed: "+i.message)}finally{h(!1)}};return e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-zinc-50/50 dark:bg-zinc-950",children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Media Library"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage your class recordings and photo assets."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-zinc-600 dark:text-zinc-400",children:"Storage Used: "}),e.jsx("span",{className:"font-bold text-zinc-900 dark:text-zinc-200",children:$(o)})]}),!m&&(c==="videos"?e.jsxs("label",{className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${l?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(q,{size:18}),l?"Uploading...":"Upload Video",e.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:t=>t.target.files?.[0]&&U(t.target.files[0]),disabled:l})]}):e.jsxs("label",{className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${l?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(D,{size:18}),l?"Uploading...":"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>t.target.files?.[0]&&T(t.target.files[0]),disabled:l})]}))]})]}),e.jsxs("div",{className:"flex space-x-6 border-b border-zinc-100 dark:border-zinc-800 -mb-px",children:[e.jsxs("button",{onClick:()=>b({tab:"videos"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${c==="videos"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(A,{size:16})," Videos (",a.length,")"]}),e.jsxs("button",{onClick:()=>b({tab:"collections"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${c==="collections"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(F,{size:16})," Collections (",x.length,")"]}),e.jsxs("button",{onClick:()=>b({tab:"images"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${c==="images"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(D,{size:16})," Photos (",r.length,")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[w&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4 text-sm flex justify-between items-center",children:[w,e.jsx("button",{onClick:()=>f(null),children:e.jsx(O,{size:14})})]}),c==="videos"?e.jsx(W,{videos:a,onSelect:u,selectedId:p?.id}):c==="collections"?e.jsx(Y,{collections:x}):e.jsx(ee,{images:r,onSelect:u,selectedId:p?.id})]})]}),p&&e.jsx(te,{item:p,type:c==="videos"?"video":"image",onClose:()=>u(null),onUpdate:()=>{g.revalidate()}})]})});function W({videos:s,onSelect:a,selectedId:o}){return s.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No videos found."}):e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800 font-medium text-zinc-500 dark:text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"Duration"}),e.jsx("th",{className:"px-4 py-3",children:"Tags"}),e.jsx("th",{className:"px-4 py-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:s.map(r=>e.jsxs("tr",{onClick:()=>a(r),className:`cursor-pointer hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition ${o===r.id?"bg-blue-50/50 dark:bg-blue-900/10":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium text-zinc-900 dark:text-zinc-100",children:r.title}),e.jsx("td",{className:"px-4 py-3 text-zinc-500 dark:text-zinc-400",children:r.duration?Math.floor(r.duration/60)+"m":"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.tags?.slice(0,3).map(x=>e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded text-xs",children:x},x)),r.tags?.length>3&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["+",r.tags.length-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:e.jsx(X,{size:16})})})]},r.id))})]})})}function Y({collections:s,onCreate:a}){return s.length===0&&!a?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No collections found."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(o=>e.jsx(J,{to:`collections/${o.id}`,className:"block group",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-black dark:hover:border-zinc-400 transition shadow-sm h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-zinc-100 dark:bg-zinc-800 rounded-lg group-hover:bg-zinc-900 dark:group-hover:bg-zinc-100 group-hover:text-white dark:group-hover:text-black transition",children:e.jsx(F,{size:24})}),e.jsxs("span",{className:"text-xs text-zinc-400 font-mono",children:["#",o.slug]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1 text-zinc-900 dark:text-zinc-100",children:o.title}),e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 line-clamp-2 mb-4 flex-1",children:o.description||"No description"}),e.jsx("div",{className:"text-xs text-zinc-400 font-medium",children:"Click to manage items â†’"})]})},o.id)),e.jsxs("div",{className:"border-2 border-dashed border-zinc-200 rounded-lg p-6 flex flex-col items-center justify-center text-zinc-400 hover:bg-zinc-50 hover:border-zinc-300 transition cursor-pointer min-h-[200px]",onClick:a,children:[e.jsx(K,{size:32}),e.jsx("span",{className:"mt-2 text-sm font-medium",children:"Create Collection"})]})]})}function ee({images:s,onSelect:a,selectedId:o}){return s.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:s.map(r=>e.jsxs("div",{onClick:()=>a(r),className:`bg-white dark:bg-zinc-900 rounded border aspect-square relative group cursor-pointer overflow-hidden ${o===r.id?"ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-zinc-900":"hover:border-zinc-300 dark:hover:border-zinc-600 border-zinc-200 dark:border-zinc-800"}`,children:[e.jsx("img",{src:r.fileUrl,alt:r.title,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:r.title||r.originalName}),e.jsx("p",{className:"text-white/80 text-xs",children:$(r.sizeBytes)})]})]},r.id))})}function te({item:s,type:a,onClose:o,onUpdate:r}){const[x,g]=n.useState(s.title||s.originalName||""),[j,b]=n.useState(s.description||""),[m,c]=n.useState(s.tags||[]),[z,k]=n.useState(""),[p,u]=n.useState(!1),[y,S]=n.useState(s.accessLevel||"members"),[N,C]=n.useState(s.posterUrl||""),[l,h]=n.useState(!1);n.useEffect(()=>{g(s.title||s.originalName||""),b(s.description||""),c(s.tags||[]),a==="video"&&(S(s.accessLevel||"members"),C(s.posterUrl||"")),k("")},[s,a]);const w=t=>{t.key==="Enter"&&z.trim()&&(t.preventDefault(),m.includes(z.trim())||c([...m,z.trim()]),k(""))},f=t=>{c(m.filter(i=>i!==t))},U=async t=>{h(!0);try{const i=await window.Clerk?.session?.getToken(),d=new FormData;d.append("file",t);const v=await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:d});if(!v.ok)throw new Error("Upload failed");const P=await v.json();C(P.url)}catch(i){console.error(i),L.error("Poster upload failed")}finally{h(!1)}},T=async()=>{u(!0);try{const t=await window.Clerk?.session?.getToken(),i=a==="video"?`/video-management/${s.id}`:`/uploads/images/${s.id}`,d={title:x,description:j,tags:m};a==="video"&&(d.accessLevel=y,d.posterUrl=N),await I(i,t,{method:"PATCH",body:JSON.stringify(d)}),r(),L.success("Changes saved.")}catch(t){console.error(t),L.error("Failed to save changes.")}finally{u(!1)}};return e.jsxs("div",{className:"w-80 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 shadow-xl flex flex-col overflow-hidden animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-800/50",children:[e.jsxs("span",{className:"font-semibold text-sm uppercase text-zinc-500 dark:text-zinc-400 tracking-wide",children:[a," Details"]}),e.jsx("button",{onClick:o,className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:e.jsx(O,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"aspect-video bg-zinc-100 rounded-lg overflow-hidden border border-zinc-200 flex items-center justify-center relative group",children:[a==="image"?e.jsx("img",{src:s.fileUrl,className:"w-full h-full object-contain"}):N?e.jsx("img",{src:N,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-2 text-zinc-400",children:[e.jsx(A,{size:24}),e.jsx("span",{className:"text-xs",children:"No preview available"})]}),a==="video"&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>t.target.files?.[0]&&U(t.target.files[0]),disabled:l}),e.jsxs("span",{className:"text-white text-xs font-medium flex items-center gap-2",children:[l?e.jsx(Z,{className:"animate-spin",size:16}):e.jsx(D,{size:16}),"Change Poster"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-zinc-500",children:[e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Size"}),$(s.sizeBytes)]}),e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Created"}),new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:x,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Description"}),e.jsx("textarea",{value:j,onChange:t=>b(t.target.value),rows:3,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Tags / Labels"}),e.jsxs("div",{className:"min-h-[40px] p-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-800 flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-black dark:focus-within:ring-white focus-within:border-transparent",children:[m.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 px-2 py-1 rounded text-xs font-medium",children:[t,e.jsx("button",{onClick:()=>f(t),className:"hover:text-red-500",children:e.jsx(O,{size:10})})]},t)),e.jsx("input",{type:"text",value:z,onChange:t=>k(t.target.value),onKeyDown:w,placeholder:m.length===0?"Type and enter...":"",className:"flex-1 min-w-[60px] text-sm outline-none bg-transparent dark:text-white"})]}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Press Enter to add tag"})]}),a==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Access Level"}),e.jsxs("select",{value:y,onChange:t=>S(t.target.value),className:"w-full px-2 py-2 border border-zinc-200 rounded-lg text-sm outline-none",children:[e.jsx("option",{value:"public",children:"Public (Everyone)"}),e.jsx("option",{value:"members",children:"Members Only (Logged In)"}),e.jsx("option",{value:"private",children:"Private (Admin Only)"})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50",children:e.jsx("button",{onClick:T,disabled:p,className:"w-full bg-black dark:bg-zinc-100 text-white dark:text-zinc-900 py-2 rounded-lg font-medium text-sm hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 flex items-center justify-center gap-2",children:p?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(G,{size:16})," Save Usage"]})})})]})}export{fe as default};
