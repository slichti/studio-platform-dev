import{w as D,u as R,e as E}from"./chunk-JMJ3UQ3L-BFmd18Yu.js";import{j as e}from"./vendor-puck-aUaaDwmz.js";import{a as u}from"./api-D1U4i9fn.js";import{a as l}from"./vendor-livekit-D3VpklN2.js";import{E as L}from"./Dialogs-C3BiSLFk.js";import{R as P}from"./refresh-cw-DEg60w5A.js";import{C as X}from"./circle-alert-BrO62f5x.js";import{C as S}from"./circle-check-big-DvZS8AIf.js";import{C as k}from"./clock-BEkBHqHW.js";import{u as $}from"./chunk-OT5FTIRN-BoMpxN7p.js";import"./Modal-RrMUvIY-.js";import"./createLucideIcon-CcD9UNCP.js";import"./index-DYRzKbRc.js";import"./index-7UaQKl4K.js";const ee=D(function(){const{substitutions:o,error:a}=R(),{tenant:i,me:b}=E()||{},{getToken:x}=$(),[s,N]=l.useState(o||[]),[m,h]=l.useState(!1),[p,f]=l.useState({isOpen:!1,message:""}),[C,z]=l.useState(!1),[O,I]=l.useState([]),[n,j]=l.useState({classId:"",notes:""}),T=async()=>{z(!0);try{const t=await x(),r=await u(`/classes?startDate=${new Date().toISOString()}&instructorId=${b?.member?.id}`,t,{headers:{"X-Tenant-Slug":i.slug}});I(Array.isArray(r)?r:[])}catch(t){console.error(t)}},q=async t=>{t.preventDefault(),h(!0);try{const r=await x(),c=await u(`/sub-dispatch/classes/${n.classId}/request`,r,{method:"POST",headers:{"X-Tenant-Slug":i.slug},body:JSON.stringify({message:n.notes})});if(c.error)throw new Error(c.error);z(!1),j({classId:"",notes:""});const g=await u("/sub-dispatch/items",r,{headers:{"X-Tenant-Slug":i.slug}});N(g.requests||[])}catch(r){f({isOpen:!0,message:r.message})}finally{h(!1)}};b?.roles?.includes("owner");const v=async(t,r)=>{if(!m){h(!0);try{if(r!=="accept")return;const c=await x(),g=await u(`/sub-dispatch/items/${t}/accept`,c,{method:"POST",headers:{"X-Tenant-Slug":i.slug}});if(g.error)throw new Error(g.error);const A=await u("/sub-dispatch/items",c,{headers:{"X-Tenant-Slug":i.slug}});N(A.requests||[])}catch(c){f({isOpen:!0,message:c.message})}finally{h(!1)}}};return e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",children:e.jsx(P,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Substitutions"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"Manage shift coverage and instructor changes."})]})]}),e.jsx("button",{onClick:T,className:"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 transition-colors shadow-lg shadow-zinc-500/10",children:"Request Cover"})]}),a&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg text-sm border border-red-200",children:a}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl max-w-md w-full p-6 shadow-2xl border border-zinc-200 dark:border-zinc-800",children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-4",children:"Request Coverage"}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Select Class"}),e.jsxs("select",{className:"w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",value:n.classId,onChange:t=>j({...n,classId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Choose a Class --"}),O.map(t=>e.jsxs("option",{value:t.id,children:[new Date(t.startTime).toLocaleDateString()," ",new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",t.title]},t.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{className:"w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",rows:3,placeholder:"Reason for sub request...",value:n.notes,onChange:t=>j({...n,notes:t.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m||!n.classId,className:"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 disabled:opacity-50",children:m?"Submitting...":"Submit Request"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[e.jsx(w,{title:"Needs Coverage",icon:e.jsx(X,{className:"text-amber-500",size:18}),children:e.jsx(y,{items:s.filter(t=>t.status==="open"),onAction:v,canClaim:!0,currentMemberId:b?.member?.id,loading:m})}),e.jsx(w,{title:"Filled / Past",icon:e.jsx(S,{className:"text-green-500",size:18}),children:e.jsx(y,{items:s.filter(t=>t.status==="filled"),onAction:v,readOnly:!0,loading:m})})]}),e.jsx(L,{isOpen:p.isOpen,onClose:()=>f({...p,isOpen:!1}),message:p.message})]})});function w({title:d,icon:o,children:a}){return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o,e.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-200",children:d})]}),e.jsx("span",{className:"bg-zinc-200 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-widest",children:Array.isArray(a.props.items)?a.props.items.length:0})]}),e.jsx("div",{children:a})]})}function y({items:d,onAction:o,canClaim:a,readOnly:i,currentMemberId:b,loading:x}){return d.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-zinc-300 dark:text-zinc-700 mb-2 flex justify-center",children:e.jsx(k,{size:32})}),e.jsx("p",{className:"text-zinc-400 text-sm italic",children:"No requests in this category."})]}):e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:d.map(s=>e.jsxs("div",{className:"p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/20 transition-colors flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100",children:s.classTitle}),e.jsx("span",{className:"text-[10px] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5 rounded border border-zinc-200 dark:border-zinc-700 font-mono",children:s.classId?.substring(0,8)})]}),e.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex items-center gap-1",children:[e.jsx(k,{size:14}),new Date(s.startTime).toLocaleString([],{dateStyle:"full",timeStyle:"short"})]}),s.message&&e.jsxs("div",{className:"mt-2 text-sm text-zinc-600 dark:text-zinc-300 italic",children:['"',s.message,'"']}),e.jsx("div",{className:"mt-4 flex flex-wrap items-center gap-6 text-[10px] font-bold uppercase tracking-widest",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-zinc-400 mb-1",children:"Original Instructor"}),e.jsx("span",{className:"text-zinc-800 dark:text-zinc-200",children:s.originalInstructorName||"Unknown"})]})})]}),!i&&e.jsx("div",{className:"flex items-center gap-2",children:a&&s.status==="open"&&e.jsx("button",{onClick:()=>o(s.id,"accept"),disabled:x,className:"bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 disabled:opacity-50 transition-all hover:-translate-y-0.5",children:"Accept Shift"})}),s.status==="filled"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-xl border border-green-100 dark:border-green-900/30",children:[e.jsx(S,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Filled"})]})]},s.id))})}export{ee as default};
