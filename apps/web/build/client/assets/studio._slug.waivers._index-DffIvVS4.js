import{r as b,w as N,d as y,c as S,b as C,L as I,F as j}from"./chunk-JMJ3UQ3L-C0Hu5JKs.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";function M({onChange:h,width:p=500,height:v=200}){const c=b.useRef(null),[u,d]=b.useState(!1),[w,l]=b.useState(!1);b.useEffect(()=>{const t=c.current;if(!t)return;const n=t.getContext("2d");n&&(n.lineWidth=2,n.lineCap="round",n.strokeStyle="#000000")},[]);const m=t=>{if(!u)return;const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect();let o,i;"touches"in t?(o=t.touches[0].clientX-s.left,i=t.touches[0].clientY-s.top):(o=t.clientX-s.left,i=t.clientY-s.top),r.lineTo(o,i),r.stroke(),r.beginPath(),r.moveTo(o,i)},f=t=>{d(!0);const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect(),o=t.clientX-s.left,i=t.clientY-s.top;r.beginPath(),r.moveTo(o,i)},g=t=>{t.preventDefault();const n=c.current;if(!n)return;const r=n.getContext("2d");r&&(r.clearRect(0,0,n.width,n.height),l(!1),h(null))};return e.jsxs("div",{className:"border border-zinc-300 rounded-lg overflow-hidden bg-white inline-block",children:[e.jsx("canvas",{ref:c,width:p,height:v,className:"touch-none cursor-crosshair bg-white",style:{touchAction:"none"},onMouseDown:f,onMouseMove:t=>{u&&m(t)},onMouseUp:()=>{d(!1);const t=c.current;t&&(t.getContext("2d")?.beginPath(),h(t.toDataURL()),l(!0))},onMouseLeave:()=>{d(!1);const t=c.current;t&&u&&(t.getContext("2d")?.beginPath(),h(t.toDataURL()),l(!0))},onTouchStart:t=>{const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect(),o=t.touches[0].clientX-s.left,i=t.touches[0].clientY-s.top;r.beginPath(),r.moveTo(o,i),d(!0)},onTouchMove:t=>{u&&m(t)},onTouchEnd:()=>{d(!1);const t=c.current;t&&(t.getContext("2d")?.beginPath(),h(t.toDataURL()),l(!0))}}),e.jsxs("div",{className:"bg-zinc-50 border-t border-zinc-200 p-2 flex justify-between items-center px-4",children:[e.jsx("span",{className:"text-xs text-zinc-500",children:"Sign above"}),e.jsx("button",{type:"button",onClick:g,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear Signature"})]})]})}const R=N(function(){const{data:p,error:v}=y(),{me:c,roles:u}=S(),d=u.includes("owner"),l=C().state==="submitting",[m,f]=b.useState(null);if(v)return e.jsxs("div",{className:"p-8 text-red-600",children:["Error: ",v]});if(d){const a=p?.templates||[];return e.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Waivers & Forms"}),e.jsx(I,{to:"new",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium flex items-center gap-2",children:"+ Create Waiver"})]}),e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-700",children:[e.jsx("p",{className:"mb-2 font-medium",children:"No waiver templates yet"}),e.jsx("p",{className:"text-sm",children:"Create a liability waiver for your members to sign."})]}):a.map(x=>e.jsxs("div",{className:"p-6 rounded-lg shadow-sm bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100",children:x.title}),e.jsxs(j,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"toggle_active"}),e.jsx("input",{type:"hidden",name:"templateId",value:x.id}),e.jsx("input",{type:"hidden",name:"active",value:(!x.active).toString()}),e.jsx("button",{type:"submit",className:`text-xs px-2 py-1 rounded border font-medium transition-colors ${x.active?"bg-green-100 text-green-800 border-green-200 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800":"bg-zinc-100 text-zinc-800 border-zinc-200 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}`,children:x.active?"Active":"Inactive"})]})]}),e.jsx("div",{className:"text-sm line-clamp-3 mb-1 whitespace-pre-wrap text-zinc-600 dark:text-zinc-400 font-mono bg-zinc-50 dark:bg-zinc-950 p-3 rounded border border-zinc-100 dark:border-zinc-800/50",children:x.content})]},x.id))})]})}const{waiver:g,required:t,signed:n,signatureDate:r,family:s,signedMemberIds:o}=p||{},[i,k]=b.useState(null);if(!t||!g)return e.jsxs("div",{className:"max-w-md mx-auto py-12 px-4 text-center",children:[e.jsx("div",{className:"mb-4 inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),e.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:"Good to go!"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"You have no pending waivers to sign."})]});const z=o?.includes(i||c?.id);return e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-zinc-900 dark:text-zinc-100",children:g.title}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm mb-6 max-h-[60vh] overflow-y-auto",children:e.jsx("div",{className:"prose dark:prose-invert text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap font-serif text-sm leading-relaxed",children:g.content})}),s&&s.length>0&&e.jsxs("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",children:"Who are you signing for?"}),e.jsxs("select",{className:"w-full bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-md text-sm px-3 py-2",value:i||"",onChange:a=>k(a.target.value||null),children:[e.jsxs("option",{value:"",children:["Myself ",n?"✅":""]}),s.map(a=>e.jsxs("option",{value:a.memberId,children:[a.firstName," ",a.lastName," ",o?.includes(a.memberId)?"✅":""]},a.memberId))]})]}),z?e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900/50 text-green-800 dark:text-green-300 p-6 rounded-lg flex flex-col items-center justify-center gap-2 text-center",children:[e.jsx("div",{className:"text-2xl",children:"✅"}),e.jsx("div",{className:"font-bold",children:"Waiver Signed"}),e.jsx("div",{className:"text-sm opacity-80",children:"This member has successfully signed the waiver."})]}):e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6",children:[e.jsx("h3",{className:"font-bold mb-4 text-zinc-900 dark:text-white",children:"Sign Waiver"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Please draw your signature below to accept this agreement."}),e.jsx("div",{className:"mb-6 bg-white dark:bg-zinc-950 rounded border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:e.jsx(M,{onChange:a=>f(a),width:600,height:200})}),m&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mb-4 flex items-center gap-1 font-medium",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Signature captured"]}),e.jsxs(j,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"sign"}),e.jsx("input",{type:"hidden",name:"templateId",value:g.id}),e.jsx("input",{type:"hidden",name:"signatureData",value:m||""}),e.jsx("input",{type:"hidden",name:"onBehalfOfMemberId",value:i||""}),e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx("input",{type:"checkbox",required:!0,id:"agree",className:"mt-1 w-4 h-4 rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"agree",className:"text-sm text-zinc-700 dark:text-zinc-300 leading-snug",children:"I have read and agree to the terms of this waiver. By drawing my signature above and checking this box, I electronically sign this document."})]}),e.jsx("button",{type:"submit",disabled:!m||l,className:"w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?"Signing...":"Sign Waiver"})]})]})]})});export{R as default};
