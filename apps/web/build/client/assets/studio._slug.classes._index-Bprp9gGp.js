import{w as N,d as B,c as w,f as S,r as d}from"./chunk-JMJ3UQ3L-Bs7kYf96.js";import{j as t}from"./jsx-runtime-u17CrQMm.js";import{C as I,B as P}from"./BookingModal-67zo5b4-.js";import{P as E}from"./plus-CnaK_SoT.js";import"./Modal-BEfQweA8.js";import"./api-piI5qlNr.js";import"./chunk-OT5FTIRN-ClSlXyLM.js";import"./index-DAF9lcff.js";import"./index-jEyUU0gN.js";import"./x-B4DPw67G.js";import"./createLucideIcon-DGNyYaKe.js";import"./user-TA5uRt0g.js";import"./users-Snhe9X3-.js";import"./dialog-C0Hce_VK.js";import"./portal-CG77HVWe.js";import"./with-selector-sbhfzBJl.js";import"./index-Cvdwf3FR.js";const Q=N(function(){const{classes:h,family:a,error:c,locations:g,instructors:f}=B(),{member:l,roles:u,tenant:k}=w()||{},n=S(),[m,j]=d.useState(h),[x,s]=d.useState(null),[z,p]=d.useState(!1),y=u?.includes("owner")||u?.includes("instructor"),v=i=>{(a.length>0||i.zoomEnabled)&&s(i)},C=i=>{j([...m,i])},b=m.reduce((i,o)=>{const e=new Date(o.startTime).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"});return i[e]||(i[e]=[]),i[e].push(o),i},{});return t.jsxs("div",{children:[t.jsx(I,{isOpen:z,onClose:()=>p(!1),onSuccess:C,tenantId:k?.id,locations:g,instructors:f}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Class Schedule"}),t.jsxs("div",{className:"flex items-center gap-2",children:[y&&t.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md hover:opacity-90 transition-opacity font-medium text-sm",children:[t.jsx(E,{size:16}),"Create Class"]}),!l&&t.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Sign in to book classes."})]})]}),c&&t.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded mb-4 text-sm",children:["Failed to load schedule: ",c]}),t.jsx(P,{isOpen:!!x,onClose:()=>s(null),classEvent:x,family:a}),t.jsx("div",{className:"space-y-8",children:Object.keys(b).length===0?t.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg",children:"No upcoming classes scheduled."}):Object.entries(b).map(([i,o])=>t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-3 sticky top-0 bg-zinc-50/95 dark:bg-zinc-950/95 py-2 backdrop-blur",children:i}),t.jsx("div",{className:"space-y-3",children:o.map(e=>t.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm hover:border-zinc-300 dark:hover:border-zinc-700 transition-colors flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:e.title}),t.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex flex-wrap gap-x-3",children:[t.jsxs("span",{children:[new Date(e.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," â€¢ ",e.durationMinutes," min"]}),e.instructor?.user?.profile&&t.jsxs("span",{children:["with ",e.instructor.user.profile.firstName]}),e.capacity&&t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[t.jsxs("span",{className:`px-1.5 py-0.5 rounded ${(e.inPersonCount||0)>=e.capacity?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400"}`,children:["In-Person: ",e.inPersonCount||0," / ",e.capacity]}),e.zoomEnabled&&t.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800",children:["Virtual: ",e.virtualCount||0]})]})]})]}),t.jsx("div",{children:l?t.jsx(t.Fragment,{children:a.length>0?t.jsx("button",{onClick:()=>v(e),disabled:e.userBookingStatus==="confirmed",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${e.userBookingStatus==="confirmed"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:e.userBookingStatus==="confirmed"?"Booked":!e.zoomEnabled&&(e.inPersonCount||0)>=(e.capacity||1/0)?"Join Waitlist":"Book"}):t.jsx("div",{className:"flex flex-col gap-2 items-end",children:e.userBookingStatus==="confirmed"?t.jsxs("div",{className:"flex items-center gap-2",children:[e.zoomEnabled&&e.userBooking?t.jsxs(n.Form,{method:"post",children:[t.jsx("input",{type:"hidden",name:"intent",value:"switch_attendance"}),t.jsx("input",{type:"hidden",name:"classId",value:e.id}),t.jsx("input",{type:"hidden",name:"bookingId",value:e.userBooking.id}),t.jsx("input",{type:"hidden",name:"attendanceType",value:e.userBooking.attendanceType==="zoom"?"in_person":"zoom"}),t.jsxs("button",{type:"submit",title:"Switch Attendance Type",disabled:n.state!=="idle",className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:["Switch to ",e.userBooking.attendanceType==="zoom"?"In-Person":"Zoom"]})]}):null,t.jsxs(n.Form,{method:"post",onSubmit:r=>{confirm("Are you sure you want to cancel this booking?")||r.preventDefault()},children:[t.jsx("input",{type:"hidden",name:"intent",value:"cancel_booking"}),t.jsx("input",{type:"hidden",name:"classId",value:e.id}),t.jsx("input",{type:"hidden",name:"bookingId",value:e.userBooking.id}),t.jsx("button",{type:"submit",disabled:n.state!=="idle",className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"Cancel"})]}),t.jsxs("span",{className:"px-4 py-2 text-sm font-medium rounded bg-zinc-100 text-zinc-500 cursor-default",children:["Booked ",e.userBooking?.attendanceType==="zoom"?"(Virtual)":"(In-Person)"]})]}):t.jsxs(n.Form,{method:"post",children:[t.jsx("input",{type:"hidden",name:"intent",value:(e.confirmedCount||0)>=(e.capacity||1/0)?"waitlist":"book"}),t.jsx("input",{type:"hidden",name:"classId",value:e.id}),t.jsx("button",{type:"submit",onClick:r=>{e.zoomEnabled&&(r.preventDefault(),s(e))},disabled:n.state!=="idle"&&n.formData?.get("classId")===e.id||e.userBookingStatus==="confirmed"||e.userBookingStatus==="waitlisted",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${e.userBookingStatus==="confirmed"||e.userBookingStatus==="waitlisted"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:n.state!=="idle"&&n.formData?.get("classId")===e.id?"Processing...":e.userBookingStatus==="confirmed"?"Booked":e.userBookingStatus==="waitlisted"?"On Waitlist":!e.zoomEnabled&&(e.inPersonCount||0)>=(e.capacity||1/0)?"Join Waitlist":"Book"})]})})}):t.jsx("a",{href:"/sign-in",className:"px-4 py-2 border border-zinc-300 text-zinc-700 text-sm font-medium rounded hover:bg-zinc-50",children:"Login to Book"})})]},e.id))})]},i))})]})});export{Q as default};
