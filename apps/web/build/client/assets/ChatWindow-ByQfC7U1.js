import{a as o,j as t,aP as w}from"./vendor-react-D59Q0YKK.js";function v({roomId:u,token:m,currentUser:y,wsUrl:x,onClose:p}){const[h,j]=o.useState(null),[i,a]=o.useState([]),[c,b]=o.useState(""),[l,f]=o.useState("connecting"),r=o.useRef(null);o.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[i]),o.useEffect(()=>{const e=new URL(x);e.protocol=e.protocol==="https:"?"wss:":"ws:",e.pathname=`/chat/rooms/${u}/websocket`,e.searchParams.set("token",m),console.log("Connecting to WS:",e.toString());const s=new WebSocket(e.toString());return s.onopen=()=>{f("connected")},s.onmessage=g=>{try{const n=JSON.parse(g.data);n.type==="history"?a(n.messages):n.type==="message"?a(d=>[...d,n]):n.type==="user_joined"&&a(d=>[...d,{id:"sys-"+Date.now(),userId:"system",userName:"System",content:`${n.userName} joined the room.`,timestamp:n.timestamp,type:"system"}])}catch(n){console.error("WS Parse Error",n)}},s.onclose=()=>{f("disconnected")},j(s),()=>{s.close()}},[u,x,m]);const N=e=>{if(e?.preventDefault(),!c.trim()||!h)return;const s={type:"message",content:c};h.send(JSON.stringify(s)),b("")};return t.jsxs("div",{className:"flex flex-col h-[500px] w-full max-w-md bg-white border border-zinc-200 rounded-xl shadow-xl overflow-hidden",children:[t.jsxs("div",{className:"bg-zinc-50 border-b border-zinc-200 p-3 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${l==="connected"?"bg-green-500":"bg-red-500"}`}),t.jsx("span",{className:"font-medium text-sm text-zinc-700",children:"Chat Room"})]}),p&&t.jsx("button",{onClick:p,className:"text-zinc-400 hover:text-zinc-600",children:"Ã—"})]}),t.jsxs("div",{ref:r,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-white",children:[i.length===0&&t.jsx("div",{className:"text-center text-zinc-400 text-sm mt-10",children:"No messages yet."}),i.map(e=>{const s=e.userId===y.id;return e.type==="system"?t.jsx("div",{className:"flex justify-center",children:t.jsx("span",{className:"text-xs bg-zinc-100 text-zinc-500 px-2 py-1 rounded-full",children:e.content})},e.id):t.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${s?"bg-blue-600 text-white rounded-br-none":"bg-zinc-100 text-zinc-800 rounded-bl-none"}`,children:[!s&&t.jsx("div",{className:"text-[10px] opacity-50 font-bold mb-1",children:e.userName}),t.jsx("div",{children:e.content}),t.jsx("div",{className:`text-[10px] mt-1 text-right ${s?"text-blue-100":"text-zinc-400"}`,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)})]}),t.jsxs("form",{onSubmit:N,className:"p-3 border-t border-zinc-200 bg-zinc-50 flex gap-2",children:[t.jsx("input",{className:"flex-1 border border-zinc-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Type a message...",value:c,onChange:e=>b(e.target.value),disabled:l!=="connected"}),t.jsx("button",{type:"submit",disabled:l!=="connected"||!c.trim(),className:"bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(w,{size:18})})]})]})}export{v as C};
