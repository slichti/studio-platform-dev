import{r as l,w as B,c as O}from"./chunk-JMJ3UQ3L-CSq87dux.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{c as T}from"./createLucideIcon-pjmwgCcP.js";import{D as N}from"./dollar-sign-Bbq0eeiH.js";import{T as I}from"./trending-up-D2-y-JaS.js";import{R as w,A as C,X as S,Y as D,C as P,T as M,a as z,b as K}from"./AreaChart-DlCk16xs.js";import{a as $}from"./api-piI5qlNr.js";import{P as y}from"./PrivacyBlur-DCeFAFUq.js";import{L as _}from"./loader-circle-BhPma_HC.js";import{U as G}from"./users-Dm4m26s8.js";import{C as W}from"./circle-check-Cg7ijh9D.js";import"./index-DNgzYwhr.js";import"./with-selector-py2TlJsm.js";import"./with-selector-DGdwx0ry.js";import"./index-Cf5kZV7D.js";const U=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],Y=T("calculator",U);function V(){const[t,o]=l.useState({studentCount:50,avgMembershipPrice:120,avgDropInPrice:25,membershipSplit:60,classesPerDropIn:4,rent:2e3,payrollPerClass:40,classesPerMonth:60,otherExpenses:500}),s=l.useMemo(()=>{const a=Math.round(t.studentCount*(t.membershipSplit/100)),r=t.studentCount-a,m=a*t.avgMembershipPrice,n=r*t.classesPerDropIn*t.avgDropInPrice,x=m+n,h=t.classesPerMonth*t.payrollPerClass,f=t.rent+h+t.otherExpenses,b=x-f,g=x>0?b/x*100:0;return{totalRevenue:x,totalExpenses:f,profit:b,margin:g,breakdown:{membershipRevenue:m,dropInRevenue:n}}},[t]),c=l.useMemo(()=>{const a=[],r=Math.max(t.studentCount*2,100),m=Math.ceil(r/20);for(let n=0;n<=r;n+=m){const x=Math.round(n*(t.membershipSplit/100)),h=n-x,f=x*t.avgMembershipPrice+h*t.classesPerDropIn*t.avgDropInPrice,b=t.classesPerMonth*t.payrollPerClass,g=t.rent+b+t.otherExpenses;a.push({students:n,revenue:f,expenses:g,profit:f-g})}return a},[t]),d=(a,r)=>{const m=parseFloat(r)||0;o(n=>({...n,[a]:m}))};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-fit",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-zinc-900 dark:text-zinc-100 font-bold text-lg",children:[e.jsx(Y,{className:"text-blue-600"}),e.jsx("h3",{children:"Simulator Inputs"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Students & Pricing"}),e.jsx(u,{label:"Total Active Students",value:t.studentCount,onChange:a=>d("studentCount",a)}),e.jsx(u,{label:"Avg. Membership Price ($)",value:t.avgMembershipPrice,onChange:a=>d("avgMembershipPrice",a)}),e.jsx(u,{label:"Avg. Class Drop-In Price ($)",value:t.avgDropInPrice,onChange:a=>d("avgDropInPrice",a)}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 flex justify-between",children:[e.jsx("span",{children:"Membership vs Drop-In Split"}),e.jsxs("span",{className:"text-zinc-500",children:[t.membershipSplit,"% Members"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.membershipSplit,onChange:a=>d("membershipSplit",a.target.value),className:"w-full"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-800 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Expenses (Monthly)"}),e.jsx(u,{label:"Rent & Utilities",value:t.rent,onChange:a=>d("rent",a)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Instructor Pay / Class",value:t.payrollPerClass,onChange:a=>d("payrollPerClass",a)}),e.jsx(u,{label:"Classes / Month",value:t.classesPerMonth,onChange:a=>d("classesPerMonth",a)})]}),e.jsx(u,{label:"Other Expenses",value:t.otherExpenses,onChange:a=>d("otherExpenses",a)})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1",children:"Projected Revenue"}),e.jsxs("div",{className:"text-3xl font-black text-zinc-900 dark:text-zinc-100",children:["$",s.totalRevenue.toLocaleString(void 0,{maximumFractionDigits:0}),e.jsx("span",{className:"text-sm font-normal text-zinc-400",children:"/mo"})]}),e.jsxs("div",{className:"text-xs text-zinc-500 mt-2 flex gap-2",children:[e.jsxs("span",{className:"text-blue-600",children:["$",s.breakdown.membershipRevenue.toLocaleString()," Members"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"text-purple-600",children:["$",s.breakdown.dropInRevenue.toLocaleString()," Drop-ins"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1",children:"Estimated Expenses"}),e.jsxs("div",{className:"text-3xl font-black text-red-600 dark:text-red-400",children:["$",s.totalExpenses.toLocaleString(void 0,{maximumFractionDigits:0}),e.jsx("span",{className:"text-sm font-normal text-zinc-400",children:"/mo"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"Rent, Payroll, Ops"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 right-0 p-4 opacity-10 ${s.profit>=0?"text-green-500":"text-red-500"}`,children:e.jsx(N,{size:64})}),e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1",children:"Net Profit"}),e.jsxs("div",{className:`text-3xl font-black ${s.profit>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.profit>=0?"+":"","$",s.profit.toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-2",children:[s.margin.toFixed(1),"% Margin"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm h-[400px]",children:[e.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(I,{size:18,className:"text-zinc-400"}),"Profitability Curve"]}),e.jsx(w,{width:"100%",height:"100%",minHeight:300,children:e.jsxs(C,{data:c,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorProfit",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})]}),e.jsx(S,{dataKey:"students",tickLine:!1,axisLine:!1,tick:{fontSize:12,fill:"#71717A"},label:{value:"Number of Students",position:"insideBottomRight",offset:-10,fontSize:12,fill:"#71717A"}}),e.jsx(D,{tickLine:!1,axisLine:!1,tick:{fontSize:12,fill:"#71717A"},tickFormatter:a=>`$${a/1e3}k`}),e.jsx(P,{vertical:!1,strokeDasharray:"3 3",stroke:"#E4E4E7"}),e.jsx(M,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},formatter:a=>[`$${Number(a).toLocaleString()}`,""]}),e.jsx(z,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"#3B82F6",fillOpacity:1,fill:"url(#colorRevenue)",strokeWidth:2}),e.jsx(z,{type:"monotone",dataKey:"expenses",name:"Expenses",stroke:"#EF4444",fill:"none",strokeWidth:2,strokeDasharray:"5 5"}),e.jsx(z,{type:"monotone",dataKey:"profit",name:"Net Profit",stroke:"#10B981",fillOpacity:1,fill:"url(#colorProfit)",strokeWidth:2}),e.jsx(K,{x:t.studentCount,stroke:"#F59E0B",strokeDasharray:"3 3",label:{position:"top",value:"Current",fill:"#F59E0B",fontSize:12}})]})})]})]})]})}function u({label:t,value:o,onChange:s}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:t}),e.jsx("input",{type:"number",value:o,onChange:c=>s(c.target.value),className:"w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"})]})}function X(t=!1){const[o,s]=l.useState(!1);return l.useEffect(()=>{if(typeof window<"u"){const c=localStorage.getItem("admin_show_financials")==="true";s(!c)}},[]),{isPrivacyMode:o}}const de=B(function(){const{tenant:o}=O(),[s,c]=l.useState("financials"),[d,a]=l.useState(!0),[r,m]=l.useState(null),[n,x]=l.useState(null),[h,f]=l.useState("30d"),[b,g]=l.useState(!1);l.useEffect(()=>{g(!!localStorage.getItem("impersonation_token"))},[]);const{isPrivacyMode:L}=X(),j=b&&L;l.useEffect(()=>{A()},[s,h]);const A=async()=>{a(!0);const i=new Date,p=new Date;h==="30d"&&p.setDate(i.getDate()-30),h==="90d"&&p.setDate(i.getDate()-90),h==="1y"&&p.setFullYear(i.getFullYear()-1);const F=await window.Clerk?.session?.getToken();try{if(s==="financials"){const v=await $(`/reports/revenue?startDate=${p.toISOString()}&endDate=${i.toISOString()}`,F);m(v)}else{const v=await $(`/reports/attendance?startDate=${p.toISOString()}&endDate=${i.toISOString()}`,F);x(v)}}catch(v){console.error("Failed to fetch report data",v)}finally{a(!1)}};return d&&!r&&!n?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx(_,{className:"animate-spin text-zinc-400"})}):e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Analytics"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Performance metrics and insights."})]}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>c("financials"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="financials"?"bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,children:"Financials"}),e.jsx("button",{onClick:()=>c("attendance"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="attendance"?"bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,children:"Attendance"}),e.jsx("button",{onClick:()=>c("projections"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="projections"?"bg-white dark:bg-zinc-700 shadow text-zinc-900 dark:text-zinc-100":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700"}`,children:"Projections"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[s==="financials"&&r&&e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Gross Volume (Period)",value:e.jsx(y,{revealed:!j,placeholder:"***",children:`$${(r.grossVolume/100).toFixed(2)}`}),icon:e.jsx(N,{size:20,className:"text-green-500"})}),e.jsx(k,{title:"Monthly Recurring Revenue",value:e.jsx(y,{revealed:!j,placeholder:"***",children:`$${(r.mrr/100).toFixed(2)}`}),subtext:"Active subscriptions snapshot",icon:e.jsx(I,{size:20,className:"text-blue-500"})}),e.jsx(k,{title:"Sales Breakdown",value:e.jsx(y,{revealed:!j,placeholder:"***",children:`${(r.breakdown.retail/(r.grossVolume||1)*100).toFixed(0)}% Retail`}),subtext:`$${(r.breakdown.packs/100).toFixed(0)} Packs`,icon:e.jsx(N,{size:20,className:"text-purple-500"})})]}),s==="attendance"&&n&&e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Total Bookings",value:n.totalBookings,icon:e.jsx(G,{size:20,className:"text-blue-500"})}),e.jsx(k,{title:"Check-in Rate",value:`${(n.totalCheckins/(n.totalBookings||1)*100).toFixed(0)}%`,subtext:`${n.totalCheckins} Checked-in`,icon:e.jsx(W,{size:20,className:"text-green-500"})})]})]}),s==="projections"?e.jsx(V,{}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm relative",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:s==="financials"?"Revenue Trends":"Attendance Trends"}),j&&s==="financials"&&e.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-md bg-white/30 dark:bg-black/30 flex items-center justify-center rounded-xl",children:e.jsx("div",{className:"bg-white dark:bg-zinc-800 px-4 py-2 rounded-lg shadow lg text-sm font-medium",children:"Privacy Mode Enabled"})}),e.jsxs("div",{className:"h-80 w-full flex items-center justify-center text-zinc-400 text-sm",children:[s==="financials"&&r?.chartData?E(r.chartData)?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"No revenue data for this period"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Record sales in POS to see trends"})]}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(C,{data:r.chartData,children:[e.jsx(P,{strokeDasharray:"3 3",vertical:!1,stroke:"#E4E4E7"}),e.jsx(S,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12},dy:10,tickFormatter:i=>R(i)}),e.jsx(D,{axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12}}),e.jsx(M,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:i=>[`$${Number(i).toFixed(2)}`,"Revenue"],labelFormatter:i=>new Date(i).toLocaleDateString()}),e.jsx(z,{type:"monotone",dataKey:"value",stroke:"#3B82F6",fill:"#EFF6FF",strokeWidth:2})]})}):null,s==="attendance"&&n?.chartData?E(n.chartData)?e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"mb-2",children:"No attendance data for this period"})}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(C,{data:n.chartData,children:[e.jsx(P,{strokeDasharray:"3 3",vertical:!1,stroke:"#E4E4E7"}),e.jsx(S,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12},dy:10,tickFormatter:i=>R(i)}),e.jsx(D,{axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12}}),e.jsx(M,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:i=>[i,"Attendees"],labelFormatter:i=>new Date(i).toLocaleDateString()}),e.jsx(z,{type:"monotone",dataKey:"value",stroke:"#10B981",fill:"#ECFDF5",strokeWidth:2})]})}):null]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm relative",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:s==="financials"?"Top Selling":"Top Classes"}),j&&s==="financials"&&e.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-md bg-white/30 dark:bg-black/30 flex items-center justify-center rounded-xl"}),s==="attendance"&&n?.topClasses&&e.jsxs("div",{className:"space-y-4",children:[n.topClasses.map((i,p)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium truncate max-w-[180px]",children:i.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-zinc-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500",style:{width:`${Math.min(i.attendees/50*100,100)}%`}})}),e.jsx("span",{className:"text-xs text-zinc-500 w-6 text-right",children:i.attendees})]})]},p)),n.topClasses.length===0&&e.jsx("div",{className:"text-center text-sm text-zinc-500 py-8",children:"No data available"})]}),s==="financials"&&e.jsx("div",{className:"text-sm text-zinc-500 italic text-center py-10",children:"Sales breakdown coming soon."})]})]})]})});function k({title:t,value:o,subtext:s,icon:c}){return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-2 bg-zinc-50 dark:bg-zinc-800 rounded-lg",children:c})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium mb-1",children:t}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:o}),s&&e.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:s})]})]})}function E(t){return!t||t.length===0?!0:t.every(o=>o.value===0)}function R(t){const o=new Date(t);return`${o.getMonth()+1}/${o.getDate()}`}export{de as default};
