import{w as F,d as L,r as n}from"./chunk-JMJ3UQ3L-Dzyq37y6.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as u}from"./api-piI5qlNr.js";import{M as O}from"./Modal-Ccs7c619.js";import{M as q}from"./mail-Ci_j9QIs.js";import{c as p}from"./createLucideIcon-CNXPjsb6.js";import{P as B}from"./pencil-BBZH-oKk.js";const X=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],k=p("send",X);const J=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],R=p("sparkles",J);const V=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],W=p("zap",V),ee=F(function(){const{campaigns:M,automations:C,token:o,slug:d}=L(),[r,g]=n.useState("broadcast"),[h,A]=n.useState(M),[f,j]=n.useState(""),[N,v]=n.useState(""),[y,z]=n.useState(!1),[a,b]=n.useState({ageMin:0,ageMax:100,preset:"all"}),[w,E]=n.useState(C||[]),[l,m]=n.useState(null),[i,x]=n.useState({subject:"",content:"",isEnabled:!1}),[T,$]=n.useState("");async function _(t){t.preventDefault(),z(!0);try{const s=await u("/marketing",o,{method:"POST",headers:{"X-Tenant-Slug":d},body:JSON.stringify({subject:f,content:N,filters:a.preset==="all"?{}:{ageMin:a.ageMin,ageMax:a.ageMax}})});if(s.error)alert(s.error);else{alert(`Campaign Sent to ${s.count} recipients!`),j(""),v("");const c=await u("/marketing",o,{headers:{"X-Tenant-Slug":d}});A(c.campaigns||[])}}catch(s){alert("Failed to send: "+s.message)}finally{z(!1)}}async function P(t){if(t.preventDefault(),!!l)try{const s=await u(`/marketing/automations/${l.id}`,o,{method:"PATCH",headers:{"X-Tenant-Slug":d},body:JSON.stringify(i)});E(w.map(c=>c.id===l.id?s:c)),m(null)}catch(s){alert("Failed to update: "+s.message)}}async function D(t){const s=prompt("Enter email to send test to:",T);if(s){$(s);try{await u(`/marketing/automations/${t}/test`,o,{method:"POST",headers:{"X-Tenant-Slug":d},body:JSON.stringify({email:s})}),alert("Test email sent!")}catch(c){alert("Failed to test: "+c.message)}}}const S={new_student:"New Student Welcome",birthday:"Birthday Greeting",absent_30_days:"Win-back (Absent 30+ Days)"};return e.jsxs("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900",children:"Marketing"}),e.jsx("p",{className:"text-zinc-500",children:"Engage your students with broadcasts and automations."})]}),e.jsxs("div",{className:"flex gap-4 mb-6 border-b border-zinc-200",children:[e.jsxs("button",{onClick:()=>g("broadcast"),className:`pb-3 px-1 font-medium text-sm transition-colors relative ${r==="broadcast"?"text-blue-600":"text-zinc-500 hover:text-zinc-700"}`,children:["Broadcasts",r==="broadcast"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"})]}),e.jsxs("button",{onClick:()=>g("automation"),className:`pb-3 px-1 font-medium text-sm transition-colors relative ${r==="automation"?"text-blue-600":"text-zinc-500 hover:text-zinc-700"}`,children:["Automations",r==="automation"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"})]})]}),r==="broadcast"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 shadow-sm",children:[e.jsxs("h2",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600"}),"New Broadcast"]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:f,onChange:t=>j(t.target.value),className:"w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. November Newsletter",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Message Content"}),e.jsx("textarea",{value:N,onChange:t=>v(t.target.value),className:"w-full border border-zinc-300 rounded-lg px-3 py-2 h-48 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Write your message...",required:!0}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("p",{className:"text-xs text-zinc-400",children:"Plain text only for MVP."}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Variables: ",e.jsx("span",{className:"font-mono bg-zinc-100 px-1 rounded",children:"{{firstName}}"})," ",e.jsx("span",{className:"font-mono bg-zinc-100 px-1 rounded",children:"{{studioName}}"})]})]})]}),e.jsxs("div",{className:"bg-zinc-50 border border-zinc-200 p-4 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-semibold text-zinc-800 mb-3",children:"Target Audience"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{label:"All Students",value:"all",min:0,max:100},{label:"Youth (<18)",value:"youth",min:0,max:17},{label:"Adults (18-64)",value:"adults",min:18,max:64},{label:"Seniors (65+)",value:"seniors",min:65,max:100},{label:"Custom",value:"custom",min:a.ageMin,max:a.ageMax}].map(t=>e.jsx("button",{type:"button",onClick:()=>b({...a,preset:t.value,ageMin:t.min,ageMax:t.max}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${a.preset===t.value?"bg-blue-600 text-white":"bg-white border border-zinc-300 text-zinc-600 hover:bg-zinc-50"}`,children:t.label},t.value))}),a.preset==="custom"&&e.jsxs("div",{className:"flex items-center gap-4 animate-in fade-in slide-in-from-top-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-zinc-500 mb-1",children:"Min Age"}),e.jsx("input",{type:"number",value:a.ageMin,onChange:t=>b({...a,ageMin:Number(t.target.value)}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-zinc-500 mb-1",children:"Max Age"}),e.jsx("input",{type:"number",value:a.ageMax,onChange:t=>b({...a,ageMax:Number(t.target.value)}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:y,className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:y?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4"}),"Send Broadcast"]})})})]})]})}),e.jsxs("div",{className:"bg-zinc-50 rounded-lg border border-zinc-200 p-6 h-fit",children:[e.jsx("h3",{className:"font-semibold text-zinc-700 mb-4",children:"Recent Campaigns"}),e.jsxs("div",{className:"space-y-4",children:[h.length===0&&e.jsx("p",{className:"text-sm text-zinc-500 italic",children:"No campaigns yet."}),h.map(t=>e.jsxs("div",{className:"bg-white border border-zinc-200 rounded p-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-sm text-zinc-900 line-clamp-1",children:t.subject}),e.jsx("span",{className:`text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${t.status==="sent"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:t.status})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-2",children:new Date(t.sentAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-3 text-xs text-zinc-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),t.stats?.sent||0," Sent"]}),t.filters&&e.jsxs("span",{className:"flex items-center gap-1 bg-zinc-100 px-1.5 rounded",children:[t.filters.ageMin,"-",t.filters.ageMax," yrs"]})]})]},t.id))]})]})]}),r==="automation"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-zinc-200",children:[e.jsxs("h2",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-amber-500"}),"Active Automations"]}),e.jsx("p",{className:"text-sm text-zinc-500 mb-6",children:"These emails are sent automatically based on student activity."}),e.jsx("div",{className:"grid gap-4",children:w.map(t=>e.jsxs("div",{className:"group border border-zinc-200 rounded-lg p-4 flex items-center justify-between hover:border-blue-300 transition-colors bg-white",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${t.isEnabled?"bg-blue-100 text-blue-600":"bg-zinc-100 text-zinc-400"}`,children:e.jsx(R,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:S[t.triggerType]||t.triggerType}),t.isEnabled?e.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold uppercase",children:"Active"}):e.jsx("span",{className:"text-[10px] bg-zinc-100 text-zinc-500 px-1.5 py-0.5 rounded font-bold uppercase",children:"Disabled"})]}),e.jsxs("p",{className:"text-sm text-zinc-500 line-clamp-1 relative top-[-2px]",children:["Subject: ",t.subject]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(t.id),className:"text-xs text-zinc-500 hover:text-zinc-800 px-3 py-1.5 border border-zinc-200 rounded hover:bg-zinc-50",children:"Send Test"}),e.jsxs("button",{onClick:()=>{m(t),x({subject:t.subject,content:t.content,isEnabled:t.isEnabled})},className:"text-xs bg-white text-zinc-700 border border-zinc-300 px-3 py-1.5 rounded hover:bg-zinc-50 flex items-center gap-1.5",children:[e.jsx(B,{className:"h-3 w-3"}),"Edit"]})]})]},t.id))})]})}),e.jsx(O,{isOpen:!!l,onClose:()=>m(null),title:`Edit: ${l?S[l.triggerType]:""}`,children:l&&e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.isEnabled,onChange:t=>x({...i,isEnabled:t.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-zinc-900",children:"Enable this automation"})]}),e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:i.subject,onChange:t=>x({...i,subject:t.target.value}),className:"w-full border border-zinc-300 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Content"}),e.jsx("textarea",{value:i.content,onChange:t=>x({...i,content:t.target.value}),className:"w-full border border-zinc-300 rounded-lg px-3 py-2 h-40 outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 mt-2 text-xs text-zinc-500",children:[e.jsx("span",{children:"Variables:"}),e.jsx("code",{className:"bg-zinc-100 px-1 rounded",children:"{{firstName}}"}),e.jsx("code",{className:"bg-zinc-100 px-1 rounded",children:"{{studioName}}"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>m(null),className:"px-4 py-2 text-sm text-zinc-600 hover:text-zinc-900",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700",children:"Save Changes"})]})]})})]})});export{ee as default};
