import{w as X,u as Z,f as q}from"./chunk-JMJ3UQ3L-DIHTCPR9.js";import{j as e}from"./vendor-puck-EFhZVjRu.js";import{a as n}from"./vendor-sentry-BD1MTpLq.js";import{C as J}from"./ConfirmDialog-DqDjwe4K.js";import{Z as k}from"./zap-CpdSyYPf.js";import{P as Y}from"./plus-BBRn-p3b.js";import{U}from"./users-DTyswlyE.js";import{C as K}from"./calendar-CHyLPk-n.js";import{T as Q}from"./target-DaZesuop.js";import{C as L}from"./clock-CZ6xxKks.js";import{c as R}from"./createLucideIcon-DgXJrNmH.js";import{X as G}from"./x-6mvJS0UK.js";import{T as O}from"./trash-2-DU-4PZMS.js";import{P as D}from"./pencil-DhXDeFua.js";import{P as ee}from"./play-Yex43xXq.js";import"./button-Bn3mr4O5.js";import"./dialog-BbMbq4lO.js";import"./portal-BBJKmgiS.js";import"./vendor-charts-BQhvGvjY.js";const te=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],se=R("bell",te);const ie=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ne=R("pause",ie),W=[{id:"new_member",label:"New Member Signs Up",icon:U},{id:"class_booked",label:"Class Booked",icon:K},{id:"class_missed",label:"Class No-Show",icon:Q},{id:"inactive_days",label:"Inactive for X Days",icon:L},{id:"birthday",label:"Member Birthday",icon:se},{id:"membership_expiring",label:"Membership Expiring",icon:L},{id:"product_purchase",label:"Product Purchased",icon:k},{id:"subscription_canceled",label:"Subscription Canceled (Period End)",icon:G},{id:"subscription_terminated",label:"Subscription Terminated",icon:O},{id:"student_updated",label:"Student Profile Updated",icon:U}],ke=X(function(){const{automations:x,stats:i}=Z(),l=q(),[v,a]=n.useState(!1),[p,d]=n.useState(null),[o,u]=n.useState(null),N=s=>{l({intent:"toggle",id:s},{method:"post"})},y=s=>{d(s)},z=()=>{p&&(l({intent:"delete",id:p},{method:"post"}),d(null))},m=()=>{u(null),a(!0)},h=s=>{u(s),a(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50",children:[e.jsx("header",{className:"bg-white border-b border-zinc-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg text-white",children:e.jsx(k,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-zinc-900",children:"Automations"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Set up automated email & SMS campaigns"})]})]}),e.jsxs("button",{onClick:m,className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",children:[e.jsx(Y,{size:16})," Create Automation"]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[i&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:i.totalAutomations||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Total Automations"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.activeCount||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Active"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.emailsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Emails Sent (30d)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.smsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"SMS Sent (30d)"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-zinc-200",children:[e.jsx(k,{size:48,className:"mx-auto mb-4 text-zinc-300"}),e.jsx("p",{className:"text-zinc-500 mb-4",children:"No automations yet"}),e.jsx("button",{onClick:m,className:"text-sm text-zinc-900 underline",children:"Create your first"})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const r=W.find(g=>g.id===s.triggerEvent||g.id===s.trigger),c=r?.icon||k;return e.jsx("div",{className:`bg-white rounded-xl border ${s.isActive?"border-green-200":"border-zinc-200"} p-5`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${s.isActive?"bg-green-100":"bg-zinc-100"}`,children:e.jsx(c,{size:24,className:s.isActive?"text-green-600":"text-zinc-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-zinc-900",children:s.name||s.subject}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.isActive?"Active":"Paused"})]}),e.jsxs("p",{className:"text-sm text-zinc-500 mt-1",children:["Trigger: ",r?.label||s.triggerEvent]}),s.timingType!=="immediate"&&e.jsxs("p",{className:"text-xs text-zinc-400 mt-1",children:["Timing: ",s.timingType==="delay"?`Delay ${s.timingValue}h`:`Before ${s.timingValue}h`]}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-zinc-400",children:e.jsxs("span",{children:["Runs: ",s.runCount||0]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(s),className:"p-2 hover:bg-zinc-100 rounded-lg text-zinc-500",title:"Edit",children:e.jsx(D,{size:16})}),e.jsx("button",{onClick:()=>N(s.id),className:`p-2 rounded-lg ${s.isActive?"hover:bg-yellow-50 text-yellow-600":"hover:bg-green-50 text-green-600"}`,title:s.isActive?"Pause":"Activate",children:s.isActive?e.jsx(ne,{size:16}):e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>y(s.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-500",children:e.jsx(O,{size:16})})]})]})},s.id)})})]}),v&&e.jsx(re,{initialData:o,onClose:()=>a(!1),onSave:s=>{const r=new FormData;r.append("intent",o?"update":"create"),o&&r.append("id",o.id);for(const c of Object.keys(s))typeof s[c]=="object"?r.append(c,JSON.stringify(s[c])):r.append(c,s[c]);l(r,{method:"post"}),a(!1)}}),e.jsx(J,{open:!!p,onOpenChange:s=>!s&&d(null),onConfirm:z,title:"Delete Automation",description:"Are you sure you want to delete this automation? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})]})}),le=[{id:"immediate",label:"Immediately"},{id:"delay",label:"Delay (Hours)"},{id:"before",label:"Before Event (Hours)"}];function re({onClose:b,onSave:x,initialData:i}){const[l,v]=n.useState(1),[a,p]=n.useState(""),[d,o]=n.useState("new_student"),[u,N]=n.useState("immediate"),[y,z]=n.useState("0"),[m,h]=n.useState("all"),[s,r]=n.useState(""),[c,g]=n.useState(""),[j,_]=n.useState(!1),[C,T]=n.useState("percent"),[E,$]=n.useState("10"),[P,V]=n.useState("7"),[f,w]=n.useState("simple"),[A,M]=n.useState(""),[I,F]=n.useState(""),[S,B]=n.useState("");n.useEffect(()=>{i&&(p(i.name||i.subject||""),o(i.triggerEvent||"new_student"),N(i.timingType||"immediate"),z(String(i.timingValue||0)),i.audienceFilter&&(h("filter"),r(i.audienceFilter.ageMin?String(i.audienceFilter.ageMin):""),g(i.audienceFilter.ageMax?String(i.audienceFilter.ageMax):"")),i.couponConfig&&(_(!0),T(i.couponConfig.type||"percent"),$(String(i.couponConfig.value||10)),V(String(i.couponConfig.validityDays||7))),i.templateId?(w("template"),B(i.templateId),M(i.subject||"")):(w("simple"),M(i.subject||""),F(i.content||"")))},[i]);const H=()=>{const t={name:a,trigger:d,triggerConfig:{},actions:[],isActive:!0,timingType:u,timingValue:parseInt(y)||0};m==="filter"&&(t.audienceFilter={},s&&(t.audienceFilter.ageMin=parseInt(s)),c&&(t.audienceFilter.ageMax=parseInt(c))),j&&(t.couponConfig={type:C,value:parseInt(E),validityDays:parseInt(P)}),f==="template"?(t.templateId=S,t.subject=A||"Notification",t.content="Template: "+S):(t.subject=A,t.content=I),x(t)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:i?"Edit Automation":"Create Automation"}),e.jsx("button",{onClick:b,children:e.jsx(G,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:[1,2,3,4].map(t=>e.jsx("div",{className:`h-1 flex-1 rounded-full ${t<=l?"bg-purple-600":"bg-zinc-100"}`},t))}),l===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Automation Name"}),e.jsx("input",{type:"text",value:a,onChange:t=>p(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"e.g., Welcome Series"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Trigger"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 h-48 overflow-y-auto pr-1",children:W.map(t=>e.jsxs("button",{onClick:()=>o(t.id),className:`p-3 rounded-lg border text-left flex items-center gap-2 ${d===t.id?"border-purple-500 bg-purple-50":"border-zinc-200 hover:bg-zinc-50"}`,children:[e.jsx(t.icon,{size:16,className:d===t.id?"text-purple-600":"text-zinc-400"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Timing"}),e.jsx("div",{className:"flex bg-zinc-100 p-1 rounded-lg mb-2",children:le.map(t=>e.jsx("button",{onClick:()=>N(t.id),className:`flex-1 py-1.5 text-xs font-medium rounded-md ${u===t.id?"bg-white shadow text-zinc-900":"text-zinc-500 hover:text-zinc-700"}`,children:t.label},t.id))}),u!=="immediate"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:y,onChange:t=>z(t.target.value),className:"w-24 px-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"text-sm text-zinc-500",children:"hours"})]})]})]}),l===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Audience Targeting"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:m==="all",onChange:()=>h("all")}),e.jsx("span",{children:"All Members"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:m==="filter",onChange:()=>h("filter")}),e.jsx("span",{children:"Filtered"})]})]}),m==="filter"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Min Age"}),e.jsx("input",{type:"number",value:s,onChange:t=>r(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Max Age"}),e.jsx("input",{type:"number",value:c,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"65"})]})]})]}),l===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Sweeteners"}),e.jsxs("div",{className:"p-4 border border-zinc-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center ${j?"bg-purple-600 border-purple-600":"border-zinc-300"}`,children:j&&e.jsx(ce,{size:12,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Generate Unique Coupon"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Include a single-use code in the email."})]})]}),e.jsx("input",{type:"checkbox",checked:j,onChange:t=>_(t.target.checked),className:"hidden"})]}),j&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-zinc-100 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 flex bg-zinc-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>T("percent"),className:`flex-1 py-1 text-xs font-medium rounded-md ${C==="percent"?"bg-white shadow":"text-zinc-500"}`,children:"Percentage Off"}),e.jsx("button",{onClick:()=>T("amount"),className:`flex-1 py-1 text-xs font-medium rounded-md ${C==="amount"?"bg-white shadow":"text-zinc-500"}`,children:"Flat Amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Value"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:E,onChange:t=>$(t.target.value),className:"w-full pl-8 pr-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"absolute left-3 top-2 text-zinc-400 text-sm",children:C==="percent"?"%":"$"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:P,onChange:t=>V(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg"})]})]})]})]}),l===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Email Content"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:A,onChange:t=>M(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"Welcome!"})]}),e.jsxs("div",{className:"flex gap-4 border-b border-zinc-100 pb-2",children:[e.jsx("button",{onClick:()=>w("simple"),className:`pb-2 text-sm font-medium ${f==="simple"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Simple Text"}),e.jsx("button",{onClick:()=>w("template"),className:`pb-2 text-sm font-medium ${f==="template"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Resend Template"})]}),f==="simple"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Message Body"}),e.jsx("textarea",{value:I,onChange:t=>F(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg h-32",placeholder:"Start typing... Use {{firstName}} for variables."})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Template ID"}),e.jsx("input",{type:"text",value:S,onChange:t=>B(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"re_123456789"}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:["Variables sent: generic data + ",e.jsx("code",{children:"title"}),", ",e.jsx("code",{children:"address"}),", ",e.jsx("code",{children:"firstName"}),", ",e.jsx("code",{children:"couponCode"}),"."]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 flex justify-between",children:[l>1&&e.jsx("button",{onClick:()=>v(l-1),className:"px-4 py-2 text-sm text-zinc-500",children:"Back"}),l<4?e.jsx("button",{onClick:()=>v(l+1),disabled:!a&&l===1,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:"Next"}):e.jsx("button",{onClick:H,disabled:f==="simple"?!I:!S,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:i?"Save Changes":"Create Automation"})]})]})})}function ce({size:b,className:x}){return e.jsx("svg",{width:b||24,height:b||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:x,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}export{ke as default};
