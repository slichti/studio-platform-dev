import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as s}from"./vendor-sentry-DugYw-Ne.js";import{X as K}from"./x-Bbpoc0N5.js";import{M as V}from"./message-circle-BZuCfo3t.js";import{S as A}from"./send-RRFVKZfr.js";function Q({roomId:x,tenantId:w,userId:l,userName:g,apiUrl:j="",enabled:W=!0,chatConfig:m,token:y,brandColor:u="#2563EB"}){const[n,P]=s.useState(!1),[f,v]=s.useState([]),[c,N]=s.useState(""),[d,k]=s.useState(!1),[D,p]=s.useState([]),o=s.useRef(null),z=s.useRef(null),C=s.useRef(n);s.useEffect(()=>{C.current=n},[n]);const[U]=s.useState(()=>`guest_${Math.random().toString(36).substr(2,9)}`),S=l||U,M=g||"Guest",I=s.useCallback(()=>{z.current?.scrollIntoView({behavior:"smooth"})},[]);s.useEffect(()=>{I()},[f,I]),s.useEffect(()=>{if(d)return;const t=j||(typeof window<"u"?window.location.origin:""),h=t.startsWith("https")?"wss://":"ws://",H=t.replace(/^http(s)?:\/\//,"");let O=`${h}${H}/api/chat/rooms/${x}/websocket?roomId=${x}&tenantId=${w}&userId=${S}&userName=${encodeURIComponent(M)}`;y&&(O+=`&token=${y}`);const i=new WebSocket(O);return o.current=i,i.onopen=()=>{k(!0),console.log("[Chat] Connected")},i.onmessage=b=>{try{const r=JSON.parse(b.data);switch(r.type){case"history":v(r.messages||[]);break;case"message":v(a=>[...a,r]),!C.current&&r.userId!==S&&R(a=>a+1);break;case"user_list":p(r.users||[]);break;case"user_joined":p(a=>[...a,{userId:r.userId,userName:r.userName}]);break;case"user_left":p(a=>a.filter(J=>J.userId!==r.userId));break}}catch(r){console.error("[Chat] Parse error:",r)}},i.onclose=()=>{k(!1),console.log("[Chat] Disconnected")},i.onerror=b=>{console.error("[Chat] Error:",b)},()=>{i.close(),o.current=null}},[x,w,l,g,j]);const E=()=>{!c.trim()||!o.current||o.current.readyState!==WebSocket.OPEN||(o.current.send(JSON.stringify({type:"message",content:c.trim()})),N(""))},_=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),E())},[$,R]=s.useState(0),q=["I have a question","Contact support","Billing inquiry"],B=(t,h)=>{!o.current||o.current.readyState!==WebSocket.OPEN||o.current.send(JSON.stringify({type:"message",content:t,metadata:h?{routedRole:h}:void 0}))};return W?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{P(!n),n||R(0)},style:{backgroundColor:u},className:"fixed bottom-6 right-6 w-14 h-14 text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",children:[n?e.jsx(K,{size:24}):e.jsx(V,{size:24}),$>0&&!n&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white",children:$})]}),n&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans",children:[e.jsxs("div",{style:{backgroundColor:u},className:"text-white px-6 py-6 pb-12 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Chat with us"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:"ðŸ‘‹ Hi, message us with any questions. We're happy to help!"})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex flex-col",children:e.jsxs("div",{className:"mt-auto p-4 space-y-4",children:[f.map(t=>e.jsx("div",{className:`flex ${t.userId===l?"justify-end":"justify-start"}`,children:e.jsx("div",{style:t.userId===l?{backgroundColor:u}:void 0,className:`max-w-[85%] p-3 rounded-2xl text-sm ${t.userId===l?"text-white rounded-br-sm":"bg-gray-100 text-zinc-900 rounded-bl-sm"}`,children:e.jsx("p",{children:t.content})})},t.id)),f.length===0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide",children:"How can we help?"}),(m&&m.length>0?m:q.map(t=>({id:t,label:t,type:"action"}))).map(t=>e.jsx("button",{onClick:()=>B(t.label,t.routeToRole),disabled:!d,className:"w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",children:t.label},t.id||t.label))]}),e.jsx("div",{ref:z})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-100 bg-white",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:c,onChange:t=>N(t.target.value),onKeyPress:_,placeholder:"Write message",className:"w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",disabled:!d}),e.jsx("button",{onClick:E,disabled:!d||!c.trim(),style:{color:c.trim()?u:void 0},className:"absolute right-2 p-2 text-zinc-400 transition-colors disabled:opacity-50",children:e.jsx(A,{size:20})})]}),!d&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-[10px] text-zinc-400",children:"Connecting to support..."})})]})]})]}):null}export{Q as C};
