import{w as E,e as A,r}from"./chunk-JMJ3UQ3L-Dzyq37y6.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{C as f,a as p,b as g,c as b,d as v}from"./Card-IOiQbqBT.js";import{T}from"./terminal-BFqZlmu8.js";import{L as j}from"./loader-circle-BVGmWjCV.js";import{T as I}from"./trash-2-Dsh4Q_ZX.js";import"./createLucideIcon-CNXPjsb6.js";const R=E(function(){const{slug:n}=A(),[o,l]=r.useState([]),[N,y]=r.useState(!0),[a,c]=r.useState(""),[m,k]=r.useState("booking.created, order.completed"),[u,h]=r.useState(!1),d="https://studio-platform-api.slichti.workers.dev";r.useEffect(()=>{x()},[n]);const x=async()=>{try{const s=localStorage.getItem("token"),t=await fetch(`${d}/integrations/webhooks`,{headers:{Authorization:`Bearer ${s}`,"X-Tenant-Slug":n||""}});if(t.ok){const i=await t.json();l(i.endpoints)}}catch(s){console.error("Failed to fetch webhooks",s)}finally{y(!1)}},w=async()=>{if(a){h(!0);try{const s=localStorage.getItem("token");(await fetch(`${d}/integrations/webhooks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Tenant-Slug":n||""},body:JSON.stringify({url:a,events:m.split(",").map(i=>i.trim()),description:"Manual created"})})).ok?(c(""),x()):alert("Failed to create webhook")}catch(s){console.error(s)}finally{h(!1)}}},C=async s=>{if(confirm("Delete this webhook?"))try{const t=localStorage.getItem("token");(await fetch(`${d}/integrations/webhooks/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"X-Tenant-Slug":n||""}})).ok&&l(o.filter(S=>S.id!==s))}catch(t){console.error(t)}};return e.jsxs("div",{className:"space-y-6 max-w-4xl p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Developers & Integrations"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage API keys and Webhooks to connect with external tools like Zapier."})]}),e.jsxs(f,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Outgoing Webhooks"]}),e.jsx(b,{children:"Receive real-time JSON payloads when events happen in your studio."})]}),e.jsxs(v,{className:"space-y-6",children:[N?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(j,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"border rounded-md divide-y",children:[o.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm",children:"No webhooks configured."}),o.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"font-mono text-sm font-medium",children:s.url}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Array.isArray(s.events)?s.events.join(", "):s.events})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("code",{className:"text-[10px] bg-muted px-2 py-1 rounded text-muted-foreground hidden sm:inline-block",children:[s.secret.slice(0,8),"..."]}),e.jsx("button",{className:"p-2 hover:bg-red-50 text-red-600 rounded",onClick:()=>C(s.id),children:e.jsx(I,{className:"h-4 w-4"})})]})]},s.id))]}),e.jsxs("div",{className:"p-4 border rounded-md bg-muted/20 space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add New Endpoint"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Endpoint URL"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"https://hooks.zapier.com/...",value:a,onChange:s=>c(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Events (comma separated)"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:m,onChange:s=>k(s.target.value)}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Available: booking.created, order.completed, student.created"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",onClick:w,disabled:!a||u,children:[u&&e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Webhook"]})})]})]})]}),e.jsxs(f,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Studio API Credentials"}),e.jsx(b,{children:"Use these credentials to authenticate API requests."})]}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Studio ID (Tenant ID)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,value:o[0]?.tenant_id||"Loading...",className:"font-mono bg-muted flex h-10 w-full rounded-md border border-input px-3"}),e.jsx("button",{className:"border rounded px-3 text-sm hover:bg-gray-100 dark:hover:bg-zinc-800",children:"Copy"})]})]})})})]})]})});export{R as default};
