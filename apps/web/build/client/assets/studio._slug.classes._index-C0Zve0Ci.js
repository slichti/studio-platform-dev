import{w as I,d as S,c as B,f as T,r as u}from"./chunk-JMJ3UQ3L-Dzyq37y6.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{C as _}from"./CreateClassModal-Bq21yeqR.js";import{P}from"./plus-ZxFZXXXb.js";import"./Modal-Ccs7c619.js";import"./api-piI5qlNr.js";import"./chunk-OT5FTIRN-DBwNzrXh.js";import"./index-CsedX6-y.js";import"./index-D9_Tf6xB.js";import"./createLucideIcon-CNXPjsb6.js";const Z=I(function(){const{classes:f,family:l,error:m,locations:y,instructors:j}=S(),{member:p,roles:x,tenant:z}=B()||{},i=T(),[b,k]=u.useState(f),[o,r]=u.useState(null),[v,h]=u.useState(!1),N=x?.includes("owner")||x?.includes("instructor"),w=n=>{(l.length>0||n.zoomEnabled)&&r(n)},C=n=>{k([...b,n])},g=b.reduce((n,a)=>{const t=new Date(a.startTime).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"});return n[t]||(n[t]=[]),n[t].push(a),n},{});return e.jsxs("div",{children:[e.jsx(_,{isOpen:v,onClose:()=>h(!1),onSuccess:C,tenantId:z?.id,locations:y,instructors:j}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Class Schedule"}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md hover:opacity-90 transition-opacity font-medium text-sm",children:[e.jsx(P,{size:16}),"Create Class"]}),!p&&e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Sign in to book classes."})]})]}),m&&e.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded mb-4 text-sm",children:["Failed to load schedule: ",m]}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-lg max-w-sm w-full p-6 shadow-xl border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["Book ",o.title]}),o.zoomEnabled&&e.jsxs("div",{className:"mb-4 bg-zinc-50 p-3 rounded text-sm",children:[e.jsx("p",{className:"font-semibold text-zinc-700 mb-2",children:"Attendance Preference"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType_global",defaultChecked:!0,value:"in_person",className:"text-blue-600 focus:ring-blue-500",onChange:n=>{window._tempAttendanceType=n.target.value}}),e.jsx("span",{children:"In-Person"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType_global",value:"zoom",className:"text-blue-600 focus:ring-blue-500",onChange:n=>{window._tempAttendanceType=n.target.value}}),e.jsx("span",{children:"Virtual (Zoom)"})]})]})]}),e.jsx("p",{className:"text-sm text-zinc-500 mb-4",children:"Who would you like to book for?"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i.Form,{method:"post",onSubmit:n=>{const a=window._tempAttendanceType||"in_person";let t="book";a==="in_person"&&(o.inPersonCount||0)>=(o.capacity||1/0)&&(t="waitlist");const s=document.createElement("input");s.type="hidden",s.name="attendanceType",s.value=a,n.currentTarget.appendChild(s);const d=document.createElement("input");d.type="hidden",d.name="intent",d.value=t,n.currentTarget.appendChild(d),r(null)},children:[e.jsx("input",{type:"hidden",name:"classId",value:o.id}),e.jsxs("button",{type:"submit",className:"w-full text-left px-4 py-3 rounded border hover:bg-zinc-50 flex justify-between items-center group",children:[e.jsx("span",{className:"font-medium",children:"Myself"}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900",children:"→"})]})]}),l.map(n=>e.jsxs(i.Form,{method:"post",onSubmit:a=>{const t=window._tempAttendanceType||"in_person";let s="book";t==="in_person"&&(o.inPersonCount||0)>=(o.capacity||1/0)&&(s="waitlist");const d=document.createElement("input");d.type="hidden",d.name="attendanceType",d.value=t,a.currentTarget.appendChild(d);const c=document.createElement("input");c.type="hidden",c.name="intent",c.value=s,a.currentTarget.appendChild(c),r(null)},children:[e.jsx("input",{type:"hidden",name:"classId",value:o.id}),e.jsx("input",{type:"hidden",name:"memberId",value:n.memberId||""}),e.jsxs("button",{type:"submit",className:"w-full text-left px-4 py-3 rounded border hover:bg-zinc-50 flex justify-between items-center group",children:[e.jsxs("span",{className:"font-medium",children:[n.firstName," ",n.lastName]}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900",children:"→"})]})]},n.userId))]}),e.jsx("button",{onClick:()=>r(null),className:"mt-4 w-full py-2 text-zinc-500 hover:text-zinc-800 text-sm",children:"Cancel"})]})}),e.jsx("div",{className:"space-y-8",children:Object.keys(g).length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg",children:"No upcoming classes scheduled."}):Object.entries(g).map(([n,a])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-3 sticky top-0 bg-zinc-50/95 dark:bg-zinc-950/95 py-2 backdrop-blur",children:n}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm hover:border-zinc-300 dark:hover:border-zinc-700 transition-colors flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:t.title}),e.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex flex-wrap gap-x-3",children:[e.jsxs("span",{children:[new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," • ",t.durationMinutes," min"]}),t.instructor?.user?.profile&&e.jsxs("span",{children:["with ",t.instructor.user.profile.firstName]}),t.capacity&&e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:`px-1.5 py-0.5 rounded ${(t.inPersonCount||0)>=t.capacity?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400"}`,children:["In-Person: ",t.inPersonCount||0," / ",t.capacity]}),t.zoomEnabled&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800",children:["Virtual: ",t.virtualCount||0]})]})]})]}),e.jsx("div",{children:p?e.jsx(e.Fragment,{children:l.length>0?e.jsx("button",{onClick:()=>w(t),disabled:t.userBookingStatus==="confirmed",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${t.userBookingStatus==="confirmed"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:t.userBookingStatus==="confirmed"?"Booked":!t.zoomEnabled&&(t.inPersonCount||0)>=(t.capacity||1/0)?"Join Waitlist":"Book"}):e.jsx("div",{className:"flex flex-col gap-2 items-end",children:t.userBookingStatus==="confirmed"?e.jsxs("div",{className:"flex items-center gap-2",children:[t.zoomEnabled&&t.userBooking?e.jsxs(i.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"switch_attendance"}),e.jsx("input",{type:"hidden",name:"classId",value:t.id}),e.jsx("input",{type:"hidden",name:"bookingId",value:t.userBooking.id}),e.jsx("input",{type:"hidden",name:"attendanceType",value:t.userBooking.attendanceType==="zoom"?"in_person":"zoom"}),e.jsxs("button",{type:"submit",title:"Switch Attendance Type",disabled:i.state!=="idle",className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:["Switch to ",t.userBooking.attendanceType==="zoom"?"In-Person":"Zoom"]})]}):null,e.jsxs(i.Form,{method:"post",onSubmit:s=>{confirm("Are you sure you want to cancel this booking?")||s.preventDefault()},children:[e.jsx("input",{type:"hidden",name:"intent",value:"cancel_booking"}),e.jsx("input",{type:"hidden",name:"classId",value:t.id}),e.jsx("input",{type:"hidden",name:"bookingId",value:t.userBooking.id}),e.jsx("button",{type:"submit",disabled:i.state!=="idle",className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"Cancel"})]}),e.jsxs("span",{className:"px-4 py-2 text-sm font-medium rounded bg-zinc-100 text-zinc-500 cursor-default",children:["Booked ",t.userBooking?.attendanceType==="zoom"?"(Virtual)":"(In-Person)"]})]}):e.jsxs(i.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:(t.confirmedCount||0)>=(t.capacity||1/0)?"waitlist":"book"}),e.jsx("input",{type:"hidden",name:"classId",value:t.id}),e.jsx("button",{type:"submit",onClick:s=>{t.zoomEnabled&&(s.preventDefault(),r(t))},disabled:i.state!=="idle"&&i.formData?.get("classId")===t.id||t.userBookingStatus==="confirmed"||t.userBookingStatus==="waitlisted",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${t.userBookingStatus==="confirmed"||t.userBookingStatus==="waitlisted"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:i.state!=="idle"&&i.formData?.get("classId")===t.id?"Processing...":t.userBookingStatus==="confirmed"?"Booked":t.userBookingStatus==="waitlisted"?"On Waitlist":!t.zoomEnabled&&(t.inPersonCount||0)>=(t.capacity||1/0)?"Join Waitlist":"Book"})]})})}):e.jsx("a",{href:"/sign-in",className:"px-4 py-2 border border-zinc-300 text-zinc-700 text-sm font-medium rounded hover:bg-zinc-50",children:"Login to Book"})})]},t.id))})]},n))})]})});export{Z as default};
