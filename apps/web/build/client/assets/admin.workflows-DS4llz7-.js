import{w as be,u as je,j as ve}from"./chunk-JMJ3UQ3L-Dw7tS_gO.js";import{r as _,j as e}from"./vendor-puck-By1A5E5K.js";import{a as l,R as d}from"./vendor-sentry-BD1MTpLq.js";import{D as N,f as S,a as E,b as z,c as $,d as ye,e as A}from"./dialog-C8yECxTw.js";import{B as ke}from"./Badge-X8cH5Q5B.js";import{B as x}from"./button-BgyeBcg8.js";import{L as g,I as F}from"./label-D7RQKMOi.js";import{S as I}from"./select-Cva9Td0K.js";import{Z as we,V as Ne,u as Se,N as Ee,$ as ze,a as $e,w as Ce,e as Te,s as Pe}from"./use-resolve-button-type-CGo9al7H.js";import{o as b,p as R,m as De,M as Fe,Y as Ie,H as Me,K as L,a as Ve,b as Oe,y as _e,w as Ae,n as Re,V as Le,c as M}from"./portal-DJvkvMc5.js";import{f as W,s as B}from"./dialog-DkyizW2j.js";import{P as We}from"./plus-BBRn-p3b.js";import{C as V}from"./clock-CZ6xxKks.js";import{P as Be}from"./pencil-DhXDeFua.js";import{T as He}from"./trash-2-DU-4PZMS.js";import{C as qe}from"./circle-alert-Day-jl1l.js";import{c as H}from"./createLucideIcon-DgXJrNmH.js";import{U as Ue}from"./user-plus-wgpaf6QU.js";import"./x-6mvJS0UK.js";import"./chevron-down-DOKZOgBX.js";import"./vendor-charts-nrSmOgTy.js";const Ge=[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]],Ke=H("cake",Ge);const Je=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Xe=H("calendar-clock",Je);function Ye(t,r,s){let[a,i]=l.useState(s),o=t!==void 0,u=l.useRef(o),n=l.useRef(!1),c=l.useRef(!1);return o&&!u.current&&!n.current?(n.current=!0,u.current=o,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!o&&u.current&&!c.current&&(c.current=!0,u.current=o,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[o?t:a,b(f=>(o||_.flushSync(()=>i(f)),r?.(f)))]}function Ze(t){let[r]=l.useState(t);return r}function q(t={},r=null,s=[]){for(let[a,i]of Object.entries(t))G(s,U(r,a),i);return s}function U(t,r){return t?t+"["+r+"]":r}function G(t,r,s){if(Array.isArray(s))for(let[a,i]of s.entries())G(t,U(r,a.toString()),i);else s instanceof Date?t.push([r,s.toISOString()]):typeof s=="boolean"?t.push([r,s?"1":"0"]):typeof s=="string"?t.push([r,s]):typeof s=="number"?t.push([r,`${s}`]):s==null?t.push([r,""]):et(s)&&!l.isValidElement(s)&&q(s,r,t)}function Qe(t){var r,s;let a=(r=t?.form)!=null?r:t.closest("form");if(a){for(let i of a.elements)if(i!==t&&(i.tagName==="INPUT"&&i.type==="submit"||i.tagName==="BUTTON"&&i.type==="submit"||i.nodeName==="INPUT"&&i.type==="image")){i.click();return}(s=a.requestSubmit)==null||s.call(a)}}function et(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let r=Object.getPrototypeOf(t);return r===null||Object.getPrototypeOf(r)===null}let tt=l.createContext(null);function st({children:t}){let r=l.useContext(tt);if(!r)return d.createElement(d.Fragment,null,t);let{target:s}=r;return s?_.createPortal(d.createElement(d.Fragment,null,t),s):null}function rt({data:t,form:r,disabled:s,onReset:a,overrides:i}){let[o,u]=l.useState(null),n=R();return l.useEffect(()=>{if(a&&o)return n.addEventListener(o,"reset",a)},[o,r,a]),d.createElement(st,null,d.createElement(nt,{setForm:u,formId:r}),q(t).map(([c,f])=>d.createElement(W,{features:B.Hidden,...De({key:c,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:r,disabled:s,name:c,value:f,...i})})))}function nt({setForm:t,formId:r}){return l.useEffect(()=>{if(r){let s=document.getElementById(r);s&&t(s)}},[t,r]),r?null:d.createElement(W,{features:B.Hidden,as:"input",type:"hidden",hidden:!0,readOnly:!0,ref:s=>{if(!s)return;let a=s.closest("form");a&&t(a)}})}let C=l.createContext(null);C.displayName="GroupContext";let at=l.Fragment;function it(t){var r;let[s,a]=l.useState(null),[i,o]=Ne(),[u,n]=Me(),c=l.useMemo(()=>({switch:s,setSwitch:a}),[s,a]),f={},k=t,j=L();return d.createElement(n,{name:"Switch.Description",value:u},d.createElement(o,{name:"Switch.Label",value:i,props:{htmlFor:(r=c.switch)==null?void 0:r.id,onClick(v){s&&(Ve(v.currentTarget)&&v.preventDefault(),s.click(),s.focus({preventScroll:!0}))}}},d.createElement(C.Provider,{value:c},j({ourProps:f,theirProps:k,slot:{},defaultTag:at,name:"Switch.Group"}))))}let lt="button";function ot(t,r){var s;let a=l.useId(),i=Se(),o=Oe(),{id:u=i||`headlessui-switch-${a}`,disabled:n=o||!1,checked:c,defaultChecked:f,onChange:k,name:j,value:v,form:J,autoFocus:w=!1,...X}=t,T=l.useContext(C),[Y,Z]=l.useState(null),Q=l.useRef(null),ee=_e(Q,r,T===null?null:T.setSwitch,Z),h=Ze(f),[y,p]=Ye(c,k,h??!1),te=R(),[se,P]=l.useState(!1),D=b(()=>{P(!0),p?.(!y),te.nextFrame(()=>{P(!1)})}),re=b(m=>{if(Pe(m.currentTarget))return m.preventDefault();m.preventDefault(),D()}),ne=b(m=>{m.key===M.Space?(m.preventDefault(),D()):m.key===M.Enter&&Qe(m.currentTarget)}),ae=b(m=>m.preventDefault()),ie=Ee(),le=Ae(),{isFocusVisible:oe,focusProps:ce}=ze({autoFocus:w}),{isHovered:de,hoverProps:ue}=$e({isDisabled:n}),{pressed:me,pressProps:fe}=Ce({disabled:n}),he=Re({checked:y,disabled:n,hover:de,focus:oe,active:me,autofocus:w,changing:se}),pe=Le({id:u,ref:ee,role:"switch",type:Te(t,Y),tabIndex:t.tabIndex===-1?0:(s=t.tabIndex)!=null?s:0,"aria-checked":y,"aria-labelledby":ie,"aria-describedby":le,disabled:n||void 0,autoFocus:w,onClick:re,onKeyUp:ne,onKeyPress:ae},ce,ue,fe),xe=l.useCallback(()=>{if(h!==void 0)return p?.(h)},[p,h]),ge=L();return d.createElement(d.Fragment,null,j!=null&&d.createElement(rt,{disabled:n,data:{[j]:v||"on"},overrides:{type:"checkbox",checked:y},form:J,onReset:xe}),ge({ourProps:pe,theirProps:X,slot:he,defaultTag:lt,name:"Switch"}))}let ct=Ie(ot),dt=it,ut=we,mt=Fe,ft=Object.assign(ct,{Group:dt,Label:ut,Description:mt});const K=l.forwardRef(({className:t="",...r},s)=>e.jsx("textarea",{className:`flex min-h-[80px] w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${t}`,ref:s,...r}));K.displayName="Textarea";function ht({checked:t,onCheckedChange:r,disabled:s,className:a=""}){return e.jsx(ft,{checked:t,onChange:r,disabled:s,className:`${t?"bg-zinc-900 dark:bg-zinc-50":"bg-zinc-200 dark:bg-zinc-800"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 dark:focus-visible:ring-zinc-300 dark:focus-visible:ring-offset-zinc-950 ${a}`,children:e.jsx("span",{className:`${t?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})}const Vt=be(function(){const{automations:r}=je(),s=ve(),[a,i]=l.useState(!1),o=n=>{switch(n){case"birthday":return e.jsx(Ke,{className:"text-pink-500"});case"new_student":return e.jsx(Ue,{className:"text-emerald-500"});case"absent":return e.jsx(Xe,{className:"text-amber-500"});case"trial_ending":return e.jsx(qe,{className:"text-indigo-500"});default:return e.jsx(V,{className:"text-blue-500"})}},u=n=>n.timingType==="immediate"?"Sends Immediately":n.timingType==="delay"?`Wait ${n.timingValue} hours`:n.timingType==="before"?`${n.timingValue} hours Before`:n.timingType==="after"?`${n.timingValue} hours After`:"Custom Schedule";return e.jsxs("div",{className:"max-w-5xl mx-auto pb-20 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Marketing Workflows"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Automate your student communication lifecycle."})]}),e.jsxs(N,{open:a,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(We,{className:"w-4 h-4 mr-2"})," New Workflow"]})}),e.jsxs(E,{className:"sm:max-w-lg",children:[e.jsx(z,{children:e.jsx($,{children:"Create Workflow"})}),e.jsx(O,{onSubmit:n=>{n.append("_action","create"),s.submit(n,{method:"post"}),i(!1)}})]})]})]}),e.jsx("div",{className:"grid gap-4",children:r.map(n=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6 flex flex-col sm:flex-row sm:items-center gap-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-3 bg-zinc-50 dark:bg-zinc-800 rounded-full shrink-0",children:o(n.triggerEvent)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100",children:n.subject}),e.jsx(ke,{variant:n.isEnabled?"default":"outline",children:n.isEnabled?"Active":"Paused"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),u(n)]}),e.jsxs("span",{className:"capitalize px-2 py-0.5 bg-zinc-100 dark:bg-zinc-800 rounded text-xs",children:["Trigger: ",n.triggerEvent.replace("_"," ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 sm:pt-0 border-t sm:border-0 border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{htmlFor:`toggle-${n.id}`,className:"sr-only",children:"Enable"}),e.jsx(ht,{checked:n.isEnabled,onCheckedChange:c=>{s.submit({_action:"update",id:n.id,isEnabled:String(c)},{method:"post"})}})]}),e.jsxs(N,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(x,{variant:"outline",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," Edit"]})}),e.jsxs(E,{className:"sm:max-w-lg",children:[e.jsx(z,{children:e.jsxs($,{children:['Edit "',n.subject,'"']})}),e.jsx(O,{initialData:n,onSubmit:c=>{c.append("_action","update"),c.append("id",n.id),s.submit(c,{method:"post"})}})]})]}),e.jsxs(N,{children:[e.jsx(S,{asChild:!0,children:e.jsx(x,{variant:"ghost",className:"text-zinc-400 hover:text-red-500 hover:bg-zinc-100",children:e.jsx(He,{className:"w-4 h-4"})})}),e.jsxs(E,{children:[e.jsxs(z,{children:[e.jsx($,{children:"Delete Workflow?"}),e.jsx(ye,{children:"This action cannot be undone. Typically we recommend pausing instead."})]}),e.jsx(A,{children:e.jsx(x,{variant:"destructive",onClick:()=>{s.submit({_action:"delete",id:n.id},{method:"post"})},children:"Delete"})})]})]})]})]},n.id))})]})});function O({initialData:t,onSubmit:r}){const s=a=>{a.preventDefault();const i=new FormData(a.currentTarget);r(i)};return e.jsxs("form",{onSubmit:s,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Trigger Event"}),e.jsxs(I,{name:"triggerEvent",defaultValue:t?.triggerEvent||"new_student",disabled:!!t,children:[e.jsx("option",{value:"new_student",children:"New Student Signup"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"absent",children:"Student Absent (Re-engage)"}),e.jsx("option",{value:"trial_ending",children:"Trial Ending Soon"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Timing"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{name:"timingType",defaultValue:t?.timingType||"immediate",className:"w-[140px]",children:[e.jsx("option",{value:"immediate",children:"Immediately"}),e.jsx("option",{value:"delay",children:"Wait (Delay)"}),e.jsx("option",{value:"before",children:"Before Event"}),e.jsx("option",{value:"after",children:"After Event"})]}),e.jsx(F,{name:"timingValue",type:"number",defaultValue:t?.timingValue||0,placeholder:"Hours",className:"w-20"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Subject Line"}),e.jsx(F,{name:"subject",defaultValue:t?.subject,required:!0,placeholder:"e.g. Welcome to the family!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Email Content"}),e.jsx(K,{name:"content",defaultValue:t?.content,required:!0,placeholder:"Hello {firstname}...",className:"h-32 font-mono"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Supported variables: ","{firstname}",", ","{lastname}","."]})]}),e.jsx(A,{className:"mt-4",children:e.jsx(x,{type:"submit",children:"Save Workflow"})})]})}export{Vt as default};
