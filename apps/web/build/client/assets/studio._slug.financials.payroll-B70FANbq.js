import{w as v,v as z,r as i}from"./chunk-JMJ3UQ3L-BbiJBYoX.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as f}from"./api-piI5qlNr.js";import{M as S}from"./Modal-Do3O0lli.js";import{C}from"./calendar-BHSWivpg.js";import{S as P}from"./settings-DSZIHkA6.js";import{C as j}from"./circle-check-big-DYqMMV6V.js";import{P as k}from"./plus-CFavzZjE.js";import{D}from"./dollar-sign-CjJQjaE9.js";import"./createLucideIcon-DiSUMwKo.js";const _=v(function(){const{configs:t,payouts:o,members:x,token:l,slug:d}=z(),[c,m]=i.useState(t),[p,u]=i.useState(o),[a,n]=i.useState("run");return e.jsxs("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 mb-2",children:"Payroll & Payouts"}),e.jsx("p",{className:"text-zinc-500 mb-8",children:"Manage instructor compensation and record payouts."}),e.jsx("div",{className:"border-b border-zinc-200 mb-8",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>n("run"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${a==="run"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(C,{className:"h-4 w-4"}),"Run Payroll"]}),e.jsxs("button",{onClick:()=>n("config"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${a==="config"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(P,{className:"h-4 w-4"}),"Configuration"]}),e.jsxs("button",{onClick:()=>n("history"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${a==="history"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(j,{className:"h-4 w-4"}),"Payout History"]})]})}),a==="config"&&e.jsx(R,{configs:c,members:x,token:l,slug:d,onUpdate:b=>m(b)}),a==="run"&&e.jsx(T,{token:l,slug:d}),a==="history"&&e.jsx(I,{payouts:p})]})});function R({configs:s,members:t,token:o,slug:x,onUpdate:l}){const[d,c]=i.useState(!1),[m,p]=i.useState(!1),[u,a]=i.useState(""),[n,b]=i.useState("flat"),[y,g]=i.useState(""),N=t.filter(r=>r.roles.some(h=>h.role==="instructor"||h.role==="owner"));async function w(r){r.preventDefault(),p(!0);try{await f("/payroll/config",o,{method:"PUT",headers:{"X-Tenant-Slug":x},body:JSON.stringify({memberId:u,payModel:n,rate:Number(y)})});const h=await f("/payroll/config",o,{headers:{"X-Tenant-Slug":x}});l(h.configs||[]),c(!1),a(""),g("")}catch(h){alert(h.message)}finally{p(!1)}}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Rate Configurations"}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 hover:bg-zinc-800",children:[e.jsx(k,{className:"h-4 w-4"})," Add Configuration"]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-zinc-200",children:[e.jsx("thead",{className:"bg-zinc-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Pay Model"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Rate"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-zinc-200",children:[s.map(r=>e.jsx(M,{config:r,token:o,slug:x},r.id)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center text-sm text-zinc-500",children:"No configurations found. Add one to get started."})})]})]})}),e.jsx("p",{className:"mt-4 text-sm text-zinc-500",children:"* Note: Rates for percentage model are in basis points (5000 = 50%). Flat/Hourly rates are in cents."}),e.jsx(S,{isOpen:d,onClose:()=>c(!1),title:"Add Payroll Configuration",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Instructor"}),e.jsxs("select",{value:u,onChange:r=>a(r.target.value),required:!0,className:"w-full border border-zinc-300 rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Select Instructor..."}),N.map(r=>e.jsxs("option",{value:r.id,children:[r.user?.profile?.firstName," ",r.user?.profile?.lastName," (",r.user?.email,")"]},r.id))]}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Only showing members with 'Instructor' role."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Pay Model"}),e.jsxs("select",{value:n,onChange:r=>b(r.target.value),className:"w-full border border-zinc-300 rounded px-3 py-2",children:[e.jsx("option",{value:"flat",children:"Flat Rate (per session)"}),e.jsx("option",{value:"hourly",children:"Hourly Rate"}),e.jsx("option",{value:"percentage",children:"Percentage (Revenue Share)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:["Rate ",n==="percentage"?"(in Basis Points, e.g. 5000 = 50%)":"(in Cents)"]}),e.jsx("input",{type:"number",required:!0,value:y,onChange:r=>g(r.target.value),placeholder:n==="percentage"?"5000":"3000",className:"w-full border border-zinc-300 rounded px-3 py-2"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"submit",disabled:m,className:"bg-zinc-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:m?"Saving...":"Save Configuration"})})]})})]})}function M({config:s,token:t,slug:o}){const[x,l]=i.useState(!1),[d,c]=i.useState(s.payModel),[m,p]=i.useState(s.rate);async function u(){try{await f("/payroll/config",t,{method:"PUT",headers:{"X-Tenant-Slug":o},body:JSON.stringify({memberId:s.memberId,payModel:d,rate:Number(m)})}),l(!1)}catch{alert("Failed to save")}}return x?e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-900 bg-yellow-50",children:[s.member?.user?.profile?.firstName," ",s.member?.user?.profile?.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm bg-yellow-50",children:e.jsxs("select",{value:d,onChange:a=>c(a.target.value),className:"border rounded px-2 py-1 bg-white",children:[e.jsx("option",{value:"flat",children:"Flat Rate (per session)"}),e.jsx("option",{value:"hourly",children:"Hourly Rate"}),e.jsx("option",{value:"percentage",children:"Percentage (Revenue Share)"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm bg-yellow-50",children:e.jsx("input",{type:"number",value:m,onChange:a=>p(a.target.value),className:"border rounded px-2 py-1 w-24"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm bg-yellow-50",children:[e.jsx("button",{onClick:u,className:"text-blue-600 hover:text-blue-900 mr-3 font-medium",children:"Save"}),e.jsx("button",{onClick:()=>l(!1),className:"text-zinc-600 hover:text-zinc-900",children:"Cancel"})]})]}):e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-zinc-900",children:[s.member?.user?.profile?.firstName," ",s.member?.user?.profile?.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500 capitalize",children:s.payModel}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500",children:[s.rate," ",s.payModel==="percentage"?"bps":"cents"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>l(!0),className:"text-blue-600 hover:text-blue-900",children:"Edit"})})]})}function I({payouts:s}){return e.jsx("div",{children:e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 overflow-hidden shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-zinc-200",children:[e.jsx("thead",{className:"bg-zinc-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Status"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-zinc-200",children:[s.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-900 font-medium",children:t.instructorName}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500",children:[new Date(t.periodStart).toLocaleDateString()," - ",new Date(t.periodEnd).toLocaleDateString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-zinc-900",children:["$",(t.amount/100).toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full capitalize ${t.status==="paid"?"bg-green-100 text-green-700":t.status==="processing"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-500"}`,children:t.status}),t.stripeTransferId&&e.jsxs("span",{className:"ml-2 text-[10px] text-zinc-400 font-mono",children:[t.stripeTransferId.substring(0,8),"..."]})]})]},t.id)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-sm text-zinc-500",children:"No payout history found."})})]})]})})})}function T({token:s,slug:t}){const[o,x]=i.useState(new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0]),[l,d]=i.useState(new Date().toISOString().split("T")[0]),[c,m]=i.useState(null),[p,u]=i.useState(!1);async function a(){u(!0);try{const n=await f(`/payroll/report?start=${o}&end=${l}`,s,{headers:{"X-Tenant-Slug":t}});m(n.report)}catch(n){console.error(n)}finally{u(!1)}}return e.jsxs("div",{children:[e.jsxs("div",{className:"bg-zinc-50 p-4 rounded-lg flex gap-4 items-end mb-8 border border-zinc-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Period Start"}),e.jsx("input",{type:"date",value:o,onChange:n=>x(n.target.value),className:"border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Period End"}),e.jsx("input",{type:"date",value:l,onChange:n=>d(n.target.value),className:"border rounded px-3 py-2 text-sm"})]}),e.jsx("button",{onClick:a,disabled:p,className:"bg-zinc-900 text-white px-4 py-2 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:p?"Calculating...":"Calculate Payroll"})]}),c&&e.jsxs("div",{className:"space-y-6",children:[Object.keys(c).length===0&&e.jsx("p",{className:"text-zinc-500 text-center py-8",children:"No earnings found for this period."}),Object.entries(c).map(([n,b])=>e.jsx(O,{instructorId:n,data:b,token:s,slug:t,period:{start:o,end:l}},n))]})]})}function O({instructorId:s,data:t,token:o,slug:x,period:l}){const[d,c]=i.useState(!1),[m,p]=i.useState(!1);async function u(){if(confirm(`Mark $${t.total/100} as paid?`)){c(!0);try{await f("/payroll/payout",o,{method:"POST",headers:{"X-Tenant-Slug":x},body:JSON.stringify({instructorId:s,amount:t.total,periodStart:l.start,periodEnd:l.end,items:t.items})}),p(!0)}catch(a){alert("Failed to record payout: "+a.message)}finally{c(!1)}}}return e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-zinc-50 px-6 py-4 flex justify-between items-center border-b border-zinc-200",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Instructor ID: ",s.substring(0,8),"..."]}),e.jsxs("p",{className:"text-sm text-zinc-500",children:[t.items.length," items"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold font-mono text-zinc-900",children:["$",(t.total/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"Total Owing"})]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-zinc-500 border-b border-zinc-100",children:[e.jsx("th",{className:"text-left py-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-2 font-medium",children:"Item"}),e.jsx("th",{className:"text-left py-2 font-medium",children:"Details"}),e.jsx("th",{className:"text-right py-2 font-medium",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-50",children:t.items.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-zinc-600",children:new Date(a.date).toLocaleDateString()}),e.jsx("td",{className:"py-2 font-medium text-zinc-900",children:a.title}),e.jsx("td",{className:"py-2 text-zinc-500 text-xs",children:a.details}),e.jsxs("td",{className:"py-2 text-right text-zinc-900",children:["$",(a.amount/100).toFixed(2)]})]},n))})]})}),e.jsx("div",{className:"px-6 py-4 bg-zinc-50 border-t border-zinc-200 flex justify-end",children:m?e.jsxs("span",{className:"flex items-center gap-2 text-green-600 font-medium px-4 py-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Payout Recorded"]}):e.jsxs("button",{onClick:u,disabled:d,className:"bg-green-600 text-white px-4 py-2 rounded-md font-medium text-sm hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),d?"Recording...":"Mark as Paid"]})})]})}export{_ as default};
