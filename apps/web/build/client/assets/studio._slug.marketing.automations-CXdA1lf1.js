import{w as W,u as H,f as X}from"./chunk-JMJ3UQ3L-DIHTCPR9.js";import{j as e}from"./vendor-puck-EFhZVjRu.js";import{a as i}from"./vendor-sentry-BD1MTpLq.js";import{C as Z}from"./ConfirmDialog-DqDjwe4K.js";import{Z as v}from"./zap-CpdSyYPf.js";import{P as q}from"./plus-BBRn-p3b.js";import{U as I}from"./users-DTyswlyE.js";import{C as J}from"./calendar-CHyLPk-n.js";import{T as Y}from"./target-DaZesuop.js";import{C as M}from"./clock-CZ6xxKks.js";import{c as _}from"./createLucideIcon-DgXJrNmH.js";import{X as D}from"./x-6mvJS0UK.js";import{T as $}from"./trash-2-DU-4PZMS.js";import{P as K}from"./play-Yex43xXq.js";import"./button-Bn3mr4O5.js";import"./dialog-BbMbq4lO.js";import"./portal-BBJKmgiS.js";import"./vendor-charts-BQhvGvjY.js";const Q=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ee=_("bell",Q);const te=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],se=_("pause",te),P=[{id:"new_member",label:"New Member Signs Up",icon:I},{id:"class_booked",label:"Class Booked",icon:J},{id:"class_missed",label:"Class No-Show",icon:Y},{id:"inactive_days",label:"Inactive for X Days",icon:M},{id:"birthday",label:"Member Birthday",icon:ee},{id:"membership_expiring",label:"Membership Expiring",icon:M},{id:"product_purchase",label:"Product Purchased",icon:v},{id:"subscription_canceled",label:"Subscription Canceled (Period End)",icon:D},{id:"subscription_terminated",label:"Subscription Terminated",icon:$},{id:"student_updated",label:"Student Profile Updated",icon:I}],Ce=W(function(){const{automations:c,stats:n}=H(),d=X(),[x,o]=i.useState(!1),[r,p]=i.useState(null),u=s=>{d({intent:"toggle",id:s},{method:"post"})},z=s=>{p(s)},j=()=>{r&&(d({intent:"delete",id:r},{method:"post"}),p(null))};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50",children:[e.jsx("header",{className:"bg-white border-b border-zinc-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg text-white",children:e.jsx(v,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-zinc-900",children:"Automations"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Set up automated email & SMS campaigns"})]})]}),e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",children:[e.jsx(q,{size:16})," Create Automation"]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[n&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:n.totalAutomations||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Total Automations"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.activeCount||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Active"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.emailsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Emails Sent (30d)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.smsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"SMS Sent (30d)"})]})]}),c.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-zinc-200",children:[e.jsx(v,{size:48,className:"mx-auto mb-4 text-zinc-300"}),e.jsx("p",{className:"text-zinc-500 mb-4",children:"No automations yet"}),e.jsx("button",{onClick:()=>o(!0),className:"text-sm text-zinc-900 underline",children:"Create your first"})]}):e.jsx("div",{className:"space-y-4",children:c.map(s=>{const l=P.find(b=>b.id===s.trigger),a=l?.icon||v;return e.jsx("div",{className:`bg-white rounded-xl border ${s.isActive?"border-green-200":"border-zinc-200"} p-5`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${s.isActive?"bg-green-100":"bg-zinc-100"}`,children:e.jsx(a,{size:24,className:s.isActive?"text-green-600":"text-zinc-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-zinc-900",children:s.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.isActive?"Active":"Paused"})]}),e.jsxs("p",{className:"text-sm text-zinc-500 mt-1",children:["Trigger: ",l?.label||s.trigger]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-zinc-400",children:[e.jsxs("span",{children:["Actions: ",s.actions?.length||0]}),e.jsxs("span",{children:["Runs: ",s.runCount||0]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(s.id),className:`p-2 rounded-lg ${s.isActive?"hover:bg-yellow-50 text-yellow-600":"hover:bg-green-50 text-green-600"}`,title:s.isActive?"Pause":"Activate",children:s.isActive?e.jsx(se,{size:16}):e.jsx(K,{size:16})}),e.jsx("button",{onClick:()=>z(s.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-500",children:e.jsx($,{size:16})})]})]})},s.id)})})]}),x&&e.jsx(ne,{onClose:()=>o(!1),onSave:s=>{const l=new FormData;l.append("intent","create");for(const a of Object.keys(s))typeof s[a]=="object"?l.append(a,JSON.stringify(s[a])):l.append(a,s[a]);d(l,{method:"post"}),o(!1)}}),e.jsx(Z,{open:!!r,onOpenChange:s=>!s&&p(null),onConfirm:j,title:"Delete Automation",description:"Are you sure you want to delete this automation? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})]})}),ie=[{id:"immediate",label:"Immediately"},{id:"delay",label:"Delay (Hours)"},{id:"before",label:"Before Event (Hours)"}];function ne({onClose:m,onSave:c}){const[n,d]=i.useState(1),[x,o]=i.useState(""),[r,p]=i.useState("new_student"),[u,z]=i.useState("immediate"),[j,s]=i.useState("0"),[l,a]=i.useState("all"),[b,E]=i.useState(""),[y,V]=i.useState(""),[h,B]=i.useState(!1),[f,k]=i.useState("percent"),[S,F]=i.useState("10"),[A,U]=i.useState("7"),[g,T]=i.useState("simple"),[C,L]=i.useState(""),[w,R]=i.useState(""),[N,G]=i.useState(""),O=()=>{const t={name:x,trigger:r,triggerConfig:{},actions:[],isActive:!0,timingType:u,timingValue:parseInt(j)||0};l==="filter"&&(t.audienceFilter={},b&&(t.audienceFilter.ageMin=parseInt(b)),y&&(t.audienceFilter.ageMax=parseInt(y))),h&&(t.couponConfig={type:f,value:parseInt(S),validityDays:parseInt(A)}),g==="template"?(t.templateId=N,t.subject=C||"Notification",t.content="Template: "+N):(t.subject=C,t.content=w),c(t)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Create Automation"}),e.jsx("button",{onClick:m,children:e.jsx(D,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:[1,2,3,4].map(t=>e.jsx("div",{className:`h-1 flex-1 rounded-full ${t<=n?"bg-purple-600":"bg-zinc-100"}`},t))}),n===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Automation Name"}),e.jsx("input",{type:"text",value:x,onChange:t=>o(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"e.g., Welcome Series"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Trigger"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 h-48 overflow-y-auto pr-1",children:P.map(t=>e.jsxs("button",{onClick:()=>p(t.id),className:`p-3 rounded-lg border text-left flex items-center gap-2 ${r===t.id?"border-purple-500 bg-purple-50":"border-zinc-200 hover:bg-zinc-50"}`,children:[e.jsx(t.icon,{size:16,className:r===t.id?"text-purple-600":"text-zinc-400"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Timing"}),e.jsx("div",{className:"flex bg-zinc-100 p-1 rounded-lg mb-2",children:ie.map(t=>e.jsx("button",{onClick:()=>z(t.id),className:`flex-1 py-1.5 text-xs font-medium rounded-md ${u===t.id?"bg-white shadow text-zinc-900":"text-zinc-500 hover:text-zinc-700"}`,children:t.label},t.id))}),u!=="immediate"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:j,onChange:t=>s(t.target.value),className:"w-24 px-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"text-sm text-zinc-500",children:"hours"})]})]})]}),n===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Audience Targeting"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:l==="all",onChange:()=>a("all")}),e.jsx("span",{children:"All Members"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:l==="filter",onChange:()=>a("filter")}),e.jsx("span",{children:"Filtered"})]})]}),l==="filter"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Min Age"}),e.jsx("input",{type:"number",value:b,onChange:t=>E(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Max Age"}),e.jsx("input",{type:"number",value:y,onChange:t=>V(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"65"})]})]})]}),n===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Sweeteners"}),e.jsxs("div",{className:"p-4 border border-zinc-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center ${h?"bg-purple-600 border-purple-600":"border-zinc-300"}`,children:h&&e.jsx(le,{size:12,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Generate Unique Coupon"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Include a single-use code in the email."})]})]}),e.jsx("input",{type:"checkbox",checked:h,onChange:t=>B(t.target.checked),className:"hidden"})]}),h&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-zinc-100 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 flex bg-zinc-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>k("percent"),className:`flex-1 py-1 text-xs font-medium rounded-md ${f==="percent"?"bg-white shadow":"text-zinc-500"}`,children:"Percentage Off"}),e.jsx("button",{onClick:()=>k("amount"),className:`flex-1 py-1 text-xs font-medium rounded-md ${f==="amount"?"bg-white shadow":"text-zinc-500"}`,children:"Flat Amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Value"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:S,onChange:t=>F(t.target.value),className:"w-full pl-8 pr-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"absolute left-3 top-2 text-zinc-400 text-sm",children:f==="percent"?"%":"$"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:A,onChange:t=>U(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg"})]})]})]})]}),n===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Email Content"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:C,onChange:t=>L(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"Welcome!"})]}),e.jsxs("div",{className:"flex gap-4 border-b border-zinc-100 pb-2",children:[e.jsx("button",{onClick:()=>T("simple"),className:`pb-2 text-sm font-medium ${g==="simple"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Simple Text"}),e.jsx("button",{onClick:()=>T("template"),className:`pb-2 text-sm font-medium ${g==="template"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Resend Template"})]}),g==="simple"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Message Body"}),e.jsx("textarea",{value:w,onChange:t=>R(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg h-32",placeholder:"Start typing... Use {{firstName}} for variables."})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Template ID"}),e.jsx("input",{type:"text",value:N,onChange:t=>G(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"re_123456789"}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:["Variables sent: generic data + ",e.jsx("code",{children:"title"}),", ",e.jsx("code",{children:"address"}),", ",e.jsx("code",{children:"firstName"}),", ",e.jsx("code",{children:"couponCode"}),"."]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 flex justify-between",children:[n>1&&e.jsx("button",{onClick:()=>d(n-1),className:"px-4 py-2 text-sm text-zinc-500",children:"Back"}),n<4?e.jsx("button",{onClick:()=>d(n+1),disabled:!x&&n===1,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:"Next"}):e.jsx("button",{onClick:O,disabled:g==="simple"?!w:!N,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:"Create Automation"})]})]})})}function le({size:m,className:c}){return e.jsx("svg",{width:m||24,height:m||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:c,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}export{Ce as default};
