import{w as E,f as M,c as R,r as n}from"./chunk-JMJ3UQ3L-CD8Ifjmd.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{C as w,a as N,b as k,c as z,d as S}from"./Card-IOiQbqBT.js";import{L as p}from"./loader-circle-DMNpguZg.js";import{C as O}from"./credit-card-R-UObwMD.js";import{C}from"./circle-check-big-n7iyB6n2.js";import{c as U}from"./createLucideIcon-B1hucShu.js";import{M as _}from"./mail-LYFDCYXF.js";import{S as L}from"./send-DKcCZ6Xk.js";import{M as B}from"./message-square-B2rvOhvo.js";import{T as W}from"./terminal-CqfQDf8H.js";import{T as X}from"./trash-2-bKKpy50-.js";const J=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],H=U("smartphone",J),ue=E(function(){const{slug:a}=M(),{tenant:s}=R()||{},[u,b]=n.useState([]),[T,h]=n.useState(!0),[m,f]=n.useState(""),[g,P]=n.useState("booking.created, order.completed"),[y,j]=n.useState(!1),[v,A]=n.useState(null),[Y,G]=n.useState(!1),[Q,K]=n.useState({accountSid:"",authToken:"",fromNumber:""}),[V,D]=n.useState({apiKey:""}),[Z,F]=n.useState(!1),o="https://studio-platform-api.slichti.workers.dev";n.useEffect(()=>{x()},[a]);const x=async()=>{h(!0);try{const r={Authorization:`Bearer ${window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token")}`,"X-Tenant-Slug":a||""},[i,c]=await Promise.all([fetch(`${o}/integrations/webhooks`,{headers:r}),fetch(`${o}/integrations/credentials`,{headers:r})]);if(i.ok){const d=await i.json();b(d.endpoints)}if(c.ok){const d=await c.json();A(d),K({accountSid:d.twilio?.accountSid||"",authToken:"",fromNumber:d.twilio?.fromNumber||""}),D({apiKey:d.resend?.apiKey||""})}}catch(t){console.error("Failed to load data",t)}finally{h(!1)}},l=async t=>{try{const r=await window.Clerk?.session?.getToken();if(!(await fetch(`${o}/studios/${s.id}/integrations`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json","X-Tenant-Slug":a||""},body:JSON.stringify(t)})).ok)throw new Error("Failed to update");alert("Settings saved successfully."),window.location.reload()}catch(r){alert(r.message||"Failed to save")}},$=async()=>{if(m){j(!0);try{const t=await window.Clerk?.session?.getToken();(await fetch(`${o}/integrations/webhooks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Tenant-Slug":a||""},body:JSON.stringify({url:m,events:g.split(",").map(i=>i.trim()),description:"Manual created"})})).ok?(f(""),x()):alert("Failed to create webhook")}catch(t){console.error(t)}finally{j(!1)}}},I=async t=>{if(confirm("Delete this webhook?"))try{const r=await window.Clerk?.session?.getToken();(await fetch(`${o}/integrations/webhooks/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"X-Tenant-Slug":a||""}})).ok&&b(u.filter(c=>c.id!==t))}catch(r){console.error(r)}};return s?e.jsxs("div",{className:"max-w-5xl pb-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Integrations"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage connections, payment providers, and developer tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"})," Payment Processing"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${s.paymentProvider==="connect"&&s.stripeAccountId?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.paymentProvider==="connect"&&s.stripeAccountId?"Connected":s.paymentProvider==="custom"?"Custom Keys":"Not Configured"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{onClick:()=>{s.paymentProvider!=="connect"&&confirm("Switch to Platform Managed?")&&l({paymentProvider:"connect"})},className:`relative cursor-pointer border rounded-lg p-4 transition-all ${s.paymentProvider==="connect"?"border-blue-500 ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-zinc-200 dark:border-zinc-700 hover:border-zinc-300"}`,children:[s.paymentProvider==="connect"&&e.jsx("div",{className:"absolute top-2 right-2 text-blue-600",children:e.jsx(C,{size:20,className:"fill-blue-100"})}),e.jsx("div",{className:"font-bold text-sm text-zinc-900 dark:text-zinc-100 mb-1",children:"Platform Managed"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"We handle billing complexity. Standard fees. Recommended for most studios."}),s.paymentProvider==="connect"&&!s.stripeAccountId&&e.jsx("a",{href:`${o}/studios/stripe/connect?tenantId=${s.id}`,className:"mt-4 block w-full py-2 text-center bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700",children:"Connect Stripe Account â†’"}),s.paymentProvider==="connect"&&s.stripeAccountId&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-700",children:"Hardware"})}),e.jsxs("button",{onClick:()=>F(!0),className:"w-full flex items-center justify-center gap-2 py-2 border border-blue-300 text-blue-700 rounded text-xs font-bold hover:bg-blue-100 transition-colors",children:[e.jsx(H,{size:14})," Order Terminal Reader"]})]})]}),e.jsxs("div",{onClick:()=>{s.paymentProvider!=="custom"&&l({paymentProvider:"custom"})},className:`relative cursor-pointer border rounded-lg p-4 transition-all ${s.paymentProvider==="custom"?"border-blue-500 ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-zinc-200 dark:border-zinc-700 hover:border-zinc-300"}`,children:[s.paymentProvider==="custom"&&e.jsx("div",{className:"absolute top-2 right-2 text-blue-600",children:e.jsx(C,{size:20,className:"fill-blue-100"})}),e.jsx("div",{className:"font-bold text-sm text-zinc-900 dark:text-zinc-100 mb-1",children:"Self Managed (BYOK)"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Use your own Stripe keys. No platform fees. You handle compliance."})]})]}),s.paymentProvider==="custom"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault();const r=new FormData(t.currentTarget);l({paymentProvider:"custom",stripePublishableKey:r.get("stripePublishableKey"),stripeSecretKey:r.get("stripeSecretKey")})},className:"bg-zinc-50 dark:bg-zinc-800/50 p-4 rounded border border-zinc-200 dark:border-zinc-700 space-y-3 animate-in slide-in-from-top-2",children:[e.jsx("input",{name:"stripePublishableKey",placeholder:"Publishable Key (pk_...)",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("input",{name:"stripeSecretKey",type:"password",placeholder:"Secret Key (sk_...)",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"text-xs bg-zinc-900 text-white px-3 py-1.5 rounded",children:"Save Stripe Keys"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"})," Transactional Email (Resend)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${s.resendCredentials?.apiKey?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.resendCredentials?.apiKey?"Configured":"Using Platform Default"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Provide your own Resend API Key to send transactional emails from your domain."}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),l({resendApiKey:new FormData(t.currentTarget).get("resendApiKey")})},className:"flex gap-2",children:[e.jsx("input",{name:"resendApiKey",type:"password",placeholder:"re_123...",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"})," Marketing Automation (Flodesk)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${v?.flodesk?.configured?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:v?.flodesk?.configured?"Configured":"Not Configured"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Sync members and activity to Flodesk for email marketing."}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault();try{const r=new FormData(t.currentTarget).get("flodeskApiKey"),i=await window.Clerk?.session?.getToken();(await fetch(`${o}/integrations/credentials`,{method:"PATCH",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json","X-Tenant-Slug":a||""},body:JSON.stringify({flodesk:{apiKey:r}})})).ok?(alert("Flodesk settings saved."),x()):alert("Failed to save Flodesk settings.")}catch(r){console.error(r)}},className:"flex gap-2",children:[e.jsx("input",{name:"flodeskApiKey",type:"password",placeholder:"Flodesk API Key",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"})," SMS Service (Twilio)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${s.twilioCredentials?.accountSid?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.twilioCredentials?.accountSid?"Configured":"Using Platform Default"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Connect your Twilio account for custom SMS notifications."}),e.jsxs("form",{onSubmit:t=>{t.preventDefault();const r=new FormData(t.currentTarget);l({twilioAccountSid:r.get("twilioAccountSid"),twilioAuthToken:r.get("twilioAuthToken"),twilioFromNumber:r.get("twilioFromNumber")})},className:"space-y-3",children:[e.jsx("input",{name:"twilioAccountSid",placeholder:"Account SID",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("input",{name:"twilioFromNumber",placeholder:"From Number (+1...)",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("input",{name:"twilioAuthToken",type:"password",placeholder:"Auth Token",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Twilio"})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"text-zinc-900 dark:text-zinc-100"}),e.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:"Developer Tools"})]}),e.jsxs(w,{children:[e.jsxs(N,{children:[e.jsx(k,{className:"flex items-center gap-2",children:"Outgoing Webhooks"}),e.jsx(z,{children:"Receive real-time JSON payloads when events happen in your studio."})]}),e.jsxs(S,{className:"space-y-6",children:[T?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(p,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"border rounded-md divide-y",children:[u.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm",children:"No webhooks configured."}),u.map(t=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"font-mono text-sm font-medium",children:t.url}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Array.isArray(t.events)?t.events.join(", "):t.events})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("code",{className:"text-[10px] bg-muted px-2 py-1 rounded text-muted-foreground hidden sm:inline-block",children:[t.secret.slice(0,8),"..."]}),e.jsx("button",{className:"p-2 hover:bg-red-50 text-red-600 rounded",onClick:()=>I(t.id),children:e.jsx(X,{className:"h-4 w-4"})})]})]},t.id))]}),e.jsxs("div",{className:"p-4 border rounded-md bg-muted/20 bg-zinc-50 dark:bg-zinc-900 space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add New Endpoint"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Endpoint URL"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"https://hooks.zapier.com/...",value:m,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Events (comma separated)"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:g,onChange:t=>P(t.target.value)}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Available: booking.created, order.completed, student.created"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary bg-zinc-900 text-white hover:bg-zinc-800 h-10 px-4 py-2",onClick:$,disabled:!m||y,children:[y&&e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Webhook"]})})]})]})]}),e.jsxs(w,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"Studio API Credentials"}),e.jsx(z,{children:"Use these credentials to authenticate API requests."})]}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Studio ID (Tenant ID)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,value:s.id||"Loading...",className:"font-mono bg-muted flex h-10 w-full rounded-md border border-input px-3"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(s.id),className:"border rounded px-3 text-sm hover:bg-gray-100 dark:hover:bg-zinc-800",children:"Copy"})]})]})})})]})]})]}):e.jsx("div",{className:"p-8",children:e.jsx(p,{className:"animate-spin"})})});export{ue as default};
