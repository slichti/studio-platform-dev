import{w as C,u as S}from"./chunk-EPOLDU6W-CxxYD-cd.js";import{j as e}from"./vendor-puck-aUaaDwmz.js";import{a as v}from"./api-D1U4i9fn.js";import{a as r}from"./vendor-livekit-D3VpklN2.js";import{P as I}from"./PrivacyBlur-DQKCu4pe.js";import{C as P,E as $}from"./Dialogs-C3BiSLFk.js";import{R as F}from"./refresh-cw-DEg60w5A.js";import{D as O}from"./dollar-sign-mXsRCEeh.js";import{C as d}from"./circle-check-big-DvZS8AIf.js";import{C as m}from"./circle-alert-BrO62f5x.js";import"./Modal-RrMUvIY-.js";import"./createLucideIcon-CcD9UNCP.js";const H=C(function(){const{preview:N,error:h,token:p}=S(),[b,k]=r.useState(N),[l,c]=r.useState(!1),[t,g]=r.useState(null),[w,o]=r.useState(!1),[x,j]=r.useState({isOpen:!1,message:""}),u=async()=>{c(!0);try{const s=await v("/admin/billing/preview",p);k(s),g(null)}catch(s){console.error(s)}finally{c(!1)}},y=async()=>{o(!1),c(!0);try{const s=await v("/admin/billing/charge",p,{method:"POST"});g(s),setTimeout(u,1e3)}catch(s){j({isOpen:!0,message:"Charge failed: "+s.message})}finally{c(!1)}},i=b?.tenants||[],f=i.reduce((s,a)=>s+a.total,0).toFixed(2),n=b?.fees||{sms:.0075,email:6e-4,streaming:.05,storage:.02};return h?e.jsxs("div",{className:"p-8 text-red-600",children:["Error loading billing data: ",h]}):e.jsxs("div",{className:"max-w-6xl mx-auto pb-20 dark:text-zinc-100",children:[e.jsx(P,{isOpen:w,onClose:()=>o(!1),onConfirm:y,title:"Confirm Invoicing",message:`Are you sure you want to invoice ${i.length} tenants for a total of $${f}?`,confirmText:"Invoice Tenants"}),e.jsx($,{isOpen:x.isOpen,onClose:()=>j({...x,isOpen:!1}),message:x.message}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Financials & Chargebacks"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Review usage and invoice tenants for subscriptions and overages."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:u,disabled:l,className:"px-4 py-2 border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-300 flex items-center gap-2",children:[e.jsx(F,{size:16,className:l?"animate-spin":""}),"Refresh Preview"]}),e.jsxs("button",{onClick:()=>o(!0),disabled:l||i.length===0,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(O,{size:16}),"Invoice ",i.length," Tenants"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",children:"Projected Total Revenue"}),e.jsx("div",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:e.jsxs(I,{revealed:!0,children:["$",f]})}),e.jsxs("div",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx(d,{size:12})," Ready to invoice"]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",children:"Active Tenants"}),e.jsx("div",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:i.length}),e.jsx("div",{className:"text-xs text-zinc-400 mt-2",children:"Managed by platform"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mb-1",children:"Fee Schedule"}),e.jsxs("div",{className:"text-sm space-y-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between border-b border-zinc-50 dark:border-zinc-800 pb-1 mb-1",children:[e.jsx("span",{className:"text-zinc-500 dark:text-zinc-400",children:"Service Fee"})," ",e.jsx("span",{className:"font-mono",children:n.applicationFeePercent?`${n.applicationFeePercent*100}%`:"Var"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500 dark:text-zinc-400",children:"SMS"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.sms]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500 dark:text-zinc-400",children:"Email"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.email]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500 dark:text-zinc-400",children:"Stream"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.streaming,"/min"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500 dark:text-zinc-400",children:"Storage"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.storage,"/GB"]})]})]})]})]}),t&&e.jsxs("div",{className:`mb-8 p-4 rounded-lg border ${t.success?"bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200"}`,children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[t.success?e.jsx(d,{size:18}):e.jsx(m,{size:18}),t.success?"Invoicing Complete":"Invoicing Failed"]}),e.jsxs("div",{className:"mt-2 text-sm",children:[t.success?e.jsxs("p",{children:["Successfully processed ",t.charged," invoices."]}):e.jsx("p",{children:t.error}),t.details&&e.jsx("ul",{className:"mt-2 list-disc list-inside opacity-80 h-32 overflow-y-auto",children:t.details.map((s,a)=>e.jsx("li",{children:s.error?e.jsxs("span",{className:"text-red-600 font-medium",children:["Failed: ",s.tenantId," - ",s.error]}):e.jsxs("span",{children:["Charged ",s.name,": $",s.total.toFixed(2)," (",s.items.length," items)"]})},a))})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-950/50 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100",children:"Billing Preview"}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"Including Base Subscription + Usage Overages"})]}),i.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-500",children:[e.jsx(d,{size:48,className:"mx-auto text-green-500 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium text-zinc-900",children:"All Clear"}),e.jsx("p",{className:"max-w-sm mx-auto mt-1",children:"No active tenants found."})]}):e.jsxs("table",{className:"w-full text-left text-zinc-900 dark:text-zinc-100",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-950/50 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Tenant"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Base Plan"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Usage Breakdown"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:i.map(s=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:s.tenant.name}),e.jsx("div",{className:"text-zinc-500 dark:text-zinc-400 text-xs font-mono",children:s.tenant.slug}),s.tenant.stripeCustomerId?e.jsxs("div",{className:"text-[10px] text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(d,{size:10})," Stripe Connected"]}):e.jsxs("div",{className:"text-[10px] text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(m,{size:10})," No Billing ID"]})]}),e.jsx("td",{className:"px-6 py-4",children:s.subscription&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:s.subscription.name}),e.jsxs("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:["$",s.subscription.amount.toFixed(2),"/mo"]})]})}),e.jsx("td",{className:"px-6 py-4",children:Object.entries(s.costs).length===0?e.jsx("span",{className:"text-xs text-zinc-400 italic",children:"No usage overages"}):e.jsx("div",{className:"space-y-1 text-sm",children:Object.entries(s.costs).map(([a,z])=>e.jsxs("div",{className:"flex justify-between max-w-[200px]",children:[e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400 capitalize",children:[a,":"]}),e.jsxs("span",{className:"font-mono text-zinc-700 dark:text-zinc-300",children:[Math.round(z.quantity).toLocaleString()," units ($",z.amount.toFixed(2),")"]})]},a))})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:["$",s.total.toFixed(2)]})})]},s.tenant.id))})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-lg text-sm border border-blue-100 dark:border-blue-900/50 flex gap-3",children:[e.jsx(m,{className:"shrink-0 mt-0.5",size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"Note on Invoicing:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1 opacity-90 ml-1",children:[e.jsxs("li",{children:['The "Invoice" button generates standard Stripe Invoice Items for ',e.jsx("strong",{children:"Usage Overages"}),"."]}),e.jsxs("li",{children:["Base Plan fees are typically handled automatically by Stripe Subscriptions if configured. The total above is a ",e.jsx("em",{children:"projection"})," of comprehensive revenue."]}),e.jsx("li",{children:"Verify Stripe Subscription status before manual invoicing to avoid double-charging base fees."})]})]})]})]})});export{H as default};
