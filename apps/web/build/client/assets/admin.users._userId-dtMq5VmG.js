import{w as C,d as I,a as A,r as o}from"./chunk-JMJ3UQ3L-Dzyq37y6.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as x}from"./api-piI5qlNr.js";import{M as E}from"./Modal-Ccs7c619.js";import{C as M,E as T}from"./Dialogs-BuTG-RoC.js";import{u as U}from"./chunk-OT5FTIRN-DBwNzrXh.js";import"./index-CsedX6-y.js";import"./index-D9_Tf6xB.js";const W=C(function(){const{user:t,tenants:h}=I(),{getToken:c}=U(),p=A(),[f,N]=o.useState(t.isSystemAdmin),[g,b]=o.useState(!1),[j,v]=o.useState(""),[l,y]=o.useState(t.memberships||[]),[w,m]=o.useState(!1),[n,u]=o.useState({tenantId:"",role:"student"}),[r,a]=o.useState({isOpen:!1,type:"success",message:""}),z=async()=>{b(!0),v("");try{const s=await c();await x(`/admin/users/${t.id}`,s,{method:"PUT",body:JSON.stringify({isSystemAdmin:f})}),p("/admin/users")}catch(s){v(s.message||"Failed to update user")}finally{b(!1)}},S=async()=>{if(n.tenantId)try{const s=await c();await x(`/admin/users/${t.id}/memberships`,s,{method:"POST",body:JSON.stringify(n)});const i=h.find(d=>d.id===n.tenantId);y([...l,{id:"temp",tenant:i,role:n.role}]),m(!1),u({tenantId:"",role:"student"}),a({isOpen:!0,type:"success",message:"Access granted successfully."})}catch(s){a({isOpen:!0,type:"error",message:s.message})}},k=async s=>{if(confirm("Are you sure you want to remove this user from the studio?"))try{const i=await c();await x(`/admin/users/${t.id}/memberships`,i,{method:"DELETE",body:JSON.stringify({tenantId:s})}),y(l.filter(d=>d.tenant.id!==s))}catch(i){a({isOpen:!0,type:"error",message:i.message})}},O=async()=>{if(confirm(`You are about to sign in as ${t.email}. This will assume their identity.`))try{const s=await c(),i=await x("/admin/impersonate",s,{method:"POST",body:JSON.stringify({targetUserId:t.id})});if(i.token)if(localStorage.setItem("impersonation_token",i.token),document.cookie=`__impersonate_token=${i.token}; path=/; max-age=3600; SameSite=Lax`,l.length>0){const d=l[0].tenant.slug;window.location.href=`/studio/${d}`}else alert("User has no studio memberships to access.")}catch(s){a({isOpen:!0,type:"error",message:`Impersonation failed: ${s.message}`})}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:()=>p("/admin/users"),className:"text-sm text-zinc-500 hover:text-zinc-900 mb-2 flex items-center gap-1",children:"â† Back to Directory"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Edit User"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:O,className:"px-4 py-2 border border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 rounded-lg transition-colors font-medium text-sm flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Impersonate"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-zinc-100 flex items-center justify-center text-xl font-bold text-zinc-500 overflow-hidden",children:t.profile?.portraitUrl?e.jsx("img",{src:t.profile.portraitUrl,className:"w-full h-full object-cover"}):t.profile?.firstName?.[0]||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-xl",children:t.email==="slichti@gmail.com"&&t.profile?.firstName==="System"&&t.profile?.lastName==="Admin"?"Steven Lichti":`${t.profile?.firstName} ${t.profile?.lastName}`}),e.jsx("div",{className:"text-zinc-500",children:t.email}),e.jsx("div",{className:"text-zinc-400 font-mono text-xs mt-1",children:t.id})]})]}),e.jsxs("div",{className:"pt-6 border-t border-zinc-100",children:[e.jsx("h3",{className:"text-sm font-medium text-zinc-900 mb-4",children:"Platform Roles"}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-4 rounded-lg border border-zinc-200 hover:bg-zinc-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>N(s.target.checked),className:"mt-1 w-5 h-5 rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:"System Administrator"}),e.jsx("div",{className:"text-sm text-zinc-500 mt-1",children:"Grants full access to modify all tenants, users, and system settings."})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:z,disabled:g,className:"px-4 py-2 bg-zinc-900 hover:bg-zinc-800 text-white rounded-lg transition-colors font-medium text-sm disabled:opacity-50",children:g?"Saving...":"Update Profile"})}),j&&e.jsx("div",{className:"mt-4 text-red-600 text-sm text-center",children:j})]})}),e.jsx("div",{className:"md:col-span-1 space-y-6",children:e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg p-6 shadow-sm h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-zinc-900",children:"Studio Access"}),e.jsx("button",{onClick:()=>m(!0),className:"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded hover:bg-blue-100 font-medium",children:"+ Add"})]}),l.length===0?e.jsx("div",{className:"text-center py-8 text-zinc-500 text-sm bg-zinc-50 rounded-lg border border-dashed border-zinc-200",children:"This user does not belong to any studios."}):e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsxs("div",{className:"p-3 border border-zinc-200 rounded-lg bg-zinc-50/50 flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-zinc-900",children:s.tenant.name}),e.jsx("div",{className:"text-xs text-zinc-500 capitalize",children:s.role||s.roles?.map(i=>i.role).join(", ")||"No Role"})]}),e.jsx("button",{onClick:()=>k(s.tenant.id),className:"text-zinc-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-all p-1",title:"Remove access",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"m6 6 12 12"})]})})]},s.tenant.id))}),e.jsx("div",{className:"mt-4 text-xs text-zinc-400 leading-relaxed",children:"Users can have different roles (Owner, Instructor, Student) in different studios."})]})})]}),e.jsx(E,{isOpen:w,onClose:()=>m(!1),title:"Grant Studio Access",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Select Studio"}),e.jsxs("select",{className:"w-full border border-zinc-300 rounded-md p-2 text-sm",value:n.tenantId,onChange:s=>u({...n,tenantId:s.target.value}),children:[e.jsx("option",{value:"",children:"-- Select a Studio --"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.slug,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Role"}),e.jsxs("select",{className:"w-full border border-zinc-300 rounded-md p-2 text-sm",value:n.role,onChange:s=>u({...n,role:s.target.value}),children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"instructor",children:"Instructor"}),e.jsx("option",{value:"owner",children:"Owner"})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500 bg-zinc-50 p-2 rounded border border-zinc-200 leading-relaxed",children:[e.jsx("strong",{children:"Note:"})," Owners generally function as Instructors and Students as well. Instructors often participate as Students.",e.jsx("br",{}),e.jsx("br",{}),"This system treats roles independently, so you may assign multiple roles to a user for a single studio if needed."]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-3 py-2 text-zinc-600 hover:bg-zinc-100 rounded text-sm",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:!n.tenantId,className:"px-3 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded text-sm disabled:opacity-50",children:"Grant Access"})]})]})}),e.jsx(M,{isOpen:r.isOpen&&r.type==="success",onClose:()=>a({...r,isOpen:!1}),onConfirm:()=>a({...r,isOpen:!1}),title:"Success",message:r.message,confirmText:"OK",cancelText:"Close"}),e.jsx(T,{isOpen:r.isOpen&&r.type==="error",onClose:()=>a({...r,isOpen:!1}),title:"Error",message:r.message})]})});export{W as default};
