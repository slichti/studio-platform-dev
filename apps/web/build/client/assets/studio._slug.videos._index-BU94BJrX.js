import{w as A,d as F,i as M,u as V,r as n,L as _}from"./chunk-JMJ3UQ3L-Bs7kYf96.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as L}from"./api-piI5qlNr.js";import{a as $}from"./format-CAsSOgDD.js";import{U as B}from"./upload-CFy9cSkL.js";import{I}from"./image-DYHkfInB.js";import{F as O}from"./film-DzNKKPQP.js";import{c as R}from"./createLucideIcon-DGNyYaKe.js";import{X as D}from"./x-B4DPw67G.js";import{I as J}from"./info-BOyq7hZT.js";import{P as q}from"./plus-CnaK_SoT.js";import{R as H}from"./refresh-cw-BGsI1PAs.js";import{S as X}from"./save-CPi6OOmF.js";const K=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],E=R("folder",K),pe=A(function(){const{videos:i,storageUsage:l,images:a,collections:m}=F(),u=M(),[N,f]=V(),r=N.get("tab")||"videos",[z,j]=n.useState("grid"),[p,g]=n.useState(null),[S,U]=n.useState(!1),[C,w]=n.useState("video"),[d,h]=n.useState(!1),[v,b]=n.useState(null),T=async o=>{h(!0);try{const s=await window.Clerk?.session?.getToken(),c=await L("/video-management/upload-url",s,{method:"POST",body:JSON.stringify({type:"vod"}),headers:{"X-Tenant-Slug":window.tenantSlug||""}}),{uploadUrl:x,uid:y}=c,k=new FormData;if(k.append("file",o),!(await fetch(x,{method:"POST",body:k})).ok)throw new Error("Upload to video server failed");await L("/video-management/",s,{method:"POST",body:JSON.stringify({title:o.name,cloudflareStreamId:y})}),u.revalidate()}catch(s){console.error(s),b("Upload failed: "+s.message)}finally{h(!1)}},P=async o=>{h(!0),b(null);try{const s=await window.Clerk?.session?.getToken(),c=new FormData;if(c.append("file",o),!(await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:c})).ok)throw new Error("Image upload failed");u.revalidate()}catch(s){b("Upload failed: "+s.message)}finally{h(!1)}};return e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-zinc-50/50",children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Media Library"}),e.jsx("p",{className:"text-zinc-500",children:"Manage your class recordings and photo assets."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-zinc-100 px-4 py-2 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-zinc-600",children:"Storage Used: "}),e.jsx("span",{className:"font-bold",children:$(l)})]}),r==="videos"?e.jsxs("label",{className:`bg-black text-white px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 transition flex items-center gap-2 ${d?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(B,{size:18}),d?"Uploading...":"Upload Video",e.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:o=>o.target.files?.[0]&&T(o.target.files[0]),disabled:d})]}):e.jsxs("label",{className:`bg-black text-white px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 transition flex items-center gap-2 ${d?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(I,{size:18}),d?"Uploading...":"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:o=>o.target.files?.[0]&&P(o.target.files[0]),disabled:d})]})]})]}),e.jsxs("div",{className:"flex space-x-6 border-b border-zinc-100 -mb-px",children:[e.jsxs("button",{onClick:()=>f({tab:"videos"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${r==="videos"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(O,{size:16})," Videos (",i.length,")"]}),e.jsxs("button",{onClick:()=>f({tab:"collections"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${r==="collections"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(E,{size:16})," Collections (",m.length,")"]}),e.jsxs("button",{onClick:()=>f({tab:"images"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${r==="images"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(I,{size:16})," Photos (",a.length,")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[v&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4 text-sm flex justify-between items-center",children:[v,e.jsx("button",{onClick:()=>b(null),children:e.jsx(D,{size:14})})]}),r==="videos"?e.jsx(Z,{videos:i,onSelect:g,selectedId:p?.id}):r==="collections"?e.jsx(G,{collections:m}):e.jsx(Q,{images:a,onSelect:g,selectedId:p?.id})]})]}),p&&e.jsx(W,{item:p,type:r==="videos"?"video":"image",onClose:()=>g(null),onUpdate:()=>{u.revalidate()}})]})});function Z({videos:t,onSelect:i,selectedId:l}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No videos found."}):e.jsx("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b font-medium text-zinc-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"Duration"}),e.jsx("th",{className:"px-4 py-3",children:"Tags"}),e.jsx("th",{className:"px-4 py-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:t.map(a=>e.jsxs("tr",{onClick:()=>i(a),className:`cursor-pointer hover:bg-zinc-50 transition ${l===a.id?"bg-blue-50/50":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium text-zinc-900",children:a.title}),e.jsx("td",{className:"px-4 py-3 text-zinc-500",children:a.duration?Math.floor(a.duration/60)+"m":"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.tags?.slice(0,3).map(m=>e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-100 text-zinc-600 rounded text-xs",children:m},m)),a.tags?.length>3&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["+",a.tags.length-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(J,{size:16})})})]},a.id))})]})})}function G({collections:t,onCreate:i}){return t.length===0&&!i?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No collections found."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(l=>e.jsx(_,{to:`collections/${l.id}`,className:"block group",children:e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 hover:border-black transition shadow-sm h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-zinc-100 rounded-lg group-hover:bg-zinc-900 group-hover:text-white transition",children:e.jsx(E,{size:24})}),e.jsxs("span",{className:"text-xs text-zinc-400 font-mono",children:["#",l.slug]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:l.title}),e.jsx("p",{className:"text-sm text-zinc-500 line-clamp-2 mb-4 flex-1",children:l.description||"No description"}),e.jsx("div",{className:"text-xs text-zinc-400 font-medium",children:"Click to manage items â†’"})]})},l.id)),e.jsxs("div",{className:"border-2 border-dashed border-zinc-200 rounded-lg p-6 flex flex-col items-center justify-center text-zinc-400 hover:bg-zinc-50 hover:border-zinc-300 transition cursor-pointer min-h-[200px]",onClick:i,children:[e.jsx(q,{size:32}),e.jsx("span",{className:"mt-2 text-sm font-medium",children:"Create Collection"})]})]})}function Q({images:t,onSelect:i,selectedId:l}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(a=>e.jsxs("div",{onClick:()=>i(a),className:`bg-white rounded border aspect-square relative group cursor-pointer overflow-hidden ${l===a.id?"ring-2 ring-blue-500 ring-offset-2":"hover:border-zinc-300"}`,children:[e.jsx("img",{src:a.fileUrl,alt:a.title,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:a.title||a.originalName}),e.jsx("p",{className:"text-white/80 text-xs",children:$(a.sizeBytes)})]})]},a.id))})}function W({item:t,type:i,onClose:l,onUpdate:a}){const[m,u]=n.useState(t.title||t.originalName||""),[N,f]=n.useState(t.description||""),[r,z]=n.useState(t.tags||[]),[j,p]=n.useState(""),[g,S]=n.useState(!1),[U,C]=n.useState(t.accessLevel||"members"),[w,d]=n.useState(t.posterUrl||""),[h,v]=n.useState(!1);n.useEffect(()=>{u(t.title||t.originalName||""),f(t.description||""),z(t.tags||[]),i==="video"&&(C(t.accessLevel||"members"),d(t.posterUrl||"")),p("")},[t,i]);const b=s=>{s.key==="Enter"&&j.trim()&&(s.preventDefault(),r.includes(j.trim())||z([...r,j.trim()]),p(""))},T=s=>{z(r.filter(c=>c!==s))},P=async s=>{v(!0);try{const c=await window.Clerk?.session?.getToken(),x=new FormData;x.append("file",s);const y=await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${c}`},body:x});if(!y.ok)throw new Error("Upload failed");const k=await y.json();d(k.url)}catch(c){console.error(c),alert("Poster upload failed")}finally{v(!1)}},o=async()=>{S(!0);try{const s=await window.Clerk?.session?.getToken(),c=i==="video"?`/video-management/${t.id}`:`/uploads/images/${t.id}`,x={title:m,description:N,tags:r};i==="video"&&(x.accessLevel=U,x.posterUrl=w),await L(c,s,{method:"PATCH",body:JSON.stringify(x)}),a()}catch(s){console.error(s),alert("Failed to save changes.")}finally{S(!1)}};return e.jsxs("div",{className:"w-80 bg-white border-l border-zinc-200 shadow-xl flex flex-col overflow-hidden animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 flex justify-between items-center bg-zinc-50",children:[e.jsxs("span",{className:"font-semibold text-sm uppercase text-zinc-500 tracking-wide",children:[i," Details"]}),e.jsx("button",{onClick:l,className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(D,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"aspect-video bg-zinc-100 rounded-lg overflow-hidden border border-zinc-200 flex items-center justify-center relative group",children:[i==="image"?e.jsx("img",{src:t.fileUrl,className:"w-full h-full object-contain"}):w?e.jsx("img",{src:w,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-2 text-zinc-400",children:[e.jsx(O,{size:24}),e.jsx("span",{className:"text-xs",children:"No preview available"})]}),i==="video"&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>s.target.files?.[0]&&P(s.target.files[0]),disabled:h}),e.jsxs("span",{className:"text-white text-xs font-medium flex items-center gap-2",children:[h?e.jsx(H,{className:"animate-spin",size:16}):e.jsx(I,{size:16}),"Change Poster"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-zinc-500",children:[e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Size"}),$(t.sizeBytes)]}),e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Created"}),new Date(t.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:m,onChange:s=>u(s.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm focus:ring-2 focus:ring-black focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Description"}),e.jsx("textarea",{value:N,onChange:s=>f(s.target.value),rows:3,className:"w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm focus:ring-2 focus:ring-black focus:border-transparent outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Tags / Labels"}),e.jsxs("div",{className:"min-h-[40px] p-2 border border-zinc-200 rounded-lg bg-white flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-black focus-within:border-transparent",children:[r.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-zinc-100 text-zinc-700 px-2 py-1 rounded text-xs font-medium",children:[s,e.jsx("button",{onClick:()=>T(s),className:"hover:text-red-500",children:e.jsx(D,{size:10})})]},s)),e.jsx("input",{type:"text",value:j,onChange:s=>p(s.target.value),onKeyDown:b,placeholder:r.length===0?"Type and enter...":"",className:"flex-1 min-w-[60px] text-sm outline-none bg-transparent"})]}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Press Enter to add tag"})]}),i==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Access Level"}),e.jsxs("select",{value:U,onChange:s=>C(s.target.value),className:"w-full px-2 py-2 border border-zinc-200 rounded-lg text-sm outline-none",children:[e.jsx("option",{value:"public",children:"Public (Everyone)"}),e.jsx("option",{value:"members",children:"Members Only (Logged In)"}),e.jsx("option",{value:"private",children:"Private (Admin Only)"})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-zinc-100 bg-zinc-50",children:e.jsx("button",{onClick:o,disabled:g,className:"w-full bg-black text-white py-2 rounded-lg font-medium text-sm hover:bg-zinc-800 disabled:opacity-50 flex items-center justify-center gap-2",children:g?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(X,{size:16})," Save Usage"]})})})]})}export{pe as default};
