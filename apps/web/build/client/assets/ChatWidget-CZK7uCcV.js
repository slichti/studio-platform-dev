import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as t}from"./chunk-JMJ3UQ3L-OilvkdUQ.js";import{X as _}from"./x-iEfBqcMQ.js";import{M as J}from"./message-circle-DPLUTtBn.js";import{S as K}from"./send-BS3f6L2P.js";function F({roomId:u,tenantId:f,userId:l,userName:p,apiUrl:b="",enabled:S=!0}){const[o,z]=t.useState(!1),[h,g]=t.useState([]),[d,w]=t.useState(""),[i,j]=t.useState(!1),[V,x]=t.useState([]),n=t.useRef(null),y=t.useRef(null),[C]=t.useState(()=>`guest_${Math.random().toString(36).substr(2,9)}`),k=l||C,E=p||"Guest",v=t.useCallback(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[]);t.useEffect(()=>{v()},[h,v]),t.useEffect(()=>{if(!o||i)return;const s=b||(typeof window<"u"?window.location.origin:""),P=s.startsWith("https")?"wss://":"ws://",R=s.replace(/^http(s)?:\/\//,""),M=`${P}${R}/api/chat/rooms/${u}/websocket?roomId=${u}&tenantId=${f}&userId=${k}&userName=${encodeURIComponent(E)}`,a=new WebSocket(M);return n.current=a,a.onopen=()=>{j(!0),console.log("[Chat] Connected")},a.onmessage=m=>{try{const r=JSON.parse(m.data);switch(r.type){case"history":g(r.messages||[]);break;case"message":g(c=>[...c,r]);break;case"user_list":x(r.users||[]);break;case"user_joined":x(c=>[...c,{userId:r.userId,userName:r.userName}]);break;case"user_left":x(c=>c.filter(U=>U.userId!==r.userId));break}}catch(r){console.error("[Chat] Parse error:",r)}},a.onclose=()=>{j(!1),console.log("[Chat] Disconnected")},a.onerror=m=>{console.error("[Chat] Error:",m)},()=>{a.close(),n.current=null}},[o,u,f,l,p,b]);const N=()=>{!d.trim()||!n.current||n.current.readyState!==WebSocket.OPEN||(n.current.send(JSON.stringify({type:"message",content:d.trim()})),w(""))},I=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),N())},[W,$]=t.useState(!0),B=["Track my order","What are your shipping details?","What is your shipping time?","What is your contact info?"],O=s=>{!n.current||n.current.readyState!==WebSocket.OPEN||n.current.send(JSON.stringify({type:"message",content:s}))};return S?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{z(!o),$(!1)},className:"fixed bottom-6 right-6 w-14 h-14 bg-[#2563EB] text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",children:[o?e.jsx(_,{size:24}):e.jsx(J,{size:24}),W&&!o&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white",children:"1"})]}),o&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans",children:[e.jsxs("div",{className:"bg-[#2563EB] text-white px-6 py-6 pb-12 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Chat with us"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:"ðŸ‘‹ Hi, message us with any questions. We're happy to help!"})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex flex-col",children:e.jsxs("div",{className:"mt-auto p-4 space-y-4",children:[h.map(s=>e.jsx("div",{className:`flex ${s.userId===l?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl text-sm ${s.userId===l?"bg-[#2563EB] text-white rounded-br-sm":"bg-gray-100 text-zinc-900 rounded-bl-sm"}`,children:e.jsx("p",{children:s.content})})},s.id)),h.length===0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide",children:"Instant answers"}),B.map(s=>e.jsx("button",{onClick:()=>O(s),disabled:!i,className:"w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",children:s},s))]}),e.jsx("div",{ref:y})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-100 bg-white",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:d,onChange:s=>w(s.target.value),onKeyPress:I,placeholder:"Write message",className:"w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",disabled:!i}),e.jsx("button",{onClick:N,disabled:!i||!d.trim(),className:"absolute right-2 p-2 text-zinc-400 hover:text-[#2563EB] transition-colors disabled:opacity-50",children:e.jsx(K,{size:20})})]}),!i&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-[10px] text-zinc-400",children:"Connecting to support..."})})]})]})]}):null}export{F as C};
