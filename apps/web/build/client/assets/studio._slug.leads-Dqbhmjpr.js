import{w as U,c as _,r as i}from"./chunk-JMJ3UQ3L-Cjm2z498.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as x}from"./api-D1U4i9fn.js";import{M as D}from"./Modal-AFqyleoL.js";import{P as M}from"./plus-DEHhyUAe.js";import{S as B}from"./search-CdR5QGWe.js";import{M as P}from"./mail-ouzs7CCr.js";import{P as O}from"./phone-DSY_cufG.js";import{C as $}from"./clock-CtIZ1ApW.js";import{C as G}from"./circle-alert-CZb3Q5Bc.js";import{P as K}from"./pencil-B0y_spzd.js";import{C as Q}from"./circle-check-big-C7V6a8x5.js";import{f as w}from"./format-CLi5Eqkk.js";import"./createLucideIcon-DkPcMMCg.js";const ue=U(function(){const{leads:F,token:c,slug:d}=_(),[g,f]=i.useState(F),[E,u]=i.useState(!1),[k,C]=i.useState(!1),[j,X]=i.useState(""),[a,p]=i.useState(null),[h,N]=i.useState([]),[Y,S]=i.useState(!1),[z,L]=i.useState(""),[T,b]=i.useState(!1),[r,m]=i.useState({}),[n,o]=i.useState({firstName:"",lastName:"",email:"",phone:"",source:"",notes:""}),J=async s=>{p(s),b(!1),m({...s}),S(!0);try{const t=await x(`/tasks?leadId=${s.id}`,c,{headers:{"X-Tenant-Slug":d}});N(Array.isArray(t)?t:[])}catch(t){console.error("Failed to load tasks",t)}finally{S(!1)}},R=async s=>{s.preventDefault();try{await x(`/leads/${a.id}`,c,{method:"PATCH",headers:{"X-Tenant-Slug":d},body:JSON.stringify(r)}),p({...a,...r}),f(g.map(t=>t.id===a.id?{...t,...r}:t)),b(!1)}catch(t){alert("Failed to update lead: "+t.message)}},I=async s=>{if(s.preventDefault(),!!z)try{const t=await x("/tasks",c,{method:"POST",headers:{"X-Tenant-Slug":d},body:JSON.stringify({title:z,relatedLeadId:a.id,status:"todo",priority:"medium",dueDate:new Date(Date.now()+864e5)})});N([t,...h]),L("")}catch(t){alert("Failed to create task: "+t.message)}},W=async(s,t)=>{const l=t==="done"?"todo":"done";N(h.map(y=>y.id===s?{...y,status:l}:y)),await x(`/tasks/${s}`,c,{method:"PATCH",headers:{"X-Tenant-Slug":d},body:JSON.stringify({status:l})})},q=async s=>{s.preventDefault(),C(!0);try{const t=await x("/leads",c,{method:"POST",headers:{"X-Tenant-Slug":d},body:JSON.stringify(n)});if(t.error)alert(t.error);else{const l=await x("/leads",c,{headers:{"X-Tenant-Slug":d}});f(l.leads||[]),u(!1),o({firstName:"",lastName:"",email:"",phone:"",source:"",notes:""})}}catch(t){alert("Failed to create lead: "+t.message)}finally{C(!1)}},H=async(s,t)=>{f(g.map(l=>l.id===s?{...l,status:t}:l));try{await x(`/leads/${s}`,c,{method:"PATCH",headers:{"X-Tenant-Slug":d},body:JSON.stringify({status:t})})}catch(l){console.error(l)}},v=g.filter(s=>s.email.toLowerCase().includes(j.toLowerCase())||(s.firstName+" "+s.lastName).toLowerCase().includes(j.toLowerCase())),A=s=>{switch(s){case"new":return"bg-blue-100 text-blue-800";case"contacted":return"bg-yellow-100 text-yellow-800";case"trialing":return"bg-purple-100 text-purple-800";case"converted":return"bg-green-100 text-green-800";case"lost":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Leads CRM"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Track and manage prospective students."})]}),e.jsxs("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-all hover:translate-y-[-1px]",children:[e.jsx(M,{size:18}),"Add New Lead"]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search leads...",value:j,onChange:s=>X(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg text-sm bg-zinc-50 dark:bg-zinc-800 focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{className:"text-sm text-zinc-500",children:[v.length," leads found"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Source"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Added"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:[v.map(s=>e.jsxs("tr",{onClick:()=>J(s),className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs uppercase",children:[s.firstName?.[0],s.lastName?.[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:[s.firstName," ",s.lastName]}),s.notes&&e.jsx("div",{className:"text-xs text-zinc-400 truncate max-w-[200px]",title:s.notes,children:s.notes})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:14,className:"text-zinc-400"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:14,className:"text-zinc-400"}),e.jsx("span",{children:s.phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.status,onChange:t=>H(s.id,t.target.value),className:`text-xs font-bold uppercase px-2 py-1 rounded border-none outline-none cursor-pointer focus:ring-2 focus:ring-blue-500/50 ${A(s.status)}`,children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"trialing",children:"Trialing"}),e.jsx("option",{value:"converted",children:"Converted"}),e.jsx("option",{value:"lost",children:"Lost"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-600 dark:text-zinc-400",children:s.source?e.jsx("span",{className:"bg-zinc-100 dark:bg-zinc-800 px-2 py-1 rounded text-xs border border-zinc-200 dark:border-zinc-700",children:s.source}):e.jsx("span",{className:"text-zinc-400 text-xs italic",children:"Unknown"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-500",children:e.jsxs("div",{className:"flex items-center gap-1",title:new Date(s.createdAt).toLocaleString(),children:[e.jsx($,{size:14,className:"text-zinc-400"}),w(new Date(s.createdAt),"MMM d")]})})]},s.id)),v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-zinc-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(G,{size:32,className:"text-zinc-300"}),e.jsx("p",{children:"No leads found matching your criteria."})]})})})]})]})})]}),e.jsx(D,{isOpen:E,onClose:()=>u(!1),title:"Add New Lead",children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"First Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.firstName,onChange:s=>o({...n,firstName:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.lastName,onChange:s=>o({...n,lastName:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.email,onChange:s=>o({...n,email:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Phone (Optional)"}),e.jsx("input",{type:"tel",className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.phone,onChange:s=>o({...n,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Source"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.source,onChange:s=>o({...n,source:s.target.value}),children:[e.jsx("option",{value:"",children:"Select source..."}),e.jsx("option",{value:"Walk-in",children:"Walk-in"}),e.jsx("option",{value:"Website",children:"Website"}),e.jsx("option",{value:"Referral",children:"Referral"}),e.jsx("option",{value:"Social Media",children:"Social Media"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Notes"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none h-24 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:n.notes,onChange:s=>o({...n,notes:s.target.value}),placeholder:"Interests, goals, availability..."})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50",children:k?"Adding...":"Add Lead"})]})]})}),e.jsx(D,{isOpen:!!a,onClose:()=>p(null),title:a?`${a.firstName} ${a.lastName}`:"Lead Details",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800 p-4 rounded-lg flex flex-col gap-3 relative group",children:[e.jsx("div",{className:"flex justify-between items-start",children:T?e.jsxs("form",{onSubmit:R,className:"w-full space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase",children:"First Name"}),e.jsx("input",{className:"w-full px-2 py-1 border rounded",value:r.firstName,onChange:s=>m({...r,firstName:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Last Name"}),e.jsx("input",{className:"w-full px-2 py-1 border rounded",value:r.lastName,onChange:s=>m({...r,lastName:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Email"}),e.jsx("input",{className:"w-full px-2 py-1 border rounded",value:r.email,onChange:s=>m({...r,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Phone"}),e.jsx("input",{className:"w-full px-2 py-1 border rounded",value:r.phone,onChange:s=>m({...r,phone:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Notes"}),e.jsx("textarea",{className:"w-full px-2 py-1 border rounded h-20",value:r.notes,onChange:s=>m({...r,notes:s.target.value})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-3 py-1 text-sm bg-zinc-200 rounded hover:bg-zinc-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:[a.firstName," ",a.lastName]}),e.jsxs("div",{className:"text-sm text-zinc-500 flex gap-4 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{size:14})," ",a.email]}),a.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{size:14})," ",a.phone]})]})]}),e.jsx("button",{onClick:()=>b(!0),className:"p-2 text-zinc-400 hover:text-blue-600 rounded-full hover:bg-blue-50 transition-colors",children:e.jsx(K,{size:18})})]})}),!T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold uppercase ${A(a.status)}`,children:a.status}),e.jsxs("span",{className:"text-xs text-zinc-400",children:["Added ",w(new Date(a.createdAt),"MMM d, yyyy")]})]}),a.notes&&e.jsxs("div",{className:"mt-2 text-sm text-zinc-600 italic border-t border-zinc-200 dark:border-zinc-700 pt-3 relative pl-3",children:[e.jsx("span",{className:"absolute left-0 top-3 bottom-0 w-1 bg-zinc-300 rounded-full"}),'"',a.notes,'"']})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2 mb-4",children:[e.jsx($,{size:18}),"Activity Timeline"]}),e.jsxs("form",{onSubmit:I,className:"flex gap-2 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{className:"w-full pl-9 pr-3 py-2 border rounded-lg bg-white dark:bg-zinc-800 dark:border-zinc-700 text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Add a new task or note...",value:z,onChange:s=>L(s.target.value)}),e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:16})]}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-sm",children:"Add"})]}),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-100 dark:border-zinc-800 space-y-6",children:[h.map(s=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-[21px] top-1 w-3 h-3 rounded-full border-2 border-white dark:border-zinc-900 ${s.status==="done"?"bg-green-500":"bg-blue-500"}`}),e.jsx("div",{className:"bg-white dark:bg-zinc-800 p-3 rounded-lg border border-zinc-100 dark:border-zinc-800 shadow-sm hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),W(s.id,s.status)},className:`mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${s.status==="done"?"bg-green-500 border-green-500 text-white":"border-zinc-300 dark:border-zinc-600 hover:border-green-500"}`,children:s.status==="done"&&e.jsx(Q,{size:12})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:`font-medium ${s.status==="done"?"line-through text-zinc-400":"text-zinc-900 dark:text-zinc-100"}`,children:s.title}),e.jsx("span",{className:"text-[10px] text-zinc-400",children:s.dueDate?w(new Date(s.dueDate),"MMM d"):"No date"})]}),e.jsx("div",{className:"mt-1 flex gap-2",children:e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded border uppercase ${s.priority==="high"?"bg-red-50 text-red-600 border-red-100":"bg-zinc-50 text-zinc-500 border-zinc-100"}`,children:s.priority})})]})]})})]},s.id)),h.length===0&&e.jsx("div",{className:"text-zinc-400 text-xs italic pl-2",children:"No activity recorded yet."})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:()=>p(null),className:"text-zinc-500 hover:text-zinc-700 text-sm",children:"Close"})})]})})]})});export{ue as default};
