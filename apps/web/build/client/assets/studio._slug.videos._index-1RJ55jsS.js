import{w as V,u as B,g as _,a as R,c as J,L as q}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as I}from"./api-ChCisjdG.js";import{a as $}from"./format-CAsSOgDD.js";import{a as o}from"./vendor-sentry-DugYw-Ne.js";import{t as L}from"./index-CNiSO0Vl.js";import{U as H}from"./upload-CNi1Qv8K.js";import{I as D}from"./image-Dwt4gHEC.js";import{F as A}from"./film-BCZGyjb5.js";import{c as X}from"./createLucideIcon-BOpDDQ2B.js";import{X as O}from"./x-Bbpoc0N5.js";import{I as K}from"./info-CsiXuo4l.js";import{P as Z}from"./plus-7j3qtkRM.js";import{R as G}from"./refresh-cw-DnP96nUp.js";import{S as Q}from"./save-BsFOcTUD.js";const W=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],F=X("folder",W),ze=V(function(){const{videos:a,storageUsage:c,images:r,collections:m}=B(),g=_(),[j,b]=R(),{isStudentView:d}=J(),u=j.get("tab")||"videos",l=d&&u==="images"?"videos":u,[k,S]=o.useState("grid"),[p,f]=o.useState(null),[C,N]=o.useState(!1),[U,T]=o.useState("video"),[x,z]=o.useState(!1),[w,v]=o.useState(null),P=async i=>{z(!0);try{const n=await window.Clerk?.session?.getToken(),h=await I("/video-management/upload-url",n,{method:"POST",body:JSON.stringify({type:"vod"}),headers:{"X-Tenant-Slug":window.tenantSlug||""}}),{uploadUrl:y,uid:M}=h,E=new FormData;if(E.append("file",i),!(await fetch(y,{method:"POST",body:E})).ok)throw new Error("Upload to video server failed");await I("/video-management/",n,{method:"POST",body:JSON.stringify({title:i.name,cloudflareStreamId:M})}),g.revalidate()}catch(n){console.error(n),v("Upload failed: "+n.message)}finally{z(!1)}},s=async i=>{z(!0),v(null);try{const n=await window.Clerk?.session?.getToken(),h=new FormData;if(h.append("file",i),!(await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:h})).ok)throw new Error("Image upload failed");g.revalidate()}catch(n){v("Upload failed: "+n.message)}finally{z(!1)}};return e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-zinc-50/50 dark:bg-zinc-950",children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Media Library"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:d?"Browse class recordings and video content.":"Manage your class recordings and photo assets."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[!d&&e.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-800 px-4 py-2 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-zinc-600 dark:text-zinc-400",children:"Storage Used: "}),e.jsx("span",{className:"font-bold text-zinc-900 dark:text-zinc-200",children:$(c)})]}),!d&&(l==="videos"?e.jsxs("label",{className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${x?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(H,{size:18}),x?"Uploading...":"Upload Video",e.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:i=>i.target.files?.[0]&&P(i.target.files[0]),disabled:x})]}):e.jsxs("label",{className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 dark:hover:bg-zinc-200 transition flex items-center gap-2 ${x?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(D,{size:18}),x?"Uploading...":"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:i=>i.target.files?.[0]&&s(i.target.files[0]),disabled:x})]}))]})]}),e.jsxs("div",{className:"flex space-x-6 border-b border-zinc-100 dark:border-zinc-800 -mb-px",children:[e.jsxs("button",{onClick:()=>b({tab:"videos"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${l==="videos"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(A,{size:16})," Videos (",a.length,")"]}),e.jsxs("button",{onClick:()=>b({tab:"collections"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${l==="collections"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(F,{size:16})," Collections (",m.length,")"]}),!d&&e.jsxs("button",{onClick:()=>b({tab:"images"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${l==="images"?"border-zinc-900 dark:border-zinc-100 text-zinc-900 dark:text-zinc-100":"border-transparent text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,children:[e.jsx(D,{size:16})," Photos (",r.length,")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[w&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4 text-sm flex justify-between items-center",children:[w,e.jsx("button",{onClick:()=>v(null),children:e.jsx(O,{size:14})})]}),l==="videos"?e.jsx(Y,{videos:a,onSelect:f,selectedId:p?.id}):l==="collections"?e.jsx(ee,{collections:m}):e.jsx(te,{images:r,onSelect:f,selectedId:p?.id})]})]}),p&&e.jsx(se,{item:p,type:l==="videos"?"video":"image",onClose:()=>f(null),onUpdate:()=>{g.revalidate()}})]})});function Y({videos:t,onSelect:a,selectedId:c}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No videos found."}):e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800 font-medium text-zinc-500 dark:text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"Duration"}),e.jsx("th",{className:"px-4 py-3",children:"Tags"}),e.jsx("th",{className:"px-4 py-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:t.map(r=>e.jsxs("tr",{onClick:()=>a(r),className:`cursor-pointer hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition ${c===r.id?"bg-blue-50/50 dark:bg-blue-900/10":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium text-zinc-900 dark:text-zinc-100",children:r.title}),e.jsx("td",{className:"px-4 py-3 text-zinc-500 dark:text-zinc-400",children:r.duration?Math.floor(r.duration/60)+"m":"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.tags?.slice(0,3).map(m=>e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded text-xs",children:m},m)),r.tags?.length>3&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["+",r.tags.length-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:e.jsx(K,{size:16})})})]},r.id))})]})})}function ee({collections:t,onCreate:a}){return t.length===0&&!a?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No collections found."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(c=>e.jsx(q,{to:`collections/${c.id}`,className:"block group",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-black dark:hover:border-zinc-400 transition shadow-sm h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-zinc-100 dark:bg-zinc-800 rounded-lg group-hover:bg-zinc-900 dark:group-hover:bg-zinc-100 group-hover:text-white dark:group-hover:text-black transition",children:e.jsx(F,{size:24})}),e.jsxs("span",{className:"text-xs text-zinc-400 font-mono",children:["#",c.slug]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1 text-zinc-900 dark:text-zinc-100",children:c.title}),e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 line-clamp-2 mb-4 flex-1",children:c.description||"No description"}),e.jsx("div",{className:"text-xs text-zinc-400 font-medium",children:"Click to manage items â†’"})]})},c.id)),e.jsxs("div",{className:"border-2 border-dashed border-zinc-200 rounded-lg p-6 flex flex-col items-center justify-center text-zinc-400 hover:bg-zinc-50 hover:border-zinc-300 transition cursor-pointer min-h-[200px]",onClick:a,children:[e.jsx(Z,{size:32}),e.jsx("span",{className:"mt-2 text-sm font-medium",children:"Create Collection"})]})]})}function te({images:t,onSelect:a,selectedId:c}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(r=>e.jsxs("div",{onClick:()=>a(r),className:`bg-white dark:bg-zinc-900 rounded border aspect-square relative group cursor-pointer overflow-hidden ${c===r.id?"ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-zinc-900":"hover:border-zinc-300 dark:hover:border-zinc-600 border-zinc-200 dark:border-zinc-800"}`,children:[e.jsx("img",{src:r.fileUrl,alt:r.title,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:r.title||r.originalName}),e.jsx("p",{className:"text-white/80 text-xs",children:$(r.sizeBytes)})]})]},r.id))})}function se({item:t,type:a,onClose:c,onUpdate:r}){const[m,g]=o.useState(t.title||t.originalName||""),[j,b]=o.useState(t.description||""),[d,u]=o.useState(t.tags||[]),[l,k]=o.useState(""),[S,p]=o.useState(!1),[f,C]=o.useState(t.accessLevel||"members"),[N,U]=o.useState(t.posterUrl||""),[T,x]=o.useState(!1);o.useEffect(()=>{g(t.title||t.originalName||""),b(t.description||""),u(t.tags||[]),a==="video"&&(C(t.accessLevel||"members"),U(t.posterUrl||"")),k("")},[t,a]);const z=s=>{s.key==="Enter"&&l.trim()&&(s.preventDefault(),d.includes(l.trim())||u([...d,l.trim()]),k(""))},w=s=>{u(d.filter(i=>i!==s))},v=async s=>{x(!0);try{const i=await window.Clerk?.session?.getToken(),n=new FormData;n.append("file",s);const h=await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:n});if(!h.ok)throw new Error("Upload failed");const y=await h.json();U(y.url)}catch(i){console.error(i),L.error("Poster upload failed")}finally{x(!1)}},P=async()=>{p(!0);try{const s=await window.Clerk?.session?.getToken(),i=a==="video"?`/video-management/${t.id}`:`/uploads/images/${t.id}`,n={title:m,description:j,tags:d};a==="video"&&(n.accessLevel=f,n.posterUrl=N),await I(i,s,{method:"PATCH",body:JSON.stringify(n)}),r(),L.success("Changes saved.")}catch(s){console.error(s),L.error("Failed to save changes.")}finally{p(!1)}};return e.jsxs("div",{className:"w-80 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 shadow-xl flex flex-col overflow-hidden animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-800/50",children:[e.jsxs("span",{className:"font-semibold text-sm uppercase text-zinc-500 dark:text-zinc-400 tracking-wide",children:[a," Details"]}),e.jsx("button",{onClick:c,className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:e.jsx(O,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"aspect-video bg-zinc-100 rounded-lg overflow-hidden border border-zinc-200 flex items-center justify-center relative group",children:[a==="image"?e.jsx("img",{src:t.fileUrl,className:"w-full h-full object-contain"}):N?e.jsx("img",{src:N,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-2 text-zinc-400",children:[e.jsx(A,{size:24}),e.jsx("span",{className:"text-xs",children:"No preview available"})]}),a==="video"&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>s.target.files?.[0]&&v(s.target.files[0]),disabled:T}),e.jsxs("span",{className:"text-white text-xs font-medium flex items-center gap-2",children:[T?e.jsx(G,{className:"animate-spin",size:16}):e.jsx(D,{size:16}),"Change Poster"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-zinc-500",children:[e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Size"}),$(t.sizeBytes)]}),e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Created"}),new Date(t.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:m,onChange:s=>g(s.target.value),className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Description"}),e.jsx("textarea",{value:j,onChange:s=>b(s.target.value),rows:3,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Tags / Labels"}),e.jsxs("div",{className:"min-h-[40px] p-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-800 flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-black dark:focus-within:ring-white focus-within:border-transparent",children:[d.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 px-2 py-1 rounded text-xs font-medium",children:[s,e.jsx("button",{onClick:()=>w(s),className:"hover:text-red-500",children:e.jsx(O,{size:10})})]},s)),e.jsx("input",{type:"text",value:l,onChange:s=>k(s.target.value),onKeyDown:z,placeholder:d.length===0?"Type and enter...":"",className:"flex-1 min-w-[60px] text-sm outline-none bg-transparent dark:text-white"})]}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Press Enter to add tag"})]}),a==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Access Level"}),e.jsxs("select",{value:f,onChange:s=>C(s.target.value),className:"w-full px-2 py-2 border border-zinc-200 rounded-lg text-sm outline-none",children:[e.jsx("option",{value:"public",children:"Public (Everyone)"}),e.jsx("option",{value:"members",children:"Members Only (Logged In)"}),e.jsx("option",{value:"private",children:"Private (Admin Only)"})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800/50",children:e.jsx("button",{onClick:P,disabled:S,className:"w-full bg-black dark:bg-zinc-100 text-white dark:text-zinc-900 py-2 rounded-lg font-medium text-sm hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 flex items-center justify-center gap-2",children:S?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:16})," Save Usage"]})})})]})}export{ze as default};
