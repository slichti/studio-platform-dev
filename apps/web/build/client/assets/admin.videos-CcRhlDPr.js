import{w as H,c as Q,f as X,u as Y,l as K,r as i}from"./chunk-JMJ3UQ3L-ksN8Xei4.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as T}from"./api-D1U4i9fn.js";import{a as f}from"./format-CAsSOgDD.js";import{U}from"./upload-77ZO6Xn8.js";import{F as W}from"./film-n2d5Pf9a.js";import{c as V}from"./createLucideIcon-mmuW3u_I.js";import{S as Z}from"./search-DZVNsIso.js";import{P as ee}from"./play-DkuwlKwK.js";import{E as te}from"./eye-BNIc8jm_.js";import{T as A}from"./trash-2-DGlI0wOF.js";import{C as I}from"./circle-check-big-DTYMKqtr.js";import{X as P}from"./x-BxAStoFO.js";import{R as D}from"./refresh-cw-DPe9nnG0.js";import{C as se}from"./circle-alert-B8xnZYlA.js";const ne=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ie=V("funnel",ne);const ae=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],re=V("monitor-play",ae),we=H(function(){const{videos:j,stats:o,brandingAssets:x,tenants:g}=Q(),v=X(),[N,m]=Y(),p=N.get("tab")||"videos",F=K(),[y,M]=i.useState(N.get("q")||""),[h,O]=i.useState(""),[s,u]=i.useState(null),[B,b]=i.useState(!1),[c,z]=i.useState(""),[r,d]=i.useState("vod"),[w,S]=i.useState(!1),[R,l]=i.useState(null),$=t=>{t.preventDefault(),m(n=>(n.set("q",y),n))},_=t=>{confirm("Are you sure you want to force delete this video? This cannot be undone.")&&v({intent:"delete_video",id:t},{method:"post"})},E=t=>{confirm("Are you sure you want to delete this branding asset?")&&v({intent:"delete_branding",id:t},{method:"post"})},q=async t=>{if(!c)return alert("Please select a tenant");S(!0),l("Getting upload URL...");try{const n=await window.Clerk?.session?.getToken(),L=await T("/admin/videos/upload-url",n,{method:"POST",body:JSON.stringify({targetTenantId:c,type:r})}),{uploadUrl:J,uid:G}=L;l("Uploading to Cloudflare...");const C=new FormData;if(C.append("file",t),!(await fetch(J,{method:"POST",body:C})).ok)throw new Error("Upload to video server failed");l("Registering asset..."),await T("/admin/videos",n,{method:"POST",body:JSON.stringify({targetTenantId:c,type:r,title:t.name,cloudflareStreamId:G,description:"Uploaded by Admin"})}),l("Done!"),b(!1),F.revalidate(),z(""),d("vod")}catch(n){console.error(n),alert("Upload failed: "+n.message)}finally{S(!1),l(null)}},k=j.filter(t=>!(h&&t.tenantId!==h));return e.jsxs("div",{className:"space-y-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Platform Video Management"}),e.jsx("p",{className:"text-zinc-500",children:"Monitor storage usage and manage video assets across all studios."})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 transition flex items-center gap-2",children:[e.jsx(U,{size:16}),"Upload Asset"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Total Videos"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:o.totalVideos})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Total Storage"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:f(o.totalStorageBytes)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Processing"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:o.processingCount})]})]}),e.jsxs("div",{className:"border-b border-zinc-200 flex flex-col md:flex-row md:items-center justify-between gap-4 pb-0",children:[e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>m({tab:"videos"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${p==="videos"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e.jsx(W,{size:16}),"Studio Videos",e.jsx("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:j.length})]}),e.jsxs("button",{onClick:()=>m({tab:"branding"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${p==="branding"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e.jsx(re,{size:16}),"Branding Assets",e.jsx("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:x.length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 md:pb-0",children:[e.jsxs("form",{onSubmit:$,className:"relative",children:[e.jsx(Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"search",placeholder:"Search videos...",value:y,onChange:t=>M(t.target.value),className:"pl-9 pr-4 py-2 border border-zinc-200 rounded-lg text-sm w-64 focus:ring-2 focus:ring-black focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:h,onChange:t=>O(t.target.value),className:"pl-3 pr-8 py-2 border border-zinc-200 rounded-lg text-sm appearance-none bg-white focus:ring-2 focus:ring-black focus:border-transparent outline-none cursor-pointer",children:[e.jsx("option",{value:"",children:"All Tenants"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(ie,{className:"absolute right-2.5 top-2.5 h-4 w-4 text-zinc-400 pointer-events-none"})]})]})]}),p==="videos"?e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200 text-zinc-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Video"}),e.jsx("th",{className:"px-4 py-3",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[k.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50/50 group",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-zinc-100 rounded flex items-center justify-center text-zinc-400 cursor-pointer hover:bg-zinc-200 hover:text-zinc-600 transition",onClick:()=>u(t),children:e.jsx(ee,{size:16,fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.title||"Untitled"}),e.jsx("div",{className:"text-xs text-zinc-400 font-mono",children:t.id})]})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-zinc-900",children:t.tenantName}),e.jsx("div",{className:"text-xs text-zinc-500",children:t.tenantSlug})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(le,{status:t.status})}),e.jsx("td",{className:"px-4 py-3 text-zinc-600 font-mono",children:f(t.sizeBytes)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>u(t),className:"p-1 text-zinc-400 hover:text-blue-600 hover:bg-blue-50 rounded transition",title:"Preview",children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:()=>_(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e.jsx(A,{size:16})})]})})]},t.id)),k.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-zinc-500",children:"No videos found matching your filters."})})]})]})}):e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200 text-zinc-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Asset Title"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3",children:"Active"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[x.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.title}),e.jsx("div",{className:"text-xs text-zinc-400 font-mono truncate max-w-[150px]",children:t.cloudflareStreamId})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize ${t.type==="intro"?"bg-indigo-100 text-indigo-700":"bg-purple-100 text-purple-700"}`,children:t.type})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-zinc-900",children:t.tenantName}),e.jsx("div",{className:"text-xs text-zinc-500",children:t.tenantSlug})]}),e.jsx("td",{className:"px-4 py-3 text-zinc-600 font-mono",children:t.active?e.jsxs("span",{className:"text-emerald-600 flex items-center gap-1 text-xs font-semibold",children:[e.jsx(I,{size:12})," Yes"]}):e.jsx("span",{className:"text-zinc-400 text-xs",children:"No"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>E(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e.jsx(A,{size:16})})})]},t.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-zinc-500",children:"No branding assets found."})})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Upload to Tenant"}),e.jsx("button",{onClick:()=>b(!1),className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(P,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Target Tenant"}),e.jsxs("select",{className:"w-full rounded-lg border-zinc-200 text-sm",value:c,onChange:t=>z(t.target.value),children:[e.jsx("option",{value:"",children:"Select a tenant..."}),g.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.slug,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Asset Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>d("vod"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="vod"?"bg-zinc-900 text-white border-zinc-900":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Video (VOD)"}),e.jsx("button",{onClick:()=>d("intro"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="intro"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Intro"}),e.jsx("button",{onClick:()=>d("outro"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="outro"?"bg-purple-600 text-white border-purple-600":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"File"}),e.jsxs("div",{className:"border-2 border-dashed border-zinc-200 rounded-lg p-8 text-center hover:bg-zinc-50 transition cursor-pointer relative",children:[e.jsx("input",{type:"file",accept:"video/*",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:w,onChange:t=>t.target.files?.[0]&&q(t.target.files[0])}),w?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(D,{className:"animate-spin text-zinc-400"}),e.jsx("span",{className:"text-sm text-zinc-500",children:R})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-zinc-100 rounded-full flex items-center justify-center text-zinc-400",children:e.jsx(U,{size:20})}),e.jsx("span",{className:"text-sm text-zinc-600 font-medium",children:"Click to select video"}),e.jsx("span",{className:"text-xs text-zinc-400",children:"MP4, MOV, etc."})]})]})]})]})]})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-black rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-zinc-800",children:[e.jsx("h2",{className:"text-lg font-bold text-white max-w-2xl truncate",children:s.title}),e.jsx("button",{onClick:()=>u(null),className:"text-zinc-400 hover:text-white",children:e.jsx(P,{size:24})})]}),e.jsx("div",{className:"flex-1 bg-black aspect-video relative",children:s.cloudflareStreamId?e.jsx("iframe",{src:`https://iframe.videodelivery.net/${s.cloudflareStreamId}`,className:"w-full h-full absolute inset-0",allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0}):e.jsx("div",{className:"flex items-center justify-center h-full text-zinc-500",children:"Video not available"})}),e.jsxs("div",{className:"p-4 bg-zinc-900 border-t border-zinc-800 text-sm text-zinc-400 flex gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Duration"}),s.duration?Math.floor(s.duration/60)+"m "+s.duration%60+"s":"--"]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Size"}),f(s.sizeBytes)]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Status"}),e.jsx("span",{className:"capitalize",children:s.status})]})]})]})})]})});function le({status:a}){return a==="ready"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:[e.jsx(I,{size:12})," Ready"]}):a==="processing"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:[e.jsx(D,{size:12,className:"animate-spin"})," Processing"]}):a==="error"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(se,{size:12})," Error"]}):e.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-zinc-100 text-zinc-700",children:a})}export{we as default};
