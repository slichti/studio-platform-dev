import{w as R,e as T,d as L,L as E}from"./chunk-JMJ3UQ3L-D6qeZyod.js";import{j as e}from"./vendor-puck-C9fWOLBg.js";import{a as r}from"./vendor-sentry-D-95zPX-.js";import{a as l}from"./api-D1U4i9fn.js";import{F as O}from"./funnel-D5Z6zlS8.js";import{L as I}from"./loader-circle-CJPIXIyf.js";import{T as A}from"./trash-2-BbVhgg9k.js";import{S as B}from"./save-Ckn4PCZ8.js";import{R as F,B as P,C as Q,X as $,Y as q,T as K,L as M,a as v}from"./vendor-charts-6YCMhHKl.js";import{C as _}from"./chart-column-Bvs9n0u2.js";import"./createLucideIcon-Qes_Sb9D.js";const re=R(function(){const{tenant:J}=T()||{},{slug:y}=L(),[h,k]=r.useState([]),[f,g]=r.useState(!1),[i,m]=r.useState(["revenue"]),[c,x]=r.useState(["date"]),[n,d]=r.useState({start:"",end:""}),[b,N]=r.useState(""),[a,z]=r.useState(null),[p,j]=r.useState("");r.useEffect(()=>{u();const s=new Date,t=new Date;t.setDate(s.getDate()-30),d({start:t.toISOString().split("T")[0],end:s.toISOString().split("T")[0]})},[]);const u=async()=>{const s=await window.Clerk?.session?.getToken();try{const t=await l("/reports/custom",s);k(t.reports||[])}catch(t){console.error("Failed to load reports",t)}},w=async()=>{g(!0);const s=await window.Clerk?.session?.getToken();try{const t=await l("/reports/custom/query",s,{method:"POST",body:JSON.stringify({metrics:i,dimensions:c,filters:{startDate:n.start,endDate:n.end,instructorId:b||void 0}})});z(t)}catch(t){console.error(t),alert("Query failed")}finally{g(!1)}},S=async()=>{if(!p)return alert("Enter a name");const s=await window.Clerk?.session?.getToken();try{await l("/reports/custom",s,{method:"POST",body:JSON.stringify({name:p,config:{metrics:i,dimensions:c,filters:{startDate:n.start,endDate:n.end,instructorId:b}}})}),j(""),u()}catch(t){console.error(t)}},C=s=>{const t=s.config;t.metrics&&m(t.metrics),t.dimensions&&x(t.dimensions),t.filters&&(d({start:t.filters.startDate?new Date(t.filters.startDate).toISOString().split("T")[0]:"",end:t.filters.endDate?new Date(t.filters.endDate).toISOString().split("T")[0]:""}),N(t.filters.instructorId||""))},D=async(s,t)=>{if(t.stopPropagation(),!confirm("Delete report?"))return;const o=await window.Clerk?.session?.getToken();await l(`/reports/custom/${s}`,o,{method:"DELETE"}),u()};return e.jsxs("div",{className:"p-8 max-w-7xl mx-auto min-h-screen",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 mb-1",children:[e.jsx(E,{to:`/studio/${y}/reports`,className:"hover:underline",children:"Analytics"}),e.jsx("span",{children:"/"}),e.jsx("span",{children:"Custom Query"})]}),e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Custom Report Builder"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(O,{size:16})," Query Options"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Metrics"}),e.jsx("div",{className:"space-y-2",children:["revenue","attendance"].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i.includes(s),onChange:t=>{t.target.checked?m([...i,s]):m(i.filter(o=>o!==s))},className:"rounded border-zinc-300 text-brand-600 focus:ring-brand-500"}),e.jsx("span",{className:"capitalize",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Group By"}),e.jsx("div",{className:"space-y-2",children:["date","instructor"].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:c.includes(s),onChange:t=>{t.target.checked?x([...c,s]):x(c.filter(o=>o!==s))}}),e.jsx("span",{className:"capitalize",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"date",value:n.start,onChange:s=>d({...n,start:s.target.value}),className:"w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"}),e.jsx("input",{type:"date",value:n.end,onChange:s=>d({...n,end:s.target.value}),className:"w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"})]})]}),e.jsxs("button",{onClick:w,disabled:f,className:"w-full py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg font-medium hover:opacity-90 flex justify-center items-center gap-2",children:[f&&e.jsx(I,{size:16,className:"animate-spin"}),"Run Query"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-4 text-sm",children:"Saved Reports"}),e.jsxs("div",{className:"space-y-2",children:[h.map(s=>e.jsxs("div",{onClick:()=>C(s),className:"p-3 bg-zinc-50 dark:bg-zinc-800 rounded-lg cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-700 group flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsx("button",{onClick:t=>D(s.id,t),className:"text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(A,{size:12})})]},s.id)),h.length===0&&e.jsx("p",{className:"text-xs text-zinc-500",children:"No saved reports."})]})]})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Results"}),a&&e.jsxs("div",{className:"flex gap-4 text-sm text-zinc-500",children:[a.summary.revenue!==void 0&&e.jsxs("span",{children:["Revenue: ",e.jsxs("b",{children:["$",a.summary.revenue.toFixed(2)]})]}),a.summary.attendance!==void 0&&e.jsxs("span",{children:["Attendance: ",e.jsx("b",{children:a.summary.attendance})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Report Name",value:p,onChange:s=>j(s.target.value),className:"px-3 py-1.5 rounded border border-zinc-300 dark:border-zinc-700 bg-transparent text-sm"}),e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 rounded text-sm font-medium",children:[e.jsx(B,{size:14})," Save"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm min-h-[400px]",children:a&&a.chartData&&a.chartData.length>0?e.jsx(F,{width:"100%",height:400,children:e.jsxs(P,{data:a.chartData,children:[e.jsx(Q,{strokeDasharray:"3 3",vertical:!1,stroke:"#E4E4E7"}),e.jsx($,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12},dy:10,tickFormatter:s=>s.length>10?new Date(s).toLocaleDateString():s}),e.jsx(q,{axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12}}),e.jsx(K,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(M,{}),i.includes("revenue")&&e.jsx(v,{dataKey:"revenue",fill:"#3B82F6",name:"Revenue ($)",radius:[4,4,0,0]}),i.includes("attendance")&&e.jsx(v,{dataKey:"attendance",fill:"#10B981",name:"Attendance",radius:[4,4,0,0]})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-400",children:[e.jsx(_,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{children:"Run a query to see results"})]})})]})]})]})});export{re as default};
