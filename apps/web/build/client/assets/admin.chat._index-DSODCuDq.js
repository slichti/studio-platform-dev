import{w as b,u as x,L as g}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as o}from"./api-ChCisjdG.js";import{a as u}from"./vendor-sentry-DugYw-Ne.js";import{t as j}from"./index-CNiSO0Vl.js";import{M as z}from"./message-circle-BZuCfo3t.js";import{S as m}from"./shield-RaNuRJix.js";import{f as N}from"./vendor-date-fns-0CaSm0ev.js";import"./createLucideIcon-BOpDDQ2B.js";const R=b(function(){const{tenants:i,tickets:h,error:n}=x(),d=h||[];x();const[c,l]=u.useState({}),p=async s=>{l(t=>({...t,[s.id]:!0}));try{const t=await window.Clerk.session.getToken(),r=await o("/chat/rooms?type=support",t,{headers:{"X-Tenant-Slug":s.slug}});let a;r&&r.length>0?a=r[0].id:a=(await o("/chat/rooms",t,{method:"POST",headers:{"X-Tenant-Slug":s.slug},body:JSON.stringify({type:"support",name:"Platform Support",metadata:{createdBy:"admin"}})})).id,window.location.href=`/admin/chat/${a}`}catch(t){j.error("Failed to open support chat: "+t),l(r=>({...r,[s.id]:!1}))}};return n?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",children:["Error: ",n]})}):e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(z,{className:"text-blue-600"}),"Chat System"]}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Manage tenant chat rooms and platform support"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(m,{className:"text-indigo-600 dark:text-indigo-400",size:20}),"Support Inbox (Open)"]}),e.jsxs("div",{className:"text-sm text-zinc-500",children:[d.length," open tickets"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden shadow-sm",children:d.length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400",children:"No open support tickets found. Great job!"}):e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-100 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-medium",children:"Tenant"}),e.jsx("th",{className:"p-4 font-medium",children:"Subject"}),e.jsx("th",{className:"p-4 font-medium",children:"Priority"}),e.jsx("th",{className:"p-4 font-medium",children:"Status"}),e.jsx("th",{className:"p-4 font-medium",children:"Assigned"}),e.jsx("th",{className:"p-4 font-medium",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-zinc-50 group",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:s.tenantName}),e.jsxs("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:["ID: ",s.tenantId?.slice(0,8)]})]}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"text-zinc-900 dark:text-zinc-100",children:s.name}),e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:N(new Date(s.createdAt),"MMM d, yyyy")})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize
                                            ${s.priority==="urgent"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":s.priority==="high"?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:s.priority||"normal"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs font-medium capitalize",children:s.status||"open"})}),e.jsx("td",{className:"p-4 text-zinc-500 dark:text-zinc-400",children:s.assignedToId?"Agent":"Unassigned"}),e.jsx("td",{className:"p-4",children:e.jsx(g,{to:`/admin/chat/${s.id}`,className:"px-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm font-medium hover:bg-zinc-50 dark:hover:bg-zinc-700 text-indigo-600 dark:text-indigo-400",children:"Open"})})]},s.id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("div",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:i?.length||0}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Total Tenants"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:i?.filter(s=>Array.isArray(s.features)&&s.features.includes("chat"))?.length||0}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"With Chat Enabled"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:d.length}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Open Tickets"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:"—"}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Messages Today"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:"Tenant Chat Rooms"}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"Real-time via Durable Objects"})]}),i.length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400",children:"No tenants available"}):e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:i.slice(0,50).map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg flex items-center justify-center font-medium",children:s.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-500 dark:text-zinc-400",children:[e.jsx("span",{children:s.slug}),Array.isArray(s.features)&&s.features.includes("chat")&&e.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-[10px] font-bold",children:"CHAT ACTIVE"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>p(s),disabled:c[s.id],className:"flex items-center gap-1 px-3 py-1.5 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg disabled:opacity-50",children:[e.jsx(m,{size:14}),c[s.id]?"Opening...":"Support"]})})]},s.id))})]}),e.jsxs("div",{className:"mt-8 bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-300 mb-2",children:"Chat System Features"}),e.jsxs("ul",{className:"text-sm text-purple-800 dark:text-purple-300 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Durable Objects:"})," Real-time WebSocket connections with SQLite persistence"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Room Types:"})," Support, Class, Community, Direct messaging"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"User Presence:"})," Live online/offline status tracking"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Message History:"})," Full persistence to D1 database"]})]})]})]})});export{R as default};
