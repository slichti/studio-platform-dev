import{j as s}from"./vendor-puck-aUaaDwmz.js";import{a}from"./vendor-livekit-D3VpklN2.js";import{d as w,b as k}from"./chunk-EPOLDU6W-CxxYD-cd.js";import{a as S}from"./api-D1U4i9fn.js";import{S as N}from"./search-CmzwqIX4.js";import{L as E}from"./loader-circle-BQZLkmRD.js";import{X as $}from"./x-Cbj0htte.js";import{U as C}from"./user-CEO84Ozr.js";import{c as D}from"./createLucideIcon-CcD9UNCP.js";import{S as L}from"./shopping-cart-CYipMUhk.js";const R=[["path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z",key:"9m4mmf"}],["path",{d:"m2.5 21.5 1.4-1.4",key:"17g3f0"}],["path",{d:"m20.1 3.9 1.4-1.4",key:"1qn309"}],["path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z",key:"1t2c92"}],["path",{d:"m9.6 14.4 4.8-4.8",key:"6umqxw"}]],T=D("dumbbell",R);function P({token:x}){const[i,o]=a.useState(!1),[n,b]=a.useState(""),[l,f]=a.useState({students:[],classes:[],orders:[]}),[g,y]=a.useState(!1),[r,m]=a.useState(0),{slug:d}=w(),h=k(),j=a.useRef(null),c=[...l.students.map(e=>({...e,type:"student"})),...l.classes.map(e=>({...e,type:"class"})),...l.orders.map(e=>({...e,type:"order"}))];a.useEffect(()=>{const e=t=>{t.key==="k"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),o(u=>!u)),t.key==="Escape"&&o(!1),i&&(t.key==="ArrowDown"&&(t.preventDefault(),m(u=>(u+1)%Math.max(1,c.length))),t.key==="ArrowUp"&&(t.preventDefault(),m(u=>(u-1+c.length)%Math.max(1,c.length))),t.key==="Enter"&&c[r]&&(t.preventDefault(),v(c[r].type,c[r])))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[i,c,r]),a.useEffect(()=>{const e=()=>o(!0);return window.addEventListener("open-command-bar",e),()=>window.removeEventListener("open-command-bar",e)},[]),a.useEffect(()=>{i&&(setTimeout(()=>j.current?.focus(),10),b(""),f({students:[],classes:[],orders:[]}))},[i]),a.useEffect(()=>{if(!n||n.length<2){f({students:[],classes:[],orders:[]});return}const e=setTimeout(async()=>{y(!0);try{const t=await S(`/tenant/search?q=${n}`,x,{headers:{"X-Tenant-Slug":d}});f(t),m(0)}catch(t){console.error("Search failed",t)}finally{y(!1)}},300);return()=>clearTimeout(e)},[n,d,x]);const v=(e,t)=>{o(!1),e==="student"&&h(`/studio/${d}/students/${t.id}`),e==="class"&&h(`/studio/${d}/classes/${t.id}`),e==="order"&&h(`/studio/${d}/pos`)};if(!i)return null;const z=[...l.students.map(e=>({...e,type:"student"})),...l.classes.map(e=>({...e,type:"class"})),...l.orders.map(e=>({...e,type:"order"}))];return s.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[15vh] px-4 backdrop-blur-sm bg-zinc-900/50 animate-in fade-in duration-200",children:s.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[60vh] animate-in zoom-in-95 duration-200",children:[s.jsxs("div",{className:"flex items-center px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:[s.jsx(N,{className:"h-5 w-5 text-zinc-400 mr-3"}),s.jsx("input",{ref:j,type:"text",placeholder:"Search students, classes, or orders...",value:n,onChange:e=>b(e.target.value),className:"flex-1 bg-transparent border-none outline-none text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-500 text-base"}),s.jsxs("div",{className:"flex items-center gap-2",children:[g&&s.jsx(E,{className:"h-4 w-4 text-zinc-400 animate-spin"}),s.jsx("button",{onClick:()=>o(!1),className:"p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded",children:s.jsx($,{className:"h-4 w-4 text-zinc-400"})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[n.length<2&&s.jsxs("div",{className:"p-8 text-center text-zinc-500",children:[s.jsx(M,{}),s.jsx("p",{className:"text-sm mt-2",children:"Type at least 2 characters to search..."})]}),n.length>=2&&z.length===0&&!g&&s.jsx("div",{className:"p-8 text-center text-zinc-500",children:s.jsxs("p",{className:"text-sm",children:['No results found for "',n,'"']})}),s.jsx("div",{className:"space-y-1",children:z.map((e,t)=>s.jsxs("button",{onClick:()=>v(e.type,e),onMouseEnter:()=>m(t),className:`w-full flex items-center gap-4 px-3 py-2.5 rounded-xl transition-all text-left ${r===t?"bg-blue-600 text-white shadow-lg shadow-blue-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[s.jsxs("div",{className:`p-2 rounded-lg ${r===t?"bg-white/20":"bg-zinc-100 dark:bg-zinc-800"}`,children:[e.type==="student"&&s.jsx(C,{size:18}),e.type==="class"&&s.jsx(T,{size:18}),e.type==="order"&&s.jsx(L,{size:18})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"font-bold text-sm truncate",children:[e.type==="student"?`${e.name?.firstName||"Student"} ${e.name?.lastName||""}`:e.title||e.name,e.type==="order"&&`Order #${e.id.substring(0,8)}`]}),s.jsxs("div",{className:"text-[10px] uppercase font-bold tracking-tight opacity-70",children:[e.type," • ",e.email||e.category||`$${(e.totalAmount/100).toFixed(2)}`]})]}),s.jsx("div",{className:"text-[10px] opacity-40 font-mono",children:r===t?"Enter":""})]},e.id))})]}),s.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-zinc-900 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between text-[10px] text-zinc-400 font-medium",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(p,{children:"CMD"})," + ",s.jsx(p,{children:"K"})," Toggle"]}),s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(p,{children:"↑↓"})," Navigate"]}),s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(p,{children:"Enter"})," Select"]})]}),s.jsx("span",{children:"Zenflow Search Engine"})]})]})})}function p({children:x}){return s.jsx("kbd",{className:"px-1.5 py-0.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded text-[9px] font-sans antialiased text-zinc-500",children:x})}function M(){return s.jsxs("div",{className:"relative w-10 h-10 mx-auto opacity-20",children:[s.jsx(N,{className:"absolute inset-0 w-full h-full text-zinc-400"}),s.jsx("div",{className:"absolute inset-x-0 bottom-0 h-0.5 bg-zinc-400 animate-pulse"})]})}export{P as C,T as D};
