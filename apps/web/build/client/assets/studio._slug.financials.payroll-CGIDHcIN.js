import{w as y,v as j,r as o,H as f}from"./chunk-JMJ3UQ3L-DmAaMJDT.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as h}from"./api-piI5qlNr.js";import{C as g}from"./calendar-CdZAn42y.js";import{S as N}from"./settings-CUTABKJc.js";import{C as u}from"./circle-check-big-DNnVcxgB.js";import{D as w}from"./dollar-sign-bVP3i--W.js";import"./createLucideIcon-DBCK0g1u.js";const F=y(function(){const{configs:a,token:i,slug:c}=j(),[s,r]=o.useState("run");return e.jsxs("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 mb-2",children:"Payroll & Payouts"}),e.jsx("p",{className:"text-zinc-500 mb-8",children:"Manage instructor compensation and record payouts."}),e.jsx("div",{className:"border-b border-zinc-200 mb-8",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>r("run"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${s==="run"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(g,{className:"h-4 w-4"}),"Run Payroll"]}),e.jsxs("button",{onClick:()=>r("config"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${s==="config"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(N,{className:"h-4 w-4"}),"Configuration"]}),e.jsxs("button",{onClick:()=>r("history"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${s==="history"?"border-blue-500 text-blue-600":"border-transparent text-zinc-500 hover:text-zinc-700 hover:border-zinc-300"}`,children:[e.jsx(u,{className:"h-4 w-4"}),"Payout History"]})]})}),s==="config"&&e.jsx(v,{configs:a,token:i,slug:c}),s==="run"&&e.jsx(S,{token:i,slug:c}),s==="history"&&e.jsx("div",{className:"text-zinc-500 italic",children:"History feature coming soon."})]})});function v({configs:t,token:a,slug:i}){const[c,s]=o.useState(t);return e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-zinc-200",children:[e.jsx("thead",{className:"bg-zinc-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Instructor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Pay Model"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Rate"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-zinc-200",children:[c.map(r=>e.jsx(z,{config:r,token:a,slug:i},r.id)),c.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"px-6 py-4 text-center text-sm text-zinc-500",children:["No configurations found. ",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:" (In MVP, you need to seed configs or use API to create them first, as UI to add new is skipped for brevity)"})]})})]})]})}),e.jsx("p",{className:"mt-4 text-sm text-zinc-500",children:"* Note: Rates for percentage model are in basis points (5000 = 50%). Flat rates are in cents."})]})}function z({config:t,token:a,slug:i}){const[c,s]=o.useState(!1),[r,d]=o.useState(t.payModel),[x,m]=o.useState(t.rate);f();async function p(){try{await h("/payroll/config",a,{method:"PUT",headers:{"X-Tenant-Slug":i},body:JSON.stringify({memberId:t.memberId,payModel:r,rate:Number(x)})}),s(!1)}catch{alert("Failed to save")}}return c?e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-900",children:[t.member?.user?.profile?.firstName," ",t.member?.user?.profile?.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("select",{value:r,onChange:n=>d(n.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"flat",children:"Flat Rate (per session)"}),e.jsx("option",{value:"hourly",children:"Hourly Rate"}),e.jsx("option",{value:"percentage",children:"Percentage (Revenue Share)"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("input",{type:"number",value:x,onChange:n=>m(n.target.value),className:"border rounded px-2 py-1 w-24"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:[e.jsx("button",{onClick:p,className:"text-blue-600 hover:text-blue-900 mr-3",children:"Save"}),e.jsx("button",{onClick:()=>s(!1),className:"text-zinc-600 hover:text-zinc-900",children:"Cancel"})]})]}):e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-zinc-900",children:[t.member?.user?.profile?.firstName," ",t.member?.user?.profile?.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500 capitalize",children:t.payModel}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500",children:[t.rate," ",t.payModel==="percentage"?"bps":"cents"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>s(!0),className:"text-blue-600 hover:text-blue-900",children:"Edit"})})]})}function S({token:t,slug:a}){const[i,c]=o.useState(new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0]),[s,r]=o.useState(new Date().toISOString().split("T")[0]),[d,x]=o.useState(null),[m,p]=o.useState(!1);async function n(){p(!0);try{const l=await h(`/payroll/report?start=${i}&end=${s}`,t,{headers:{"X-Tenant-Slug":a}});x(l.report)}catch(l){console.error(l)}finally{p(!1)}}return e.jsxs("div",{children:[e.jsxs("div",{className:"bg-zinc-50 p-4 rounded-lg flex gap-4 items-end mb-8 border border-zinc-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Period Start"}),e.jsx("input",{type:"date",value:i,onChange:l=>c(l.target.value),className:"border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Period End"}),e.jsx("input",{type:"date",value:s,onChange:l=>r(l.target.value),className:"border rounded px-3 py-2 text-sm"})]}),e.jsx("button",{onClick:n,disabled:m,className:"bg-zinc-900 text-white px-4 py-2 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:m?"Calculating...":"Calculate Payroll"})]}),d&&e.jsxs("div",{className:"space-y-6",children:[Object.keys(d).length===0&&e.jsx("p",{className:"text-zinc-500 text-center py-8",children:"No earnings found for this period."}),Object.entries(d).map(([l,b])=>e.jsx(C,{instructorId:l,data:b,token:t,slug:a,period:{start:i,end:s}},l))]})]})}function C({instructorId:t,data:a,token:i,slug:c,period:s}){const[r,d]=o.useState(!1),[x,m]=o.useState(!1);async function p(){if(confirm(`Mark $${a.total/100} as paid?`)){d(!0);try{await h("/payroll/payout",i,{method:"POST",headers:{"X-Tenant-Slug":c},body:JSON.stringify({instructorId:t,amount:a.total,periodStart:s.start,periodEnd:s.end,items:a.items})}),m(!0)}catch(n){alert("Failed to record payout: "+n.message)}finally{d(!1)}}}return e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-zinc-50 px-6 py-4 flex justify-between items-center border-b border-zinc-200",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Instructor ID: ",t.substring(0,8),"..."]}),e.jsxs("p",{className:"text-sm text-zinc-500",children:[a.items.length," items"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold font-mono text-zinc-900",children:["$",(a.total/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"Total Owing"})]})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-zinc-500 border-b border-zinc-100",children:[e.jsx("th",{className:"text-left py-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-2 font-medium",children:"Item"}),e.jsx("th",{className:"text-left py-2 font-medium",children:"Details"}),e.jsx("th",{className:"text-right py-2 font-medium",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-50",children:a.items.map((n,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 text-zinc-600",children:new Date(n.date).toLocaleDateString()}),e.jsx("td",{className:"py-2 font-medium text-zinc-900",children:n.title}),e.jsx("td",{className:"py-2 text-zinc-500 text-xs",children:n.details}),e.jsxs("td",{className:"py-2 text-right text-zinc-900",children:["$",(n.amount/100).toFixed(2)]})]},l))})]})}),e.jsx("div",{className:"px-6 py-4 bg-zinc-50 border-t border-zinc-200 flex justify-end",children:x?e.jsxs("span",{className:"flex items-center gap-2 text-green-600 font-medium px-4 py-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Payout Recorded"]}):e.jsxs("button",{onClick:p,disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md font-medium text-sm hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),r?"Recording...":"Mark as Paid"]})})]})}export{F as default};
