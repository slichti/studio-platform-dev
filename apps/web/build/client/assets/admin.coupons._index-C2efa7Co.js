import{w as j,u as y,g as v}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as i}from"./vendor-sentry-DugYw-Ne.js";import{a as f}from"./api-ChCisjdG.js";import{C as N}from"./Card-BmT-i1YJ.js";import{t as o}from"./index-CNiSO0Vl.js";import{f as _}from"./vendor-date-fns-0CaSm0ev.js";const $=j(function(){const{coupons:d,apiUrl:l,token:c,error:m}=y(),u=v(),[b,s]=i.useState(!1),[p,x]=i.useState(!1),[r,t]=i.useState({code:"",name:"",percent_off:"",amount_off:"",duration:"forever",duration_in_months:"",max_redemptions:"",redeem_by:""});if(m)return e.jsxs("div",{className:"p-8 text-red-500",children:["Error loading coupons: ",m]});const h=async n=>{n.preventDefault(),x(!0);try{const a={code:r.code,name:r.name||r.code,duration:r.duration};r.percent_off&&(a.percent_off=Number(r.percent_off)),r.amount_off&&(a.amount_off=Number(r.amount_off)*100),r.duration==="repeating"&&(a.duration_in_months=Number(r.duration_in_months)),r.max_redemptions&&(a.max_redemptions=Number(r.max_redemptions)),r.redeem_by&&(a.redeem_by=r.redeem_by),await f("/admin/coupons",c,{method:"POST",body:JSON.stringify(a)},l),o.success("Coupon created"),s(!1),t({code:"",name:"",percent_off:"",amount_off:"",duration:"forever",duration_in_months:"",max_redemptions:"",redeem_by:""}),u.revalidate()}catch(a){o.error(a.message||"Failed to create coupon")}finally{x(!1)}},g=async n=>{if(confirm("Are you sure? This cannot be undone."))try{await f(`/admin/coupons/${n}`,c,{method:"DELETE"},l),o.success("Coupon deleted"),u.revalidate()}catch(a){o.error(a.message)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Platform Coupons"}),e.jsx("p",{className:"text-zinc-500",children:"Manage Stripe discount codes for studio subscriptions."})]}),e.jsx("button",{onClick:()=>s(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition",children:"+ Create Coupon"})]}),e.jsx(N,{className:"overflow-hidden",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500",children:"Code / Name"}),e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500",children:"Discount"}),e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500",children:"Redemptions"}),e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500",children:"Created"}),e.jsx("th",{className:"px-6 py-3 font-medium text-zinc-500 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-zinc-500",children:"No coupons found. Create one to get started."})}):d.map(n=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-900/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-mono font-medium",children:n.name}),e.jsx("div",{className:"text-xs text-zinc-500",children:n.id})]}),e.jsx("td",{className:"px-6 py-4",children:n.percent_off?`${n.percent_off}%`:n.amount_off?`$${(n.amount_off/100).toFixed(2)}`:"Unknown"}),e.jsxs("td",{className:"px-6 py-4 capitalize",children:[n.duration," ",n.duration_in_months?`(${n.duration_in_months} mo)`:""]}),e.jsxs("td",{className:"px-6 py-4",children:[n.times_redeemed," ",n.max_redemptions?`/ ${n.max_redemptions}`:"(Unlimited)"]}),e.jsx("td",{className:"px-6 py-4",children:_(new Date(n.created*1e3),"MMM d, yyyy")}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>g(n.id),className:"text-red-600 hover:text-red-700 text-xs font-medium",children:"Delete"})})]},n.id))})]})}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-xl w-full max-w-md overflow-hidden ring-1 ring-zinc-200 dark:ring-zinc-800",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Create Platform Coupon"}),e.jsx("button",{onClick:()=>s(!1),className:"text-zinc-500 hover:text-zinc-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Code (ID)"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent uppercase font-mono",placeholder:"SUMMER2025",value:r.code,onChange:n=>t({...r,code:n.target.value.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name (Optional)"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",placeholder:"Summer Sale",value:r.name,onChange:n=>t({...r,name:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Discount Type"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",onChange:n=>{n.target.value==="percent"?t({...r,amount_off:""}):t({...r,percent_off:""})},children:[e.jsx("option",{value:"percent",children:"Percentage (%)"}),e.jsx("option",{value:"amount",children:"Fixed Amount ($)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Value"}),r.amount_off===""?e.jsx("input",{type:"number",placeholder:"%",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",value:r.percent_off,onChange:n=>t({...r,percent_off:n.target.value,amount_off:""})}):e.jsx("input",{type:"number",placeholder:"$",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",value:r.amount_off,onChange:n=>t({...r,amount_off:n.target.value,percent_off:""})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Duration"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",value:r.duration,onChange:n=>t({...r,duration:n.target.value}),children:[e.jsx("option",{value:"forever",children:"Forever"}),e.jsx("option",{value:"once",children:"Once"}),e.jsx("option",{value:"repeating",children:"Repeating"})]})]}),e.jsx("div",{children:r.duration==="repeating"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Months"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",value:r.duration_in_months,onChange:n=>t({...r,duration_in_months:n.target.value})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Max Redemptions"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",placeholder:"Unlimited",value:r.max_redemptions,onChange:n=>t({...r,max_redemptions:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Redeem By"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-transparent",value:r.redeem_by,onChange:n=>t({...r,redeem_by:n.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition disabled:opacity-50",children:p?"Creating...":"Create Coupon"})]})]})]})})]})});export{$ as default};
