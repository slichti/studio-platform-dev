import{w as M,c as B}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as r}from"./vendor-sentry-DugYw-Ne.js";import{a as x}from"./api-ChCisjdG.js";import{f,s as K}from"./vendor-date-fns-0CaSm0ev.js";import{C as w}from"./chart-column-C6B5Jh-f.js";import{L as P}from"./layers-B6QOmK5S.js";import{F as A}from"./funnel-KL8jZ-L9.js";import{C as X}from"./calendar-DJnC92HA.js";import{R as q}from"./refresh-cw-DnP96nUp.js";import{R as J,B as I,C as S,X as R,Y as C,T as D,L,b as g,c as W,d as z}from"./vendor-charts-BaZHU4KA.js";import{D as Q}from"./download-n7hfDIUv.js";import{S as U}from"./save-BsFOcTUD.js";import"./createLucideIcon-BOpDDQ2B.js";const me=()=>[{title:"Custom Reports | Studio Platform"}],ue=M(function(){const{me:Y,tenant:o}=B(),[j,y]=r.useState(!1),[i,T]=r.useState(null),[k,_]=r.useState([]),E=[{id:"revenue",label:"Revenue"},{id:"attendance",label:"Attendance"},{id:"new_signups",label:"New Signups"}],[t,m]=r.useState(["revenue"]),[c,u]=r.useState(["date"]),[p,v]=r.useState("bar"),[n,h]=r.useState({start:f(K(new Date),"yyyy-MM-dd"),end:f(new Date,"yyyy-MM-dd")}),[b,G]=r.useState({}),$=async()=>{try{const s=await x("/reports/custom/query",null,{method:"POST",body:JSON.stringify({metrics:t,dimensions:c,filters:{startDate:n.start,endDate:n.end,...b},format:"csv"}),headers:{"X-Tenant-Slug":o?.slug}}),a=new Blob([s],{type:"text/csv"}),d=window.URL.createObjectURL(a),l=document.createElement("a");l.href=d,l.download=`report-${f(new Date,"yyyy-MM-dd")}.csv`,document.body.appendChild(l),l.click(),l.remove()}catch(s){console.error("Export failed",s)}};r.useEffect(()=>{N()},[]);const N=async()=>{try{const s=await x("/reports/custom",null,{headers:{"X-Tenant-Slug":o?.slug}});s.reports&&_(s.reports)}catch(s){console.error("Failed to load saved reports",s)}},F=async()=>{y(!0);try{const s={metrics:t,dimensions:c,filters:{startDate:n.start,endDate:n.end,...b}},a=await x("/reports/custom/query",null,{method:"POST",body:JSON.stringify(s),headers:{"X-Tenant-Slug":o?.slug}});T(a)}catch(s){console.error("Query failed",s)}finally{y(!1)}},O=async s=>{try{return await x("/reports/custom",null,{method:"POST",body:JSON.stringify({name:s,config:{metrics:t,dimensions:c,dateRange:n,filters:b},isPublic:!1}),headers:{"X-Tenant-Slug":o?.slug}}),N(),!0}catch{return!1}};return e.jsxs("div",{className:"p-8 max-w-7xl mx-auto animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(w,{className:"text-blue-600"}),"Custom Report Builder"]}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Design ad-hoc queries and analyze studio performance."})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100 mb-4 flex items-center gap-2",children:[e.jsx(P,{size:16})," Metrics"]}),e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.includes(s.id),onChange:a=>{a.target.checked?m([...t,s.id]):m(t.filter(d=>d!==s.id))},className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"capitalize",children:s.label})]},s.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100 mb-4 flex items-center gap-2",children:[e.jsx(A,{size:16})," Dimensions"]}),e.jsx("div",{className:"space-y-2",children:["date","instructor","payment_method"].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.includes(s),onChange:a=>{a.target.checked?u([...c,s]):u(c.filter(d=>d!==s))},className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"capitalize",children:s.replace("_"," ")})]},s))})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-5 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100 mb-4 flex items-center gap-2",children:[e.jsx(X,{size:16})," Date Range"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-zinc-500 mb-1 block",children:"Start Date"}),e.jsx("input",{type:"date",value:n.start,onChange:s=>h({...n,start:s.target.value}),className:"w-full px-3 py-2 text-sm border border-zinc-200 dark:border-zinc-700 rounded-lg bg-zinc-50 dark:bg-zinc-950"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-zinc-500 mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",value:n.end,onChange:s=>h({...n,end:s.target.value}),className:"w-full px-3 py-2 text-sm border border-zinc-200 dark:border-zinc-700 rounded-lg bg-zinc-50 dark:bg-zinc-950"})]})]})]}),e.jsx("button",{onClick:F,disabled:j,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-blue-500/20 active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50",children:j?e.jsx(q,{className:"animate-spin",size:18}):"Run Report"}),k.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h4",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider mb-3",children:"Saved Reports"}),e.jsx("ul",{className:"space-y-2",children:k.map(s=>e.jsx("li",{className:"text-sm",children:e.jsx("button",{onClick:()=>{const a=typeof s.config=="string"?JSON.parse(s.config):s.config;m(a.metrics||[]),u(a.dimensions||[]),a.dateRange&&h(a.dateRange)},className:"text-zinc-600 dark:text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400 hover:underline text-left block w-full truncate",children:s.name})},s.id))})]})]}),e.jsx("div",{className:"lg:col-span-3 space-y-6",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[t.includes("revenue")&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-5 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-sm text-zinc-500 mb-1",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:["$",i.summary?.revenue?.toFixed(2)||"0.00"]})]}),t.includes("attendance")&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-5 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-sm text-zinc-500 mb-1",children:"Total Attendance"}),e.jsx("p",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:i.summary?.attendance||0})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-xl shadow-sm h-[450px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider",children:"Visualization"}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>v("bar"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${p==="bar"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-700"}`,children:"Bar"}),e.jsx("button",{onClick:()=>v("line"),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${p==="line"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-700"}`,children:"Line"})]})]}),e.jsx(J,{width:"100%",height:"90%",children:p==="bar"?e.jsxs(I,{data:i.chartData,children:[e.jsx(S,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(R,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717a",fontSize:12},dy:10}),e.jsx(C,{axisLine:!1,tickLine:!1,tick:{fill:"#71717a",fontSize:12},tickFormatter:s=>t.includes("revenue")&&s>100?`$${s}`:s}),e.jsx(D,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},cursor:{fill:"rgba(0,0,0,0.05)"}}),e.jsx(L,{}),t.includes("revenue")&&e.jsx(g,{dataKey:"revenue",fill:"#2563eb",radius:[4,4,0,0],name:"Revenue ($)"}),t.includes("attendance")&&e.jsx(g,{dataKey:"attendance",fill:"#059669",radius:[4,4,0,0],name:"Attendance"}),t.includes("new_signups")&&e.jsx(g,{dataKey:"new_signups",fill:"#F59E0B",radius:[4,4,0,0],name:"New Signups"})]}):e.jsxs(W,{data:i.chartData,children:[e.jsx(S,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(R,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717a",fontSize:12},dy:10}),e.jsx(C,{axisLine:!1,tickLine:!1,tick:{fill:"#71717a",fontSize:12},tickFormatter:s=>t.includes("revenue")&&s>100?`$${s}`:s}),e.jsx(D,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(L,{}),t.includes("revenue")&&e.jsx(z,{type:"monotone",dataKey:"revenue",stroke:"#2563eb",strokeWidth:3,dot:{r:4},activeDot:{r:6},name:"Revenue ($)"}),t.includes("attendance")&&e.jsx(z,{type:"monotone",dataKey:"attendance",stroke:"#059669",strokeWidth:3,dot:{r:4},activeDot:{r:6},name:"Attendance"}),t.includes("new_signups")&&e.jsx(z,{type:"monotone",dataKey:"new_signups",stroke:"#F59E0B",strokeWidth:3,dot:{r:4},activeDot:{r:6},name:"New Signups"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50/50 dark:bg-zinc-900/50",children:[e.jsx("h3",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider",children:"Raw Data"}),e.jsxs("button",{onClick:$,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(Q,{size:14})," Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-zinc-500 uppercase bg-zinc-50 dark:bg-zinc-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-medium",children:"Dimension"}),t.includes("revenue")&&e.jsx("th",{className:"px-6 py-3 font-medium",children:"Revenue"}),t.includes("attendance")&&e.jsx("th",{className:"px-6 py-3 font-medium",children:"Attendance"}),t.includes("new_signups")&&e.jsx("th",{className:"px-6 py-3 font-medium",children:"New Signups"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:i.chartData.map((s,a)=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-zinc-900 dark:text-zinc-100",children:s.name}),t.includes("revenue")&&e.jsxs("td",{className:"px-6 py-4 text-zinc-600 dark:text-zinc-400",children:["$",s.revenue?.toFixed(2)]}),t.includes("attendance")&&e.jsx("td",{className:"px-6 py-4 text-zinc-600 dark:text-zinc-400",children:s.attendance}),t.includes("new_signups")&&e.jsx("td",{className:"px-6 py-4 text-zinc-600 dark:text-zinc-400",children:s.new_signups})]},a))})]})})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsxs("button",{onClick:()=>{const s=prompt("Enter report name:");s&&O(s)},className:"px-6 py-2 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg text-sm font-medium transition-colors flex items-center gap-2",children:[e.jsx(U,{size:16})," Save Configuration"]})})]}):e.jsxs("div",{className:"h-96 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-2xl flex flex-col items-center justify-center text-zinc-400 bg-zinc-50/50 dark:bg-zinc-900/50",children:[e.jsx(w,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{className:"font-medium",children:"Configure metrics and run query to see results"})]})})]})]})});export{ue as default,me as meta};
