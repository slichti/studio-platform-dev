import{w as ve,u as ye,j as ke}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{r as V,j as e}from"./vendor-puck-D_CB0wXL.js";import{a as l,R as d}from"./vendor-sentry-DugYw-Ne.js";import{D as z,f as T,a as C,b as E,c as $,e as B,g as we,d as Ne}from"./dialog-B0FHXBPK.js";import{B as Se}from"./Badge-CS-9iWuI.js";import{B as y}from"./button-CCL9t_KM.js";import{L as v,I}from"./label-FRIcWNYx.js";import{S as _}from"./select-Cy5Lcs6x.js";import{Z as ze,V as Te,u as Ce,N as Ee,$ as $e,a as Pe,w as De,e as Fe,s as Ae}from"./use-resolve-button-type-Cn57u3nB.js";import{o as N,p as R,m as Ie,M as _e,Y as Me,H as Oe,K as L,a as Ve,b as Be,y as Re,w as Le,n as We,V as Ge,c as M}from"./portal-B9V3iLbl.js";import{f as W,s as G}from"./dialog-D_UahLgr.js";import{P as He}from"./plus-7j3qtkRM.js";import{C as H}from"./clock-D0h4zxra.js";import{C as qe}from"./circle-alert-BKf4ej_b.js";import{c as q}from"./createLucideIcon-BOpDDQ2B.js";import{U as Ue}from"./user-plus-CT5QAWWT.js";import{P as Ke}from"./pencil-CXF0euML.js";import{T as Je}from"./trash-2-vh4T49GQ.js";import"./x-Bbpoc0N5.js";import"./chevron-down-vKXUNxJK.js";import"./vendor-charts-BaZHU4KA.js";const Xe=[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]],Ye=q("cake",Xe);const Ze=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Qe=q("calendar-clock",Ze);function et(t,n,s){let[r,a]=l.useState(s),o=t!==void 0,u=l.useRef(o),c=l.useRef(!1),m=l.useRef(!1);return o&&!u.current&&!c.current?(c.current=!0,u.current=o,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!o&&u.current&&!m.current&&(m.current=!0,u.current=o,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[o?t:r,N(f=>(o||V.flushSync(()=>a(f)),n?.(f)))]}function tt(t){let[n]=l.useState(t);return n}function U(t={},n=null,s=[]){for(let[r,a]of Object.entries(t))J(s,K(n,r),a);return s}function K(t,n){return t?t+"["+n+"]":n}function J(t,n,s){if(Array.isArray(s))for(let[r,a]of s.entries())J(t,K(n,r.toString()),a);else s instanceof Date?t.push([n,s.toISOString()]):typeof s=="boolean"?t.push([n,s?"1":"0"]):typeof s=="string"?t.push([n,s]):typeof s=="number"?t.push([n,`${s}`]):s==null?t.push([n,""]):nt(s)&&!l.isValidElement(s)&&U(s,n,t)}function st(t){var n,s;let r=(n=t?.form)!=null?n:t.closest("form");if(r){for(let a of r.elements)if(a!==t&&(a.tagName==="INPUT"&&a.type==="submit"||a.tagName==="BUTTON"&&a.type==="submit"||a.nodeName==="INPUT"&&a.type==="image")){a.click();return}(s=r.requestSubmit)==null||s.call(r)}}function nt(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let n=Object.getPrototypeOf(t);return n===null||Object.getPrototypeOf(n)===null}let rt=l.createContext(null);function at({children:t}){let n=l.useContext(rt);if(!n)return d.createElement(d.Fragment,null,t);let{target:s}=n;return s?V.createPortal(d.createElement(d.Fragment,null,t),s):null}function it({data:t,form:n,disabled:s,onReset:r,overrides:a}){let[o,u]=l.useState(null),c=R();return l.useEffect(()=>{if(r&&o)return c.addEventListener(o,"reset",r)},[o,n,r]),d.createElement(at,null,d.createElement(lt,{setForm:u,formId:n}),U(t).map(([m,f])=>d.createElement(W,{features:G.Hidden,...Ie({key:m,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:n,disabled:s,name:m,value:f,...a})})))}function lt({setForm:t,formId:n}){return l.useEffect(()=>{if(n){let s=document.getElementById(n);s&&t(s)}},[t,n]),n?null:d.createElement(W,{features:G.Hidden,as:"input",type:"hidden",hidden:!0,readOnly:!0,ref:s=>{if(!s)return;let r=s.closest("form");r&&t(r)}})}let P=l.createContext(null);P.displayName="GroupContext";let ot=l.Fragment;function ct(t){var n;let[s,r]=l.useState(null),[a,o]=Te(),[u,c]=Oe(),m=l.useMemo(()=>({switch:s,setSwitch:r}),[s,r]),f={},b=t,g=L();return d.createElement(c,{name:"Switch.Description",value:u},d.createElement(o,{name:"Switch.Label",value:a,props:{htmlFor:(n=m.switch)==null?void 0:n.id,onClick(j){s&&(Ve(j.currentTarget)&&j.preventDefault(),s.click(),s.focus({preventScroll:!0}))}}},d.createElement(P.Provider,{value:m},g({ourProps:f,theirProps:b,slot:{},defaultTag:ot,name:"Switch.Group"}))))}let dt="button";function ut(t,n){var s;let r=l.useId(),a=Ce(),o=Be(),{id:u=a||`headlessui-switch-${r}`,disabled:c=o||!1,checked:m,defaultChecked:f,onChange:b,name:g,value:j,form:i,autoFocus:p=!1,...x}=t,D=l.useContext(P),[Q,ee]=l.useState(null),te=l.useRef(null),se=Re(te,n,D===null?null:D.setSwitch,ee),k=tt(f),[S,w]=et(m,b,k??!1),ne=R(),[re,F]=l.useState(!1),A=N(()=>{F(!0),w?.(!S),ne.nextFrame(()=>{F(!1)})}),ae=N(h=>{if(Ae(h.currentTarget))return h.preventDefault();h.preventDefault(),A()}),ie=N(h=>{h.key===M.Space?(h.preventDefault(),A()):h.key===M.Enter&&st(h.currentTarget)}),le=N(h=>h.preventDefault()),oe=Ee(),ce=Le(),{isFocusVisible:de,focusProps:ue}=$e({autoFocus:p}),{isHovered:me,hoverProps:fe}=Pe({isDisabled:c}),{pressed:he,pressProps:pe}=De({disabled:c}),xe=We({checked:S,disabled:c,hover:me,focus:de,active:he,autofocus:p,changing:re}),ge=Ge({id:u,ref:se,role:"switch",type:Fe(t,Q),tabIndex:t.tabIndex===-1?0:(s=t.tabIndex)!=null?s:0,"aria-checked":S,"aria-labelledby":oe,"aria-describedby":ce,disabled:c||void 0,autoFocus:p,onClick:ae,onKeyUp:ie,onKeyPress:le},ue,fe,pe),be=l.useCallback(()=>{if(k!==void 0)return w?.(k)},[w,k]),je=L();return d.createElement(d.Fragment,null,g!=null&&d.createElement(it,{disabled:c,data:{[g]:j||"on"},overrides:{type:"checkbox",checked:S},form:i,onReset:be}),je({ourProps:ge,theirProps:x,slot:xe,defaultTag:dt,name:"Switch"}))}let mt=Me(ut),ft=ct,ht=ze,pt=_e,xt=Object.assign(mt,{Group:ft,Label:ht,Description:pt});const X=l.forwardRef(({className:t="",...n},s)=>e.jsx("textarea",{className:`flex min-h-[80px] w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${t}`,ref:s,...n}));X.displayName="Textarea";function Y({checked:t,onCheckedChange:n,disabled:s,className:r="",id:a}){return e.jsx(xt,{id:a,checked:t,onChange:n,disabled:s,className:`${t?"bg-zinc-900 dark:bg-zinc-50":"bg-zinc-200 dark:bg-zinc-800"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 dark:focus-visible:ring-zinc-300 dark:focus-visible:ring-offset-zinc-950 ${r}`,children:e.jsx("span",{className:`${t?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})}const Ot=ve(function(){const{automations:n}=ye(),s=ke(),[r,a]=l.useState(!1),[o,u]=l.useState(!1),[c,m]=l.useState("all"),f=i=>{switch(i){case"birthday":return e.jsx(Ye,{className:"text-pink-500"});case"new_student":return e.jsx(Ue,{className:"text-emerald-500"});case"absent":return e.jsx(Qe,{className:"text-amber-500"});case"trial_ending":return e.jsx(qe,{className:"text-indigo-500"});default:return e.jsx(H,{className:"text-blue-500"})}},b=i=>i.timingType==="immediate"?"Sends Immediately":i.timingType==="delay"?`Wait ${i.timingValue} hours`:i.timingType==="before"?`${i.timingValue} hours Before`:i.timingType==="after"?`${i.timingValue} hours After`:"Custom Schedule",g=n.filter(i=>c==="all"?!0:i.triggerEvent===c),j=g.reduce((i,p)=>{const x=p.tenantId||"Platform Global";return i[x]||(i[x]=[]),i[x].push(p),i},{});return e.jsxs("div",{className:"max-w-5xl mx-auto pb-20 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Marketing Workflows"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Automate your student communication lifecycle."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"relative",children:e.jsxs("select",{value:c,onChange:i=>m(i.target.value),className:"h-10 w-[180px] rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"new_student",children:"New Student Signup"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"absent",children:"Student Absent (Re-engage)"}),e.jsx("option",{value:"trial_ending",children:"Trial Ending"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:"groupByTenant",className:"text-sm cursor-pointer select-none",children:"Group by Tenant"}),e.jsx(Y,{id:"groupByTenant",checked:o,onCheckedChange:u})]}),e.jsxs(z,{open:r,onOpenChange:a,children:[e.jsx(T,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"})," New Workflow"]})}),e.jsxs(C,{className:"sm:max-w-lg",children:[e.jsx(E,{children:e.jsx($,{children:"Create Workflow"})}),e.jsx(Z,{onSubmit:i=>{i.append("_action","create"),s.submit(i,{method:"post"}),a(!1)}})]})]})]})]}),o?e.jsx("div",{className:"space-y-8",children:Object.entries(j).map(([i,p])=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-6 bg-blue-500 rounded-full"}),i==="Platform Global"?"Platform Global Defaults":`Tenant: ${i.slice(0,8)}...`]}),e.jsx("div",{className:"grid gap-4",children:p.map(x=>e.jsx(O,{auto:x,getIcon:f,getTimingLabel:b,fetcher:s},x.id))})]},i))}):e.jsx("div",{className:"grid gap-4",children:g.map(i=>e.jsx(O,{auto:i,getIcon:f,getTimingLabel:b,fetcher:s},i.id))})]})});function O({auto:t,getIcon:n,getTimingLabel:s,fetcher:r}){return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6 flex flex-col sm:flex-row sm:items-center gap-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-3 bg-zinc-50 dark:bg-zinc-800 rounded-full shrink-0",children:n(t.triggerEvent)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100",children:t.subject}),e.jsx(Se,{variant:t.isEnabled?"default":"outline",children:t.isEnabled?"Active":"Paused"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),s(t)]}),e.jsxs("span",{className:"capitalize px-2 py-0.5 bg-zinc-100 dark:bg-zinc-800 rounded text-xs",children:["Trigger: ",t.triggerEvent==="absent"?"Student Absent (Re-engage)":t.triggerEvent==="new_student"?"New Student Signup":t.triggerEvent.replace("_"," ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 sm:pt-0 border-t sm:border-0 border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:`toggle-${t.id}`,className:"sr-only",children:"Enable"}),e.jsx(Y,{checked:t.isEnabled,onCheckedChange:a=>{r.submit({_action:"update",id:t.id,isEnabled:String(a)},{method:"post"})}})]}),e.jsxs(z,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(y,{variant:"outline",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"})," Edit"]})}),e.jsxs(C,{className:"sm:max-w-lg",children:[e.jsx(E,{children:e.jsxs($,{children:['Edit "',t.subject,'"']})}),e.jsx(Z,{initialData:t,onSubmit:a=>{a.append("_action","update"),a.append("id",t.id),r.submit(a,{method:"post"})}})]})]}),e.jsxs(z,{children:[e.jsx(T,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"text-zinc-400 hover:text-red-500 hover:bg-zinc-100",children:e.jsx(Je,{className:"w-4 h-4"})})}),e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsx($,{children:"Delete Workflow?"}),e.jsx(Ne,{children:"This action cannot be undone. Typically we recommend pausing instead."})]}),e.jsx(B,{children:e.jsx(y,{variant:"destructive",onClick:()=>{r.submit({_action:"delete",id:t.id},{method:"post"})},children:"Delete"})})]})]})]})]})}function Z({initialData:t,onSubmit:n}){const s=r=>{r.preventDefault();const a=new FormData(r.currentTarget);n(a)};return e.jsxs("form",{onSubmit:s,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Trigger Event"}),e.jsxs(_,{name:"triggerEvent",defaultValue:t?.triggerEvent||"new_student",children:[e.jsx("option",{value:"new_student",children:"New Student Signup"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"absent",children:"Student Absent (Re-engage)"}),e.jsx("option",{value:"trial_ending",children:"Trial Ending Soon"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Timing"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{name:"timingType",defaultValue:t?.timingType||"immediate",className:"w-[140px]",children:[e.jsx("option",{value:"immediate",children:"Immediately"}),e.jsx("option",{value:"delay",children:"Wait (Delay)"}),e.jsx("option",{value:"before",children:"Before Event"}),e.jsx("option",{value:"after",children:"After Event"})]}),e.jsx(I,{name:"timingValue",type:"number",defaultValue:t?.timingValue||0,placeholder:"Hours",className:"w-20"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Subject Line"}),e.jsx(I,{name:"subject",defaultValue:t?.subject,required:!0,placeholder:"e.g. Welcome to the family!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Email Content"}),e.jsx(X,{name:"content",defaultValue:t?.content,required:!0,placeholder:"Hello {firstname}...",className:"h-32 font-mono"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Supported variables: ","{firstname}",", ","{lastname}",", ","{tenant}"," (Studio Name)."]})]}),e.jsxs(B,{className:"mt-4 flex justify-end gap-2",children:[e.jsx(we,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",children:"Save Workflow"})]})]})}export{Ot as default};
