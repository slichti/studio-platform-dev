import{w as G,x as X,r as n,p as e}from"./chunk-JMJ3UQ3L-Bmktta78.js";import{a as p}from"./api-piI5qlNr.js";import{G as E}from"./GiftCardInput-2tW9wvdb.js";import{c as M}from"./createLucideIcon-dvXbGdUJ.js";import{S as H}from"./search-Bgo_ZFIj.js";import{P as $}from"./package-CojpjhQu.js";import{P as I}from"./plus-B6V-TXYb.js";import{S as A}from"./shopping-cart-Ds6ODrcH.js";import{M as J}from"./minus-CQj-Db4a.js";import{C as V}from"./credit-card-CnGf5phn.js";import{T as B}from"./ticket-DjUV8d1-.js";import"./circle-check-D1LFFhSa.js";import"./circle-x-CqoZNnPA.js";import"./loader-circle-CKyw1K-i.js";const K=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],U=M("banknote",K);const W=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Y=M("shopping-bag",W),pe=G(function(){const{products:T,orders:q,token:c,slug:i}=X(),[d,z]=n.useState("pos"),[w,v]=n.useState(T),[C,F]=n.useState(q),[x,u]=n.useState([]),[y,O]=n.useState(""),[b,f]=n.useState(!1),[m,g]=n.useState("card"),[l,N]=n.useState(null),S=t=>{u(s=>s.find(r=>r.productId===t.id)?s.map(r=>r.productId===t.id?{...r,quantity:r.quantity+1}:r):[...s,{productId:t.id,name:t.name,unitPrice:t.price,quantity:1}])},R=(t,s)=>{u(o=>o.map(r=>{if(r.productId===t){const D=Math.max(0,r.quantity+s);return{...r,quantity:D}}return r}).filter(r=>r.quantity>0))},h=x.reduce((t,s)=>t+s.unitPrice*s.quantity,0),Q=async()=>{if(x.length!==0){f(!0);try{if(l){const s=Math.min(l.balance,h),o=await p("/gift-cards/redeem",c,{method:"POST",headers:{"X-Tenant-Slug":i},body:JSON.stringify({code:l.code,amount:s,referenceId:"POS-TEMP"})});if(o.error)throw new Error(o.error)}const t=await p("/pos/orders",c,{method:"POST",headers:{"X-Tenant-Slug":i},body:JSON.stringify({items:x,totalAmount:h,paymentMethod:m==="gift_card"?"other":m})});if(t.error)alert(t.error);else{alert("Sale Successful!"),u([]),N(null),g("card");const[s,o]=await Promise.all([p("/pos/products",c,{headers:{"X-Tenant-Slug":i}}),p("/pos/orders",c,{headers:{"X-Tenant-Slug":i}})]);v(s.products||[]),F(o.orders||[])}}catch(t){alert("Checkout failed: "+t.message)}finally{f(!1)}}},[_,k]=n.useState(!1),[a,j]=n.useState({name:"",price:"",stock:"0",category:"Retail"}),L=async t=>{t.preventDefault(),f(!0);try{await p("/pos/products",c,{method:"POST",headers:{"X-Tenant-Slug":i},body:JSON.stringify({name:a.name,price:parseInt(a.price)*100,stockQuantity:parseInt(a.stock),category:a.category})}),k(!1),j({name:"",price:"",stock:"0",category:"Retail"});const s=await p("/pos/products",c,{headers:{"X-Tenant-Slug":i}});v(s.products||[])}catch{alert("Failed to add product")}finally{f(!1)}},P=w.filter(t=>t.name.toLowerCase().includes(y.toLowerCase())||t.sku?.toLowerCase().includes(y.toLowerCase()));return e.jsxs("div",{className:"flex flex-col h-screen max-h-screen overflow-hidden bg-zinc-50 dark:bg-zinc-950",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 px-6 py-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"text-blue-600"})," POS & Retail"]}),e.jsxs("nav",{className:"flex gap-1 bg-zinc-100 dark:bg-zinc-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>z("pos"),className:`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${d==="pos"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-700"}`,children:"Terminal"}),e.jsx("button",{onClick:()=>z("history"),className:`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${d==="history"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-700"}`,children:"Orders"}),e.jsx("button",{onClick:()=>z("inventory"),className:`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${d==="inventory"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-700"}`,children:"Inventory"})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Find products...",value:y,onChange:t=>O(t.target.value),className:"pl-10 pr-4 py-2 bg-zinc-50 dark:bg-zinc-800 border-none rounded-full text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64"})]})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[d==="pos"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4",children:[P.map(t=>e.jsxs("button",{onClick:()=>S(t),disabled:t.stockQuantity<=0,className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all flex flex-col items-start gap-3 text-left group disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("div",{className:"w-full aspect-square bg-zinc-100 dark:bg-zinc-800 rounded-lg flex items-center justify-center mb-1 group-hover:scale-105 transition-transform",children:e.jsx($,{className:"h-10 w-10 text-zinc-300"})}),e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100 truncate",children:t.name}),e.jsx("p",{className:"text-sm text-zinc-500 line-clamp-1",children:t.category})]}),e.jsxs("div",{className:"flex justify-between items-end w-full",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["$",(t.price/100).toFixed(2)]}),e.jsxs("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full ${t.stockQuantity>5?"bg-green-50 text-green-600":"bg-amber-50 text-amber-600"}`,children:[t.stockQuantity," Left"]})]})]},t.id)),P.length===0&&e.jsxs("div",{className:"col-span-full py-20 text-center",children:[e.jsx($,{className:"h-12 w-12 text-zinc-200 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500",children:"No products found. Add some in Inventory."})]})]}),d==="history"&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Order ID"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Date"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:[C.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-mono text-zinc-600 dark:text-zinc-400",children:["#",t.id.substring(0,8)]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-200 flex items-center justify-center text-[10px] font-bold",children:t.member?.user?.profile?.firstName?.charAt(0)||"?"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.member?.user?.profile?.firstName||"Guest"," ",t.member?.user?.profile?.lastName||""]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-sm font-bold text-green-600",children:["$",(t.totalAmount/100).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 text-xs text-zinc-500",children:t.items.map(s=>s.product.name).join(", ")}),e.jsx("td",{className:"px-6 py-4 text-xs text-zinc-400",children:new Date(t.createdAt).toLocaleString()})]},t.id)),C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-20 text-center text-zinc-500 italic",children:"No orders processed yet."})})]})]})}),d==="inventory"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Manage Inventory"}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 hover:bg-blue-700",children:[e.jsx(I,{className:"h-4 w-4"})," Add Product"]})]}),_&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-md",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"New Product Details"}),e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Product Name"}),e.jsx("input",{className:"w-full border border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm",placeholder:"e.g. Studio T-Shirt",value:a.name,onChange:t=>j({...a,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Price ($)"}),e.jsx("input",{type:"number",className:"w-full border border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm",placeholder:"25.00",value:a.price,onChange:t=>j({...a,price:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Initial Stock"}),e.jsx("input",{type:"number",className:"w-full border border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm",placeholder:"10",value:a.stock,onChange:t=>j({...a,stock:t.target.value}),required:!0})]}),e.jsxs("div",{className:"md:col-span-4 flex justify-end gap-3 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 text-sm font-medium text-zinc-600 hover:bg-zinc-100 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white px-6 py-2 rounded-lg text-sm font-medium hover:opacity-90",children:b?"Saving...":"Create Product"})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Product"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"In Stock"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-zinc-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:w.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-500",children:t.category}),e.jsxs("td",{className:"px-6 py-4 text-sm font-bold",children:["$",(t.price/100).toFixed(2)]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm font-medium ${t.stockQuantity<=5?"text-red-500":"text-zinc-900 dark:text-zinc-100"}`,children:t.stockQuantity})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full ${t.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:t.isActive?"Active":"Hidden"})})]},t.id))})]})})]})]}),d==="pos"&&e.jsxs("div",{className:"w-96 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 flex flex-col shadow-xl",children:[e.jsx("div",{className:"p-6 border-b border-zinc-100 dark:border-zinc-800",children:e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-zinc-400"})," Current Cart"]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6 space-y-4",children:x.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-400 opacity-50 space-y-3",children:[e.jsx(A,{className:"h-12 w-12"}),e.jsx("p",{className:"text-sm",children:"Cart is empty"})]}):x.map(t=>e.jsxs("div",{className:"flex gap-3 items-start animate-in slide-in-from-right-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["$",(t.unitPrice/100).toFixed(2)," ea"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-zinc-100 dark:bg-zinc-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>R(t.productId,-1),className:"p-1 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(J,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center text-xs font-bold",children:t.quantity}),e.jsx("button",{onClick:()=>S({id:t.productId,name:t.name,price:t.unitPrice}),className:"p-1 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm font-bold w-16 text-right",children:["$",(t.unitPrice*t.quantity/100).toFixed(2)]})]},t.productId))}),e.jsxs("div",{className:"p-6 bg-zinc-50 dark:bg-zinc-900/50 border-t border-zinc-200 dark:border-zinc-800 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest pl-1",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>g("card"),className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${m==="card"?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-500/20":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:border-blue-300"}`,children:[e.jsx(V,{size:18}),e.jsx("span",{className:"text-[10px] font-extrabold mt-1",children:"CARD"})]}),e.jsxs("button",{onClick:()=>g("cash"),className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${m==="cash"?"bg-emerald-600 border-emerald-600 text-white shadow-lg shadow-emerald-500/20":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:border-emerald-300"}`,children:[e.jsx(U,{size:18}),e.jsx("span",{className:"text-[10px] font-extrabold mt-1",children:"CASH"})]}),e.jsxs("button",{onClick:()=>g("gift_card"),className:`flex flex-col items-center justify-center p-3 rounded-xl border transition-all ${m==="gift_card"?"bg-amber-600 border-amber-600 text-white shadow-lg shadow-amber-500/20":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:border-amber-300"}`,children:[e.jsx(B,{size:18}),e.jsx("span",{className:"text-[10px] font-extrabold mt-1",children:"GIFT"})]})]})]}),m==="gift_card"&&e.jsx(E,{token:c,slug:i,onApply:t=>N(t),onRemove:()=>N(null)}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-zinc-500 text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",(h/100).toFixed(2)]})]}),l&&e.jsxs("div",{className:"flex justify-between items-center text-emerald-600 text-sm font-bold",children:[e.jsx("span",{children:"Gift Card Credit"}),e.jsxs("span",{children:["-$",(Math.min(l.balance,h)/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold text-zinc-900 dark:text-zinc-100 pt-2 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{children:"Remaining"}),e.jsxs("span",{children:["$",(Math.max(0,h-(l?.balance||0))/100).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u([]),className:"flex-1 py-3 text-sm font-medium text-zinc-600 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-xl transition-colors",children:"Clear"}),e.jsx("button",{onClick:Q,disabled:b||x.length===0,className:"flex-[2] bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white py-3 rounded-xl font-bold shadow-lg shadow-zinc-200 dark:shadow-none hover:translate-y-[-2px] active:translate-y-0 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:b?"Processing...":e.jsxs(e.Fragment,{children:["Charge $",(Math.max(0,h-(l?.balance||0))/100).toFixed(2)]})})]})]})]})]})]})});export{pe as default};
