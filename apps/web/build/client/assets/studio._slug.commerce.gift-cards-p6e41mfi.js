import{w as G,d as H,e as B,c as V,r as i,u as q}from"./chunk-JMJ3UQ3L-Dzyq37y6.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as U}from"./api-piI5qlNr.js";import{c as d}from"./createLucideIcon-CNXPjsb6.js";import{P as L}from"./plus-ZxFZXXXb.js";import{S as O}from"./search-Bk85iKYp.js";import{T as Q}from"./ticket-zk96GG2r.js";import{E as Y}from"./ellipsis-BdMDr6ds.js";import{M as J}from"./mail-Ci_j9QIs.js";import{L as W}from"./loader-circle-BVGmWjCV.js";import{C as X}from"./credit-card-CbfdN0Sn.js";const K=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Z=d("ban",K);const ee=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],te=d("chevron-up",ee);const se=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],ae=d("gift",se);const ie=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],$=d("history",ie);const ne=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],ce=d("link",ne),Me=G(function(){const{giftCards:E,token:M}=H(),{slug:g}=B(),{roles:z}=V()||{},n=z?.includes("owner")||z?.includes("instructor"),[x,le]=i.useState(E),[u,F]=i.useState(""),[oe,de]=i.useState(!1),[l,f]=i.useState("list"),[xe,A]=i.useState(!1),[me,k]=i.useState(!1),[p,j]=i.useState(null),[N,v]=i.useState([]),[P,y]=i.useState(!1),[w,o]=i.useState(null),[ue,pe]=i.useState({amount:"",recipientEmail:"",notes:""}),[he,be]=i.useState(null),[ge,_]=i.useState(""),[ze,fe]=i.useState(!1),[s,c]=i.useState({amount:"50",customAmount:"",isForSelf:!0,recipientEmail:"",recipientName:"",senderName:"",message:""}),C=async t=>{if(p===t){j(null);return}j(t),y(!0),v([]);try{const a=await U(`/gift-cards/${t}/transactions`,M,{headers:{"X-Tenant-Slug":g}});a.transactions&&v(a.transactions)}catch(a){console.error(a)}finally{y(!1)}},S=x.filter(t=>t.code.toLowerCase().includes(u.toLowerCase())||t.recipientEmail?.toLowerCase().includes(u.toLowerCase())),I=()=>{const t=s.amount==="custom"?s.customAmount:s.amount,a=parseFloat(t)*100,r=new URLSearchParams;return r.set("giftCardAmount",a.toString()),s.isForSelf||(s.recipientEmail&&r.set("recipientEmail",s.recipientEmail),s.recipientName&&r.set("recipientName",s.recipientName),s.senderName&&r.set("senderName",s.senderName),s.message&&r.set("message",s.message)),`/studio/${g}/checkout?${r.toString()}`},[R,D]=q(),h=R.get("claimCode");i.useEffect(()=>{h&&(_(h.toUpperCase()),k(!0),D(t=>(t.delete("claimCode"),t)))},[h]),i.useEffect(()=>{const t=()=>o(null);return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[]);const m=x.reduce((t,a)=>t+a.initialValue,0),b=x.reduce((t,a)=>t+(a.status==="active"?a.currentBalance:0),0),T=m>0?(m-b)/m*100:0;return e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",children:[e.jsx(ae,{className:"text-blue-600"})," Gift Cards"]}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:n?"Manage store credit and issue cards.":"View your balance or send a gift."})]}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>f("list"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all ${l==="list"?"bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm":"text-zinc-500 hover:text-zinc-900 dark:text-zinc-400"}`,children:n?"Manage Cards":"My Cards"}),e.jsx("button",{onClick:()=>f("buy"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all ${l==="buy"?"bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm":"text-zinc-500 hover:text-zinc-900 dark:text-zinc-400"}`,children:"Purchase Gift Card"})]}),e.jsxs("div",{className:"flex gap-2",children:[l==="list"&&!n&&e.jsxs("button",{onClick:()=>k(!0),className:"bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 px-6 py-3 rounded-2xl font-bold flex items-center gap-2 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-all",children:[e.jsx(ce,{size:18})," Link Card"]}),n&&l==="list"&&e.jsxs("button",{onClick:()=>A(!0),className:"bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white px-6 py-3 rounded-2xl font-bold flex items-center gap-2 shadow-lg hover:translate-y-[-2px] transition-all",children:[e.jsx(L,{size:20})," Issue New Card"]})]})]}),l==="list"?e.jsxs("div",{className:"space-y-8",children:[n?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",children:"Total Liability"}),e.jsxs("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:["$",(b/100).toLocaleString()]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",children:"Total Issued"}),e.jsxs("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:["$",(m/100).toLocaleString()]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",children:"Redemption Rate"}),e.jsxs("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:[T.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",children:"Active Cards"}),e.jsx("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:x.filter(t=>t.status==="active").length})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-1",children:"My Balance"}),e.jsxs("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:["$",(b/100).toLocaleString()]})]})}),e.jsxs("div",{className:"space-y-4",children:[n&&e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Find by code or email...",value:u,onChange:t=>F(t.target.value),className:"w-full pl-12 pr-4 py-3 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm"})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-sm overflow-visible",children:S.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No gift cards found."})]}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Code"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Balance"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Issued"}),n&&e.jsx("th",{className:"px-6 py-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Recipient"}),e.jsx("th",{className:"px-6 py-4"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-50 dark:divide-zinc-800",children:S.map(t=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-mono font-bold text-zinc-900 dark:text-zinc-100",children:t.code}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("span",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:["$",(t.currentBalance/100).toFixed(2)]}),e.jsxs("span",{className:"text-zinc-400 text-xs ml-1",children:["/ $",(t.initialValue/100).toFixed(2)]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-tighter ${t.status==="active"?"bg-emerald-100 text-emerald-700":t.status==="exhausted"?"bg-zinc-200 text-zinc-600":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-xs text-zinc-500",children:new Date(t.createdAt).toLocaleDateString()}),n&&e.jsx("td",{className:"px-6 py-4 text-xs text-zinc-500",children:t.recipientEmail||"-"}),e.jsx("td",{className:"px-6 py-4 text-right relative",children:n?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),o(w===t.id?null:t.id)},className:"text-zinc-400 hover:text-blue-600 transition-colors p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800",children:e.jsx(Y,{size:16})}),w===t.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-100 dark:border-zinc-800 z-50 overflow-hidden py-1",children:[e.jsxs("button",{onClick:()=>{o(null),C(t.id)},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 flex items-center gap-2",children:[e.jsx($,{size:14})," View History"]}),e.jsxs("button",{onClick:()=>{o(null),alert("Resend feature coming soon")},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 flex items-center gap-2",children:[e.jsx(J,{size:14})," Resend Email"]}),e.jsxs("button",{onClick:()=>{o(null),alert("Void feature coming soon")},className:"w-full text-left px-4 py-2.5 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800 text-red-600 flex items-center gap-2 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsx(Z,{size:14})," Void Card"]})]})]}):e.jsx("button",{onClick:()=>C(t.id),className:"text-zinc-400 hover:text-blue-600 transition-colors p-2",children:p===t.id?e.jsx(te,{size:16}):e.jsx($,{size:16})})})]},t.id),p===t.id&&e.jsx("tr",{className:"bg-zinc-50/50 dark:bg-zinc-800/20",children:e.jsx("td",{colSpan:n?6:5,className:"px-6 py-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl p-4 animate-in slide-in-from-top-2",children:[e.jsx("h4",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest mb-3",children:"Transaction History"}),P?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(W,{className:"animate-spin text-zinc-300"})}):N.length===0?e.jsx("p",{className:"text-sm text-zinc-500",children:"No transactions found."}):e.jsx("div",{className:"space-y-2",children:N.map(a=>e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${a.amount>0?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"}`,children:a.amount>0?e.jsx(L,{size:14}):e.jsx("div",{className:"w-2 h-[2px] bg-current"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-zinc-900 dark:text-zinc-100 capitalize",children:a.type}),e.jsx("p",{className:"text-xs text-zinc-400",children:new Date(a.createdAt).toLocaleString()})]})]}),e.jsxs("span",{className:`font-mono font-bold ${a.amount>0?"text-emerald-600":"text-zinc-900 dark:text-zinc-100"}`,children:[a.amount>0?"+":"","$",(a.amount/100).toFixed(2)]})]},a.id))})]})})})]}))})]})})]})]}):e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-100 dark:border-zinc-800 shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"p-8 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-800/30",children:[e.jsx("h2",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100 mb-2",children:"Purchase Gift Card"}),e.jsx("p",{className:"text-zinc-500",children:"Give the gift of yoga and wellness. Sent instantly via email."})]}),e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Select Amount"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["25","50","100","custom"].map(t=>e.jsx("button",{onClick:()=>c({...s,amount:t}),className:`py-4 px-4 rounded-2xl font-bold border-2 transition-all ${s.amount===t?"border-blue-600 bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"border-zinc-200 dark:border-zinc-800 text-zinc-600 dark:text-zinc-400 hover:border-zinc-300"}`,children:t==="custom"?"Custom":`$${t}`},t))}),s.amount==="custom"&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 font-bold text-zinc-400",children:"$"}),e.jsx("input",{type:"number",placeholder:"Enter amount (e.g. 150)",value:s.customAmount,onChange:t=>c({...s,customAmount:t.target.value}),className:"w-full pl-8 pr-4 py-4 bg-zinc-50 dark:bg-zinc-800 border-none rounded-2xl font-bold text-lg outline-none focus:ring-2 focus:ring-blue-500"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Who is this for?"}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 p-1 rounded-2xl",children:[e.jsx("button",{onClick:()=>c({...s,isForSelf:!0}),className:`flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all ${s.isForSelf?"bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm":"text-zinc-500"}`,children:"For Me"}),e.jsx("button",{onClick:()=>c({...s,isForSelf:!1}),className:`flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all ${s.isForSelf?"text-zinc-500":"bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 shadow-sm"}`,children:"For Someone Else"})]})]}),!s.isForSelf&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Recipient Name"}),e.jsx("input",{type:"text",placeholder:"Jane Doe",value:s.recipientName,onChange:t=>c({...s,recipientName:t.target.value}),className:"w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Recipient Email"}),e.jsx("input",{type:"email",placeholder:"jane@example.com",value:s.recipientEmail,onChange:t=>c({...s,recipientEmail:t.target.value}),className:"w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Your Name (From)"}),e.jsx("input",{type:"text",placeholder:"Your Name",value:s.senderName,onChange:t=>c({...s,senderName:t.target.value}),className:"w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest",children:"Message (Optional)"}),e.jsx("textarea",{placeholder:"Enjoy!",rows:3,value:s.message,onChange:t=>c({...s,message:t.target.value}),className:"w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-800 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("a",{href:I(),className:`block w-full py-4 rounded-2xl font-black text-center transition-all ${!s.isForSelf&&!s.recipientEmail||s.amount==="custom"&&!s.customAmount?"bg-zinc-100 text-zinc-400 cursor-not-allowed":"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 hover:scale-[1.02] shadow-xl"}`,children:"Proceed to Checkout"}),e.jsxs("p",{className:"text-center text-xs text-zinc-400 mt-4 flex items-center justify-center gap-1",children:[e.jsx(X,{size:12})," Secure payment via Stripe"]})]})]})]})})]})});export{Me as default};
