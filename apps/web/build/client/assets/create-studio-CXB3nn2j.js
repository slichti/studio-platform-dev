import{w as D,b as I,e as B,a as F}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as n}from"./vendor-sentry-DugYw-Ne.js";import{a as v}from"./api-ChCisjdG.js";import{L as V}from"./loader-circle-DYdrNEzV.js";import{C as q}from"./circle-check-big-DXKf0ujb.js";import{C as O}from"./circle-x-DmiMGTs4.js";import{u as U}from"./index-BNXeXtNe.js";import{a as H,R as J,S as X}from"./chunk-VMBS36YX-BYbcqdhs.js";import"./createLucideIcon-BOpDDQ2B.js";import"./vendor-charts-BaZHU4KA.js";import"./chunk-OT5FTIRN-BVuv9f9K.js";import"./runtimeEnvironment-BB2sO-19-DQnzQjGy.js";function Y(u,m){const[f,g]=n.useState(u);return n.useEffect(()=>{const l=setTimeout(()=>{g(u)},m);return()=>{clearTimeout(l)}},[u,m]),f}const oe=D(function(){const{user:m,isLoaded:f}=U(),g=I();B();const[l]=F(),[E,L]=n.useState("monthly"),[o,R]=n.useState(""),[b,y]=n.useState(""),[p,j]=n.useState("basic"),[N,c]=n.useState(null),[S,w]=n.useState(!1),x=Y(b,500),[a,i]=n.useState("idle"),[z,h]=n.useState(""),[k,M]=n.useState([]);n.useEffect(()=>{async function s(){try{const t=await v("/public/plans");Array.isArray(t)&&M(t.sort((r,d)=>(r.prices.monthly||0)-(d.prices.monthly||0)))}catch(t){console.error("Plan load error",t)}}s()},[]),n.useEffect(()=>{const s=l.get("tier");s&&j(s);const t=l.get("interval");t&&["monthly","annual"].includes(t)&&L(t)},[l]);const[C,T]=n.useState(!1);n.useEffect(()=>{if(!o||C)return;const s=o.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-");y(s)},[o,C]),n.useEffect(()=>{if(!x){i("idle"),h("");return}async function s(){i("checking");try{if(!/^[a-z0-9-]{3,}$/.test(x)){i("invalid"),h("Min 3 chars, letters, numbers, dashes only.");return}const t=await window.Clerk?.session?.getToken(),r=await v(`/check-slug?slug=${encodeURIComponent(x)}`,t);r.valid?(i("valid"),h("")):(i("invalid"),h(r.reason||"Slug is unavailable"))}catch(t){console.error(t),i("idle")}}s()},[x]);const A=async s=>{if(s.preventDefault(),!(a==="invalid"||a==="checking")){w(!0),c(null);try{const t=await window.Clerk?.session?.getToken(),r=await v("/onboarding/studio",t,{method:"POST",body:JSON.stringify({name:o,slug:b,tier:p,interval:E})});r.tenant?g(`/studio/${r.tenant.slug}/onboarding`):r.error&&c(r.error)}catch(t){c(t.message||"Failed to create studio.")}finally{w(!1)}}};if(!f)return e.jsx("div",{className:"p-10 text-center",children:"Loading..."});const P=m?.primaryEmailAddress?.verification?.status==="verified";return e.jsxs("main",{className:"min-h-screen bg-zinc-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsx(H,{children:e.jsx(J,{})}),e.jsxs(X,{children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-zinc-900",children:"Create your Studio"}),e.jsx("p",{className:"mt-2 text-center text-sm text-zinc-600",children:"Start managing your classes and students today."})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[!P&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"Please verify your email address to create a studio. Check your inbox."})})]})}),N&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4 text-sm",children:N}),e.jsxs("form",{className:"space-y-6",onSubmit:A,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-zinc-700",children:"Studio Name"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"name",name:"name",type:"text",required:!0,className:"appearance-none block w-full px-3 py-2 border border-zinc-300 rounded-md shadow-sm placeholder-zinc-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:o,onChange:s=>{R(s.target.value),c(null)},placeholder:"e.g. Zen Yoga"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-zinc-700",children:"Studio URL (Slug)"}),e.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm relative",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-zinc-300 bg-zinc-50 text-zinc-500 sm:text-sm",children:"studio.platform.com/"}),e.jsx("input",{id:"slug",name:"slug",type:"text",required:!0,className:`flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${a==="invalid"?"border-red-300":"border-zinc-300"}`,value:b,onChange:s=>{y(s.target.value),T(!0),c(null)}}),e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[a==="checking"&&e.jsx(V,{className:"animate-spin text-zinc-400",size:16}),a==="valid"&&e.jsx(q,{className:"text-green-500",size:16}),a==="invalid"&&e.jsx(O,{className:"text-red-500",size:16})]})]}),a==="invalid"&&z&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:z})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700",children:"Select Plan"}),e.jsxs("button",{type:"button",onClick:()=>setInterval(s=>s==="monthly"?"annual":"monthly"),className:"text-xs text-blue-600 hover:text-blue-500 font-medium",children:["Switch to ",interval==="monthly"?"Annual":"Monthly"]})]}),k.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:k.map(s=>{const t=interval==="monthly"?s.prices.monthly:s.prices.annual,r=t?`$${t/100}/${interval==="monthly"?"mo":"yr"}`:"Free";let d=null;if(interval==="annual"&&s.prices.monthly&&s.prices.annual){const $=s.prices.monthly*12-s.prices.annual;$>0&&(d=`$${$/100}`)}return e.jsxs("div",{onClick:()=>j(s.slug),className:`cursor-pointer border rounded-lg p-4 flex items-center justify-between transition-all ${p===s.slug?"border-blue-500 ring-1 ring-blue-500 bg-blue-50":"border-zinc-200 hover:border-blue-300"}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-zinc-900",children:[s.name," (",r,")"]}),e.jsxs("div",{className:"text-sm text-zinc-500",children:[s.trialDays>0?`${s.trialDays}-day free trial.`:"No trial."," ",interval==="annual"?"Billed annually.":"Billed monthly."]}),d&&e.jsxs("div",{className:"text-xs text-emerald-600 font-medium mt-1",children:["Save ",d,"/year."]})]}),e.jsx("div",{className:"h-4 w-4 rounded-full border border-zinc-300 flex items-center justify-center",children:p===s.slug&&e.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full"})})]},s.id)})}):e.jsx("div",{className:"p-4 border border-dashed border-zinc-300 rounded-lg text-center text-sm text-zinc-500",children:"Loading plans..."})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:S||!P||a==="invalid"||a==="checking",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-zinc-900 hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-zinc-500 disabled:opacity-70 disabled:cursor-not-allowed",children:S?"Creating...":"Create Studio"})})]})]})})]})]})});export{oe as default};
