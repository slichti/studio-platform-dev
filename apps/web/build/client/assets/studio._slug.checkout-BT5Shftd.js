import{R as c,w as Se,v as Ee,r as j,p as xe}from"./chunk-JMJ3UQ3L-DmAaMJDT.js";import{j as p}from"./jsx-runtime-u17CrQMm.js";import{P as d}from"./index-B2VZcLkr.js";import{a as ke}from"./api-piI5qlNr.js";import{G as Pe}from"./GiftCardInput-CA57ZPGS.js";import{A as je}from"./arrow-left-Da7CsRAp.js";import"./circle-check-Ct3joEXe.js";import"./createLucideIcon-DBCK0g1u.js";import"./circle-x-B7pAMd5Y.js";import"./ticket-BzV2cjp6.js";import"./loader-circle-COV7T8XM.js";var ae="clover",we=function(e){return e===3?"v3":e},se="https://js.stripe.com",Re="".concat(se,"/").concat(ae,"/stripe.js"),Oe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Ae=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Ne=function(e){return Oe.test(e)||Ae.test(e)},Ie=function(){for(var e=document.querySelectorAll('script[src^="'.concat(se,'"]')),t=0;t<e.length;t++){var r=e[t];if(Ne(r.src))return r}return null},Z=function(e){var t="",r=document.createElement("script");r.src="".concat(Re).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r},Le=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"8.6.0",startTime:t})},U=null,z=null,Y=null,Ue=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},Te=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},_e=function(e){return U!==null?U:(U=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var o=Ie();if(!(o&&e)){if(!o)o=Z(e);else if(o&&Y!==null&&z!==null){var i;o.removeEventListener("load",Y),o.removeEventListener("error",z),(i=o.parentNode)===null||i===void 0||i.removeChild(o),o=Z(e)}}Y=Te(t,r),z=Ue(r),o.addEventListener("load",Y),o.addEventListener("error",z)}catch(a){r(a);return}}),U.catch(function(t){return U=null,Promise.reject(t)}))},De=function(e,t,r){if(e===null)return null;var o=t[0],i=o.match(/^pk_test/),a=we(e.version),u=ae;i&&a!==u&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("8.6.0"," expected Stripe.js@").concat(u,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return Le(s,r),s},T,ce=!1,ue=function(){return T||(T=_e(null).catch(function(e){return T=null,Promise.reject(e)}),T)};Promise.resolve().then(function(){return ue()}).catch(function(n){ce||console.warn(n)});var Me=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];ce=!0;var o=Date.now();return ue().then(function(i){return De(i,t,o)})};function ee(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,r)}return t}function te(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ee(Object(t),!0).forEach(function(r){de(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function q(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?q=function(e){return typeof e}:q=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(n)}function de(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function We(n,e){if(n==null)return{};var t={},r=Object.keys(n),o,i;for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&(t[o]=n[o]);return t}function ze(n,e){if(n==null)return{};var t=We(n,e),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function le(n,e){return Ye(n)||qe(n,e)||Be(n,e)||$e()}function Ye(n){if(Array.isArray(n))return n}function qe(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var r=[],o=!0,i=!1,a,u;try{for(t=t.call(n);!(o=(a=t.next()).done)&&(r.push(a.value),!(e&&r.length===e));o=!0);}catch(s){i=!0,u=s}finally{try{!o&&t.return!=null&&t.return()}finally{if(i)throw u}}return r}}function Be(n,e){if(n){if(typeof n=="string")return re(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return re(n,e)}}function re(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function $e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=function(e,t,r){var o=!!r,i=c.useRef(r);c.useEffect(function(){i.current=r},[r]),c.useEffect(function(){if(!o||!e)return function(){};var a=function(){i.current&&i.current.apply(i,arguments)};return e.on(t,a),function(){e.off(t,a)}},[o,t,e,i])},G=function(e){var t=c.useRef(e);return c.useEffect(function(){t.current=e},[e]),t.current},I=function(e){return e!==null&&q(e)==="object"},Fe=function(e){return I(e)&&typeof e.then=="function"},Ge=function(e){return I(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ne="[object Object]",Je=function n(e,t){if(!I(e)||!I(t))return e===t;var r=Array.isArray(e),o=Array.isArray(t);if(r!==o)return!1;var i=Object.prototype.toString.call(e)===ne,a=Object.prototype.toString.call(t)===ne;if(i!==a)return!1;if(!i&&!r)return e===t;var u=Object.keys(e),s=Object.keys(t);if(u.length!==s.length)return!1;for(var m={},h=0;h<u.length;h+=1)m[u[h]]=!0;for(var x=0;x<s.length;x+=1)m[s[x]]=!0;var l=Object.keys(m);if(l.length!==u.length)return!1;var f=e,k=t,S=function(w){return n(f[w],k[w])};return l.every(S)},Ve=function(e,t,r){return I(e)?Object.keys(e).reduce(function(o,i){var a=!I(t)||!Je(e[i],t[i]);return r.includes(i)?(a&&console.warn("Unsupported prop change: options.".concat(i," is not a mutable property.")),o):a?te(te({},o||{}),{},de({},i,e[i])):o},null):null},pe="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",oe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe;if(e===null||Ge(e))return e;throw new Error(t)},Ke=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe;if(Fe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(o){return oe(o,t)})};var r=oe(e,t);return r===null?{tag:"empty"}:{tag:"sync",stripe:r}},Xe=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"5.4.1"}),e.registerAppInfo({name:"react-stripe-js",version:"5.4.1",url:"https://stripe.com/docs/stripe-js/react"}))},fe=c.createContext(null);fe.displayName="ElementsContext";var He=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e};d.any,d.object;d.func.isRequired;var me=c.createContext(null);me.displayName="CheckoutContext";d.any,d.shape({clientSecret:d.oneOfType([d.string,d.instanceOf(Promise)]).isRequired,elementsOptions:d.object}).isRequired;var ie=function(e){var t=c.useContext(me),r=c.useContext(fe);if(t){if(r)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t}else return He(r,e)},Qe=["mode"],Ze=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},C=function(e,t){var r="".concat(Ze(e),"Element"),o=function(s){var m=s.id,h=s.className,x=s.options,l=x===void 0?{}:x,f=s.onBlur,k=s.onFocus,S=s.onReady,L=s.onChange,w=s.onEscape,V=s.onClick,N=s.onLoadError,B=s.onLoaderStart,R=s.onNetworksChange,_=s.onConfirm,D=s.onCancel,O=s.onShippingAddressChange,ve=s.onShippingRateChange,ge=s.onSavedPaymentMethodRemove,ye=s.onSavedPaymentMethodUpdate,M=ie("mounts <".concat(r,">")),W="elements"in M?M.elements:null,A="checkoutState"in M?M.checkoutState:null,E=A?.type==="success"||A?.type==="loading"?A.sdk:null,be=c.useState(null),K=le(be,2),g=K[0],Ce=K[1],P=c.useRef(null),$=c.useRef(null);y(g,"blur",f),y(g,"focus",k),y(g,"escape",w),y(g,"click",V),y(g,"loaderror",N),y(g,"loaderstart",B),y(g,"networkschange",R),y(g,"confirm",_),y(g,"cancel",D),y(g,"shippingaddresschange",O),y(g,"shippingratechange",ve),y(g,"savedpaymentmethodremove",ge),y(g,"savedpaymentmethodupdate",ye),y(g,"change",L);var F;S&&(e==="expressCheckout"?F=S:F=function(){S(g)}),y(g,"ready",F),c.useLayoutEffect(function(){if(P.current===null&&$.current!==null&&(W||E)){var v=null;if(E)switch(e){case"paymentForm":v=E.createPaymentFormElement();break;case"payment":v=E.createPaymentElement(l);break;case"address":if("mode"in l){var H=l.mode,Q=ze(l,Qe);if(H==="shipping")v=E.createShippingAddressElement(Q);else if(H==="billing")v=E.createBillingAddressElement(Q);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":v=E.createExpressCheckoutElement(l);break;case"currencySelector":v=E.createCurrencySelectorElement();break;case"taxId":v=E.createTaxIdElement(l);break;default:throw new Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else W&&(v=W.create(e,l));P.current=v,Ce(v),v&&v.mount($.current)}},[W,E,l]);var X=G(l);return c.useEffect(function(){if(P.current){var v=Ve(l,X,["paymentRequest"]);v&&"update"in P.current&&P.current.update(v)}},[l,X]),c.useLayoutEffect(function(){return function(){if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}}},[]),c.createElement("div",{id:m,className:h,ref:$})},i=function(s){ie("mounts <".concat(r,">"));var m=s.id,h=s.className;return c.createElement("div",{id:m,className:h})},a=t?i:o;return a.propTypes={id:d.string,className:d.string,onChange:d.func,onBlur:d.func,onFocus:d.func,onReady:d.func,onEscape:d.func,onClick:d.func,onLoadError:d.func,onLoaderStart:d.func,onNetworksChange:d.func,onConfirm:d.func,onCancel:d.func,onShippingAddressChange:d.func,onShippingRateChange:d.func,onSavedPaymentMethodRemove:d.func,onSavedPaymentMethodUpdate:d.func,options:d.object},a.displayName=r,a.__elementType=e,a},b=typeof window>"u",J=c.createContext(null);J.displayName="EmbeddedCheckoutProviderContext";var he=function(){var e=c.useContext(J);if(!e)throw new Error("<EmbeddedCheckout> must be used within <EmbeddedCheckoutProvider>");return e},et="Invalid prop `stripe` supplied to `EmbeddedCheckoutProvider`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",tt=function(e){var t=e.stripe,r=e.options,o=e.children,i=c.useMemo(function(){return Ke(t,et)},[t]),a=c.useRef(null),u=c.useRef(null),s=c.useState({embeddedCheckout:null}),m=le(s,2),h=m[0],x=m[1];c.useEffect(function(){if(!(u.current||a.current)){var k=function(L){u.current||a.current||(u.current=L,a.current=u.current.initEmbeddedCheckout(r).then(function(w){x({embeddedCheckout:w})}))};i.tag==="async"&&!u.current&&(r.clientSecret||r.fetchClientSecret)?i.stripePromise.then(function(S){S&&k(S)}):i.tag==="sync"&&!u.current&&(r.clientSecret||r.fetchClientSecret)&&k(i.stripe)}},[i,r,h,u]),c.useEffect(function(){return function(){h.embeddedCheckout?(a.current=null,h.embeddedCheckout.destroy()):a.current&&a.current.then(function(){a.current=null,h.embeddedCheckout&&h.embeddedCheckout.destroy()})}},[h.embeddedCheckout]),c.useEffect(function(){Xe(u)},[u]);var l=G(t);c.useEffect(function(){l!==null&&l!==t&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the `stripe` prop after setting it.")},[l,t]);var f=G(r);return c.useEffect(function(){if(f!=null){if(r==null){console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot unset options after setting them.");return}r.clientSecret===void 0&&r.fetchClientSecret===void 0&&console.warn("Invalid props passed to EmbeddedCheckoutProvider: You must provide one of either `options.fetchClientSecret` or `options.clientSecret`."),f.clientSecret!=null&&r.clientSecret!==f.clientSecret&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the client secret after setting it. Unmount and create a new instance of EmbeddedCheckoutProvider instead."),f.fetchClientSecret!=null&&r.fetchClientSecret!==f.fetchClientSecret&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change fetchClientSecret after setting it. Unmount and create a new instance of EmbeddedCheckoutProvider instead."),f.onComplete!=null&&r.onComplete!==f.onComplete&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onComplete option after setting it."),f.onShippingDetailsChange!=null&&r.onShippingDetailsChange!==f.onShippingDetailsChange&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onShippingDetailsChange option after setting it."),f.onLineItemsChange!=null&&r.onLineItemsChange!==f.onLineItemsChange&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onLineItemsChange option after setting it.")}},[f,r]),c.createElement(J.Provider,{value:h},o)},rt=function(e){var t=e.id,r=e.className,o=he(),i=o.embeddedCheckout,a=c.useRef(!1),u=c.useRef(null);return c.useLayoutEffect(function(){return!a.current&&i&&u.current!==null&&(i.mount(u.current),a.current=!0),function(){if(a.current&&i)try{i.unmount(),a.current=!1}catch{}}},[i]),c.createElement("div",{ref:u,id:t,className:r})},nt=function(e){var t=e.id,r=e.className;return he(),c.createElement("div",{id:t,className:r})},ot=b?nt:rt;C("auBankAccount",b);C("card",b);C("cardNumber",b);C("cardExpiry",b);C("cardCvc",b);C("iban",b);C("payment",b);C("expressCheckout",b);C("paymentRequestButton",b);C("linkAuthentication",b);C("address",b);C("shippingAddress",b);C("paymentMethodMessaging",b);C("taxId",b);const it=Me(void 0),gt=Se(function(){const{token:e,packId:t,slug:r}=Ee(),[o,i]=j.useState(null),[a,u]=j.useState(null),s=xe(),[m,h]=j.useState(""),[x,l]=j.useState(null),[f,k]=j.useState(!1),[S,L]=j.useState("summary"),[w,V]=j.useState(null);j.useEffect(()=>{!t||!e||N()},[t,e,r]);const N=(R,_)=>{k(!0);const D={packId:t,couponCode:R};_&&(D.giftCardCode=_),ke("/commerce/checkout/session",e,{method:"POST",headers:{"X-Tenant-Slug":r},body:JSON.stringify(D)}).then(O=>{O.error?u(O.error):(i(O.clientSecret),u(null))}).catch(O=>{u(O.message||"Failed to initialize checkout.")}).finally(()=>k(!1))},B=async()=>{m&&N(m)};return a?p.jsxs("div",{className:"max-w-md mx-auto py-12 text-center",children:[p.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg mb-4",children:a}),p.jsx("button",{onClick:()=>s(-1),className:"text-blue-600 hover:underline",children:"Go Back"})]}):o?p.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4",children:[p.jsxs("button",{onClick:()=>s(-1),className:"flex items-center text-sm text-zinc-500 hover:text-zinc-900 mb-6",children:[p.jsx(je,{className:"h-4 w-4 mr-1"}),"Back"]}),p.jsx("div",{className:"mb-6 space-y-4",children:p.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm space-y-4",children:[p.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest pl-1",children:"Apply Promotion"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("input",{type:"text",placeholder:"Promo Code",className:"flex-1 border-none bg-zinc-100 rounded-xl px-4 py-3 text-sm uppercase font-mono outline-none focus:ring-2 focus:ring-blue-500",value:m,onChange:R=>h(R.target.value.toUpperCase())}),p.jsx("button",{onClick:B,disabled:f||!m,className:"bg-zinc-900 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-zinc-800 disabled:opacity-50 transition-all",children:"Apply"})]}),p.jsx("div",{className:"pt-2 border-t border-zinc-50",children:p.jsx(Pe,{token:e,slug:r,onApply:R=>N(m,R.code),onRemove:()=>N(m)})})]})}),p.jsx("div",{id:"checkout",className:"bg-white p-6 rounded-lg shadow-sm border border-zinc-200",children:p.jsx(tt,{stripe:it,options:{clientSecret:o},children:p.jsx(ot,{})})})]}):p.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});export{gt as default};
