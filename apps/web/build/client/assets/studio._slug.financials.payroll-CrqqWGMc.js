import{w as J,c as _}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as r}from"./vendor-sentry-DugYw-Ne.js";import{a as g}from"./api-ChCisjdG.js";import{t as u}from"./index-CNiSO0Vl.js";import{D,f as G,a as T,b as M,c as I,d as A}from"./dialog-B0FHXBPK.js";import{C as $}from"./ConfirmDialog-CNYLpd2V.js";import{L as q}from"./loader-circle-DYdrNEzV.js";import{D as O}from"./dollar-sign-BvRwH14e.js";import{C as B}from"./circle-check-BXm1-ma4.js";import{C as U}from"./circle-alert-BKf4ej_b.js";import{f as F}from"./vendor-date-fns-0CaSm0ev.js";import"./dialog-D_UahLgr.js";import"./portal-B9V3iLbl.js";import"./vendor-charts-BaZHU4KA.js";import"./x-Bbpoc0N5.js";import"./createLucideIcon-BOpDDQ2B.js";import"./button-CCL9t_KM.js";function V({defaultValue:a,className:i,children:o,...c}){return e.jsx(K,{defaultValue:a,className:i,children:o})}const k=r.createContext(null);function K({defaultValue:a,children:i,className:o}){const[c,d]=r.useState(a);return e.jsx(k.Provider,{value:{activeTab:c,setActiveTab:d},children:e.jsx("div",{className:o,children:i})})}function Q({className:a,children:i}){return e.jsx("div",{className:`inline-flex h-9 items-center justify-center rounded-lg bg-zinc-100 p-1 text-zinc-500 dark:bg-zinc-800 dark:text-zinc-400 ${a}`,children:i})}function z({value:a,children:i,className:o}){const{activeTab:c,setActiveTab:d}=r.useContext(k),l=c===a;return e.jsx("button",{onClick:()=>d(a),className:`inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 
            ${l?"bg-white text-zinc-950 shadow-sm dark:bg-zinc-950 dark:text-zinc-50":"hover:bg-zinc-200 dark:hover:bg-zinc-700"} 
            ${o}`,children:i})}function C({value:a,children:i,className:o}){const{activeTab:c}=r.useContext(k);return c!==a?null:e.jsx("div",{className:`mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 ${o}`,children:i})}const ge=J(function(){const{tenant:i,token:o}=_();return o?e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Instructor Payroll"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Automate calculation and tracking of payouts."})]}),e.jsxs(V,{defaultValue:"run",className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(z,{value:"run",children:"Run Payroll"}),e.jsx(z,{value:"history",children:"History"}),e.jsx(z,{value:"config",children:"Configuration"})]}),e.jsx(C,{value:"run",children:e.jsx(W,{token:o})}),e.jsx(C,{value:"history",children:e.jsx(X,{token:o})}),e.jsx(C,{value:"config",children:e.jsx(Y,{token:o})})]})]}):e.jsxs("div",{className:"p-8 flex items-center gap-2 text-zinc-500",children:[e.jsx(q,{className:"animate-spin"})," Loading access token..."]})});function W({token:a}){const[i,o]=r.useState(F(new Date(new Date().setDate(1)),"yyyy-MM-dd")),[c,d]=r.useState(F(new Date,"yyyy-MM-dd")),[l,m]=r.useState(null),[h,x]=r.useState(!1),[b,f]=r.useState(!1),p=async()=>{x(!0);try{const n=await g("/payroll/generate",a,{method:"POST",body:JSON.stringify({startDate:i,endDate:c,commit:!1})});if(n.error){u.error(n.error);return}m(n.preview||[])}catch(n){console.error(n),u.error("Failed to generate preview")}finally{x(!1)}},j=async()=>{f(!0)};return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Generate Cycle"}),e.jsxs("div",{className:"flex gap-4 items-end mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:i,onChange:n=>o(n.target.value),className:"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:c,onChange:n=>d(n.target.value),className:"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"})]}),e.jsx("button",{onClick:p,disabled:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:h?"Processing...":"Preview Calculation"})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-zinc-700 dark:text-zinc-300",children:"Total Calculation"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",(l.reduce((n,t)=>n+t.amount,0)/100).toFixed(2)]})]}),e.jsx("div",{className:"space-y-2",children:l.map(n=>e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded p-4 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-zinc-900 dark:text-zinc-100",children:["Instructor ID: ",n.instructorId.substring(0,8),"..."]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[n.itemCount," items calculated"]}),e.jsx("ul",{className:"mt-2 text-xs text-zinc-500 space-y-1",children:n.items.map((t,N)=>e.jsxs("li",{children:["â€¢ ",t.title," (",new Date(t.date).toLocaleDateString(),"): ",t.details," = ",e.jsxs("strong",{children:["$",(t.amount/100).toFixed(2)]})]},N))})]}),e.jsxs("div",{className:"text-lg font-bold",children:["$",(n.amount/100).toFixed(2)]})]},n.instructorId))}),l.length===0&&e.jsx("div",{className:"text-zinc-500 text-sm",children:"No payouts calculated for this period. check configurations or activity."}),l.length>0&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:j,disabled:h,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow font-medium",children:"Generate & Save"})})]})]})}function X({token:a}){const[i,o]=r.useState([]),[c,d]=r.useState(null),[l,m]=r.useState(null),[h,x]=r.useState(!1),b=async()=>{const t=await g("/payroll/history",a);o(t.history)};r.useEffect(()=>{b()},[]);const f=t=>{d(t)},p=async()=>{c&&(await g(`/payroll/${c}/approve`,a,{method:"POST"}),b(),d(null))},j=t=>{m(t)},n=async()=>{if(l){x(!0);try{const t=await g(`/payroll/${l}/pay`,a,{method:"POST"});t.error?u.error("Payment Failed: "+t.error):(u.success("Payment Successful! Transfer ID: "+t.transferId),b())}catch(t){u.error("Payment Error: "+t.message)}finally{x(!1),m(null)}}};return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",children:[e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Period"}),e.jsx("th",{className:"p-4",children:"Instructor"}),e.jsx("th",{className:"p-4",children:"Amount"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:[i.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"p-4",children:[new Date(t.periodStart).toLocaleDateString()," - ",new Date(t.periodEnd).toLocaleDateString()]}),e.jsxs("td",{className:"p-4 font-medium",children:[e.jsxs("div",{children:[t.instructorFirstName," ",t.instructorLastName]}),t.stripeAccountId&&e.jsx("div",{className:"text-[10px] text-green-600 font-mono",children:"Connected"})]}),e.jsxs("td",{className:"p-4 font-mono font-medium",children:["$",(t.amount/100).toFixed(2)]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="paid"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:t.status.toUpperCase()})}),e.jsxs("td",{className:"p-4 flex gap-2",children:[t.status!=="paid"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(t.id),className:"text-zinc-600 hover:text-zinc-900 text-xs font-medium border border-zinc-200 rounded px-2 py-1",children:"Mark Paid (Manual)"}),t.stripeAccountId&&e.jsxs("button",{onClick:()=>j(t.id),className:"text-white bg-green-600 hover:bg-green-700 text-xs font-medium rounded px-2 py-1 shadow-sm flex items-center gap-1",children:[e.jsx(O,{size:12})," Pay Now"]})]}),t.status==="paid"&&t.paidAt&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["Paid ",new Date(t.paidAt).toLocaleDateString()]})]})]},t.id)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-zinc-500",children:"No history found."})})]})]}),e.jsx($,{open:!!c,onOpenChange:t=>!t&&d(null),onConfirm:p,title:"Mark as Paid",description:"Are you sure you want to manually mark this record as paid?",confirmText:"Mark Paid"}),e.jsx($,{open:!!l,onOpenChange:t=>!t&&m(null),onConfirm:n,title:"Process Stripe Transfer",description:"This will instantly transfer funds from your platform balance to the instructor's connected Stripe account. This cannot be undone.",confirmText:h?"Processing...":"Pay Now"})]})}function Y({token:a}){const[i,o]=r.useState([]),[c,d]=r.useState(null),[l,m]=r.useState("flat"),[h,x]=r.useState("0"),[b,f]=r.useState(!1),[p,j]=r.useState(null),[n,t]=r.useState(""),[N,w]=r.useState(""),[v,P]=r.useState(!1),R=s=>{j(s),t(""),w(""),f(!0)},E=async()=>{if(!(!p||!n)){P(!0);try{const s=Math.round(parseFloat(n)*100),y=await g("/payroll/transfer",a,{method:"POST",body:JSON.stringify({instructorId:p.memberId,amount:s,notes:N||"Manual Ad-Hoc Payout"})});y.error?u.error(y.error):(u.success("Transfer Successful"),f(!1))}catch(s){u.error(s.message)}finally{P(!1)}}},S=async()=>{try{const s=await g("/payroll/config",a);if(s.error){u.error("Failed to load config: "+s.error);return}o(s.instructors||[])}catch(s){console.error("Config fetch error",s),u.error("Could not load instructor list")}};r.useEffect(()=>{S()},[]);const L=async()=>{if(!c)return;let s=parseFloat(h);s=Math.round(s*100),await g("/payroll/config",a,{method:"POST",body:JSON.stringify({memberId:c,payModel:l,rate:s})}),d(null),S()},H=s=>{d(s.memberId),s.config?.payModel?(m(s.config.payModel),x((s.config.rate/100).toString())):(m("flat"),x("0"))};return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",children:[e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Stripe Status"}),e.jsx("th",{className:"p-4",children:"Current Model"}),e.jsx("th",{className:"p-4",children:"Rate"}),e.jsx("th",{className:"p-4",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:i.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"p-4 font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"p-4",children:s.stripeAccountId?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600 font-medium bg-green-50 px-2 py-0.5 rounded-full",children:[e.jsx(B,{size:12})," Connected"]}):e.jsx("span",{className:"inline-flex items-center gap-1 text-xs text-zinc-400 font-medium bg-zinc-100 px-2 py-0.5 rounded-full",children:"Not Connected"})}),e.jsx("td",{className:"p-4 text-zinc-600 dark:text-zinc-400 capitalize",children:s.config?s.config.payModel:"Not Set"}),e.jsx("td",{className:"p-4 font-mono",children:s.config?s.config.payModel==="percentage"?`${s.config.rate/100}%`:`$${(s.config.rate/100).toFixed(2)}`:"-"}),e.jsxs("td",{className:"p-4 flex gap-2",children:[e.jsxs(D,{children:[e.jsx(G,{asChild:!0,children:e.jsx("button",{onClick:()=>H(s),className:"text-zinc-600 hover:text-zinc-900 font-medium text-xs border border-zinc-200 rounded px-3 py-1.5",children:"Configure"})}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(I,{children:"Configure Payroll"}),e.jsxs(A,{children:["Set default pay rate for ",s.firstName,"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Pay Model"}),e.jsxs("select",{className:"w-full rounded border border-zinc-300 p-2",value:l,onChange:y=>m(y.target.value),children:[e.jsx("option",{value:"flat",children:"Flat Rate (Per Class)"}),e.jsx("option",{value:"hourly",children:"Hourly Rate"}),e.jsx("option",{value:"percentage",children:"Revenue Share (%)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:l==="percentage"?"Percentage (%)":"Rate ($)"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full rounded border border-zinc-300 p-2",value:h,onChange:y=>x(y.target.value)})]}),e.jsx("button",{onClick:L,className:"w-full bg-blue-600 text-white rounded py-2 font-medium",children:"Save Configuration"})]})]})]}),s.stripeAccountId&&e.jsxs("button",{onClick:()=>R(s),className:"bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded px-3 py-1.5 shadow-sm flex items-center gap-1",children:[e.jsx(O,{size:12})," Pay"]})]})]},s.memberId))})]}),e.jsx(D,{open:b,onOpenChange:f,children:e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(I,{children:"Manual Payout"}),e.jsxs(A,{children:["Send an ad-hoc payment to ",p?.firstName,"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Amount ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-zinc-500",children:"$"}),e.jsx("input",{type:"number",min:"0.50",step:"0.01",value:n,onChange:s=>t(s.target.value),className:"w-full pl-8 p-2 border border-zinc-300 rounded",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note / Reference"}),e.jsx("input",{type:"text",value:N,onChange:s=>w(s.target.value),className:"w-full p-2 border border-zinc-300 rounded",placeholder:"e.g. Bonus for weekend workshop"})]}),e.jsxs("div",{className:"bg-yellow-50 text-yellow-800 text-xs p-3 rounded flex gap-2",children:[e.jsx(U,{size:16,className:"shrink-0"}),e.jsx("p",{children:"Funds will be transferred immediately from your platform balance to the instructor's Stripe account. This cannot be undone."})]}),e.jsx("button",{onClick:E,disabled:v||!n,className:`w-full py-2 rounded font-medium text-white ${v?"bg-zinc-400":"bg-green-600 hover:bg-green-700"}`,children:v?"Processing...":"Transfer Funds"})]})]})})]})}export{ge as default};
