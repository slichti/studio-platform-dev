import{r as l,w as R,v as W,I as E,A as L,P as B,J as k}from"./chunk-JMJ3UQ3L-DmAaMJDT.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{M as O}from"./Modal-BDlUPslI.js";import{u as U}from"./chunk-OT5FTIRN-DtMOiK0s.js";import"./index-B-TQESlZ.js";function F({onChange:p,width:b=500,height:f=200}){const c=l.useRef(null),[g,h]=l.useState(!1),[y,u]=l.useState(!1);l.useEffect(()=>{const t=c.current;if(!t)return;const n=t.getContext("2d");n&&(n.lineWidth=2,n.lineCap="round",n.strokeStyle="#000000")},[]);const v=t=>{if(!g)return;const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect();let o,i;"touches"in t?(o=t.touches[0].clientX-s.left,i=t.touches[0].clientY-s.top):(o=t.clientX-s.left,i=t.clientY-s.top),r.lineTo(o,i),r.stroke(),r.beginPath(),r.moveTo(o,i)},x=t=>{h(!0);const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect(),o=t.clientX-s.left,i=t.clientY-s.top;r.beginPath(),r.moveTo(o,i)},m=t=>{t.preventDefault();const n=c.current;if(!n)return;const r=n.getContext("2d");r&&(r.clearRect(0,0,n.width,n.height),u(!1),p(null))};return e.jsxs("div",{className:"border border-zinc-300 rounded-lg overflow-hidden bg-white inline-block",children:[e.jsx("canvas",{ref:c,width:b,height:f,className:"touch-none cursor-crosshair bg-white",onMouseDown:x,onMouseMove:t=>{g&&v(t)},onMouseUp:()=>{h(!1);const t=c.current;t&&(t.getContext("2d")?.beginPath(),p(t.toDataURL()),u(!0))},onMouseLeave:()=>{h(!1);const t=c.current;t&&g&&(t.getContext("2d")?.beginPath(),p(t.toDataURL()),u(!0))},onTouchStart:t=>{const n=c.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const s=n.getBoundingClientRect(),o=t.touches[0].clientX-s.left,i=t.touches[0].clientY-s.top;r.beginPath(),r.moveTo(o,i),h(!0)},onTouchMove:t=>{g&&v(t)},onTouchEnd:()=>{h(!1);const t=c.current;t&&(t.getContext("2d")?.beginPath(),p(t.toDataURL()),u(!0))}}),e.jsxs("div",{className:"bg-zinc-50 border-t border-zinc-200 p-2 flex justify-between items-center px-4",children:[e.jsx("span",{className:"text-xs text-zinc-500",children:"Sign above"}),e.jsx("button",{type:"button",onClick:m,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear Signature"})]})]})}const H=R(function(){const{data:b,error:f}=W(),{me:c,roles:g}=E(),h=g.includes("owner"),[y,u]=l.useState(!1),x=L().state==="submitting",m=B(),{getToken:t}=U(),[n,r]=l.useState(!1),[s,o]=l.useState(null);if(l.useEffect(()=>{m?.success&&!x&&u(!1)},[m,x]),f)return e.jsxs("div",{className:"text-red-600",children:["Error: ",f]});if(h){const a=b?.templates||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Waivers & Forms"}),e.jsx("button",{onClick:()=>u(!0),style:{background:"var(--accent)",color:"white"},className:"px-4 py-2 rounded-md hover:opacity-90 text-sm font-medium",children:"+ Create Waiver"})]}),e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-700",children:"No waiver templates created yet."}):a.map(d=>e.jsxs("div",{className:"p-6 rounded-lg shadow-sm bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100",children:d.title}),e.jsxs(k,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"toggle_active"}),e.jsx("input",{type:"hidden",name:"templateId",value:d.id}),e.jsx("input",{type:"hidden",name:"active",value:(!d.active).toString()}),e.jsx("button",{type:"submit",className:`text-xs px-2 py-1 rounded border ${d.active?"bg-green-100 text-green-800 border-green-200 hover:bg-green-200":"bg-zinc-100 text-zinc-800 border-zinc-200 hover:bg-zinc-200"}`,children:d.active?"Active":"Inactive"})]})]}),e.jsx("div",{className:"text-sm line-clamp-3 mb-4 whitespace-pre-wrap p-3 rounded bg-zinc-50 dark:bg-zinc-800/50 text-zinc-500 dark:text-zinc-400",children:d.content})]},d.id))}),e.jsx(O,{isOpen:y,onClose:()=>u(!1),title:"Create Waiver",children:e.jsxs(k,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"create"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Title"}),e.jsx("input",{name:"title",required:!0,placeholder:"Liability Release",className:"w-full rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Content"}),e.jsx("textarea",{name:"content",required:!0,rows:10,className:"w-full rounded px-3 py-2 font-mono text-sm focus:ring-2 focus:ring-blue-500 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100",placeholder:"Legal text here..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Create from PDF (Optional)"}),e.jsx("input",{type:"file",accept:".pdf",onChange:async d=>{const S=d.target.files?.[0];if(S){r(!0);try{const z=await t(),P=window.location.pathname.split("/")[2],C=new FormData;C.append("file",S);const w=await fetch("https://studio-platform-api.slichti.workers.dev/uploads/pdf",{method:"POST",headers:{Authorization:`Bearer ${z}`,"X-Tenant-Slug":P},body:C});if(!w.ok)throw new Error(await w.text());const T=await w.json(),D=document.getElementById("pdf-url-input");D&&(D.value=T.url),alert("PDF Uploaded successfully!")}catch(z){alert("Upload failed: "+z.message)}finally{r(!1)}}},className:"block w-full text-sm text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx("input",{type:"hidden",name:"pdfUrl",id:"pdf-url-input"})]}),m&&"error"in m&&m.error&&e.jsxs("div",{className:"text-red-600 text-sm bg-red-50 p-2 rounded border border-red-200",children:["Error saving: ",m.error]}),e.jsx("button",{disabled:x||n,style:{background:"var(--accent)",color:"white"},className:"w-full py-2 rounded font-medium disabled:opacity-50",children:x?"Saving...":"Save Waiver"})]})]})})]})}const{waiver:i,required:I,signed:A,signatureDate:X,family:N}=b||{},[j,M]=l.useState(null);return!I||!i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-medium text-zinc-900 dark:text-zinc-100",children:"Good to go!"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"No pending waivers to sign."})]}):e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-zinc-900 dark:text-zinc-100",children:i.title}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-8 shadow-sm mb-6 max-h-[500px] overflow-y-auto",children:e.jsx("div",{className:"prose dark:prose-invert text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap",children:i.content})}),N?.length>0&&e.jsxs("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",children:"Who are you signing for?"}),e.jsxs("select",{className:"w-full bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded-md text-sm",value:j||"",onChange:a=>M(a.target.value||null),children:[e.jsxs("option",{value:"",children:["Myself ",b.signed?"✅":""]}),N.map(a=>e.jsxs("option",{value:a.memberId,children:[a.firstName," ",a.lastName," ",b.signedMemberIds?.includes(a.memberId)?"✅":""]},a.memberId))]})]}),b.signedMemberIds?.includes(j||c?.id)?e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 p-4 rounded-lg flex items-center justify-center gap-2",children:"✅ This member has signed the waiver."}):e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg p-6",children:[e.jsx("h3",{className:"font-bold mb-4 dark:text-white",children:"Sign Waiver"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Please draw your signature below to accept this agreement."}),e.jsxs("div",{className:"mb-6",children:[e.jsx(F,{onChange:a=>o(a),width:600,height:200}),s&&e.jsxs("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Signature captured"]})]}),e.jsxs(k,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:"sign"}),e.jsx("input",{type:"hidden",name:"templateId",value:i.id}),e.jsx("input",{type:"hidden",name:"signatureData",value:s||""}),e.jsx("input",{type:"hidden",name:"onBehalfOfMemberId",value:j||""}),e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx("input",{type:"checkbox",required:!0,id:"agree",className:"mt-1"}),e.jsx("label",{htmlFor:"agree",className:"text-sm text-zinc-700 dark:text-zinc-300",children:"I have read and agree to the terms of this waiver. By drawing my signature above and checking this box, I electronically sign this document."})]}),e.jsx("button",{disabled:!s||x,className:"w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Signing...":"Sign Waiver"})]})]})]})});export{H as default};
