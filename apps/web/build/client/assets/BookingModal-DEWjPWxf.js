import{j as e}from"./vendor-puck-EFhZVjRu.js";import{a as m}from"./vendor-sentry-BD1MTpLq.js";import{M as z}from"./Modal-adSWkWLD.js";import{a as k}from"./api-D1U4i9fn.js";import{d as w,i as C}from"./chunk-JMJ3UQ3L-DIHTCPR9.js";import{u as P}from"./chunk-OT5FTIRN-BMaHWN1z.js";import{X as I}from"./x-6mvJS0UK.js";import{U as T}from"./user-B9JVtPOG.js";import{U as S}from"./users-DTyswlyE.js";import{K as j,h as v}from"./dialog-BbMbq4lO.js";function W({isOpen:h,onClose:l,onSuccess:t,locations:g=[],instructors:b=[],plans:d=[]}){const{getToken:a}=P(),{slug:p}=w(),[x,i]=m.useState(!1),[N,f]=m.useState(""),[r,s]=m.useState({name:"",description:"",instructorId:"",locationId:"",startTime:"",durationMinutes:60,capacity:20,price:0,isRecurring:!1,recurrencePattern:"weekly",recurrenceEndDate:"",createZoom:!1,minEnrollment:1,autoCancelThreshold:2,autoCancelEnabled:!1,type:"class",memberPrice:"",allowCredits:!0,includedPlanIds:[],recurringDays:[]}),y=async n=>{n.preventDefault(),i(!0),f("");try{const o=await a();let u;r.isRecurring&&(u=r.recurrencePattern==="weekly"?"FREQ=WEEKLY":"FREQ=DAILY",r.recurrencePattern==="weekly"&&r.recurringDays.length>0&&(u+=`;BYDAY=${r.recurringDays.join(",")}`));const c=await k("/classes",o,{method:"POST",headers:{"X-Tenant-Slug":p},body:JSON.stringify({title:r.name,description:r.description,instructorId:r.instructorId,locationId:r.locationId||void 0,startTime:new Date(r.startTime).toISOString(),durationMinutes:Number(r.durationMinutes),capacity:Number(r.capacity),price:Number(r.price),createZoomMeeting:r.createZoom,isRecurring:r.isRecurring,recurrenceRule:u,recurrenceEnd:r.recurrenceEndDate?new Date(r.recurrenceEndDate).toISOString():void 0,minStudents:Number(r.minEnrollment),autoCancelThreshold:Number(r.autoCancelThreshold),autoCancelEnabled:r.autoCancelEnabled,type:r.type,memberPrice:r.memberPrice?Number(r.memberPrice):null,allowCredits:r.allowCredits,includedPlanIds:r.includedPlanIds})});c.error?f(c.error):(t(c.class||c),l(),s({name:"",description:"",instructorId:"",locationId:"",startTime:"",durationMinutes:60,capacity:20,price:0,isRecurring:!1,recurrencePattern:"weekly",recurrenceEndDate:"",createZoom:!1,minEnrollment:1,autoCancelThreshold:2,autoCancelEnabled:!1,type:"class",memberPrice:"",allowCredits:!0,includedPlanIds:[],recurringDays:[]}))}catch(o){f(o.message||"Failed to create class")}finally{i(!1)}};return e.jsx(z,{isOpen:h,onClose:l,title:"Schedule Class",children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[N&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 rounded text-sm",children:N}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Class Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r.name,onChange:n=>s({...r,name:n.target.value}),placeholder:"e.g. Morning Vinyasa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Instructor"}),e.jsxs("select",{required:!0,className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:r.instructorId,onChange:n=>s({...r,instructorId:n.target.value}),children:[e.jsx("option",{value:"",children:"Select Instructor"}),b.map(n=>e.jsxs("option",{value:n.id,children:[n.user?.profile?.firstName," ",n.user?.profile?.lastName]},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Class Type"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:r.type,onChange:n=>s({...r,type:n.target.value}),children:[e.jsx("option",{value:"class",children:"Regular Class"}),e.jsx("option",{value:"workshop",children:"Workshop"}),e.jsx("option",{value:"event",children:"Event"}),e.jsx("option",{value:"appointment",children:"Appointment (Private)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Location"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:r.locationId,onChange:n=>s({...r,locationId:n.target.value}),children:[e.jsx("option",{value:"",children:"Select Location (Optional)"}),g.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.createZoom,onChange:n=>s({...r,createZoom:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable Zoom (Virtual Access)"})]}),r.createZoom&&e.jsx("p",{className:"text-xs text-zinc-500 ml-6 mt-1",children:"A Zoom meeting will be created automatically."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",required:!0,step:"600",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r.startTime,onChange:n=>s({...r,startTime:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Duration (min)"}),e.jsx("input",{type:"number",required:!0,min:"15",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r.durationMinutes,onChange:n=>s({...r,durationMinutes:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Capacity"}),e.jsx("input",{type:"number",required:!0,min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r.capacity,onChange:n=>s({...r,capacity:Number(n.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Price ($)"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:r.price,onChange:n=>s({...r,price:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"bg-zinc-50 border border-zinc-200 p-4 rounded-lg space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 border-b border-zinc-200 pb-2",children:"Access & Pricing Rules"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Member Price ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:r.memberPrice,onChange:n=>s({...r,memberPrice:n.target.value}),placeholder:"Optional"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.allowCredits,onChange:n=>s({...r,allowCredits:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Accept Class Packs/Credits?"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Included Free in Plans:"}),e.jsxs("div",{className:"max-h-24 overflow-y-auto border border-zinc-300 rounded bg-white p-2 space-y-1",children:[d.map(n=>e.jsxs("label",{className:"flex items-center gap-2 text-xs hover:bg-zinc-50 p-1 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.includedPlanIds.includes(n.id),onChange:o=>{const u=o.target.checked?[...r.includedPlanIds,n.id]:r.includedPlanIds.filter(c=>c!==n.id);s({...r,includedPlanIds:u})},className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:n.name})]},n.id)),d.length===0&&e.jsx("span",{className:"text-zinc-400 italic",children:"No plans found."})]})]})]}),e.jsxs("div",{className:"bg-zinc-50 border border-zinc-200 p-4 rounded-lg space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 border-b border-zinc-200 pb-2",children:"Enrollment Policies"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Min. Enrollment to Run"}),e.jsx("input",{type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:r.minEnrollment,onChange:n=>s({...r,minEnrollment:Number(n.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Auto-Cancel Cutoff (hrs)"}),e.jsx("input",{type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:r.autoCancelThreshold,onChange:n=>s({...r,autoCancelThreshold:Number(n.target.value)}),placeholder:"Hours before start"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.autoCancelEnabled,onChange:n=>s({...r,autoCancelEnabled:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable automatic cancellation if minimum is not met"})]})]}),e.jsxs("div",{className:"border-t border-zinc-200 pt-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.isRecurring,onChange:n=>s({...r,isRecurring:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Repeat this class"})]}),r.isRecurring&&e.jsxs("div",{className:"mt-3 p-3 bg-zinc-50 rounded border border-zinc-200 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Frequency"}),e.jsxs("select",{className:"w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",value:r.recurrencePattern,onChange:n=>s({...r,recurrencePattern:n.target.value}),children:[e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"daily",children:"Daily"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"End Date"}),e.jsx("input",{type:"date",required:r.isRecurring,className:"w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",value:r.recurrenceEndDate,onChange:n=>s({...r,recurrenceEndDate:n.target.value}),min:r.startTime?new Date(r.startTime).toISOString().split("T")[0]:void 0})]})]}),r.recurrencePattern==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-2",children:"Repeat On"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"Mon",value:"MO"},{label:"Tue",value:"TU"},{label:"Wed",value:"WE"},{label:"Thu",value:"TH"},{label:"Fri",value:"FR"},{label:"Sat",value:"SA"},{label:"Sun",value:"SU"}].map(n=>e.jsxs("label",{className:`
                                                flex items-center justify-center w-8 h-8 rounded-full text-xs font-medium cursor-pointer transition-colors border
                                                ${r.recurringDays.includes(n.value)?"bg-blue-600 text-white border-blue-600":"bg-white text-zinc-600 border-zinc-200 hover:border-blue-300"}
                                            `,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:r.recurringDays.includes(n.value),onChange:o=>{const u=o.target.checked?[...r.recurringDays,n.value]:r.recurringDays.filter(c=>c!==n.value);s({...r,recurringDays:u})}}),n.label[0]]},n.value))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-md hover:bg-zinc-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:x?"Scheduling...":"Schedule Class"})]})]})})}function U({isOpen:h,onClose:l,classEvent:t,family:g,member:b}){const d=C(),[a,p]=m.useState("in_person");if(!t)return null;const x=!t.zoomEnabled&&(t.confirmedCount||0)>=(t.capacity||1/0);return e.jsx(j,{appear:!0,show:h,as:m.Fragment,children:e.jsxs(v,{as:"div",className:"relative z-50",onClose:l,children:[e.jsx(j.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(j.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(v.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-zinc-900 p-6 text-left align-middle shadow-xl transition-all border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs(v.Title,{as:"h3",className:"text-lg font-bold leading-6 text-zinc-900 dark:text-zinc-100",children:["Book ",t.title]}),e.jsx("button",{onClick:l,className:"text-zinc-400 hover:text-zinc-500",children:e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[t.zoomEnabled&&e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-lg text-sm border border-zinc-200 dark:border-zinc-700",children:[e.jsx("p",{className:"font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"Attendance Preference"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType",checked:a==="in_person",onChange:()=>p("in_person"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:"In-Person"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType",checked:a==="zoom",onChange:()=>p("zoom"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:"Virtual (Zoom)"})]})]})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-lg text-sm border border-zinc-200 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-semibold text-zinc-900 dark:text-zinc-100",children:"Price"}),e.jsx("span",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:b?.memberships?.some(i=>i.status==="active"&&t.includedPlanIds?.includes(i.planId))?e.jsx("span",{className:"text-green-600",children:"Free (Included)"}):t.allowCredits&&b?.purchasedPacks?.some(i=>i.remainingCredits>0)?e.jsx("span",{className:"text-blue-600",children:"1 Credit"}):b&&t.memberPrice!==void 0&&t.memberPrice!==null?e.jsxs("span",{children:["$",t.memberPrice.toFixed(2)," ",e.jsxs("span",{className:"text-xs font-normal text-zinc-500 line-through",children:["$",t.price]})]}):t.price?`$${t.price.toFixed(2)}`:"Free"})]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[t.type==="workshop"?"Workshop":"Class"," • ",t.durationMinutes," min"]})]}),e.jsx("div",{className:"text-sm",children:x&&a==="in_person"?e.jsx("div",{className:"text-amber-600 mb-2 font-medium",children:"Class is full. You will be added to the waitlist."}):e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-2",children:"Who is this booking for?"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d.Form,{method:"post",action:`/studio/${window.location.pathname.split("/")[2]}/classes?index`,onSubmit:()=>l(),children:[e.jsx("input",{type:"hidden",name:"classId",value:t.id}),e.jsx("input",{type:"hidden",name:"attendanceType",value:a}),e.jsx("input",{type:"hidden",name:"intent",value:x&&a==="in_person"?"waitlist":"book"}),e.jsxs("button",{type:"submit",disabled:d.state!=="idle",className:"w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(T,{size:16})}),e.jsx("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:"Myself"})]}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100",children:"→"})]})]}),g.map(i=>e.jsxs(d.Form,{method:"post",action:`/studio/${window.location.pathname.split("/")[2]}/classes?index`,onSubmit:()=>l(),children:[e.jsx("input",{type:"hidden",name:"classId",value:t.id}),e.jsx("input",{type:"hidden",name:"memberId",value:i.memberId||""}),e.jsx("input",{type:"hidden",name:"attendanceType",value:a}),e.jsx("input",{type:"hidden",name:"intent",value:x&&a==="in_person"?"waitlist":"book"}),e.jsxs("button",{type:"submit",disabled:d.state!=="idle",className:"w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-full text-purple-600 dark:text-purple-400",children:e.jsx(S,{size:16})}),e.jsxs("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:[i.firstName," ",i.lastName]})]}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100",children:"→"})]})]},i.userId))]})]})]})})})})]})})}export{U as B,W as C};
