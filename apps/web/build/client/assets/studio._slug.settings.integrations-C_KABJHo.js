import{w as X,d as H,e as J}from"./chunk-JMJ3UQ3L-DIHTCPR9.js";import{j as e}from"./vendor-puck-EFhZVjRu.js";import{a as i}from"./vendor-sentry-BD1MTpLq.js";import{a}from"./api-OnQO3erh.js";import{C as j,a as w,b as v,c as N,d as k}from"./Card-Bhh18rui.js";import{t as r}from"./index-0-uDmKCt.js";import{C as g}from"./Dialogs-CRbAoiUz.js";import{L as C}from"./loader-circle-CaGZsKjo.js";import{C as _}from"./credit-card-BC1Ru1Ky.js";import{S as q}from"./shield-BH971nBf.js";import{M as B}from"./mail-BVU9VLVw.js";import{S as Y}from"./send-BNR5q9Wk.js";import{M as I}from"./message-square-DXFYk9Nj.js";import{T as V}from"./terminal-B-Ek4Gh_.js";import{T as Q}from"./trash-2-DU-4PZMS.js";import{C as Z}from"./circle-check-big-Cgvy_36a.js";import"./Modal-adSWkWLD.js";import"./createLucideIcon-DgXJrNmH.js";const Ce=X(function(){const{slug:o}=H(),{tenant:t}=J()||{},[h,z]=i.useState([]),[K,S]=i.useState(!0),[c,T]=i.useState(""),[D,W]=i.useState("booking.created, order.completed"),[A,P]=i.useState(!1),[E,M]=i.useState(null),[se,te]=i.useState(!1),[ne,O]=i.useState({accountSid:"",authToken:"",fromNumber:""}),[ie,$]=i.useState({apiKey:""}),[re,oe]=i.useState(!1),[m,f]=i.useState(null),[L,b]=i.useState(!1),[l,p]=i.useState(null),[u,F]=i.useState(null);i.useEffect(()=>{y()},[o]);const y=async()=>{S(!0);try{const s=window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token"),[n,d]=await Promise.all([a("/integrations/webhooks",s,{headers:{"X-Tenant-Slug":o||""}}),a("/integrations/credentials",s,{headers:{"X-Tenant-Slug":o||""}})]);z(n.endpoints||[]),M(d),O({accountSid:d.twilio?.accountSid||"",authToken:"",fromNumber:d.twilio?.fromNumber||""}),$({apiKey:d.resend?.apiKey||""})}catch(s){console.error("Failed to load data",s)}finally{S(!1)}},x=async s=>{try{const n=await window.Clerk?.session?.getToken();await a(`/studios/${t.id}/integrations`,n,{method:"PUT",headers:{"X-Tenant-Slug":o||""},body:JSON.stringify(s)}),r.success("Settings saved successfully."),window.location.reload()}catch(n){r.error(n.message||"Failed to save")}},R=async()=>{if(c){P(!0);try{const s=await window.Clerk?.session?.getToken();await a("/integrations/webhooks",s,{method:"POST",headers:{"X-Tenant-Slug":o||""},body:JSON.stringify({url:c,events:D.split(",").map(n=>n.trim()),description:"Manual created"})}),T(""),y()}catch(s){console.error(s),r.error("Failed to create webhook: "+s.message)}finally{P(!1)}}},G=s=>{f(s)},U=async()=>{if(m)try{const s=await window.Clerk?.session?.getToken();await a(`/integrations/webhooks/${m}`,s,{method:"DELETE",headers:{"X-Tenant-Slug":o||""}}),z(h.filter(n=>n.id!==m)),r.success("Webhook deleted")}catch(s){console.error(s),r.error("Failed to delete webhook: "+s.message)}finally{f(null)}};return t?e.jsxs("div",{className:"max-w-5xl pb-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Integrations"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage connections, payment providers, and developer tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"})," Payment Processing"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${t.paymentProvider==="connect"&&t.stripeAccountId?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:t.paymentProvider==="connect"&&t.stripeAccountId?"Connected":t.paymentProvider==="custom"?"Custom Keys":"Not Configured"})]}),e.jsxs("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800 rounded p-4",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:[e.jsx(q,{className:"h-4 w-4"})," Financial Privacy & Security"]}),e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-200 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Your Money, Your Account:"})," You retain full legal ownership of your Stripe account and funds. We cannot access your bank account or withdraw funds without your permission."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Limited Visibility:"})," We only track transactions processed through this platform (e.g., class bookings). We do not access unrelated financial data from your Stripe account."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bank-Grade Security:"})," Sensitive financial data is stored securely by Stripe. We do not store credit card numbers or bank account details."]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"})," Transactional Email (Resend)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${t.resendCredentials?.apiKey?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:t.resendCredentials?.apiKey?"Configured":"Using Platform Default"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Provide your own Resend API Key to send transactional emails from your domain."}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),x({resendApiKey:new FormData(s.currentTarget).get("resendApiKey")})},className:"flex gap-2",children:[e.jsx("input",{name:"resendApiKey",type:"password",placeholder:"re_123...",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"})," Marketing Automation (Flodesk)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${E?.flodesk?.configured?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:E?.flodesk?.configured?"Configured":"Not Configured"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Sync members and activity to Flodesk for email marketing."}),e.jsxs("form",{onSubmit:async s=>{s.preventDefault();try{const n=new FormData(s.currentTarget).get("flodeskApiKey"),d=await window.Clerk?.session?.getToken();await a("/integrations/credentials",d,{method:"PATCH",headers:{"X-Tenant-Slug":o||""},body:JSON.stringify({flodesk:{apiKey:n}})}),r.success("Flodesk settings saved."),y()}catch(n){console.error(n),r.error("Failed to save Flodesk settings: "+n.message)}},className:"flex gap-2",children:[e.jsx("input",{name:"flodeskApiKey",type:"password",placeholder:"Flodesk API Key",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," SMS Service (Twilio)"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${t.twilioCredentials?.accountSid?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:t.twilioCredentials?.accountSid?"Configured":"Using Platform Default"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Connect your Twilio account for custom SMS notifications."}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const n=new FormData(s.currentTarget);x({twilioAccountSid:n.get("twilioAccountSid"),twilioAuthToken:n.get("twilioAuthToken"),twilioFromNumber:n.get("twilioFromNumber")})},className:"space-y-3",children:[e.jsx("input",{name:"twilioAccountSid",placeholder:"Account SID",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("input",{name:"twilioFromNumber",placeholder:"From Number (+1...)",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("input",{name:"twilioAuthToken",type:"password",placeholder:"Auth Token",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Twilio"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," Customer Support Chat"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${t.settings?.chatEnabled!==!1?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:t.settings?.chatEnabled!==!1?"Enabled":"Disabled"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mb-3",children:"Allow students to chat with you directly from your website and portal."}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:()=>{const s=t.settings?.chatEnabled!==!1;p(!s)},className:`px-3 py-2 text-xs font-medium rounded border ${t.settings?.chatEnabled!==!1?"bg-zinc-50 border-zinc-300 text-zinc-700":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:t.settings?.chatEnabled!==!1?"Disable Chat":"Enable Chat"})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"text-zinc-900 dark:text-zinc-100"}),e.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:"Developer Tools"})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsx(v,{className:"flex items-center gap-2",children:"Outgoing Webhooks"}),e.jsx(N,{children:"Receive real-time JSON payloads when events happen in your studio."})]}),e.jsxs(k,{className:"space-y-6",children:[K?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(C,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"border rounded-md divide-y",children:[h.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm",children:"No webhooks configured."}),h.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"font-mono text-sm font-medium",children:s.url}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Array.isArray(s.events)?s.events.join(", "):s.events})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("code",{className:"text-[10px] bg-muted px-2 py-1 rounded text-muted-foreground hidden sm:inline-block",children:[s.secret.slice(0,8),"..."]}),e.jsx("button",{className:"p-2 hover:bg-red-50 text-red-600 rounded",onClick:()=>G(s.id),children:e.jsx(Q,{className:"h-4 w-4"})})]})]},s.id))]}),e.jsxs("div",{className:"p-4 border rounded-md bg-muted/20 bg-zinc-50 dark:bg-zinc-900 space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add New Endpoint"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Endpoint URL"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"https://hooks.zapier.com/...",value:c,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Events (comma separated)"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:D,onChange:s=>W(s.target.value)}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Available: booking.created, order.completed, student.created"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary bg-zinc-900 text-white hover:bg-zinc-800 h-10 px-4 py-2",onClick:R,disabled:!c||A,children:[A&&e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Webhook"]})})]})]})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsxs("svg",{role:"img",viewBox:"0 0 24 24",className:"h-5 w-5 fill-current",children:[e.jsx("path",{d:"M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z",fill:"#fff"}),e.jsx("path",{d:"M12.48 4.75c-1.39 0-2.68.74-3.35 1.83l-2.03 3.32h5.38V4.75zm-6.26 2.06c-.53 1.1-.82 2.34-.82 3.65 0 1.25.26 2.43.74 3.5l2.03-3.32L6.22 6.81zm-.74 7.15c.67 1.09 1.96 1.83 3.35 1.83h2.69v-4.38H6.15l-.67 2.55zm5.71 1.83c1.39 0 2.68-.74 3.35-1.83l2.03-3.32H11.2v4.38v.77zm6.26-2.06c.53-1.1.82-2.34.82-3.65 0-1.25-.26-2.43-.74-3.5l-2.03 3.32 2.7 3.83zm.74-7.15c-.67-1.09-1.96-1.83-3.35-1.83h-2.69v4.38h5.38l.66-2.55z",fill:"#4285F4"})]}),"Google Calendar"]}),e.jsx(N,{children:"Sync your classes and appointments to your primary Google Calendar."})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:t.googleCalendarCredentials?e.jsxs("div",{className:"flex items-center text-green-600 gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Connected"})]}):e.jsx("div",{className:"text-muted-foreground",children:"Not connected"})}),e.jsx("div",{children:t.googleCalendarCredentials?e.jsx("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>b(!0),children:"Disconnect"}):e.jsx("a",{href:`https://studio-platform-api.slichti.workers.dev/studios/google/connect?tenantId=${t.id}`,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2",children:"Connect Google Calendar"})})]})})]}),e.jsxs(j,{children:[e.jsxs(w,{children:[e.jsx(v,{children:"Studio API Credentials"}),e.jsx(N,{children:"Use these credentials to authenticate API requests."})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Studio ID (Tenant ID)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,value:t.id||"Loading...",className:"font-mono bg-muted flex h-10 w-full rounded-md border border-input px-3"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(t.id),className:"border rounded px-3 text-sm hover:bg-gray-100 dark:hover:bg-zinc-800",children:"Copy"})]})]})})})]})]}),e.jsx(g,{isOpen:!!m,onClose:()=>f(null),onConfirm:U,title:"Delete Webhook",message:"Are you sure you want to delete this webhook?",isDestructive:!0,confirmText:"Delete"}),e.jsx(g,{isOpen:L,onClose:()=>b(!1),onConfirm:async()=>{try{const s=window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token");await a(`/studios/${t.id}/integrations/google`,s,{method:"DELETE"}),r.success("Disconnected"),window.location.reload()}catch(s){console.error(s),r.error("Failed to disconnect")}finally{b(!1)}},title:"Disconnect Google Calendar",message:"Are you sure you want to disconnect Google Calendar? Classes will no longer sync.",isDestructive:!0,confirmText:"Disconnect"}),e.jsx(g,{isOpen:l!==null,onClose:()=>p(null),onConfirm:()=>{l!==null&&(x({chatEnabled:l}),p(null))},title:l?"Enable Chat Widget":"Disable Chat Widget",message:l?"Enable chat widget for your studio? This will verify connectivity to your configured support channels.":"Disable chat widget for your studio?",confirmText:l?"Enable":"Disable"}),e.jsx(g,{isOpen:!!u,onClose:()=>F(null),onConfirm:()=>{u&&(x({paymentProvider:u}),F(null))},title:"Switch Payment Provider",message:`Switch to ${u==="connect"?"Platform Managed":"Self Managed"} payments?`,confirmText:"Switch"})]}):e.jsx("div",{className:"p-8",children:e.jsx(C,{className:"animate-spin"})})});export{Ce as default};
