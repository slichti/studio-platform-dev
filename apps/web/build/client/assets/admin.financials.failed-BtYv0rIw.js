import{w as N,u as b}from"./chunk-JZWAC4HX-Cg_gv2PJ.js";import{j as e}from"./vendor-puck-D_CB0wXL.js";import{a as u}from"./api-ChCisjdG.js";import{a as s}from"./vendor-sentry-DugYw-Ne.js";import{C as z,E as w,S}from"./Dialogs-3wFUFLtR.js";import{R as v}from"./refresh-cw-DnP96nUp.js";import{C}from"./circle-check-big-DXKf0ujb.js";import{C as k}from"./circle-alert-BKf4ej_b.js";import{T as D}from"./triangle-alert-D-FhYK0e.js";import{E as A}from"./external-link-D9LUbl3i.js";import"./Modal-D1QwNVP6.js";import"./createLucideIcon-BOpDDQ2B.js";const J=N(function(){const{failedSubs:f,error:c,token:o}=b(),[n,g]=s.useState(f||[]),[d,a]=s.useState(!1),[i,r]=s.useState(null),[m,l]=s.useState(null),[x,p]=s.useState(null),h=async()=>{a(!0);try{const t=await u("/admin/billing/failed",o);g(t)}catch(t){l(t.message)}finally{a(!1)}},j=async()=>{if(i){a(!0),r(null);try{const t=n.find(y=>y.id===i);t&&t.tenantId&&(await u("/admin/billing/charge",o,{method:"POST",body:JSON.stringify({tenantIds:[t.tenantId]})}),p("Payment retry initiated. Check status in a moment."),setTimeout(h,2e3))}catch(t){l(t.message)}finally{a(!1)}}};return c?e.jsxs("div",{className:"p-8 text-red-600",children:["Error loading failed payments: ",c]}):e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsx(z,{isOpen:!!i,onClose:()=>r(null),onConfirm:j,title:"Retry Payment",message:"Are you sure you want to retry charging this tenant immediately?",confirmText:"Retry Charge"}),e.jsx(w,{isOpen:!!m,onClose:()=>l(null),message:m||""}),e.jsx(S,{isOpen:!!x,onClose:()=>p(null),message:x||""}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Failed Payments & Dunning"}),e.jsx("p",{className:"text-zinc-500",children:"Manage subscriptions that are at risk of cancellation."})]}),e.jsxs("button",{onClick:h,disabled:d,className:"px-4 py-2 border border-zinc-200 bg-white rounded-lg hover:bg-zinc-50 text-zinc-600 flex items-center gap-2",children:[e.jsx(v,{size:16,className:d?"animate-spin":""}),"Refresh"]})]}),e.jsx("div",{className:"bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-sm",children:n.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-500",children:[e.jsx(C,{size:48,className:"mx-auto text-green-500 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium text-zinc-900",children:"All Good"}),e.jsx("p",{className:"max-w-sm mx-auto mt-1",children:"No subscriptions are currently in a failed or warning state."})]}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Tenant"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Dunning Phase"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Last Attempt"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.tenant?.name||"Unknown"}),e.jsx("div",{className:"text-zinc-500 text-xs font-mono",children:t.tenant?.slug})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-green-100 text-green-800":t.status==="past_due"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.dunningState==="failed"&&e.jsx(k,{size:16,className:"text-red-600"}),t.dunningState?.startsWith("warning")&&e.jsx(D,{size:16,className:"text-orange-500"}),e.jsx("span",{className:"capitalize",children:t.dunningState?.replace(/(\d)/," $1")})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-600",children:t.lastDunningAt?new Date(t.lastDunningAt).toLocaleDateString():"N/A"}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("button",{onClick:()=>r(t.id),className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium mr-4",children:"Retry"}),t.stripeSubscriptionId&&e.jsx("a",{href:`https://dashboard.stripe.com/subscriptions/${t.stripeSubscriptionId}`,target:"_blank",rel:"noopener noreferrer",className:"text-zinc-400 hover:text-zinc-600 inline-flex items-center gap-1",title:"View in Stripe",children:e.jsx(A,{size:14})})]})]},t.id))})]})})]})});export{J as default};
