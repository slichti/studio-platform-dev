import{w as g,g as b,d as z}from"./chunk-JMJ3UQ3L-D5-P_Fux.js";import{j as e}from"./vendor-puck-Ox9nZAW8.js";import{a as u}from"./vendor-sentry-JepEA2vj.js";import{a as f}from"./api-OnQO3erh.js";import{C as v,a as k,b as j,d as y,c as C}from"./Card-B4aXyL8u.js";import{t as p}from"./index-Cb5OqxoU.js";import{S as w}from"./save-DQQgas6i.js";import{P as N}from"./plus-CWTELB5_.js";import{C as R}from"./chevron-right-b4Coem16.js";import{T as S}from"./trash-2-BcHoghLw.js";import{c as T}from"./createLucideIcon-CZ3UnH4h.js";const O=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],P=T("corner-down-right",O),m=({node:t,index:x,parentPath:c,onUpdate:r,onDelete:l})=>{const[o,d]=u.useState(!0);return e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-lg bg-white dark:bg-zinc-900 overflow-hidden mb-2",children:[e.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-zinc-800/50 flex items-center gap-2 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsx("button",{onClick:()=>d(!o),className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded text-zinc-500 dark:text-zinc-400",children:e.jsx(R,{size:14,className:`transition-transform ${o?"rotate-90":""}`})}),e.jsx("input",{value:t.label,onChange:n=>r({...t,label:n.target.value}),className:"bg-transparent font-medium text-sm focus:outline-none flex-1 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400",placeholder:"Option Label"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("select",{value:t.type,onChange:n=>r({...t,type:n.target.value,children:n.target.value==="menu"?[]:void 0}),className:"text-xs border border-zinc-200 dark:border-zinc-700 rounded px-1 py-0.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200",children:[e.jsx("option",{value:"action",children:"Action"}),e.jsx("option",{value:"menu",children:"Sub-Menu"})]}),e.jsx("button",{onClick:l,className:"text-red-500 p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(S,{size:14})})]})]}),o&&e.jsx("div",{className:"p-3 space-y-3 bg-white dark:bg-zinc-900",children:t.type==="action"?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-1",children:"Route To Role"}),e.jsxs("select",{value:t.routeToRole||"support",onChange:n=>r({...t,routeToRole:n.target.value}),className:"w-full text-sm border border-zinc-200 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 focus:ring-2 focus:ring-black dark:focus:ring-zinc-600 outline-none",children:[e.jsx("option",{value:"support",children:"General Support"}),e.jsx("option",{value:"instructor",children:"Instructor"}),e.jsx("option",{value:"admin",children:"Admin / Billing"}),e.jsx("option",{value:"owner",children:"Owner"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-1",children:"Auto-Reply Message"}),e.jsx("input",{value:t.autoReply||"",onChange:n=>r({...t,autoReply:n.target.value}),className:"w-full text-sm border border-zinc-200 dark:border-zinc-700 rounded px-2 py-1.5 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-200 focus:ring-2 focus:ring-black dark:focus:ring-zinc-600 outline-none",placeholder:"Optional auto-reply..."})]})]}):e.jsxs("div",{className:"pl-4 border-l-2 border-zinc-100 dark:border-zinc-800",children:[t.children?.map((n,i)=>e.jsx(m,{node:n,index:i,parentPath:[...c,i],onUpdate:s=>{const a=[...t.children||[]];a[i]=s,r({...t,children:a})},onDelete:()=>{const s=[...t.children||[]];s.splice(i,1),r({...t,children:s})}},n.id)),e.jsxs("button",{onClick:()=>{const n={id:crypto.randomUUID(),label:"New Option",type:"action"};r({...t,children:[...t.children||[],n]})},className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 font-medium mt-2 hover:underline",children:[e.jsx(P,{size:12})," Add Sub-Option"]})]})})]})},G=g(function(){const{slug:x}=b(),{tenant:c}=z()||{},[r,l]=u.useState(c?.settings?.chatConfig||[{id:"init-1",label:"I have a question about classes",type:"action",actionType:"message",routeToRole:"instructor",autoReply:"An instructor will get back to you shortly."},{id:"init-2",label:"Billing Issue",type:"action",actionType:"message",routeToRole:"admin",autoReply:"We are checking your billing details."}]),[o,d]=u.useState(!1),n=async()=>{d(!0);try{const i=await window.Clerk?.session?.getToken();await f(`/studios/${c.id}/integrations`,i,{method:"PUT",headers:{"X-Tenant-Slug":x||""},body:JSON.stringify({chatEnabled:c.settings?.chatEnabled,chatConfig:r})}),p.success("Chat configuration saved!"),window.location.reload()}catch(i){p.error(i.message||"Failed to save")}finally{d(!1)}};return e.jsxs("div",{className:"max-w-4xl pb-20",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Chat Configuration"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Design the decision tree for your support chat."})]}),e.jsx("button",{onClick:n,disabled:o,className:"flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 transition-colors font-medium",children:o?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(w,{size:16})," Save Config"]})})]}),e.jsx("div",{className:"grid gap-6",children:e.jsxs(v,{children:[e.jsxs(k,{children:[e.jsx(j,{children:"Main Menu"}),e.jsx(y,{children:"These are the top-level options users will see when they open the chat."})]}),e.jsxs(C,{children:[r.map((i,s)=>e.jsx(m,{node:i,index:s,parentPath:[s],onUpdate:a=>{const h=[...r];h[s]=a,l(h)},onDelete:()=>{const a=[...r];a.splice(s,1),l(a)}},i.id||`node-${s}`)),e.jsxs("button",{onClick:()=>l([...r,{id:crypto.randomUUID(),label:"New Option",type:"action"}]),className:"w-full py-3 border-2 border-dashed border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-500 dark:text-zinc-400 hover:border-zinc-300 dark:hover:border-zinc-600 hover:text-zinc-700 dark:hover:text-zinc-300 font-medium text-sm flex items-center justify-center gap-2 mt-4 transition-colors",children:[e.jsx(N,{size:16})," Add Root Option"]})]})]})})]})});export{G as default};
