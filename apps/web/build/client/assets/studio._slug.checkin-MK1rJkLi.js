import{w as L,d as T,f as E,c as D,r as a}from"./chunk-JMJ3UQ3L-C0Hu5JKs.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as v}from"./api-LAgipKeK.js";import{A as P}from"./arrow-left-BaxvY9WM.js";import{C as d}from"./circle-check-Ck7TUOTg.js";import{S as w}from"./search-DkCXim1A.js";import{L as R}from"./loader-circle-AZcNCG8_.js";import{c as $}from"./createLucideIcon-gSJn62ry.js";import{U as y}from"./users-CY1b1w7T.js";import{U as K}from"./user-plus-Btycc0fY.js";import{C as F}from"./calendar-DKYFHNQX.js";import{C as M}from"./circle-alert-BCEGKkpq.js";const U=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],_=$("circle",U),te=L(function(){const{classes:h,token:p}=T(),{slug:b}=E(),{roles:f}=D(),[r,g]=a.useState(null),[j,o]=a.useState([]),[C,z]=a.useState(!1),[c,x]=a.useState(""),[i,S]=a.useState(!1),[n,m]=a.useState(null);a.useEffect(()=>{r&&I(r.id)},[r]);const I=async s=>{z(!0);try{const t=await v(`/classes/${s}/bookings`,p,{headers:{"X-Tenant-Slug":b}});o(t||[])}catch{alert("Failed to load roster")}finally{z(!1)}},N=async s=>{const t=!s.checkedInAt;o(k=>k.map(l=>l.id===s.id?{...l,checkedInAt:t?new Date:null}:l));try{await v(`/classes/${r.id}/bookings/${s.id}/check-in`,p,{method:"PATCH",headers:{"X-Tenant-Slug":b},body:JSON.stringify({checkedIn:t})})}catch{alert("Check-in failed. Please try again."),o(l=>l.map(u=>u.id===s.id?{...u,checkedInAt:t?null:new Date}:u))}};a.useEffect(()=>{if(i&&n?.type==="success"){const s=setTimeout(()=>{m(null),x("")},3e3);return()=>clearTimeout(s)}},[n,i]);const A=async s=>{if(s.checkedInAt){m({message:"Already checked in!",type:"error"});return}await N(s),m({message:`Welcome, ${s.user.profile?.firstName}!`,type:"success"})};if(!f.includes("instructor")&&!f.includes("owner"))return e.jsx("div",{className:"p-8 text-center",children:"Access Denied: Instructor portal only."});if(r){const s=j.filter(t=>t.user.email.toLowerCase().includes(c.toLowerCase())||JSON.stringify(t.user.profile).toLowerCase().includes(c.toLowerCase()));return e.jsxs("div",{className:"flex flex-col h-screen bg-white dark:bg-zinc-950",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center gap-4 bg-zinc-50 dark:bg-zinc-900/50 sticky top-0 z-10",children:[e.jsx("button",{onClick:()=>g(null),className:"p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(P,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-bold truncate text-zinc-900 dark:text-zinc-100",children:r.title}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[new Date(r.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," • ",r.location?.name||"Studio Main"]})]})]}),e.jsx("button",{onClick:()=>S(!i),className:`px-4 py-2 rounded-lg text-sm font-bold border transition-colors ${i?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-zinc-900 text-zinc-600 dark:text-zinc-400 border-zinc-200 dark:border-zinc-800"}`,children:i?"Exit Kiosk":"Kiosk Mode"}),i?e.jsx("div",{className:"flex-1 flex flex-col items-center justify-start pt-24 px-8 bg-zinc-50 dark:bg-zinc-950",children:e.jsxs("div",{className:"max-w-2xl w-full",children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-center text-zinc-900 dark:text-zinc-100 mb-8 tracking-tight",children:["Welcome to ",r.location?.name||"the Studio"]}),n?e.jsxs("div",{className:`p-12 rounded-3xl text-center animate-in fade-in zoom-in duration-300 ${n.type==="success"?"bg-emerald-500 text-white":"bg-red-500 text-white"}`,children:[e.jsx(d,{size:64,className:"mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold",children:n.message}),e.jsx("p",{className:"mt-2 opacity-80 uppercase tracking-widest font-medium text-sm",children:"Enjoy your class!"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-6 top-1/2 -translate-y-1/2 h-8 w-8 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Enter your name...",value:c,onChange:t=>x(t.target.value),className:"w-full pl-20 pr-8 py-8 bg-white dark:bg-zinc-900 border-2 border-zinc-200 dark:border-zinc-800 rounded-3xl text-3xl font-bold focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none shadow-xl",autoFocus:!0})]}),c.length>1&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[s.map(t=>e.jsxs("button",{onClick:()=>A(t),className:"w-full flex items-center justify-between p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border-b border-zinc-100 dark:border-zinc-800 last:border-0 transition-colors text-left",children:[e.jsxs("span",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:[t.user.profile?.firstName," ",t.user.profile?.lastName]}),t.checkedInAt?e.jsxs("span",{className:"text-emerald-500 font-bold flex items-center gap-2",children:[e.jsx(d,{})," Checked In"]}):e.jsx("span",{className:"bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm",children:"Check In"})]},t.id)),s.length===0&&e.jsx("div",{className:"p-8 text-center text-zinc-400",children:"No students found."})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-white dark:bg-zinc-950 sticky top-[73px] z-10 border-b border-zinc-100 dark:border-zinc-800",children:e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Find student...",value:c,onChange:t=>x(t.target.value),className:"w-full pl-10 pr-4 py-3 bg-zinc-100 dark:bg-zinc-900 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pb-24",children:C&&j.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-400",children:[e.jsx(R,{className:"animate-spin mx-auto h-8 w-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"Loading Roster..."})]}):e.jsxs("div",{className:"divide-y divide-zinc-50 dark:divide-zinc-900",children:[s.map(t=>e.jsxs("button",{onClick:()=>N(t),className:"w-full flex items-center gap-4 p-4 active:bg-zinc-50 dark:active:bg-zinc-900 transition-colors text-left group",children:[e.jsx("div",{className:"flex-shrink-0",children:t.checkedInAt?e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 rounded-full",children:e.jsx(d,{size:24})}):e.jsx("div",{className:"p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 rounded-full group-hover:bg-blue-50 group-hover:text-blue-500 transition-colors",children:e.jsx(_,{size:24})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-bold text-zinc-900 dark:text-zinc-100 truncate",children:[t.user.profile?.firstName||"Student"," ",t.user.profile?.lastName||""]}),e.jsxs("div",{className:"text-xs text-zinc-500 flex items-center gap-2 mt-0.5",children:[t.status==="confirmed"?e.jsx("span",{className:"text-emerald-500 font-bold uppercase tracking-tighter text-[9px]",children:"Reserved"}):e.jsx("span",{className:"text-amber-500 font-bold uppercase tracking-tighter text-[9px]",children:t.status}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.user.email})]}),t.paymentMethod==="drop_in"&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-red-600 bg-red-100 px-1.5 py-0.5 rounded",children:"Unpaid / Pay at Door"})})]}),e.jsx("div",{className:"flex-shrink-0",children:t.checkedInAt?e.jsxs("span",{className:"text-[10px] text-zinc-400 font-medium",children:["Checked in ",new Date(t.checkedInAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):e.jsx("span",{className:"text-[10px] text-blue-600 font-bold bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded",children:"CHECK IN"})})]},t.id)),s.length===0&&e.jsxs("div",{className:"p-12 text-center text-zinc-400",children:[e.jsx(y,{className:"mx-auto h-12 w-12 mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"No students booked yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Bookings for this class will appear here."})]})]})}),e.jsx("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-950 flex gap-4 sticky bottom-0 shadow-2xl",children:e.jsxs("button",{className:"flex-1 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform",children:[e.jsx(K,{size:20}),"Quick Add Student"]})})]})]})}return e.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 pb-12",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(d,{className:"text-blue-600"})," Instructor Check-in"]}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Select today's session to start checking in students."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.length>0?h.map(s=>e.jsxs("button",{onClick:()=>g(s),className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all text-left group shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg text-blue-600 group-hover:scale-110 transition-transform",children:e.jsx(F,{size:20})}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-zinc-400 bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded",children:new Date(s.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-zinc-900 dark:text-zinc-100 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight mb-1",children:s.title}),e.jsxs("p",{className:"text-xs text-zinc-500 flex items-center gap-1.5 mt-1",children:[e.jsx(y,{size:12}),s.confirmedCount||0," students booked"]})]}),e.jsxs("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-800 flex items-center gap-2 text-blue-600 text-xs font-bold uppercase tracking-wider",children:["Start Check-in",e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"})]})]},s.id)):e.jsxs("div",{className:"col-span-full py-24 text-center bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-200 dark:border-zinc-800 border-dashed",children:[e.jsx(M,{className:"mx-auto h-12 w-12 text-zinc-300 mb-4"}),e.jsx("h3",{className:"text-zinc-500 font-bold mb-1",children:"No Classes Today"}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Enjoy your day off! Classes will appear here automatically."})]})})]})})});export{te as default};
