import{w as L,f as _,r as a}from"./chunk-JMJ3UQ3L-CSq87dux.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{C as b,a as j,b as v,c as N,d as y}from"./Card-IOiQbqBT.js";import{T as M}from"./terminal-CL9Woies.js";import{L as p}from"./loader-circle-BhPma_HC.js";import{T as O}from"./trash-2-BDP03pl4.js";import{c as U}from"./createLucideIcon-pjmwgCcP.js";import{M as B}from"./message-square-DsiSLrUZ.js";import{M as q}from"./mail-CyYX8Lfw.js";const X=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],H=U("key",X),ae=L(function(){const{slug:l}=_(),[m,w]=a.useState([]),[$,k]=a.useState(!0),[u,S]=a.useState(""),[C,D]=a.useState("booking.created, order.completed"),[T,z]=a.useState(!1),[r,P]=a.useState(null),[x,A]=a.useState(!1),[i,h]=a.useState({accountSid:"",authToken:"",fromNumber:""}),[f,I]=a.useState({apiKey:""}),d="https://studio-platform-api.slichti.workers.dev";a.useEffect(()=>{g()},[l]);const g=async()=>{k(!0);try{const t={Authorization:`Bearer ${localStorage.getItem("token")}`,"X-Tenant-Slug":l||""},[n,c]=await Promise.all([fetch(`${d}/integrations/webhooks`,{headers:t}),fetch(`${d}/integrations/credentials`,{headers:t})]);if(n.ok){const o=await n.json();w(o.endpoints)}if(c.ok){const o=await c.json();P(o),h({accountSid:o.twilio?.accountSid||"",authToken:"",fromNumber:o.twilio?.fromNumber||""}),I({apiKey:o.resend?.apiKey||""})}}catch(s){console.error("Failed to load data",s)}finally{k(!1)}},R=g,E=async s=>{A(!0);try{const t=localStorage.getItem("token"),n={};s==="twilio"&&(n.twilio=i),s==="resend"&&(n.resend=f),(await fetch(`${d}/integrations/credentials`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Tenant-Slug":l||""},body:JSON.stringify(n)})).ok?(alert("Credentials saved."),g()):alert("Failed to save credentials.")}catch(t){console.error(t)}finally{A(!1)}},F=async()=>{if(u){z(!0);try{const s=localStorage.getItem("token");(await fetch(`${d}/integrations/webhooks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Tenant-Slug":l||""},body:JSON.stringify({url:u,events:C.split(",").map(n=>n.trim()),description:"Manual created"})})).ok?(S(""),R()):alert("Failed to create webhook")}catch(s){console.error(s)}finally{z(!1)}}},K=async s=>{if(confirm("Delete this webhook?"))try{const t=localStorage.getItem("token");(await fetch(`${d}/integrations/webhooks/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"X-Tenant-Slug":l||""}})).ok&&w(m.filter(c=>c.id!==s))}catch(t){console.error(t)}};return e.jsxs("div",{className:"space-y-6 max-w-4xl p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Developers & Integrations"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage API keys and Webhooks to connect with external tools like Zapier."})]}),e.jsxs(b,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Outgoing Webhooks"]}),e.jsx(N,{children:"Receive real-time JSON payloads when events happen in your studio."})]}),e.jsxs(y,{className:"space-y-6",children:[$?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(p,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"border rounded-md divide-y",children:[m.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground text-sm",children:"No webhooks configured."}),m.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"font-mono text-sm font-medium",children:s.url}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Array.isArray(s.events)?s.events.join(", "):s.events})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("code",{className:"text-[10px] bg-muted px-2 py-1 rounded text-muted-foreground hidden sm:inline-block",children:[s.secret.slice(0,8),"..."]}),e.jsx("button",{className:"p-2 hover:bg-red-50 text-red-600 rounded",onClick:()=>K(s.id),children:e.jsx(O,{className:"h-4 w-4"})})]})]},s.id))]}),e.jsxs("div",{className:"p-4 border rounded-md bg-muted/20 space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add New Endpoint"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Endpoint URL"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"https://hooks.zapier.com/...",value:u,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Events (comma separated)"}),e.jsx("input",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:C,onChange:s=>D(s.target.value)}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Available: booking.created, order.completed, student.created"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",onClick:F,disabled:!u||T,children:[T&&e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Webhook"]})})]})]})]}),e.jsxs(b,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Integrations (BYOK)"]}),e.jsx(N,{children:"Bring Your Own Keys to bypass platform limits and use your own accounts."})]}),e.jsxs(y,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Twilio (SMS)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for custom SMS notifications."})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${r?.twilio?.configured?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r?.twilio?.configured?"Active":"Not Configured"})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 p-4 border rounded-md bg-zinc-50/50",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium uppercase text-zinc-500",children:"Account SID"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"AC...",value:i.accountSid,onChange:s=>h({...i,accountSid:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium uppercase text-zinc-500",children:"From Number"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"+15550000000",value:i.fromNumber,onChange:s=>h({...i,fromNumber:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium uppercase text-zinc-500",children:"Auth Token"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",type:"password",placeholder:r?.twilio?.configured?"• • • • • • (Unchanged)":"Enter Auth Token",value:i.authToken,onChange:s=>h({...i,authToken:s.target.value})}),e.jsx("p",{className:"text-[10px] text-zinc-400",children:"Hidden after saving."})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsxs("button",{onClick:()=>E("twilio"),disabled:x,className:"text-xs bg-zinc-900 text-white px-3 py-2 rounded hover:bg-zinc-800 disabled:opacity-50 flex items-center gap-2",children:[x&&e.jsx(p,{className:"h-3 w-3 animate-spin"})," Save Twilio"]})})]})]}),e.jsx("div",{className:"h-px bg-zinc-100"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Resend (Email)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"For high-volume or custom domain emails."})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${r?.resend?.configured?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r?.resend?.configured?"Active":"Not Configured"})})]}),e.jsxs("div",{className:"grid gap-4 p-4 border rounded-md bg-zinc-50/50",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium uppercase text-zinc-500",children:"API Key"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm font-mono",type:"password",placeholder:r?.resend?.configured?"re_... (Unchanged)":"re_123...",value:f.apiKey,onChange:s=>I({...f,apiKey:s.target.value})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>E("resend"),disabled:x,className:"text-xs bg-zinc-900 text-white px-3 py-2 rounded hover:bg-zinc-800 disabled:opacity-50 flex items-center gap-2",children:[x&&e.jsx(p,{className:"h-3 w-3 animate-spin"})," Save Resend"]})})]})]})]})]}),e.jsxs(b,{children:[e.jsxs(j,{children:[e.jsx(v,{children:"Studio API Credentials"}),e.jsx(N,{children:"Use these credentials to authenticate API requests."})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Studio ID (Tenant ID)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,value:m[0]?.tenant_id||"Loading...",className:"font-mono bg-muted flex h-10 w-full rounded-md border border-input px-3"}),e.jsx("button",{className:"border rounded px-3 text-sm hover:bg-gray-100 dark:hover:bg-zinc-800",children:"Copy"})]})]})})})]})]})});export{ae as default};
