const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BQcEtK79.js","assets/tslib.es6-B_Z_Z_Y2.js"])))=>i.map(i=>d[i]);
import{j as e}from"./jsx-runtime-u17CrQMm.js";import{f as k,r as x,g as w}from"./chunk-JMJ3UQ3L-C0Hu5JKs.js";import{M as C}from"./Modal-C6Pd0CT2.js";import{a as E}from"./api-LAgipKeK.js";import{u as T}from"./chunk-OT5FTIRN-CCnA-Ivt.js";import{X as S}from"./x-Gn1snBvL.js";import{U as I}from"./user-Dp3F9fs-.js";import{U as R}from"./users-CY1b1w7T.js";import{K as j,h as v}from"./dialog-BQooKdmT.js";const P="modulepreload",D=function(p){return"/"+p},N={},F=function(o,i,b){let u=Promise.resolve();if(i&&i.length>0){let m=function(a){return Promise.all(a.map(d=>Promise.resolve(d).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),s=c?.nonce||c?.getAttribute("nonce");u=m(i.map(a=>{if(a=D(a),a in N)return;N[a]=!0;const d=a.endsWith(".css"),t=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${t}`))return;const r=document.createElement("link");if(r.rel=d?"stylesheet":P,d||(r.as="script"),r.crossOrigin="",r.href=a,s&&r.setAttribute("nonce",s),document.head.appendChild(r),d)return new Promise((g,n)=>{r.addEventListener("load",g),r.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return u.then(c=>{for(const s of c||[])s.status==="rejected"&&l(s.reason);return o().catch(l)})};function V({isOpen:p,onClose:o,onSuccess:i,locations:b=[],instructors:u=[]}){const{getToken:l}=T(),{slug:c}=k(),[s,m]=x.useState(!1),[a,d]=x.useState(""),[t,r]=x.useState({name:"",description:"",instructorId:"",locationId:"",startTime:"",durationMinutes:60,capacity:20,price:0,isRecurring:!1,recurrencePattern:"weekly",recurrenceEndDate:"",createZoom:!1,minEnrollment:1,autoCancelThreshold:2,autoCancelEnabled:!1}),g=async n=>{n.preventDefault(),m(!0),d("");try{const f=await l();let y;if(t.isRecurring){const{RRule:M}=await F(async()=>{const{RRule:z}=await import("./index-BQcEtK79.js");return{RRule:z}},__vite__mapDeps([0,1]));y=t.recurrencePattern==="weekly"?"FREQ=WEEKLY":"FREQ=DAILY"}const h=await E("/classes",f,{method:"POST",headers:{"X-Tenant-Slug":c},body:JSON.stringify({title:t.name,description:t.description,instructorId:t.instructorId,locationId:t.locationId||void 0,startTime:new Date(t.startTime).toISOString(),durationMinutes:Number(t.durationMinutes),capacity:Number(t.capacity),price:Number(t.price),createZoomMeeting:t.createZoom,isRecurring:t.isRecurring,recurrenceRule:y,recurrenceEnd:t.recurrenceEndDate?new Date(t.recurrenceEndDate).toISOString():void 0,minStudents:Number(t.minEnrollment),autoCancelThreshold:Number(t.autoCancelThreshold),autoCancelEnabled:t.autoCancelEnabled})});h.error?d(h.error):(i(h.class||h),o(),r({name:"",description:"",instructorId:"",locationId:"",startTime:"",durationMinutes:60,capacity:20,price:0,isRecurring:!1,recurrencePattern:"weekly",recurrenceEndDate:"",createZoom:!1,minEnrollment:1,autoCancelThreshold:2,autoCancelEnabled:!1}))}catch(f){d(f.message||"Failed to create class")}finally{m(!1)}};return e.jsx(C,{isOpen:p,onClose:o,title:"Schedule Class",children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[a&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 rounded text-sm",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Class Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:t.name,onChange:n=>r({...t,name:n.target.value}),placeholder:"e.g. Morning Vinyasa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Instructor"}),e.jsxs("select",{required:!0,className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:t.instructorId,onChange:n=>r({...t,instructorId:n.target.value}),children:[e.jsx("option",{value:"",children:"Select Instructor"}),u.map(n=>e.jsxs("option",{value:n.id,children:[n.user?.profile?.firstName," ",n.user?.profile?.lastName]},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Location"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:t.locationId,onChange:n=>r({...t,locationId:n.target.value}),children:[e.jsx("option",{value:"",children:"Select Location (Optional)"}),b.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.createZoom,onChange:n=>r({...t,createZoom:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable Zoom (Virtual Access)"})]}),t.createZoom&&e.jsx("p",{className:"text-xs text-zinc-500 ml-6 mt-1",children:"A Zoom meeting will be created automatically."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",required:!0,className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:t.startTime,onChange:n=>r({...t,startTime:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Duration (min)"}),e.jsx("input",{type:"number",required:!0,min:"15",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:t.durationMinutes,onChange:n=>r({...t,durationMinutes:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Capacity"}),e.jsx("input",{type:"number",required:!0,min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:t.capacity,onChange:n=>r({...t,capacity:Number(n.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Price ($)"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",value:t.price,onChange:n=>r({...t,price:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"bg-zinc-50 border border-zinc-200 p-4 rounded-lg space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 border-b border-zinc-200 pb-2",children:"Enrollment Policies"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Min. Enrollment to Run"}),e.jsx("input",{type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:t.minEnrollment,onChange:n=>r({...t,minEnrollment:Number(n.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-700 mb-1",children:"Auto-Cancel Cutoff (hrs)"}),e.jsx("input",{type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:t.autoCancelThreshold,onChange:n=>r({...t,autoCancelThreshold:Number(n.target.value)}),placeholder:"Hours before start"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.autoCancelEnabled,onChange:n=>r({...t,autoCancelEnabled:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Enable automatic cancellation if minimum is not met"})]})]}),e.jsxs("div",{className:"border-t border-zinc-200 pt-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.isRecurring,onChange:n=>r({...t,isRecurring:n.target.checked}),className:"rounded border-zinc-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Repeat this class"})]}),t.isRecurring&&e.jsx("div",{className:"mt-3 p-3 bg-zinc-50 rounded border border-zinc-200 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Frequency"}),e.jsxs("select",{className:"w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",value:t.recurrencePattern,onChange:n=>r({...t,recurrencePattern:n.target.value}),children:[e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"daily",children:"Daily"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"End Date"}),e.jsx("input",{type:"date",required:t.isRecurring,className:"w-full px-2 py-1.5 text-sm border border-zinc-300 rounded focus:ring-blue-500 outline-none",value:t.recurrenceEndDate,onChange:n=>r({...t,recurrenceEndDate:n.target.value}),min:t.startTime?new Date(t.startTime).toISOString().split("T")[0]:void 0})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-md hover:bg-zinc-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:s,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:s?"Scheduling...":"Schedule Class"})]})]})})}function W({isOpen:p,onClose:o,classEvent:i,family:b}){const u=w(),[l,c]=x.useState("in_person");if(!i)return null;const s=!i.zoomEnabled&&(i.confirmedCount||0)>=(i.capacity||1/0);return e.jsx(j,{appear:!0,show:p,as:x.Fragment,children:e.jsxs(v,{as:"div",className:"relative z-50",onClose:o,children:[e.jsx(j.Child,{as:x.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(j.Child,{as:x.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(v.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-zinc-900 p-6 text-left align-middle shadow-xl transition-all border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs(v.Title,{as:"h3",className:"text-lg font-bold leading-6 text-zinc-900 dark:text-zinc-100",children:["Book ",i.title]}),e.jsx("button",{onClick:o,className:"text-zinc-400 hover:text-zinc-500",children:e.jsx(S,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[i.zoomEnabled&&e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-lg text-sm border border-zinc-200 dark:border-zinc-700",children:[e.jsx("p",{className:"font-semibold text-zinc-900 dark:text-zinc-100 mb-2",children:"Attendance Preference"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType",checked:l==="in_person",onChange:()=>c("in_person"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:"In-Person"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"attendanceType",checked:l==="zoom",onChange:()=>c("zoom"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-zinc-700 dark:text-zinc-300",children:"Virtual (Zoom)"})]})]})]}),e.jsx("div",{className:"text-sm",children:s&&l==="in_person"?e.jsx("div",{className:"text-amber-600 mb-2 font-medium",children:"Class is full. You will be added to the waitlist."}):e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-2",children:"Who is this booking for?"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u.Form,{method:"post",action:`/studio/${window.location.pathname.split("/")[2]}/classes?index`,onSubmit:()=>o(),children:[e.jsx("input",{type:"hidden",name:"classId",value:i.id}),e.jsx("input",{type:"hidden",name:"attendanceType",value:l}),e.jsx("input",{type:"hidden",name:"intent",value:s&&l==="in_person"?"waitlist":"book"}),e.jsxs("button",{type:"submit",disabled:u.state!=="idle",className:"w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400",children:e.jsx(I,{size:16})}),e.jsx("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:"Myself"})]}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100",children:"→"})]})]}),b.map(m=>e.jsxs(u.Form,{method:"post",action:`/studio/${window.location.pathname.split("/")[2]}/classes?index`,onSubmit:()=>o(),children:[e.jsx("input",{type:"hidden",name:"classId",value:i.id}),e.jsx("input",{type:"hidden",name:"memberId",value:m.memberId||""}),e.jsx("input",{type:"hidden",name:"attendanceType",value:l}),e.jsx("input",{type:"hidden",name:"intent",value:s&&l==="in_person"?"waitlist":"book"}),e.jsxs("button",{type:"submit",disabled:u.state!=="idle",className:"w-full text-left px-4 py-3 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 flex justify-between items-center group transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-full text-purple-600 dark:text-purple-400",children:e.jsx(R,{size:16})}),e.jsxs("span",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:[m.firstName," ",m.lastName]})]}),e.jsx("span",{className:"text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-zinc-100",children:"→"})]})]},m.userId))]})]})]})})})})]})})}export{W as B,V as C};
