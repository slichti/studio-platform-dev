import{a as c,j as e,bR as E,p as I,q as T,bc as A,F,_ as O,G as R,V as L,O as U}from"./vendor-react-D59Q0YKK.js";import{M as B}from"./Modal-B9krvlse.js";import"./vendor-puck-RN2Ey-av.js";import"./vendor-charts-Dp-zC2wb.js";const V=o=>new Promise((l,m)=>{const r=new Image;r.addEventListener("load",()=>l(r)),r.addEventListener("error",s=>m(s)),r.setAttribute("crossOrigin","anonymous"),r.src=o});function M(o){return o*Math.PI/180}function $(o,l,m){const r=M(m);return{width:Math.abs(Math.cos(r)*o)+Math.abs(Math.sin(r)*l),height:Math.abs(Math.sin(r)*o)+Math.abs(Math.cos(r)*l)}}async function _(o,l,m=0,r={horizontal:!1,vertical:!1}){const s=await V(o),u=document.createElement("canvas"),n=u.getContext("2d");if(!n)throw new Error("No 2d context");const f=M(m),{width:i,height:x}=$(s.width,s.height,m);u.width=i,u.height=x,n.translate(i/2,x/2),n.rotate(f),n.scale(r.horizontal?-1:1,r.vertical?-1:1),n.translate(-s.width/2,-s.height/2),n.drawImage(s,0,0);const k=n.getImageData(l.x,l.y,l.width,l.height);return u.width=l.width,u.height=l.height,n.putImageData(k,0,0),new Promise((j,z)=>{u.toBlob(b=>{if(!b){console.error("Canvas is empty");return}j(b)},"image/jpeg")})}function W({initialImage:o,initialTitle:l,initialSubtitle:m,onChange:r}){const[s,u]=c.useState(o||null),[n,f]=c.useState(l||""),[i,x]=c.useState(m||""),[k,j]=c.useState({x:0,y:0}),[z,b]=c.useState(1),[y,S]=c.useState(null),[w,v]=c.useState(o?"preview":"upload"),d=c.useCallback((a,p)=>{S(p)},[]),t=async a=>{if(a.target.files&&a.target.files.length>0){const p=a.target.files[0],g=await h(p);u(g),v("crop")}},N=async()=>{try{if(!s||!y)return;const a=await _(s,y),p=URL.createObjectURL(a);r({image:a,title:n,subtitle:i,previewUrl:p}),v("preview")}catch(a){console.error(a)}},h=a=>new Promise(p=>{const g=new FileReader;g.addEventListener("load",()=>p(g.result)),g.readAsDataURL(a)});return e.jsxs("div",{className:"card-creator space-y-4",children:[w==="upload"&&e.jsxs("div",{className:"border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg p-8 text-center bg-zinc-50 dark:bg-zinc-800/50 transition-colors hover:bg-zinc-100 dark:hover:bg-zinc-800",children:[e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-4 font-medium",children:"Upload a background image for your membership card."}),e.jsx("input",{type:"file",accept:"image/*",onChange:t,className:"hidden",id:"card-image-upload"}),e.jsx("label",{htmlFor:"card-image-upload",className:"cursor-pointer inline-block bg-indigo-600 text-white px-4 py-2 rounded-md font-medium hover:bg-indigo-700 transition-colors shadow-sm",children:"Choose Image"})]}),w==="crop"&&s&&e.jsxs("div",{className:"relative h-64 w-full bg-zinc-900 rounded-lg overflow-hidden",children:[e.jsx(E,{image:s,crop:k,zoom:z,aspect:3/2,onCropChange:j,onCropComplete:d,onZoomChange:b}),e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>v("upload"),className:"bg-zinc-800/80 backdrop-blur text-white px-3 py-1 rounded text-sm hover:bg-zinc-700 font-medium transition-colors",children:"Change Image"}),e.jsx("button",{type:"button",onClick:N,className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700 font-medium transition-colors shadow-lg",children:"Apply Crop"})]})]}),w==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative w-full aspect-[3/2] rounded-lg overflow-hidden shadow-md group",children:[s&&e.jsx("img",{src:s,className:"w-full h-full object-cover",alt:"Card Background"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex flex-col items-center justify-center text-center p-4",children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-sm p-4 rounded-lg max-w-[80%]",children:[e.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white uppercase tracking-wider",children:n||"Membership Title"}),i&&e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 mt-1",children:i})]})}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>v("crop"),className:"bg-white text-zinc-900 px-4 py-2 rounded-full font-medium hover:bg-zinc-100 shadow-lg transform transition-transform hover:scale-105",children:"Edit Image"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Overlay Title"}),e.jsx("input",{value:n,onChange:a=>{f(a.target.value),r({image:null,title:a.target.value,subtitle:i,previewUrl:""})},className:"w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-indigo-500 focus:border-indigo-500 text-zinc-900 dark:text-zinc-100",placeholder:"3 MONTH MEMBERSHIP"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Overlay Subtitle (Optional)"}),e.jsx("input",{value:i,onChange:a=>{x(a.target.value),r({image:null,title:n,subtitle:a.target.value,previewUrl:""})},className:"w-full px-3 py-2 rounded-md border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-indigo-500 focus:border-indigo-500 text-zinc-900 dark:text-zinc-100",placeholder:"Unlimited Yoga"})]})]})]})]})}const X=I(function(){const{plans:l,subscriptions:m,error:r}=T(),s=A(),n=F().state==="submitting",{isStudentView:f}=O(),[i,x]=c.useState({type:"closed"}),k=R(),{getToken:j}=L(),[z,b]=c.useState({image:null,title:"",subtitle:"",previewUrl:""}),[y,S]=c.useState(!1);c.useEffect(()=>{s?.success&&!n&&(x({type:"closed"}),b({image:null,title:"",subtitle:"",previewUrl:""}))},[s,n]),c.useEffect(()=>{i.type==="create"?b({image:null,title:"",subtitle:"",previewUrl:""}):i.type==="edit"&&b({image:null,title:i.plan.overlayTitle||"",subtitle:i.plan.overlaySubtitle||"",previewUrl:""})},[i.type,i.type==="edit"?i.plan:null]);const w=async t=>{t.preventDefault(),S(!0);const N=t.currentTarget,h=new FormData(N);try{if(z.image){const a=await j(),p=window.location.pathname.split("/")[2],g=new FormData,P=new File([z.image],"card.jpg",{type:"image/jpeg"});g.append("file",P);const C=await fetch("https://studio-platform-api.slichti.workers.dev/uploads/r2-image",{method:"POST",headers:{Authorization:`Bearer ${a}`,"X-Tenant-Slug":p},body:g});if(!C.ok)throw new Error("Image upload failed");const D=await C.json();h.append("imageUrl",D.url)}else i.type==="edit"&&i.plan.imageUrl&&h.append("imageUrl",i.plan.imageUrl);h.append("overlayTitle",z.title),h.append("overlaySubtitle",z.subtitle),i.type==="edit"&&h.append("planId",i.plan.id),k(h,{method:"post"})}catch(a){console.error(a),alert("Failed to save plan: "+a)}finally{S(!1)}},v=i.type!=="closed",d=i.type==="edit"?i.plan:null;return e.jsxs("div",{className:"text-zinc-900 dark:text-zinc-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Memberships"}),!f&&e.jsx("button",{onClick:()=>x({type:"create"}),className:"px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors text-sm font-medium",children:"+ New Plan"})]}),r&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded mb-4 text-sm",children:["Failed to load plans: ",r]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:l.length===0?e.jsxs("div",{className:"col-span-full text-center p-12 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700",children:[e.jsx("h3",{className:"font-medium mb-1 text-zinc-900 dark:text-zinc-100",children:"No Membership Plans"}),e.jsx("p",{className:"text-sm mb-4 text-zinc-500 dark:text-zinc-400",children:'Create tiers like "Unlimited" or "10-Pack" for your students.'}),e.jsx("button",{onClick:()=>x({type:"create"}),className:"text-blue-600 hover:underline",children:"Create first plan"})]}):l.map(t=>e.jsxs("div",{className:"rounded-lg shadow-sm transition-colors overflow-hidden group bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"relative h-48 w-full bg-zinc-200 dark:bg-zinc-800 overflow-hidden",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-zinc-400",children:"No Image"}),(t.overlayTitle||t.overlaySubtitle)&&e.jsx("div",{className:"absolute inset-0 bg-black/20 flex flex-col items-center justify-center text-center p-4",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/70 backdrop-blur-sm px-4 py-2 rounded-lg max-w-[90%]",children:[t.overlayTitle&&e.jsx("h3",{className:"font-bold text-lg text-zinc-900 dark:text-white uppercase tracking-wider",children:t.overlayTitle}),t.overlaySubtitle&&e.jsx("p",{className:"text-xs text-zinc-700 dark:text-zinc-300 mt-0.5",children:t.overlaySubtitle})]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-zinc-900 dark:text-zinc-100",children:t.name}),e.jsxs("div",{className:"text-2xl font-bold mb-4 text-zinc-900 dark:text-zinc-100",children:["$",(t.price/100).toFixed(2),e.jsxs("span",{className:"text-sm font-normal text-zinc-500 dark:text-zinc-400",children:["/",t.interval]})]}),e.jsx("p",{className:"text-sm mb-6 min-h-[40px] text-zinc-500 dark:text-zinc-400",children:t.description||"No description provided."}),f?e.jsx("button",{onClick:()=>{window.location.href=`checkout?planId=${t.id}`},className:"w-full py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-bold text-sm transition-colors shadow-sm",children:"Subscribe Now"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x({type:"edit",plan:t}),className:"w-full py-2 rounded hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium text-sm border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100 transition-colors",children:"Edit Plan"}),e.jsxs(U,{method:"post",onSubmit:N=>{confirm("Are you sure? This cannot be undone.")||N.preventDefault()},children:[e.jsx("input",{type:"hidden",name:"intent",value:"delete_plan"}),e.jsx("input",{type:"hidden",name:"planId",value:t.id}),e.jsx("button",{type:"submit",className:"w-full mt-2 text-red-600 hover:text-red-800 dark:hover:text-red-400 text-xs font-medium",children:"Delete Plan"})]})]})]})]},t.id))}),e.jsx("h3",{className:"text-lg font-bold mb-4 text-zinc-900 dark:text-zinc-100",children:"Active Subscriptions"}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",children:m&&m.length>0?e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Renewal"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:m.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/20",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:t.user.profile?.fullName||t.user.email}),e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:t.user.email})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-600 dark:text-zinc-300",children:t.planName}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-zinc-100 text-zinc-800 dark:bg-zinc-800 dark:text-zinc-300"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-zinc-500 dark:text-zinc-400",children:t.currentPeriodEnd?new Date(t.currentPeriodEnd).toLocaleDateString():"N/A"})]},t.id))})]}):e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400",children:"No active subscriptions yet."})}),e.jsx(B,{isOpen:v,onClose:()=>x({type:"closed"}),title:i.type==="edit"?"Edit Membership Plan":"Create Membership Plan",maxWidth:"max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Card Appearance"}),e.jsx(W,{initialImage:d?.imageUrl,initialTitle:d?.overlayTitle,initialSubtitle:d?.overlaySubtitle,onChange:b},d?d.id:"new")]}),e.jsxs(U,{method:"post",onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Plan Details"}),e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Plan Name (Internal)"}),e.jsx("input",{name:"name",required:!0,defaultValue:d?.name||"",placeholder:"e.g. Gold Unlimited",className:"w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Price ($)"}),e.jsx("input",{type:"number",name:"price",step:"0.01",required:!0,defaultValue:d?(d.price/100).toFixed(2):"",className:"w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Interval"}),e.jsxs("select",{name:"interval",defaultValue:d?.interval||"month",className:"w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100",children:[e.jsx("option",{value:"month",children:"Monthly"}),e.jsx("option",{value:"week",children:"Weekly"}),e.jsx("option",{value:"year",children:"Yearly"}),e.jsx("option",{value:"one_time",children:"One Time"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Description"}),e.jsx("textarea",{name:"description",rows:3,defaultValue:d?.description||"",className:"w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-zinc-900 dark:text-zinc-100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"vodEnabled",id:"vodEnabled",defaultChecked:d?.vodEnabled||!1,className:"rounded border-zinc-300 dark:border-zinc-700 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"vodEnabled",className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Include VOD Access"}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-2",children:"(Allows entry to On-Demand Library)"})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>x({type:"closed"}),className:"flex-1 px-4 py-2 border border-zinc-200 dark:border-zinc-700 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800 font-medium text-zinc-900 dark:text-zinc-100 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||y,className:"flex-1 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-md hover:opacity-90 font-medium disabled:opacity-50 transition-colors",children:y?"Uploading...":n?"Saving...":i.type==="edit"?"Save Changes":"Create Plan"})]})]})]})})]})});export{X as default};
