import{w as y,u as C,d as S,L as c}from"./chunk-JMJ3UQ3L-D6qeZyod.js";import{j as e}from"./vendor-puck-C9fWOLBg.js";import{a as k}from"./api-D1U4i9fn.js";import{a as o}from"./vendor-sentry-D-95zPX-.js";import{M as T}from"./Modal-AfMv2c7i.js";import{t as E}from"./index-BGuZY2c4.js";import{M}from"./message-circle-CnjlDFxI.js";import{S as A}from"./settings-hlIk1HW1.js";import{E as U}from"./external-link-CWLWe6FF.js";import{U as L}from"./user-DW0eM6T4.js";import{S as $}from"./shield-BddNIGMp.js";import{P}from"./plus-D93jR3m4.js";import"./createLucideIcon-Qes_Sb9D.js";const G=y(function(){const{rooms:d,tenant:f,token:g,error:x}=C(),{slug:a}=S(),[j,l]=o.useState(!1),[t,n]=o.useState(f?.settings?.chatConfig||{timezone:"UTC",offlineEmail:"",schedule:{Mon:["09:00","17:00"],Tue:["09:00","17:00"],Wed:["09:00","17:00"],Thu:["09:00","17:00"],Fri:["09:00","17:00"]}}),b=async()=>{try{await k("/tenant/settings",g,{method:"PATCH",body:JSON.stringify({settings:{chatConfig:t}})}),l(!1)}catch{E.error("Failed to save settings")}},m=(s,N)=>{const z=["Mon","Tue","Wed","Thu","Fri"],h={...t.schedule};z.forEach(w=>{h[w]=[s,N]}),n({...t,schedule:h})},[i,v]=o.useState("all");if(x)return e.jsxs("div",{className:"p-8 text-red-600",children:["Error: ",x]});const u=d.filter(s=>s.metadata?.source==="widget"||s.customerEmail),p=d.filter(s=>!s.customerEmail&&s.metadata?.source!=="widget"),r=i==="all"?u:u.filter(s=>s.metadata?.routedRole===i);return e.jsxs("div",{className:"p-8 max-w-6xl mx-auto h-full flex flex-col",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-zinc-900 flex items-center gap-2",children:[e.jsx(M,{className:"text-blue-600"}),"Messages"]}),e.jsx("p",{className:"text-zinc-500 mt-1",children:"Manage customer support inquiries and platform tickets"})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 text-sm text-zinc-600 hover:text-zinc-900 mr-4",children:[e.jsx(A,{size:14}),"Chat Settings"]}),e.jsxs(c,{to:`/embed/${a}/chat`,target:"_blank",className:"flex items-center gap-2 text-sm text-blue-600 hover:underline",children:[e.jsx(U,{size:14}),"Test Widget"]})]})]}),e.jsx(T,{isOpen:j,onClose:()=>l(!1),title:"Chat Settings",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Offline Email"}),e.jsx("input",{type:"email",className:"w-full border border-zinc-300 rounded-lg p-2 text-sm",placeholder:"support@example.com",value:t.offlineEmail,onChange:s=>n({...t,offlineEmail:s.target.value})}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Visitors will be asked to email this address when you are offline."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Timezone"}),e.jsxs("select",{className:"w-full border border-zinc-300 rounded-lg p-2 text-sm",value:t.timezone,onChange:s=>n({...t,timezone:s.target.value}),children:[e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"America/New_York",children:"Eastern Time (US)"}),e.jsx("option",{value:"America/Chicago",children:"Central Time (US)"}),e.jsx("option",{value:"America/Denver",children:"Mountain Time (US)"}),e.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time (US)"}),e.jsx("option",{value:"Europe/London",children:"London (UK)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Weekday Hours (Mon-Fri)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",className:"border border-zinc-300 rounded-lg p-2 text-sm",value:t.schedule?.Mon?.[0]||"09:00",onChange:s=>m(s.target.value,t.schedule?.Mon?.[1]||"17:00")}),e.jsx("span",{className:"text-zinc-400",children:"to"}),e.jsx("input",{type:"time",className:"border border-zinc-300 rounded-lg p-2 text-sm",value:t.schedule?.Mon?.[1]||"17:00",onChange:s=>m(t.schedule?.Mon?.[0]||"09:00",s.target.value)})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsx("button",{onClick:b,className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700",children:"Save Settings"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 overflow-hidden flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 bg-zinc-50 flex justify-between items-center",children:[e.jsxs("h2",{className:"font-semibold text-zinc-900 flex items-center gap-2",children:[e.jsx(L,{size:18,className:"text-blue-600"}),"Customer Inquiries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:i,onChange:s=>v(s.target.value),className:"text-xs border border-zinc-200 rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"instructor",children:"Instructor"}),e.jsx("option",{value:"support",children:"Support"})]}),e.jsx("span",{className:"text-xs bg-zinc-200 text-zinc-600 px-2 py-0.5 rounded-full",children:r.length})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-zinc-100",children:r.length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 text-sm",children:i==="all"?"No customer messages yet.":`No messages routed to ${i}.`}):r.map(s=>e.jsxs(c,{to:`/studio/${a}/chat/${s.id}`,className:"block p-4 hover:bg-zinc-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-zinc-900",children:s.name}),e.jsx("span",{className:"text-xs text-zinc-400",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-500",children:[s.customerEmail&&e.jsx("span",{children:s.customerEmail}),e.jsx("span",{className:`px-1.5 py-0.5 rounded capitalize ${s.status==="open"?"bg-green-100 text-green-700":s.status==="closed"?"bg-zinc-100 text-zinc-500":"bg-blue-50 text-blue-700"}`,children:s.status||"open"}),s.metadata?.routedRole&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-purple-50 text-purple-700 capitalize",children:["â†’ ",s.metadata.routedRole]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 overflow-hidden flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 bg-zinc-50 flex justify-between items-center",children:[e.jsxs("h2",{className:"font-semibold text-zinc-900 flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-purple-600"}),"Platform Support Tickets"]}),e.jsxs("button",{className:"text-xs flex items-center gap-1 bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors",children:[e.jsx(P,{size:12}),"New Ticket"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto divide-y divide-zinc-100",children:p.length===0?e.jsx("div",{className:"p-8 text-center text-zinc-500 text-sm",children:"No active support tickets with Platform Admin."}):p.map(s=>e.jsxs(c,{to:`/studio/${a}/chat/${s.id}`,className:"block p-4 hover:bg-zinc-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-zinc-900",children:s.name}),e.jsx("span",{className:"text-xs text-zinc-400",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-500",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded capitalize ${s.status==="open"?"bg-green-100 text-green-700":s.status==="closed"?"bg-zinc-100 text-zinc-500":"bg-blue-50 text-blue-700"}`,children:s.status||"open"}),s.assignedToId&&e.jsx("span",{className:"bg-purple-50 text-purple-700 px-1.5 py-0.5 rounded",children:"Assigned"})]})]},s.id))})]})]})]})});export{G as default};
