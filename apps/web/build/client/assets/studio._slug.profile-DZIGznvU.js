import{l as g,r as l,w as y,d as v}from"./chunk-JMJ3UQ3L-CD8Ifjmd.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as f}from"./api-LAgipKeK.js";function z({token:n}){const t=g(),[a,d]=l.useState([]),[r,c]=l.useState(!1);return l.useEffect(()=>{n&&fetch("/users/me/family",{headers:{Authorization:`Bearer ${n}`}}).then(s=>s.json()).then(s=>{s.family&&d(s.family)})},[n]),l.useEffect(()=>{t.data?.success&&t.data?.child&&(d(s=>[...s,t.data.child]),c(!1))},[t.data]),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-900",children:"Family Members"}),e.jsx("button",{onClick:()=>c(!r),className:"text-sm font-medium text-blue-600 hover:text-blue-800",children:r?"Cancel":"+ Add Child"})]}),r&&e.jsxs(t.Form,{method:"post",action:"/api/family",className:"mb-6 p-4 bg-zinc-50 rounded-md border border-zinc-200",children:[e.jsx("input",{type:"hidden",name:"intent",value:"add_child"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"First Name"}),e.jsx("input",{name:"firstName",required:!0,className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Last Name"}),e.jsx("input",{name:"lastName",required:!0,className:"w-full px-3 py-2 border rounded-md"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Date of Birth"}),e.jsx("input",{name:"dob",type:"date",className:"w-full px-3 py-2 border rounded-md"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:t.state==="submitting",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50",children:t.state==="submitting"?"Adding...":"Add Family Member"})})]}),e.jsxs("div",{className:"space-y-3",children:[a.length===0&&!r&&e.jsx("p",{className:"text-zinc-500 text-sm italic",children:"No family members linked."}),a.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 border border-zinc-100 rounded-md bg-zinc-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs",children:s.firstName[0]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm text-zinc-900",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.dob?new Date(s.dob).toLocaleDateString():"No DOB",s.memberId?" â€¢ Studio Member":""]})]})]})},s.userId))]})]})}function S({token:n,tenantSlug:t}){const[a,d]=l.useState([]),[r,c]=l.useState(!0),[s,o]=l.useState(!1),m=[{id:1,label:"Monday"},{id:2,label:"Tuesday"},{id:3,label:"Wednesday"},{id:4,label:"Thursday"},{id:5,label:"Friday"},{id:6,label:"Saturday"},{id:0,label:"Sunday"}];l.useEffect(()=>{u()},[]);async function u(){try{const i=await f("/appointments/availability/settings",n,{headers:{"X-Tenant-Slug":t}});i.availabilities&&d(i.availabilities)}catch(i){console.error("Failed to load availability",i)}finally{c(!1)}}async function x(i){i.preventDefault(),o(!0);const b=i.target,h=new FormData(b),p=Number(h.get("dayOfWeek")),j=h.get("startTime"),N=h.get("endTime");try{await f("/appointments/availability",n,{method:"POST",headers:{"X-Tenant-Slug":t},body:JSON.stringify({dayOfWeek:p,startTime:j,endTime:N})}),await u(),b.reset()}catch{alert("Failed to save")}finally{o(!1)}}return r?e.jsx("div",{children:"Loading availability..."}):e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Instructor Availability"}),e.jsx("p",{className:"text-sm text-zinc-500 mb-4",children:"Set your weekly recurring available hours for private sessions."}),e.jsxs("div",{className:"space-y-2 mb-6",children:[a.length===0&&e.jsx("p",{className:"text-sm text-zinc-400 italic",children:"No availability set."}),a.map(i=>e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 px-3 py-2 rounded text-sm",children:[e.jsx("span",{className:"font-medium text-zinc-700",children:m.find(b=>b.id===i.dayOfWeek)?.label}),e.jsxs("span",{className:"text-zinc-600",children:[i.startTime," - ",i.endTime]})]},i.id))]}),e.jsxs("form",{onSubmit:x,className:"flex gap-3 items-end border-t border-zinc-100 pt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Day"}),e.jsx("select",{name:"dayOfWeek",className:"text-sm border border-zinc-300 rounded px-2 py-1.5 focus:ring-2 focus:ring-blue-500 outline-none",children:m.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"Start"}),e.jsx("input",{name:"startTime",type:"time",required:!0,className:"text-sm border border-zinc-300 rounded px-2 py-1.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-600 mb-1",children:"End"}),e.jsx("input",{name:"endTime",type:"time",required:!0,className:"text-sm border border-zinc-300 rounded px-2 py-1.5"})]}),e.jsx("button",{type:"submit",disabled:s,className:"bg-zinc-900 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:s?"Adding...":"Add Slot"})]})]})}function w({token:n,slug:t}){const[a,d]=l.useState(null),[r,c]=l.useState(!1);l.useEffect(()=>{f("/members/me",n,{headers:{"X-Tenant-Slug":t}}).then(m=>{m.member&&d(m.member.settings||{})}).catch(console.error)},[n,t]);async function s(){if(!a)return;c(!0);const u=!(a.notifications||{}).sms;try{const x=await f("/members/me/settings",n,{method:"PATCH",headers:{"X-Tenant-Slug":t},body:JSON.stringify({notifications:{sms:u}})});x.settings&&d(x.settings)}catch{alert("Failed to update settings")}finally{c(!1)}}if(!a)return null;const o=a.notifications?.sms===!0;return e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Notifications"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-900",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Receive class reminders and updates via text."})]}),e.jsx("button",{onClick:s,disabled:r,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${o?"bg-zinc-900":"bg-zinc-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o?"translate-x-6":"translate-x-1"}`})})]})]})}const D=y(function(){const{user:t,token:a,slug:d}=v();return e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 mb-2",children:"Your Profile"}),e.jsx("p",{className:"text-zinc-500 mb-8",children:"Manage your information and family members."}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Personal Info"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-zinc-500 uppercase",children:"First Name"}),e.jsx("p",{className:"text-zinc-900",children:t.profile?.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-zinc-500 uppercase",children:"Last Name"}),e.jsx("p",{className:"text-zinc-900",children:t.profile?.lastName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-zinc-500 uppercase",children:"Email"}),e.jsx("p",{className:"text-zinc-900",children:t.email})]})]})]}),e.jsx(w,{token:a,slug:d}),e.jsx(S,{token:a,tenantSlug:d}),e.jsx(z,{token:a})]})});export{D as default};
