import{j as e}from"./vendor-puck-d5q8lBvG.js";import{r as s}from"./vendor-charts-C-svo-KU.js";import{X as H}from"./x-B1-KEPzu.js";import{M as J}from"./message-circle-CclQ1loO.js";import{S as K}from"./send-DiA6Xyku.js";function X({roomId:h,tenantId:b,userId:c,userName:w,apiUrl:g="",enabled:$=!0,chatConfig:x}){const[n,R]=s.useState(!1),[m,j]=s.useState([]),[d,v]=s.useState(""),[l,y]=s.useState(!1),[V,f]=s.useState([]),o=s.useRef(null),N=s.useRef(null),z=s.useRef(n);s.useEffect(()=>{z.current=n},[n]);const[O]=s.useState(()=>`guest_${Math.random().toString(36).substr(2,9)}`),C=c||O,W=w||"Guest",S=s.useCallback(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[]);s.useEffect(()=>{S()},[m,S]),s.useEffect(()=>{if(l)return;const t=g||(typeof window<"u"?window.location.origin:""),u=t.startsWith("https")?"wss://":"ws://",M=t.replace(/^http(s)?:\/\//,""),_=`${u}${M}/api/chat/rooms/${h}/websocket?roomId=${h}&tenantId=${b}&userId=${C}&userName=${encodeURIComponent(W)}`,i=new WebSocket(_);return o.current=i,i.onopen=()=>{y(!0),console.log("[Chat] Connected")},i.onmessage=p=>{try{const r=JSON.parse(p.data);switch(r.type){case"history":j(r.messages||[]);break;case"message":j(a=>[...a,r]),!z.current&&r.userId!==C&&I(a=>a+1);break;case"user_list":f(r.users||[]);break;case"user_joined":f(a=>[...a,{userId:r.userId,userName:r.userName}]);break;case"user_left":f(a=>a.filter(q=>q.userId!==r.userId));break}}catch(r){console.error("[Chat] Parse error:",r)}},i.onclose=()=>{y(!1),console.log("[Chat] Disconnected")},i.onerror=p=>{console.error("[Chat] Error:",p)},()=>{i.close(),o.current=null}},[h,b,c,w,g]);const k=()=>{!d.trim()||!o.current||o.current.readyState!==WebSocket.OPEN||(o.current.send(JSON.stringify({type:"message",content:d.trim()})),v(""))},B=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),k())},[E,I]=s.useState(0),P=["I have a question","Contact support","Billing inquiry"],U=(t,u)=>{!o.current||o.current.readyState!==WebSocket.OPEN||o.current.send(JSON.stringify({type:"message",content:t,metadata:u?{routedRole:u}:void 0}))};return $?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{R(!n),n||I(0)},className:"fixed bottom-6 right-6 w-14 h-14 bg-[#2563EB] text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",children:[n?e.jsx(H,{size:24}):e.jsx(J,{size:24}),E>0&&!n&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white",children:E})]}),n&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans",children:[e.jsxs("div",{className:"bg-[#2563EB] text-white px-6 py-6 pb-12 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Chat with us"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:"ðŸ‘‹ Hi, message us with any questions. We're happy to help!"})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex flex-col",children:e.jsxs("div",{className:"mt-auto p-4 space-y-4",children:[m.map(t=>e.jsx("div",{className:`flex ${t.userId===c?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl text-sm ${t.userId===c?"bg-[#2563EB] text-white rounded-br-sm":"bg-gray-100 text-zinc-900 rounded-bl-sm"}`,children:e.jsx("p",{children:t.content})})},t.id)),m.length===0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide",children:"How can we help?"}),(x&&x.length>0?x:P.map(t=>({id:t,label:t,type:"action"}))).map(t=>e.jsx("button",{onClick:()=>U(t.label,t.routeToRole),disabled:!l,className:"w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",children:t.label},t.id||t.label))]}),e.jsx("div",{ref:N})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-100 bg-white",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:d,onChange:t=>v(t.target.value),onKeyPress:B,placeholder:"Write message",className:"w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",disabled:!l}),e.jsx("button",{onClick:k,disabled:!l||!d.trim(),className:"absolute right-2 p-2 text-zinc-400 hover:text-[#2563EB] transition-colors disabled:opacity-50",children:e.jsx(K,{size:20})})]}),!l&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-[10px] text-zinc-400",children:"Connecting to support..."})})]})]})]}):null}export{X as C};
