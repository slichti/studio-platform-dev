import{w as le,u as ce,f as de,a as oe,h as xe}from"./chunk-JMJ3UQ3L-BFmd18Yu.js";import{j as e}from"./vendor-puck-DM_I7lvc.js";import{a as D}from"./api-D1U4i9fn.js";import{a as O}from"./format-CAsSOgDD.js";import{a as s}from"./vendor-livekit-D3VpklN2.js";import{C as q,E as me,S as pe}from"./Dialogs-B0egr1AH.js";import{U as L}from"./upload-DoKnH7Yo.js";import{F as he}from"./film-Cpmj_PU0.js";import{c as J}from"./createLucideIcon-CcD9UNCP.js";import{S as ue}from"./search-CmzwqIX4.js";import{P as fe}from"./play-BDRwBO1h.js";import{E as be}from"./eye-UkoWWq6r.js";import{T as G}from"./trash-2-BHPWr9eo.js";import{S as ge}from"./share-2-_0TwY3-Y.js";import{C as Y}from"./circle-check-big-DvZS8AIf.js";import{X as V}from"./x-Cbj0htte.js";import{R as H}from"./refresh-cw-DEg60w5A.js";import{C as je}from"./circle-alert-BrO62f5x.js";import"./Modal-BwVo3caz.js";const ve=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ne=J("funnel",ve);const ye=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],ze=J("monitor-play",ye),Ge=le(function(){const{videos:A,stats:m,brandingAssets:p,tenants:h}=ce(),P=de(),[I,u]=oe(),f=I.get("tab")||"videos",Q=xe(),[U,X]=s.useState(I.get("q")||""),[b,K]=s.useState(""),[n,g]=s.useState(null),[W,j]=s.useState(!1),[c,B]=s.useState(""),[r,d]=s.useState("vod"),[v,M]=s.useState(!1),[Z,l]=s.useState(null),[o,N]=s.useState(null),[x,F]=s.useState(""),[y,z]=s.useState(null),[w,S]=s.useState(null),[k,C]=s.useState({isOpen:!1,message:""}),[T,$]=s.useState({isOpen:!1,message:""}),ee=async()=>{if(!(!o||!x))try{const t=await window.Clerk?.session?.getToken();await D(`/admin/videos/${o.id}/share`,t,{method:"POST",body:JSON.stringify({tenantId:x})}),$({isOpen:!0,message:"Video shared successfully!"}),N(null),F("")}catch(t){console.error(t),C({isOpen:!0,message:"Share failed"})}},te=t=>{t.preventDefault(),u(i=>(i.set("q",U),i))},se=()=>{y&&(P({intent:"delete_video",id:y},{method:"post"}),z(null))},ne=()=>{w&&(P({intent:"delete_branding",id:w},{method:"post"}),S(null))},E=async t=>{M(!0),l("Getting upload URL...");try{const i=await window.Clerk?.session?.getToken(),ie=await D("/admin/videos/upload-url",i,{method:"POST",body:JSON.stringify({targetTenantId:c,type:r})}),{uploadUrl:ae,uid:re}=ie;l("Uploading to Cloudflare...");const _=new FormData;if(_.append("file",t),!(await fetch(ae,{method:"POST",body:_})).ok)throw new Error("Upload to video server failed");l("Registering asset..."),await D("/admin/videos",i,{method:"POST",body:JSON.stringify({targetTenantId:c,type:r,title:t.name,cloudflareStreamId:re,description:"Uploaded by Admin"})}),l("Done!"),j(!1),Q.revalidate(),B(""),d("vod")}catch(i){console.error(i),C({isOpen:!0,message:"Upload failed: "+i.message})}finally{M(!1),l(null)}},R=A.filter(t=>!(b&&t.tenantId!==b));return e.jsxs("div",{className:"space-y-6 relative",children:[e.jsx(q,{isOpen:!!y,onClose:()=>z(null),onConfirm:se,title:"Delete Video",message:"Are you sure you want to force delete this video? This cannot be undone.",confirmText:"Delete Video",isDestructive:!0}),e.jsx(q,{isOpen:!!w,onClose:()=>S(null),onConfirm:ne,title:"Delete Branding Asset",message:"Are you sure you want to delete this branding asset?",confirmText:"Delete Asset",isDestructive:!0}),e.jsx(me,{isOpen:k.isOpen,onClose:()=>C({...k,isOpen:!1}),message:k.message}),e.jsx(pe,{isOpen:T.isOpen,onClose:()=>$({...T,isOpen:!1}),message:T.message}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Platform Video Management"}),e.jsx("p",{className:"text-zinc-500",children:"Monitor storage usage and manage video assets across all studios."})]}),e.jsxs("button",{onClick:()=>j(!0),className:"bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 transition flex items-center gap-2",children:[e.jsx(L,{size:16}),"Upload Asset"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Total Videos"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:m.totalVideos})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Total Storage"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:O(m.totalStorageBytes)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm text-zinc-500 font-medium uppercase tracking-wider",children:"Processing"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:m.processingCount})]})]}),e.jsxs("div",{className:"border-b border-zinc-200 flex flex-col md:flex-row md:items-center justify-between gap-4 pb-0",children:[e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>u({tab:"videos"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${f==="videos"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e.jsx(he,{size:16}),"Studio Videos",e.jsx("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:A.length})]}),e.jsxs("button",{onClick:()=>u({tab:"branding"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${f==="branding"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e.jsx(ze,{size:16}),"Branding Assets",e.jsx("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:p.length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 md:pb-0",children:[e.jsxs("form",{onSubmit:te,className:"relative",children:[e.jsx(ue,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"search",placeholder:"Search videos...",value:U,onChange:t=>X(t.target.value),className:"pl-9 pr-4 py-2 border border-zinc-200 rounded-lg text-sm w-64 focus:ring-2 focus:ring-black focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b,onChange:t=>K(t.target.value),className:"pl-3 pr-8 py-2 border border-zinc-200 rounded-lg text-sm appearance-none bg-white focus:ring-2 focus:ring-black focus:border-transparent outline-none cursor-pointer",children:[e.jsx("option",{value:"",children:"All Tenants"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(Ne,{className:"absolute right-2.5 top-2.5 h-4 w-4 text-zinc-400 pointer-events-none"})]})]})]}),f==="videos"?e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200 text-zinc-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Video"}),e.jsx("th",{className:"px-4 py-3",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[R.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50/50 group",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-zinc-100 rounded flex items-center justify-center text-zinc-400 cursor-pointer hover:bg-zinc-200 hover:text-zinc-600 transition",onClick:()=>g(t),children:e.jsx(fe,{size:16,fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.title||"Untitled"}),e.jsx("div",{className:"text-xs text-zinc-400 font-mono",children:t.id})]})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-zinc-900",children:t.tenantName||e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 text-zinc-800 border border-zinc-200",children:"Platform"})}),t.tenantSlug&&e.jsx("div",{className:"text-xs text-zinc-500",children:t.tenantSlug})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(we,{status:t.status})}),e.jsx("td",{className:"px-4 py-3 text-zinc-600 font-mono",children:O(t.sizeBytes)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>g(t),className:"p-1 text-zinc-400 hover:text-blue-600 hover:bg-blue-50 rounded transition",title:"Preview",children:e.jsx(be,{size:16})}),e.jsx("button",{onClick:()=>z(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e.jsx(G,{size:16})}),!t.tenantId&&e.jsx("button",{onClick:()=>N(t),className:"p-1 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition",title:"Share with Tenant",children:e.jsx(ge,{size:16})})]})})]},t.id)),R.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-zinc-500",children:"No videos found matching your filters."})})]})]})}):e.jsx("div",{className:"bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200 text-zinc-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Asset Title"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3",children:"Active"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[p.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.title}),e.jsx("div",{className:"text-xs text-zinc-400 font-mono truncate max-w-[150px]",children:t.cloudflareStreamId})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize ${t.type==="intro"?"bg-indigo-100 text-indigo-700":"bg-purple-100 text-purple-700"}`,children:t.type})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-zinc-900",children:t.tenantName}),e.jsx("div",{className:"text-xs text-zinc-500",children:t.tenantSlug})]}),e.jsx("td",{className:"px-4 py-3 text-zinc-600 font-mono",children:t.active?e.jsxs("span",{className:"text-emerald-600 flex items-center gap-1 text-xs font-semibold",children:[e.jsx(Y,{size:12})," Yes"]}):e.jsx("span",{className:"text-zinc-400 text-xs",children:"No"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>S(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e.jsx(G,{size:16})})})]},t.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-zinc-500",children:"No branding assets found."})})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Upload Video"}),e.jsx("button",{onClick:()=>j(!1),className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(V,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Target"}),e.jsxs("select",{className:"w-full rounded-lg border-zinc-200 text-sm",value:c,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"",children:"Platform Master Asset (No Tenant)"}),e.jsx("optgroup",{label:"Tenants",children:h.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.slug,")"]},t.id))})]}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:c?"Video will be owned by this tenant.":"Video will be available to the platform. You can share it with tenants later."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Asset Type"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>d("vod"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="vod"?"bg-zinc-900 text-white border-zinc-900":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Video (VOD)"}),e.jsx("button",{onClick:()=>d("intro"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="intro"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Intro"}),e.jsx("button",{onClick:()=>d("outro"),className:`px-3 py-2 text-sm rounded-md border text-center ${r==="outro"?"bg-purple-600 text-white border-purple-600":"bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50"}`,children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"File"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition cursor-pointer relative ${v?"bg-zinc-50 border-zinc-200":"hover:bg-zinc-50 border-zinc-300 hover:border-zinc-400"}`,onDragOver:t=>{t.preventDefault(),t.stopPropagation()},onDrop:t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.files?.[0]&&E(t.dataTransfer.files[0])},children:[e.jsx("input",{type:"file",accept:"video/*",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:v,onChange:t=>t.target.files?.[0]&&E(t.target.files[0])}),v?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(H,{className:"animate-spin text-zinc-400"}),e.jsx("span",{className:"text-sm text-zinc-500",children:Z})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-zinc-100 rounded-full flex items-center justify-center text-zinc-400",children:e.jsx(L,{size:20})}),e.jsx("span",{className:"text-sm text-zinc-600 font-medium",children:"Click or Drag video here"}),e.jsx("span",{className:"text-xs text-zinc-400",children:"MP4, MOV, etc."})]})]})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-black rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-zinc-800",children:[e.jsx("h2",{className:"text-lg font-bold text-white max-w-2xl truncate",children:n.title}),e.jsx("button",{onClick:()=>g(null),className:"text-zinc-400 hover:text-white",children:e.jsx(V,{size:24})})]}),e.jsx("div",{className:"flex-1 bg-black aspect-video relative",children:n.cloudflareStreamId?e.jsx("iframe",{src:`https://iframe.videodelivery.net/${n.cloudflareStreamId}`,className:"w-full h-full absolute inset-0",allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0}):e.jsx("div",{className:"flex items-center justify-center h-full text-zinc-500",children:"Video not available"})}),e.jsxs("div",{className:"p-4 bg-zinc-900 border-t border-zinc-800 text-sm text-zinc-400 flex gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Duration"}),n.duration?Math.floor(n.duration/60)+"m "+n.duration%60+"s":"--"]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Size"}),O(n.sizeBytes)]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Status"}),e.jsx("span",{className:"capitalize",children:n.status})]})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-sm w-full p-6 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Share Video"}),e.jsx("button",{onClick:()=>N(null),className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(V,{size:20})})]}),e.jsxs("p",{className:"text-sm text-zinc-500 mb-4",children:["Give a tenant access to ",e.jsx("strong",{children:o.title}),"."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Select Tenant"}),e.jsxs("select",{className:"w-full rounded-lg border-zinc-200 text-sm",value:x,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"",children:"Select a tenant..."}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("button",{onClick:ee,disabled:!x,className:"w-full bg-indigo-600 text-white py-2 rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Grant Access"})]})]})})]})});function we({status:a}){return a==="ready"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:[e.jsx(Y,{size:12})," Ready"]}):a==="processing"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:[e.jsx(H,{size:12,className:"animate-spin"})," Processing"]}):a==="error"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(je,{size:12})," Error"]}):e.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-zinc-100 text-zinc-700",children:a})}export{Ge as default};
