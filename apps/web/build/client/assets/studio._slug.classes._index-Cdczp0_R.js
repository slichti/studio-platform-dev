import{w as R,u as $,e as L,i as M,a as q}from"./chunk-JMJ3UQ3L-DR3wp0kw.js";import{j as t}from"./vendor-puck-By1A5E5K.js";import{a as J}from"./api-OnQO3erh.js";import{a as o}from"./vendor-sentry-BD1MTpLq.js";import{C as W,B as V}from"./BookingModal-J0jR-Taq.js";import{t as w}from"./index-C_1Jy3MY.js";import{C as N}from"./Dialogs-LpmU1ed2.js";import{P as H}from"./plus-BBRn-p3b.js";import{c as U}from"./createLucideIcon-DgXJrNmH.js";import{A as X}from"./archive-D-1vvCVw.js";import"./Modal-D5keykku.js";import"./chunk-OT5FTIRN-BigJMP2-.js";import"./index-D9ERMtIL.js";import"./vendor-charts-BzoqY3DK.js";import"./x-6mvJS0UK.js";import"./user-B9JVtPOG.js";import"./users-DTyswlyE.js";import"./dialog-DQ7iZiMh.js";import"./portal-Dzo5VpZ6.js";const Z=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],G=U("archive-restore",Z),ge=R(function(){const{classes:l,family:u,error:b,locations:S,instructors:B,plans:A}=$(),{member:g,roles:f,tenant:k,me:I}=L()||{},n=M(),[v,P]=q(),[m,x]=o.useState(l);o.useEffect(()=>{x(l)},[l]);const[y,d]=o.useState(null),[D,z]=o.useState(!1),j=f?.includes("owner")||f?.includes("instructor"),[a,h]=o.useState(null),[c,p]=o.useState(null),T=i=>{(u.length>0||i.zoomEnabled)&&d(i)},O=i=>{x([...m,i])},E=(i,s)=>{h({id:i,archive:s})},_=async()=>{if(!a)return;const{id:i,archive:s}=a;try{const e=await window.Clerk?.session?.getToken();await J(`/classes/${i}`,e,{method:"PATCH",headers:{"X-Tenant-Slug":k.slug},body:JSON.stringify({status:s?"archived":"active"})}),x(m.map(r=>r.id===i?{...r,status:s?"archived":"active"}:r)),w.success(s?"Class archived":"Class restored")}catch{w.error("Failed to update class status")}finally{h(null)}},F=()=>{c&&(n.submit({intent:"cancel_booking",bookingId:c.bookingId,classId:c.classId},{method:"post"}),p(null))},C=m.reduce((i,s)=>{const e=new Date(s.startTime).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"});return i[e]||(i[e]=[]),i[e].push(s),i},{});return t.jsxs("div",{children:[t.jsx(W,{isOpen:D,onClose:()=>z(!1),onSuccess:O,tenantId:k?.id,locations:S,instructors:B,plans:A}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Class Schedule"}),t.jsxs("div",{className:"flex items-center gap-2",children:[j&&t.jsxs(t.Fragment,{children:[t.jsxs("label",{className:"flex items-center gap-1.5 text-sm cursor-pointer mr-2",children:[t.jsx("input",{type:"checkbox",className:"rounded border-zinc-300",checked:v.get("includeArchived")==="true",onChange:i=>{const s=new URLSearchParams(v);i.target.checked?s.set("includeArchived","true"):s.delete("includeArchived"),P(s)}}),t.jsx("span",{className:"text-zinc-600 dark:text-zinc-400",children:"Show Archived"})]}),t.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-md hover:opacity-90 transition-opacity font-medium text-sm",children:[t.jsx(H,{size:16}),"Create Class"]})]}),!I&&t.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Sign in to book classes."})]})]}),b&&t.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded mb-4 text-sm",children:["Failed to load schedule: ",b]}),t.jsx(V,{isOpen:!!y,onClose:()=>d(null),classEvent:y,family:u,member:g}),t.jsx("div",{className:"space-y-8",children:Object.keys(C).length===0?t.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg",children:"No upcoming classes scheduled."}):Object.entries(C).map(([i,s])=>t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-3 sticky top-0 bg-zinc-50/95 dark:bg-zinc-950/95 py-2 backdrop-blur",children:i}),t.jsx("div",{className:"space-y-3",children:s.map(e=>t.jsxs("div",{className:`p-4 rounded-lg border shadow-sm transition-colors flex justify-between items-center ${e.status==="archived"?"bg-zinc-50 dark:bg-zinc-900/50 border-zinc-100 dark:border-zinc-800 opacity-60":"bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-zinc-300"}`,children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:e.title}),e.status==="archived"&&t.jsx("span",{className:"text-[10px] uppercase bg-zinc-200 text-zinc-600 px-1.5 py-0.5 rounded",children:"Archived"})]}),t.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex flex-wrap gap-x-3",children:[t.jsxs("span",{children:[new Date(e.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," â€¢ ",e.durationMinutes," min"]}),e.instructor?.user?.profile&&t.jsxs("span",{children:["with ",e.instructor.user.profile.firstName]}),e.capacity&&t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[t.jsxs("span",{className:`px-1.5 py-0.5 rounded ${(e.inPersonCount||0)>=e.capacity?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400"}`,children:["In-Person: ",e.inPersonCount||0," / ",e.capacity]}),e.zoomEnabled&&t.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800",children:["Virtual: ",e.virtualCount||0]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[j&&t.jsx("button",{onClick:()=>E(e.id,e.status!=="archived"),className:"p-1.5 text-zinc-400 hover:text-zinc-600 hover:bg-zinc-100 rounded",title:e.status==="archived"?"Restore Class":"Archive Class",children:e.status==="archived"?t.jsx(G,{size:16}):t.jsx(X,{size:16})}),e.status!=="archived"&&t.jsx("div",{children:g?t.jsx(t.Fragment,{children:u.length>0?t.jsx("button",{onClick:()=>T(e),disabled:e.userBookingStatus==="confirmed",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${e.userBookingStatus==="confirmed"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:e.userBookingStatus==="confirmed"?"Booked":!e.zoomEnabled&&(e.inPersonCount||0)>=(e.capacity||1/0)?"Join Waitlist":"Book"}):t.jsx("div",{className:"flex flex-col gap-2 items-end",children:e.userBookingStatus==="confirmed"?t.jsxs("div",{className:"flex items-center gap-2",children:[e.zoomEnabled&&e.userBooking?t.jsxs(n.Form,{method:"post",children:[t.jsx("input",{type:"hidden",name:"intent",value:"switch_attendance"}),t.jsx("input",{type:"hidden",name:"classId",value:e.id}),t.jsx("input",{type:"hidden",name:"bookingId",value:e.userBooking.id}),t.jsx("input",{type:"hidden",name:"attendanceType",value:e.userBooking.attendanceType==="zoom"?"in_person":"zoom"}),t.jsxs("button",{type:"submit",title:"Switch Attendance Type",disabled:n.state!=="idle",className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:["Switch to ",e.userBooking.attendanceType==="zoom"?"In-Person":"Zoom"]})]}):null,t.jsx("button",{type:"button",onClick:()=>p({bookingId:e.userBooking.id,classId:e.id}),disabled:n.state!=="idle",className:"text-xs text-red-600 hover:underline disabled:opacity-50",children:"Cancel"}),t.jsxs("span",{className:"px-4 py-2 text-sm font-medium rounded bg-zinc-100 text-zinc-500 cursor-default",children:["Booked ",e.userBooking?.attendanceType==="zoom"?"(Virtual)":"(In-Person)"]})]}):t.jsxs(n.Form,{method:"post",children:[t.jsx("input",{type:"hidden",name:"intent",value:(e.confirmedCount||0)>=(e.capacity||1/0)?"waitlist":"book"}),t.jsx("input",{type:"hidden",name:"classId",value:e.id}),t.jsx("button",{type:"submit",onClick:r=>{e.zoomEnabled&&(r.preventDefault(),d(e))},disabled:n.state!=="idle"&&n.formData?.get("classId")===e.id||e.userBookingStatus==="confirmed"||e.userBookingStatus==="waitlisted",className:`px-4 py-2 text-sm font-medium rounded transition-colors disabled:opacity-50 ${e.userBookingStatus==="confirmed"||e.userBookingStatus==="waitlisted"?"bg-zinc-100 text-zinc-500 cursor-default":"bg-zinc-900 text-white hover:bg-zinc-800"}`,children:n.state!=="idle"&&n.formData?.get("classId")===e.id?"Processing...":e.userBookingStatus==="confirmed"?"Booked":e.userBookingStatus==="waitlisted"?"On Waitlist":!e.zoomEnabled&&(e.inPersonCount||0)>=(e.capacity||1/0)?"Join Waitlist":"Book"})]})})}):t.jsx("a",{href:"/sign-in",className:"px-4 py-2 border border-zinc-300 text-zinc-700 text-sm font-medium rounded hover:bg-zinc-50",children:"Login to Book"})})]})]},e.id))})]},i))}),t.jsx(N,{isOpen:!!a,onClose:()=>h(null),onConfirm:_,title:a?.archive?"Archive Class":"Restore Class",message:`Are you sure you want to ${a?.archive?"archive":"unarchive"} this class?`,confirmText:a?.archive?"Archive":"Restore",isDestructive:a?.archive}),t.jsx(N,{isOpen:!!c,onClose:()=>p(null),onConfirm:F,title:"Cancel Booking",message:"Are you sure you want to cancel this booking?",confirmText:"Cancel Booking",isDestructive:!0})]})});export{ge as default};
