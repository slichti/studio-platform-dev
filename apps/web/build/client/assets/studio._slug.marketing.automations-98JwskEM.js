import{w as Q,u as D,e as ee}from"./chunk-JMJ3UQ3L-DsmOvVYk.js";import{j as e}from"./vendor-puck-Ox9nZAW8.js";import{a as n}from"./vendor-sentry-JepEA2vj.js";import{C as te}from"./ConfirmDialog-FyjGOAg4.js";import{t as U}from"./index-Cb5OqxoU.js";import{Z as T}from"./zap-4XO_A8Yl.js";import{P as se}from"./plus-CWTELB5_.js";import{U as R}from"./users-EVjyZsvX.js";import{C as ie}from"./calendar-vWMk9t_Y.js";import{T as ne}from"./target-UN6rGDsM.js";import{C as W}from"./clock-DKxge1S_.js";import{c as X}from"./createLucideIcon-CZ3UnH4h.js";import{X as H}from"./x-Cj-HlmNQ.js";import{T as J}from"./trash-2-BcHoghLw.js";import{P as le}from"./pencil-_w-IsDxh.js";import{P as re}from"./play-BJ8lOJGZ.js";import{L as ae}from"./loader-circle-CRrLibi7.js";import{S as ce}from"./sparkles-Dx8loAwz.js";import"./dialog-BnIpflAQ.js";import"./dialog-Cpa2T3be.js";import"./portal-BoZ3-f1n.js";import"./vendor-charts-CBCVHb7z.js";import"./button-D-ZXNsM5.js";const oe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],de=X("bell",oe);const me=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],xe=X("pause",me),Z=[{id:"new_member",label:"New Member Signs Up",icon:R},{id:"class_booked",label:"Class Booked",icon:ie},{id:"class_missed",label:"Class No-Show",icon:ne},{id:"inactive_days",label:"Inactive for X Days",icon:W},{id:"birthday",label:"Member Birthday",icon:de},{id:"membership_expiring",label:"Membership Expiring",icon:W},{id:"product_purchase",label:"Product Purchased",icon:T},{id:"subscription_canceled",label:"Subscription Canceled (Period End)",icon:H},{id:"subscription_terminated",label:"Subscription Terminated",icon:J},{id:"student_updated",label:"Student Profile Updated",icon:R}],Le=Q(function(){const{automations:x,stats:i}=D(),l=ee(),[y,c]=n.useState(!1),[p,o]=n.useState(null),[d,u]=n.useState(null),z=s=>{l({intent:"toggle",id:s},{method:"post"})},C=s=>{o(s)},w=()=>{p&&(l({intent:"delete",id:p},{method:"post"}),o(null))},m=()=>{u(null),c(!0)},g=s=>{u(s),c(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50",children:[e.jsx("header",{className:"bg-white border-b border-zinc-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg text-white",children:e.jsx(T,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-zinc-900",children:"Automations"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Set up automated email & SMS campaigns"})]})]}),e.jsxs("button",{onClick:m,className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",children:[e.jsx(se,{size:16})," Create Automation"]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[i&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-zinc-900",children:i.totalAutomations||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Total Automations"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.activeCount||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Active"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.emailsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Emails Sent (30d)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.smsSent||0}),e.jsx("div",{className:"text-xs text-zinc-500",children:"SMS Sent (30d)"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-zinc-200",children:[e.jsx(T,{size:48,className:"mx-auto mb-4 text-zinc-300"}),e.jsx("p",{className:"text-zinc-500 mb-4",children:"No automations yet"}),e.jsx("button",{onClick:m,className:"text-sm text-zinc-900 underline",children:"Create your first"})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const r=Z.find(j=>j.id===s.triggerEvent||j.id===s.trigger),a=r?.icon||T;return e.jsx("div",{className:`bg-white rounded-xl border ${s.isActive?"border-green-200":"border-zinc-200"} p-5`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${s.isActive?"bg-green-100":"bg-zinc-100"}`,children:e.jsx(a,{size:24,className:s.isActive?"text-green-600":"text-zinc-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-zinc-900",children:s.name||s.subject}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:s.isActive?"Active":"Paused"})]}),e.jsxs("p",{className:"text-sm text-zinc-500 mt-1",children:["Trigger: ",r?.label||s.triggerEvent]}),s.timingType!=="immediate"&&e.jsxs("p",{className:"text-xs text-zinc-400 mt-1",children:["Timing: ",s.timingType==="delay"?`Delay ${s.timingValue}h`:`Before ${s.timingValue}h`]}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-zinc-400",children:e.jsxs("span",{children:["Runs: ",s.runCount||0]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(s),className:"p-2 hover:bg-zinc-100 rounded-lg text-zinc-500",title:"Edit",children:e.jsx(le,{size:16})}),e.jsx("button",{onClick:()=>z(s.id),className:`p-2 rounded-lg ${s.isActive?"hover:bg-yellow-50 text-yellow-600":"hover:bg-green-50 text-green-600"}`,title:s.isActive?"Pause":"Activate",children:s.isActive?e.jsx(xe,{size:16}):e.jsx(re,{size:16})}),e.jsx("button",{onClick:()=>C(s.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-500",children:e.jsx(J,{size:16})})]})]})},s.id)})})]}),y&&e.jsx(ue,{initialData:d,onClose:()=>c(!1),onSave:s=>{const r=new FormData;r.append("intent",d?"update":"create"),d&&r.append("id",d.id);for(const a of Object.keys(s))typeof s[a]=="object"?r.append(a,JSON.stringify(s[a])):r.append(a,s[a]);l(r,{method:"post"}),c(!1)}}),e.jsx(te,{open:!!p,onOpenChange:s=>!s&&o(null),onConfirm:w,title:"Delete Automation",description:"Are you sure you want to delete this automation? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})]})}),pe=[{id:"immediate",label:"Immediately"},{id:"delay",label:"Delay (Hours)"},{id:"before",label:"Before Event (Hours)"}];function ue({onClose:b,onSave:x,initialData:i}){const[l,y]=n.useState(1),[c,p]=n.useState(""),[o,d]=n.useState("new_student"),[u,z]=n.useState("immediate"),[C,w]=n.useState("0"),[m,g]=n.useState("all"),[s,r]=n.useState(""),[a,j]=n.useState(""),[f,P]=n.useState(!1),[S,I]=n.useState("percent"),[V,F]=n.useState("10"),[B,G]=n.useState("7"),[v,N]=n.useState("simple"),[M,k]=n.useState(""),[_,$]=n.useState(""),[A,L]=n.useState(""),[E,O]=n.useState(!1),q=async()=>{O(!0);try{const t=await window.Clerk?.session?.getToken(),K=window.location.pathname.split("/")[2],h=await(await fetch("https://studio-platform-api.slichti.workers.dev/marketing/automations/ai/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Tenant-Slug":K},body:JSON.stringify({trigger:o})})).json();h.success&&h.subject&&h.content?(k(h.subject),$(h.content),N("simple")):U.error(h.error||"AI generation failed")}catch(t){console.error(t),U.error("AI generation failed")}finally{O(!1)}};n.useEffect(()=>{i&&(p(i.name||i.subject||""),d(i.triggerEvent||"new_student"),z(i.timingType||"immediate"),w(String(i.timingValue||0)),i.audienceFilter&&(g("filter"),r(i.audienceFilter.ageMin?String(i.audienceFilter.ageMin):""),j(i.audienceFilter.ageMax?String(i.audienceFilter.ageMax):"")),i.couponConfig&&(P(!0),I(i.couponConfig.type||"percent"),F(String(i.couponConfig.value||10)),G(String(i.couponConfig.validityDays||7))),i.templateId?(N("template"),L(i.templateId),k(i.subject||"")):(N("simple"),k(i.subject||""),$(i.content||"")))},[i]);const Y=()=>{const t={name:c,trigger:o,triggerConfig:{},actions:[],isActive:!0,timingType:u,timingValue:parseInt(C)||0};m==="filter"&&(t.audienceFilter={},s&&(t.audienceFilter.ageMin=parseInt(s)),a&&(t.audienceFilter.ageMax=parseInt(a))),f&&(t.couponConfig={type:S,value:parseInt(V),validityDays:parseInt(B)}),v==="template"?(t.templateId=A,t.subject=M||"Notification",t.content="Template: "+A):(t.subject=M,t.content=_),x(t)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:i?"Edit Automation":"Create Automation"}),e.jsx("button",{onClick:b,children:e.jsx(H,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:[1,2,3,4].map(t=>e.jsx("div",{className:`h-1 flex-1 rounded-full ${t<=l?"bg-purple-600":"bg-zinc-100"}`},t))}),l===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Automation Name"}),e.jsx("input",{type:"text",value:c,onChange:t=>p(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"e.g., Welcome Series"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Trigger"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 h-48 overflow-y-auto pr-1",children:Z.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:`p-3 rounded-lg border text-left flex items-center gap-2 ${o===t.id?"border-purple-500 bg-purple-50":"border-zinc-200 hover:bg-zinc-50"}`,children:[e.jsx(t.icon,{size:16,className:o===t.id?"text-purple-600":"text-zinc-400"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Timing"}),e.jsx("div",{className:"flex bg-zinc-100 p-1 rounded-lg mb-2",children:pe.map(t=>e.jsx("button",{onClick:()=>z(t.id),className:`flex-1 py-1.5 text-xs font-medium rounded-md ${u===t.id?"bg-white shadow text-zinc-900":"text-zinc-500 hover:text-zinc-700"}`,children:t.label},t.id))}),u!=="immediate"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:C,onChange:t=>w(t.target.value),className:"w-24 px-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"text-sm text-zinc-500",children:"hours"})]})]})]}),l===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Audience Targeting"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:m==="all",onChange:()=>g("all")}),e.jsx("span",{children:"All Members"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"aud",checked:m==="filter",onChange:()=>g("filter")}),e.jsx("span",{children:"Filtered"})]})]}),m==="filter"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Min Age"}),e.jsx("input",{type:"number",value:s,onChange:t=>r(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Max Age"}),e.jsx("input",{type:"number",value:a,onChange:t=>j(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"65"})]})]})]}),l===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Sweeteners"}),e.jsxs("div",{className:"p-4 border border-zinc-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center ${f?"bg-purple-600 border-purple-600":"border-zinc-300"}`,children:f&&e.jsx(he,{size:12,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Generate Unique Coupon"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Include a single-use code in the email."})]})]}),e.jsx("input",{type:"checkbox",checked:f,onChange:t=>P(t.target.checked),className:"hidden"})]}),f&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-zinc-100 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 flex bg-zinc-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>I("percent"),className:`flex-1 py-1 text-xs font-medium rounded-md ${S==="percent"?"bg-white shadow":"text-zinc-500"}`,children:"Percentage Off"}),e.jsx("button",{onClick:()=>I("amount"),className:`flex-1 py-1 text-xs font-medium rounded-md ${S==="amount"?"bg-white shadow":"text-zinc-500"}`,children:"Flat Amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Value"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:V,onChange:t=>F(t.target.value),className:"w-full pl-8 pr-3 py-2 border border-zinc-200 rounded-lg"}),e.jsx("span",{className:"absolute left-3 top-2 text-zinc-400 text-sm",children:S==="percent"?"%":"$"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Expires In (Days)"}),e.jsx("input",{type:"number",value:B,onChange:t=>G(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg"})]})]})]})]}),l===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-zinc-900",children:"Email Content"}),e.jsxs("button",{onClick:q,disabled:E,className:"flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg text-xs font-medium hover:opacity-90 disabled:opacity-50 shadow-sm",children:[E?e.jsx(ae,{size:14,className:"animate-spin"}):e.jsx(ce,{size:14}),E?"Generating...":"Generate with AI"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:M,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"Welcome!"})]}),e.jsxs("div",{className:"flex gap-4 border-b border-zinc-100 pb-2",children:[e.jsx("button",{onClick:()=>N("simple"),className:`pb-2 text-sm font-medium ${v==="simple"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Simple Text"}),e.jsx("button",{onClick:()=>N("template"),className:`pb-2 text-sm font-medium ${v==="template"?"text-purple-600 border-b-2 border-purple-600":"text-zinc-500"}`,children:"Resend Template"})]}),v==="simple"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Message Body"}),e.jsx("textarea",{value:_,onChange:t=>$(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg h-32",placeholder:"Start typing... Use {{firstName}} for variables."})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Template ID"}),e.jsx("input",{type:"text",value:A,onChange:t=>L(t.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",placeholder:"re_123456789"}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:["Variables sent: generic data + ",e.jsx("code",{children:"title"}),", ",e.jsx("code",{children:"address"}),", ",e.jsx("code",{children:"firstName"}),", ",e.jsx("code",{children:"couponCode"}),"."]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 flex justify-between",children:[l>1&&e.jsx("button",{onClick:()=>y(l-1),className:"px-4 py-2 text-sm text-zinc-500",children:"Back"}),l<4?e.jsx("button",{onClick:()=>y(l+1),disabled:!c&&l===1,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:"Next"}):e.jsx("button",{onClick:Y,disabled:v==="simple"?!_:!A,className:"ml-auto px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:i?"Save Changes":"Create Automation"})]})]})})}function he({size:b,className:x}){return e.jsx("svg",{width:b||24,height:b||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:x,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}export{Le as default};
