import{r as i,w as z,c as k}from"./chunk-EPOLDU6W-CCdTpUCB.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as m}from"./api-LAgipKeK.js";import{K as w,h as C,O as v,z as S,Q as D}from"./dialog-fnxKWwBT.js";import{X as P}from"./x-Dyma3cRt.js";import{L as T}from"./loader-circle-DFPfW-an.js";import{f as N}from"./format-CLi5Eqkk.js";import"./portal-DmWKGZJg.js";import"./with-selector-qKCSdeER.js";import"./index-BAha9i8H.js";import"./createLucideIcon-BL8SG8hg.js";function $({defaultValue:t,className:s,children:r,...l}){return e.jsx(F,{defaultValue:t,className:s,children:r})}const j=i.createContext(null);function F({defaultValue:t,children:s,className:r}){const[l,o]=i.useState(t);return e.jsx(j.Provider,{value:{activeTab:l,setActiveTab:o},children:e.jsx("div",{className:r,children:s})})}function M({className:t,children:s}){return e.jsx("div",{className:`inline-flex h-9 items-center justify-center rounded-lg bg-zinc-100 p-1 text-zinc-500 dark:bg-zinc-800 dark:text-zinc-400 ${t}`,children:s})}function b({value:t,children:s,className:r}){const{activeTab:l,setActiveTab:o}=i.useContext(j),a=l===t;return e.jsx("button",{onClick:()=>o(t),className:`inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 
            ${a?"bg-white text-zinc-950 shadow-sm dark:bg-zinc-950 dark:text-zinc-50":"hover:bg-zinc-200 dark:hover:bg-zinc-700"} 
            ${r}`,children:s})}function g({value:t,children:s,className:r}){const{activeTab:l}=i.useContext(j);return l!==t?null:e.jsx("div",{className:`mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300 ${r}`,children:s})}const y=i.createContext(null);function I({children:t}){const[s,r]=i.useState(!1);return e.jsx(y.Provider,{value:{isOpen:s,setIsOpen:r},children:t})}function O({asChild:t,children:s,onClick:r}){const{setIsOpen:l}=i.useContext(y);return e.jsx("div",{onClick:()=>l(!0),className:"inline-block cursor-pointer",children:s})}function R({children:t,className:s}){const{isOpen:r,setIsOpen:l}=i.useContext(y);return e.jsx(w,{appear:!0,show:r,as:i.Fragment,children:e.jsxs(C,{as:"div",className:"relative z-50",onClose:()=>l(!1),children:[e.jsx(v,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/80"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(v,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(S,{className:`w-full max-w-lg transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all dark:bg-zinc-950 dark:border dark:border-zinc-800 ${s}`,children:[t,e.jsx("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none",onClick:()=>l(!1),children:e.jsx(P,{className:"h-4 w-4 text-zinc-500"})})]})})})})]})})}function A({children:t,className:s}){return e.jsx("div",{className:`flex flex-col space-y-1.5 text-center sm:text-left ${s}`,children:t})}function E({children:t,className:s}){return e.jsx(D,{as:"h3",className:`text-lg font-semibold leading-none tracking-tight ${s}`,children:t})}function L({children:t,className:s}){return e.jsx("p",{className:`text-sm text-zinc-500 dark:text-zinc-400 ${s}`,children:t})}const ee=z(function(){const{tenant:s}=k(),[r,l]=i.useState(null);return i.useEffect(()=>{window.Clerk?.session?.getToken().then(l)},[]),r?e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Instructor Payroll"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Automate calculation and tracking of payouts."})]}),e.jsxs($,{defaultValue:"run",className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(b,{value:"run",children:"Run Payroll"}),e.jsx(b,{value:"history",children:"History"}),e.jsx(b,{value:"config",children:"Configuration"})]}),e.jsx(g,{value:"run",children:e.jsx(H,{token:r})}),e.jsx(g,{value:"history",children:e.jsx(J,{token:r})}),e.jsx(g,{value:"config",children:e.jsx(_,{token:r})})]})]}):e.jsx("div",{className:"p-8",children:e.jsx(T,{className:"animate-spin"})})});function H({token:t}){const[s,r]=i.useState(N(new Date(new Date().setDate(1)),"yyyy-MM-dd")),[l,o]=i.useState(N(new Date,"yyyy-MM-dd")),[a,u]=i.useState(null),[x,d]=i.useState(!1),f=async()=>{d(!0);try{const c=await m("/payroll/generate",t,{method:"POST",body:JSON.stringify({startDate:s,endDate:l,commit:!1})});u(c.preview)}catch(c){console.error(c),alert("Failed to generate preview")}finally{d(!1)}},p=async()=>{if(confirm("Are you sure? This will generate payout records.")){d(!0);try{const c=await m("/payroll/generate",t,{method:"POST",body:JSON.stringify({startDate:s,endDate:l,commit:!0})});c.success&&(alert(`Successfully generated ${c.count} payouts.`),u(null))}catch(c){console.error(c),alert("Failed to commit payroll")}finally{d(!1)}}};return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Generate Cycle"}),e.jsxs("div",{className:"flex gap-4 items-end mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:s,onChange:c=>r(c.target.value),className:"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:l,onChange:c=>o(c.target.value),className:"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 rounded px-3 py-2 text-sm"})]}),e.jsx("button",{onClick:f,disabled:x,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:x?"Processing...":"Preview Calculation"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-zinc-700 dark:text-zinc-300",children:"Total Calculation"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",(a.reduce((c,n)=>c+n.amount,0)/100).toFixed(2)]})]}),e.jsx("div",{className:"space-y-2",children:a.map(c=>e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded p-4 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-zinc-900 dark:text-zinc-100",children:["Instructor ID: ",c.instructorId.substring(0,8),"..."]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[c.itemCount," items calculated"]}),e.jsx("ul",{className:"mt-2 text-xs text-zinc-500 space-y-1",children:c.items.map((n,h)=>e.jsxs("li",{children:["â€¢ ",n.title," (",new Date(n.date).toLocaleDateString(),"): ",n.details," = ",e.jsxs("strong",{children:["$",(n.amount/100).toFixed(2)]})]},h))})]}),e.jsxs("div",{className:"text-lg font-bold",children:["$",(c.amount/100).toFixed(2)]})]},c.instructorId))}),a.length===0&&e.jsx("div",{className:"text-zinc-500 text-sm",children:"No payouts calculated for this period. check configurations or activity."}),a.length>0&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:p,disabled:x,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow font-medium",children:"Generate & Save"})})]})]})}function J({token:t}){const[s,r]=i.useState([]),l=async()=>{const a=await m("/payroll/history",t);r(a.history)};i.useEffect(()=>{l()},[]);const o=async a=>{confirm("Mark this as paid manually?")&&(await m(`/payroll/${a}/approve`,t,{method:"POST"}),l())};return e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Period"}),e.jsx("th",{className:"p-4",children:"Instructor"}),e.jsx("th",{className:"p-4",children:"Amount"}),e.jsx("th",{className:"p-4",children:"Status"}),e.jsx("th",{className:"p-4",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:[s.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{className:"p-4",children:[new Date(a.periodStart).toLocaleDateString()," - ",new Date(a.periodEnd).toLocaleDateString()]}),e.jsxs("td",{className:"p-4 font-medium",children:[a.instructorFirstName," ",a.instructorLastName]}),e.jsxs("td",{className:"p-4 font-mono font-medium",children:["$",(a.amount/100).toFixed(2)]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.status==="paid"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:a.status.toUpperCase()})}),e.jsxs("td",{className:"p-4",children:[a.status!=="paid"&&e.jsx("button",{onClick:()=>o(a.id),className:"text-blue-600 hover:text-blue-500 text-xs font-medium border border-blue-200 rounded px-2 py-1",children:"Mark Paid"}),a.status==="paid"&&a.paidAt&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["Paid ",new Date(a.paidAt).toLocaleDateString()]})]})]},a.id)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-zinc-500",children:"No history found."})})]})]})})}function _({token:t}){const[s,r]=i.useState([]),[l,o]=i.useState(null),[a,u]=i.useState("flat"),[x,d]=i.useState("0"),f=async()=>{const n=await m("/payroll/config",t);r(n.instructors)};i.useEffect(()=>{f()},[]);const p=async()=>{if(!l)return;let n=parseFloat(x);n=Math.round(n*100),await m("/payroll/config",t,{method:"POST",body:JSON.stringify({memberId:l,payModel:a,rate:n})}),o(null),f()},c=n=>{o(n.memberId),n.config?.payModel?(u(n.config.payModel),d((n.config.rate/100).toString())):(u("flat"),d("0"))};return e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-800 text-zinc-500 font-medium border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Name"}),e.jsx("th",{className:"p-4",children:"Current Model"}),e.jsx("th",{className:"p-4",children:"Rate"}),e.jsx("th",{className:"p-4",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:s.map(n=>e.jsxs("tr",{children:[e.jsxs("td",{className:"p-4 font-medium",children:[n.firstName," ",n.lastName]}),e.jsx("td",{className:"p-4 text-zinc-600 dark:text-zinc-400 capitalize",children:n.config?n.config.payModel:"Not Set"}),e.jsx("td",{className:"p-4 font-mono",children:n.config?n.config.payModel==="percentage"?`${n.config.rate/100}%`:`$${(n.config.rate/100).toFixed(2)}`:"-"}),e.jsx("td",{className:"p-4",children:e.jsxs(I,{children:[e.jsx(O,{asChild:!0,children:e.jsx("button",{onClick:()=>c(n),className:"text-blue-600 hover:text-blue-500 font-medium",children:"Configure"})}),e.jsxs(R,{children:[e.jsxs(A,{children:[e.jsx(E,{children:"Configure Payroll"}),e.jsxs(L,{children:["Set default pay rate for ",n.firstName,"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Pay Model"}),e.jsxs("select",{className:"w-full rounded border border-zinc-300 p-2",value:a,onChange:h=>u(h.target.value),children:[e.jsx("option",{value:"flat",children:"Flat Rate (Per Class)"}),e.jsx("option",{value:"hourly",children:"Hourly Rate"}),e.jsx("option",{value:"percentage",children:"Revenue Share (%)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:a==="percentage"?"Percentage (%)":"Rate ($)"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full rounded border border-zinc-300 p-2",value:x,onChange:h=>d(h.target.value)})]}),e.jsx("button",{onClick:p,className:"w-full bg-blue-600 text-white rounded py-2 font-medium",children:"Save Configuration"})]})]})]})})]},n.memberId))})]})})}export{ee as default};
