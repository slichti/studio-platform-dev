import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as s}from"./chunk-JMJ3UQ3L-OilvkdUQ.js";import{X as J}from"./x-iEfBqcMQ.js";import{M as K}from"./message-circle-DPLUTtBn.js";import{S as V}from"./send-BS3f6L2P.js";function G({roomId:u,tenantId:m,userId:l,userName:p,apiUrl:b="",enabled:E=!0}){const[n,I]=s.useState(!1),[h,g]=s.useState([]),[d,w]=s.useState(""),[c,j]=s.useState(!1),[A,x]=s.useState([]),o=s.useRef(null),y=s.useRef(null),v=s.useRef(n);s.useEffect(()=>{v.current=n},[n]);const[W]=s.useState(()=>`guest_${Math.random().toString(36).substr(2,9)}`),N=l||W,$=p||"Guest",C=s.useCallback(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[]);s.useEffect(()=>{C()},[h,C]),s.useEffect(()=>{if(c)return;const t=b||(typeof window<"u"?window.location.origin:""),U=t.startsWith("https")?"wss://":"ws://",B=t.replace(/^http(s)?:\/\//,""),M=`${U}${B}/api/chat/rooms/${u}/websocket?roomId=${u}&tenantId=${m}&userId=${N}&userName=${encodeURIComponent($)}`,i=new WebSocket(M);return o.current=i,i.onopen=()=>{j(!0),console.log("[Chat] Connected")},i.onmessage=f=>{try{const r=JSON.parse(f.data);switch(r.type){case"history":g(r.messages||[]);break;case"message":g(a=>[...a,r]),!v.current&&r.userId!==N&&k(a=>a+1);break;case"user_list":x(r.users||[]);break;case"user_joined":x(a=>[...a,{userId:r.userId,userName:r.userName}]);break;case"user_left":x(a=>a.filter(_=>_.userId!==r.userId));break}}catch(r){console.error("[Chat] Parse error:",r)}},i.onclose=()=>{j(!1),console.log("[Chat] Disconnected")},i.onerror=f=>{console.error("[Chat] Error:",f)},()=>{i.close(),o.current=null}},[u,m,l,p,b]);const z=()=>{!d.trim()||!o.current||o.current.readyState!==WebSocket.OPEN||(o.current.send(JSON.stringify({type:"message",content:d.trim()})),w(""))},O=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),z())},[S,k]=s.useState(0),R=["Track my order","What are your shipping details?","What is your shipping time?","What is your contact info?"],P=t=>{!o.current||o.current.readyState!==WebSocket.OPEN||o.current.send(JSON.stringify({type:"message",content:t}))};return E?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{I(!n),n||k(0)},className:"fixed bottom-6 right-6 w-14 h-14 bg-[#2563EB] text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",children:[n?e.jsx(J,{size:24}):e.jsx(K,{size:24}),S>0&&!n&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white",children:S})]}),n&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans",children:[e.jsxs("div",{className:"bg-[#2563EB] text-white px-6 py-6 pb-12 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Chat with us"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:"ðŸ‘‹ Hi, message us with any questions. We're happy to help!"})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex flex-col",children:e.jsxs("div",{className:"mt-auto p-4 space-y-4",children:[h.map(t=>e.jsx("div",{className:`flex ${t.userId===l?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl text-sm ${t.userId===l?"bg-[#2563EB] text-white rounded-br-sm":"bg-gray-100 text-zinc-900 rounded-bl-sm"}`,children:e.jsx("p",{children:t.content})})},t.id)),h.length===0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide",children:"Instant answers"}),R.map(t=>e.jsx("button",{onClick:()=>P(t),disabled:!c,className:"w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",children:t},t))]}),e.jsx("div",{ref:y})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-100 bg-white",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:d,onChange:t=>w(t.target.value),onKeyPress:O,placeholder:"Write message",className:"w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",disabled:!c}),e.jsx("button",{onClick:z,disabled:!c||!d.trim(),className:"absolute right-2 p-2 text-zinc-400 hover:text-[#2563EB] transition-colors disabled:opacity-50",children:e.jsx(V,{size:20})})]}),!c&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-[10px] text-zinc-400",children:"Connecting to support..."})})]})]})]}):null}export{G as C};
