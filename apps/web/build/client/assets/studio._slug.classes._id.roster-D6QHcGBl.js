import{w as k,u as C,g as A,j as T,L as D}from"./chunk-JMJ3UQ3L-Dw7tS_gO.js";import{j as e}from"./vendor-puck-By1A5E5K.js";import{a as v}from"./api-OnQO3erh.js";import{a as n}from"./vendor-sentry-BD1MTpLq.js";import{C as w}from"./ConfirmDialog-e7gRNi7r.js";import{U as I}from"./user-plus-wgpaf6QU.js";import{c as L}from"./createLucideIcon-DgXJrNmH.js";import{F as P}from"./file-text-CIWEYZv3.js";import{T as _}from"./triangle-alert-CAr0UhK4.js";import{C as $}from"./check-yXSU0QnA.js";import{X as S}from"./x-6mvJS0UK.js";import{T as B}from"./trash-2-DU-4PZMS.js";import"./dialog-C8yECxTw.js";import"./dialog-DkyizW2j.js";import"./portal-DJvkvMc5.js";import"./vendor-charts-nrSmOgTy.js";import"./button-BgyeBcg8.js";const O=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],z=L("sticky-note",O);function F({method:i}){switch(i){case"subscription":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Membership"});case"credit":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"Credit"});case"drop_in":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:"Pay Later"});case"free":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Free"});default:return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 text-zinc-500",children:"Unknown"})}}const ne=k(function(){const{bookings:u}=C(),{slug:f,id:b}=A(),r=T(),c=u.filter(t=>t.status==="confirmed"),h=u.filter(t=>t.status==="waitlisted"),[d,p]=n.useState(null),[j,o]=n.useState(!1),[g,x]=n.useState(!1),[a,l]=n.useState(null),y=()=>{a&&(r.submit({intent:"cancel_booking",bookingId:a},{method:"post"}),l(null))},N=u.find(t=>t.memberId===d);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{to:`/studio/${f}/schedule`,className:"text-zinc-500 hover:text-zinc-800 font-medium text-sm flex items-center gap-1",children:"â† Back to Schedule"}),e.jsx("div",{className:"h-6 w-px bg-zinc-300"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Class Roster"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-zinc-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-zinc-800 transition-colors",children:[e.jsx(I,{size:16}),"Add Student"]})]}),e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm mb-8",children:[e.jsx("div",{className:"px-6 py-4 border-b border-zinc-200 bg-zinc-50",children:e.jsxs("h3",{className:"font-semibold text-zinc-900",children:["Attending (",c.length,")"]})}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Waiver"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Attendance"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[c.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",children:t.user.profile?.firstName?.[0]||t.user.email[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"}),e.jsx("div",{className:"text-xs text-zinc-500",children:t.user.email})]}),e.jsx("button",{onClick:()=>{p(t.memberId),o(!0)},className:`ml-2 p-1.5 rounded-full transition-colors ${t.hasNotes?"bg-amber-100 text-amber-600 hover:bg-amber-200":"text-zinc-400 hover:bg-zinc-100 hover:text-zinc-600"}`,title:t.hasNotes?"View Notes":"Add Note",children:e.jsx(z,{size:14,className:t.hasNotes?"fill-current":""})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(F,{method:t.paymentMethod})}),e.jsx("td",{className:"px-6 py-4",children:t.waiverSigned?e.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[e.jsx(P,{size:14}),"Signed"]}):e.jsxs("div",{className:"flex items-center gap-1 text-amber-600 text-xs font-bold animate-pulse",children:[e.jsx(_,{size:14}),"Needs Signature"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:"Confirmed"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(r.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsx("input",{type:"hidden",name:"intent",value:"check_in"}),t.checkedInAt?e.jsxs("button",{name:"checkedIn",value:"false",className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200",children:[e.jsx($,{size:12}),"Checked In"]}):e.jsx("button",{name:"checkedIn",value:"true",className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-zinc-100 text-zinc-500 hover:bg-zinc-200",children:"Mark Present"})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("button",{type:"button",onClick:()=>l(t.id),className:"text-red-600 hover:text-red-800 text-xs font-medium inline-flex items-center gap-1",children:[e.jsx(S,{size:12}),"Cancel"]})})]},t.id)),c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-zinc-500",children:"No attending students."})})]})]})]}),h.length>0&&e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-200 bg-amber-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold text-amber-900",children:["Waitlist (",h.length,")"]}),e.jsx("span",{className:"text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full",children:"Sorted by join order"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Joined At"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:h.map((t,s)=>e.jsxs("tr",{className:"hover:bg-zinc-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",children:s+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"}),e.jsxs("button",{onClick:()=>{p(t.memberId),o(!0)},className:`mt-1 text-xs flex items-center gap-1 ${t.hasNotes?"text-amber-600 font-medium":"text-zinc-400 hover:text-zinc-600"}`,children:[e.jsx(z,{size:12,className:t.hasNotes?"fill-current":""}),t.hasNotes?"Has Notes":"Add Note"]})]})]})}),e.jsx("td",{className:"px-6 py-4 text-zinc-400 text-sm",children:new Date(t.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs(r.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsx("input",{type:"hidden",name:"intent",value:"promote"}),e.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 rounded bg-green-600 text-white text-xs font-medium hover:bg-green-700",children:"Promote"})]}),e.jsx("button",{type:"button",onClick:()=>l(t.id),className:"text-red-600 hover:text-red-800 text-xs font-medium",children:"Remove"})]})})]},t.id))})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{className:"px-4 py-2 border border-zinc-300 rounded-md text-sm font-medium text-zinc-700 hover:bg-zinc-50",onClick:()=>window.print(),children:"Print Roster"})}),j&&d&&e.jsx(E,{memberId:d,studentName:N?.user.profile?.fullName||N?.user.email||"Student",onClose:()=>o(!1),slug:f}),e.jsx(w,{open:!!a,onOpenChange:t=>!t&&l(null),onConfirm:y,title:"Cancel Booking",description:"Are you sure you want to cancel this booking? The student will be removed from the roster.",confirmText:"Cancel Booking",variant:"destructive"})]})});function E({memberId:i,studentName:u,onClose:f,slug:b}){const[r,c]=n.useState([]),[h,d]=n.useState(!0),[p,j]=n.useState(""),[o,g]=n.useState(!1),[x,a]=n.useState(null);n.useEffect(()=>{l()},[i]);const l=async()=>{d(!0);try{const s=await window.Clerk?.session?.getToken(),m=await v(`/members/${i}/notes`,s,{headers:{"X-Tenant-Slug":b}});c(m.notes||[])}catch(s){console.error(s)}finally{d(!1)}},y=async s=>{s.preventDefault(),g(!0);try{const m=await window.Clerk?.session?.getToken();await v(`/members/${i}/notes`,m,{method:"POST",headers:{"X-Tenant-Slug":b},body:JSON.stringify({note:p})}),j(""),l()}catch{alert("Failed to add note")}finally{g(!1)}},N=s=>{a(s)},t=async()=>{if(x)try{const s=await window.Clerk?.session?.getToken();await v(`/members/${i}/notes/${x}`,s,{method:"DELETE",headers:{"X-Tenant-Slug":b}}),c(r.filter(m=>m.id!==x)),a(null)}catch{}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-zinc-200",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Notes: ",u]}),e.jsx("button",{onClick:f,children:e.jsx(S,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:h?e.jsx("div",{className:"text-center py-4 text-zinc-400",children:"Loading notes..."}):r.length===0?e.jsx("div",{className:"text-center py-8 text-zinc-400 italic bg-zinc-50 rounded-lg",children:"No notes yet."}):r.map(s=>e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm relative group",children:[e.jsx("p",{className:"text-zinc-800 whitespace-pre-wrap",children:s.note}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500 flex justify-between items-center",children:[e.jsxs("span",{children:[new Date(s.createdAt).toLocaleDateString()," by ",s.author?.user?.profile?.firstName||"Staff"]}),e.jsx("button",{onClick:()=>N(s.id),className:"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(B,{size:12})})]})]},s.id))}),e.jsx("div",{className:"p-4 border-t border-zinc-200 bg-zinc-50",children:e.jsxs("form",{onSubmit:y,children:[e.jsx("textarea",{value:p,onChange:s=>j(s.target.value),placeholder:"Add a medical note, injury, or preference...",className:"w-full text-sm border-zinc-300 rounded-md mb-2 focus:ring-blue-500 min-h-[80px]",required:!0}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:o,className:"bg-zinc-900 text-white px-4 py-2 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:o?"Adding...":"Add Note"})})]})})]}),e.jsx(w,{open:!!x,onOpenChange:s=>!s&&a(null),onConfirm:t,title:"Delete Note",description:"Are you sure you want to delete this note?",confirmText:"Delete",variant:"destructive"})]})}export{ne as default};
