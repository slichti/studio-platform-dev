import{w as q,g as X,f as _}from"./chunk-JMJ3UQ3L-Dw7tS_gO.js";import{j as e}from"./vendor-puck-By1A5E5K.js";import{a}from"./vendor-sentry-BD1MTpLq.js";import{a as c}from"./api-OnQO3erh.js";import{C as x,a as h,b as u,d as p,c as b}from"./Card-PoMvMiO2.js";import{B as j}from"./button-BgyeBcg8.js";import{L as g,I as f}from"./label-D7RQKMOi.js";import{t as r}from"./index-C_1Jy3MY.js";import{C as J}from"./Dialogs-LpmU1ed2.js";import{C as U}from"./circle-alert-Day-jl1l.js";import{T as $}from"./terminal-B-Ek4Gh_.js";import{L as W}from"./loader-circle-CaGZsKjo.js";import{c as B}from"./createLucideIcon-DgXJrNmH.js";import{C as A}from"./check-yXSU0QnA.js";import{C as D}from"./copy-ATUPUJUF.js";import{T as K}from"./trash-2-DU-4PZMS.js";import{P as H}from"./plus-BBRn-p3b.js";import{S as M}from"./shield-check-slWAEzyf.js";import"./Modal-D5keykku.js";const G=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Q=B("key",G),je=q(function(){const{slug:n}=X(),{tenant:k,features:P}=_()||{},[l,y]=a.useState([]),[L,N]=a.useState(!0),[v,w]=a.useState(!1),[o,C]=a.useState(""),[z,O]=a.useState("student.created, payment.succeeded"),[i,d]=a.useState(null),[S,T]=a.useState(null),m=P.has("webhooks");a.useEffect(()=>{m&&E()},[n,m]);const E=async()=>{N(!0);try{const s=window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token"),t=await c("/integrations/webhooks",s,{headers:{"X-Tenant-Slug":n||""}});y(t.endpoints||[])}catch(s){console.error("Failed to load webhooks",s),s.message?.includes("403")}finally{N(!1)}},R=async()=>{if(o){w(!0);try{const s=await window.Clerk?.session?.getToken();await c("/integrations/webhooks",s,{method:"POST",headers:{"X-Tenant-Slug":n||""},body:JSON.stringify({url:o,events:z.split(",").map(t=>t.trim()),description:"Developer API Endpoint"})}),C(""),r.success("Webhook created successfully"),E()}catch(s){r.error("Failed to create: "+s.message)}finally{w(!1)}}},F=async()=>{if(i)try{const s=await window.Clerk?.session?.getToken();await c(`/integrations/webhooks/${i}`,s,{method:"DELETE",headers:{"X-Tenant-Slug":n||""}}),y(l.filter(t=>t.id!==i)),r.success("Webhook deleted")}catch(s){r.error("Failed to delete: "+s.message)}finally{d(null)}},I=(s,t)=>{navigator.clipboard.writeText(s),T(t),setTimeout(()=>T(null),2e3),r.success("Copied to clipboard")};return m?e.jsxs("div",{className:"max-w-5xl pb-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",children:[e.jsx($,{className:"h-6 w-6 text-blue-600"})," Developer Settings"]}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage API access, outgoing webhooks, and developer tools."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Outgoing Webhooks"}),e.jsx(p,{children:"Subscription endpoints that receive JSON payloads when events occur."})]}),e.jsxs(b,{className:"space-y-6",children:[L?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(W,{className:"h-6 w-6 animate-spin text-zinc-400"})}):e.jsx("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 dark:text-zinc-400 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Endpoint"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Events"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:[l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-8 text-center text-zinc-500",children:"No webhooks configured."})}),l.map(s=>e.jsxs("tr",{className:"hover:bg-zinc-50 dark:hover:bg-zinc-900/40 transition-colors",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-mono text-blue-600 dark:text-blue-400",children:s.url}),e.jsxs("div",{className:"text-[10px] text-zinc-400 mt-1 flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"})," Secret: ",s.secret,e.jsx("button",{onClick:()=>I(s.secret,`sec-${s.id}`),className:"hover:text-zinc-700 dark:hover:text-zinc-200",children:S===`sec-${s.id}`?e.jsx(A,{className:"h-3 w-3 text-green-500"}):e.jsx(D,{className:"h-3 w-3"})})]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(Array.isArray(s.events)?s.events:s.events.split(",")).map(t=>e.jsx("span",{className:"bg-zinc-100 dark:bg-zinc-800 px-1.5 py-0.5 rounded text-[10px] font-medium text-zinc-600 dark:text-zinc-400",children:t},t))})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("button",{className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-950/30 text-red-500 rounded transition-colors",onClick:()=>d(s.id),children:e.jsx(K,{className:"h-4 w-4"})})})]},s.id))]})]})}),e.jsxs("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Add Endpoint"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(g,{children:"Target URL"}),e.jsx(f,{placeholder:"https://api.myapp.com/webhooks",value:o,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(g,{children:"Events (comma separated)"}),e.jsx(f,{value:z,onChange:s=>O(s.target.value)}),e.jsx("p",{className:"text-[10px] text-zinc-400",children:"Available: student.created, payment.succeeded, *"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(j,{onClick:R,disabled:!o||v,className:"gap-2",children:[v?e.jsx(W,{className:"h-4 w-4 animate-spin"}):e.jsx(H,{className:"h-4 w-4"}),"Register Webhook"]})})]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"API Access"}),e.jsx(p,{children:"Identify your requests and authenticate with the Studio API."})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"text-xs font-semibold uppercase tracking-wider text-zinc-400",children:"Studio ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{readOnly:!0,value:k.id,className:"font-mono bg-zinc-50 dark:bg-zinc-900"}),e.jsx(j,{variant:"outline",size:"icon",onClick:()=>I(k.id,"tenantId"),children:S==="tenantId"?e.jsx(A,{className:"h-4 w-4 text-green-500"}):e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/50 rounded-lg p-4 flex gap-3",children:[e.jsx(M,{className:"h-5 w-5 text-blue-600 shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Authenticated Requests"}),e.jsxs("p",{children:["Requests from your own application must include your generated Webhook Secret or a valid Studio JWT in the ",e.jsx("code",{children:"Authorization"})," or ",e.jsx("code",{children:"X-Studio-Signature"})," header."]})]})]})]})]})]}),e.jsx(J,{isOpen:!!i,onClose:()=>d(null),onConfirm:F,title:"Delete Webhook Endpoint",message:"Are you sure you want to stop sending events to this URL? This action cannot be undone.",isDestructive:!0,confirmText:"Delete Endpoint"})]}):e.jsx("div",{className:"max-w-4xl mx-auto py-12",children:e.jsxs(x,{className:"border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-900/50",children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2 text-amber-800 dark:text-amber-400",children:[e.jsx(U,{className:"h-5 w-5"})," Webhooks Feature Disabled"]}),e.jsx(p,{className:"text-amber-700 dark:text-amber-500",children:"Developer webhooks are not enabled for this studio."})]}),e.jsxs(b,{children:[e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-500 mb-6",children:"Webhooks allow your developers to receive real-time notifications about events in your studio. To use this feature, you must enable it in your studio features or upgrade your plan."}),e.jsx(j,{onClick:async()=>{try{const s=await window.Clerk?.session?.getToken();await c("/tenant/features",s,{method:"POST",headers:{"X-Tenant-Slug":n||""},body:JSON.stringify({featureKey:"webhooks",enabled:!0})}),window.location.reload()}catch(s){r.error(s.message||"Failed to enable feature")}},children:"Enable Webhooks"})]})]})})});export{je as default};
