import{w as y,d as C,e as w}from"./chunk-JMJ3UQ3L-BFmd18Yu.js";import{j as e}from"./vendor-puck-DM_I7lvc.js";import{a as h}from"./vendor-livekit-D3VpklN2.js";import{a as N}from"./api-D1U4i9fn.js";import{C as z,a as k,b as R,c as S,d as T}from"./Card-QUH53lJ-.js";import{S as D}from"./save-BvwiY0_u.js";import{P as O}from"./plus-Cj1r96us.js";import{C as I}from"./chevron-right-BZjixtOz.js";import{T as P}from"./trash-2-BHPWr9eo.js";import{c as A}from"./createLucideIcon-CcD9UNCP.js";const E=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],M=A("corner-down-right",E),X=y(function(){const{slug:b}=C(),{tenant:c}=w()||{},[i,d]=h.useState(c?.settings?.chatConfig||[{id:crypto.randomUUID(),label:"I have a question about classes",type:"action",actionType:"message",routeToRole:"instructor",autoReply:"An instructor will get back to you shortly."},{id:crypto.randomUUID(),label:"Billing Issue",type:"action",actionType:"message",routeToRole:"admin",autoReply:"We are checking your billing details."}]),[p,m]=h.useState(!1),f=async()=>{m(!0);try{const t=await window.Clerk?.session?.getToken();await N(`/studios/${c.id}/integrations`,t,{method:"PUT",headers:{"X-Tenant-Slug":b||""},body:JSON.stringify({chatEnabled:c.settings?.chatEnabled,chatConfig:i})}),alert("Chat configuration saved!"),window.location.reload()}catch(t){alert(t.message||"Failed to save")}finally{m(!1)}},x=({node:t,index:r,parentPath:a,onUpdate:n,onDelete:j})=>{const[u,v]=h.useState(!0);return e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-lg bg-white dark:bg-zinc-900 overflow-hidden mb-2",children:[e.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-zinc-800/50 flex items-center gap-2 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsx("button",{onClick:()=>v(!u),className:"p-1 hover:bg-zinc-200 rounded",children:e.jsx(I,{size:14,className:`transition-transform ${u?"rotate-90":""}`})}),e.jsx("input",{value:t.label,onChange:s=>n({...t,label:s.target.value}),className:"bg-transparent font-medium text-sm focus:outline-none flex-1",placeholder:"Option Label"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("select",{value:t.type,onChange:s=>n({...t,type:s.target.value,children:s.target.value==="menu"?[]:void 0}),className:"text-xs border rounded px-1 py-0.5",children:[e.jsx("option",{value:"action",children:"Action"}),e.jsx("option",{value:"menu",children:"Sub-Menu"})]}),e.jsx("button",{onClick:j,className:"text-red-500 p-1 hover:bg-red-50 rounded",children:e.jsx(P,{size:14})})]})]}),u&&e.jsx("div",{className:"p-3 space-y-3",children:t.type==="action"?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 block mb-1",children:"Route To Role"}),e.jsxs("select",{value:t.routeToRole||"support",onChange:s=>n({...t,routeToRole:s.target.value}),className:"w-full text-sm border rounded px-2 py-1.5",children:[e.jsx("option",{value:"support",children:"General Support"}),e.jsx("option",{value:"instructor",children:"Instructor"}),e.jsx("option",{value:"admin",children:"Admin / Billing"}),e.jsx("option",{value:"owner",children:"Owner"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 block mb-1",children:"Auto-Reply Message"}),e.jsx("input",{value:t.autoReply||"",onChange:s=>n({...t,autoReply:s.target.value}),className:"w-full text-sm border rounded px-2 py-1.5",placeholder:"Optional auto-reply..."})]})]}):e.jsxs("div",{className:"pl-4 border-l-2 border-zinc-100",children:[t.children?.map((s,o)=>e.jsx(x,{node:s,index:o,parentPath:[...a,o],onUpdate:l=>{const g=[...t.children||[]];g[o]=l,n({...t,children:g})},onDelete:()=>{const l=[...t.children||[]];l.splice(o,1),n({...t,children:l})}},s.id)),e.jsxs("button",{onClick:()=>{const s={id:crypto.randomUUID(),label:"New Option",type:"action"};n({...t,children:[...t.children||[],s]})},className:"flex items-center gap-1 text-xs text-blue-600 font-medium mt-2 hover:underline",children:[e.jsx(M,{size:12})," Add Sub-Option"]})]})})]})};return e.jsxs("div",{className:"max-w-4xl pb-20",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Chat Configuration"}),e.jsx("p",{className:"text-zinc-500",children:"Design the decision tree for your support chat."})]}),e.jsx("button",{onClick:f,disabled:p,className:"flex items-center gap-2 bg-zinc-900 text-white px-4 py-2 rounded-lg hover:bg-zinc-800 disabled:opacity-50",children:p?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(D,{size:16})," Save Config"]})})]}),e.jsx("div",{className:"grid gap-6",children:e.jsxs(z,{children:[e.jsxs(k,{children:[e.jsx(R,{children:"Main Menu"}),e.jsx(S,{children:"These are the top-level options users will see when they open the chat."})]}),e.jsxs(T,{children:[i.map((t,r)=>e.jsx(x,{node:t,index:r,parentPath:[r],onUpdate:a=>{const n=[...i];n[r]=a,d(n)},onDelete:()=>{const a=[...i];a.splice(r,1),d(a)}},t.id)),e.jsxs("button",{onClick:()=>d([...i,{id:crypto.randomUUID(),label:"New Option",type:"action"}]),className:"w-full py-3 border-2 border-dashed border-zinc-200 rounded-lg text-zinc-500 hover:border-zinc-300 hover:text-zinc-700 font-medium text-sm flex items-center justify-center gap-2 mt-4",children:[e.jsx(O,{size:16})," Add Root Option"]})]})]})})]})});export{X as default};
