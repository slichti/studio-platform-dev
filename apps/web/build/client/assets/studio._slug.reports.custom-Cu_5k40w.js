import{w as Ne,e as De,d as Re,L as Le}from"./chunk-EPOLDU6W-BNyyBaiR.js";import{j as s}from"./vendor-puck-aUaaDwmz.js";import{a as o}from"./vendor-livekit-D3VpklN2.js";import{a as _}from"./api-D1U4i9fn.js";import{F as Ke}from"./funnel-BWeNJoV3.js";import{L as Me}from"./loader-circle-BQZLkmRD.js";import{T as Te}from"./trash-2-BHPWr9eo.js";import{S as Fe}from"./save-BvwiY0_u.js";import{bd as _e,aK as Q,ae as X,a$ as Z,b8 as We,l as le,ab as $e,q as N,Q as Ge,be as Ve,I as M,b3 as qe,b5 as D,au as L,b6 as R,av as K,az as xe,ax as he,bf as ge,bg as Qe,bh as Ue,b7 as ce,bi as Ye,bj as de,b9 as Xe,Y as $,aA as Ze,r as Je,V as ae,aB as be,T as He,aC as ea,aD as aa,Z as te,P as ye,_ as ta,aE as ra,aG as na,W as ia,e as G,D as ke,c as sa,aI as oa,bk as la,bl as ca,bm as ue,a6 as je,af as da,b as Ie,$ as ua,a0 as ma,a2 as z,ac as va,aL as pa,R as fa,a7 as xa,b1 as ha,a3 as me,aN as ga,ao as ba,ap as ya,aq as ka,ar as ja,as as Ia,at as Aa}from"./CartesianChart-BT5Lt7fl.js";import{S as Pa,L as Sa}from"./ErrorBarContext-3WiD5c6e.js";import{C as wa,u as Ae,a as Pe,b as Se}from"./tooltipContext-Dwmp2MMm.js";import{C as Ea}from"./chart-column-De5NC5nN.js";import"./createLucideIcon-CcD9UNCP.js";import"./string-0bvjYUJm.js";import"./with-selector-BB0my2KF.js";import"./with-selector-BEill6Gq.js";import"./index-7UaQKl4K.js";import"./band-CquvqAHh.js";import"./init-Dmth1JHB.js";import"./ordinal-DILIJJjt.js";import"./linear-B73P1QuO.js";import"./defaultLocale-C4B-KCzX.js";import"./time-BOCF2igb.js";var ve=(e,a,t)=>{var r=t??e;if(!Q(r))return X(r,a,0)},Oa=(e,a,t)=>{var r={},i=e.filter(_e),n=e.filter(c=>c.stackId==null),l=i.reduce((c,m)=>(c[m.stackId]||(c[m.stackId]=[]),c[m.stackId].push(m),c),r),u=Object.entries(l).map(c=>{var[m,f]=c,b=f.map(k=>k.dataKey),y=ve(a,t,f[0].barSize);return{stackId:m,dataKeys:b,barSize:y}}),h=n.map(c=>{var m=[c.dataKey].filter(b=>b!=null),f=ve(a,t,c.barSize);return{stackId:void 0,dataKeys:m,barSize:f}});return[...u,...h]};function pe(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function W(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?pe(Object(t),!0).forEach(function(r){Ba(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Ba(e,a,t){return(a=Ca(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Ca(e){var a=za(e,"string");return typeof a=="symbol"?a:a+""}function za(e,a){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function Na(e,a,t,r,i){var n=r.length;if(!(n<1)){var l=X(e,t,0,!0),u,h=[];if(Z(r[0].barSize)){var c=!1,m=t/n,f=r.reduce((p,g)=>p+(g.barSize||0),0);f+=(n-1)*l,f>=t&&(f-=(n-1)*l,l=0),f>=t&&m>0&&(c=!0,m*=.9,f=n*m);var b=(t-f)/2>>0,y={offset:b-l,size:0};u=r.reduce((p,g)=>{var P,j={stackId:g.stackId,dataKeys:g.dataKeys,position:{offset:y.offset+y.size+l,size:c?m:(P=g.barSize)!==null&&P!==void 0?P:0}},w=[...p,j];return y=w[w.length-1].position,w},h)}else{var k=X(a,t,0,!0);t-2*k-(n-1)*l<=0&&(l=0);var x=(t-2*k-(n-1)*l)/n;x>1&&(x>>=0);var A=Z(i)?Math.min(x,i):x;u=r.reduce((p,g,P)=>[...p,{stackId:g.stackId,dataKeys:g.dataKeys,position:{offset:k+(x+l)*P+(x-A)/2,size:A}}],h)}return u}}var Da=(e,a,t,r,i,n,l)=>{var u=Q(l)?a:l,h=Na(t,r,i!==n?i:n,e,u);return i!==n&&h!=null&&(h=h.map(c=>W(W({},c),{},{position:W(W({},c.position),{},{offset:c.position.offset-i/2})}))),h},Ra=(e,a)=>{var t=We(a);if(!(!e||t==null||a==null)){var{stackId:r}=a;if(r!=null){var i=e[r];if(i){var{stackedData:n}=i;if(n)return n.find(l=>l.key===t)}}}};function La(e,a){return e&&typeof e=="object"&&"zIndex"in e&&typeof e.zIndex=="number"&&Z(e.zIndex)?e.zIndex:a}var Ka="Invariant failed";function Ma(e,a){throw new Error(Ka)}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},J.apply(null,arguments)}function V(e){return o.createElement($e,J({shapeType:"rectangle",activeClassName:"recharts-active-bar"},e))}var Ta=function(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(r,i)=>{if(le(a))return a;var n=le(r)||Q(r);return n?a(r,i):(n||Ma(),t)}},Fa=(e,a,t)=>t,_a=(e,a)=>a,T=N([he,_a],(e,a)=>e.filter(t=>t.type==="bar").find(t=>t.id===a)),Wa=N([T],e=>e?.maxBarSize),$a=(e,a,t,r)=>r,Ga=N([M,he,D,R,Fa],(e,a,t,r,i)=>a.filter(n=>e==="horizontal"?n.xAxisId===t:n.yAxisId===r).filter(n=>n.isPanorama===i).filter(n=>n.hide===!1).filter(n=>n.type==="bar")),Va=(e,a,t)=>{var r=M(e),i=D(e,a),n=R(e,a);if(!(i==null||n==null))return r==="horizontal"?ce(e,"yAxis",n,t):ce(e,"xAxis",i,t)},qa=(e,a)=>{var t=M(e),r=D(e,a),i=R(e,a);if(!(r==null||i==null))return t==="horizontal"?de(e,"xAxis",r):de(e,"yAxis",i)},Qa=N([Ga,Ye,qa],Oa),Ua=(e,a,t)=>{var r,i,n=T(e,a);if(n!=null){var l=D(e,a),u=R(e,a);if(!(l==null||u==null)){var h=M(e),c=ge(e),{maxBarSize:m}=n,f=Q(m)?c:m,b,y;return h==="horizontal"?(b=L(e,"xAxis",l,t),y=K(e,"xAxis",l,t)):(b=L(e,"yAxis",u,t),y=K(e,"yAxis",u,t)),(r=(i=xe(b,y,!0))!==null&&i!==void 0?i:f)!==null&&r!==void 0?r:0}}},we=(e,a,t)=>{var r=M(e),i=D(e,a),n=R(e,a);if(!(i==null||n==null)){var l,u;return r==="horizontal"?(l=L(e,"xAxis",i,t),u=K(e,"xAxis",i,t)):(l=L(e,"yAxis",n,t),u=K(e,"yAxis",n,t)),xe(l,u)}},Ya=N([Qa,ge,Qe,Ue,Ua,we,Wa],Da),Xa=(e,a,t)=>{var r=D(e,a);if(r!=null)return L(e,"xAxis",r,t)},Za=(e,a,t)=>{var r=R(e,a);if(r!=null)return L(e,"yAxis",r,t)},Ja=(e,a,t)=>{var r=D(e,a);if(r!=null)return K(e,"xAxis",r,t)},Ha=(e,a,t)=>{var r=R(e,a);if(r!=null)return K(e,"yAxis",r,t)},et=N([Ya,T],(e,a)=>{if(!(e==null||a==null)){var t=e.find(r=>r.stackId===a.stackId&&a.dataKey!=null&&r.dataKeys.includes(a.dataKey));if(t!=null)return t.position}}),at=N([Va,T],Ra),tt=N([Ge,Ve,Xa,Za,Ja,Ha,et,M,qe,we,at,T,$a],(e,a,t,r,i,n,l,u,h,c,m,f,b)=>{var{chartData:y,dataStartIndex:k,dataEndIndex:x}=h;if(!(f==null||l==null||a==null||u!=="horizontal"&&u!=="vertical"||t==null||r==null||i==null||n==null||c==null)){var{data:A}=f,p;if(A!=null&&A.length>0?p=A:p=y?.slice(k,x+1),p!=null)return Ct({layout:u,barSettings:f,pos:l,parentViewBox:a,bandSize:c,xAxis:t,yAxis:r,xAxisTicks:i,yAxisTicks:n,stackedData:m,displayedData:p,offset:e,cells:b,dataStartIndex:k})}}),rt=["index"];function H(){return H=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},H.apply(null,arguments)}function nt(e,a){if(e==null)return{};var t,r,i=it(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function it(e,a){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(a.indexOf(r)!==-1)continue;t[r]=e[r]}return t}var Ee=o.createContext(void 0),st=e=>{var a=o.useContext(Ee);if(a!=null)return a.stackId;if(e!=null)return Xe(e)},ot=(e,a)=>"recharts-bar-stack-clip-path-".concat(e,"-").concat(a),lt=e=>{var a=o.useContext(Ee);if(a!=null){var{stackId:t}=a;return"url(#".concat(ot(t,e),")")}},ct=e=>{var{index:a}=e,t=nt(e,rt),r=lt(a);return o.createElement($,H({className:"recharts-bar-stack-layer",clipPath:r},t))},dt=["onMouseEnter","onMouseLeave","onClick"],ut=["value","background","tooltipPosition"],mt=["id"],vt=["onMouseEnter","onClick","onMouseLeave"];function B(){return B=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},B.apply(null,arguments)}function fe(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function E(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?fe(Object(t),!0).forEach(function(r){pt(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fe(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function pt(e,a,t){return(a=ft(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function ft(e){var a=xt(e,"string");return typeof a=="symbol"?a:a+""}function xt(e,a){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function q(e,a){if(e==null)return{};var t,r,i=ht(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function ht(e,a){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(a.indexOf(r)!==-1)continue;t[r]=e[r]}return t}var gt=e=>{var{dataKey:a,name:t,fill:r,legendType:i,hide:n}=e;return[{inactive:n,dataKey:a,type:i,color:r,value:ye(t,a),payload:e}]},bt=o.memo(e=>{var{dataKey:a,stroke:t,strokeWidth:r,fill:i,name:n,hide:l,unit:u,tooltipType:h,id:c}=e,m={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:t,strokeWidth:r,fill:i,dataKey:a,nameKey:void 0,name:ye(n,a),hide:l,type:h,color:i,unit:u,graphicalItemId:c}};return o.createElement(ta,{tooltipEntrySettings:m})});function yt(e){var a=G(je),{data:t,dataKey:r,background:i,allOtherBarProps:n}=e,{onMouseEnter:l,onMouseLeave:u,onClick:h}=n,c=q(n,dt),m=Ae(l,r,n.id),f=Pe(u),b=Se(h,r,n.id);if(!i||t==null)return null;var y=da(i);return o.createElement(te,{zIndex:La(i,ae.barBackground)},t.map((k,x)=>{var{value:A,background:p,tooltipPosition:g}=k,P=q(k,ut);if(!p)return null;var j=m(k,x),w=f(k,x),I=b(k,x),O=E(E(E(E(E({option:i,isActive:String(x)===a},P),{},{fill:"#eee"},p),y),Ie(c,k,x)),{},{onMouseEnter:j,onMouseLeave:w,onClick:I,dataKey:r,index:x,className:"recharts-bar-background-rectangle"});return o.createElement(V,B({key:"background-bar-".concat(x)},O))}))}function kt(e){var{showLabels:a,children:t,rects:r}=e,i=r?.map(n=>{var l={x:n.x,y:n.y,width:n.width,lowerWidth:n.width,upperWidth:n.width,height:n.height};return E(E({},l),{},{value:n.value,payload:n.payload,parentViewBox:n.parentViewBox,viewBox:l,fill:n.fill})});return o.createElement(pa,{value:a?i:void 0},t)}function jt(e){var{shape:a,activeBar:t,baseProps:r,entry:i,index:n,dataKey:l}=e,u=G(je),h=G(xa),c=t&&String(n)===u&&(h==null||l===h),m=c?t:a;return c?o.createElement(te,{zIndex:ae.activeBar},o.createElement(V,B({},r,{name:String(r.name)},i,{isActive:c,option:m,index:n,dataKey:l}))):o.createElement(V,B({},r,{name:String(r.name)},i,{isActive:c,option:m,index:n,dataKey:l}))}function It(e){var{shape:a,baseProps:t,entry:r,index:i,dataKey:n}=e;return o.createElement(V,B({},t,{name:String(t.name)},r,{isActive:!1,option:a,index:i,dataKey:n}))}function At(e){var a,{data:t,props:r}=e,i=(a=fa(r))!==null&&a!==void 0?a:{},{id:n}=i,l=q(i,mt),{shape:u,dataKey:h,activeBar:c}=r,{onMouseEnter:m,onClick:f,onMouseLeave:b}=r,y=q(r,vt),k=Ae(m,h,n),x=Pe(b),A=Se(f,h,n);return t?o.createElement(o.Fragment,null,t.map((p,g)=>o.createElement(ct,B({index:g,key:"rectangle-".concat(p?.x,"-").concat(p?.y,"-").concat(p?.value,"-").concat(g),className:"recharts-bar-rectangle"},Ie(y,p,g),{onMouseEnter:k(p,g),onMouseLeave:x(p,g),onClick:A(p,g)}),c?o.createElement(jt,{shape:u,activeBar:c,baseProps:l,entry:p,index:g,dataKey:h}):o.createElement(It,{shape:u,baseProps:l,entry:p,index:g,dataKey:h})))):null}function Pt(e){var{props:a,previousRectanglesRef:t}=e,{data:r,layout:i,isAnimationActive:n,animationBegin:l,animationDuration:u,animationEasing:h,onAnimationEnd:c,onAnimationStart:m}=a,f=t.current,b=ua(a,"recharts-bar-"),[y,k]=o.useState(!1),x=!y,A=o.useCallback(()=>{typeof c=="function"&&c(),k(!1)},[c]),p=o.useCallback(()=>{typeof m=="function"&&m(),k(!0)},[m]);return o.createElement(kt,{showLabels:x,rects:r},o.createElement(ma,{animationId:b,begin:l,duration:u,isActive:n,easing:h,onAnimationEnd:A,onAnimationStart:p,key:b},g=>{var P=g===1?r:r?.map((j,w)=>{var I=f&&f[w];if(I)return E(E({},j),{},{x:z(I.x,j.x,g),y:z(I.y,j.y,g),width:z(I.width,j.width,g),height:z(I.height,j.height,g)});if(i==="horizontal"){var O=z(0,j.height,g),d=z(j.stackedBarStart,j.y,g);return E(E({},j),{},{y:d,height:O})}var v=z(0,j.width,g),S=z(j.stackedBarStart,j.x,g);return E(E({},j),{},{width:v,x:S})});return g>0&&(t.current=P??null),P==null?null:o.createElement($,null,o.createElement(At,{props:a,data:P}))}),o.createElement(va,{label:a.label}),a.children)}function St(e){var a=o.useRef(null);return o.createElement(Pt,{previousRectanglesRef:a,props:e})}var Oe=0,wt=(e,a)=>{var t=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:t,errorVal:ke(e,a)}};class Et extends o.PureComponent{render(){var{hide:a,data:t,dataKey:r,className:i,xAxisId:n,yAxisId:l,needClip:u,background:h,id:c}=this.props;if(a||t==null)return null;var m=sa("recharts-bar",i),f=c;return o.createElement($,{className:m,id:c},u&&o.createElement("defs",null,o.createElement(oa,{clipPathId:f,xAxisId:n,yAxisId:l})),o.createElement($,{className:"recharts-bar-rectangles",clipPath:u?"url(#clipPath-".concat(f,")"):void 0},o.createElement(yt,{data:t,dataKey:r,background:h,allOtherBarProps:this.props}),o.createElement(St,this.props)))}}var Ot={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:Oe,xAxisId:0,yAxisId:0,zIndex:ae.bar};function Bt(e){var{xAxisId:a,yAxisId:t,hide:r,legendType:i,minPointSize:n,activeBar:l,animationBegin:u,animationDuration:h,animationEasing:c,isAnimationActive:m}=e,{needClip:f}=ra(a,t),b=na(),y=be(),k=ia(e.children,wa),x=G(g=>tt(g,e.id,y,k));if(b!=="vertical"&&b!=="horizontal")return null;var A,p=x?.[0];return p==null||p.height==null||p.width==null?A=0:A=b==="vertical"?p.height/2:p.width/2,o.createElement(Pa,{xAxisId:a,yAxisId:t,data:x,dataPointFormatter:wt,errorBarOffset:A},o.createElement(Et,B({},e,{layout:b,needClip:f,data:x,xAxisId:a,yAxisId:t,hide:r,legendType:i,minPointSize:n,activeBar:l,animationBegin:u,animationDuration:h,animationEasing:c,isAnimationActive:m})))}function Ct(e){var{layout:a,barSettings:{dataKey:t,minPointSize:r},pos:i,bandSize:n,xAxis:l,yAxis:u,xAxisTicks:h,yAxisTicks:c,stackedData:m,displayedData:f,offset:b,cells:y,parentViewBox:k,dataStartIndex:x}=e,A=a==="horizontal"?u:l,p=m?A.scale.domain():null,g=la({numericAxis:A}),P=A.scale(g);return f.map((j,w)=>{var I,O,d,v,S,U;if(m){var re=m[w+x];if(re==null)return null;I=ca(re,p)}else I=ke(j,t),Array.isArray(I)||(I=[g,I]);var C=Ta(r,Oe)(I[1],w);if(a==="horizontal"){var Y,[ne,F]=[u.scale(I[0]),u.scale(I[1])];O=ue({axis:l,ticks:h,bandSize:n,offset:i.offset,entry:j,index:w}),d=(Y=F??ne)!==null&&Y!==void 0?Y:void 0,v=i.size;var ie=ne-F;if(S=ha(ie)?0:ie,U={x:O,y:b.top,width:v,height:b.height},Math.abs(C)>0&&Math.abs(S)<Math.abs(C)){var se=me(S||C)*(Math.abs(C)-Math.abs(S));d-=se,S+=se}}else{var[oe,Be]=[l.scale(I[0]),l.scale(I[1])];if(O=oe,d=ue({axis:u,ticks:c,bandSize:n,offset:i.offset,entry:j,index:w}),v=Be-oe,S=i.size,U={x:b.left,y:d,width:b.width,height:S},Math.abs(C)>0&&Math.abs(v)<Math.abs(C)){var Ce=me(v||C)*(Math.abs(C)-Math.abs(v));v+=Ce}}if(O==null||d==null||v==null||S==null)return null;var ze=E(E({},j),{},{stackedBarStart:P,x:O,y:d,width:v,height:S,value:m?I:I[1],payload:j,background:U,tooltipPosition:{x:O+v/2,y:d+S/2},parentViewBox:k},y&&y[w]&&y[w].props);return ze}).filter(Boolean)}function zt(e){var a=Je(e,Ot),t=st(a.stackId),r=be();return o.createElement(He,{id:a.id,type:"bar"},i=>o.createElement(o.Fragment,null,o.createElement(ea,{legendPayload:gt(a)}),o.createElement(bt,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:i}),o.createElement(aa,{type:"bar",id:i,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:t,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:r}),o.createElement(te,{zIndex:a.zIndex},o.createElement(Bt,B({},a,{id:i})))))}var ee=o.memo(zt,Ze);ee.displayName="Bar";var Nt=["axis","item"],Dt=o.forwardRef((e,a)=>o.createElement(ga,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Nt,tooltipPayloadSearcher:ba,categoricalChartProps:e,ref:a}));const nr=Ne(function(){const{tenant:a}=De()||{},{slug:t}=Re(),[r,i]=o.useState([]),[n,l]=o.useState(!1),[u,h]=o.useState(["revenue"]),[c,m]=o.useState(["date"]),[f,b]=o.useState({start:"",end:""}),[y,k]=o.useState(""),[x,A]=o.useState(null),[p,g]=o.useState("");o.useEffect(()=>{P();const d=new Date,v=new Date;v.setDate(d.getDate()-30),b({start:v.toISOString().split("T")[0],end:d.toISOString().split("T")[0]})},[]);const P=async()=>{const d=await window.Clerk?.session?.getToken();try{const v=await _("/reports/custom",d);i(v.reports||[])}catch(v){console.error("Failed to load reports",v)}},j=async()=>{l(!0);const d=await window.Clerk?.session?.getToken();try{const v=await _("/reports/custom/query",d,{method:"POST",body:JSON.stringify({metrics:u,dimensions:c,filters:{startDate:f.start,endDate:f.end,instructorId:y||void 0}})});A(v)}catch(v){console.error(v),alert("Query failed")}finally{l(!1)}},w=async()=>{if(!p)return alert("Enter a name");const d=await window.Clerk?.session?.getToken();try{await _("/reports/custom",d,{method:"POST",body:JSON.stringify({name:p,config:{metrics:u,dimensions:c,filters:{startDate:f.start,endDate:f.end,instructorId:y}}})}),g(""),P()}catch(v){console.error(v)}},I=d=>{const v=d.config;v.metrics&&h(v.metrics),v.dimensions&&m(v.dimensions),v.filters&&(b({start:v.filters.startDate?new Date(v.filters.startDate).toISOString().split("T")[0]:"",end:v.filters.endDate?new Date(v.filters.endDate).toISOString().split("T")[0]:""}),k(v.filters.instructorId||""))},O=async(d,v)=>{if(v.stopPropagation(),!confirm("Delete report?"))return;const S=await window.Clerk?.session?.getToken();await _(`/reports/custom/${d}`,S,{method:"DELETE"}),P()};return s.jsxs("div",{className:"p-8 max-w-7xl mx-auto min-h-screen",children:[s.jsx("div",{className:"flex justify-between items-center mb-8",children:s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 mb-1",children:[s.jsx(Le,{to:`/studio/${t}/reports`,className:"hover:underline",children:"Analytics"}),s.jsx("span",{children:"/"}),s.jsx("span",{children:"Custom Query"})]}),s.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Custom Report Builder"})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[s.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[s.jsx(Ke,{size:16})," Query Options"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Metrics"}),s.jsx("div",{className:"space-y-2",children:["revenue","attendance"].map(d=>s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:u.includes(d),onChange:v=>{v.target.checked?h([...u,d]):h(u.filter(S=>S!==d))},className:"rounded border-zinc-300 text-brand-600 focus:ring-brand-500"}),s.jsx("span",{className:"capitalize",children:d})]},d))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Group By"}),s.jsx("div",{className:"space-y-2",children:["date","instructor"].map(d=>s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:c.includes(d),onChange:v=>{v.target.checked?m([...c,d]):m(c.filter(S=>S!==d))}}),s.jsx("span",{className:"capitalize",children:d})]},d))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-zinc-500 uppercase mb-2 block",children:"Date Range"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("input",{type:"date",value:f.start,onChange:d=>b({...f,start:d.target.value}),className:"w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"}),s.jsx("input",{type:"date",value:f.end,onChange:d=>b({...f,end:d.target.value}),className:"w-full text-xs p-2 rounded border dark:bg-zinc-800 dark:border-zinc-700"})]})]}),s.jsxs("button",{onClick:j,disabled:n,className:"w-full py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg font-medium hover:opacity-90 flex justify-center items-center gap-2",children:[n&&s.jsx(Me,{size:16,className:"animate-spin"}),"Run Query"]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[s.jsx("h3",{className:"font-semibold mb-4 text-sm",children:"Saved Reports"}),s.jsxs("div",{className:"space-y-2",children:[r.map(d=>s.jsxs("div",{onClick:()=>I(d),className:"p-3 bg-zinc-50 dark:bg-zinc-800 rounded-lg cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-700 group flex justify-between items-center",children:[s.jsx("span",{className:"text-sm font-medium",children:d.name}),s.jsx("button",{onClick:v=>O(d.id,v),className:"text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:s.jsx(Te,{size:12})})]},d.id)),r.length===0&&s.jsx("p",{className:"text-xs text-zinc-500",children:"No saved reports."})]})]})]}),s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:"font-semibold text-lg",children:"Results"}),x&&s.jsxs("div",{className:"flex gap-4 text-sm text-zinc-500",children:[x.summary.revenue!==void 0&&s.jsxs("span",{children:["Revenue: ",s.jsxs("b",{children:["$",x.summary.revenue.toFixed(2)]})]}),x.summary.attendance!==void 0&&s.jsxs("span",{children:["Attendance: ",s.jsx("b",{children:x.summary.attendance})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",placeholder:"Report Name",value:p,onChange:d=>g(d.target.value),className:"px-3 py-1.5 rounded border border-zinc-300 dark:border-zinc-700 bg-transparent text-sm"}),s.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 rounded text-sm font-medium",children:[s.jsx(Fe,{size:14})," Save"]})]})]}),s.jsx("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm min-h-[400px]",children:x&&x.chartData&&x.chartData.length>0?s.jsx(ya,{width:"100%",height:400,children:s.jsxs(Dt,{data:x.chartData,children:[s.jsx(ka,{strokeDasharray:"3 3",vertical:!1,stroke:"#E4E4E7"}),s.jsx(ja,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12},dy:10,tickFormatter:d=>d.length>10?new Date(d).toLocaleDateString():d}),s.jsx(Ia,{axisLine:!1,tickLine:!1,tick:{fill:"#71717A",fontSize:12}}),s.jsx(Aa,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),s.jsx(Sa,{}),u.includes("revenue")&&s.jsx(ee,{dataKey:"revenue",fill:"#3B82F6",name:"Revenue ($)",radius:[4,4,0,0]}),u.includes("attendance")&&s.jsx(ee,{dataKey:"attendance",fill:"#10B981",name:"Attendance",radius:[4,4,0,0]})]})}):s.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-400",children:[s.jsx(Ea,{size:48,className:"mb-4 opacity-50"}),s.jsx("p",{children:"Run a query to see results"})]})})]})]})]})});export{nr as default};
