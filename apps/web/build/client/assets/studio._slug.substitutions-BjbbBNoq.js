import{w as O,d as D,c as R,r as b}from"./chunk-JMJ3UQ3L-CWn0lNw-.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as p}from"./api-LAgipKeK.js";import{R as L}from"./refresh-cw-tg6vuv-p.js";import{C as X}from"./circle-alert-Dwu3jEan.js";import{C as k}from"./clock-Bhhqp7HI.js";import{C as w}from"./circle-check-big-B493ivsV.js";import{C as $}from"./circle-x-CBuCMfh5.js";import{u as E}from"./chunk-OT5FTIRN-DH5_AI9l.js";import"./createLucideIcon-C90dpDzR.js";import"./index-CUj0H0dm.js";import"./index-D3cHa8K1.js";const W=O(function(){const{substitutions:i,error:a}=D(),{tenant:l,me:u}=R()||{},{getToken:d}=E(),[n,s]=b.useState(i),[o,h]=b.useState(!1),[y,f]=b.useState(!1),[C,S]=b.useState([]),[x,j]=b.useState({classId:"",notes:""}),I=async()=>{f(!0);try{const t=await d(),r=await p(`/classes?startDate=${new Date().toISOString()}&instructorId=${u?.member?.id}`,t,{headers:{"X-Tenant-Slug":l.slug}});S(Array.isArray(r)?r:[])}catch(t){console.error(t)}},A=async t=>{t.preventDefault(),h(!0);try{const r=await d(),c=await p("/substitutions/request",r,{method:"POST",headers:{"X-Tenant-Slug":l.slug},body:JSON.stringify(x)});if(c.error)throw new Error(c.error);f(!1),j({classId:"",notes:""});const g=await p("/substitutions",r,{headers:{"X-Tenant-Slug":l.slug}});s(g.substitutions||[])}catch(r){alert(r.message)}finally{h(!1)}},q=u?.roles?.includes("owner"),z=async(t,r)=>{if(!o){h(!0);try{const c=await d(),g=await p(`/substitutions/${t}/${r}`,c,{method:"POST",headers:{"X-Tenant-Slug":l.slug}});if(g.error)throw new Error(g.error);const T=await p("/substitutions",c,{headers:{"X-Tenant-Slug":l.slug}});s(T.substitutions||[])}catch(c){alert(c.message)}finally{h(!1)}}};return e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",children:e.jsx(L,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Substitutions"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"Manage shift coverage and instructor changes."})]})]}),e.jsx("button",{onClick:I,className:"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 transition-colors shadow-lg shadow-zinc-500/10",children:"Request Cover"})]}),a&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg text-sm border border-red-200",children:a}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl max-w-md w-full p-6 shadow-2xl border border-zinc-200 dark:border-zinc-800",children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-4",children:"Request Coverage"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Select Class"}),e.jsxs("select",{className:"w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",value:x.classId,onChange:t=>j({...x,classId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Choose a Class --"}),C.map(t=>e.jsxs("option",{value:t.id,children:[new Date(t.startTime).toLocaleDateString()," ",new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",t.title]},t.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{className:"w-full border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 rounded-lg px-3 py-2 text-sm",rows:3,placeholder:"Reason for sub request...",value:x.notes,onChange:t=>j({...x,notes:t.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o||!x.classId,className:"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-zinc-800 disabled:opacity-50",children:o?"Submitting...":"Submit Request"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[e.jsx(v,{title:"Needs Coverage",icon:e.jsx(X,{className:"text-amber-500",size:18}),children:e.jsx(N,{items:n.filter(t=>t.status==="pending"),onAction:z,canClaim:!0,currentMemberId:u?.member?.id,loading:o})}),e.jsx(v,{title:"Awaiting Approval",icon:e.jsx(k,{className:"text-blue-500",size:18}),children:e.jsx(N,{items:n.filter(t=>t.status==="claimed"),onAction:z,canApprove:q,loading:o})}),e.jsx(v,{title:"Approved Changes",icon:e.jsx(w,{className:"text-green-500",size:18}),children:e.jsx(N,{items:n.filter(t=>t.status==="approved"),onAction:z,readOnly:!0,loading:o})})]})]})});function v({title:m,icon:i,children:a}){return e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i,e.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-200",children:m})]}),e.jsx("span",{className:"bg-zinc-200 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-widest",children:Array.isArray(a.props.items)?a.props.items.length:0})]}),e.jsx("div",{children:a})]})}function N({items:m,onAction:i,canClaim:a,canApprove:l,readOnly:u,currentMemberId:d,loading:n}){return m.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-zinc-300 dark:text-zinc-700 mb-2 flex justify-center",children:e.jsx(k,{size:32})}),e.jsx("p",{className:"text-zinc-400 text-sm italic",children:"No requests in this category."})]}):e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:m.map(s=>e.jsxs("div",{className:"p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/20 transition-colors flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100",children:s.class?.title}),e.jsx("span",{className:"text-[10px] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5 rounded border border-zinc-200 dark:border-zinc-700 font-mono",children:s.class?.id.substring(0,8)})]}),e.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex items-center gap-1",children:[e.jsx(k,{size:14}),new Date(s.class?.startTime).toLocaleString([],{dateStyle:"full",timeStyle:"short"})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-6 text-[10px] font-bold uppercase tracking-widest",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-zinc-400 mb-1",children:"Scheduled Instructor"}),e.jsxs("span",{className:"text-zinc-800 dark:text-zinc-200",children:[s.requestingInstructor?.user?.profile?.firstName," ",s.requestingInstructor?.user?.profile?.lastName]})]}),s.coveringInstructor&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-blue-500 mb-1",children:"Assigned Substitute"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 flex items-center gap-1",children:[s.coveringInstructor?.user?.profile?.firstName," ",s.coveringInstructor?.user?.profile?.lastName]})]})]})]}),!u&&e.jsxs("div",{className:"flex items-center gap-2",children:[a&&s.requestingInstructorId!==d&&s.status==="pending"&&e.jsx("button",{onClick:()=>i(s.id,"claim"),disabled:n,className:"bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 disabled:opacity-50 transition-all hover:-translate-y-0.5",children:"Claim Shift"}),l&&s.status==="claimed"&&e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>i(s.id,"approve"),disabled:n,className:"flex-1 md:flex-none bg-green-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-green-500/20 hover:bg-green-700 disabled:opacity-50 transition-all hover:-translate-y-0.5 flex items-center justify-center gap-2",children:[e.jsx(w,{size:18})," Approve"]}),e.jsxs("button",{onClick:()=>i(s.id,"decline"),disabled:n,className:"flex-1 md:flex-none bg-white dark:bg-zinc-800 border border-red-100 dark:border-red-900/30 text-red-600 px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-red-50 dark:hover:bg-red-900/10 disabled:opacity-50 transition-all flex items-center justify-center gap-2",children:[e.jsx($,{size:18})," Decline"]})]}),s.requestingInstructorId===d&&s.status==="pending"&&e.jsx("button",{onClick:()=>i(s.id,"decline"),disabled:n,className:"text-zinc-400 hover:text-red-500 text-xs font-bold uppercase transition-colors",children:"Cancel Request"})]}),s.status==="approved"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-xl border border-green-100 dark:border-green-900/30",children:[e.jsx(w,{size:20}),e.jsx("span",{className:"text-sm font-bold",children:"Approved"})]})]},s.id))})}export{W as default};
