import{w as F,d as M,l as V,u as _,c as B,r,L as R}from"./chunk-JMJ3UQ3L-CWn0lNw-.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as L}from"./api-LAgipKeK.js";import{a as O}from"./format-CAsSOgDD.js";import{U as J}from"./upload-BQGUJSA5.js";import{I}from"./image-CZHfeZO4.js";import{F as E}from"./film-CTxZkTeS.js";import{c as q}from"./createLucideIcon-C90dpDzR.js";import{X as D}from"./x-DI__YHsw.js";import{I as H}from"./info-C4_0y_6e.js";import{P as X}from"./plus-CoNETXLe.js";import{R as K}from"./refresh-cw-tg6vuv-p.js";import{S as Z}from"./save-Co3NJ5nA.js";const G=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],A=q("folder",G),ue=F(function(){const{videos:i,storageUsage:l,images:a,collections:x}=M(),u=V(),[N,f]=_(),{isStudentView:m}=B(),o=N.get("tab")||"videos",[j,z]=r.useState("grid"),[p,g]=r.useState(null),[k,S]=r.useState(!1),[w,C]=r.useState("video"),[d,h]=r.useState(!1),[y,b]=r.useState(null),U=async s=>{h(!0);try{const n=await window.Clerk?.session?.getToken(),c=await L("/video-management/upload-url",n,{method:"POST",body:JSON.stringify({type:"vod"}),headers:{"X-Tenant-Slug":window.tenantSlug||""}}),{uploadUrl:v,uid:P}=c,$=new FormData;if($.append("file",s),!(await fetch(v,{method:"POST",body:$})).ok)throw new Error("Upload to video server failed");await L("/video-management/",n,{method:"POST",body:JSON.stringify({title:s.name,cloudflareStreamId:P})}),u.revalidate()}catch(n){console.error(n),b("Upload failed: "+n.message)}finally{h(!1)}},T=async s=>{h(!0),b(null);try{const n=await window.Clerk?.session?.getToken(),c=new FormData;if(c.append("file",s),!(await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:c})).ok)throw new Error("Image upload failed");u.revalidate()}catch(n){b("Upload failed: "+n.message)}finally{h(!1)}};return e.jsxs("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-zinc-50/50",children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Media Library"}),e.jsx("p",{className:"text-zinc-500",children:"Manage your class recordings and photo assets."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-zinc-100 px-4 py-2 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-zinc-600",children:"Storage Used: "}),e.jsx("span",{className:"font-bold",children:O(l)})]}),!m&&(o==="videos"?e.jsxs("label",{className:`bg-black text-white px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 transition flex items-center gap-2 ${d?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(J,{size:18}),d?"Uploading...":"Upload Video",e.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:s=>s.target.files?.[0]&&U(s.target.files[0]),disabled:d})]}):e.jsxs("label",{className:`bg-black text-white px-4 py-2 rounded-lg font-medium cursor-pointer hover:bg-zinc-800 transition flex items-center gap-2 ${d?"opacity-70 cursor-not-allowed":""}`,children:[e.jsx(I,{size:18}),d?"Uploading...":"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>s.target.files?.[0]&&T(s.target.files[0]),disabled:d})]}))]})]}),e.jsxs("div",{className:"flex space-x-6 border-b border-zinc-100 -mb-px",children:[e.jsxs("button",{onClick:()=>f({tab:"videos"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${o==="videos"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(E,{size:16})," Videos (",i.length,")"]}),e.jsxs("button",{onClick:()=>f({tab:"collections"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${o==="collections"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(A,{size:16})," Collections (",x.length,")"]}),e.jsxs("button",{onClick:()=>f({tab:"images"}),className:`pb-3 text-sm font-medium flex items-center gap-2 border-b-2 transition ${o==="images"?"border-zinc-900 text-zinc-900":"border-transparent text-zinc-500 hover:text-zinc-700"}`,children:[e.jsx(I,{size:16})," Photos (",a.length,")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[y&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4 text-sm flex justify-between items-center",children:[y,e.jsx("button",{onClick:()=>b(null),children:e.jsx(D,{size:14})})]}),o==="videos"?e.jsx(Q,{videos:i,onSelect:g,selectedId:p?.id}):o==="collections"?e.jsx(W,{collections:x}):e.jsx(Y,{images:a,onSelect:g,selectedId:p?.id})]})]}),p&&e.jsx(ee,{item:p,type:o==="videos"?"video":"image",onClose:()=>g(null),onUpdate:()=>{u.revalidate()}})]})});function Q({videos:t,onSelect:i,selectedId:l}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No videos found."}):e.jsx("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b font-medium text-zinc-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"Duration"}),e.jsx("th",{className:"px-4 py-3",children:"Tags"}),e.jsx("th",{className:"px-4 py-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:t.map(a=>e.jsxs("tr",{onClick:()=>i(a),className:`cursor-pointer hover:bg-zinc-50 transition ${l===a.id?"bg-blue-50/50":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium text-zinc-900",children:a.title}),e.jsx("td",{className:"px-4 py-3 text-zinc-500",children:a.duration?Math.floor(a.duration/60)+"m":"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.tags?.slice(0,3).map(x=>e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-100 text-zinc-600 rounded text-xs",children:x},x)),a.tags?.length>3&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["+",a.tags.length-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(H,{size:16})})})]},a.id))})]})})}function W({collections:t,onCreate:i}){return t.length===0&&!i?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No collections found."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(l=>e.jsx(R,{to:`collections/${l.id}`,className:"block group",children:e.jsxs("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 hover:border-black transition shadow-sm h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-zinc-100 rounded-lg group-hover:bg-zinc-900 group-hover:text-white transition",children:e.jsx(A,{size:24})}),e.jsxs("span",{className:"text-xs text-zinc-400 font-mono",children:["#",l.slug]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:l.title}),e.jsx("p",{className:"text-sm text-zinc-500 line-clamp-2 mb-4 flex-1",children:l.description||"No description"}),e.jsx("div",{className:"text-xs text-zinc-400 font-medium",children:"Click to manage items â†’"})]})},l.id)),e.jsxs("div",{className:"border-2 border-dashed border-zinc-200 rounded-lg p-6 flex flex-col items-center justify-center text-zinc-400 hover:bg-zinc-50 hover:border-zinc-300 transition cursor-pointer min-h-[200px]",onClick:i,children:[e.jsx(X,{size:32}),e.jsx("span",{className:"mt-2 text-sm font-medium",children:"Create Collection"})]})]})}function Y({images:t,onSelect:i,selectedId:l}){return t.length===0?e.jsx("div",{className:"text-gray-400 text-center py-20",children:"No images found."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(a=>e.jsxs("div",{onClick:()=>i(a),className:`bg-white rounded border aspect-square relative group cursor-pointer overflow-hidden ${l===a.id?"ring-2 ring-blue-500 ring-offset-2":"hover:border-zinc-300"}`,children:[e.jsx("img",{src:a.fileUrl,alt:a.title,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:a.title||a.originalName}),e.jsx("p",{className:"text-white/80 text-xs",children:O(a.sizeBytes)})]})]},a.id))})}function ee({item:t,type:i,onClose:l,onUpdate:a}){const[x,u]=r.useState(t.title||t.originalName||""),[N,f]=r.useState(t.description||""),[m,o]=r.useState(t.tags||[]),[j,z]=r.useState(""),[p,g]=r.useState(!1),[k,S]=r.useState(t.accessLevel||"members"),[w,C]=r.useState(t.posterUrl||""),[d,h]=r.useState(!1);r.useEffect(()=>{u(t.title||t.originalName||""),f(t.description||""),o(t.tags||[]),i==="video"&&(S(t.accessLevel||"members"),C(t.posterUrl||"")),z("")},[t,i]);const y=s=>{s.key==="Enter"&&j.trim()&&(s.preventDefault(),m.includes(j.trim())||o([...m,j.trim()]),z(""))},b=s=>{o(m.filter(n=>n!==s))},U=async s=>{h(!0);try{const n=await window.Clerk?.session?.getToken(),c=new FormData;c.append("file",s);const v=await fetch("/api/r2-image",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:c});if(!v.ok)throw new Error("Upload failed");const P=await v.json();C(P.url)}catch(n){console.error(n),alert("Poster upload failed")}finally{h(!1)}},T=async()=>{g(!0);try{const s=await window.Clerk?.session?.getToken(),n=i==="video"?`/video-management/${t.id}`:`/uploads/images/${t.id}`,c={title:x,description:N,tags:m};i==="video"&&(c.accessLevel=k,c.posterUrl=w),await L(n,s,{method:"PATCH",body:JSON.stringify(c)}),a()}catch(s){console.error(s),alert("Failed to save changes.")}finally{g(!1)}};return e.jsxs("div",{className:"w-80 bg-white border-l border-zinc-200 shadow-xl flex flex-col overflow-hidden animate-in slide-in-from-right-10 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 flex justify-between items-center bg-zinc-50",children:[e.jsxs("span",{className:"font-semibold text-sm uppercase text-zinc-500 tracking-wide",children:[i," Details"]}),e.jsx("button",{onClick:l,className:"text-zinc-400 hover:text-zinc-600",children:e.jsx(D,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"aspect-video bg-zinc-100 rounded-lg overflow-hidden border border-zinc-200 flex items-center justify-center relative group",children:[i==="image"?e.jsx("img",{src:t.fileUrl,className:"w-full h-full object-contain"}):w?e.jsx("img",{src:w,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-2 text-zinc-400",children:[e.jsx(E,{size:24}),e.jsx("span",{className:"text-xs",children:"No preview available"})]}),i==="video"&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>s.target.files?.[0]&&U(s.target.files[0]),disabled:d}),e.jsxs("span",{className:"text-white text-xs font-medium flex items-center gap-2",children:[d?e.jsx(K,{className:"animate-spin",size:16}):e.jsx(I,{size:16}),"Change Poster"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-zinc-500",children:[e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Size"}),O(t.sizeBytes)]}),e.jsxs("div",{className:"bg-zinc-50 p-2 rounded",children:[e.jsx("span",{className:"block font-medium text-zinc-700",children:"Created"}),new Date(t.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:x,onChange:s=>u(s.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm focus:ring-2 focus:ring-black focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Description"}),e.jsx("textarea",{value:N,onChange:s=>f(s.target.value),rows:3,className:"w-full px-3 py-2 border border-zinc-200 rounded-lg text-sm focus:ring-2 focus:ring-black focus:border-transparent outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Tags / Labels"}),e.jsxs("div",{className:"min-h-[40px] p-2 border border-zinc-200 rounded-lg bg-white flex flex-wrap gap-2 focus-within:ring-2 focus-within:ring-black focus-within:border-transparent",children:[m.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-zinc-100 text-zinc-700 px-2 py-1 rounded text-xs font-medium",children:[s,e.jsx("button",{onClick:()=>b(s),className:"hover:text-red-500",children:e.jsx(D,{size:10})})]},s)),e.jsx("input",{type:"text",value:j,onChange:s=>z(s.target.value),onKeyDown:y,placeholder:m.length===0?"Type and enter...":"",className:"flex-1 min-w-[60px] text-sm outline-none bg-transparent"})]}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Press Enter to add tag"})]}),i==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Access Level"}),e.jsxs("select",{value:k,onChange:s=>S(s.target.value),className:"w-full px-2 py-2 border border-zinc-200 rounded-lg text-sm outline-none",children:[e.jsx("option",{value:"public",children:"Public (Everyone)"}),e.jsx("option",{value:"members",children:"Members Only (Logged In)"}),e.jsx("option",{value:"private",children:"Private (Admin Only)"})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-zinc-100 bg-zinc-50",children:e.jsx("button",{onClick:T,disabled:p,className:"w-full bg-black text-white py-2 rounded-lg font-medium text-sm hover:bg-zinc-800 disabled:opacity-50 flex items-center justify-center gap-2",children:p?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:16})," Save Usage"]})})})]})}export{ue as default};
