import{w as z,c as w,d as S,m as k,r,L as C}from"./chunk-JMJ3UQ3L-ksN8Xei4.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as N}from"./api-D1U4i9fn.js";import{U as A}from"./user-plus-CLdS--Ez.js";import{c as T}from"./createLucideIcon-mmuW3u_I.js";import{F as I}from"./file-text-DidLscAL.js";import{T as D}from"./triangle-alert-BL6XUhVd.js";import{C as L}from"./check-DfUdlD6u.js";import{X as y}from"./x-BxAStoFO.js";import{T as P}from"./trash-2-DGlI0wOF.js";const _=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],g=T("sticky-note",_);function F({method:a}){switch(a){case"subscription":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Membership"});case"credit":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"Credit"});case"drop_in":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:"Pay Later"});case"free":return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Free"});default:return e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 text-zinc-500",children:"Unknown"})}}const W=z(function(){const{bookings:o}=w(),{slug:h,id:u}=S(),i=k(),d=o.filter(t=>t.status==="confirmed"),x=o.filter(t=>t.status==="waitlisted"),[c,m]=r.useState(null),[p,l]=r.useState(!1),[b,f]=r.useState(!1),j=o.find(t=>t.memberId===c);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{to:`/studio/${h}/schedule`,className:"text-zinc-500 hover:text-zinc-800 font-medium text-sm flex items-center gap-1",children:"â† Back to Schedule"}),e.jsx("div",{className:"h-6 w-px bg-zinc-300"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Class Roster"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 bg-zinc-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-zinc-800 transition-colors",children:[e.jsx(A,{size:16}),"Add Student"]})]}),e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm mb-8",children:[e.jsx("div",{className:"px-6 py-4 border-b border-zinc-200 bg-zinc-50",children:e.jsxs("h3",{className:"font-semibold text-zinc-900",children:["Attending (",d.length,")"]})}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Waiver"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Attendance"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-zinc-100",children:[d.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",children:t.user.profile?.firstName?.[0]||t.user.email[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"}),e.jsx("div",{className:"text-xs text-zinc-500",children:t.user.email})]}),e.jsx("button",{onClick:()=>{m(t.memberId),l(!0)},className:`ml-2 p-1.5 rounded-full transition-colors ${t.hasNotes?"bg-amber-100 text-amber-600 hover:bg-amber-200":"text-zinc-400 hover:bg-zinc-100 hover:text-zinc-600"}`,title:t.hasNotes?"View Notes":"Add Note",children:e.jsx(g,{size:14,className:t.hasNotes?"fill-current":""})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(F,{method:t.paymentMethod})}),e.jsx("td",{className:"px-6 py-4",children:t.waiverSigned?e.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[e.jsx(I,{size:14}),"Signed"]}):e.jsxs("div",{className:"flex items-center gap-1 text-amber-600 text-xs font-bold animate-pulse",children:[e.jsx(D,{size:14}),"Needs Signature"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:"Confirmed"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(i.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsx("input",{type:"hidden",name:"intent",value:"check_in"}),t.checkedInAt?e.jsxs("button",{name:"checkedIn",value:"false",className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200",children:[e.jsx(L,{size:12}),"Checked In"]}):e.jsx("button",{name:"checkedIn",value:"true",className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-zinc-100 text-zinc-500 hover:bg-zinc-200",children:"Mark Present"})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(i.Form,{method:"post",onSubmit:s=>{confirm("Are you sure you want to cancel this booking?")||s.preventDefault()},children:[e.jsx("input",{type:"hidden",name:"intent",value:"cancel_booking"}),e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsxs("button",{className:"text-red-600 hover:text-red-800 text-xs font-medium inline-flex items-center gap-1",children:[e.jsx(y,{size:12}),"Cancel"]})]})})]},t.id)),d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-zinc-500",children:"No attending students."})})]})]})]}),x.length>0&&e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-200 bg-amber-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold text-amber-900",children:["Waitlist (",x.length,")"]}),e.jsx("span",{className:"text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full",children:"Sorted by join order"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Joined At"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:x.map((t,s)=>e.jsxs("tr",{className:"hover:bg-zinc-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",children:s+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"}),e.jsxs("button",{onClick:()=>{m(t.memberId),l(!0)},className:`mt-1 text-xs flex items-center gap-1 ${t.hasNotes?"text-amber-600 font-medium":"text-zinc-400 hover:text-zinc-600"}`,children:[e.jsx(g,{size:12,className:t.hasNotes?"fill-current":""}),t.hasNotes?"Has Notes":"Add Note"]})]})]})}),e.jsx("td",{className:"px-6 py-4 text-zinc-400 text-sm",children:new Date(t.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs(i.Form,{method:"post",children:[e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsx("input",{type:"hidden",name:"intent",value:"promote"}),e.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 rounded bg-green-600 text-white text-xs font-medium hover:bg-green-700",children:"Promote"})]}),e.jsxs(i.Form,{method:"post",onSubmit:n=>!confirm("Remove?")&&n.preventDefault(),children:[e.jsx("input",{type:"hidden",name:"intent",value:"cancel_booking"}),e.jsx("input",{type:"hidden",name:"bookingId",value:t.id}),e.jsx("button",{className:"text-red-600 hover:text-red-800 text-xs font-medium",children:"Remove"})]})]})})]},t.id))})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{className:"px-4 py-2 border border-zinc-300 rounded-md text-sm font-medium text-zinc-700 hover:bg-zinc-50",onClick:()=>window.print(),children:"Print Roster"})}),p&&c&&e.jsx($,{memberId:c,studentName:j?.user.profile?.fullName||j?.user.email||"Student",onClose:()=>l(!1),slug:h})]})});function $({memberId:a,studentName:o,onClose:h,slug:u}){const[i,d]=r.useState([]),[x,c]=r.useState(!0),[m,p]=r.useState(""),[l,b]=r.useState(!1);r.useEffect(()=>{f()},[a]);const f=async()=>{c(!0);try{const s=await window.Clerk?.session?.getToken(),n=await N(`/members/${a}/notes`,s,{headers:{"X-Tenant-Slug":u}});d(n.notes||[])}catch(s){console.error(s)}finally{c(!1)}},j=async s=>{s.preventDefault(),b(!0);try{const n=await window.Clerk?.session?.getToken();await N(`/members/${a}/notes`,n,{method:"POST",headers:{"X-Tenant-Slug":u},body:JSON.stringify({note:m})}),p(""),f()}catch{alert("Failed to add note")}finally{b(!1)}},t=async s=>{if(confirm("Delete note?"))try{const n=await window.Clerk?.session?.getToken();await N(`/members/${a}/notes/${s}`,n,{method:"DELETE",headers:{"X-Tenant-Slug":u}}),d(i.filter(v=>v.id!==s))}catch{}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-zinc-200",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Notes: ",o]}),e.jsx("button",{onClick:h,children:e.jsx(y,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:x?e.jsx("div",{className:"text-center py-4 text-zinc-400",children:"Loading notes..."}):i.length===0?e.jsx("div",{className:"text-center py-8 text-zinc-400 italic bg-zinc-50 rounded-lg",children:"No notes yet."}):i.map(s=>e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm relative group",children:[e.jsx("p",{className:"text-zinc-800 whitespace-pre-wrap",children:s.note}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500 flex justify-between items-center",children:[e.jsxs("span",{children:[new Date(s.createdAt).toLocaleDateString()," by ",s.author?.user?.profile?.firstName||"Staff"]}),e.jsx("button",{onClick:()=>t(s.id),className:"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(P,{size:12})})]})]},s.id))}),e.jsx("div",{className:"p-4 border-t border-zinc-200 bg-zinc-50",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("textarea",{value:m,onChange:s=>p(s.target.value),placeholder:"Add a medical note, injury, or preference...",className:"w-full text-sm border-zinc-300 rounded-md mb-2 focus:ring-blue-500 min-h-[80px]",required:!0}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:l,className:"bg-zinc-900 text-white px-4 py-2 rounded text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:l?"Adding...":"Add Note"})})]})})]})})}export{W as default};
