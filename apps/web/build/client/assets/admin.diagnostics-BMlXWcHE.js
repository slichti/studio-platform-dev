import{w as f,u,i as p}from"./chunk-EPOLDU6W-QEwcj8It.js";import{j as e}from"./vendor-puck-d5q8lBvG.js";import{C as n,a,b as r,d as i,c}from"./Card-DI7FNbqC.js";import{B as o}from"./Badge-BsFcwxdU.js";import{A as m}from"./activity-Ck9KrIjl.js";import{c as g}from"./createLucideIcon-Ccni2AnG.js";import{D as N}from"./database-CSufwjPk.js";import{S as y}from"./shield-check-DOuEfT-a.js";import{C as b}from"./circle-check-big-4vjiwfXL.js";import{C as w}from"./circle-x-XHGZysAA.js";import{C as v}from"./clock-DFbJ6nku.js";import"./vendor-charts-C-svo-KU.js";const k=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],C=g("server",k),I=f(function(){const{env:x}=u(),l=p(),h=async()=>{l.load("/admin/diagnostics/run")},s=l.data,d=l.state==="loading";return e.jsxs("div",{className:"container mx-auto py-10 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Diagnostics"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Real-time health checks and integration status."})]}),e.jsxs("button",{onClick:h,disabled:d,className:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-zinc-900 text-white hover:bg-zinc-900/90 h-11 px-8",children:[d?e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(m,{className:"mr-2 h-4 w-4"}),"Run Diagnostics"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(n,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Environment"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold capitalize",children:x}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Running on Cloudflare Workers"})]})]}),e.jsxs(n,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Database Latency"}),e.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:s?.latency?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.latency.database_read_ms||s.latency.database_ms,"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read check to D1"})]}):e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"-"})})]}),e.jsxs(n,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"System Status"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:s?e.jsx("div",{className:"flex items-center space-x-2",children:s.status==="ok"?e.jsx(o,{variant:"default",className:"bg-green-600 hover:bg-green-700",children:"Operational"}):e.jsx(o,{variant:"error",children:"Degraded"})}):e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"-"})})]})]}),s?.integrations&&e.jsxs(n,{children:[e.jsxs(a,{children:[e.jsx(r,{children:"Integrations"}),e.jsx(c,{children:"Status of third-party connections"})]}),e.jsx(i,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(s.integrations).map(([t,j])=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsx("span",{className:"capitalize font-medium",children:t.replace("_"," ")}),j?e.jsx(b,{className:"h-5 w-5 text-green-500"}):e.jsx(w,{className:"h-5 w-5 text-red-500"})]},t))})})]}),s?.worker&&e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(n,{children:[e.jsxs(a,{children:[e.jsx(r,{children:"Worker Performance"}),e.jsx(c,{children:"Edge execution details"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Memory Usage"}),e.jsxs("span",{className:"font-mono text-sm",children:[s.worker.memory_used_mb," MB"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"PoP (Point of Presence)"}),e.jsx("span",{className:"font-mono text-sm",children:s.worker.colo})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Region"}),e.jsxs("span",{className:"font-mono text-sm",children:[s.worker.city,", ",s.worker.country]})]})]})]}),e.jsxs(n,{children:[e.jsxs(a,{children:[e.jsx(r,{children:"Database Performance"}),e.jsx(c,{children:"D1 Read/Write Latency"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Read Latency"}),e.jsxs("span",{className:"font-mono text-sm",children:[s.latency?.database_read_ms," ms"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Query Latency (Write/Mixed)"}),e.jsxs("span",{className:"font-mono text-sm",children:[s.latency?.database_query_ms," ms"]})]})]})]})]}),s?.clientErrors&&e.jsxs(n,{children:[e.jsxs(a,{children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Recent Client Errors (Telemetry)"]}),e.jsx(c,{children:"Errors reported by user browsers"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:s.clientErrors.length>0?s.clientErrors.map(t=>e.jsxs("div",{className:"flex flex-col gap-1 border-b pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-sm font-medium text-red-600 truncate max-w-[60%]",children:t.details?.message||"Unknown Error"}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(t.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate max-w-[70%]",children:t.details?.url||"Unknown URL"}),e.jsx("span",{children:t.ip||"Unknown IP"})]})]},t.id)):e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No recent client-side errors reported."})})})]})]})});export{I as default};
