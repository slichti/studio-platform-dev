import{j as e,L as E,a as x,W as R,A as P,Q as k,$ as O,X as F,as as T,bZ as A,bm as D,bA as M,ar as U,bE as K,az as w,b_ as y,y as V,b$ as B,p as q,q as j,c0 as W,a1 as G,ag as H,b5 as Q,ae as X,bg as Z,aj as Y,aa as I,ad as J,a4 as L,c1 as ee,a7 as se,aN as te,a0 as _,ac as ne,b1 as ie,aS as ae,aU as re,aT as ce,bl as oe,bj as le,bd as de,U as xe,a_ as me,aC as ue,bF as he}from"./vendor-react-D59Q0YKK.js";import{T as pe}from"./ThemeToggle-CVWLY6iS.js";import{a as ge}from"./api-D1U4i9fn.js";import{C as je}from"./ChatWidget-D0laB8xx.js";import"./vendor-puck-RN2Ey-av.js";import"./vendor-charts-Dp-zC2wb.js";import"./ThemeProvider-CzNjogV3.js";function fe({tier:l,branding:s,className:i=""}){let n=!0;return l==="scale"&&s?.hidePoweredBy&&(n=!1),n?e.jsx("div",{className:`py-4 text-center ${i}`,children:e.jsxs(E,{to:"https://studioplatform.com",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-xs text-zinc-400 hover:text-zinc-600 dark:text-zinc-600 dark:hover:text-zinc-400 transition-colors",children:[e.jsx("span",{className:"font-semibold",children:"Powered by"}),e.jsx("span",{className:"font-bold tracking-tight text-zinc-500 dark:text-zinc-500",children:"StudioPlatform"})]})}):null}function be({token:l}){const[s,i]=x.useState(!1),[n,m]=x.useState(""),[u,d]=x.useState({students:[],classes:[],orders:[]}),[c,f]=x.useState(!1),[o,p]=x.useState(0),{slug:h}=R(),N=P(),$=x.useRef(null),g=[...u.students.map(t=>({...t,type:"student"})),...u.classes.map(t=>({...t,type:"class"})),...u.orders.map(t=>({...t,type:"order"}))];x.useEffect(()=>{const t=r=>{r.key==="k"&&(r.metaKey||r.ctrlKey)&&(r.preventDefault(),i(b=>!b)),r.key==="Escape"&&i(!1),s&&(r.key==="ArrowDown"&&(r.preventDefault(),p(b=>(b+1)%Math.max(1,g.length))),r.key==="ArrowUp"&&(r.preventDefault(),p(b=>(b-1+g.length)%Math.max(1,g.length))),r.key==="Enter"&&g[o]&&(r.preventDefault(),S(g[o].type,g[o])))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[s,g,o]),x.useEffect(()=>{s&&(setTimeout(()=>$.current?.focus(),10),m(""),d({students:[],classes:[],orders:[]}))},[s]),x.useEffect(()=>{if(!n||n.length<2){d({students:[],classes:[],orders:[]});return}const t=setTimeout(async()=>{f(!0);try{const r=await ge(`/tenant/search?q=${n}`,l,{headers:{"X-Tenant-Slug":h}});d(r),p(0)}catch(r){console.error("Search failed",r)}finally{f(!1)}},300);return()=>clearTimeout(t)},[n,h,l]);const S=(t,r)=>{i(!1),t==="student"&&N(`/studio/${h}/students/${r.id}`),t==="class"&&N(`/studio/${h}/classes/${r.id}`),t==="order"&&N(`/studio/${h}/pos`)};if(!s)return null;const C=[...u.students.map(t=>({...t,type:"student"})),...u.classes.map(t=>({...t,type:"class"})),...u.orders.map(t=>({...t,type:"order"}))];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[15vh] px-4 backdrop-blur-sm bg-zinc-900/50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[60vh] animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsx(k,{className:"h-5 w-5 text-zinc-400 mr-3"}),e.jsx("input",{ref:$,type:"text",placeholder:"Search students, classes, or orders...",value:n,onChange:t=>m(t.target.value),className:"flex-1 bg-transparent border-none outline-none text-zinc-900 dark:text-zinc-100 placeholder:text-zinc-500 text-base"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx(O,{className:"h-4 w-4 text-zinc-400 animate-spin"}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded",children:e.jsx(F,{className:"h-4 w-4 text-zinc-400"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[n.length<2&&e.jsxs("div",{className:"p-8 text-center text-zinc-500",children:[e.jsx(ze,{}),e.jsx("p",{className:"text-sm mt-2",children:"Type at least 2 characters to search..."})]}),n.length>=2&&C.length===0&&!c&&e.jsx("div",{className:"p-8 text-center text-zinc-500",children:e.jsxs("p",{className:"text-sm",children:['No results found for "',n,'"']})}),e.jsx("div",{className:"space-y-1",children:C.map((t,r)=>e.jsxs("button",{onClick:()=>S(t.type,t),onMouseEnter:()=>p(r),className:`w-full flex items-center gap-4 px-3 py-2.5 rounded-xl transition-all text-left ${o===r?"bg-blue-600 text-white shadow-lg shadow-blue-500/20":"hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsxs("div",{className:`p-2 rounded-lg ${o===r?"bg-white/20":"bg-zinc-100 dark:bg-zinc-800"}`,children:[t.type==="student"&&e.jsx(T,{size:18}),t.type==="class"&&e.jsx(A,{size:18}),t.type==="order"&&e.jsx(D,{size:18})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-bold text-sm truncate",children:[t.type==="student"?`${t.name?.firstName||"Student"} ${t.name?.lastName||""}`:t.title||t.name,t.type==="order"&&`Order #${t.id.substring(0,8)}`]}),e.jsxs("div",{className:"text-[10px] uppercase font-bold tracking-tight opacity-70",children:[t.type," • ",t.email||t.category||`$${(t.totalAmount/100).toFixed(2)}`]})]}),e.jsx("div",{className:"text-[10px] opacity-40 font-mono",children:o===r?"Enter":""})]},t.id))})]}),e.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-zinc-900 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between text-[10px] text-zinc-400 font-medium",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(v,{children:"CMD"})," + ",e.jsx(v,{children:"K"})," Toggle"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(v,{children:"↑↓"})," Navigate"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(v,{children:"Enter"})," Select"]})]}),e.jsx("span",{children:"Zenflow Search Engine"})]})]})})}function v({children:l}){return e.jsx("kbd",{className:"px-1.5 py-0.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded text-[9px] font-sans antialiased text-zinc-500",children:l})}function ze(){return e.jsxs("div",{className:"relative w-10 h-10 mx-auto opacity-20",children:[e.jsx(k,{className:"absolute inset-0 w-full h-full text-zinc-400"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-0.5 bg-zinc-400 animate-pulse"})]})}function z({title:l,children:s,defaultOpen:i=!0}){const[n,m]=x.useState(i);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{onClick:()=>m(!n),className:"w-full flex items-center justify-between px-3 py-1.5 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider hover:text-zinc-800 dark:hover:text-zinc-200 transition-colors",children:[l,n?e.jsx(M,{size:14}):e.jsx(U,{size:14})]}),n&&e.jsx("div",{className:"mt-1 space-y-0.5",children:s})]})}function we({tenantName:l,userName:s,currentRole:i}){const n=["owner","instructor","student"],{signOut:m}=K(),u=o=>{document.cookie=`__impersonate_role=${o}; path=/; SameSite=Lax`,window.location.reload()},d=async()=>{localStorage.removeItem("impersonation_token"),document.cookie="__impersonate_token=; path=/; max-age=0; SameSite=Lax",document.cookie="__impersonate_role=; path=/; max-age=0; SameSite=Lax",await m({redirectUrl:"/admin/users"})},f=(o=>{switch(o){case"owner":return"bg-purple-600";case"instructor":return"bg-blue-600";case"student":return"bg-emerald-600";default:return"bg-zinc-700"}})(i);return e.jsxs("div",{className:`${f} text-white px-4 py-2 flex items-center justify-between shadow-md relative z-50`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx(w,{size:16}),e.jsx("span",{children:"Impersonating"})]}),e.jsxs("div",{className:"text-sm",children:["Viewing ",e.jsx("strong",{children:l})," as ",e.jsx("strong",{children:s})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{as:"div",className:"relative",children:[e.jsxs(y.Button,{className:"flex items-center gap-2 px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm transition-colors",children:[e.jsxs("span",{children:["View as: ",e.jsx("strong",{children:i.charAt(0).toUpperCase()+i.slice(1)})]}),e.jsx(M,{size:14})]}),e.jsx(y.Items,{className:"absolute right-0 mt-1 w-40 bg-white dark:bg-zinc-800 rounded-md shadow-lg py-1 border border-zinc-200 dark:border-zinc-700 focus:outline-none text-zinc-800 dark:text-zinc-200",children:n.map(o=>e.jsx(y.Item,{children:({active:p})=>e.jsxs("button",{onClick:()=>u(o),className:`${p?"bg-zinc-100 dark:bg-zinc-700":""} group flex w-full items-center justify-between px-3 py-2 text-sm`,children:[e.jsx("span",{className:"capitalize",children:o}),i===o&&e.jsx(V,{size:14,className:"text-green-500"})]})},o))})]}),e.jsx("div",{className:"h-4 w-px bg-white/30 mx-2"}),e.jsxs("button",{onClick:d,className:"flex items-center gap-2 px-3 py-1 bg-white/10 hover:bg-red-500/80 rounded text-sm transition-colors",children:[e.jsx(B,{size:14}),e.jsx("span",{children:"Exit"})]})]})]})}const Ie=q(function(){const{slug:s,tenant:i,me:n,isPaused:m,features:u}=j(),d=new Set(u),[c,f]=x.useState(()=>typeof window<"u"?localStorage.getItem("studio_student_view")==="true":!1),o=()=>{const h=!c;f(h),localStorage.setItem("studio_student_view",String(h))},p=c?["student"]:n?.roles||[];return e.jsxs("div",{className:"flex h-screen bg-zinc-50 dark:bg-zinc-950 font-sans text-zinc-900 dark:text-zinc-100 transition-colors duration-300",children:[e.jsxs("aside",{className:"w-64 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col fixed inset-y-0 z-20 transition-colors duration-300",children:[e.jsx("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:e.jsxs(E,{to:`/studio/${s}`,prefetch:"intent",className:"flex items-center gap-2 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold group-hover:scale-105 transition-transform",children:i.name.substring(0,1)}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm leading-tight text-zinc-900 dark:text-zinc-100",children:i.name}),e.jsxs("span",{className:"text-[10px] text-zinc-500 dark:text-zinc-400 font-mono",children:["/studio/",s]})]})]})}),e.jsxs("nav",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsx("div",{className:"space-y-1",children:e.jsx(a,{to:`/studio/${s}`,end:!0,icon:e.jsx(W,{size:18}),children:"Dashboard"})}),e.jsxs(z,{title:"Operations",children:[e.jsx(a,{to:`/studio/${s}/schedule`,icon:e.jsx(G,{size:18}),children:"Schedule"}),e.jsx(a,{to:`/studio/${s}/classes`,icon:e.jsx(A,{size:18}),children:"Classes"}),e.jsx(a,{to:`/studio/${s}/appointments`,icon:e.jsx(H,{size:18}),children:"Appointments"}),e.jsx(a,{to:`/studio/${s}/checkin`,icon:e.jsx(Q,{size:18}),children:c?"Attendance History":"Check-in"}),!c&&e.jsx(a,{to:`/studio/${s}/substitutions`,icon:e.jsx(X,{size:18}),children:"Substitutions"}),e.jsx(a,{to:`/studio/${s}/waivers`,icon:e.jsx(Z,{size:18}),children:"Waivers"}),e.jsx(a,{to:`/studio/${s}/videos`,icon:e.jsx(Y,{size:18}),children:"Media Library"})]}),e.jsxs(z,{title:"Commerce",children:[(d.has("pos")||["growth","scale"].includes(i.tier))&&!c&&e.jsx(e.Fragment,{children:e.jsx(a,{to:`/studio/${s}/pos`,icon:e.jsx(D,{size:18}),children:"POS & Retail"})}),e.jsx(a,{to:`/studio/${s}/memberships`,icon:e.jsx(I,{size:18}),children:"Memberships"}),e.jsx(a,{to:`/studio/${s}/commerce/packs`,icon:e.jsx(J,{size:18}),children:"Class Packs"}),(d.has("pos")||["growth","scale"].includes(i.tier))&&e.jsxs(e.Fragment,{children:[e.jsx(a,{to:`/studio/${s}/commerce/coupons`,icon:e.jsx(L,{size:18}),children:c?"My Coupons":"Coupons"}),e.jsx(a,{to:`/studio/${s}/commerce/gift-cards`,icon:e.jsx(L,{size:18}),children:"Gift Cards"})]})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{title:"CRM",children:[e.jsx(a,{to:`/studio/${s}/leads`,icon:e.jsx(T,{size:18}),children:"Leads"}),e.jsx(a,{to:`/studio/${s}/tasks`,icon:e.jsx(ee,{size:18}),children:"Tasks"}),(d.has("marketing")||["growth","scale"].includes(i.tier))&&e.jsx(a,{to:`/studio/${s}/marketing`,icon:e.jsx(se,{size:18}),children:"Marketing"}),(d.has("loyalty")||["growth","scale"].includes(i.tier))&&e.jsx(a,{to:`/studio/${s}/loyalty`,icon:e.jsx(te,{size:18}),children:"Loyalty"})]}),e.jsxs(z,{title:"Management",children:[e.jsx(a,{to:`/studio/${s}/students`,icon:e.jsx(w,{size:18}),children:"People"}),(["scale"].includes(i.tier)||d.has("payroll"))&&e.jsx(a,{to:`/studio/${s}/financials/payroll`,icon:e.jsx(I,{size:18}),children:"Payroll Admin"}),p.some(h=>["instructor","admin","owner"].includes(h))&&e.jsx(a,{to:`/studio/${s}/financials/my-payouts`,icon:e.jsx(_,{size:18}),children:"My Payouts"}),e.jsx(a,{to:`/studio/${s}/finances`,end:!0,icon:e.jsx(_,{size:18}),children:"Finances"}),e.jsx(a,{to:`/studio/${s}/discounts`,icon:e.jsx(ne,{size:18}),children:"Discounts"}),e.jsx(a,{to:`/studio/${s}/settings/embeds`,icon:e.jsx(ie,{size:18}),children:"Website Widgets"}),i.platformFeatures?.feature_mobile_app&&e.jsx(a,{to:`/studio/${s}/settings/mobile-app`,icon:e.jsx(ae,{size:18}),children:"Mobile App"}),e.jsx(a,{to:`/studio/${s}/settings/integrations`,icon:e.jsx(re,{size:18}),children:"Integrations"}),e.jsx(a,{to:`/studio/${s}/settings/chat`,icon:e.jsx(ce,{size:18}),children:"Chat Settings"}),e.jsx(a,{to:`/studio/${s}/data`,icon:e.jsx(oe,{size:18}),children:"Data"}),e.jsx(a,{to:`/studio/${s}/settings`,end:!0,icon:e.jsx(le,{size:18}),children:"Settings"})]}),e.jsx(z,{title:"Analytics",children:e.jsx(a,{to:`/studio/${s}/reports`,icon:e.jsx(de,{size:18}),children:"Reports"})})]})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 flex flex-col gap-3",children:[!c&&(n?.roles?.includes("owner")||n?.roles?.includes("admin")||j().me?.user?.isSystemAdmin||j().isImpersonating)&&e.jsxs("button",{onClick:o,className:"flex items-center gap-2 text-zinc-500 hover:text-blue-600 dark:text-zinc-400 dark:hover:text-blue-400 text-xs font-medium transition mb-1",children:[e.jsx(w,{size:14}),e.jsx("span",{children:"View as Student"})]}),(j().me?.user?.isSystemAdmin||j().isImpersonating)&&!c&&e.jsxs("a",{href:"/admin",className:"flex items-center gap-2 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100 text-xs font-medium transition mb-1",children:[e.jsx(w,{size:14}),e.jsx("span",{children:"Return to Admin"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{}),e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[e.jsxs("span",{className:"text-sm font-medium truncate text-zinc-900 dark:text-zinc-200",children:[n.firstName," ",n.lastName]}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:n.email})]})]}),e.jsx(pe,{})]}),e.jsx("div",{className:"pt-4 mt-auto",children:e.jsx(fe,{tier:i.tier,branding:i.branding})})]})]}),e.jsxs("main",{className:"flex-1 ml-64 flex flex-col min-w-0 relative",children:[j().isImpersonating&&e.jsx(we,{tenantName:i.name,userName:`${n.firstName} ${n.lastName}`,currentRole:n.roles&&n.roles.length>0?n.roles[0]:"student"}),c&&e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-2 text-sm font-medium flex items-center justify-between shadow-md z-30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:16}),e.jsx("span",{children:"You are viewing as a Student."})]}),e.jsx("button",{onClick:o,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-bold hover:bg-zinc-100 transition",children:"Exit View"})]}),m&&e.jsxs("div",{className:"bg-amber-100 border-b border-amber-200 text-amber-800 px-6 py-3 text-sm font-medium flex items-center gap-2",children:[e.jsx(me,{size:16}),e.jsx("span",{children:"This studio is currently paused. Some features may be restricted."})]}),e.jsx("div",{className:"px-8 pt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>window.dispatchEvent(new KeyboardEvent("keydown",{key:"k",metaKey:!0})),className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg text-xs text-zinc-400 hover:border-blue-500 transition-all shadow-sm group",children:[e.jsx(k,{size:14,className:"group-hover:text-blue-500"}),e.jsx("span",{children:"Search..."}),e.jsx("kbd",{className:"ml-2 px-1.5 py-0.5 bg-zinc-100 dark:bg-zinc-800 rounded font-sans opacity-50",children:"⌘K"})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(ue,{context:{tenant:i,me:n,features:d,roles:p,isStudentView:c}})}),!c&&e.jsx(be,{token:j().token}),i.googleCredentials?.measurementId&&e.jsxs(e.Fragment,{children:[e.jsx("script",{async:!0,src:`https://www.googletagmanager.com/gtag/js?id=${i.googleCredentials.measurementId}`}),e.jsx("script",{dangerouslySetInnerHTML:{__html:`
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', '${i.googleCredentials.measurementId}');
                        `}})]})]}),e.jsx(je,{roomId:`support-${n.id}`,tenantId:c?s||"":"platform",userId:n.id,userName:`${n.firstName} ${n.lastName}`,enabled:!c||i.settings?.chatEnabled!==!1,chatConfig:c?i.settings?.chatConfig:void 0})]})});function a({to:l,children:s,icon:i,end:n}){return e.jsxs(he,{to:l,end:n,prefetch:"intent",className:({isActive:m})=>`block px-3 py-2 rounded-lg text-sm transition-colors mb-0.5 flex items-center gap-3 ${m?"bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 font-medium":"text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 hover:text-zinc-900 dark:hover:text-zinc-100"}`,children:[i,s]})}export{Ie as default};
