import{a as t,j as e,X as H,aO as J,aP as K}from"./vendor-react-D59Q0YKK.js";function D({roomId:h,tenantId:p,userId:i,userName:w,apiUrl:g="",enabled:$=!0,chatConfig:x}){const[n,O]=t.useState(!1),[f,j]=t.useState([]),[d,v]=t.useState(""),[c,y]=t.useState(!1),[V,m]=t.useState([]),a=t.useRef(null),N=t.useRef(null),z=t.useRef(n);t.useEffect(()=>{z.current=n},[n]);const[R]=t.useState(()=>`guest_${Math.random().toString(36).substr(2,9)}`),C=i||R,P=w||"Guest",S=t.useCallback(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[]);t.useEffect(()=>{S()},[f,S]),t.useEffect(()=>{if(c)return;const s=g||(typeof window<"u"?window.location.origin:""),u=s.startsWith("https")?"wss://":"ws://",M=s.replace(/^http(s)?:\/\//,""),_=`${u}${M}/api/chat/rooms/${h}/websocket?roomId=${h}&tenantId=${p}&userId=${C}&userName=${encodeURIComponent(P)}`,l=new WebSocket(_);return a.current=l,l.onopen=()=>{y(!0),console.log("[Chat] Connected")},l.onmessage=b=>{try{const r=JSON.parse(b.data);switch(r.type){case"history":j(r.messages||[]);break;case"message":j(o=>[...o,r]),!z.current&&r.userId!==C&&I(o=>o+1);break;case"user_list":m(r.users||[]);break;case"user_joined":m(o=>[...o,{userId:r.userId,userName:r.userName}]);break;case"user_left":m(o=>o.filter(q=>q.userId!==r.userId));break}}catch(r){console.error("[Chat] Parse error:",r)}},l.onclose=()=>{y(!1),console.log("[Chat] Disconnected")},l.onerror=b=>{console.error("[Chat] Error:",b)},()=>{l.close(),a.current=null}},[h,p,i,w,g]);const k=()=>{!d.trim()||!a.current||a.current.readyState!==WebSocket.OPEN||(a.current.send(JSON.stringify({type:"message",content:d.trim()})),v(""))},W=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),k())},[E,I]=t.useState(0),B=["I have a question","Contact support","Billing inquiry"],U=(s,u)=>{!a.current||a.current.readyState!==WebSocket.OPEN||a.current.send(JSON.stringify({type:"message",content:s,metadata:u?{routedRole:u}:void 0}))};return $?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{O(!n),n||I(0)},className:"fixed bottom-6 right-6 w-14 h-14 bg-[#2563EB] text-white rounded-full shadow-lg hover:opacity-90 transition flex items-center justify-center z-50",children:[n?e.jsx(H,{size:24}):e.jsx(J,{size:24}),E>0&&!n&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white border-2 border-white",children:E})]}),n&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-xl shadow-2xl border border-zinc-200 flex flex-col z-50 overflow-hidden font-sans",children:[e.jsxs("div",{className:"bg-[#2563EB] text-white px-6 py-6 pb-12 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Chat with us"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:"ðŸ‘‹ Hi, message us with any questions. We're happy to help!"})]}),e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute top-8 right-12 w-16 h-16 bg-white/10 rounded-full"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-white flex flex-col",children:e.jsxs("div",{className:"mt-auto p-4 space-y-4",children:[f.map(s=>e.jsx("div",{className:`flex ${s.userId===i?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl text-sm ${s.userId===i?"bg-[#2563EB] text-white rounded-br-sm":"bg-gray-100 text-zinc-900 rounded-bl-sm"}`,children:e.jsx("p",{children:s.content})})},s.id)),f.length===0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-zinc-500 mb-2 uppercase tracking-wide",children:"How can we help?"}),(x&&x.length>0?x:B.map(s=>({id:s,label:s,type:"action"}))).map(s=>e.jsx("button",{onClick:()=>U(s.label,s.routeToRole),disabled:!c,className:"w-full text-left p-3 rounded-xl border border-zinc-200 text-sm text-zinc-700 hover:bg-zinc-50 hover:border-zinc-300 transition-colors bg-white shadow-sm",children:s.label},s.id||s.label))]}),e.jsx("div",{ref:N})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-100 bg-white",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:d,onChange:s=>v(s.target.value),onKeyPress:W,placeholder:"Write message",className:"w-full pl-4 pr-12 py-3 bg-white border border-zinc-200 rounded-xl text-sm focus:outline-none focus:border-zinc-300 focus:ring-0 shadow-sm",disabled:!c}),e.jsx("button",{onClick:k,disabled:!c||!d.trim(),className:"absolute right-2 p-2 text-zinc-400 hover:text-[#2563EB] transition-colors disabled:opacity-50",children:e.jsx(K,{size:20})})]}),!c&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-[10px] text-zinc-400",children:"Connecting to support..."})})]})]})]}):null}export{D as C};
