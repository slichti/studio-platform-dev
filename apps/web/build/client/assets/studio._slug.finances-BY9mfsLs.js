import{w as F,H as A,r as n}from"./chunk-JMJ3UQ3L-BbiJBYoX.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as l}from"./api-piI5qlNr.js";import{u as D}from"./chunk-OT5FTIRN-B7u9hlog.js";import"./index-OR0PfU_z.js";import"./index-DiVMhslm.js";const q=F(function(){const{tenant:c,member:I,roles:j}=A(),x=j.includes("owner");if(!x)return e.jsx("div",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400",children:"You do not have permission to view this page."});const k=()=>{const t="https://studio-platform-api.slichti.workers.dev";window.location.href=`${t}/studios/stripe/connect?tenantId=${c.id}`},{getToken:m}=D(),[d,v]=n.useState(null),[u,N]=n.useState([]),[o,w]=n.useState(null);n.useEffect(()=>{if(!c.stripeAccountId||!x)return;(async()=>{const i=await m(),a="https://studio-platform-api.slichti.workers.dev";l(`${a}/commerce/stats`,i).then(s=>{s&&v(s)}),l(`${a}/commerce/transactions`,i).then(s=>{s&&s.transactions&&N(s.transactions)}),l(`${a}/commerce/balance`,i).then(s=>{s&&!s.error&&w(s)})})()},[c.id,x,m]);const[r,y]=n.useState(null),[S,h]=n.useState(!1),[b,p]=n.useState(""),[f,R]=n.useState(""),[z,g]=n.useState(!1),C=t=>{y(t),p((t.amount/100).toFixed(2)),h(!0)},$=async()=>{if(!r)return;g(!0);const t=await m();let i="pos";r.description?.includes("Pack")&&(i="pack"),r.description?.includes("Membership")&&(i="membership");const a=await l("https://studio-platform-api.slichti.workers.dev/refunds",t,{method:"POST",body:JSON.stringify({amount:Math.round(parseFloat(b)*100),reason:f,referenceId:r.id,type:r.type||i})});g(!1),a&&!a.error?(alert("Refund processed successfully"),h(!1)):alert(a?.error||"Refund failed")};return e.jsxs("div",{className:"max-w-4xl text-zinc-900 dark:text-zinc-100",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Finances"}),S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-200 dark:border-zinc-800 w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Process Refund"}),e.jsxs("p",{className:"text-sm text-zinc-500 mb-6",children:["Refund for ",r?.description," on ",new Date(r?.date).toLocaleDateString()]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Amount ($)"}),e.jsx("input",{type:"number",value:b,onChange:t=>p(t.target.value),className:"w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Reason"}),e.jsx("textarea",{value:f,onChange:t=>R(t.target.value),placeholder:"Customer requested...",className:"w-full bg-zinc-50 dark:bg-zinc-800 border-none rounded-md px-3 py-2"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:z,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:z?"Processing...":"Confirm Refund"})]})]})}),c.stripeAccountId?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center text-green-600 dark:text-green-300",children:"âœ“"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-300",children:"Stripe Connected"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Your account is ready to process payments."})]})]}),e.jsx("div",{className:"text-sm font-mono text-zinc-500 dark:text-zinc-400",children:c.stripeAccountId})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Total Revenue"}),e.jsxs("div",{className:"text-3xl font-bold",children:["$",d?(d.totalRevenue/100).toFixed(2):"0.00"]}),e.jsx("div",{className:"text-xs mt-2 text-zinc-500 dark:text-zinc-400",children:"Est. All Time"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Monthly Recurring"}),e.jsxs("div",{className:"text-3xl font-bold",children:["$",d?(d.mrr/100).toFixed(2):"0.00"]}),e.jsxs("div",{className:"text-xs mt-2 text-zinc-500 dark:text-zinc-400",children:["Active Subs: ",d?.activeSubscriptions||0]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-6 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium mb-1 text-zinc-500 dark:text-zinc-400",children:"Stripe Balance"}),e.jsxs("div",{className:"text-3xl font-bold",children:["$",o?(o.available/100).toFixed(2):"0.00"]}),e.jsxs("div",{className:"text-xs mt-2 text-zinc-500 dark:text-zinc-400",children:["Pending: $",o?(o.pending/100).toFixed(2):"0.00"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",children:[e.jsx("h3",{className:"font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Transaction History"}),u.length===0?e.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"No recent transactions."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200 dark:border-zinc-700",children:[e.jsx("th",{className:"text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",children:"Date"}),e.jsx("th",{className:"text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",children:"Description"}),e.jsx("th",{className:"text-left py-2 font-medium text-zinc-700 dark:text-zinc-300",children:"Customer"}),e.jsx("th",{className:"text-right py-2 font-medium text-zinc-700 dark:text-zinc-300",children:"Amount"}),e.jsx("th",{className:"text-right py-2 font-medium text-zinc-700 dark:text-zinc-300",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{className:"border-b last:border-0 border-zinc-200 dark:border-zinc-700",children:[e.jsx("td",{className:"py-2 text-zinc-600 dark:text-zinc-400",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"py-2 text-zinc-600 dark:text-zinc-400",children:t.description}),e.jsx("td",{className:"py-2 text-zinc-600 dark:text-zinc-400",children:t.customer}),e.jsxs("td",{className:"py-2 text-right text-zinc-900 dark:text-zinc-100",children:["$",(t.amount/100).toFixed(2)]}),e.jsx("td",{className:"py-2 text-right",children:e.jsx("button",{onClick:()=>C(t),className:"text-xs text-red-600 hover:text-red-700 hover:underline",children:"Refund"})})]},t.id))})]})]})]}):e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-8 rounded-lg shadow-sm text-center",children:[e.jsx("div",{className:"mb-4 text-4xl",children:"ðŸ’³"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Setup Payouts"}),e.jsx("p",{className:"mb-6 max-w-md mx-auto text-zinc-500 dark:text-zinc-400",children:"Connect with Stripe to start accepting payments for class packs and memberships. Funds will be deposited directly to your bank account."}),e.jsxs("button",{onClick:k,className:"bg-[#635BFF] text-white px-6 py-2.5 rounded-md font-medium hover:bg-[#534be0] transition-colors inline-flex items-center gap-2",children:[e.jsx("span",{children:"Connect with Stripe"}),e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 6v-2h14v16h-14v-2h-2v4h18v-20h-18v4h2zm-8 4h10v-3l6 5-6 5v-3h-10v-4z"})})]}),e.jsx("p",{className:"mt-4 text-xs text-zinc-400 dark:text-zinc-500",children:"You will be redirected to Stripe to verify your business information."})]})]})});export{q as default};
