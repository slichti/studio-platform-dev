import{a as o,j as t,b5 as V,ah as z,a4 as J,$ as X,p as $,q,A as W,J as D,bS as F,bT as O}from"./vendor-react-D59Q0YKK.js";import{a as P}from"./api-D1U4i9fn.js";import"./vendor-puck-RN2Ey-av.js";import"./vendor-charts-Dp-zC2wb.js";var R="clover",B=function(e){return e===3?"v3":e},T="https://js.stripe.com",K="".concat(T,"/").concat(R,"/stripe.js"),M=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Y=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var H=function(e){return M.test(e)||Y.test(e)},Q=function(){for(var e=document.querySelectorAll('script[src^="'.concat(T,'"]')),r=0;r<e.length;r++){var s=e[r];if(H(s.src))return s}return null},L=function(e){var r="",s=document.createElement("script");s.src="".concat(K).concat(r);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(s),s},Z=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"8.6.1",startTime:r})},b=null,y=null,C=null,ee=function(e){return function(r){e(new Error("Failed to load Stripe.js",{cause:r}))}},te=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},re=function(e){return b!==null?b:(b=new Promise(function(r,s){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var n=Q();if(!(n&&e)){if(!n)n=L(e);else if(n&&C!==null&&y!==null){var i;n.removeEventListener("load",C),n.removeEventListener("error",y),(i=n.parentNode)===null||i===void 0||i.removeChild(n),n=L(e)}}C=te(r,s),y=ee(s),n.addEventListener("load",C),n.addEventListener("error",y)}catch(c){s(c);return}}),b.catch(function(r){return b=null,Promise.reject(r)}))},ne=function(e,r,s){if(e===null)return null;var n=r[0],i=n.match(/^pk_test/),c=B(e.version),u=R;i&&c!==u&&console.warn("Stripe.js@".concat(c," was loaded on the page, but @stripe/stripe-js@").concat("8.6.1"," expected Stripe.js@").concat(u,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var p=e.apply(void 0,r);return Z(p,s),p},g,A=!1,I=function(){return g||(g=re(null).catch(function(e){return g=null,Promise.reject(e)}),g)};Promise.resolve().then(function(){return I()}).catch(function(a){A||console.warn(a)});var se=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];A=!0;var n=Date.now();return I().then(function(i){return ne(i,r,n)})};function ae({token:a,slug:e,onApply:r,onRemove:s}){const[n,i]=o.useState(""),[c,u]=o.useState(!1),[p,m]=o.useState(null),[f,S]=o.useState(null),j=async()=>{if(n){u(!0),m(null);try{const l=await P(`/gift-cards/validate/${n}`,a,{headers:{"X-Tenant-Slug":e}});l.error?m(l.error):(S(l),r(l))}catch{m("Invalid or expired gift card code.")}finally{u(!1)}}},h=()=>{S(null),i(""),s()};return f?t.jsxs("div",{className:"flex items-center justify-between p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800 rounded-xl animate-in zoom-in-95",children:[t.jsxs("div",{className:"flex items-center gap-3 text-emerald-700 dark:text-emerald-400",children:[t.jsx(V,{size:18}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-bold",children:f.code}),t.jsxs("span",{className:"text-[10px] uppercase font-bold tracking-tighter opacity-70",children:["Applied: $",(f.balance/100).toFixed(2)," Credit"]})]})]}),t.jsx("button",{onClick:h,className:"p-1 hover:bg-emerald-100 dark:hover:bg-emerald-800 rounded text-emerald-600",children:t.jsx(z,{size:18})})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),t.jsx("input",{type:"text",placeholder:"Wanna use a Gift Card?",value:n,onChange:l=>i(l.target.value.toUpperCase()),className:"w-full pl-10 pr-24 py-3 bg-zinc-100 dark:bg-zinc-800 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none uppercase font-mono tracking-wider"}),t.jsx("button",{onClick:j,disabled:c||!n,className:"absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white text-xs font-bold rounded-xl disabled:opacity-50",children:c?t.jsx(X,{size:14,className:"animate-spin"}):"APPLY"})]}),p&&t.jsxs("p",{className:"text-[10px] text-red-500 font-bold uppercase tracking-tight ml-4 flex items-center gap-1",children:[t.jsx(z,{size:10})," ",p]})]})}const ie=se(void 0),ve=$(function(){const{token:e,packId:r,planId:s,giftCardAmount:n,recipientEmail:i,recipientName:c,senderName:u,message:p,slug:m}=q(),[f,S]=o.useState(null),[j,h]=o.useState(null),l=W(),[x,U]=o.useState(""),[oe,le]=o.useState(null),[_,N]=o.useState(!1),[ce,de]=o.useState("summary"),[ue,pe]=o.useState(null);o.useEffect(()=>{!r&&!n&&!s||!e||w()},[r,n,s,e,m]);const w=(v,E)=>{N(!0);const k={packId:r,planId:s,couponCode:v,giftCardAmount:n,recipientEmail:i,recipientName:c,senderName:u,message:p};E&&(k.giftCardCode=E),P("/commerce/checkout/session",e,{method:"POST",headers:{"X-Tenant-Slug":m},body:JSON.stringify(k)}).then(d=>{d.error?h(d.error):d.complete&&d.returnUrl?window.location.href=d.returnUrl:(S(d.clientSecret),h(null))}).catch(d=>{h(d.message||"Failed to initialize checkout.")}).finally(()=>N(!1))},G=async()=>{x&&w(x)};return j?t.jsxs("div",{className:"max-w-md mx-auto py-12 text-center",children:[t.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg mb-4",children:j}),t.jsx("button",{onClick:()=>l(-1),className:"text-blue-600 hover:underline",children:"Go Back"})]}):f?t.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4",children:[t.jsxs("button",{onClick:()=>l(-1),className:"flex items-center text-sm text-zinc-500 hover:text-zinc-900 mb-6",children:[t.jsx(D,{className:"h-4 w-4 mr-1"}),"Back"]}),t.jsx("div",{className:"mb-6 space-y-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm space-y-4",children:[t.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest pl-1",children:"Apply Promotion"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",placeholder:"Promo Code",className:"flex-1 border-none bg-zinc-100 rounded-xl px-4 py-3 text-sm uppercase font-mono outline-none focus:ring-2 focus:ring-blue-500",value:x,onChange:v=>U(v.target.value.toUpperCase())}),t.jsx("button",{onClick:G,disabled:_||!x,className:"bg-zinc-900 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-zinc-800 disabled:opacity-50 transition-all",children:"Apply"})]}),t.jsx("div",{className:"pt-2 border-t border-zinc-50",children:t.jsx(ae,{token:e,slug:m,onApply:v=>w(x,v.code),onRemove:()=>w(x)})})]})}),t.jsx("div",{id:"checkout",className:"bg-white p-6 rounded-lg shadow-sm border border-zinc-200",children:t.jsx(F,{stripe:ie,options:{clientSecret:f},children:t.jsx(O,{})})})]}):t.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});export{ve as default};
