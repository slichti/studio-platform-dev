import{w as U,d as F,f as K,c as M,r,L as _}from"./chunk-JMJ3UQ3L-CWn0lNw-.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as z}from"./api-LAgipKeK.js";import{C as l}from"./circle-check-l_2r6kE-.js";import{L as I}from"./loader-circle-DR2yIVz3.js";import{C as j}from"./calendar-D7iqKb7b.js";import{c as O}from"./createLucideIcon-C90dpDzR.js";import{A as Q}from"./arrow-left-5eQ59hYK.js";import{S as L}from"./search-BeLpSQIr.js";import{U as T}from"./users-PeBJPovi.js";import{U as X}from"./user-plus-bfqVdUHE.js";import{C as B}from"./circle-alert-Dwu3jEan.js";const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],A=O("circle",J),ne=U(function(){const{classes:N,token:u}=F(),{slug:d}=K(),{roles:k,isStudentView:D}=M(),[c,w]=r.useState(null),[y,b]=r.useState([]),[E,v]=r.useState(!1),[o,f]=r.useState(""),[n,$]=r.useState(!1),[x,g]=r.useState(null);r.useEffect(()=>{c&&H(c.id)},[c]);const H=async t=>{v(!0);try{const s=await z(`/classes/${t}/bookings`,u,{headers:{"X-Tenant-Slug":d}});b(s||[])}catch{alert("Failed to load roster")}finally{v(!1)}},C=async t=>{const s=!t.checkedInAt;b(p=>p.map(i=>i.id===t.id?{...i,checkedInAt:s?new Date:null}:i));try{await z(`/classes/${c.id}/bookings/${t.id}/check-in`,u,{method:"PATCH",headers:{"X-Tenant-Slug":d},body:JSON.stringify({checkedIn:s})})}catch{alert("Check-in failed. Please try again."),b(i=>i.map(m=>m.id===t.id?{...m,checkedInAt:s?null:new Date}:m))}};r.useEffect(()=>{if(n&&x?.type==="success"){const t=setTimeout(()=>{g(null),f("")},3e3);return()=>clearTimeout(t)}},[x,n]);const P=async t=>{if(t.checkedInAt){g({message:"Already checked in!",type:"error"});return}await C(t),g({message:`Welcome, ${t.user.profile?.firstName}!`,type:"success"})};if(D||!k.includes("instructor")&&!k.includes("owner")){const[t,s]=r.useState([]),[p,i]=r.useState(!0);r.useEffect(()=>{(async()=>{i(!0);try{const h=await z("/members/me/bookings",u,{headers:{"X-Tenant-Slug":d}});s(h.bookings||[])}catch(h){console.error("Failed into fetch history",h)}finally{i(!1)}})()},[u,d]);const m=t.filter(a=>a.status==="confirmed"&&a.checkedInAt).length,R=t.filter(a=>a.status==="confirmed"&&new Date(a.class.startTime)>new Date).length;return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",children:[e.jsx(l,{className:"text-emerald-500",size:32}),"Attendance History"]}),e.jsx("p",{className:"text-zinc-500 mt-2",children:"Track your class attendance and upcoming sessions."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"text-sm font-bold text-zinc-500 uppercase tracking-widest mb-1",children:"Classes Attended"}),e.jsx("div",{className:"text-4xl font-black text-emerald-600",children:m})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e.jsx("div",{className:"text-sm font-bold text-zinc-500 uppercase tracking-widest mb-1",children:"Upcoming Classes"}),e.jsx("div",{className:"text-4xl font-black text-blue-600",children:R})]})]}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-zinc-900 dark:text-zinc-100",children:"Your Classes"}),p?e.jsxs("div",{className:"p-12 text-center text-zinc-400",children:[e.jsx(I,{className:"animate-spin mx-auto h-8 w-8 mb-2"}),"Loading history..."]}):t.length===0?e.jsxs("div",{className:"p-12 text-center bg-zinc-50 dark:bg-zinc-900 rounded-2xl border border-dashed border-zinc-200 dark:border-zinc-800",children:[e.jsx(j,{className:"mx-auto h-12 w-12 text-zinc-300 mb-4"}),e.jsx("h3",{className:"text-zinc-900 dark:text-zinc-100 font-bold mb-1",children:"No classes yet"}),e.jsx("p",{className:"text-sm text-zinc-500 mb-4",children:"You haven't booked any classes yet."}),e.jsx(_,{to:`/studio/${d}/classes`,className:"inline-block px-6 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 font-bold rounded-lg hover:opacity-90 transition-opacity",children:"Book a Class"})]}):e.jsx("div",{className:"space-y-4",children:t.map(a=>{const h=new Date(a.class.startTime)<new Date,S=a.status==="cancelled";return e.jsxs("div",{className:`bg-white dark:bg-zinc-900 p-6 rounded-2xl border ${S?"border-red-200 bg-red-50/50 opacity-75":"border-zinc-200 dark:border-zinc-800"} shadow-sm flex flex-col md:flex-row md:items-center gap-6`,children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center justify-center w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-2xl",children:[e.jsx("span",{className:"text-xs font-bold text-zinc-500 uppercase",children:new Date(a.class.startTime).toLocaleDateString([],{month:"short"})}),e.jsx("span",{className:"text-2xl font-black text-zinc-900 dark:text-zinc-100",children:new Date(a.class.startTime).getDate()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-1",children:a.class.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(j,{size:14}),new Date(a.class.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),a.class.location&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(A,{size:8,className:"fill-current text-zinc-300"}),a.class.location.name]})]})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:S?e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold uppercase tracking-wider",children:"Cancelled"}):a.checkedInAt?e.jsxs("span",{className:"flex items-center gap-2 text-emerald-600 font-bold",children:[e.jsx(l,{size:18}),"Checked In"]}):h?e.jsx("span",{className:"text-zinc-400 font-medium text-sm",children:"Completed"}):e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold uppercase tracking-wider",children:"Upcoming"})})]},a.id)})})]})}if(c){const t=y.filter(s=>s.user.email.toLowerCase().includes(o.toLowerCase())||JSON.stringify(s.user.profile).toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{className:"flex flex-col h-screen bg-white dark:bg-zinc-950",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center gap-4 bg-zinc-50 dark:bg-zinc-900/50 sticky top-0 z-10",children:[e.jsx("button",{onClick:()=>w(null),className:"p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(Q,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-bold truncate text-zinc-900 dark:text-zinc-100",children:c.title}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[new Date(c.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," • ",c.location?.name||"Studio Main"]})]})]}),e.jsx("button",{onClick:()=>$(!n),className:`px-4 py-2 rounded-lg text-sm font-bold border transition-colors ${n?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-zinc-900 text-zinc-600 dark:text-zinc-400 border-zinc-200 dark:border-zinc-800"}`,children:n?"Exit Kiosk":"Kiosk Mode"}),n?e.jsx("div",{className:"flex-1 flex flex-col items-center justify-start pt-24 px-8 bg-zinc-50 dark:bg-zinc-950",children:e.jsxs("div",{className:"max-w-2xl w-full",children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-center text-zinc-900 dark:text-zinc-100 mb-8 tracking-tight",children:["Welcome to ",c.location?.name||"the Studio"]}),x?e.jsxs("div",{className:`p-12 rounded-3xl text-center animate-in fade-in zoom-in duration-300 ${x.type==="success"?"bg-emerald-500 text-white":"bg-red-500 text-white"}`,children:[e.jsx(l,{size:64,className:"mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold",children:x.message}),e.jsx("p",{className:"mt-2 opacity-80 uppercase tracking-widest font-medium text-sm",children:"Enjoy your class!"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-6 top-1/2 -translate-y-1/2 h-8 w-8 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Enter your name...",value:o,onChange:s=>f(s.target.value),className:"w-full pl-20 pr-8 py-8 bg-white dark:bg-zinc-900 border-2 border-zinc-200 dark:border-zinc-800 rounded-3xl text-3xl font-bold focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none shadow-xl",autoFocus:!0})]}),o.length>1&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[t.map(s=>e.jsxs("button",{onClick:()=>P(s),className:"w-full flex items-center justify-between p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border-b border-zinc-100 dark:border-zinc-800 last:border-0 transition-colors text-left",children:[e.jsxs("span",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:[s.user.profile?.firstName," ",s.user.profile?.lastName]}),s.checkedInAt?e.jsxs("span",{className:"text-emerald-500 font-bold flex items-center gap-2",children:[e.jsx(l,{})," Checked In"]}):e.jsx("span",{className:"bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm",children:"Check In"})]},s.id)),t.length===0&&e.jsx("div",{className:"p-8 text-center text-zinc-400",children:"No students found."})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-white dark:bg-zinc-950 sticky top-[73px] z-10 border-b border-zinc-100 dark:border-zinc-800",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Find student...",value:o,onChange:s=>f(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-zinc-100 dark:bg-zinc-900 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pb-24",children:E&&y.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-400",children:[e.jsx(I,{className:"animate-spin mx-auto h-8 w-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"Loading Roster..."})]}):e.jsxs("div",{className:"divide-y divide-zinc-50 dark:divide-zinc-900",children:[t.map(s=>e.jsxs("button",{onClick:()=>C(s),className:"w-full flex items-center gap-4 p-4 active:bg-zinc-50 dark:active:bg-zinc-900 transition-colors text-left group",children:[e.jsx("div",{className:"flex-shrink-0",children:s.checkedInAt?e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 rounded-full",children:e.jsx(l,{size:24})}):e.jsx("div",{className:"p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 rounded-full group-hover:bg-blue-50 group-hover:text-blue-500 transition-colors",children:e.jsx(A,{size:24})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-bold text-zinc-900 dark:text-zinc-100 truncate",children:[s.user.profile?.firstName||"Student"," ",s.user.profile?.lastName||""]}),e.jsxs("div",{className:"text-xs text-zinc-500 flex items-center gap-2 mt-0.5",children:[s.status==="confirmed"?e.jsx("span",{className:"text-emerald-500 font-bold uppercase tracking-tighter text-[9px]",children:"Reserved"}):e.jsx("span",{className:"text-amber-500 font-bold uppercase tracking-tighter text-[9px]",children:s.status}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.user.email})]}),s.paymentMethod==="drop_in"&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-red-600 bg-red-100 px-1.5 py-0.5 rounded",children:"Unpaid / Pay at Door"})})]}),e.jsx("div",{className:"flex-shrink-0",children:s.checkedInAt?e.jsxs("span",{className:"text-[10px] text-zinc-400 font-medium",children:["Checked in ",new Date(s.checkedInAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):e.jsx("span",{className:"text-[10px] text-blue-600 font-bold bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded",children:"CHECK IN"})})]},s.id)),t.length===0&&e.jsxs("div",{className:"p-12 text-center text-zinc-400",children:[e.jsx(T,{className:"mx-auto h-12 w-12 mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"No students booked yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Bookings for this class will appear here."})]})]})}),e.jsx("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-950 flex gap-4 sticky bottom-0 shadow-2xl",children:e.jsxs("button",{className:"flex-1 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform",children:[e.jsx(X,{size:20}),"Quick Add Student"]})})]})]})}return e.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 pb-12",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e.jsx(l,{className:"text-blue-600"})," Instructor Check-in"]}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Select today's session to start checking in students."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.length>0?N.map(t=>e.jsxs("button",{onClick:()=>w(t),className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all text-left group shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg text-blue-600 group-hover:scale-110 transition-transform",children:e.jsx(j,{size:20})}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-zinc-400 bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded",children:new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-zinc-900 dark:text-zinc-100 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight mb-1",children:t.title}),e.jsxs("p",{className:"text-xs text-zinc-500 flex items-center gap-1.5 mt-1",children:[e.jsx(T,{size:12}),t.confirmedCount||0," students booked"]})]}),e.jsxs("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-800 flex items-center gap-2 text-blue-600 text-xs font-bold uppercase tracking-wider",children:["Start Check-in",e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"})]})]},t.id)):e.jsxs("div",{className:"col-span-full py-24 text-center bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-200 dark:border-zinc-800 border-dashed",children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-zinc-300 mb-4"}),e.jsx("h3",{className:"text-zinc-500 font-bold mb-1",children:"No Classes Today"}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Enjoy your day off! Classes will appear here automatically."})]})})]})})});export{ne as default};
