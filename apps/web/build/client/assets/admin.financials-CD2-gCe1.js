import{w as z,d as y,r as o}from"./chunk-JMJ3UQ3L-CD8Ifjmd.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a as g}from"./api-LAgipKeK.js";import{P as w}from"./PrivacyBlur-DCeFAFUq.js";import{R as S}from"./refresh-cw-C36tlw8g.js";import{D as C}from"./dollar-sign-lz-3mXGD.js";import{C as c}from"./circle-check-big-n7iyB6n2.js";import{C as x}from"./circle-alert-B2Iq9U-7.js";import"./createLucideIcon-B1hucShu.js";const O=z(function(){const{preview:f,error:m,token:h}=y(),[l,v]=o.useState(f),[d,r]=o.useState(!1),[t,p]=o.useState(null),j=async()=>{r(!0);try{const s=await g("/admin/billing/preview",h);v(s),p(null)}catch(s){console.error(s)}finally{r(!1)}},N=async()=>{if(confirm(`Are you sure you want to invoice ${l?.count} tenants for a total of $${u}?`)){r(!0);try{const s=await g("/admin/billing/charge",h,{method:"POST"});p(s),setTimeout(j,1e3)}catch(s){alert("Charge failed: "+s.message)}finally{r(!1)}}},i=l?.tenants||[],u=i.reduce((s,a)=>s+a.total,0).toFixed(2),n=l?.fees||{sms:.0075,email:6e-4,streaming:.05,storage:.02};return m?e.jsxs("div",{className:"p-8 text-red-600",children:["Error loading billing data: ",m]}):e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Financials & Chargebacks"}),e.jsx("p",{className:"text-zinc-500",children:"Review usage and invoice tenants for subscriptions and overages."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:j,disabled:d,className:"px-4 py-2 border border-zinc-200 bg-white rounded-lg hover:bg-zinc-50 text-zinc-600 flex items-center gap-2",children:[e.jsx(S,{size:16,className:d?"animate-spin":""}),"Refresh Preview"]}),e.jsxs("button",{onClick:N,disabled:d||i.length===0,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(C,{size:16}),"Invoice ",i.length," Tenants"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 mb-1",children:"Projected Total Revenue"}),e.jsx("div",{className:"text-3xl font-bold text-zinc-900",children:e.jsxs(w,{revealed:!0,children:["$",u]})}),e.jsxs("div",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e.jsx(c,{size:12})," Ready to invoice"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 mb-1",children:"Active Tenants"}),e.jsx("div",{className:"text-3xl font-bold text-zinc-900",children:i.length}),e.jsx("div",{className:"text-xs text-zinc-400 mt-2",children:"Managed by platform"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-500 mb-1",children:"Fee Schedule"}),e.jsxs("div",{className:"text-sm space-y-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between border-b border-zinc-50 pb-1 mb-1",children:[e.jsx("span",{className:"text-zinc-500",children:"Service Fee"})," ",e.jsx("span",{className:"font-mono",children:n.applicationFeePercent?`${n.applicationFeePercent*100}%`:"Var"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"SMS"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.sms]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Email"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.email]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Stream"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.streaming,"/min"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Storage"})," ",e.jsxs("span",{className:"font-mono",children:["$",n.storage,"/GB"]})]})]})]})]}),t&&e.jsxs("div",{className:`mb-8 p-4 rounded-lg border ${t.success?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[t.success?e.jsx(c,{size:18}):e.jsx(x,{size:18}),t.success?"Invoicing Complete":"Invoicing Failed"]}),e.jsxs("div",{className:"mt-2 text-sm",children:[t.success?e.jsxs("p",{children:["Successfully processed ",t.charged," invoices."]}):e.jsx("p",{children:t.error}),t.details&&e.jsx("ul",{className:"mt-2 list-disc list-inside opacity-80 h-32 overflow-y-auto",children:t.details.map((s,a)=>e.jsx("li",{children:s.error?e.jsxs("span",{className:"text-red-600 font-medium",children:["Failed: ",s.tenantId," - ",s.error]}):e.jsxs("span",{children:["Charged ",s.name,": $",s.total.toFixed(2)," (",s.items.length," items)"]})},a))})]})]}),e.jsxs("div",{className:"bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-200 bg-zinc-50 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-zinc-900",children:"Billing Preview"}),e.jsx("span",{className:"text-xs text-zinc-500",children:"Including Base Subscription + Usage Overages"})]}),i.length===0?e.jsxs("div",{className:"p-12 text-center text-zinc-500",children:[e.jsx(c,{size:48,className:"mx-auto text-green-500 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium text-zinc-900",children:"All Clear"}),e.jsx("p",{className:"max-w-sm mx-auto mt-1",children:"No active tenants found."})]}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Tenant"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Base Plan"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Usage Breakdown"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:i.map(s=>e.jsxs("tr",{className:"hover:bg-zinc-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-zinc-900",children:s.tenant.name}),e.jsx("div",{className:"text-zinc-500 text-xs font-mono",children:s.tenant.slug}),s.tenant.stripeCustomerId?e.jsxs("div",{className:"text-[10px] text-green-600 mt-1 flex items-center gap-1",children:[e.jsx(c,{size:10})," Stripe Connected"]}):e.jsxs("div",{className:"text-[10px] text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(x,{size:10})," No Billing ID"]})]}),e.jsx("td",{className:"px-6 py-4",children:s.subscription&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:s.subscription.name}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["$",s.subscription.amount.toFixed(2),"/mo"]})]})}),e.jsx("td",{className:"px-6 py-4",children:Object.entries(s.costs).length===0?e.jsx("span",{className:"text-xs text-zinc-400 italic",children:"No usage overages"}):e.jsx("div",{className:"space-y-1 text-sm",children:Object.entries(s.costs).map(([a,b])=>e.jsxs("div",{className:"flex justify-between max-w-[200px]",children:[e.jsxs("span",{className:"text-zinc-600 capitalize",children:[a,":"]}),e.jsxs("span",{className:"font-mono text-zinc-700",children:[Math.round(b.quantity).toLocaleString()," units ($",b.amount.toFixed(2),")"]})]},a))})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"font-bold text-zinc-900",children:["$",s.total.toFixed(2)]})})]},s.tenant.id))})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 text-blue-800 rounded-lg text-sm border border-blue-100 flex gap-3",children:[e.jsx(x,{className:"shrink-0 mt-0.5",size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"Note on Invoicing:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1 opacity-90 ml-1",children:[e.jsxs("li",{children:['The "Invoice" button generates standard Stripe Invoice Items for ',e.jsx("strong",{children:"Usage Overages"}),"."]}),e.jsxs("li",{children:["Base Plan fees are typically handled automatically by Stripe Subscriptions if configured. The total above is a ",e.jsx("em",{children:"projection"})," of comprehensive revenue."]}),e.jsx("li",{children:"Verify Stripe Subscription status before manual invoicing to avoid double-charging base fees."})]})]})]})]})});export{O as default};
