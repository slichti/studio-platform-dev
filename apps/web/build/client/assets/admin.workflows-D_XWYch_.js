import{w as ge,u as ve,i as je}from"./chunk-JMJ3UQ3L-D6qeZyod.js";import{r as O,j as e}from"./vendor-puck-C9fWOLBg.js";import{a as l,R as u}from"./vendor-sentry-D-95zPX-.js";import{D as w,a as N,b as $,c as S,d as C,e as ye,f as _}from"./dialog-CHQa-eHw.js";import{B as ke}from"./Badge-DALDdFOB.js";import{C as ze}from"./chevron-down-B2-EuMjX.js";import{Z as we,V as Ne,u as $e,N as Se,$ as Ce,a as Ee,w as Te,e as Pe,s as De}from"./use-resolve-button-type-D73xopmD.js";import{o as g,p as A,m as Fe,Y as Ie,M as Me,H as Re,K as L,a as Ve,b as Oe,y as _e,w as Ae,n as Le,V as We,c as M}from"./portal-Df2iCaL2.js";import{f as W,s as B}from"./dialog-cwkY5uEM.js";import{P as Be}from"./plus-D93jR3m4.js";import{C as R}from"./clock-D3CFaJWx.js";import{P as He}from"./pencil-zfLpf3IY.js";import{T as qe}from"./trash-2-BbVhgg9k.js";import{C as Ue}from"./circle-alert-pAgs5ImP.js";import{c as H}from"./createLucideIcon-Qes_Sb9D.js";import{U as Ge}from"./user-plus-DV3x9HkY.js";import"./x-BU15ymJc.js";import"./vendor-charts-6YCMhHKl.js";const Ke=[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]],Je=H("cake",Ke);const Xe=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Ye=H("calendar-clock",Xe);function Ze(t,n,r){let[i,a]=l.useState(r),o=t!==void 0,d=l.useRef(o),s=l.useRef(!1),c=l.useRef(!1);return o&&!d.current&&!s.current?(s.current=!0,d.current=o,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!o&&d.current&&!c.current&&(c.current=!0,d.current=o,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[o?t:i,g(f=>(o||O.flushSync(()=>a(f)),n?.(f)))]}function Qe(t){let[n]=l.useState(t);return n}function q(t={},n=null,r=[]){for(let[i,a]of Object.entries(t))G(r,U(n,i),a);return r}function U(t,n){return t?t+"["+n+"]":n}function G(t,n,r){if(Array.isArray(r))for(let[i,a]of r.entries())G(t,U(n,i.toString()),a);else r instanceof Date?t.push([n,r.toISOString()]):typeof r=="boolean"?t.push([n,r?"1":"0"]):typeof r=="string"?t.push([n,r]):typeof r=="number"?t.push([n,`${r}`]):r==null?t.push([n,""]):tt(r)&&!l.isValidElement(r)&&q(r,n,t)}function et(t){var n,r;let i=(n=t?.form)!=null?n:t.closest("form");if(i){for(let a of i.elements)if(a!==t&&(a.tagName==="INPUT"&&a.type==="submit"||a.tagName==="BUTTON"&&a.type==="submit"||a.nodeName==="INPUT"&&a.type==="image")){a.click();return}(r=i.requestSubmit)==null||r.call(i)}}function tt(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let n=Object.getPrototypeOf(t);return n===null||Object.getPrototypeOf(n)===null}let rt=l.createContext(null);function nt({children:t}){let n=l.useContext(rt);if(!n)return u.createElement(u.Fragment,null,t);let{target:r}=n;return r?O.createPortal(u.createElement(u.Fragment,null,t),r):null}function st({data:t,form:n,disabled:r,onReset:i,overrides:a}){let[o,d]=l.useState(null),s=A();return l.useEffect(()=>{if(i&&o)return s.addEventListener(o,"reset",i)},[o,n,i]),u.createElement(nt,null,u.createElement(it,{setForm:d,formId:n}),q(t).map(([c,f])=>u.createElement(W,{features:B.Hidden,...Fe({key:c,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:n,disabled:r,name:c,value:f,...a})})))}function it({setForm:t,formId:n}){return l.useEffect(()=>{if(n){let r=document.getElementById(n);r&&t(r)}},[t,n]),n?null:u.createElement(W,{features:B.Hidden,as:"input",type:"hidden",hidden:!0,readOnly:!0,ref:r=>{if(!r)return;let i=r.closest("form");i&&t(i)}})}let P=l.createContext(null);P.displayName="GroupContext";let at=l.Fragment;function lt(t){var n;let[r,i]=l.useState(null),[a,o]=Ne(),[d,s]=Re(),c=l.useMemo(()=>({switch:r,setSwitch:i}),[r,i]),f={},k=t,v=L();return u.createElement(s,{name:"Switch.Description",value:d},u.createElement(o,{name:"Switch.Label",value:a,props:{htmlFor:(n=c.switch)==null?void 0:n.id,onClick(j){r&&(Ve(j.currentTarget)&&j.preventDefault(),r.click(),r.focus({preventScroll:!0}))}}},u.createElement(P.Provider,{value:c},v({ourProps:f,theirProps:k,slot:{},defaultTag:at,name:"Switch.Group"}))))}let ot="button";function ct(t,n){var r;let i=l.useId(),a=$e(),o=Oe(),{id:d=a||`headlessui-switch-${i}`,disabled:s=o||!1,checked:c,defaultChecked:f,onChange:k,name:v,value:j,form:J,autoFocus:z=!1,...X}=t,D=l.useContext(P),[Y,Z]=l.useState(null),Q=l.useRef(null),ee=_e(Q,n,D===null?null:D.setSwitch,Z),x=Qe(f),[y,b]=Ze(c,k,x??!1),te=A(),[re,F]=l.useState(!1),I=g(()=>{F(!0),b?.(!y),te.nextFrame(()=>{F(!1)})}),ne=g(m=>{if(De(m.currentTarget))return m.preventDefault();m.preventDefault(),I()}),se=g(m=>{m.key===M.Space?(m.preventDefault(),I()):m.key===M.Enter&&et(m.currentTarget)}),ie=g(m=>m.preventDefault()),ae=Se(),le=Ae(),{isFocusVisible:oe,focusProps:ce}=Ce({autoFocus:z}),{isHovered:de,hoverProps:ue}=Ee({isDisabled:s}),{pressed:me,pressProps:fe}=Te({disabled:s}),he=Le({checked:y,disabled:s,hover:de,focus:oe,active:me,autofocus:z,changing:re}),pe=We({id:d,ref:ee,role:"switch",type:Pe(t,Y),tabIndex:t.tabIndex===-1?0:(r=t.tabIndex)!=null?r:0,"aria-checked":y,"aria-labelledby":ae,"aria-describedby":le,disabled:s||void 0,autoFocus:z,onClick:ne,onKeyUp:se,onKeyPress:ie},ce,ue,fe),xe=l.useCallback(()=>{if(x!==void 0)return b?.(x)},[b,x]),be=L();return u.createElement(u.Fragment,null,v!=null&&u.createElement(st,{disabled:s,data:{[v]:j||"on"},overrides:{type:"checkbox",checked:y},form:J,onReset:xe}),be({ourProps:pe,theirProps:X,slot:he,defaultTag:ot,name:"Switch"}))}let dt=Ie(ct),ut=lt,mt=we,ft=Me,ht=Object.assign(dt,{Group:ut,Label:mt,Description:ft});const h=l.forwardRef(({className:t="",variant:n="default",size:r="default",...i},a)=>{let o="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300";const d={default:"bg-zinc-900 text-zinc-50 hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",destructive:"bg-red-500 text-zinc-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",outline:"border border-zinc-200 bg-white hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",secondary:"bg-zinc-100 text-zinc-900 hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",ghost:"hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",link:"text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"},s={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"};return o+=` ${d[n]||d.default}`,o+=` ${s[r]||s.default}`,t&&(o+=` ${t}`),e.jsx("button",{className:o,ref:a,...i})});h.displayName="Button";const E=l.forwardRef(({className:t="",type:n,...r},i)=>e.jsx("input",{type:n,className:`flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${t}`,ref:i,...r}));E.displayName="Input";const p=l.forwardRef(({className:t="",...n},r)=>e.jsx("label",{ref:r,className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${t}`,...n}));p.displayName="Label";const T=l.forwardRef(({className:t="",children:n,...r},i)=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:`appearance-none flex h-10 w-full items-center justify-between rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300 ${t}`,ref:i,...r,children:n}),e.jsx(ze,{className:"absolute right-3 top-3 h-4 w-4 opacity-50 pointer-events-none"})]}));T.displayName="Select";const K=l.forwardRef(({className:t="",...n},r)=>e.jsx("textarea",{className:`flex min-h-[80px] w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300 ${t}`,ref:r,...n}));K.displayName="Textarea";function pt({checked:t,onCheckedChange:n,disabled:r,className:i=""}){return e.jsx(ht,{checked:t,onChange:n,disabled:r,className:`${t?"bg-zinc-900 dark:bg-zinc-50":"bg-zinc-200 dark:bg-zinc-800"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 dark:focus-visible:ring-zinc-300 dark:focus-visible:ring-offset-zinc-950 ${i}`,children:e.jsx("span",{className:`${t?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})}const It=ge(function(){const{automations:n}=ve(),r=je(),[i,a]=l.useState(!1),o=s=>{switch(s){case"birthday":return e.jsx(Je,{className:"text-pink-500"});case"new_student":return e.jsx(Ge,{className:"text-emerald-500"});case"absent":return e.jsx(Ye,{className:"text-amber-500"});case"trial_ending":return e.jsx(Ue,{className:"text-indigo-500"});default:return e.jsx(R,{className:"text-blue-500"})}},d=s=>s.timingType==="immediate"?"Sends Immediately":s.timingType==="delay"?`Wait ${s.timingValue} hours`:s.timingType==="before"?`${s.timingValue} hours Before`:s.timingType==="after"?`${s.timingValue} hours After`:"Custom Schedule";return e.jsxs("div",{className:"max-w-5xl mx-auto pb-20 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Marketing Workflows"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Automate your student communication lifecycle."})]}),e.jsxs(w,{open:i,onOpenChange:a,children:[e.jsx(N,{asChild:!0,children:e.jsxs(h,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," New Workflow"]})}),e.jsxs($,{className:"sm:max-w-lg",children:[e.jsx(S,{children:e.jsx(C,{children:"Create Workflow"})}),e.jsx(V,{onSubmit:s=>{s.append("_action","create"),r.submit(s,{method:"post"}),a(!1)}})]})]})]}),e.jsx("div",{className:"grid gap-4",children:n.map(s=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6 flex flex-col sm:flex-row sm:items-center gap-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-3 bg-zinc-50 dark:bg-zinc-800 rounded-full shrink-0",children:o(s.triggerEvent)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100",children:s.subject}),e.jsx(ke,{variant:s.isEnabled?"default":"outline",children:s.isEnabled?"Active":"Paused"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),d(s)]}),e.jsxs("span",{className:"capitalize px-2 py-0.5 bg-zinc-100 dark:bg-zinc-800 rounded text-xs",children:["Trigger: ",s.triggerEvent.replace("_"," ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 sm:pt-0 border-t sm:border-0 border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{htmlFor:`toggle-${s.id}`,className:"sr-only",children:"Enable"}),e.jsx(pt,{checked:s.isEnabled,onCheckedChange:c=>{r.submit({_action:"update",id:s.id,isEnabled:String(c)},{method:"post"})}})]}),e.jsxs(w,{children:[e.jsx(N,{asChild:!0,children:e.jsxs(h,{variant:"outline",children:[e.jsx(He,{className:"w-4 h-4 mr-2"})," Edit"]})}),e.jsxs($,{className:"sm:max-w-lg",children:[e.jsx(S,{children:e.jsxs(C,{children:['Edit "',s.subject,'"']})}),e.jsx(V,{initialData:s,onSubmit:c=>{c.append("_action","update"),c.append("id",s.id),r.submit(c,{method:"post"})}})]})]}),e.jsxs(w,{children:[e.jsx(N,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"text-zinc-400 hover:text-red-500 hover:bg-zinc-100",children:e.jsx(qe,{className:"w-4 h-4"})})}),e.jsxs($,{children:[e.jsxs(S,{children:[e.jsx(C,{children:"Delete Workflow?"}),e.jsx(ye,{children:"This action cannot be undone. Typically we recommend pausing instead."})]}),e.jsx(_,{children:e.jsx(h,{variant:"destructive",onClick:()=>{r.submit({_action:"delete",id:s.id},{method:"post"})},children:"Delete"})})]})]})]})]},s.id))})]})});function V({initialData:t,onSubmit:n}){const r=i=>{i.preventDefault();const a=new FormData(i.currentTarget);n(a)};return e.jsxs("form",{onSubmit:r,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Trigger Event"}),e.jsxs(T,{name:"triggerEvent",defaultValue:t?.triggerEvent||"new_student",disabled:!!t,children:[e.jsx("option",{value:"new_student",children:"New Student Signup"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"absent",children:"Student Absent (Re-engage)"}),e.jsx("option",{value:"trial_ending",children:"Trial Ending Soon"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Timing"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{name:"timingType",defaultValue:t?.timingType||"immediate",className:"w-[140px]",children:[e.jsx("option",{value:"immediate",children:"Immediately"}),e.jsx("option",{value:"delay",children:"Wait (Delay)"}),e.jsx("option",{value:"before",children:"Before Event"}),e.jsx("option",{value:"after",children:"After Event"})]}),e.jsx(E,{name:"timingValue",type:"number",defaultValue:t?.timingValue||0,placeholder:"Hours",className:"w-20"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subject Line"}),e.jsx(E,{name:"subject",defaultValue:t?.subject,required:!0,placeholder:"e.g. Welcome to the family!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Email Content"}),e.jsx(K,{name:"content",defaultValue:t?.content,required:!0,placeholder:"Hello {firstname}...",className:"h-32 font-mono"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Supported variables: ","{firstname}",", ","{lastname}","."]})]}),e.jsx(_,{className:"mt-4",children:e.jsx(h,{type:"submit",children:"Save Workflow"})})]})}export{It as default};
