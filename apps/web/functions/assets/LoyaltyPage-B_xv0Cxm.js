import{jsxs as t,jsx as e}from"react/jsx-runtime";import{useLoaderData as h,useActionData as z,useOutletContext as f,Form as b}from"react-router";import{Award as c,Plus as k,Target as o,Trash2 as v,Gift as y}from"lucide-react";import{toast as N}from"sonner";import{useState as w,useEffect as C}from"react";function T(){const{challenges:m,error:u}=h(),a=z(),[p,l]=w(!1);C(()=>{a&&a.success&&(l(!1),N.success("Success!"))},[a]);const{me:s}=f(),g=s?.roles?.includes("owner")||s?.roles?.includes("admin")||s?.roles?.includes("instructor");return t("div",{className:"p-8 max-w-6xl mx-auto animate-in fade-in duration-500",children:[t("div",{className:"flex items-center justify-between mb-8",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(c,{className:"text-yellow-500"}),"Loyalty Challenges"]}),e("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Gamify attendance with challenges and rewards."})]}),g&&t("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg hover:opacity-90 transition-opacity font-medium shadow-sm",children:[e(k,{size:16}),"Create Challenge"]})]}),u&&e("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg mb-6 border border-red-100",children:u}),a&&a.error&&e("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg mb-6 border border-red-100",children:a.error}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[m.map(n=>{const i=n.userProgress||{},r=!!i.id,d=i.status==="completed"||i.progress>=n.targetValue,x=Math.min(100,Math.round(i.progress/n.targetValue*100));return t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group flex flex-col h-full",children:[t("div",{className:"flex justify-between items-start mb-4",children:[e("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg text-yellow-600 dark:text-yellow-400",children:e(o,{size:24})}),e("span",{className:`px-2 py-1 text-xs rounded-full font-medium ${n.active?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-zinc-100 text-zinc-500"}`,children:n.active?"Active":"Inactive"})]}),e("h3",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:n.title}),e("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-4 line-clamp-2 min-h-[40px] flex-1",children:n.description}),!r&&n.active&&t(b,{method:"post",className:"mb-4",children:[e("input",{type:"hidden",name:"intent",value:"join"}),e("input",{type:"hidden",name:"challengeId",value:n.id}),e("button",{type:"submit",className:"w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-sm text-sm",children:"Join Challenge"})]}),r&&t("div",{className:"mb-4 space-y-2",children:[t("div",{className:"flex justify-between text-xs font-semibold uppercase text-zinc-500 dark:text-zinc-400",children:[e("span",{children:"Progress"}),t("span",{children:[i.progress," / ",n.targetValue]})]}),e("div",{className:"h-2 w-full bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",children:e("div",{className:"h-full bg-blue-600 rounded-full transition-all duration-1000 ease-out",style:{width:`${x}%`}})}),d&&e("div",{className:"text-center mt-2",children:t("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-xs font-bold",children:[e(c,{size:12}),"Challenge Completed!"]})})]}),t("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 mt-auto",children:[t("div",{className:"flex items-center justify-between mb-2",children:[t("div",{className:"flex items-center gap-2",children:[e(o,{size:14,className:"text-zinc-400"}),e("span",{children:"Goal"})]}),t("span",{className:"font-medium",children:[n.targetValue," ",n.type==="count"?"Classes":n.type==="minutes"?"Min":"Days"]})]}),n.endDate&&t("div",{className:"flex items-center justify-between text-xs text-zinc-500",children:[e("span",{children:"Ends"}),e("span",{children:new Date(n.endDate).toLocaleDateString()})]})]})]},n.id)}),m.length===0&&t("div",{className:"col-span-full py-16 text-center border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl bg-zinc-50/50 dark:bg-zinc-900/20",children:[e("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-400",children:e(c,{size:32})}),e("h3",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"No active challenges"}),e("p",{className:"text-zinc-500 max-w-sm mx-auto mt-2 text-sm",children:"Check back later for new challenges!"})]})]}),p&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:t("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-in zoom-in-95 duration-200",children:[t("div",{className:"p-6 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:"New Challenge"}),e("button",{onClick:()=>l(!1),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 transition-colors",children:e(v,{size:20,className:"rotate-45"})})]}),t(b,{method:"post",className:"p-6 space-y-4",children:[e("input",{type:"hidden",name:"intent",value:"create"}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Title"}),e("input",{name:"title",required:!0,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",placeholder:"e.g. Summer Warrior"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Description"}),e("textarea",{name:"description",rows:3,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none",placeholder:"Attend 10 classes in June..."})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Goal Type"}),t("div",{className:"relative",children:[t("select",{name:"type",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",onChange:n=>{const i=n.target.value,r=document.getElementById("targetValue-group"),d=document.getElementById("streak-group");i==="streak"?(r&&(r.style.display="none"),d&&(d.style.display="grid")):(r&&(r.style.display="block"),d&&(d.style.display="none"))},children:[e("option",{value:"count",children:"Total Classes"}),e("option",{value:"minutes",children:"Total Minutes"}),e("option",{value:"streak",children:"Streak"})]}),e("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-500",children:e(o,{size:14})})]})]}),t("div",{id:"targetValue-group",children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Target Value"}),e("input",{name:"targetValue",type:"number",defaultValue:"10",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]})]}),t("div",{id:"streak-group",className:"hidden grid-cols-2 gap-4 p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-100 dark:border-zinc-800",children:[e("div",{className:"col-span-2 text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2",children:"Streak Settings"}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Frequency"}),e("input",{name:"frequency",type:"number",defaultValue:"3",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"}),e("p",{className:"text-xs text-zinc-500 mt-1",children:"Times per period"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Period"}),t("select",{name:"period",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[e("option",{value:"week",children:"Weekly"}),e("option",{value:"month",children:"Monthly"})]})]})]}),e("script",{dangerouslySetInnerHTML:{__html:`
                                document.querySelector('select[name="type"]').addEventListener('change', function(e) {
                                    const val = e.target.value;
                                    const streakGroup = document.getElementById('streak-group');
                                    const targetGroup = document.getElementById('targetValue-group');
                                    if(streakGroup && targetGroup) {
                                        if(val === 'streak') {
                                            streakGroup.classList.remove('hidden');
                                            streakGroup.classList.add('grid');
                                            targetGroup.classList.add('hidden');
                                        } else {
                                            streakGroup.classList.add('hidden');
                                            streakGroup.classList.remove('grid');
                                            targetGroup.classList.remove('hidden');
                                        }
                                    }
                                });
                             `}}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Reward Type"}),t("div",{className:"relative",children:[t("select",{name:"rewardType",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",onChange:n=>{const i=n.target.value,r=document.getElementById("credit-input");i==="retail_credit"&&r?r.classList.remove("hidden"):r&&r.classList.add("hidden")},children:[e("option",{value:"badge",children:"Digital Badge"}),e("option",{value:"coupon",children:"Discount Coupon"}),e("option",{value:"retail_credit",children:"Retail Credit"})]}),e("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-500",children:e(y,{size:14})})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"End Date"}),e("input",{name:"endDate",type:"date",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"})]})]}),t("div",{id:"credit-input",className:"hidden",children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Credit Amount ($)"}),e("input",{name:"creditAmount",type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",placeholder:"e.g. 50"})]}),t("div",{className:"pt-6 flex justify-end gap-3 border-t border-zinc-100 dark:border-zinc-800 mt-2",children:[e("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors font-medium text-sm",children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm shadow-blue-200 dark:shadow-none",children:"Create Challenge"})]})]})]})})]})}export{T as default};
