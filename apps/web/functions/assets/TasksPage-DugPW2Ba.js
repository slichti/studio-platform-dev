import{jsxs as i,jsx as t}from"react/jsx-runtime";import{useLoaderData as F}from"react-router";import{useState as l}from"react";import{M as L,g as X,a as p}from"./server-build-DYgJutU4.js";import{CheckCircle as w,Plus as T,Calendar as H,Trash2 as J}from"lucide-react";import{format as q}from"date-fns";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function ge(){const{initialTasks:D,me:b,token:m,slug:u}=F(),[h,g]=l(D),[C,s]=l(!1),[k,v]=l(!1),[x,z]=l("all"),[o,y]=l(null),[c,f]=l(null),[n,d]=l({title:"",description:"",priority:"medium",status:"todo",dueDate:"",assignedToId:b?.id||""}),S=async()=>{const e=await p("/tasks",m,{headers:{"X-Tenant-Slug":u}});g(e||[])},N=()=>{y(null),d({title:"",description:"",priority:"medium",status:"todo",dueDate:"",assignedToId:b?.id||""}),s(!0)},P=e=>{y(e),d({title:e.title,description:e.description||"",priority:e.priority,status:e.status,dueDate:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:"",assignedToId:e.assignedToId||""}),s(!0)},O=async e=>{e.preventDefault(),v(!0);try{const a=o?`/tasks/${o.id}`:"/tasks";await p(a,m,{method:o?"PATCH":"POST",headers:{"X-Tenant-Slug":u},body:JSON.stringify(n)}),await S(),s(!1)}catch(a){alert("Failed to save task: "+a.message)}finally{v(!1)}},A=e=>{f(e)},$=async()=>{if(c)try{await p(`/tasks/${c}`,m,{method:"DELETE",headers:{"X-Tenant-Slug":u}}),g(h.filter(e=>e.id!==c)),o?.id===c&&s(!1),f(null)}catch(e){console.error(e)}},j=async(e,a)=>{g(h.map(r=>r.id===e?{...r,status:a}:r));try{await p(`/tasks/${e}`,m,{method:"PATCH",headers:{"X-Tenant-Slug":u},body:JSON.stringify({status:a})})}catch(r){console.error(r)}},I=h.filter(e=>x==="mine"?e.assignedToId===b?.id:!0),M=e=>{switch(e){case"high":return"text-red-700 bg-red-50 border-red-200";case"medium":return"text-orange-700 bg-orange-50 border-orange-200";case"low":return"text-blue-700 bg-blue-50 border-blue-200";default:return"text-gray-700 bg-gray-50"}};return i("div",{className:"p-6 h-[calc(100vh-64px)] flex flex-col",children:[i("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[t("div",{children:i("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[t("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t(w,{size:24})}),"Tasks Board"]})}),i("div",{className:"flex gap-2 items-center",children:[i("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 rounded-lg p-1",children:[t("button",{onClick:()=>z("all"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${x==="all"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-300"}`,children:"All Tasks"}),t("button",{onClick:()=>z("mine"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${x==="mine"?"bg-white dark:bg-zinc-700 shadow-sm text-zinc-900 dark:text-zinc-100":"text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-300"}`,children:"My Tasks"})]}),i("button",{onClick:N,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-all hover:scale-105 active:scale-95",children:[t(T,{size:18}),"New Task"]})]})]}),t("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",children:t("div",{className:"flex gap-6 h-full min-w-[1000px]",children:[{id:"todo",title:"To Do",color:"bg-zinc-100 dark:bg-zinc-800/50",border:"border-zinc-200 dark:border-zinc-700"},{id:"in_progress",title:"In Progress",color:"bg-blue-50/50 dark:bg-blue-900/10",border:"border-blue-200 dark:border-blue-800"},{id:"done",title:"Done",color:"bg-green-50/50 dark:bg-green-900/10",border:"border-green-200 dark:border-green-800"}].map(e=>{const a=I.filter(r=>r.status===e.id);return i("div",{className:`flex-1 flex flex-col rounded-xl border ${e.border} ${e.color} backdrop-blur-sm min-w-[300px]`,children:[i("div",{className:"p-4 flex items-center justify-between border-b border-inherit",children:[i("h3",{className:"font-semibold text-zinc-700 dark:text-zinc-200 flex items-center gap-2",children:[e.title,t("span",{className:"bg-white/50 dark:bg-black/20 px-2 py-0.5 rounded-full text-xs",children:a.length})]}),e.id==="todo"&&t("button",{onClick:N,className:"text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200",children:t(T,{size:16})})]}),t("div",{className:"p-3 flex-1 overflow-y-auto space-y-3",children:a.map(r=>i("div",{onClick:()=>P(r),className:"bg-white dark:bg-zinc-800 p-4 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-700 hover:border-blue-400 dark:hover:border-blue-500 hover:shadow-md transition-all cursor-pointer group animate-in fade-in slide-in-from-bottom-2 duration-300",children:[i("div",{className:"flex justify-between items-start mb-2",children:[t("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border ${M(r.priority)}`,children:r.priority}),e.id!=="done"&&t("button",{onClick:E=>{E.stopPropagation(),j(r.id,"done")},className:"text-zinc-300 hover:text-green-500 opacity-0 group-hover:opacity-100 transition-opacity",title:"Mark as Done",children:t(w,{size:16})})]}),t("h4",{className:"font-medium text-zinc-900 dark:text-zinc-100 mb-1 leading-snug",children:r.title}),r.description&&t("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 line-clamp-2 mb-3",children:r.description}),t("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-zinc-100 dark:border-zinc-700/50",children:i("div",{className:"flex items-center gap-2",children:[r.assignee?.userProfile?.firstName&&t("div",{className:"w-5 h-5 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center text-[10px] font-bold",title:r.assignee.userProfile.firstName,children:r.assignee.userProfile.firstName[0]}),r.dueDate&&i("div",{className:`flex items-center gap-1 text-[10px] ${new Date(r.dueDate)<new Date&&r.status!=="done"?"text-red-500 font-bold":"text-zinc-400"}`,children:[t(H,{size:10}),q(new Date(r.dueDate),"MMM d")]})]})})]},r.id))})]},e.id)})})}),t(L,{isOpen:C,onClose:()=>s(!1),title:o?"Edit Task":"Create New Task",children:i("form",{onSubmit:O,className:"space-y-4",children:[i("div",{children:[t("label",{className:"block text-sm font-medium mb-1 dark:text-zinc-300",children:"Task Title"}),t("input",{required:!0,className:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none transition-all",value:n.title,onChange:e=>d({...n,title:e.target.value}),placeholder:"e.g. Follow up with John"})]}),i("div",{children:[t("label",{className:"block text-sm font-medium mb-1 dark:text-zinc-300",children:"Description"}),t("textarea",{className:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100 focus:ring-2 focus:ring-blue-500 outline-none transition-all h-24 resize-none",value:n.description,onChange:e=>d({...n,description:e.target.value}),placeholder:"Details about the task..."})]}),i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[t("label",{className:"block text-sm font-medium mb-1 dark:text-zinc-300",children:"Status"}),i("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",value:n.status,onChange:e=>d({...n,status:e.target.value}),children:[t("option",{value:"todo",children:"To Do"}),t("option",{value:"in_progress",children:"In Progress"}),t("option",{value:"done",children:"Done"})]})]}),i("div",{children:[t("label",{className:"block text-sm font-medium mb-1 dark:text-zinc-300",children:"Priority"}),i("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",value:n.priority,onChange:e=>d({...n,priority:e.target.value}),children:[t("option",{value:"low",children:"Low"}),t("option",{value:"medium",children:"Medium"}),t("option",{value:"high",children:"High"})]})]})]}),t("div",{className:"grid grid-cols-2 gap-4",children:i("div",{children:[t("label",{className:"block text-sm font-medium mb-1 dark:text-zinc-300",children:"Due Date"}),t("input",{type:"date",className:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700 dark:text-zinc-100",value:n.dueDate,onChange:e=>d({...n,dueDate:e.target.value})})]})}),i("div",{className:"flex gap-3 justify-end pt-6 border-t dark:border-zinc-700",children:[o&&i("button",{type:"button",onClick:()=>A(o.id),className:"px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg mr-auto flex items-center gap-2",children:[t(J,{size:16}),"Delete"]}),t("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg font-medium",children:"Cancel"}),t("button",{type:"submit",disabled:k,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50 shadow-sm hover:shadow active:scale-95 transition-all",children:k?"Saving...":o?"Save Changes":"Create Task"})]})]})}),t(X,{open:!!c,onOpenChange:e=>!e&&f(null),onConfirm:$,title:"Delete Task",description:"Are you sure you want to delete this task? This cannot be undone.",confirmText:"Delete",variant:"destructive"})]})}export{ge as default};
