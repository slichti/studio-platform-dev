import{jsxs as t,jsx as e,Fragment as m}from"react/jsx-runtime";import{useLoaderData as V,useActionData as M,useSubmit as A,useOutletContext as $,Form as k}from"react-router";import{useState as c,useEffect as F}from"react";import{Trophy as b,Plus as N,Flame as I,Medal as v,Clock as q,Target as w,Star as L,Calendar as R,Check as B,X as E}from"lucide-react";import{toast as y}from"sonner";function X(){const{challenges:h,myProgress:C,leaderboard:x}=V(),i=M();A();const[D,n]=c(!1),[d,T]=c("active"),[l,j]=c("count"),[u,S]=c("badge"),{me:s}=$()||{},p=s?.roles?.includes("owner")||s?.roles?.includes("admin")||s?.roles?.includes("instructor"),g=h.filter(r=>r.status==="active"),z=h.filter(r=>r.status!=="active"),P=r=>C.find(a=>a.challengeId===r),o=r=>new Date(r).toLocaleDateString(void 0,{month:"short",day:"numeric"});return F(()=>{i&&i.created&&(n(!1),y.success("Challenge created!")),i&&i.error&&y.error(i.error)},[i]),t("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-zinc-950",children:[t("header",{className:"bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-6 text-white",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center gap-3",children:[e("div",{className:"p-2 bg-white/20 rounded-lg",children:e(b,{size:24})}),t("div",{children:[e("h1",{className:"text-2xl font-bold",children:"Challenges"}),e("p",{className:"text-white/80",children:"Complete challenges and earn rewards"})]})]}),p&&t("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-medium transition-colors",children:[e(N,{size:18}),"Create Challenge"]})]}),e("div",{className:"flex gap-4 mt-6",children:["active","leaderboard","past"].map(r=>t("button",{onClick:()=>T(r),className:`px-4 py-2 rounded-lg font-medium transition ${d===r?"bg-white text-amber-600":"bg-white/20 text-white hover:bg-white/30"}`,children:[r==="active"&&t(m,{children:[e(I,{size:16,className:"inline mr-1"})," Active"]}),r==="leaderboard"&&t(m,{children:[e(v,{size:16,className:"inline mr-1"})," Leaderboard"]}),r==="past"&&t(m,{children:[e(q,{size:16,className:"inline mr-1"})," Past"]})]},r))})]}),t("div",{className:"flex-1 overflow-y-auto p-6",children:[d==="active"&&e("div",{className:"space-y-4",children:g.length===0?t("div",{className:"text-center py-12 text-zinc-500 dark:text-zinc-400",children:[e(w,{size:48,className:"mx-auto mb-4 opacity-50"}),e("p",{children:"No active challenges"}),p&&e("button",{onClick:()=>n(!0),className:"mt-4 text-amber-600 hover:text-amber-700 font-medium",children:"Create one now"})]}):g.map(r=>{const a=P(r.id),f=a?Math.min(100,a.currentValue/r.goal*100):0;return e("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-5 hover:shadow-md transition",children:t("div",{className:"flex items-start gap-4",children:[e("div",{className:"p-3 bg-amber-100 dark:bg-amber-900/30 rounded-xl",children:e(b,{size:24,className:"text-amber-600 dark:text-amber-400"})}),t("div",{className:"flex-1",children:[t("div",{className:"flex items-center justify-between",children:[e("h3",{className:"font-bold text-zinc-900 dark:text-zinc-100",children:r.title}),t("span",{className:"px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 rounded-full text-xs font-medium flex items-center gap-1",children:[e(L,{size:12})," ",r.rewardType==="badge"?"Badge":r.rewardType==="coupon"?"Coupon":"Credit"]})]}),e("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-1",children:r.description}),t("div",{className:"mt-3 flex items-center gap-4 text-xs text-zinc-500 dark:text-zinc-400",children:[t("span",{className:"flex items-center gap-1",children:[e(R,{size:12})," ",o(r.startDate)," - ",o(r.endDate)]}),t("span",{className:"flex items-center gap-1",children:[e(w,{size:12})," Goal: ",r.goal]})]}),a?t("div",{className:"mt-4",children:[t("div",{className:"flex justify-between text-xs mb-1",children:[t("span",{className:"font-medium text-zinc-700 dark:text-zinc-300",children:[a.currentValue," / ",r.goal]}),t("span",{className:"text-amber-600",children:[Math.round(f),"%"]})]}),e("div",{className:"h-2 bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden",children:e("div",{className:`h-full transition-all ${a.completed?"bg-green-500":"bg-amber-500"}`,style:{width:`${f}%`}})}),a.completed&&t("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[e(B,{size:12})," Completed!"]})]}):t(k,{method:"post",className:"mt-4",children:[e("input",{type:"hidden",name:"intent",value:"join"}),e("input",{type:"hidden",name:"challengeId",value:r.id}),e("button",{type:"submit",className:"px-4 py-2 bg-amber-500 text-white rounded-lg text-sm font-medium hover:bg-amber-600",children:"Join Challenge"})]})]})]})},r.id)})}),d==="leaderboard"&&t("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800",children:[e("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:t("h2",{className:"font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(v,{size:18})," Top Challengers"]})}),e("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:x.length===0?e("p",{className:"p-8 text-center text-zinc-500 dark:text-zinc-400",children:"No leaderboard data"}):x.slice(0,10).map((r,a)=>t("div",{className:"p-4 flex items-center gap-4",children:[e("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${a===0?"bg-amber-400 text-white":a===1?"bg-zinc-300 text-zinc-700":a===2?"bg-amber-600 text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500"}`,children:a+1}),t("div",{className:"flex-1",children:[e("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:r.user?.profile?.firstName||r.user?.email}),t("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:[r.completedCount," challenges completed"]})]}),t("div",{className:"text-lg font-bold text-amber-600",children:[r.totalPoints," pts"]})]},a))})]}),d==="past"&&e("div",{className:"space-y-4",children:z.length===0?e("p",{className:"text-center py-12 text-zinc-500 dark:text-zinc-400",children:"No past challenges"}):z.map(r=>e("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4 opacity-75",children:t("div",{className:"flex items-center gap-3",children:[e(b,{size:20,className:"text-zinc-400"}),t("div",{children:[e("h3",{className:"font-medium text-zinc-700 dark:text-zinc-300",children:r.title}),e("p",{className:"text-xs text-zinc-500",children:o(r.endDate)})]})]})},r.id))})]}),D&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:t("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[t("div",{className:"p-6 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center sticky top-0 bg-white dark:bg-zinc-900",children:[e("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:"Create Challenge"}),e("button",{onClick:()=>n(!1),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:e(E,{size:24})})]}),t(k,{method:"post",className:"p-6 space-y-5",children:[e("input",{type:"hidden",name:"intent",value:"create"}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Challenge Title"}),e("input",{name:"title",required:!0,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-amber-500 outline-none",placeholder:"e.g. Summer Fitness Challenge"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Description"}),e("textarea",{name:"description",rows:3,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-amber-500 outline-none resize-none",placeholder:"Describe what members need to do..."})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Goal Type"}),t("select",{name:"type",value:l,onChange:r=>j(r.target.value),className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[e("option",{value:"count",children:"Total Classes"}),e("option",{value:"minutes",children:"Total Minutes"}),e("option",{value:"streak",children:"Attendance Streak"})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:l==="streak"?"Streak Days":"Target Value"}),e("input",{name:"targetValue",type:"number",defaultValue:"10",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"})]})]}),l==="streak"&&t("div",{className:"grid grid-cols-2 gap-4 p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg",children:[t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Classes per"}),e("input",{name:"frequency",type:"number",defaultValue:"3",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Period"}),t("select",{name:"period",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[e("option",{value:"week",children:"Week"}),e("option",{value:"month",children:"Month"})]})]})]}),e("div",{className:"grid grid-cols-2 gap-4",children:t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Reward Type"}),t("select",{name:"rewardType",value:u,onChange:r=>S(r.target.value),className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[e("option",{value:"badge",children:"Digital Badge"}),e("option",{value:"coupon",children:"Discount Coupon"}),e("option",{value:"retail_credit",children:"Retail Credit"})]})]})}),u==="retail_credit"&&t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Credit Amount ($)"}),e("input",{name:"creditAmount",type:"number",min:"1",className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",placeholder:"e.g. 25"})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"Start Date"}),e("input",{name:"startDate",type:"date",defaultValue:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium mb-1.5 text-zinc-700 dark:text-zinc-300",children:"End Date"}),e("input",{name:"endDate",type:"date",required:!0,className:"w-full px-3 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100"})]})]}),t("div",{className:"pt-4 flex justify-end gap-3 border-t border-zinc-100 dark:border-zinc-800",children:[e("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg font-medium",children:"Cancel"}),t("button",{type:"submit",className:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 font-medium flex items-center gap-2",children:[e(N,{size:16}),"Create Challenge"]})]})]})]})})]})}export{X as default};
