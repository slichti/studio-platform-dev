import{jsxs as t,jsx as e,Fragment as x}from"react/jsx-runtime";import{useOutletContext as D,useNavigation as q,Form as f,Link as P}from"react-router";import{useState as m}from"react";import{Upload as U,FileText as E,AlertCircle as A,CheckCircle as B,Loader2 as k,ArrowRight as N,CheckCircle2 as M,X as R,Plus as O}from"lucide-react";import{a as L}from"./server-build-DYgJutU4.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function W({tenantSlug:z,onSuccess:T,onSkip:y}){const[r,s]=m(null),[u,w]=m(!1),[o,v]=m(null),[b,d]=m(null);return t("div",{className:"space-y-6",children:[t("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded text-sm",children:[e("p",{className:"font-semibold mb-1",children:"CSV Format Requirements:"}),t("ul",{className:"list-disc pl-5 space-y-1",children:[t("li",{children:["Headers: ",e("code",{children:"email"}),", ",e("code",{children:"firstname"}),", ",e("code",{children:"lastname"})]}),t("li",{children:["Membership: ",e("code",{children:"membership"})," (Plan Name)"]})]})]}),t("form",{onSubmit:async a=>{if(a.preventDefault(),!r){d("Please select a file.");return}w(!0),d(null),v(null);try{const p=await window.Clerk?.session?.getToken(),h=new FormData;h.append("file",r);const c=await L("/import/csv",p,{method:"POST",headers:{"X-Tenant-Slug":z},body:h});c.error?(d(c.error),c.details&&console.error(c.details)):v(c)}catch(p){d(p.message||"Upload failed.")}finally{w(!1)}},className:"space-y-6",children:[t("div",{className:"border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg p-8 flex flex-col items-center justify-center text-center hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e(U,{className:"h-10 w-10 text-zinc-400 mb-3"}),r?t("div",{className:"flex items-center gap-2 text-zinc-900 dark:text-zinc-100 font-medium",children:[e(E,{className:"h-5 w-5 text-blue-500"}),r.name]}):t("div",{children:[t("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e("span",{className:"text-blue-600 dark:text-blue-400 font-medium hover:text-blue-500",children:"Upload CSV"}),e("span",{className:"text-zinc-500",children:" or drag/drop"}),e("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:".csv",onChange:a=>{if(a.target.files&&a.target.files[0]){const p=a.target.files[0];s(p),d(null),v(null);const h=new FileReader;h.onload=c=>{const S=c.target?.result;if(!S)return;const j=S.split(/\r\n|\n/);if(j.length>0){const F=j[0].toLowerCase().split(",").map(l=>l.trim()),n=["email","firstname","lastname"].filter(l=>!F.includes(l));n.length>0&&(d(`Missing required headers: ${n.join(", ")}`),s(null))}},h.readAsText(p)}}})]}),e("p",{className:"text-xs text-zinc-500 mt-1",children:"Max 10MB"})]})]}),b&&t("div",{className:"flex items-start gap-2 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded",children:[e(A,{className:"h-5 w-5 shrink-0"}),e("span",{className:"text-sm",children:b})]}),o&&t("div",{className:"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 p-4 rounded border border-green-200 dark:border-green-800",children:[t("div",{className:"flex items-center gap-2 mb-2 font-semibold",children:[e(B,{className:"h-5 w-5"}),"Import Complete"]}),t("div",{className:"text-sm space-y-1",children:[t("p",{children:["Created: ",o.created,", Skipped: ",o.skipped]}),o.errors&&o.errors.length>0&&t("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:[o.errors.length," row errors (see logs)"]})]})]}),t("div",{className:"flex justify-between items-center pt-4",children:[y&&e("button",{type:"button",onClick:y,className:"text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200 text-sm font-medium",children:"Skip Import"}),o?e("button",{type:"button",onClick:T,className:"bg-green-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-green-700 transition flex items-center gap-2",children:"Continue"}):e("button",{type:"submit",disabled:!r||u,className:"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-6 py-2 rounded-xl font-bold hover:opacity-90 disabled:opacity-50 flex items-center gap-2 ml-auto",children:u?"Importing...":"Start Import"})]})]})]})}function be(){const{tenant:z}=D(),T=q(),y=z.settings?.onboardingStep||1,[r,s]=m(y),[u,w]=m("yoga"),[o,v]=m(""),[b,d]=m(!1),[g,C]=m([""]),a=T.state==="submitting",p=async i=>{d(!0);try{const n=await window.Clerk?.session?.getToken(),l=new FormData;l.append("file",i),l.append("title",`Logo - ${i.name}`);const I=await L("/uploads/r2-image",n,{method:"POST",body:l});v(I.url)}catch(n){console.error("Logo upload failed",n),alert("Failed to upload logo. Please try again.")}finally{d(!1)}},h=()=>C([...g,""]),c=(i,n)=>{const l=[...g];l[i]=n,C(l)},S=i=>{const n=g.filter((l,I)=>I!==i);C(n)},F=(()=>{switch(u){case"gym":return{title:"HIIT Session",price:2500};case"crossfit":return{title:"WOD",price:3e3};case"art":return{title:"Painting Workshop",price:4500};case"martial-arts":return{title:"Kickboxing Fundamentals",price:2500};case"dance":return{title:"Salsa Beginner",price:2e3};case"pilates":return{title:"Reformer Flow",price:3500};case"pt":return{title:"1:1 Assessment",price:8e3};default:return{title:"Vinyasa Flow",price:2e3}}})();return e("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 flex flex-col items-center justify-center p-4",children:t("div",{className:"max-w-xl w-full bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[e("div",{className:"h-2 bg-zinc-100 dark:bg-zinc-800 w-full relative",children:e("div",{className:"absolute left-0 top-0 h-full bg-indigo-600 transition-all duration-500",style:{width:`${r/7*100}%`}})}),t("div",{className:"p-8",children:[t("div",{className:"mb-8 text-center",children:[e("div",{className:"w-12 h-12 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold",children:r}),t("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:[r===1&&"Choose your Business Type",r===2&&"Set your Brand",r===3&&"Create a Location",r===4&&"Schedule First Class",r===5&&"Migrate Data",r===6&&"You're all set!"]}),t("p",{className:"text-zinc-500 dark:text-zinc-400 mt-2",children:[r===1&&"We'll customize your setup based on your needs.",r===2&&"Choose a color that represents your studio.",r===3&&"Where will your classes take place?",r===4&&"Get your calendar started with one event.",r===5&&"Invite your instructors and staff.",r===6&&"Import users and classes from your previous system.",r===7&&"Your studio is ready to accept bookings."]})]}),r===1&&t(f,{method:"post",onSubmit:()=>setTimeout(()=>s(2),500),children:[e("input",{type:"hidden",name:"step",value:"template"}),e("div",{className:"grid grid-cols-2 gap-4",children:[{id:"yoga",label:"Yoga / Pilates",icon:"ðŸ§˜"},{id:"gym",label:"Gym / Fitness",icon:"ðŸ’ª"},{id:"crossfit",label:"Crossfit",icon:"ðŸ‹ï¸"},{id:"art",label:"Art / Workshop",icon:"ðŸŽ¨"},{id:"martial-arts",label:"Martial Arts",icon:"ðŸ¥‹"},{id:"dance",label:"Dance",icon:"ðŸ’ƒ"},{id:"pilates",label:"Pilates",icon:"ðŸ¤¸"},{id:"pt",label:"Personal Training",icon:"â±ï¸"}].map(i=>t("label",{className:`cursor-pointer border-2 rounded-xl p-4 flex flex-col items-center gap-2 transition-all ${u===i.id?"border-indigo-600 bg-indigo-50 dark:bg-indigo-900/20":"border-zinc-200 dark:border-zinc-800 hover:border-zinc-300"}`,children:[e("input",{type:"radio",name:"template",value:i.id,checked:u===i.id,onChange:()=>w(i.id),className:"sr-only"}),e("span",{className:"text-3xl",children:i.icon}),e("span",{className:"font-semibold text-sm",children:i.label})]},i.id))}),e("button",{disabled:a,className:"w-full mt-8 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:a?e(k,{className:"animate-spin"}):t(x,{children:["Next Step ",e(N,{size:16})]})})]}),r===2&&t(f,{method:"post",onSubmit:()=>setTimeout(()=>s(3),500),children:[e("input",{type:"hidden",name:"step",value:"branding"}),e("input",{type:"hidden",name:"logoUrl",value:o}),t("div",{className:"space-y-6",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Studio Logo"}),t("div",{className:"flex items-center gap-4",children:[t("label",{className:"cursor-pointer group relative h-24 w-24 rounded-xl bg-zinc-100 dark:bg-zinc-800 border-2 border-dashed border-zinc-300 dark:border-zinc-700 flex flex-col items-center justify-center hover:border-indigo-500 transition overflow-hidden",children:[o?e("img",{src:o,alt:"Logo",className:"w-full h-full object-cover"}):t(x,{children:[e(U,{className:"text-zinc-400 mb-1 group-hover:text-indigo-500",size:24}),e("span",{className:"text-[10px] text-zinc-500 uppercase font-bold group-hover:text-indigo-500",children:"Upload"})]}),b&&e("div",{className:"absolute inset-0 bg-white/80 dark:bg-black/80 flex items-center justify-center",children:e(k,{className:"animate-spin text-indigo-600"})}),e("input",{type:"file",accept:"image/*",className:"hidden",onChange:i=>i.target.files?.[0]&&p(i.target.files[0]),disabled:b})]}),t("div",{className:"flex-1 text-sm text-zinc-500",children:[e("p",{children:"Upload a square logo for best results."}),e("p",{className:"mt-1",children:"It will appear in your emails and client portal."})]})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Brand Color"}),e("div",{className:"grid grid-cols-5 gap-2",children:["#4f46e5","#ec4899","#10b981","#f59e0b","#dc2626"].map(i=>t("label",{className:"relative cursor-pointer group",children:[e("input",{type:"radio",name:"primaryColor",value:i,className:"peer sr-only",defaultChecked:i==="#4f46e5"}),e("div",{className:"w-full aspect-square rounded-full border-2 border-transparent peer-checked:border-zinc-900 dark:peer-checked:border-white transition-all shadow-sm",style:{backgroundColor:i}}),e("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 peer-checked:opacity-100 text-white",children:e(M,{size:16})})]},i))})]})]}),e("button",{disabled:a||b,className:"w-full mt-8 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:a?e(k,{className:"animate-spin"}):t(x,{children:["Next Step ",e(N,{size:16})]})})]}),r===3&&t(f,{method:"post",onSubmit:()=>setTimeout(()=>s(4),500),children:[e("input",{type:"hidden",name:"step",value:"location"}),t("div",{className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Location Name"}),e("input",{required:!0,name:"name",placeholder:"e.g. Main Studio",className:"w-full p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Address"}),e("input",{required:!0,name:"address",placeholder:"123 Yoga Lane",className:"w-full p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900"})]})]}),e("button",{disabled:a,className:"w-full mt-8 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:a?e(k,{className:"animate-spin"}):t(x,{children:["Next Step ",e(N,{size:16})]})})]}),r===4&&t(f,{method:"post",onSubmit:()=>setTimeout(()=>s(5),500),children:[e("input",{type:"hidden",name:"step",value:"schedule"}),t("div",{className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Class Title"}),e("input",{required:!0,name:"title",defaultValue:F.title,className:"w-full p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Start Time"}),e("input",{required:!0,type:"datetime-local",name:"startTime",className:"w-full p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900"})]}),e("input",{type:"hidden",name:"price",value:F.price})]}),e("button",{disabled:a,className:"w-full mt-8 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:a?e(k,{className:"animate-spin"}):t(x,{children:["Next Step ",e(N,{size:16})]})})]}),r===5&&t(f,{method:"post",onSubmit:()=>setTimeout(()=>s(6),500),children:[e("input",{type:"hidden",name:"step",value:"team"}),e("div",{className:"space-y-4",children:t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Invite Instructors"}),e("div",{className:"space-y-2",children:g.map((i,n)=>t("div",{className:"flex gap-2",children:[e("input",{type:"email",name:"emails[]",value:i,onChange:l=>c(n,l.target.value),placeholder:"instructor@example.com",className:"flex-1 p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900"}),g.length>1&&e("button",{type:"button",onClick:()=>S(n),className:"p-2.5 text-zinc-400 hover:text-red-500 transition",children:e(R,{size:20})})]},n))}),t("button",{type:"button",onClick:h,className:"mt-2 text-sm text-indigo-600 font-medium flex items-center gap-1 hover:text-indigo-700",children:[e(O,{size:16})," Add another"]})]})}),t("div",{className:"mt-8 flex gap-3",children:[e("button",{type:"submit",name:"intent",value:"skip",onClick:()=>setTimeout(()=>s(6),500),className:"px-6 py-3 border border-zinc-200 dark:border-zinc-800 text-zinc-600 dark:text-zinc-400 font-bold rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-800 transition",children:"Skip"}),e("button",{type:"submit",name:"intent",value:"invite",disabled:a,className:"flex-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition",children:a?e(k,{className:"animate-spin"}):t(x,{children:["Send Invites ",e(N,{size:16})]})})]})]}),r===6&&t("div",{children:[e(W,{tenantSlug:z.slug,onSuccess:()=>{const i=document.getElementById("advance-step-form");i&&i.submit(),s(7)},onSkip:()=>{const i=document.getElementById("advance-step-form");i&&i.submit(),s(7)}}),e(f,{method:"post",id:"advance-step-form",className:"hidden",children:e("input",{type:"hidden",name:"step",value:"import_complete"})})]}),r===7&&t("div",{className:"text-center",children:[e("div",{className:"text-6xl mb-4 animate-bounce",children:"ðŸŽ‰"}),t("p",{className:"text-zinc-600 dark:text-zinc-400 mb-8",children:["Great job! Your `",u,"` studio is now configured."]}),e(P,{to:`/studio/${z.slug}`,className:"w-full bg-indigo-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-indigo-700 transition shadow-lg shadow-indigo-200 dark:shadow-none",children:"Go to Dashboard"})]})]})]})})}export{be as default};
