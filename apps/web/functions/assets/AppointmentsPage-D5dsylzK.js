import{jsxs as n,jsx as t}from"react/jsx-runtime";import{useLoaderData as I,useSearchParams as A,useSubmit as T}from"react-router";import{useState as a,useMemo as j}from"react";import{Calendar as O,Plus as P,ChevronLeft as $,ChevronRight as M,X as k,Clock as L,User as q}from"lucide-react";function U(){const{appointments:r,services:m,instructors:c,weekStart:d}=I(),[h,x]=A(),g=T(),[u,b]=a(null),[f,v]=a(null),[N,p]=a(!1),o=j(()=>{const e=new Date(d),i=e.getDay(),l=new Date(e);return l.setDate(e.getDate()-(i===0?6:i-1)),Array.from({length:7},(s,D)=>{const C=new Date(l);return C.setDate(l.getDate()+D),C.toISOString().split("T")[0]})},[d]),z=e=>{const i=new Date(o[0]);i.setDate(i.getDate()+e*7),x({week:i.toISOString().split("T")[0]})},w=Array.from({length:12},(e,i)=>i+7),y=(e,i)=>r.filter(l=>{const s=new Date(l.startTime);return s.toISOString().split("T")[0]===e&&s.getHours()===i}),S={pending:"bg-yellow-100 border-yellow-300 text-yellow-800",confirmed:"bg-blue-100 border-blue-300 text-blue-800",completed:"bg-green-100 border-green-300 text-green-800",cancelled:"bg-zinc-100 border-zinc-300 text-zinc-500"};return n("div",{className:"flex flex-col h-full bg-zinc-50",children:[n("header",{className:"bg-white border-b border-zinc-200 px-6 py-4",children:[n("div",{className:"flex items-center justify-between",children:[n("div",{className:"flex items-center gap-3",children:[t("div",{className:"p-2 bg-zinc-900 rounded-lg text-white",children:t(O,{size:20})}),n("div",{children:[t("h1",{className:"text-xl font-bold text-zinc-900",children:"Appointments"}),t("p",{className:"text-sm text-zinc-500",children:"Private sessions calendar"})]})]}),n("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",children:[t(P,{size:16})," New Appointment"]})]}),n("div",{className:"flex items-center justify-between mt-4",children:[t("button",{onClick:()=>z(-1),className:"p-2 hover:bg-zinc-100 rounded-lg",children:t($,{size:20})}),n("span",{className:"font-medium text-zinc-900",children:[new Date(o[0]).toLocaleDateString(void 0,{month:"short",day:"numeric"})," - ",new Date(o[6]).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})]}),t("button",{onClick:()=>z(1),className:"p-2 hover:bg-zinc-100 rounded-lg",children:t(M,{size:20})})]})]}),t("div",{className:"flex-1 overflow-auto",children:n("div",{className:"min-w-[800px]",children:[n("div",{className:"grid grid-cols-8 border-b border-zinc-200 bg-white sticky top-0 z-10",children:[t("div",{className:"p-3 text-xs font-medium text-zinc-500",children:"Time"}),o.map(e=>{const i=new Date(e),l=e===new Date().toISOString().split("T")[0];return n("div",{className:`p-3 text-center border-l border-zinc-200 ${l?"bg-zinc-900 text-white":""}`,children:[t("div",{className:"text-xs font-medium",children:i.toLocaleDateString(void 0,{weekday:"short"})}),t("div",{className:`text-lg font-bold ${l?"":"text-zinc-900"}`,children:i.getDate()})]},e)})]}),w.map(e=>n("div",{className:"grid grid-cols-8 border-b border-zinc-100",children:[n("div",{className:"p-2 text-xs text-zinc-500 text-right pr-4",children:[e%12||12,":00 ",e<12?"AM":"PM"]}),o.map(i=>{const l=y(i,e);return t("div",{className:"border-l border-zinc-100 min-h-[60px] p-1 hover:bg-zinc-50 cursor-pointer transition",onClick:()=>b({date:i,hour:e}),children:l.map(s=>n("div",{onClick:D=>{D.stopPropagation(),v(s)},className:`p-1.5 rounded text-xs mb-1 border cursor-pointer ${S[s.status]||S.pending}`,children:[t("div",{className:"font-medium truncate",children:s.service?.title||"Session"}),t("div",{className:"truncate opacity-75",children:s.member?.user?.profile?.firstName||"Client"})]},s.id))},`${i}-${e}`)})]},e))]})}),(N||u)&&t(F,{services:m,instructors:c,defaultSlot:u,onClose:()=>{p(!1),b(null)},onSave:e=>{const i=new FormData;i.append("intent","create"),Object.entries(e).forEach(([l,s])=>i.append(l,String(s))),g(i,{method:"post"}),p(!1),b(null)}}),f&&t(W,{appointment:f,onClose:()=>v(null),onUpdateStatus:(e,i)=>{g({intent:"update-status",id:e,status:i},{method:"post"}),v(null)}})]})}function F({services:r,instructors:m,defaultSlot:c,onClose:d,onSave:h}){const[x,g]=a(""),[u,b]=a(""),[f,v]=a(""),[N,p]=a(c?.date||new Date().toISOString().split("T")[0]),[o,z]=a(c?`${String(c.hour).padStart(2,"0")}:00`:"09:00"),[w,y]=a("");return t("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm overflow-y-auto",children:n("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full animate-in fade-in zoom-in duration-200",children:[n("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[t("h2",{className:"text-lg font-bold",children:"New Appointment"}),t("button",{onClick:d,children:t(k,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),n("form",{onSubmit:e=>{e.preventDefault();const i=new Date(`${N}T${o}`).toISOString();h({serviceId:x,instructorId:u,memberId:f,startTime:i,notes:w})},className:"p-6 space-y-4",children:[n("div",{children:[t("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Service *"}),n("select",{required:!0,value:x,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",children:[t("option",{value:"",children:"Select service..."}),r.map(e=>n("option",{value:e.id,children:[e.title," (",e.durationMinutes," min)"]},e.id))]})]}),n("div",{children:[t("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Instructor *"}),n("select",{required:!0,value:u,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg",children:[t("option",{value:"",children:"Select instructor..."}),m.map(e=>n("option",{value:e.id,children:[e.user?.profile?.firstName," ",e.user?.profile?.lastName]},e.id))]})]}),n("div",{className:"grid grid-cols-2 gap-4",children:[n("div",{children:[t("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Date"}),t("input",{type:"date",value:N,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg"})]}),n("div",{children:[t("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Time"}),t("input",{type:"time",value:o,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg"})]})]}),n("div",{children:[t("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Notes"}),t("textarea",{value:w,onChange:e=>y(e.target.value),rows:2,className:"w-full px-3 py-2 border border-zinc-200 rounded-lg resize-none"})]}),n("div",{className:"pt-4 flex justify-end gap-3",children:[t("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-zinc-500",children:"Cancel"}),t("button",{type:"submit",className:"px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800",children:"Create"})]})]})]})})}function W({appointment:r,onClose:m,onUpdateStatus:c}){const d=h=>new Date(h).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"});return t("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm overflow-y-auto",children:n("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full animate-in fade-in zoom-in duration-200",children:[n("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[t("h2",{className:"text-lg font-bold",children:r.service?.title||"Appointment"}),t("button",{onClick:m,children:t(k,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),n("div",{className:"p-6 space-y-4",children:[n("div",{className:"flex items-center gap-3 text-sm",children:[t(L,{size:16,className:"text-zinc-400"}),d(r.startTime)]}),n("div",{className:"flex items-center gap-3 text-sm",children:[t(q,{size:16,className:"text-zinc-400"}),r.member?.user?.profile?.firstName," ",r.member?.user?.profile?.lastName]}),r.notes&&t("p",{className:"text-sm text-zinc-600 bg-zinc-50 p-3 rounded-lg",children:r.notes}),n("div",{className:"pt-4 border-t space-y-2",children:[t("p",{className:"text-xs font-medium text-zinc-500 uppercase",children:"Update Status"}),n("div",{className:"flex gap-2",children:[t("button",{onClick:()=>c(r.id,"confirmed"),className:"flex-1 py-2 text-xs font-medium bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",children:"Confirm"}),t("button",{onClick:()=>c(r.id,"completed"),className:"flex-1 py-2 text-xs font-medium bg-green-100 text-green-700 rounded-lg hover:bg-green-200",children:"Complete"}),t("button",{onClick:()=>c(r.id,"cancelled"),className:"flex-1 py-2 text-xs font-medium bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:"Cancel"})]})]})]})]})})}export{U as default};
