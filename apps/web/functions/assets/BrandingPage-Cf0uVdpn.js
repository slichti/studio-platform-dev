import{jsxs as i,jsx as e}from"react/jsx-runtime";import{useState as s}from"react";import{useOutletContext as G,useLoaderData as J,useRevalidator as V}from"react-router";import{Image as q,Upload as M,Video as X,CheckCircle as K,Trash2 as Q}from"lucide-react";import{toast as W}from"sonner";import{C as Y,a as c}from"./server-build-tAMGW7nt.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function Se(){const{tenant:r}=G(),{assets:u}=J(),b=V(),[l,p]=s(u),[m,o]=s(null),[v,w]=s(r.branding?.primaryColor||"#4f46e5"),[z,P]=s(r.branding?.logoUrl||""),[B,Z]=s(r.branding?.emailReplyTo||""),[O,_]=s(r.branding?.emailFooterText||""),[N,F]=s(r.branding?.hidePoweredBy||!1),[y,C]=s(!1),[h,x]=s(null),[T,d]=s(null),[S,f]=s(null),$=async t=>{t.preventDefault(),C(!0),d(null),f(null);try{const n=await window.Clerk?.session?.getToken();await c("/tenant/settings",n,{method:"PATCH",headers:{"X-Tenant-Slug":r.slug},body:JSON.stringify({branding:{primaryColor:v,logoUrl:z,emailReplyTo:B,emailFooterText:O,hidePoweredBy:N}})}),f("Branding saved successfully."),b.revalidate()}catch(n){d(n.message||"Failed to save branding.")}finally{C(!1)}},j=async t=>{x("logo"),d(null);try{const n=await window.Clerk?.session?.getToken(),a=new FormData;a.append("file",t),a.append("title",`Logo - ${t.name}`);const g=await c("/uploads/r2-image",n,{method:"POST",body:a});P(g.url),f("Logo uploaded. Don't forget to save settings.")}catch(n){d("Logo upload failed: "+n.message)}finally{x(null)}},U=async(t,n)=>{x(n),d(null);try{const a=await window.Clerk?.session?.getToken(),{uploadUrl:g,uid:k}=await c("/video-management/branding/upload-url",a,{method:"POST",body:JSON.stringify({type:n})}),A=new FormData;if(A.append("file",t),!(await fetch(g,{method:"POST",body:A})).ok)throw new Error("Upload to video server failed");await c("/video-management/branding",a,{method:"POST",body:JSON.stringify({type:n,title:t.name,cloudflareStreamId:k})});const I=await c("/video-management/branding",a);p(I),f(`Uploaded ${n} video successfully.`)}catch(a){d("Upload failed: "+a.message)}finally{x(null)}},D=async t=>{try{const n=await window.Clerk?.session?.getToken();await c(`/video-management/branding/${t}/activate`,n,{method:"PATCH"}),p(l.map(a=>{if(a.id===t)return{...a,active:!0};const g=l.find(k=>k.id===t);return g&&a.type===g.type&&a.id!==t?{...a,active:!1}:a}))}catch{d("Failed to activate asset")}},R=async()=>{if(m)try{const t=await window.Clerk?.session?.getToken();await c(`/video-management/branding/${m}`,t,{method:"DELETE"}),p(l.filter(n=>n.id!==m)),o(null),W.success("Asset deleted successfully")}catch{d("Failed to delete asset")}},E=l.filter(t=>t.type==="intro"),H=l.filter(t=>t.type==="outro");return i("div",{className:"max-w-4xl pb-10 space-y-8",children:[i("div",{children:[e("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:"Customize Branding"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage your studio's look, feel, and video assets."})]}),i("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",children:[T&&e("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded mb-4 text-sm",children:T}),S&&e("div",{className:"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 p-3 rounded mb-4 text-sm",children:S}),e("h2",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-6",children:"General Appearance"}),i("form",{onSubmit:$,className:"flex flex-col gap-6",children:[i("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i("div",{children:[e("label",{className:"block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",children:"Studio Logo"}),i("div",{className:"flex items-start gap-4",children:[i("div",{className:"h-24 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 flex items-center justify-center overflow-hidden relative group",children:[z?e("img",{src:z,alt:"Logo",className:"object-cover w-full h-full"}):e(q,{className:"text-zinc-300",size:32}),i("label",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity text-white text-xs font-medium",children:["Change",e("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>t.target.files?.[0]&&j(t.target.files[0]),disabled:h==="logo"})]})]}),h==="logo"&&e("p",{className:"text-blue-600 animate-pulse mt-1",children:"Uploading..."})]})]}),i("div",{children:[e("label",{className:"block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",children:"Primary Brand Color"}),i("div",{className:"flex gap-3",children:[e("input",{type:"color",value:v,onChange:t=>w(t.target.value),className:"w-10 h-10 p-0 border-none rounded cursor-pointer bg-transparent"}),e("input",{type:"text",value:v,onChange:t=>w(t.target.value),className:"flex-1 bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"#000000"})]})]})]}),e("div",{className:"border-t border-zinc-200 dark:border-zinc-800 pt-6",children:i("label",{className:"flex items-start gap-3",children:[e("input",{type:"checkbox",checked:N,onChange:t=>F(t.target.checked),disabled:r.tier?.toLowerCase()!=="scale",className:"h-4 w-4 mt-0.5 rounded border-zinc-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),i("div",{className:"text-sm",children:[e("span",{className:`font-medium ${r.tier?.toLowerCase()!=="scale"?"text-zinc-400":"text-zinc-900 dark:text-zinc-100"}`,children:'Hide "Powered by StudioPlatform" badge'}),r.tier?.toLowerCase()!=="scale"&&e("span",{className:"text-pink-600 dark:text-pink-400 ml-1 text-xs",children:"Requires Scale tier."})]})]})}),e("button",{type:"submit",disabled:y,className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-5 py-2.5 rounded-md font-medium text-sm hover:opacity-90 transition-opacity ${y?"opacity-70 cursor-not-allowed":""}`,children:y?"Saving...":"Save General Settings"})]})]}),i("div",{className:"space-y-6",children:[e("h2",{className:"text-xl font-bold text-zinc-900 dark:text-zinc-100",children:"Video Branding"}),i("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e(L,{type:"intro",assets:E,uploading:h,onUpload:U,onActivate:D,onDelete:o}),e(L,{type:"outro",assets:H,uploading:h,onUpload:U,onActivate:D,onDelete:o})]})]}),e(Y,{isOpen:!!m,onClose:()=>o(null),onConfirm:R,title:"Delete Asset",message:"Are you sure you want to delete this asset?",confirmText:"Delete",isDestructive:!0})]})}function L({type:r,assets:u,uploading:b,onUpload:l,onActivate:p,onDelete:m}){return i("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6 shadow-sm",children:[i("div",{className:"flex items-center justify-between mb-4",children:[i("h3",{className:"font-semibold text-zinc-900 dark:text-zinc-100 capitalize",children:[r," Videos"]}),i("label",{className:"cursor-pointer bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-800 dark:text-zinc-200 px-3 py-1.5 rounded-md text-xs font-medium transition flex items-center gap-2",children:[e(M,{size:14})," ",b===r?"Uploading...":`Upload ${r}`,e("input",{type:"file",accept:"video/*",className:"hidden",onChange:o=>o.target.files?.[0]&&l(o.target.files[0],r),disabled:!!b})]})]}),u.length===0?i("div",{className:"text-zinc-400 text-sm py-8 text-center bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-dashed border-zinc-200 dark:border-zinc-800 px-10",children:["No ",r,"s uploaded."]}):e("div",{className:"space-y-3",children:u.map(o=>i("div",{className:`flex items-center justify-between p-3 rounded-lg border ${o.active?"border-indigo-200 bg-indigo-50/50":"border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-750"} transition`,children:[i("div",{className:"flex items-center gap-3",children:[e(X,{size:14,className:"text-zinc-400"}),i("div",{children:[e("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:o.title}),o.active&&i("div",{className:"text-xs text-indigo-600 font-medium flex items-center gap-1",children:[e(K,{size:10})," Active"]})]})]}),i("div",{className:"flex items-center gap-2",children:[!o.active&&e("button",{onClick:()=>p(o.id),className:"text-xs text-zinc-500 hover:text-indigo-600 px-2 py-1 rounded hover:bg-indigo-50 transition",children:"Set Active"}),e("button",{onClick:()=>m(o.id),className:"p-1.5 text-zinc-400 hover:text-red-600 rounded transition",children:e(Q,{size:14})})]})]},o.id))})]})}export{Se as default};
