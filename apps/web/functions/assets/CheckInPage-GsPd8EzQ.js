import{jsxs as t,jsx as e,Fragment as P}from"react/jsx-runtime";import{useState as r,useEffect as z}from"react";import{useLoaderData as R,useParams as U,useOutletContext as M,Link as O}from"react-router";import{a as w}from"./server-build-DYgJutU4.js";import{CheckCircle2 as d,Loader2 as L,Calendar as v,ArrowLeft as Q,Search as D,Circle as X,UserPlus as J,Users as W,AlertCircle as q}from"lucide-react";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function ze(){const{classes:y,token:u}=R(),{slug:o}=U(),{roles:k,isStudentView:j}=M(),[c,C]=r(null),[I,f]=r([]),[H,T]=r(!1),[m,g]=r(""),[n,$]=r(!1),[h,N]=r(null);z(()=>{c&&E(c.id)},[c]);const E=async l=>{T(!0);try{const s=await w(`/classes/${l}/bookings`,u,{headers:{"X-Tenant-Slug":o}});f(s||[])}catch{console.error("Failed to load roster")}finally{T(!1)}},S=async l=>{const s=!l.checkedInAt;f(b=>b.map(i=>i.id===l.id?{...i,checkedInAt:s?new Date:null}:i));try{await w(`/classes/${c.id}/bookings/${l.id}/check-in`,u,{method:"PATCH",headers:{"X-Tenant-Slug":o},body:JSON.stringify({checkedIn:s})})}catch{f(i=>i.map(x=>x.id===l.id?{...x,checkedInAt:s?null:new Date}:x))}};z(()=>{if(n&&h?.type==="success"){const l=setTimeout(()=>{N(null),g("")},3e3);return()=>clearTimeout(l)}},[h,n]);const F=async l=>{if(l.checkedInAt){N({message:"Already checked in!",type:"error"});return}await S(l),N({message:`Welcome, ${l.user.profile?.firstName}!`,type:"success"})};if(j||!k.includes("instructor")&&!k.includes("owner")){const[l,s]=r([]),[b,i]=r(!0);z(()=>{(async()=>{i(!0);try{const p=await w("/members/me/bookings",u,{headers:{"X-Tenant-Slug":o}});s(p.bookings||[])}catch(p){console.error("Failed into fetch history",p)}finally{i(!1)}})()},[u,o]);const x=l.filter(a=>a.status==="confirmed"&&a.checkedInAt).length,K=l.filter(a=>a.status==="confirmed"&&new Date(a.class.startTime)>new Date).length;return t("div",{className:"max-w-4xl mx-auto p-6",children:[t("div",{className:"mb-8",children:[t("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100 flex items-center gap-3",children:[e(d,{className:"text-emerald-500",size:32})," Attendance History"]}),e("p",{className:"text-zinc-500 mt-2",children:"Track your class attendance and upcoming sessions."})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[t("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 shadow-sm",children:[e("div",{className:"text-sm font-bold text-zinc-500 uppercase mb-1",children:"Classes Attended"}),e("div",{className:"text-4xl font-black text-emerald-600",children:x})]}),t("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 shadow-sm",children:[e("div",{className:"text-sm font-bold text-zinc-500 uppercase mb-1",children:"Upcoming Classes"}),e("div",{className:"text-4xl font-black text-blue-600",children:K})]})]}),e("h2",{className:"text-xl font-bold mb-4",children:"Your Classes"}),b?t("div",{className:"p-12 text-center text-zinc-400",children:[e(L,{className:"animate-spin mx-auto h-8 w-8 mb-2"}),"Loading history..."]}):l.length===0?t("div",{className:"p-12 text-center bg-zinc-50 dark:bg-zinc-900 rounded-2xl border border-dashed border-zinc-200",children:[e(v,{className:"mx-auto h-12 w-12 text-zinc-300 mb-4"}),e("h3",{className:"font-bold mb-1",children:"No classes yet"}),e(O,{to:`/studio/${o}/classes`,className:"inline-block px-6 py-2 bg-zinc-900 text-white font-bold rounded-lg mt-4",children:"Book a Class"})]}):e("div",{className:"space-y-4",children:l.map(a=>{const p=new Date(a.class.startTime)<new Date,A=a.status==="cancelled";return t("div",{className:`bg-white dark:bg-zinc-900 p-6 rounded-2xl border ${A?"border-red-200 bg-red-50/50":"border-zinc-200"} shadow-sm flex flex-col md:flex-row md:items-center gap-6`,children:[t("div",{className:"flex-shrink-0 flex flex-col items-center justify-center w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-2xl",children:[e("span",{className:"text-xs font-bold text-zinc-500 uppercase",children:new Date(a.class.startTime).toLocaleDateString([],{month:"short"})}),e("span",{className:"text-2xl font-black",children:new Date(a.class.startTime).getDate()})]}),t("div",{className:"flex-1 min-w-0",children:[e("h3",{className:"text-lg font-bold mb-1",children:a.class.title}),e("div",{className:"text-sm text-zinc-500 flex gap-4",children:t("span",{className:"flex items-center gap-1.5",children:[e(v,{size:14}),new Date(a.class.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),e("div",{className:"flex-shrink-0 text-right",children:A?e("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-bold",children:"Cancelled"}):a.checkedInAt?t("span",{className:"flex items-center gap-2 text-emerald-600 font-bold",children:[e(d,{size:18}),"Checked In"]}):p?e("span",{className:"text-zinc-400",children:"Completed"}):e("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold",children:"Upcoming"})})]},a.id)})})]})}if(c){const l=I.filter(s=>s.user.email.toLowerCase().includes(m.toLowerCase())||JSON.stringify(s.user.profile).toLowerCase().includes(m.toLowerCase()));return t("div",{className:"flex flex-col h-screen bg-white dark:bg-zinc-950",children:[t("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center gap-4 bg-zinc-50 dark:bg-zinc-900/50 sticky top-0 z-10",children:[e("button",{onClick:()=>C(null),className:"p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e(Q,{size:20})}),t("div",{className:"flex-1 min-w-0",children:[e("h2",{className:"font-bold truncate",children:c.title}),e("p",{className:"text-xs text-zinc-500",children:new Date(c.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e("button",{onClick:()=>$(!n),className:`px-4 py-2 rounded-lg text-sm font-bold border ${n?"bg-blue-600 text-white":"bg-white dark:bg-zinc-900 text-zinc-600 border-zinc-200"}`,children:n?"Exit Kiosk":"Kiosk Mode"})]}),n?e("div",{className:"flex-1 flex flex-col items-center justify-start pt-24 px-8 bg-zinc-50 dark:bg-zinc-950",children:t("div",{className:"max-w-2xl w-full",children:[e("h1",{className:"text-4xl font-extrabold text-center mb-8",children:"Welcome!"}),h?t("div",{className:`p-12 rounded-3xl text-center ${h.type==="success"?"bg-emerald-500 text-white":"bg-red-500 text-white"}`,children:[e(d,{size:64,className:"mx-auto mb-4"}),e("h2",{className:"text-3xl font-bold",children:h.message}),e("p",{className:"mt-2 opacity-80 uppercase tracking-widest font-medium text-sm",children:"Enjoy your class!"})]}):t("div",{className:"space-y-6",children:[t("div",{className:"relative",children:[e(D,{className:"absolute left-6 top-1/2 -translate-y-1/2 h-8 w-8 text-zinc-400"}),e("input",{type:"text",placeholder:"Enter your name...",value:m,onChange:s=>g(s.target.value),className:"w-full pl-20 pr-8 py-8 bg-white dark:bg-zinc-900 border-2 border-zinc-200 rounded-3xl text-3xl font-bold outline-none shadow-xl",autoFocus:!0})]}),m.length>1&&e("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 overflow-hidden",children:l.map(s=>t("button",{onClick:()=>F(s),className:"w-full flex items-center justify-between p-6 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border-b border-zinc-100 last:border-0 transition-colors",children:[t("span",{className:"text-xl font-bold",children:[s.user.profile?.firstName," ",s.user.profile?.lastName]}),s.checkedInAt?t("span",{className:"text-emerald-500 font-bold flex items-center gap-2",children:[e(d,{})," Checked In"]}):e("span",{className:"bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm",children:"Check In"})]},s.id))})]})]})}):t(P,{children:[e("div",{className:"p-4 bg-white dark:bg-zinc-950 border-b border-zinc-100 dark:border-zinc-800",children:t("div",{className:"relative",children:[e(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e("input",{type:"text",placeholder:"Find student...",value:m,onChange:s=>g(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-zinc-100 dark:bg-zinc-900 rounded-2xl text-sm outline-none"})]})}),e("div",{className:"flex-1 overflow-y-auto pb-24",children:H&&I.length===0?e(L,{className:"animate-spin mx-auto h-8 w-8 mt-12"}):e("div",{className:"divide-y divide-zinc-50 dark:divide-zinc-900",children:l.map(s=>t("button",{onClick:()=>S(s),className:"w-full flex items-center gap-4 p-4 active:bg-zinc-50 dark:active:bg-zinc-900 transition-colors text-left group",children:[e("div",{className:"flex-shrink-0",children:s.checkedInAt?e("div",{className:"p-2 bg-emerald-100 text-emerald-600 rounded-full",children:e(d,{size:24})}):e("div",{className:"p-2 bg-zinc-100 text-zinc-400 rounded-full group-hover:text-blue-500",children:e(X,{size:24})})}),t("div",{className:"flex-1 min-w-0",children:[t("div",{className:"font-bold truncate",children:[s.user.profile?.firstName," ",s.user.profile?.lastName]}),t("div",{className:"text-xs text-zinc-500 flex gap-2 mt-0.5",children:[e("span",{children:s.status})," â€¢ ",e("span",{children:s.user.email})]})]}),e("div",{className:"flex-shrink-0",children:s.checkedInAt?e("span",{className:"text-[10px] text-zinc-400 font-medium",children:"Checked in"}):e("span",{className:"text-[10px] text-blue-600 font-bold bg-blue-50 px-2 py-1 rounded uppercase",children:"CHECK IN"})})]},s.id))})}),e("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-950 flex gap-4 sticky bottom-0 shadow-2xl",children:t("button",{className:"flex-1 bg-zinc-900 dark:bg-zinc-100 dark:text-zinc-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2",children:[e(J,{size:20}),"Quick Add Student"]})})]})]})}return e("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 pb-12",children:t("div",{className:"p-8",children:[t("div",{className:"mb-8",children:[t("h1",{className:"text-3xl font-extrabold flex items-center gap-2",children:[e(d,{className:"text-blue-600"})," Instructor Check-in"]}),e("p",{className:"text-sm text-zinc-500 mt-1",children:"Select today's session to start checking in students."})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.length>0?y.map(l=>t("button",{onClick:()=>C(l),className:"bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-zinc-200 hover:border-blue-500 transition-all text-left shadow-sm flex flex-col gap-4",children:[t("div",{className:"flex justify-between items-start",children:[e("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg text-blue-600",children:e(v,{size:20})}),e("span",{className:"text-[10px] font-bold uppercase text-zinc-400 bg-zinc-100 px-2 py-0.5 rounded",children:new Date(l.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),t("div",{className:"flex-1",children:[e("h3",{className:"font-bold line-clamp-2 leading-tight mb-1",children:l.title}),t("p",{className:"text-xs text-zinc-500 flex items-center gap-1.5 mt-1",children:[e(W,{size:12}),l.confirmedCount||0," students booked"]})]}),t("div",{className:"pt-4 border-t border-zinc-100 flex items-center gap-2 text-blue-600 text-xs font-bold uppercase",children:["Start Check-in ",e("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"})]})]},l.id)):t("div",{className:"col-span-full py-24 text-center bg-white rounded-3xl border border-dashed border-zinc-200",children:[e(q,{className:"mx-auto h-12 w-12 text-zinc-300 mb-4"}),e("h3",{className:"text-zinc-500 font-bold mb-1",children:"No Classes Today"}),e("p",{className:"text-xs text-zinc-400",children:"Enjoy your day off!"})]})})]})})}export{ze as default};
