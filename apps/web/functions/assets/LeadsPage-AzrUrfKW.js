import{jsxs as t,jsx as a}from"react/jsx-runtime";import{useLoaderData as R}from"react-router";import{useState as l}from"react";import{M as D,a as u}from"./server-build-tAMGW7nt.js";import{Plus as q,Search as H,Mail as U,Phone as W,Clock as B,Pencil as G}from"lucide-react";import{format as K}from"date-fns";import{toast as c}from"sonner";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function ze(){const{leads:O,token:o,slug:m}=R(),[w,k]=l(O),[M,p]=l(!1),[C,S]=l(!1),[b,P]=l(""),[n,x]=l(null),[N,f]=l([]),[Q,L]=l(!1),[v,T]=l(""),[$,h]=l(!1),[d,y]=l({}),[r,i]=l({firstName:"",lastName:"",email:"",phone:"",source:"",notes:""}),j=async e=>{x(e),h(!1),y({...e}),L(!0);try{const s=await u(`/tasks?leadId=${e.id}`,o,{headers:{"X-Tenant-Slug":m}});f(Array.isArray(s)?s:[])}catch(s){console.error(s)}finally{L(!1)}},X=async e=>{e.preventDefault();try{await u(`/leads/${n.id}`,o,{method:"PATCH",headers:{"X-Tenant-Slug":m},body:JSON.stringify(d)}),x({...n,...d}),k(w.map(s=>s.id===n.id?{...s,...d}:s)),h(!1),c.success("Lead updated")}catch(s){c.error(s.message)}},E=async e=>{if(e.preventDefault(),!!v)try{const s=await u("/tasks",o,{method:"POST",headers:{"X-Tenant-Slug":m},body:JSON.stringify({title:v,relatedLeadId:n.id,status:"todo",priority:"medium",dueDate:new Date(Date.now()+864e5)})});f([s,...N]),T(""),c.success("Task created")}catch(s){c.error(s.message)}},F=async(e,s)=>{const g=s==="done"?"todo":"done";f(N.map(z=>z.id===e?{...z,status:g}:z)),await u(`/tasks/${e}`,o,{method:"PATCH",headers:{"X-Tenant-Slug":m},body:JSON.stringify({status:g})})},I=async e=>{e.preventDefault(),S(!0);try{const s=await u("/leads",o,{method:"POST",headers:{"X-Tenant-Slug":m},body:JSON.stringify(r)});if(s.error)c.error(s.error);else{const g=await u("/leads",o,{headers:{"X-Tenant-Slug":m}});k(g.leads||[]),p(!1),i({firstName:"",lastName:"",email:"",phone:"",source:"",notes:""}),c.success("Lead created")}}catch(s){c.error(s.message)}finally{S(!1)}},A=w.filter(e=>e.email.toLowerCase().includes(b.toLowerCase())||(e.firstName+" "+e.lastName).toLowerCase().includes(b.toLowerCase())),J=e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"contacted":return"bg-yellow-100 text-yellow-800";case"trialing":return"bg-purple-100 text-purple-800";case"converted":return"bg-green-100 text-green-800";case"lost":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return t("div",{className:"p-8 max-w-7xl mx-auto",children:[t("div",{className:"flex justify-between items-center mb-8 text-zinc-900 dark:text-zinc-100",children:[t("div",{children:[a("h1",{className:"text-3xl font-bold",children:"Leads CRM"}),a("p",{className:"text-zinc-500",children:"Track and manage prospective students."})]}),t("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2",children:[a(q,{size:18})," Add New Lead"]})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl overflow-hidden shadow-sm",children:[t("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center gap-4",children:[t("div",{className:"relative flex-1 max-w-md",children:[a(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:16}),a("input",{value:b,onChange:e=>P(e.target.value),placeholder:"Search leads...",className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-zinc-800 dark:border-zinc-700"})]}),t("div",{className:"text-sm text-zinc-500",children:[A.length," leads found"]})]}),a("div",{className:"overflow-x-auto",children:t("table",{className:"w-full text-left",children:[a("thead",{className:"bg-zinc-50 dark:bg-zinc-800/50 text-zinc-500",children:t("tr",{children:[a("th",{className:"px-6 py-3 text-xs font-semibold uppercase",children:"Name"}),a("th",{className:"px-6 py-3 text-xs font-semibold uppercase",children:"Contact"}),a("th",{className:"px-6 py-3 text-xs font-semibold uppercase",children:"Status"}),a("th",{className:"px-6 py-3 text-xs font-semibold uppercase",children:"Source"}),a("th",{className:"px-6 py-3 text-xs font-semibold uppercase",children:"Added"})]})}),a("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:A.map(e=>t("tr",{onClick:()=>j(e),className:"hover:bg-zinc-50 dark:hover:bg-zinc-800/50 cursor-pointer",children:[t("td",{className:"px-6 py-4",children:[t("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:[e.firstName," ",e.lastName]}),a("div",{className:"text-xs text-zinc-400",children:e.notes})]}),t("td",{className:"px-6 py-4 text-sm text-zinc-600 dark:text-zinc-400",children:[t("div",{className:"flex items-center gap-1",children:[a(U,{size:14})," ",e.email]}),e.phone&&t("div",{className:"flex items-center gap-1",children:[a(W,{size:14})," ",e.phone]})]}),a("td",{className:"px-6 py-4 text-xs font-bold uppercase",children:a("span",{className:`px-2 py-1 rounded ${J(e.status)}`,children:e.status})}),a("td",{className:"px-6 py-4 text-xs text-zinc-600 dark:text-zinc-400",children:e.source||"Unknown"}),t("td",{className:"px-6 py-4 text-sm text-zinc-500",children:[a(B,{size:14,className:"inline mr-1"})," ",K(new Date(e.createdAt),"MMM d")]})]},e.id))})]})})]}),a(D,{isOpen:M,onClose:()=>p(!1),title:"Add New Lead",children:t("form",{onSubmit:I,className:"space-y-4",children:[t("div",{className:"grid grid-cols-2 gap-4",children:[a("input",{value:r.firstName,onChange:e=>i({...r,firstName:e.target.value}),placeholder:"First Name",required:!0,className:"p-2 border rounded dark:bg-zinc-800"}),a("input",{value:r.lastName,onChange:e=>i({...r,lastName:e.target.value}),placeholder:"Last Name",className:"p-2 border rounded dark:bg-zinc-800"})]}),a("input",{type:"email",value:r.email,onChange:e=>i({...r,email:e.target.value}),placeholder:"Email",required:!0,className:"w-full p-2 border rounded dark:bg-zinc-800"}),a("input",{value:r.phone,onChange:e=>i({...r,phone:e.target.value}),placeholder:"Phone",className:"w-full p-2 border rounded dark:bg-zinc-800"}),t("select",{value:r.source,onChange:e=>i({...r,source:e.target.value}),className:"w-full p-2 border rounded dark:bg-zinc-800",children:[a("option",{value:"",children:"Select Source..."}),a("option",{value:"Website",children:"Website"}),a("option",{value:"Social Media",children:"Social Media"}),a("option",{value:"Referral",children:"Referral"})]}),a("textarea",{value:r.notes,onChange:e=>i({...r,notes:e.target.value}),placeholder:"Notes",className:"w-full h-24 p-2 border rounded dark:bg-zinc-800"}),t("div",{className:"flex gap-2",children:[a("button",{type:"button",onClick:()=>p(!1),className:"flex-1 p-2 border rounded",children:"Cancel"}),a("button",{type:"submit",disabled:C,className:"flex-1 p-2 bg-blue-600 text-white rounded",children:C?"Adding...":"Add Lead"})]})]})}),a(D,{isOpen:!!n,onClose:()=>x(null),title:n?`${n.firstName} ${n.lastName}`:"",children:n&&t("div",{className:"space-y-6",children:[a("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-800 rounded-lg",children:$?t("form",{onSubmit:X,className:"space-y-3",children:[t("div",{className:"grid grid-cols-2 gap-2",children:[a("input",{value:d.firstName,onChange:e=>y({...d,firstName:e.target.value}),className:"p-1 border rounded"}),a("input",{value:d.lastName,onChange:e=>y({...d,lastName:e.target.value}),className:"p-1 border rounded"})]}),t("div",{className:"flex gap-2 justify-end",children:[a("button",{onClick:()=>h(!1),className:"px-2 py-1 text-xs border rounded",children:"Cancel"}),a("button",{type:"submit",className:"px-2 py-1 text-xs bg-blue-600 text-white rounded",children:"Save"})]})]}):t("div",{className:"flex justify-between",children:[t("h2",{className:"text-xl font-bold",children:[n.firstName," ",n.lastName]}),a("button",{onClick:()=>h(!0),className:"text-zinc-400 hover:text-blue-600",children:a(G,{size:18})})]})}),t("div",{className:"space-y-4",children:[t("form",{onSubmit:E,className:"flex gap-2",children:[a("input",{value:v,onChange:e=>T(e.target.value),placeholder:"Add a task...",className:"flex-1 p-2 border rounded dark:bg-zinc-800"}),a("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Add"})]}),a("div",{className:"space-y-2",children:N.map(e=>t("div",{className:"p-3 border rounded-lg flex items-center justify-between dark:bg-zinc-800 dark:border-zinc-700",children:[a("span",{className:e.status==="done"?"line-through text-zinc-400":"",children:e.title}),a("button",{onClick:()=>F(e.id,e.status),className:`w-5 h-5 rounded-full border ${e.status==="done"?"bg-green-500 border-green-500":""}`})]},e.id))})]})]})})]})}export{ze as default};
