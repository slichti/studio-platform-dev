import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useState as m,useEffect as T}from"react";import{useParams as P,useOutletContext as D}from"react-router";import{a as l,C as x}from"./server-build-tAMGW7nt.js";import{Loader2 as A,CreditCard as F,Shield as E,Mail as $,Send as K,MessageSquare as k,Layers as b}from"lucide-react";import{toast as o}from"sonner";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function le(){const{slug:c}=P(),{tenant:r,features:i}=D()||{},[f,N]=m(null),[I,v]=m({accountSid:"",authToken:"",fromNumber:""}),[j,S]=m({apiKey:""}),[C,y]=m(!1),[d,p]=m(null),[u,w]=m(null),g=async s=>{try{const n=await window.Clerk?.session?.getToken();await l(`/studios/${r.id}/integrations`,n,{method:"PUT",headers:{"X-Tenant-Slug":c||""},body:JSON.stringify(s)}),o.success("Settings saved successfully."),window.location.reload()}catch(n){o.error(n.message||"Failed to save")}},h=async(s,n)=>{try{const a=await window.Clerk?.session?.getToken();await l("/tenant/features",a,{method:"POST",headers:{"X-Tenant-Slug":c||""},body:JSON.stringify({featureKey:s,enabled:n})}),o.success(`${n?"Enabled":"Disabled"} ${s}`),window.location.reload()}catch(a){o.error(a.message||"Failed to update feature")}};T(()=>{z()},[c]);const z=async()=>{try{const s=window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token"),n=await l("/integrations/credentials",s,{headers:{"X-Tenant-Slug":c||""}});N(n),v({accountSid:n.twilio?.accountSid||"",authToken:"",fromNumber:n.twilio?.fromNumber||""}),S({apiKey:n.resend?.apiKey||""})}catch(s){console.error("Failed to load data",s)}};return r?t("div",{className:"max-w-5xl pb-10",children:[t("div",{className:"mb-8",children:[e("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Integrations"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage connections, payment providers, and developer tools."})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[t("div",{className:"col-span-1 lg:col-span-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(F,{className:"h-5 w-5"})," Payment Processing"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${r.paymentProvider==="connect"&&r.stripeAccountId?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r.paymentProvider==="connect"&&r.stripeAccountId?"Connected":r.paymentProvider==="custom"?"Custom Keys":"Not Configured"})]}),t("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800 rounded p-4",children:[t("h4",{className:"flex items-center gap-2 text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:[e(E,{className:"h-4 w-4"})," Financial Privacy & Security"]}),t("div",{className:"text-xs text-blue-800 dark:text-blue-200 space-y-2",children:[t("p",{children:[e("strong",{children:"Your Money, Your Account:"})," You retain full legal ownership of your Stripe account and funds. We cannot access your bank account or withdraw funds without your permission."]}),t("p",{children:[e("strong",{children:"Limited Visibility:"})," We only track transactions processed through this platform (e.g., class bookings). We do not access unrelated financial data from your Stripe account."]}),t("p",{children:[e("strong",{children:"Bank-Grade Security:"})," Sensitive financial data is stored securely by Stripe. We do not store credit card numbers or bank account details."]})]})]})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e($,{className:"h-4 w-4"})," Transactional Email (Resend)"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${r.resendCredentials?.apiKey?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r.resendCredentials?.apiKey?"Configured":"Using Platform Default"})]}),e("p",{className:"text-xs text-zinc-500 mb-3",children:"Provide your own Resend API Key to send transactional emails from your domain."}),t("form",{onSubmit:s=>{s.preventDefault(),g({resendApiKey:new FormData(s.currentTarget).get("resendApiKey")})},className:"flex gap-2",children:[e("input",{name:"resendApiKey",type:"password",placeholder:"re_123...",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(K,{className:"h-4 w-4"})," Marketing Automation (Flodesk)"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${f?.flodesk?.configured?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:f?.flodesk?.configured?"Configured":"Not Configured"})]}),e("p",{className:"text-xs text-zinc-500 mb-3",children:"Sync members and activity to Flodesk for email marketing."}),t("form",{onSubmit:async s=>{s.preventDefault();try{const n=new FormData(s.currentTarget).get("flodeskApiKey"),a=await window.Clerk?.session?.getToken();await l("/integrations/credentials",a,{method:"PATCH",headers:{"X-Tenant-Slug":c||""},body:JSON.stringify({flodesk:{apiKey:n}})}),o.success("Flodesk settings saved."),z()}catch(n){console.error(n),o.error("Failed to save Flodesk settings: "+n.message)}},className:"flex gap-2",children:[e("input",{name:"flodeskApiKey",type:"password",placeholder:"Flodesk API Key",className:"flex-1 text-sm border-zinc-300 rounded px-3 py-2"}),e("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Key"})]})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(k,{className:"h-4 w-4"})," SMS Service (Twilio)"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${r.twilioCredentials?.accountSid?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r.twilioCredentials?.accountSid?"Configured":"Using Platform Default"})]}),e("p",{className:"text-xs text-zinc-500 mb-3",children:"Connect your Twilio account for custom SMS notifications."}),t("form",{onSubmit:s=>{s.preventDefault();const n=new FormData(s.currentTarget);g({twilioAccountSid:n.get("twilioAccountSid"),twilioAuthToken:n.get("twilioAuthToken"),twilioFromNumber:n.get("twilioFromNumber")})},className:"space-y-3",children:[e("input",{name:"twilioAccountSid",placeholder:"Account SID",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e("input",{name:"twilioFromNumber",placeholder:"From Number (+1...)",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e("input",{name:"twilioAuthToken",type:"password",placeholder:"Auth Token",className:"w-full text-sm border-zinc-300 rounded px-3 py-2"}),e("div",{className:"flex justify-end",children:e("button",{type:"submit",className:"text-xs bg-white border border-zinc-300 hover:bg-zinc-50 px-3 py-2 rounded font-medium",children:"Save Twilio"})})]})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(k,{className:"h-4 w-4"})," Customer Support Chat"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${r.settings?.chatEnabled!==!1?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:r.settings?.chatEnabled!==!1?"Enabled":"Disabled"})]}),e("p",{className:"text-xs text-zinc-500 mb-3",children:"Allow students to chat with you directly from your website and portal."}),e("div",{className:"flex items-center gap-4",children:e("button",{onClick:()=>{const s=r.settings?.chatEnabled!==!1;p(!s)},className:`px-3 py-2 text-xs font-medium rounded border ${r.settings?.chatEnabled!==!1?"bg-zinc-50 border-zinc-300 text-zinc-700":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:r.settings?.chatEnabled!==!1?"Disable Chat":"Enable Chat"})})]})]}),t("div",{className:"mb-8",children:[e("h2",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:"Class Aggregators"}),e("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-4",children:"Connect with external booking platforms to fill your classes."}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(b,{className:"h-4 w-4"})," ClassPass"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${i?.has("classpass")?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:i?.has("classpass")?"Active":"Inactive"})]}),e("p",{className:"text-xs text-zinc-500 mb-4",children:"Allow ClassPass users to book your classes. We'll sync your schedule automatically."}),e("button",{onClick:()=>h("classpass",!i?.has("classpass")),className:`px-3 py-2 text-xs font-medium rounded border ${i?.has("classpass")?"bg-zinc-50 border-zinc-300 text-zinc-700 hover:bg-zinc-100":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:i?.has("classpass")?"Disable ClassPass":"Enable ClassPass"})]}),t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(b,{className:"h-4 w-4"})," Gympass (Wellhub)"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${i?.has("gympass")?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:i?.has("gympass")?"Active":"Inactive"})]}),e("p",{className:"text-xs text-zinc-500 mb-4",children:"Connect with corporate wellness programs through Gympass."}),e("button",{onClick:()=>h("gympass",!i?.has("gympass")),className:`px-3 py-2 text-xs font-medium rounded border ${i?.has("gympass")?"bg-zinc-50 border-zinc-300 text-zinc-700 hover:bg-zinc-100":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:i?.has("gympass")?"Disable Gympass":"Enable Gympass"})]})]})]}),t("div",{className:"mb-8",children:[e("h2",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:"Progress Tracking"}),e("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-4",children:"Enable visual progress metrics for your members. Configure which metrics are visible based on your studio type."}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between mb-4",children:[t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(b,{className:"h-4 w-4"})," Advanced Progress Tracking"]}),e("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${i?.has("progress_tracking")?"bg-green-100 text-green-700":"bg-zinc-100 text-zinc-500"}`,children:i?.has("progress_tracking")?"Active":"Inactive"})]}),e("p",{className:"text-xs text-zinc-500 mb-4",children:"Show members their attendance streaks, class counts, and personal achievements. Metrics adapt based on your studio type."}),e("button",{onClick:()=>h("progress_tracking",!i?.has("progress_tracking")),className:`px-3 py-2 text-xs font-medium rounded border ${i?.has("progress_tracking")?"bg-zinc-50 border-zinc-300 text-zinc-700 hover:bg-zinc-100":"bg-blue-600 border-blue-600 text-white hover:bg-blue-700"}`,children:i?.has("progress_tracking")?"Disable Progress Tracking":"Enable Progress Tracking"})]}),i?.has("progress_tracking")&&t("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-5 shadow-sm",children:[e("div",{className:"flex items-center justify-between mb-4",children:t("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 flex items-center gap-2",children:[e(b,{className:"h-4 w-4"})," Studio Type"]})}),e("p",{className:"text-xs text-zinc-500 mb-3",children:"Select your studio type to show relevant metrics."}),t("form",{onSubmit:async s=>{s.preventDefault();const n=new FormData(s.currentTarget).get("studioType");try{const a=await window.Clerk?.session?.getToken();await l("/tenant/progress/settings",a,{method:"PUT",headers:{"X-Tenant-Slug":c||""},body:JSON.stringify({studioType:n})}),await l("/tenant/progress/seed-defaults",a,{method:"POST",headers:{"X-Tenant-Slug":c||""},body:JSON.stringify({studioType:n})}),o.success("Studio type saved."),window.location.reload()}catch(a){o.error(a.message||"Failed to save")}},className:"space-y-3",children:[t("select",{name:"studioType",defaultValue:r.settings?.progressTracking?.studioType||"yoga",className:"w-full text-sm border-zinc-300 dark:border-zinc-700 dark:bg-zinc-800 rounded px-3 py-2",children:[e("option",{value:"yoga",children:"Yoga / Mindfulness Studio"}),e("option",{value:"gym",children:"Gym / Fitness Center"}),e("option",{value:"hybrid",children:"Hybrid (Show All Metrics)"})]}),e("button",{type:"submit",className:"text-xs bg-blue-600 text-white border border-blue-600 hover:bg-blue-700 px-3 py-2 rounded font-medium",children:"Save Studio Type"})]})]})]})]}),e(x,{isOpen:C,onClose:()=>y(!1),onConfirm:async()=>{try{const s=window.Clerk?.session?.getToken?await window.Clerk.session.getToken():localStorage.getItem("token");await l(`/studios/${r.id}/integrations/google`,s,{method:"DELETE"}),o.success("Disconnected"),window.location.reload()}catch{o.error("Failed to disconnect")}finally{y(!1)}},title:"Disconnect Google Calendar",message:"Are you sure you want to disconnect Google Calendar?",isDestructive:!0,confirmText:"Disconnect"}),e(x,{isOpen:d!==null,onClose:()=>p(null),onConfirm:()=>{d!==null&&(g({chatEnabled:d}),p(null))},title:d?"Enable Chat Widget":"Disable Chat Widget",message:d?"Enable chat widget?":"Disable chat widget?",confirmText:d?"Enable":"Disable"}),e(x,{isOpen:!!u,onClose:()=>w(null),onConfirm:()=>{u&&(g({paymentProvider:u}),w(null))},title:"Switch Payment Provider",message:`Switch to ${u==="connect"?"Platform Managed":"Self Managed"} payments?`,confirmText:"Switch"})]}):e("div",{className:"p-8",children:e(A,{className:"animate-spin"})})}export{le as default};
