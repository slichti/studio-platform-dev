import{jsxs as t,jsx as e}from"react/jsx-runtime";import{useLoaderData as A,useSubmit as F,useFetcher as T}from"react-router";import{useState as a,useEffect as U}from"react";import{Package as k,Upload as P,Plus as Q,Search as E,Edit as L,Trash2 as O,X as j,Save as $}from"lucide-react";import{toast as q}from"sonner";import{C as J}from"./server-build-DYgJutU4.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function xe(){const{products:l}=A(),o=F(),[s,h]=a(""),[d,z]=a(""),[m,g]=a(null),[w,u]=a(!1),[C,p]=a(!1),[f,b]=a(null),S=[...new Set(l.map(n=>n.category).filter(Boolean))],x=l.filter(n=>!(s&&!n.name.toLowerCase().includes(s.toLowerCase())||d&&n.category!==d)),I=n=>{b(n)},v=()=>{f&&(o({intent:"delete",id:f},{method:"post"}),b(null),q.success("Product deleted"))},y=n=>`$${(n/100).toFixed(2)}`;return t("div",{className:"flex flex-col h-full bg-zinc-50",children:[t("header",{className:"bg-white border-b border-zinc-200 px-6 py-4",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center gap-3",children:[e("div",{className:"p-2 bg-zinc-900 rounded-lg text-white",children:e(k,{size:20})}),t("div",{children:[e("h1",{className:"text-xl font-bold text-zinc-900",children:"Retail"}),t("p",{className:"text-sm text-zinc-500",children:[l.length," products"]})]})]}),t("div",{className:"flex items-center gap-2",children:[t("button",{onClick:()=>p(!0),className:"px-3 py-2 border border-zinc-200 rounded-lg text-sm font-medium hover:bg-zinc-50 flex items-center gap-2",children:[e(P,{size:16})," Import"]}),t("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm font-medium hover:bg-zinc-800 flex items-center gap-2",children:[e(Q,{size:16})," Add Product"]})]})]}),t("div",{className:"flex gap-4 mt-4",children:[t("div",{className:"relative flex-1",children:[e(E,{className:"absolute left-3 top-2.5 h-4 w-4 text-zinc-400"}),e("input",{type:"text",placeholder:"Search products...",className:"w-full pl-9 pr-4 py-2 border border-zinc-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-black/5",value:s,onChange:n=>h(n.target.value)})]}),t("select",{value:d,onChange:n=>z(n.target.value),className:"px-4 py-2 border border-zinc-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-black/5",children:[e("option",{value:"",children:"All Categories"}),S.map(n=>e("option",{value:n,children:n},n))]})]})]}),e("div",{className:"flex-1 overflow-y-auto p-6",children:x.length===0?t("div",{className:"text-center py-20 text-zinc-500",children:[e(k,{size:48,className:"mx-auto mb-4 opacity-50"}),e("p",{children:"No products found"}),t("div",{className:"flex gap-2 justify-center mt-4",children:[e("button",{onClick:()=>u(!0),className:"text-sm text-zinc-900 underline",children:"Add manually"}),e("span",{className:"text-zinc-300",children:"|"}),e("button",{onClick:()=>p(!0),className:"text-sm text-zinc-900 underline",children:"Import JSON"})]})]}):e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:x.map(n=>t("div",{className:"bg-white rounded-lg border border-zinc-200 overflow-hidden group hover:border-zinc-300 transition",children:[t("div",{className:"aspect-square bg-zinc-100 relative",children:[n.imageUrl?e("img",{src:n.imageUrl,alt:n.name,className:"w-full h-full object-cover"}):e("div",{className:"w-full h-full flex items-center justify-center",children:e(k,{size:48,className:"text-zinc-300"})}),!n.isActive&&e("div",{className:"absolute top-2 left-2 px-2 py-1 bg-red-100 text-red-600 text-xs font-medium rounded",children:"Inactive"}),t("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition flex gap-1",children:[e("button",{onClick:()=>g(n),className:"p-1.5 bg-white rounded shadow hover:bg-zinc-50",children:e(L,{size:14})}),e("button",{onClick:()=>I(n.id),className:"p-1.5 bg-white rounded shadow hover:bg-red-50 text-red-500",children:e(O,{size:14})})]})]}),t("div",{className:"p-4",children:[t("div",{className:"flex items-start justify-between",children:[t("div",{children:[e("h3",{className:"font-medium text-zinc-900",children:n.name}),e("p",{className:"text-sm text-zinc-500",children:n.category||"Uncategorized"})]}),e("span",{className:"text-lg font-bold text-zinc-900",children:y(n.price)})]}),t("div",{className:"mt-3 flex items-center justify-between text-xs text-zinc-500",children:[t("span",{className:`flex items-center gap-1 ${n.stockQuantity<=(n.lowStockThreshold||5)?"text-amber-600 font-medium":""}`,children:[e(k,{size:12})," ",n.stockQuantity," in stock",n.stockQuantity<=(n.lowStockThreshold||5)&&e("span",{className:"text-[10px] bg-amber-100 px-1 rounded border border-amber-200",children:"LOW"})]}),n.sku&&e("span",{className:"font-mono",children:n.sku})]})]})]},n.id))})}),(m||w)&&e(M,{product:m,onClose:()=>{g(null),u(!1)},onSave:n=>{const r=new FormData;r.append("intent",m?"update":"create"),m&&r.append("id",m.id),Object.entries(n).forEach(([c,N])=>{r.append(c,String(N))}),o(r,{method:"post"}),g(null),u(!1)}}),C&&e(R,{onClose:()=>p(!1),onImport:n=>{const r=new FormData;r.append("intent","import_products"),r.append("products",n),o(r,{method:"post"}),p(!1)}}),e(J,{isOpen:!!f,onClose:()=>b(null),onConfirm:v,title:"Delete Product",message:"Are you sure you want to delete this product? This action cannot be undone.",confirmText:"Delete Product",isDestructive:!0})]})}function M({product:l,onClose:o,onSave:s}){const[h,d]=a(l?.name||""),[z,m]=a(l?.description||""),[g,w]=a(l?.category||""),[u,C]=a(l?.sku||""),[p,f]=a(l?.price?(l.price/100).toFixed(2):""),[b,S]=a(l?.stockQuantity?.toString()||"0"),[x,I]=a(l?.lowStockThreshold?.toString()||"5"),[v,y]=a(l?.imageUrl||""),[n,r]=a(l?.isActive!==!1),c=T(),N=c.state!=="idle";return U(()=>{c.data&&c.data.url&&c.data.url!==v&&y(c.data.url)},[c.data]),e("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm overflow-y-auto",children:t("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",children:[t("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[e("h2",{className:"text-lg font-bold",children:l?"Edit Product":"New Product"}),e("button",{onClick:o,children:e(j,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),t("form",{onSubmit:i=>{i.preventDefault(),s({name:h,description:z,category:g,sku:u,price:Math.round(parseFloat(p||"0")*100),stockQuantity:parseInt(b||"0"),lowStockThreshold:parseInt(x||"5"),imageUrl:v,isActive:n})},className:"p-6 space-y-4",children:[t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"col-span-2",children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Name *"}),e("input",{type:"text",required:!0,value:h,onChange:i=>d(i.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Price ($)"}),e("input",{type:"number",step:"0.01",value:p,onChange:i=>f(i.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Stock"}),e("input",{type:"number",value:b,onChange:i=>S(i.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Low Warning At"}),e("input",{type:"number",value:x,onChange:i=>I(i.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Category"}),e("input",{type:"text",value:g,onChange:i=>w(i.target.value),placeholder:"e.g. Apparel",className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"SKU"}),e("input",{type:"text",value:u,onChange:i=>C(i.target.value),className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 font-mono"})]}),t("div",{className:"col-span-2",children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Description"}),e("textarea",{value:z,onChange:i=>m(i.target.value),rows:3,className:"w-full px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5 resize-none"})]}),t("div",{className:"col-span-2",children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Image"}),t("div",{className:"flex gap-2",children:[e("input",{type:"url",value:v,onChange:i=>y(i.target.value),placeholder:"https://...",className:"flex-1 px-3 py-2 border border-zinc-200 rounded-lg outline-none focus:ring-2 focus:ring-black/5"}),t("label",{className:`px-3 py-2 border border-zinc-200 rounded-lg bg-zinc-50 hover:bg-zinc-100 cursor-pointer flex items-center gap-2 ${N?"opacity-50 pointer-events-none":""}`,children:[e("input",{type:"file",accept:"image/*",className:"hidden",onChange:i=>{if(i.target.files&&i.target.files[0]){const D=new FormData;D.append("intent","upload_image"),D.append("file",i.target.files[0]),c.submit(D,{method:"post",encType:"multipart/form-data"})}},disabled:N}),e(P,{size:16,className:"text-zinc-500"}),e("span",{className:"text-sm font-medium text-zinc-600",children:N?"...":"Upload"})]})]})]}),t("div",{className:"col-span-2 flex items-center gap-2",children:[e("input",{type:"checkbox",id:"isActive",checked:n,onChange:i=>r(i.target.checked),className:"w-4 h-4"}),e("label",{htmlFor:"isActive",className:"text-sm text-zinc-700",children:"Active (visible to customers)"})]})]}),t("div",{className:"pt-4 flex justify-end gap-3 border-t border-zinc-100",children:[e("button",{type:"button",onClick:o,className:"px-4 py-2 text-sm font-medium text-zinc-500 hover:text-zinc-700",children:"Cancel"}),t("button",{type:"submit",className:"px-4 py-2 text-sm font-medium bg-zinc-900 text-white rounded-lg hover:bg-zinc-800 flex items-center gap-2",children:[e($,{size:16})," ",l?"Save Changes":"Create Product"]})]})]})]})})}function R({onClose:l,onImport:o}){const[s,h]=a("");return e("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm overflow-y-auto",children:t("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full animate-in fade-in zoom-in duration-200",children:[t("div",{className:"p-4 border-b border-zinc-200 flex justify-between items-center",children:[e("h2",{className:"text-lg font-bold",children:"Import Products"}),e("button",{onClick:l,children:e(j,{size:20,className:"text-zinc-400 hover:text-zinc-600"})})]}),t("div",{className:"p-6",children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Paste JSON Array"}),e("textarea",{value:s,onChange:d=>h(d.target.value),className:"w-full h-64 p-3 border border-zinc-200 rounded-lg font-mono text-xs",placeholder:'[{"name": "Product 1", "price": 1000}, ...]'}),e("p",{className:"text-xs text-zinc-500 mt-2",children:"Required: name, price (cents). Optional: description, sku, category."})]}),t("div",{className:"p-4 border-t border-zinc-200 flex justify-end gap-2",children:[e("button",{onClick:l,className:"px-4 py-2 text-sm text-zinc-500",children:"Cancel"}),e("button",{onClick:()=>o(s),disabled:!s,className:"px-4 py-2 bg-zinc-900 text-white rounded-lg text-sm disabled:opacity-50",children:"Import"})]})]})})}export{xe as default};
