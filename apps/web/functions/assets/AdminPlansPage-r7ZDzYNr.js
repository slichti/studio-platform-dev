import{jsx as e,jsxs as r}from"react/jsx-runtime";import{a as g}from"./server-build-DYgJutU4.js";import{useState as m,useEffect as T}from"react";import{RefreshCw as $,Check as N,X as w,Edit3 as U,Plus as B}from"lucide-react";import{toast as h}from"sonner";import{useAuth as O}from"@clerk/react-router";import"react-router-dom";import"isbot";import"react-dom/server";import"react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function pe(){const{getToken:x}=O(),[z,y]=m([]),[k,S]=m(!0);T(()=>{async function t(){try{const i=await x(),s=await g("/admin/plans",i);Array.isArray(s)&&y(s)}catch(i){console.error(i),h.error("Failed to load plans")}finally{S(!1)}}t()},[x]);const C=async()=>{const t=await x();h.promise(g("/admin/plans/sync",t,{method:"POST"}),{loading:"Syncing with Stripe...",success:i=>(g("/admin/plans",t).then(s=>y(s)),`Synced ${i.synced||0} prices`),error:"Sync failed"})},P=async(t,i)=>{const s=await x();try{await g(`/admin/plans/${t}`,s,{method:"PUT",body:JSON.stringify(i)}),h.success("Plan updated"),y(u=>u.map(o=>o.id===t?{...o,...i}:o))}catch{h.error("Update failed")}},A={"Core Features":["Unlimited Students","Basic Financials & Reporting","Waiver Management","Visual Website Builder","Retail Point of Sale (POS)","Transactional Email Notifications","Class Packs & Drop-ins"],"Growth & Marketing":["Zoom Integration (Auto-Meeting)","Video on Demand (VOD)","Marketing Automations (Win-back, Welcome)","Inventory Tracking & Low Stock Alerts","SMS Notifications & Marketing","Recurring Memberships"],"Scale & Enterprise":["White Label Branding Options","API Access","Priority Support","Dedicated Account Manager","0% Platform Fees"],"Common Limits":["5 Instructors","15 Instructors","Unlimited Instructors","1 Location","3 Locations","Unlimited Locations","5GB Storage","50GB Storage","1TB Video Storage"]},F=({features:t,onChange:i})=>{const[s,u]=m(""),[o,I]=m(!1),v=a=>{const c=a.trim();c&&!t.includes(c)&&(i([...t,c]),u(""))},M=a=>{i(t.filter((c,d)=>d!==a))};return r("div",{className:"space-y-3 min-w-[400px]",children:[r("div",{className:"space-y-2",children:[t.map((a,c)=>e("div",{className:"flex gap-2 group",children:r("div",{className:"flex-1 px-3 py-2 bg-white border border-zinc-200 rounded text-sm flex items-center justify-between shadow-sm",children:[e("span",{children:a}),e("button",{onClick:()=>M(c),className:"text-zinc-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e(w,{size:14})})]})},c)),t.length===0&&e("div",{className:"text-zinc-400 text-sm italic py-2",children:"No features added yet."})]}),r("div",{className:"flex gap-2",children:[e("input",{value:s,onChange:a=>u(a.target.value),onKeyDown:a=>a.key==="Enter"&&(a.preventDefault(),v(s)),className:"flex-1 border border-zinc-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Type functionality or limit..."}),e("button",{onClick:()=>v(s),className:"bg-zinc-900 hover:bg-zinc-800 text-white px-3 py-2 rounded transition-colors",children:e(B,{size:16})})]}),r("div",{className:"pt-2 border-t border-zinc-100",children:[e("button",{onClick:()=>I(!o),className:"text-xs font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:o?"Hide Feature Library":"+ Add from Feature Library"}),o&&e("div",{className:"mt-3 grid grid-cols-1 gap-4 p-4 bg-zinc-50 border border-zinc-200 rounded-lg shadow-inner max-h-[300px] overflow-y-auto",children:Object.entries(A).map(([a,c])=>r("div",{children:[e("h5",{className:"font-bold text-[10px] uppercase tracking-wider text-zinc-500 mb-2",children:a}),e("div",{className:"flex flex-wrap gap-2",children:c.map(d=>{const f=t.includes(d);return r("button",{onClick:()=>!f&&v(d),disabled:f,className:`text-xs px-2 py-1.5 rounded border transition-all text-left
                                                        ${f?"bg-blue-50 border-blue-200 text-blue-700 cursor-default opactiy-70":"bg-white border-zinc-200 hover:border-blue-300 hover:shadow-sm text-zinc-700 hover:translate-y-[-1px]"}`,children:[f&&e(N,{size:10,className:"inline mr-1"}),d]},d)})})]},a))})]})]})},[l,b]=m(null),[n,p]=m({}),D=t=>{b(t.id);const i=Array.isArray(t.features)?t.features:[];p({name:t.name,trialDays:t.trialDays,features:i,active:t.active})},L=async()=>{try{await P(l,{name:n.name,trialDays:parseInt(n.trialDays),features:n.features,active:n.active}),b(null)}catch{h.error("Update failed")}},E=({active:t})=>e("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t?"Active":"Inactive"});return k?e("div",{className:"p-10",children:"Loading plans..."}):r("div",{className:"p-6 max-w-7xl mx-auto",children:[r("div",{className:"flex justify-between items-center mb-6",children:[r("div",{children:[e("h1",{className:"text-2xl font-bold text-zinc-900",children:"Platform Plans"}),e("p",{className:"text-zinc-500",children:"Manage SaaS tiers, pricing, and features."})]}),e("div",{className:"flex gap-2",children:r("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-white border border-zinc-200 rounded-lg hover:bg-zinc-50 text-zinc-700 font-medium transition-colors",children:[e($,{size:16})," Sync Stripe"]})})]}),e("div",{className:"bg-white rounded-xl shadow-sm border border-zinc-200 overflow-hidden",children:r("table",{className:"min-w-full divide-y divide-zinc-200",children:[e("thead",{className:"bg-zinc-50",children:r("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Plan"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Pricing (Stripe)"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Trial"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider w-1/3",children:"Features"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-zinc-200",children:z.map(t=>r("tr",{className:"hover:bg-zinc-50 transition-colors align-top",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:l===t.id?e("input",{value:n.name,onChange:i=>p({...n,name:i.target.value}),className:"border rounded px-2 py-1 w-full font-medium"}):r("div",{children:[e("div",{className:"font-medium text-zinc-900",children:t.name}),e("div",{className:"text-xs text-zinc-500 font-mono",children:t.slug})]})}),r("td",{className:"px-6 py-4 whitespace-nowrap",children:[r("div",{className:"text-sm text-zinc-900",children:["Monthly: ",t.monthlyPriceCents?`$${t.monthlyPriceCents/100}/mo`:"Free"]}),r("div",{className:"text-xs text-zinc-500",children:["Annual: ",t.annualPriceCents?`$${t.annualPriceCents/100}/yr`:"Free"]})]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-500",children:l===t.id?r("div",{className:"flex items-center gap-1",children:[e("input",{type:"number",value:n.trialDays,onChange:i=>p({...n,trialDays:i.target.value}),className:"border rounded px-2 py-1 w-16"})," days"]}):`${t.trialDays} Days`}),e("td",{className:"px-6 py-4 text-sm text-zinc-500",children:l===t.id?e(F,{features:n.features,onChange:i=>p({...n,features:i})}):r("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[(t.features||[]).map((i,s)=>r("div",{className:"flex items-start gap-2 text-xs",children:[e(N,{size:12,className:"mt-0.5 text-green-500 flex-shrink-0"}),e("span",{children:i})]},s)),(t.features||[]).length===0&&e("span",{className:"text-zinc-400 italic",children:"No features configured"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:l===t.id?r("select",{value:n.active?"true":"false",onChange:i=>p({...n,active:i.target.value==="true"}),className:"border rounded px-2 py-1 text-sm",children:[e("option",{value:"true",children:"Active"}),e("option",{value:"false",children:"Inactive"})]}):e(E,{active:t.active})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:l===t.id?r("div",{className:"flex justify-end gap-2",children:[e("button",{onClick:L,className:"text-green-600 hover:text-green-900 bg-green-50 p-1 rounded",children:e(N,{size:18})}),e("button",{onClick:()=>b(null),className:"text-zinc-400 hover:text-zinc-600 bg-zinc-50 p-1 rounded",children:e(w,{size:18})})]}):e("button",{onClick:()=>D(t),className:"text-blue-600 hover:text-blue-900",children:e(U,{size:18})})})]},t.id))})]})})]})}export{pe as default};
