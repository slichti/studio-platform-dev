import{jsxs as n,jsx as e}from"react/jsx-runtime";import{useLoaderData as C,useParams as k,useFetcher as S,Link as A}from"react-router";import{useState as d,useEffect as w}from"react";import{UserPlus as I,StickyNote as T,X as v}from"lucide-react";import{g as L,a as g}from"./server-build-tAMGW7nt.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function j({method:a}){switch(a){case"subscription":return e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Membership"});case"credit":return e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"Credit"});case"drop_in":return e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:"Pay Later"});case"free":return e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Free"});default:return e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 text-zinc-500",children:"Unknown"})}}function de(){const{bookings:a}=C(),{slug:c,id:x}=k(),l=S(),f=a.filter(t=>t.status==="confirmed"),m=a.filter(t=>t.status==="waitlisted"),[u,N]=d(null),[p,o]=d(!1),[b,i]=d(!1),[r,s]=d(null),h=()=>{r&&(l.submit({intent:"cancel_booking",bookingId:r},{method:"post"}),s(null))},y=a.find(t=>t.memberId===u);return n("div",{className:"relative",children:[n("div",{className:"flex items-center justify-between mb-6",children:[n("div",{className:"flex items-center gap-4",children:[e(A,{to:`/studio/${c}/schedule`,className:"text-zinc-500 hover:text-zinc-800 font-medium text-sm flex items-center gap-1",children:"â† Back to Schedule"}),e("div",{className:"h-6 w-px bg-zinc-300"}),e("h2",{className:"text-2xl font-bold",children:"Class Roster"})]}),n("button",{onClick:()=>i(!0),className:"flex items-center gap-2 bg-zinc-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-zinc-800",children:[e(I,{size:16})," Add Student"]})]}),n("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm mb-8",children:[n("div",{className:"px-6 py-4 border-b border-zinc-200 bg-zinc-50 text-zinc-900 font-semibold text-zinc-900",children:["Attending (",f.length,")"]}),n("table",{className:"w-full text-left",children:[e("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:n("tr",{children:[e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",children:"Student"}),e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",children:"Payment"}),e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",children:"Waiver"}),e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",children:"Status"}),e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase",children:"Attendance"}),e("th",{className:"px-6 py-3 text-xs font-semibold text-zinc-500 uppercase text-right",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-zinc-100",children:f.map(t=>n("tr",{className:"hover:bg-zinc-50",children:[e("td",{className:"px-6 py-4",children:n("div",{className:"flex items-center gap-3",children:[e("div",{className:"h-8 w-8 rounded-full bg-zinc-200 flex items-center justify-center text-xs font-bold text-zinc-500",children:t.user.profile?.firstName?.[0]||t.user.email[0].toUpperCase()}),e("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"}),e("button",{onClick:()=>{N(t.memberId),o(!0)},className:`p-1.5 rounded-full ${t.hasNotes?"bg-amber-100 text-amber-600":"text-zinc-400"}`,children:e(T,{size:14,className:t.hasNotes?"fill-current":""})})]})}),e("td",{className:"px-6 py-4",children:e(j,{method:t.paymentMethod})}),e("td",{className:"px-6 py-4",children:t.waiverSigned?e("span",{className:"text-green-600 text-xs font-medium",children:"Signed"}):e("span",{className:"text-amber-600 text-xs font-bold animate-pulse",children:"Needs Signature"})}),e("td",{className:"px-6 py-4",children:e("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:"Confirmed"})}),e("td",{className:"px-6 py-4",children:n(l.Form,{method:"post",children:[e("input",{type:"hidden",name:"bookingId",value:t.id}),e("input",{type:"hidden",name:"intent",value:"check_in"}),e("button",{name:"checkedIn",value:t.checkedInAt?"false":"true",className:`px-2.5 py-1 rounded-full text-xs font-medium ${t.checkedInAt?"bg-green-100 text-green-800":"bg-zinc-100 text-zinc-500"}`,children:t.checkedInAt?"Checked In":"Mark Present"})]})}),e("td",{className:"px-6 py-4 text-right",children:e("button",{onClick:()=>s(t.id),className:"text-red-600 text-xs font-medium",children:"Cancel"})})]},t.id))})]})]}),m.length>0&&n("div",{className:"bg-white border border-zinc-200 rounded-lg overflow-hidden shadow-sm",children:[n("div",{className:"px-6 py-4 border-b border-zinc-200 bg-amber-50 flex justify-between items-center text-amber-900 font-semibold text-amber-900",children:["Waitlist (",m.length,")"]}),e("table",{className:"w-full text-left",children:e("tbody",{className:"divide-y divide-zinc-100",children:m.map((t,z)=>n("tr",{className:"hover:bg-zinc-50",children:[e("td",{className:"px-6 py-4",children:n("div",{className:"flex items-center gap-3",children:[n("span",{className:"text-zinc-500 text-sm",children:[z+1,"."]}),e("div",{className:"font-medium text-zinc-900",children:t.user.profile?.fullName||"Unknown Student"})]})}),n("td",{className:"px-6 py-4 text-right",children:[n(l.Form,{method:"post",className:"inline mr-3",children:[e("input",{type:"hidden",name:"bookingId",value:t.id}),e("input",{type:"hidden",name:"intent",value:"promote"}),e("button",{className:"bg-green-600 text-white px-3 py-1 rounded text-xs",children:"Promote"})]}),e("button",{onClick:()=>s(t.id),className:"text-red-600 text-xs text-red-600",children:"Remove"})]})]},t.id))})})]}),b&&e(P,{classId:x,slug:c,onClose:()=>i(!1)}),p&&u&&e(O,{memberId:u,studentName:y?.user.profile?.fullName||y?.user.email||"Student",onClose:()=>o(!1),slug:c}),e(L,{open:!!r,onOpenChange:t=>!t&&s(null),onConfirm:h,title:"Cancel Booking",description:"Are you sure you want to cancel this booking?",confirmText:"Cancel",variant:"destructive"})]})}function P({classId:a,slug:c,onClose:x}){const[l,f]=d(""),[m,u]=d([]),[N,p]=d(!1),[o,b]=d(null);w(()=>{(async()=>{p(!0);try{const s=await window.Clerk?.session?.getToken(),h=await g("/members",s,{headers:{"X-Tenant-Slug":c}});u(h.members||[])}finally{p(!1)}})()},[c]);const i=m.filter(s=>(s.user?.profile?.fullName||"").toLowerCase().includes(l.toLowerCase())||(s.user?.email||"").toLowerCase().includes(l.toLowerCase())).slice(0,5),r=async s=>{b(s);try{const h=await window.Clerk?.session?.getToken();await g(`/classes/${a}/book`,h,{method:"POST",headers:{"X-Tenant-Slug":c},body:JSON.stringify({memberId:s})}),x(),window.location.reload()}catch(h){alert(h.message)}finally{b(null)}};return e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:n("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-4",children:[n("div",{className:"flex justify-between items-center mb-4 text-zinc-900",children:[e("h3",{className:"font-bold",children:"Add Student"}),e("button",{onClick:x,children:e(v,{size:20})})]}),e("input",{value:l,onChange:s=>f(s.target.value),placeholder:"Search...",className:"w-full p-2 border rounded mb-4"}),e("div",{className:"space-y-2",children:N?"Loading...":i.map(s=>n("div",{className:"flex justify-between items-center p-2 border rounded",children:[e("div",{className:"text-zinc-900 font-medium",children:s.user?.profile?.fullName||s.user?.email}),e("button",{onClick:()=>r(s.id),disabled:!!o,className:"px-3 py-1 bg-zinc-900 text-white rounded text-xs",children:o===s.id?"...":"Add"})]},s.id))})]})})}function O({memberId:a,studentName:c,onClose:x,slug:l}){const[f,m]=d([]),[u,N]=d(!0),[p,o]=d("");w(()=>{(async()=>{try{const i=await window.Clerk?.session?.getToken(),r=await g(`/members/${a}/notes`,i,{headers:{"X-Tenant-Slug":l}});m(r.notes||[])}finally{N(!1)}})()},[a]);const b=async i=>{i.preventDefault();try{const r=await window.Clerk?.session?.getToken();await g(`/members/${a}/notes`,r,{method:"POST",headers:{"X-Tenant-Slug":l},body:JSON.stringify({note:p})}),o(""),window.location.reload()}catch{alert("Error adding note")}};return e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:n("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[80vh] p-4 text-zinc-900",children:[n("div",{className:"flex justify-between items-center mb-4",children:[n("h3",{className:"font-bold text-lg",children:["Notes: ",c]}),e("button",{onClick:x,children:e(v,{size:20})})]}),e("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4",children:u?"Loading...":f.map(i=>n("div",{className:"p-3 bg-yellow-50 border rounded-lg text-sm text-zinc-800",children:[i.note,n("div",{className:"mt-1 text-[10px] text-zinc-500",children:[new Date(i.createdAt).toLocaleDateString()," by staff"]})]},i.id))}),n("form",{onSubmit:b,className:"space-y-2",children:[e("textarea",{value:p,onChange:i=>o(i.target.value),required:!0,className:"w-full p-2 border rounded",placeholder:"Add note..."}),e("button",{type:"submit",className:"w-full py-2 bg-zinc-900 text-white rounded text-sm",children:"Add Note"})]})]})})}export{de as default};
