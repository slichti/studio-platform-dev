import{jsxs as i,jsx as e}from"react/jsx-runtime";import{useLoaderData as se,useSubmit as le,useSearchParams as de,useRevalidator as ce}from"react-router";import{C as M,E as oe,p as me,n as D,a as O}from"./server-build-tAMGW7nt.js";import{Upload as q,Film as pe,MonitorPlay as xe,Search as he,Filter as ue,Play as be,Eye as ge,Trash2 as G,Share2 as fe,CheckCircle as J,X as V,RefreshCw as L,AlertCircle as ze}from"lucide-react";import{useState as n}from"react";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function Xe(){const{videos:s,stats:o,brandingAssets:U,tenants:m}=se(),A=le(),[I,p]=de(),x=I.get("tab")||"videos",_=ce(),[P,Q]=n(I.get("q")||""),[h,X]=n(""),[r,u]=n(null),[Y,b]=n(!1),[g,j]=n(""),[f,B]=n("vod"),[z,F]=n(!1),[H,l]=n(null),[d,v]=n(null),[c,$]=n(""),[N,y]=n(null),[k,w]=n(null),[S,C]=n({isOpen:!1,message:""}),[T,E]=n({isOpen:!1,message:""}),K=async()=>{if(!(!d||!c))try{const t=await window.Clerk?.session?.getToken();await O(`/admin/videos/${d.id}/share`,t,{method:"POST",body:JSON.stringify({tenantId:c})}),E({isOpen:!0,message:"Video shared successfully!"}),v(null),$("")}catch(t){console.error(t),C({isOpen:!0,message:"Share failed"})}},W=t=>{t.preventDefault(),p(a=>(a.set("q",P),a))},Z=()=>{N&&(A({intent:"delete_video",id:N},{method:"post"}),y(null))},ee=()=>{k&&(A({intent:"delete_branding",id:k},{method:"post"}),w(null))},te=async t=>{F(!0),l("Getting upload URL...");try{const a=await window.Clerk?.session?.getToken(),ne=await O("/admin/videos/upload-url",a,{method:"POST",body:JSON.stringify({targetTenantId:g,type:f})}),{uploadUrl:re,uid:ae}=ne;l("Uploading to Cloudflare...");const R=new FormData;if(R.append("file",t),!(await fetch(re,{method:"POST",body:R})).ok)throw new Error("Upload to video server failed");l("Registering asset..."),await O("/admin/videos",a,{method:"POST",body:JSON.stringify({targetTenantId:g,type:f,title:t.name,cloudflareStreamId:ae,description:"Uploaded by Admin"})}),l("Done!"),b(!1),_.revalidate(),j(""),B("vod")}catch(a){console.error(a),C({isOpen:!0,message:"Upload failed: "+a.message})}finally{F(!1),l(null)}},ie=s.filter(t=>!(h&&t.tenantId!==h));return i("div",{className:"space-y-6 relative",children:[e(M,{isOpen:!!N,onClose:()=>y(null),onConfirm:Z,title:"Delete Video",message:"Are you sure you want to force delete this video? This cannot be undone.",confirmText:"Delete Video",isDestructive:!0}),e(M,{isOpen:!!k,onClose:()=>w(null),onConfirm:ee,title:"Delete Branding Asset",message:"Are you sure you want to delete this branding asset?",confirmText:"Delete Asset",isDestructive:!0}),e(oe,{isOpen:S.isOpen,onClose:()=>C({...S,isOpen:!1}),message:S.message}),e(me,{isOpen:T.isOpen,onClose:()=>E({...T,isOpen:!1}),message:T.message}),i("div",{className:"flex justify-between items-start",children:[i("div",{children:[e("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Platform Video Management"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Monitor storage usage and manage video assets across all studios."})]}),i("button",{onClick:()=>b(!0),className:"bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 transition flex items-center gap-2",children:[e(q,{size:16}),"Upload Asset"]})]}),i("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",children:"Total Videos"}),e("div",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:o.totalVideos})]}),i("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",children:"Total Storage"}),e("div",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:D(o.totalStorageBytes)})]}),i("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm",children:[e("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium uppercase tracking-wider",children:"Processing"}),e("div",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:o.processingCount})]})]}),i("div",{className:"border-b border-zinc-200 flex flex-col md:flex-row md:items-center justify-between gap-4 pb-0",children:[i("nav",{className:"-mb-px flex space-x-8",children:[i("button",{onClick:()=>p({tab:"videos"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${x==="videos"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e(pe,{size:16}),"Studio Videos",e("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:s.length})]}),i("button",{onClick:()=>p({tab:"branding"}),className:`
                            whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                            ${x==="branding"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                        `,children:[e(xe,{size:16}),"Branding Assets",e("span",{className:"bg-gray-100 text-gray-900 py-0.5 px-2 rounded-full text-xs ml-1",children:U.length})]})]}),i("div",{className:"flex items-center gap-2 pb-2 md:pb-0",children:[i("form",{onSubmit:W,className:"relative",children:[e(he,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-zinc-400"}),e("input",{type:"search",placeholder:"Search videos...",value:P,onChange:t=>Q(t.target.value),className:"pl-9 pr-4 py-2 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm w-64 focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100"})]}),i("div",{className:"relative",children:[i("select",{value:h,onChange:t=>X(t.target.value),className:"pl-3 pr-8 py-2 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm appearance-none bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent outline-none cursor-pointer",children:[e("option",{value:"",children:"All Tenants"}),m.map(t=>e("option",{value:t.id,children:t.name},t.id))]}),e(ue,{className:"absolute right-2.5 top-2.5 h-4 w-4 text-zinc-400 pointer-events-none"})]})]})]}),x==="videos"?e("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:i("table",{className:"w-full text-sm text-left",children:[e("thead",{className:"bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-medium",children:i("tr",{children:[e("th",{className:"px-4 py-3",children:"Video"}),e("th",{className:"px-4 py-3",children:"Tenant"}),e("th",{className:"px-4 py-3",children:"Status"}),e("th",{className:"px-4 py-3",children:"Size"}),e("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:ie.map(t=>i("tr",{className:"hover:bg-zinc-50/50 dark:hover:bg-zinc-800/50 group",children:[e("td",{className:"px-4 py-3",children:i("div",{className:"flex items-center gap-3",children:[e("div",{className:"w-10 h-10 bg-zinc-100 dark:bg-zinc-800 rounded flex items-center justify-center text-zinc-400 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-zinc-600 dark:hover:text-zinc-300 transition",onClick:()=>u(t),children:e(be,{size:16,fill:"currentColor"})}),i("div",{children:[e("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:t.title||"Untitled"}),e("div",{className:"text-xs text-zinc-400 font-mono",children:t.id})]})]})}),i("td",{className:"px-4 py-3",children:[e("div",{className:"text-zinc-900 dark:text-zinc-100",children:t.tenantName||e("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 border border-zinc-200 dark:border-zinc-700",children:"Platform"})}),t.tenantSlug&&e("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:t.tenantSlug})]}),e("td",{className:"px-4 py-3",children:e(ve,{status:t.status})}),e("td",{className:"px-4 py-3 text-zinc-600 dark:text-zinc-400 font-mono",children:D(t.sizeBytes)}),e("td",{className:"px-4 py-3 text-right",children:i("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex justify-end gap-2",children:[e("button",{onClick:()=>u(t),className:"p-1 text-zinc-400 hover:text-blue-600 hover:bg-blue-50 rounded transition",title:"Preview",children:e(ge,{size:16})}),e("button",{onClick:()=>y(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e(G,{size:16})}),!t.tenantId&&e("button",{onClick:()=>v(t),className:"p-1 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition",title:"Share with Tenant",children:e(fe,{size:16})})]})})]},t.id))})]})}):e("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:i("table",{className:"w-full text-sm text-left",children:[e("thead",{className:"bg-zinc-50 dark:bg-zinc-900/50 border-b border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-medium",children:i("tr",{children:[e("th",{className:"px-4 py-3",children:"Asset Title"}),e("th",{className:"px-4 py-3",children:"Type"}),e("th",{className:"px-4 py-3",children:"Tenant"}),e("th",{className:"px-4 py-3",children:"Active"}),e("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-zinc-100",children:U.map(t=>i("tr",{className:"hover:bg-zinc-50/50",children:[i("td",{className:"px-4 py-3",children:[e("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:t.title}),e("div",{className:"text-xs text-zinc-400 font-mono truncate max-w-[150px]",children:t.cloudflareStreamId})]}),e("td",{className:"px-4 py-3",children:e("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize ${t.type==="intro"?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300":"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300"}`,children:t.type})}),i("td",{className:"px-4 py-3",children:[e("div",{className:"text-zinc-900 dark:text-zinc-100",children:t.tenantName}),e("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:t.tenantSlug})]}),e("td",{className:"px-4 py-3 text-zinc-600 dark:text-zinc-400 font-mono",children:t.active?i("span",{className:"text-emerald-600 flex items-center gap-1 text-xs font-semibold",children:[e(J,{size:12})," Yes"]}):e("span",{className:"text-zinc-400 text-xs",children:"No"})}),e("td",{className:"px-4 py-3 text-right",children:e("button",{onClick:()=>w(t.id),className:"p-1 text-zinc-400 hover:text-red-600 hover:bg-red-50 rounded transition",title:"Force Delete",children:e(G,{size:16})})})]},t.id))})]})}),Y&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm overflow-y-auto",children:i("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200 border border-zinc-200 dark:border-zinc-800",children:[i("div",{className:"flex justify-between items-center mb-6",children:[e("h2",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100",children:"Upload Video"}),e("button",{onClick:()=>b(!1),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:e(V,{size:20})})]}),i("div",{className:"space-y-4",children:[i("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Target"}),i("select",{className:"w-full rounded-lg border-zinc-200 dark:border-zinc-700 text-sm bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100",value:g,onChange:t=>j(t.target.value),children:[e("option",{value:"",children:"Platform Master Asset (No Tenant)"}),e("optgroup",{label:"Tenants",children:m.map(t=>i("option",{value:t.id,children:[t.name," (",t.slug,")"]},t.id))})]})]}),i("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"Asset Type"}),e("div",{className:"grid grid-cols-3 gap-2",children:["vod","intro","outro"].map(t=>e("button",{onClick:()=>B(t),className:`px-3 py-2 text-sm rounded-md border text-center ${f===t?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900":"bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:t.toUpperCase()},t))})]}),i("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",children:"File"}),i("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition cursor-pointer relative ${z?"bg-zinc-50 dark:bg-zinc-900":""}`,children:[e("input",{type:"file",accept:"video/*",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:z,onChange:t=>t.target.files?.[0]&&te(t.target.files[0])}),z?i("div",{className:"flex flex-col items-center gap-2",children:[e(L,{className:"animate-spin text-zinc-400"}),e("span",{className:"text-sm text-zinc-500",children:H})]}):i("div",{className:"flex flex-col items-center gap-2",children:[e(q,{size:20,className:"text-zinc-400"}),e("span",{className:"text-sm text-zinc-600 font-medium",children:"Click or Drag video here"})]})]})]})]})]})}),r&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm overflow-y-auto",children:i("div",{className:"bg-black rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden flex flex-col max-h-[90vh]",children:[i("div",{className:"p-4 flex justify-between items-center border-b border-zinc-800",children:[e("h2",{className:"text-lg font-bold text-white max-w-2xl truncate",children:r.title}),e("button",{onClick:()=>u(null),className:"text-zinc-400 hover:text-white",children:e(V,{size:24})})]}),e("div",{className:"flex-1 bg-black aspect-video relative",children:r.cloudflareStreamId?e("iframe",{src:`https://iframe.videodelivery.net/${r.cloudflareStreamId}`,className:"w-full h-full absolute inset-0",allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0}):e("div",{className:"flex items-center justify-center h-full text-zinc-500",children:"Video not available"})}),i("div",{className:"p-4 bg-zinc-900 border-t border-zinc-800 text-sm text-zinc-400 flex gap-4",children:[i("div",{children:[e("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Duration"}),r.duration?Math.floor(r.duration/60)+"m "+r.duration%60+"s":"--"]}),i("div",{children:[e("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Size"}),D(r.sizeBytes)]}),i("div",{children:[e("span",{className:"block text-zinc-600 text-xs uppercase font-bold",children:"Status"}),e("span",{className:"capitalize",children:r.status})]})]})]})}),d&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:i("div",{className:"bg-white dark:bg-zinc-900 rounded-xl shadow-xl max-w-sm w-full p-6 border border-zinc-200 dark:border-zinc-800",children:[i("div",{className:"flex justify-between items-center mb-6",children:[e("h2",{className:"text-lg font-bold text-zinc-900 dark:text-zinc-100",children:"Share Video"}),e("button",{onClick:()=>v(null),className:"text-zinc-400",children:e(V,{size:20})})]}),i("p",{className:"text-sm text-zinc-500 mb-4",children:["Grant access to ",e("strong",{children:d.title}),"."]}),i("div",{className:"space-y-4",children:[i("select",{className:"w-full rounded-lg border-zinc-200 text-sm bg-white dark:bg-zinc-800",value:c,onChange:t=>$(t.target.value),children:[e("option",{value:"",children:"Select a tenant..."}),m.map(t=>e("option",{value:t.id,children:t.name},t.id))]}),e("button",{onClick:K,disabled:!c,className:"w-full bg-indigo-600 text-white py-2 rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-50",children:"Grant Access"})]})]})})]})}function ve({status:s}){return s==="ready"?i("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:[e(J,{size:12})," Ready"]}):s==="processing"?i("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:[e(L,{size:12,className:"animate-spin"})," Processing"]}):s==="error"?i("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e(ze,{size:12})," Error"]}):e("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-zinc-100 text-zinc-700",children:s})}export{Xe as default};
