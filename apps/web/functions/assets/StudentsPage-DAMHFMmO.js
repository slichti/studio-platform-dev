import{jsxs as t,jsx as e}from"react/jsx-runtime";import{useParams as re,useOutletContext as te,Link as ae}from"react-router";import{useState as c}from"react";import{Filter as ne,UserPlus as se,Search as ie,MoreHorizontal as le}from"lucide-react";import{format as ce}from"date-fns";import{toast as s}from"sonner";import{useQueryClient as de}from"@tanstack/react-query";import{useAuth as oe}from"@clerk/react-router";import{B as m,e as y,q as T,r as A,s as R,I as v,N as q,t as me,u as he,v as ue,w,x as g,y as pe,z as d,h as ge,A as fe,F as be,G as xe,H as Ne,J as I,K as ye,D as P,j as E,k as H,l as Q,m as B,L as ve,S as we,C as ze,a as j}from"./server-build-tAMGW7nt.js";import{u as ke}from"./useMembers-BPStCC4U.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router/server";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function Ce(n){return ke(n)}function Ye(){const{slug:n}=re(),{roles:F}=te(),L=F&&F.includes("owner"),{getToken:z}=oe(),k=de(),[O,J]=c(""),[C,$]=c("all"),[h,S]=c(new Set),[K,f]=c(!1),[M,o]=c(!1),[i,b]=c(null),[u,D]=c(null),{data:x=[],isLoading:X,error:U}=Ce(n||""),l=x.filter(r=>{const a=O.toLowerCase(),p=`${r.profile?.firstName||""} ${r.profile?.lastName||""}`.toLowerCase(),N=(r.user?.email||"").toLowerCase(),Y=p.includes(a)||N.includes(a),ee=C==="all"||r.status===C;return Y&&ee}),G=async r=>{r.preventDefault(),o(!0);const a=new FormData(r.currentTarget);try{const p=await z(),N=await j("/members",p,{method:"POST",headers:{"X-Tenant-Slug":n},body:JSON.stringify({email:a.get("email"),firstName:a.get("firstName"),lastName:a.get("lastName")})});N.error?s.error(N.error):(s.success("Member added"),f(!1),k.invalidateQueries({queryKey:["members",n]}))}catch(p){s.error(p.message)}finally{o(!1)}},Z=async()=>{if(i){o(!0);try{const r=await z(),a=await j(`/members/${i.id}`,r,{method:"DELETE",headers:{"X-Tenant-Slug":n}});a.error?s.error(a.error):(s.success("Member removed"),b(null),k.invalidateQueries({queryKey:["members",n]}))}catch(r){s.error(r.message)}finally{o(!1)}}},_=async()=>{if(u){o(!0);try{const r=await z(),a=await j(`/members/${u.memberId}/role`,r,{method:"PATCH",headers:{"X-Tenant-Slug":n},body:JSON.stringify({role:u.newRole})});a.error?s.error(a.error):(s.success("Role updated"),D(null),k.invalidateQueries({queryKey:["members",n]}))}catch(r){s.error(r.message)}finally{o(!1)}}},V=r=>{const a=new Set(h);a.has(r)?a.delete(r):a.add(r),S(a)},W=()=>{h.size===l.length?S(new Set):S(new Set(l.map(r=>r.id)))};return t("div",{className:"space-y-6",children:[t("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-zinc-50",children:"People"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage your student base and memberships."})]}),t("div",{className:"flex items-center gap-2",children:[t(m,{variant:"outline",children:[e(ne,{className:"h-4 w-4 mr-2"})," Filter"]}),t(m,{onClick:()=>f(!0),children:[e(se,{className:"h-4 w-4 mr-2"})," Add Member"]})]})]}),U&&e("div",{className:"p-4 bg-red-50 text-red-700 rounded border border-red-100 dark:bg-red-900/10 dark:text-red-400 dark:border-red-900/20",children:"Failed to load members. Please try again."}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e(y,{children:t(T,{className:"pb-2",children:[e(A,{children:"Total Students"}),e(R,{className:"text-3xl",children:x.length})]})}),e(y,{children:t(T,{className:"pb-2",children:[e(A,{children:"Active Memberships"}),e(R,{className:"text-3xl",children:x.filter(r=>r.status==="active").length})]})}),e(y,{children:t(T,{className:"pb-2",children:[e(A,{children:"New This Month"}),e(R,{className:"text-3xl",children:x.filter(r=>new Date(r.joinedAt)>new Date(new Date().setDate(1))).length})]})})]}),t("div",{className:"flex items-center gap-4",children:[t("div",{className:"relative flex-1 max-w-sm",children:[e(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-400"}),e(v,{placeholder:"Search students...",className:"pl-9",value:O,onChange:r=>J(r.target.value)})]}),e("div",{className:"flex items-center bg-zinc-100 p-1 rounded-md dark:bg-zinc-800",children:["all","active","inactive"].map(r=>e("button",{onClick:()=>$(r),className:q("px-3 py-1.5 text-sm font-medium rounded-sm capitalize transition-all",C===r?"bg-white text-zinc-900 shadow-sm dark:bg-zinc-700 dark:text-zinc-50":"text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-50"),children:r},r))})]}),e(me,{children:t(y,{className:"overflow-hidden",children:[t(he,{children:[e(ue,{children:t(w,{children:[e(g,{className:"w-10",children:e("input",{type:"checkbox",className:"rounded border-zinc-300 dark:border-zinc-700",checked:l.length>0&&h.size===l.length,onChange:W})}),e(g,{children:"Name"}),e(g,{children:"Status"}),e(g,{children:"Joined"}),e(g,{className:"text-right",children:"Actions"})]})}),e(pe,{children:X?Array.from({length:5}).map((r,a)=>e(w,{children:e(d,{colSpan:5,children:e("div",{className:"h-10 bg-zinc-100 dark:bg-zinc-800 rounded animate-pulse"})})},a)):l.length===0?e(w,{children:e(d,{colSpan:5,className:"text-center italic",children:"No students found."})}):l.map(r=>t(w,{className:q(h.has(r.id)&&"bg-blue-50/50 dark:bg-blue-900/10"),children:[e(d,{children:e("input",{type:"checkbox",className:"rounded border-zinc-300 dark:border-zinc-700",checked:h.has(r.id),onChange:()=>V(r.id)})}),e(d,{children:t(ae,{to:r.id,className:"flex items-center gap-3 group",children:[e("div",{className:"h-9 w-9 rounded-full bg-zinc-100 flex items-center justify-center text-zinc-500 font-medium group-hover:bg-zinc-200 dark:bg-zinc-800",children:r.profile?.firstName?.[0]||"U"}),t("div",{children:[t("div",{className:"font-medium text-zinc-900 group-hover:underline dark:text-zinc-50",children:[r.profile?.firstName," ",r.profile?.lastName]}),e("div",{className:"text-xs text-zinc-500",children:r.user?.email})]})]})}),e(d,{children:e(ge,{variant:r.status==="active"?"success":"secondary",children:r.status})}),e(d,{className:"text-zinc-500 dark:text-zinc-400",children:ce(new Date(r.joinedAt||new Date),"MMM d, yyyy")}),e(d,{className:"text-right",children:t(fe,{children:[e(be,{children:t(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e("span",{className:"sr-only",children:"Open menu"}),e(le,{className:"h-4 w-4"})]})}),t(xe,{children:[e(Ne,{children:"Actions"}),e(I,{onClick:()=>b(r),children:"Manage Role"}),e(I,{onClick:()=>navigator.clipboard.writeText(r.user?.email),children:"Copy Email"}),e(ye,{}),e(I,{className:"text-red-600 focus:text-red-600",onClick:()=>b(r),children:"Remove Student"})]})]})})]},r.id))})]}),t("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 text-center text-xs text-zinc-500",children:["Showing ",l.length," member",l.length!==1&&"s"]})]})}),e(P,{open:K,onOpenChange:f,children:t(E,{children:[t(H,{children:[e(Q,{children:"Add New Member"}),e(B,{children:"Invite a new student to your studio."})]}),t("form",{onSubmit:G,className:"space-y-4 py-4",children:[t("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Email"}),e(v,{name:"email",type:"email",required:!0,placeholder:"student@example.com"})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"First Name"}),e(v,{name:"firstName",placeholder:"Jane"})]}),t("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Last Name"}),e(v,{name:"lastName",placeholder:"Doe"})]})]}),t(ve,{children:[e(m,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e(m,{type:"submit",disabled:M,children:M?"Adding...":"Add Member"})]})]})]})}),e(P,{open:!!i,onOpenChange:r=>!r&&b(null),children:t(E,{children:[t(H,{children:[e(Q,{children:"Manage Member"}),t(B,{children:["Managing ",i?.user?.email]})]}),i&&t("div",{className:"space-y-6 py-4",children:[t("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Role"}),t(we,{className:"flex h-10 w-full items-center justify-between rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300",value:(Array.isArray(i.roles)?i.roles:[]).find(r=>r.role==="owner"||r.role==="instructor")?.role||"student",onChange:r=>D({memberId:i.id,newRole:r.target.value}),disabled:!L,children:[e("option",{value:"student",children:"Student"}),e("option",{value:"instructor",children:"Instructor"})]})]}),e("div",{className:"rounded-md border border-red-200 bg-red-50 p-4 dark:border-red-900/50 dark:bg-red-900/20",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"space-y-1",children:[e("p",{className:"text-sm font-medium text-red-900 dark:text-red-200",children:"Danger Zone"}),e("p",{className:"text-xs text-red-700 dark:text-red-300",children:"Remove this student from the studio."})]}),e(m,{variant:"destructive",size:"sm",onClick:Z,disabled:M||!L,children:"Remove"})]})})]})]})}),e(ze,{isOpen:!!u,onClose:()=>D(null),onConfirm:_,title:"Change Role",message:`Are you sure you want to change this user's role to ${u?.newRole}?`,confirmText:"Change Role"})]})}export{Ye as default};
