import{jsxs as r,jsx as e}from"react/jsx-runtime";import{useParams as $,useOutletContext as U}from"react-router";import{useState as y}from"react";import{Plus as G,MoreHorizontal as V,Shield as M,Trash2 as A,ShieldAlert as _}from"lucide-react";import{toast as s}from"sonner";import{useQueryClient as W}from"@tanstack/react-query";import{useAuth as Y}from"@clerk/react-router";import{B as o,e as w,q as S,r as T,s as k,t as Z,u as ee,v as re,w as C,x as g,y as ae,z as n,h as O,A as ie,F as ne,G as te,H as se,J as q,K as le,D as E,j as F,k as H,l as P,m as j,I as R,S as oe,L as ce,C as de,a as D}from"./server-build-tAMGW7nt.js";import{u as me}from"./useMembers-BPStCC4U.js";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router/server";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";function he(t){const{data:N,...b}=me(t);return{staff:N?.filter(d=>d.roles&&d.roles.some(c=>["owner","admin","instructor"].includes(c.role)))||[],...b}}function Le(){const{slug:t}=$(),{roles:N}=U()||{},b=N&&N.includes("owner"),{getToken:v}=Y(),d=W(),{staff:c,isLoading:L,error:B}=he(t||""),[K,x]=y(!1),[z,m]=y(!1),[l,h]=y(null),[u,f]=y(null),Q=async a=>{a.preventDefault(),m(!0);const i=new FormData(a.currentTarget);try{const p=await v(),I=await D("/members/invite",p,{method:"POST",headers:{"X-Tenant-Slug":t},body:JSON.stringify({email:i.get("email"),firstName:i.get("firstName"),lastName:i.get("lastName"),role:i.get("role")})});I.error?s.error(I.error):(s.success("Invitation sent"),x(!1),d.invalidateQueries({queryKey:["members",t]}))}catch(p){s.error(p.message||"Failed to invite staff")}finally{m(!1)}},J=async()=>{if(u){m(!0);try{const a=await v(),i=await D(`/members/${u.memberId}/role`,a,{method:"PATCH",headers:{"X-Tenant-Slug":t},body:JSON.stringify({role:u.newRole})});i.error?s.error(i.error):(s.success("Role updated"),f(null),h(null),d.invalidateQueries({queryKey:["members",t]}))}catch(a){s.error(a.message)}finally{m(!1)}}},X=async()=>{if(l){m(!0);try{const a=await v(),i=await D(`/members/${l.id}`,a,{method:"DELETE",headers:{"X-Tenant-Slug":t}});i.error?s.error(i.error):(s.success("Staff member removed"),h(null),d.invalidateQueries({queryKey:["members",t]}))}catch(a){s.error(a.message)}finally{m(!1)}}};return r("div",{className:"max-w-6xl mx-auto space-y-6 pb-10",children:[r("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[r("div",{children:[e("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-50",children:"Team Management"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage instructors, admins, and studio staff."})]}),b&&r(o,{onClick:()=>x(!0),children:[e(G,{className:"h-4 w-4 mr-2"})," Invite Staff"]})]}),B&&e("div",{className:"p-4 bg-red-50 text-red-700 rounded border border-red-100",children:"Failed to load staff. Please try again."}),r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e(w,{children:r(S,{className:"pb-2",children:[e(T,{children:"Total Staff"}),e(k,{className:"text-3xl",children:c?.length||0})]})}),e(w,{children:r(S,{className:"pb-2",children:[e(T,{children:"Instructors"}),e(k,{className:"text-3xl",children:c?.filter(a=>a.roles?.some(i=>i.role==="instructor")).length||0})]})}),e(w,{children:r(S,{className:"pb-2",children:[e(T,{children:"Admins"}),e(k,{className:"text-3xl",children:c?.filter(a=>a.roles?.some(i=>["admin","owner"].includes(i.role))).length||0})]})})]}),e(Z,{children:e(w,{className:"overflow-hidden",children:r(ee,{children:[e(re,{children:r(C,{children:[e(g,{children:"Name"}),e(g,{children:"Role"}),e(g,{children:"Email"}),e(g,{children:"Status"}),e(g,{className:"text-right",children:"Actions"})]})}),e(ae,{children:L?Array.from({length:3}).map((a,i)=>r(C,{children:[e(n,{children:e("div",{className:"h-5 w-32 bg-zinc-100 rounded animate-pulse"})}),e(n,{children:e("div",{className:"h-5 w-20 bg-zinc-100 rounded animate-pulse"})}),e(n,{children:e("div",{className:"h-5 w-40 bg-zinc-100 rounded animate-pulse"})}),e(n,{children:e("div",{className:"h-5 w-16 bg-zinc-100 rounded animate-pulse"})}),e(n,{})]},i)):c?.length===0?e(C,{children:e(n,{colSpan:5,className:"text-center py-8 text-zinc-500",children:"No staff members found. Invite someone to get started."})}):c.map(a=>{const i=a.roles?.find(p=>["owner","admin"].includes(p.role))?.role||"instructor";return r(C,{children:[e(n,{children:r("div",{className:"flex items-center gap-3",children:[e("div",{className:"h-9 w-9 rounded-full bg-zinc-100 flex items-center justify-center text-zinc-500 font-medium dark:bg-zinc-800 uppercase",children:a.profile?.firstName?.[0]||"U"}),e("div",{children:r("div",{className:"font-medium text-zinc-900 dark:text-zinc-50",children:[a.profile?.firstName," ",a.profile?.lastName]})})]})}),e(n,{children:e(O,{variant:i==="owner"?"default":i==="admin"?"secondary":"outline",className:"capitalize",children:i})}),e(n,{className:"text-zinc-500",children:a.user?.email}),e(n,{children:e(O,{variant:a.status==="active"?"success":"secondary",children:a.status})}),e(n,{className:"text-right",children:b&&r(ie,{children:[e(ne,{as:o,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e(V,{className:"h-4 w-4"})}),r(te,{align:"end",children:[e(se,{children:"Actions"}),r(q,{onClick:()=>h(a),children:[e(M,{className:"mr-2 h-4 w-4"})," Change Role"]}),e(le,{}),r(q,{onClick:()=>h(a),className:"text-red-600 focus:text-red-600",children:[e(A,{className:"mr-2 h-4 w-4"})," Remove Team Member"]})]})]})})]},a.id)})})]})})}),e(E,{open:K,onOpenChange:x,children:r(F,{children:[r(H,{children:[e(P,{children:"Invite Team Member"}),e(j,{children:"Send an invitation to join your studio team."})]}),r("form",{onSubmit:Q,className:"space-y-4 py-4",children:[r("div",{className:"grid grid-cols-2 gap-4",children:[r("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"First Name"}),e(R,{name:"firstName",placeholder:"First Name",required:!0})]}),r("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Last Name"}),e(R,{name:"lastName",placeholder:"Last Name",required:!0})]})]}),r("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Email Address"}),e(R,{name:"email",type:"email",placeholder:"colleague@example.com",required:!0})]}),r("div",{className:"space-y-2",children:[e("label",{className:"text-sm font-medium",children:"Role"}),r(oe,{name:"role",defaultValue:"instructor",children:[e("option",{value:"instructor",children:"Instructor"}),e("option",{value:"admin",children:"Admin"})]}),e("p",{className:"text-xs text-zinc-500",children:"Instructors can manage classes. Admins have full access except billing."})]}),r(ce,{children:[e(o,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e(o,{type:"submit",disabled:z,children:z?"Sending...":"Send Invitation"})]})]})]})}),e(E,{open:!!l,onOpenChange:a=>!a&&h(null),children:r(F,{children:[r(H,{children:[e(P,{children:"Manage Access"}),r(j,{children:[l?.profile?.firstName," ",l?.profile?.lastName]})]}),r("div",{className:"py-4 space-y-6",children:[r("div",{className:"bg-zinc-50 p-4 rounded-lg border border-zinc-100 dark:bg-zinc-800 dark:border-zinc-700",children:[r("h4",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e(M,{className:"h-4 w-4"})," Change Role"]}),r("div",{className:"flex gap-2",children:[e(o,{size:"sm",variant:"outline",onClick:()=>f({memberId:l.id,newRole:"instructor"}),children:"Make Instructor"}),e(o,{size:"sm",variant:"outline",onClick:()=>f({memberId:l.id,newRole:"admin"}),children:"Make Admin"}),e(o,{size:"sm",variant:"outline",onClick:()=>f({memberId:l.id,newRole:"student"}),children:"Demote to Student"})]})]}),r("div",{className:"bg-red-50 p-4 rounded-lg border border-red-100 dark:bg-red-900/10 dark:border-red-900/20",children:[r("h4",{className:"text-sm font-medium text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e(_,{className:"h-4 w-4"})," Remove from Team"]}),e("p",{className:"text-xs text-red-600 dark:text-red-300 mb-4",children:"This will remove them from the studio entirely. They will lose access immediately."}),r(o,{variant:"destructive",size:"sm",onClick:X,disabled:z,children:[e(A,{className:"h-4 w-4 mr-2"})," Remove Member"]})]})]})]})}),e(de,{isOpen:!!u,onClose:()=>f(null),onConfirm:J,title:"Confirm Role Change",message:`Are you sure you want to change this user's role to ${u?.newRole}?`,confirmText:"Update Role"})]})}export{Le as default};
