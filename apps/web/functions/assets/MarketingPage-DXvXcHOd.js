import{jsxs as n,jsx as e,Fragment as ce}from"react/jsx-runtime";import{useAuth as de}from"@clerk/react-router";import{useEffect as me,useState as r}from"react";import{useOutletContext as ue}from"react-router";import{Bold as ge,Italic as be,Type as pe,List as he,Code as xe,Link as fe,Unlink as Ne,Image as ve,AlertTriangle as ye,CheckCircle as ze,X as we,Mail as ke,Send as O,Zap as Ce,Plus as Te,Sparkles as Se,Clock as Ee,Pencil as Ae,Trash2 as _,Settings as Me}from"lucide-react";import{M as I,a as h}from"./server-build-DYgJutU4.js";import{useEditor as Oe,EditorContent as Ie}from"@tiptap/react";import $e from"@tiptap/starter-kit";import je from"@tiptap/extension-link";import Le from"@tiptap/extension-image";import De from"@tiptap/extension-placeholder";import"react-router-dom";import"isbot";import"react-dom/server";import"@clerk/react-router/server";import"@tanstack/react-query";import"sonner";import"isomorphic-dompurify";import"fuse.js";import"clsx";import"tailwind-merge";import"date-fns";import"@headlessui/react";import"class-variance-authority";/* empty css                    */import"react-error-boundary";import"react-easy-crop";import"recharts";import"@stripe/stripe-js";import"@stripe/react-stripe-js";import"react-qr-code";const Fe=({editor:l})=>{if(!l)return null;const f=()=>{const c=window.prompt("Enter image URL");c&&l.chain().focus().setImage({src:c}).run()},u=()=>{const c=l.getAttributes("link").href,s=window.prompt("URL",c);if(s!==null){if(s===""){l.chain().focus().extendMarkRange("link").unsetLink().run();return}l.chain().focus().extendMarkRange("link").setLink({href:s}).run()}};return n("div",{className:"flex flex-wrap gap-1 p-2 border-b bg-zinc-50 rounded-t-lg",children:[e("button",{type:"button",onClick:()=>l.chain().focus().toggleBold().run(),disabled:!l.can().chain().focus().toggleBold().run(),className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("bold")?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Bold",children:e(ge,{className:"w-4 h-4"})}),e("button",{type:"button",onClick:()=>l.chain().focus().toggleItalic().run(),disabled:!l.can().chain().focus().toggleItalic().run(),className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("italic")?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Italic",children:e(be,{className:"w-4 h-4"})}),e("div",{className:"w-px h-6 bg-zinc-300 mx-1 self-center"}),e("button",{type:"button",onClick:()=>l.chain().focus().toggleHeading({level:2}).run(),className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("heading",{level:2})?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Heading 2",children:e(pe,{className:"w-4 h-4"})}),e("button",{type:"button",onClick:()=>l.chain().focus().toggleBulletList().run(),className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("bulletList")?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Bullet List",children:e(he,{className:"w-4 h-4"})}),e("button",{type:"button",onClick:()=>l.chain().focus().toggleCodeBlock().run(),className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("codeBlock")?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Code Block",children:e(xe,{className:"w-4 h-4"})}),e("div",{className:"w-px h-6 bg-zinc-300 mx-1 self-center"}),e("button",{type:"button",onClick:u,className:`p-1.5 rounded hover:bg-zinc-200 ${l.isActive("link")?"bg-zinc-200 text-black":"text-zinc-500"}`,title:"Add Link",children:e(fe,{className:"w-4 h-4"})}),e("button",{type:"button",onClick:()=>l.chain().focus().unsetLink().run(),disabled:!l.isActive("link"),className:"p-1.5 rounded hover:bg-zinc-200 text-zinc-500 disabled:opacity-30",title:"Remove Link",children:e(Ne,{className:"w-4 h-4"})}),e("div",{className:"w-px h-6 bg-zinc-300 mx-1 self-center"}),e("button",{type:"button",onClick:f,className:"p-1.5 rounded hover:bg-zinc-200 text-zinc-500",title:"Add Image URL",children:e(ve,{className:"w-4 h-4"})})]})};function q({value:l,onChange:f,placeholder:u,className:c}){const s=Oe({extensions:[$e,je.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline"}}),Le.configure({HTMLAttributes:{class:"rounded-lg max-w-full my-4 border border-zinc-200"}}),De.configure({placeholder:u||"Write something..."})],content:l,editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[150px] p-4"}},onUpdate:({editor:N})=>{f(N.getHTML())}});return me(()=>{s&&l!==s.getHTML()&&s.getText()===""&&l&&s.commands.setContent(l)},[l,s]),n("div",{className:`border border-zinc-300 rounded-lg bg-white overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 ${c}`,children:[e(Fe,{editor:s}),e(Ie,{editor:s})]})}function pt({campaigns:l,automations:f,slug:u}){const{getToken:c}=de(),[s,N]=r("broadcast"),[k,T]=r(null),[$,Y]=r(l),[j,L]=r(""),[D,F]=r(""),[B,R]=r(!1),[g,S]=r({ageMin:0,ageMax:100,preset:"all"}),[x,v]=r(f||[]),[y,z]=r(null),[a,d]=r({subject:"",content:"",isEnabled:!1,timingType:"immediate",timingValue:0,triggerEvent:"",triggerCondition:"{}",channels:["email"],couponConfig:{enabled:!1,type:"percent",value:20,validityDays:7}}),[b,w]=r({isOpen:!1,automationId:null,email:""}),[H,V]=r(!1),m=(t,i="success")=>{T({message:t,type:i}),setTimeout(()=>T(null),3e3)},{tenant:P}=ue(),[J,G]=r(P?.branding?.emailReplyTo||""),[X,K]=r(P?.branding?.emailFooterText||""),[E,U]=r(!1);async function Z(t){t.preventDefault(),R(!0);try{const i=await c(),o=await h("/marketing",i,{method:"POST",headers:{"X-Tenant-Slug":u},body:JSON.stringify({subject:j,content:D,filters:g.preset==="all"?{}:{ageMin:g.ageMin,ageMax:g.ageMax}})});if(o.error)m(o.error,"error");else{m(`Campaign Sent to ${o.count} recipients!`),L(""),F("");const p=await h("/marketing",i,{headers:{"X-Tenant-Slug":u}});Y(p.campaigns||[])}}catch(i){m("Failed to send: "+i.message,"error")}finally{R(!1)}}async function Q(){try{const t=await c(),i=await h("/marketing/automations",t,{method:"POST",headers:{"X-Tenant-Slug":u},body:JSON.stringify({triggerEvent:"new_student",subject:"New Automation"})});if(i.error)throw new Error(i.error);v([...x,i]),z(i),d({subject:i.subject,content:i.content,isEnabled:i.isEnabled,timingType:i.timingType||"immediate",timingValue:i.timingValue||0,triggerEvent:i.triggerEvent,triggerCondition:JSON.stringify(i.triggerCondition||{},null,2),channels:i.channels||["email"],couponConfig:i.couponConfig?{...i.couponConfig,enabled:!0}:{enabled:!1,type:"percent",value:20,validityDays:7}})}catch(t){m("Failed to create: "+t.message,"error")}}async function ee(t){if(t.preventDefault(),!!y)try{let i=null;try{i=a.triggerCondition?JSON.parse(a.triggerCondition):null}catch{m("Invalid JSON in Condition field","error");return}const o=await c(),p={...a,triggerCondition:i},oe=await h(`/marketing/automations/${y.id}`,o,{method:"PATCH",headers:{"X-Tenant-Slug":u},body:JSON.stringify(p)});v(x.map(M=>M.id===y.id?oe:M)),z(null),m("Automation updated successfully")}catch(i){m("Failed to update: "+i.message,"error")}}const[A,C]=r({isOpen:!1,automationId:null});function te(t){C({isOpen:!0,automationId:t})}async function ne(){if(!A.automationId)return;const t=A.automationId;try{const i=await c();await h(`/marketing/automations/${t}`,i,{method:"DELETE",headers:{"X-Tenant-Slug":u}}),v(x.filter(o=>o.id!==t)),m("Automation deleted.")}catch(i){m("Failed to delete: "+i.message,"error")}finally{C({isOpen:!1,automationId:null})}}function ie(t){w({isOpen:!0,automationId:t,email:b.email})}async function ae(t){if(t.preventDefault(),!(!b.automationId||!b.email)){V(!0);try{const i=await c();await h(`/marketing/automations/${b.automationId}/test`,i,{method:"POST",headers:{"X-Tenant-Slug":u},body:JSON.stringify({email:b.email})}),m("Test email sent!"),w({...b,isOpen:!1})}catch(i){m("Failed to test: "+i.message,"error")}finally{V(!1)}}}const W={new_student:"New Student Welcome",birthday:"Birthday Greeting",absent:"Win-back (Absent)",class_attended:"Class Follow-up",order_completed:"Order Follow-up",trial_ending:"Trial Ending",subscription_renewing:"Subscription Renewing"},le=t=>t.timingType==="immediate"?"Immediate":t.timingType==="delay"?`Delay: ${t.timingValue} hours`:t.timingType==="before"?`${t.timingValue} hours Before`:t.timingType==="after"?`${t.timingValue} hours After`:t.delayHours>0?`Delay: ${t.delayHours} hours`:"Immediate";async function se(t){try{const i=!t.isEnabled;v(x.map(p=>p.id===t.id?{...p,isEnabled:i}:p));const o=await c();await h(`/marketing/automations/${t.id}`,o,{method:"PATCH",headers:{"X-Tenant-Slug":u},body:JSON.stringify({isEnabled:i})})}catch(i){m("Failed to toggle: "+i.message,"error"),v(x.map(o=>o.id===t.id?{...o,isEnabled:!t.isEnabled}:o))}}async function re(t){t.preventDefault(),U(!0);try{const i=await c();await h("/tenant/settings",i,{method:"PATCH",headers:{"X-Tenant-Slug":u},body:JSON.stringify({branding:{emailReplyTo:J,emailFooterText:X}})}),m("Email settings saved successfully!")}catch(i){m("Failed to save: "+i.message,"error")}finally{U(!1)}}return n("div",{className:"max-w-6xl mx-auto py-8 px-4 relative",children:[k&&n("div",{className:`fixed top-4 right-4 z-[100] px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-in slide-in-from-right fade-in duration-300 ${k.type==="error"?"bg-red-50 border-red-200 text-red-800":"bg-emerald-50 border-emerald-200 text-emerald-800"}`,children:[k.type==="error"?e(ye,{className:"h-5 w-5"}):e(ze,{className:"h-5 w-5"}),e("span",{className:"font-medium text-sm",children:k.message}),e("button",{onClick:()=>T(null),className:"ml-2 hover:opacity-70",children:e(we,{className:"h-4 w-4"})})]}),n("div",{className:"mb-8",children:[e("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Email Automations"}),e("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Engage your students with broadcasts, automations, and email settings."})]}),n("div",{className:"flex gap-4 mb-6 border-b border-zinc-200",children:[n("button",{onClick:()=>N("broadcast"),className:`pb-3 px-1 font-medium text-sm transition-colors relative ${s==="broadcast"?"text-blue-600":"text-zinc-500 hover:text-zinc-700"}`,children:["Broadcasts",s==="broadcast"&&e("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"})]}),n("button",{onClick:()=>N("automation"),className:`pb-3 px-1 font-medium text-sm transition-colors relative ${s==="automation"?"text-blue-600":"text-zinc-500 hover:text-zinc-700"}`,children:["Automations",s==="automation"&&e("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"})]}),n("button",{onClick:()=>N("settings"),className:`pb-3 px-1 font-medium text-sm transition-colors relative ${s==="settings"?"text-blue-600":"text-zinc-500 hover:text-zinc-700"}`,children:["Settings",s==="settings"&&e("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"})]})]}),s==="broadcast"&&n("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e("div",{className:"lg:col-span-2 space-y-6",children:n("div",{className:"bg-white rounded-lg border border-zinc-200 p-6 shadow-sm",children:[n("h2",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e(ke,{className:"h-5 w-5 text-blue-600"}),"New Broadcast"]}),n("form",{onSubmit:Z,className:"space-y-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Subject Line"}),e("input",{type:"text",value:j,onChange:t=>L(t.target.value),className:"w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. November Newsletter",required:!0})]}),n("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"Message Content"}),e(q,{value:D,onChange:F,placeholder:"Write your beautiful email content...",className:"min-h-[300px]"}),n("div",{className:"flex justify-between items-start mt-1",children:[e("p",{className:"text-xs text-zinc-400",children:"Rich text enabled. Use the toolbar to format."}),n("div",{className:"text-xs text-zinc-500 text-right",children:["Variables: ",e("span",{className:"font-mono bg-zinc-100 px-1 rounded",children:"{{firstName}}"})," ",e("span",{className:"font-mono bg-zinc-100 px-1 rounded",children:"{{studioName}}"})]})]})]}),n("div",{className:"bg-zinc-50 border border-zinc-200 p-4 rounded-lg",children:[e("label",{className:"block text-sm font-semibold text-zinc-800 mb-3",children:"Target Audience"}),e("div",{className:"flex flex-wrap gap-2 mb-4",children:[{label:"All Students",value:"all",min:0,max:100},{label:"Youth (<18)",value:"youth",min:0,max:17},{label:"Adults (18-64)",value:"adults",min:18,max:64},{label:"Seniors (65+)",value:"seniors",min:65,max:100},{label:"Custom",value:"custom",min:g.ageMin,max:g.ageMax}].map(t=>e("button",{type:"button",onClick:()=>S({...g,preset:t.value,ageMin:t.min,ageMax:t.max}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${g.preset===t.value?"bg-blue-600 text-white":"bg-white border border-zinc-300 text-zinc-600 hover:bg-zinc-50"}`,children:t.label},t.value))}),g.preset==="custom"&&n("div",{className:"flex items-center gap-4 animate-in fade-in slide-in-from-top-1",children:[n("div",{className:"flex-1",children:[e("label",{className:"block text-[10px] uppercase font-bold text-zinc-500 mb-1",children:"Min Age"}),e("input",{type:"number",value:g.ageMin,onChange:t=>S({...g,ageMin:Number(t.target.value)}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"})]}),n("div",{className:"flex-1",children:[e("label",{className:"block text-[10px] uppercase font-bold text-zinc-500 mb-1",children:"Max Age"}),e("input",{type:"number",value:g.ageMax,onChange:t=>S({...g,ageMax:Number(t.target.value)}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-sm outline-none"})]})]})]}),e("div",{className:"flex justify-end",children:e("button",{type:"submit",disabled:B,className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:B?"Sending...":n(ce,{children:[e(O,{className:"h-4 w-4"}),"Send Broadcast"]})})})]})]})}),n("div",{className:"bg-zinc-50 rounded-lg border border-zinc-200 p-6 h-fit",children:[e("h3",{className:"font-semibold text-zinc-700 mb-4",children:"Recent Campaigns"}),n("div",{className:"space-y-4",children:[$.length===0&&e("p",{className:"text-sm text-zinc-500 italic",children:"No campaigns yet."}),$.map(t=>n("div",{className:"bg-white border border-zinc-200 rounded p-3 shadow-sm",children:[n("div",{className:"flex justify-between items-start mb-1",children:[e("span",{className:"font-medium text-sm text-zinc-900 line-clamp-1",children:t.subject}),e("span",{className:`text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${t.status==="sent"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:t.status})]}),e("p",{className:"text-xs text-zinc-500 mb-2",children:new Date(t.sentAt).toLocaleDateString()}),n("div",{className:"flex gap-3 text-xs text-zinc-600",children:[n("span",{className:"flex items-center gap-1",children:[e(O,{className:"h-3 w-3"}),t.stats?.sent||0," Sent"]}),t.filters&&n("span",{className:"flex items-center gap-1 bg-zinc-100 px-1.5 rounded",children:[t.filters.ageMin,"-",t.filters.ageMax," yrs"]})]})]},t.id))]})]})]}),s==="automation"&&e("div",{className:"space-y-6",children:n("div",{className:"bg-white p-6 rounded-lg border border-zinc-200",children:[n("div",{className:"flex items-center justify-between mb-4",children:[n("div",{children:[n("h2",{className:"font-semibold text-lg flex items-center gap-2",children:[e(Ce,{className:"h-5 w-5 text-amber-500"}),"Active Automations"]}),e("p",{className:"text-sm text-zinc-500",children:"These emails are sent automatically based on student activity."})]}),n("button",{onClick:Q,className:"flex items-center gap-2 bg-zinc-900 text-white px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-zinc-800",children:[e(Te,{className:"h-4 w-4"}),"New Automation"]})]}),e("div",{className:"flex flex-col gap-2",children:x.map(t=>n("div",{className:"group border border-zinc-200 rounded-lg px-4 py-3 flex items-center justify-between hover:border-blue-300 transition-colors bg-white",children:[n("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e("div",{className:`p-1.5 rounded-full shrink-0 ${t.isEnabled?"bg-blue-100 text-blue-600":"bg-zinc-100 text-zinc-400"}`,children:e(Se,{className:"h-4 w-4"})}),n("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e("h3",{className:"font-medium text-zinc-900 whitespace-nowrap shrink-0",children:W[t.triggerEvent]||t.triggerEvent||t.triggerType}),n("span",{className:"flex items-center gap-1 bg-zinc-50 px-2 py-0.5 rounded text-xs text-zinc-500 whitespace-nowrap shrink-0 border border-zinc-100",children:[e(Ee,{className:"w-3 h-3"}),le(t)]}),e("span",{className:"text-sm text-zinc-500 truncate min-w-0",children:t.subject})]})]}),n("div",{className:"flex items-center gap-4 shrink-0 ml-4",children:[e("button",{onClick:()=>se(t),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${t.isEnabled?"bg-blue-600":"bg-zinc-200"}`,children:e("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t.isEnabled?"translate-x-6":"translate-x-1"}`})}),e("button",{onClick:()=>ie(t.id),className:"text-xs text-zinc-500 hover:text-zinc-800 p-2 hover:bg-zinc-100 rounded",title:"Send Test",children:e(O,{className:"h-4 w-4"})}),e("button",{onClick:()=>{z(t),d({subject:t.subject,content:t.content,isEnabled:t.isEnabled,timingType:t.timingType||(t.delayHours>0?"delay":"immediate"),timingValue:t.timingValue||t.delayHours||0,triggerEvent:t.triggerEvent||t.triggerType,triggerCondition:JSON.stringify(t.triggerCondition||{},null,2),channels:t.channels||["email"],couponConfig:t.couponConfig?{...t.couponConfig,enabled:!0}:{enabled:!1,type:"percent",value:20,validityDays:7}})},className:"text-xs text-zinc-500 hover:text-blue-600 p-2 hover:bg-blue-50 rounded",title:"Edit",children:e(Ae,{className:"h-4 w-4"})}),e("button",{onClick:()=>te(t.id),className:"text-xs text-zinc-500 hover:text-red-600 p-2 hover:bg-red-50 rounded",title:"Delete",children:e(_,{className:"h-4 w-4"})})]})]},t.id))})]})}),s==="settings"&&e("div",{className:"max-w-2xl",children:n("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 shadow-sm",children:[n("div",{className:"flex items-center gap-3 mb-6",children:[e("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg",children:e(Me,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),n("div",{children:[e("h2",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100",children:"Email Settings"}),e("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Configure how your emails appear to students."})]})]}),n("form",{onSubmit:re,className:"space-y-5",children:[n("div",{children:[e("label",{className:"block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",children:"Reply-To Address"}),e("input",{type:"email",value:J,onChange:t=>G(t.target.value),className:"w-full bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"hello@yourstudio.com"}),e("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:"This is the email address students will reply to."})]}),n("div",{children:[e("label",{className:"block text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",children:"Email Footer Text"}),e("textarea",{value:X,onChange:t=>K(t.target.value),className:"w-full min-h-[80px] bg-transparent text-zinc-900 dark:text-zinc-100 border border-zinc-200 dark:border-zinc-700 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-y",placeholder:"e.g. 123 Yoga St, City, ST 12345"}),e("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:"Address or legal text to include at the bottom of every email."})]}),e("div",{className:"pt-2",children:e("button",{type:"submit",disabled:E,className:`bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 px-5 py-2.5 rounded-md font-medium text-sm hover:opacity-90 transition-opacity ${E?"opacity-70 cursor-not-allowed":""}`,children:E?"Saving...":"Save Settings"})})]})]})}),e(I,{isOpen:b.isOpen,onClose:()=>w({...b,isOpen:!1}),title:"Send Test Email",children:n("form",{onSubmit:ae,className:"space-y-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium text-zinc-700 mb-1",children:"To Email Address"}),e("input",{type:"email",value:b.email,onChange:t=>w({...b,email:t.target.value}),className:"w-full border border-zinc-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"you@example.com",autoFocus:!0,required:!0}),e("p",{className:"text-xs text-zinc-500 mt-1",children:"This will send a real email to the address above."})]}),n("div",{className:"flex justify-end gap-2",children:[e("button",{type:"button",onClick:()=>w({...b,isOpen:!1}),className:"px-4 py-2 text-sm text-zinc-600 hover:text-zinc-900",children:"Cancel"}),e("button",{type:"submit",disabled:H,className:"bg-zinc-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-zinc-800 disabled:opacity-50",children:H?"Sending...":"Send Test"})]})]})}),e(I,{isOpen:!!y,onClose:()=>z(null),title:"Edit Automation",maxWidth:"max-w-2xl",children:y&&n("form",{onSubmit:ee,className:"flex flex-col h-full",children:[n("div",{className:"flex-1 overflow-y-auto max-h-[70vh] pr-2 space-y-4",children:[n("div",{className:"flex items-center justify-between bg-zinc-50 p-3 rounded-lg border border-zinc-200",children:[e("span",{className:"text-sm font-medium text-zinc-900",children:"Automation Status"}),n("label",{className:"relative inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",checked:a.isEnabled,onChange:t=>d({...a,isEnabled:t.target.checked}),className:"sr-only peer"}),e("div",{className:"w-11 h-6 bg-zinc-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"}),e("span",{className:"ml-3 text-sm font-medium text-zinc-700",children:a.isEnabled?"Enabled":"Disabled"})]})]}),n("div",{className:"grid grid-cols-2 gap-4",children:[n("div",{children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Trigger Event"}),e("select",{value:a.triggerEvent,onChange:t=>d({...a,triggerEvent:t.target.value}),className:"w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white",children:Object.entries(W).map(([t,i])=>e("option",{value:t,children:i},t))})]}),e("div",{className:"space-y-2",children:n("div",{className:"flex gap-2",children:[n("div",{className:"flex-1",children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Timing Rule"}),n("select",{value:a.timingType,onChange:t=>d({...a,timingType:t.target.value}),className:"w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white",children:[e("option",{value:"immediate",children:"Immediately"}),e("option",{value:"delay",children:"Delay (Wait)"}),e("option",{value:"before",children:"Before Event"}),e("option",{value:"after",children:"After Event"})]})]}),a.timingType!=="immediate"&&n("div",{className:"w-20",children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Hours"}),e("input",{type:"number",min:"0",value:a.timingValue,onChange:t=>d({...a,timingValue:parseInt(t.target.value)||0}),className:"w-full border border-zinc-300 rounded px-2 py-1.5 text-sm bg-white"})]})]})})]}),n("div",{children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Trigger Conditions (JSON)"}),e("textarea",{value:a.triggerCondition,onChange:t=>d({...a,triggerCondition:t.target.value}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-xs font-mono h-12 bg-zinc-50",placeholder:'{ "planId": "..." }'})]}),n("div",{className:"flex flex-col gap-1",children:[e("label",{className:"block text-xs font-medium text-zinc-500",children:"Channels"}),n("div",{className:"flex gap-4 items-center",children:[n("label",{className:"flex items-center gap-2 text-sm bg-white border border-zinc-200 rounded px-3 py-1.5",children:[e("input",{type:"checkbox",checked:a.channels.includes("email"),onChange:t=>{const i=a.channels,o=t.target.checked?[...i,"email"]:i.filter(p=>p!=="email");d({...a,channels:o})},className:"rounded text-blue-600 focus:ring-blue-500"}),"Email"]}),e("span",{className:"text-xs text-zinc-400",children:"SMS Coming Soon"})]})]}),n("div",{className:"bg-zinc-50 p-3 rounded-lg border border-zinc-200",children:[n("label",{className:"flex items-center gap-2 mb-2 cursor-pointer",children:[e("input",{type:"checkbox",checked:a.couponConfig.enabled,onChange:t=>d({...a,couponConfig:{...a.couponConfig,enabled:t.target.checked}}),className:"w-4 h-4 text-green-600 rounded focus:ring-green-500"}),e("span",{className:"text-sm font-medium text-zinc-900",children:"Include Discount Coupon"})]}),a.couponConfig.enabled&&n("div",{className:"grid grid-cols-3 gap-2 animate-in fade-in slide-in-from-top-1",children:[n("div",{children:[e("label",{className:"block text-[10px] font-medium text-zinc-500 mb-1",children:"Type"}),n("select",{value:a.couponConfig.type,onChange:t=>d({...a,couponConfig:{...a.couponConfig,type:t.target.value}}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-xs",children:[e("option",{value:"percent",children:"Percent (%)"}),e("option",{value:"amount",children:"Amount ($)"})]})]}),n("div",{children:[e("label",{className:"block text-[10px] font-medium text-zinc-500 mb-1",children:"Value"}),e("input",{type:"number",value:a.couponConfig.value,onChange:t=>d({...a,couponConfig:{...a.couponConfig,value:parseInt(t.target.value)||0}}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-xs"})]}),n("div",{children:[e("label",{className:"block text-[10px] font-medium text-zinc-500 mb-1",children:"Validity (Days)"}),e("input",{type:"number",value:a.couponConfig.validityDays,onChange:t=>d({...a,couponConfig:{...a.couponConfig,validityDays:parseInt(t.target.value)||7}}),className:"w-full border border-zinc-300 rounded px-2 py-1 text-xs"})]})]})]}),n("div",{children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Subject Line"}),e("input",{type:"text",value:a.subject,onChange:t=>d({...a,subject:t.target.value}),className:"w-full border border-zinc-300 rounded px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-500"})]}),n("div",{children:[e("label",{className:"block text-xs font-medium text-zinc-500 mb-1",children:"Content"}),e(q,{value:a.content,onChange:t=>d({...a,content:t}),placeholder:"Write your automation content...",className:"min-h-[200px]"}),n("div",{className:"flex gap-2 mt-1 text-[10px] text-zinc-500 flex-wrap",children:[e("span",{children:"Variables:"}),e("code",{className:"bg-zinc-100 px-1 rounded",children:"{{firstName}}"}),e("code",{className:"bg-zinc-100 px-1 rounded",children:"{{lastName}}"}),e("code",{className:"bg-zinc-100 px-1 rounded",children:"{{email}}"}),e("code",{className:"bg-zinc-100 px-1 rounded",children:"{{title}}"}),e("code",{className:"bg-zinc-100 px-1 rounded",children:"{{address}}"}),a.couponConfig.enabled&&e("code",{className:"bg-yellow-100 text-yellow-800 px-1 rounded",children:"{{coupon_code}}"})]})]})]}),n("div",{className:"flex justify-end gap-2 pt-4 mt-2 border-t border-zinc-100",children:[e("button",{type:"button",onClick:()=>z(null),className:"px-4 py-2 text-sm text-zinc-600 hover:text-zinc-900 border border-zinc-200 rounded-lg hover:bg-zinc-50",children:"Cancel"}),e("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 shadow-sm",children:"Save Changes"})]})]})}),e(I,{isOpen:A.isOpen,onClose:()=>C({isOpen:!1,automationId:null}),title:"Delete Automation",children:n("div",{className:"space-y-4",children:[e("p",{className:"text-zinc-600",children:"Are you sure you want to delete this automation? This action cannot be undone."}),n("div",{className:"flex justify-end gap-3",children:[e("button",{onClick:()=>C({isOpen:!1,automationId:null}),className:"px-4 py-2 text-sm font-medium text-zinc-600 hover:text-zinc-900",children:"Cancel"}),n("button",{onClick:ne,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-sm flex items-center gap-2",children:[e(_,{className:"w-4 h-4"}),"Delete Forever"]})]})]})})]})}export{pt as default};
